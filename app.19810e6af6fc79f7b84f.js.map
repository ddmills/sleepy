{"version":3,"sources":["webpack://sleepy/webpack/runtime/create fake namespace object","webpack://sleepy/./src/index.js","webpack://sleepy/./src/utils/ImageLoader.js","webpack://sleepy/./node_modules/howler/dist/howler.js","webpack://sleepy/./src/core/Game.js","webpack://sleepy/./src/core/rendering/RenderManager.js","webpack://sleepy/./src/core/Manager.js","webpack://sleepy/./src/core/rendering/Display.js","webpack://sleepy/./src/utils/Grid.js","webpack://sleepy/./src/core/rendering/spritesheets.js","webpack://sleepy/./src/core/rendering/SpriteSheet.js","webpack://sleepy/./src/core/rendering/cp437.js","webpack://sleepy/./src/core/rendering/Sprite.js","webpack://sleepy/./src/utils/ColorParser.js","webpack://sleepy/./node_modules/color-parse/index.mjs","webpack://sleepy/./node_modules/color-name/index.js","webpack://sleepy/./src/utils/ColorUtil.js","webpack://sleepy/./src/core/input/InputController.js","webpack://sleepy/./src/core/input/events/InputKeyboardEvent.js","webpack://sleepy/./src/core/input/events/InputEvent.js","webpack://sleepy/./src/core/input/events/InputMouseEvent.js","webpack://sleepy/./src/systems/ActionSystem.js","webpack://sleepy/./src/core/screens/ScreenType.js","webpack://sleepy/./src/ecs/components/Actor.js","webpack://sleepy/../node_modules/camelcase/index.js","webpack://sleepy/../src/util/string-util.js","webpack://sleepy/../src/Properties/Property.js","webpack://sleepy/../src/Properties/SimpleProperty.js","webpack://sleepy/../src/Properties/EntityProperty.js","webpack://sleepy/../src/Properties/EntityArrayProperty.js","webpack://sleepy/../src/Properties/PropertyFactory.js","webpack://sleepy/../src/Component.js","webpack://sleepy/../src/registries/ComponentRegistry.js","webpack://sleepy/../node_modules/deepmerge/dist/cjs.js","webpack://sleepy/../src/PrefabComponent.js","webpack://sleepy/../src/Prefab.js","webpack://sleepy/../src/registries/PrefabRegistry.js","webpack://sleepy/../src/EntityEvent.js","webpack://sleepy/../src/Entity.js","webpack://sleepy/../src/registries/EntityRegistry.js","webpack://sleepy/../src/Query.js","webpack://sleepy/../src/registries/QueryRegistry.js","webpack://sleepy/../src/Engine.js","webpack://sleepy/../node_modules/nanoid/non-secure/index.js","webpack://sleepy/./src/ecs/components/IsDestroying.js","webpack://sleepy/./src/ecs/components/LiquidContainer.js","webpack://sleepy/./src/data/Spawnables.js","webpack://sleepy/./src/data/Spawner.js","webpack://sleepy/./src/data/spawnables/SpawnableVialHoney.js","webpack://sleepy/./src/enums/LiquidTypes.js","webpack://sleepy/./src/data/spawnables/SpawnableVialBlood.js","webpack://sleepy/./src/data/spawnables/SpawnableVialWater.js","webpack://sleepy/./src/data/spawnables/SpawnableGoblinGrunt.js","webpack://sleepy/./src/ai/GoalTypes/BoredGoalType.js","webpack://sleepy/./src/ai/GoalTypes/GoalType.js","webpack://sleepy/./src/ai/GoalActionResult.js","webpack://sleepy/./src/ai/GoalTypes/KillSomethingGoalType.js","webpack://sleepy/./src/utils/AStar.js","webpack://sleepy/./src/utils/diagonalDistance.js","webpack://sleepy/./src/utils/ManhattanDistance.js","webpack://sleepy/./src/utils/PriorityQueue.js","webpack://sleepy/./src/ai/GoalTypes/MoveGoalType.js","webpack://sleepy/./src/ai/GoalTypes/EatFoodGoalType.js","webpack://sleepy/./src/data/spawnables/SpawnableGoblinBruiser.js","webpack://sleepy/./src/data/spawnables/SpawnableGoblinStargazer.js","webpack://sleepy/./src/data/spawnables/SpawnablePineTree.js","webpack://sleepy/./src/utils/rand.js","webpack://sleepy/./src/data/spawnables/SpawnableHumanWanderer.js","webpack://sleepy/./src/data/spawnables/SpawnablePoolLiquid.js","webpack://sleepy/./src/data/spawnables/SpawnableGrass.js","webpack://sleepy/./src/data/spawnables/SpawnableDeadGrass.js","webpack://sleepy/./src/data/spawnables/SpawnableSand.js","webpack://sleepy/./src/data/spawnables/SpawnableCliff.js","webpack://sleepy/./src/data/spawnables/SpawnableSnake.js","webpack://sleepy/./src/data/spawnables/SpawnableBear.js","webpack://sleepy/./src/ecs/components/Door.js","webpack://sleepy/./src/ecs/components/Blocker.js","webpack://sleepy/./src/ecs/components/Shadowcaster.js","webpack://sleepy/./src/ecs/components/Loot.js","webpack://sleepy/./src/ecs/components/Inventory.js","webpack://sleepy/./src/ecs/components/IsInventoried.js","webpack://sleepy/./src/ecs/components/Stackable.js","webpack://sleepy/./src/enums/Stackables.js","webpack://sleepy/./src/ecs/components/Throwable.js","webpack://sleepy/./src/data/Skills.js","webpack://sleepy/./src/data/skills/ArmorSkill.js","webpack://sleepy/./src/data/skills/Skill.js","webpack://sleepy/./src/data/Stats.js","webpack://sleepy/./src/data/skills/SpeedSkill.js","webpack://sleepy/./src/data/skills/ThrowingSkill.js","webpack://sleepy/./src/data/skills/DodgeSkill.js","webpack://sleepy/./src/data/skills/BrawlingSkill.js","webpack://sleepy/./src/data/skills/AxeSkill.js","webpack://sleepy/./src/data/skills/BladeSkill.js","webpack://sleepy/./src/data/skills/CudgelSkill.js","webpack://sleepy/./src/data/skills/HealthSkill.js","webpack://sleepy/./src/data/Attack.js","webpack://sleepy/./src/data/DamageTypes.js","webpack://sleepy/./src/utils/BresenhamLine.js","webpack://sleepy/./src/utils/cursor/SimpleLineRenderer.js","webpack://sleepy/./src/ecs/components/FragileGlass.js","webpack://sleepy/./src/enums/ConsoleEvents.js","webpack://sleepy/./src/ecs/components/Brain.js","webpack://sleepy/./src/ecs/components/Body.js","webpack://sleepy/./src/ecs/components/Goal.js","webpack://sleepy/./src/ai/GoalEvaluator.js","webpack://sleepy/./src/ecs/components/Moniker.js","webpack://sleepy/./src/ecs/components/Logger.js","webpack://sleepy/./src/ecs/components/Position.js","webpack://sleepy/./src/ecs/components/Glyph.js","webpack://sleepy/./src/ecs/components/Motor.js","webpack://sleepy/./src/ecs/components/IsPlayer.js","webpack://sleepy/./src/ecs/components/Wandering.js","webpack://sleepy/./src/enums/Directions.js","webpack://sleepy/./src/ecs/components/IsVisible.js","webpack://sleepy/./src/ecs/components/Explorable.js","webpack://sleepy/./src/ecs/components/Explored.js","webpack://sleepy/./src/ecs/components/Health.js","webpack://sleepy/./src/ecs/components/IsDead.js","webpack://sleepy/./src/ecs/components/FactionMember.js","webpack://sleepy/./src/enums/Factions.js","webpack://sleepy/./src/data/Faction.js","webpack://sleepy/./src/ecs/components/Eyes.js","webpack://sleepy/./src/ecs/components/Particle.js","webpack://sleepy/./src/ecs/components/ParticleEmitter.js","webpack://sleepy/./src/ecs/components/LootDropper.js","webpack://sleepy/./src/data/tables/LootSpawn.js","webpack://sleepy/./src/utils/WeightedTable.js","webpack://sleepy/./src/data/tables/loot/LootTableGoblin.js","webpack://sleepy/./src/data/tables/loot/LootTableForest.js","webpack://sleepy/./src/data/tables/loot/LootTableBruiser.js","webpack://sleepy/./src/ecs/components/IsEquipped.js","webpack://sleepy/./src/ecs/components/Equipment.js","webpack://sleepy/./src/data/EquipmentSlotType.js","webpack://sleepy/./src/ecs/components/EquipmentSlot.js","webpack://sleepy/./src/data/WeaponTypes.js","webpack://sleepy/./src/data/WeaponFamilies.js","webpack://sleepy/./src/data/weapons/WpnTypeBattleAxe.js","webpack://sleepy/./src/data/weapons/WeaponType.js","webpack://sleepy/./src/data/weapons/WpnTypeFangs.js","webpack://sleepy/./src/data/weapons/WpnTypeClaw.js","webpack://sleepy/./src/data/weapons/WpnTypeGreatsword.js","webpack://sleepy/./src/data/weapons/WpnTypeMace.js","webpack://sleepy/./src/data/Statuses.js","webpack://sleepy/./src/data/statuses/StatusBleeding.js","webpack://sleepy/./src/enums/StatusTypes.js","webpack://sleepy/./src/data/statuses/Status.js","webpack://sleepy/./src/data/statuses/StatusRegeneration.js","webpack://sleepy/./src/data/statuses/StatusStunned.js","webpack://sleepy/./src/data/weapons/WpnTypeShortsword.js","webpack://sleepy/./src/data/weapons/WpnTypeUnarmed.js","webpack://sleepy/./src/ecs/components/Stats.js","webpack://sleepy/./node_modules/rot-js/lib/util.js","webpack://sleepy/./src/ecs/components/Race.js","webpack://sleepy/./src/data/Races.js","webpack://sleepy/./src/data/RaceData.js","webpack://sleepy/./src/ecs/components/Weapon.js","webpack://sleepy/./src/ecs/components/Status.js","webpack://sleepy/./src/ecs/components/Ground.js","webpack://sleepy/./src/ecs/components/IsIncapacitated.js","webpack://sleepy/./src/ecs/components/SharpTrap.js","webpack://sleepy/./src/ecs/components/EquippedSkillMod.js","webpack://sleepy/./src/ecs/components/Combustible.js","webpack://sleepy/./src/ecs/components/Fire.js","webpack://sleepy/./src/ecs/components/ThermalCapacity.js","webpack://sleepy/./src/ecs/components/Abilities.js","webpack://sleepy/./src/ecs/components/AbilityStatus.js","webpack://sleepy/./src/data/Abilities.js","webpack://sleepy/./src/data/abilities/prayers/PrayerOfProtectionAbility.js","webpack://sleepy/./src/enums/AbilityTypes.js","webpack://sleepy/./src/data/abilities/SimpleChannelAbility.js","webpack://sleepy/./src/data/abilities/Ability.js","webpack://sleepy/./src/data/abilities/spells/BlinkAbility.js","webpack://sleepy/./src/utils/cursor/SimpleCursorRenderer.js","webpack://sleepy/./src/data/abilities/spells/CrimsonWellAbility.js","webpack://sleepy/./src/data/abilities/SimpleDurationAbility.js","webpack://sleepy/./src/data/abilities/stances/RageAbility.js","webpack://sleepy/./src/data/abilities/SimpleToggledAbility.js","webpack://sleepy/./src/data/abilities/stances/SprintAbility.js","webpack://sleepy/./src/data/abilities/stunts/JumpAbility.js","webpack://sleepy/./src/ecs/components/BitmaskGlyph.js","webpack://sleepy/./src/data/bitmasks.js","webpack://sleepy/./src/ecs/components/Level.js","webpack://sleepy/./src/ecs/components/Skills.js","webpack://sleepy/./src/ecs/components/Compressable.js","webpack://sleepy/./src/ecs/components/Mass.js","webpack://sleepy/./src/ecs/components/HealthShard.js","webpack://sleepy/./src/ecs/components/HealthShardDropper.js","webpack://sleepy/./src/ecs/components/HealthShardConsumer.js","webpack://sleepy/./src/systems/System.js","webpack://sleepy/./src/systems/RenderSystem.js","webpack://sleepy/./src/systems/UISystem.js","webpack://sleepy/./src/core/input/MouseManager.js","webpack://sleepy/./src/core/input/CommandManager.js","webpack://sleepy/./src/core/input/InputDomainType.js","webpack://sleepy/./src/core/input/commands.js","webpack://sleepy/./src/core/input/InputCommand.js","webpack://sleepy/./src/core/input/InputCommandType.js","webpack://sleepy/./src/core/input/KeyCodes.js","webpack://sleepy/./src/core/screens/ScreenManager.js","webpack://sleepy/./src/core/screens/screens/AdventureScreen.js","webpack://sleepy/./src/core/screens/screens/Screen.js","webpack://sleepy/./src/core/screens/screens/MainMenuScreen.js","webpack://sleepy/./src/enums/UIGlyphs.js","webpack://sleepy/./src/utils/UIWindowUtil.js","webpack://sleepy/./src/core/screens/screens/DeathScreen.js","webpack://sleepy/./src/core/screens/screens/InventoryScreen.js","webpack://sleepy/./src/utils/SelectableList.js","webpack://sleepy/./src/core/screens/screens/InteractModalScreen.js","webpack://sleepy/./src/core/screens/screens/CursorScreen.js","webpack://sleepy/./src/utils/UITags.js","webpack://sleepy/./src/core/screens/screens/LoadAreaScreen.js","webpack://sleepy/./src/core/screens/screens/EquipmentScreen.js","webpack://sleepy/./src/core/screens/screens/ListSelectionScreen.js","webpack://sleepy/./src/core/screens/screens/CharacterScreen.js","webpack://sleepy/./src/utils/StringUtil.js","webpack://sleepy/./src/core/screens/screens/AbilityScreen.js","webpack://sleepy/./src/core/screens/screens/ConfirmationScreen.js","webpack://sleepy/./src/core/screens/screens/WaitScreen.js","webpack://sleepy/./src/core/screens/screens/ChannelScreen.js","webpack://sleepy/./src/core/PlayerManager.js","webpack://sleepy/./src/ecs/index.js","webpack://sleepy/./src/core/GameStateManager.js","webpack://sleepy/./src/core/ClockManager.js","webpack://sleepy/./src/core/MapManager.js","webpack://sleepy/./src/utils/FastMap.js","webpack://sleepy/./src/systems/FOVSystem.js","webpack://sleepy/./node_modules/rot-js/lib/index.js","webpack://sleepy/./node_modules/rot-js/lib/rng.js","webpack://sleepy/./node_modules/rot-js/lib/display/display.js","webpack://sleepy/./node_modules/rot-js/lib/display/hex.js","webpack://sleepy/./node_modules/rot-js/lib/display/canvas.js","webpack://sleepy/./node_modules/rot-js/lib/display/backend.js","webpack://sleepy/./node_modules/rot-js/lib/display/rect.js","webpack://sleepy/./node_modules/rot-js/lib/display/tile.js","webpack://sleepy/./node_modules/rot-js/lib/display/tile-gl.js","webpack://sleepy/./node_modules/rot-js/lib/color.js","webpack://sleepy/./node_modules/rot-js/lib/display/term.js","webpack://sleepy/./node_modules/rot-js/lib/text.js","webpack://sleepy/./node_modules/rot-js/lib/constants.js","webpack://sleepy/./node_modules/rot-js/lib/stringgenerator.js","webpack://sleepy/./node_modules/rot-js/lib/eventqueue.js","webpack://sleepy/./node_modules/rot-js/lib/MinHeap.js","webpack://sleepy/./node_modules/rot-js/lib/scheduler/index.js","webpack://sleepy/./node_modules/rot-js/lib/scheduler/simple.js","webpack://sleepy/./node_modules/rot-js/lib/scheduler/scheduler.js","webpack://sleepy/./node_modules/rot-js/lib/scheduler/speed.js","webpack://sleepy/./node_modules/rot-js/lib/scheduler/action.js","webpack://sleepy/./node_modules/rot-js/lib/fov/index.js","webpack://sleepy/./node_modules/rot-js/lib/fov/discrete-shadowcasting.js","webpack://sleepy/./node_modules/rot-js/lib/fov/fov.js","webpack://sleepy/./node_modules/rot-js/lib/fov/precise-shadowcasting.js","webpack://sleepy/./node_modules/rot-js/lib/fov/recursive-shadowcasting.js","webpack://sleepy/./node_modules/rot-js/lib/map/index.js","webpack://sleepy/./node_modules/rot-js/lib/map/arena.js","webpack://sleepy/./node_modules/rot-js/lib/map/map.js","webpack://sleepy/./node_modules/rot-js/lib/map/uniform.js","webpack://sleepy/./node_modules/rot-js/lib/map/dungeon.js","webpack://sleepy/./node_modules/rot-js/lib/map/features.js","webpack://sleepy/./node_modules/rot-js/lib/map/cellular.js","webpack://sleepy/./node_modules/rot-js/lib/map/digger.js","webpack://sleepy/./node_modules/rot-js/lib/map/ellermaze.js","webpack://sleepy/./node_modules/rot-js/lib/map/dividedmaze.js","webpack://sleepy/./node_modules/rot-js/lib/map/iceymaze.js","webpack://sleepy/./node_modules/rot-js/lib/map/rogue.js","webpack://sleepy/./node_modules/rot-js/lib/noise/index.js","webpack://sleepy/./node_modules/rot-js/lib/noise/simplex.js","webpack://sleepy/./node_modules/rot-js/lib/noise/noise.js","webpack://sleepy/./node_modules/rot-js/lib/path/index.js","webpack://sleepy/./node_modules/rot-js/lib/path/dijkstra.js","webpack://sleepy/./node_modules/rot-js/lib/path/path.js","webpack://sleepy/./node_modules/rot-js/lib/path/astar.js","webpack://sleepy/./node_modules/rot-js/lib/engine.js","webpack://sleepy/./node_modules/rot-js/lib/lighting.js","webpack://sleepy/./src/systems/DeathSystem.js","webpack://sleepy/./src/systems/ParticleSystem.js","webpack://sleepy/./src/core/FactionManager.js","webpack://sleepy/./src/core/CameraManager.js","webpack://sleepy/./src/systems/FPSMonitoringSystem.js","webpack://sleepy/./src/core/WorldManager.js","webpack://sleepy/./src/data/WorldData.js","webpack://sleepy/./src/data/Area.js","webpack://sleepy/./src/level/generators/generators.js","webpack://sleepy/./src/level/generators/ForestCabinsGenerator.js","webpack://sleepy/./src/level/LevelConnections.js","webpack://sleepy/./src/level/TileData.js","webpack://sleepy/./src/level/themes/TileTheme.js","webpack://sleepy/./src/level/themes/CastleTheme.js","webpack://sleepy/./src/level/themes/TileThemePopulator.js","webpack://sleepy/./src/level/themes/ForestTheme.js","webpack://sleepy/./src/level/themes/CanyonTheme.js","webpack://sleepy/./src/level/themes/CabinTheme.js","webpack://sleepy/./src/level/themes/DesertTheme.js","webpack://sleepy/./src/level/schemes/UniformScheme.js","webpack://sleepy/./src/level/TileContainer.js","webpack://sleepy/./src/level/RoomData.js","webpack://sleepy/./node_modules/nanoid/index.prod.js","webpack://sleepy/./node_modules/nanoid/url-alphabet/index.js","webpack://sleepy/./src/level/TileScheme.js","webpack://sleepy/./src/level/generators/AreaGenerator.js","webpack://sleepy/./src/level/generators/ForestGenerator.js","webpack://sleepy/./src/level/generators/ForestStrongholdGenerator.js","webpack://sleepy/./src/level/schemes/DenseCastleScheme.js","webpack://sleepy/./src/level/generators/ForestTownGenerator.js","webpack://sleepy/./src/level/schemes/ScatteredScheme.js","webpack://sleepy/./src/level/generators/GeneratorUtils.js","webpack://sleepy/./src/level/generators/CanyonGenerator.js","webpack://sleepy/./src/level/generators/DesertGenerator.js","webpack://sleepy/./src/level/schemes/SquareScheme.js","webpack://sleepy/./src/core/ConsoleManager.js","webpack://sleepy/./src/systems/DestroySystem.js","webpack://sleepy/./src/core/MusicManager.js","webpack://sleepy/./src/systems/StatusSystem.js","webpack://sleepy/./src/systems/LiquidSystem.js","webpack://sleepy/./src/systems/TrapSystem.js","webpack://sleepy/./src/systems/FireSystem.js","webpack://sleepy/./src/systems/TemperatureSystem.js","webpack://sleepy/./src/utils/ArrayUtil.js","webpack://sleepy/./src/utils/LerpUtil.js","webpack://sleepy/./src/utils/MemoryGrid.js","webpack://sleepy/./src/systems/AbilitySystem.js","webpack://sleepy/./src/systems/HealthShardSystem.js","webpack://sleepy/./src/systems/CompressionSystem.js","webpack://sleepy/./src/core/BitmaskManager.js","webpack://sleepy/./src/core/ChunkManager.js","webpack://sleepy/./src/data/Chunk.js","webpack://sleepy/./src/level/ChunkGenerator.js","webpack://sleepy/./node_modules/simplex-noise/simplex-noise.js","webpack://sleepy/webpack/bootstrap","webpack://sleepy/webpack/runtime/compat get default export","webpack://sleepy/webpack/runtime/define property getters","webpack://sleepy/webpack/runtime/global","webpack://sleepy/webpack/runtime/hasOwnProperty shorthand","webpack://sleepy/webpack/runtime/make namespace object","webpack://sleepy/webpack/startup"],"names":["leafPrototypes","getProto","loadImages","then","require","window","game","ecs","start","Howler","loadImage","img","Promise","resolve","reject","complete","addEventListener","error","imgs","Array","from","document","querySelectorAll","all","map","HowlerGlobal","this","init","prototype","self","_counter","_html5AudioPool","html5PoolSize","_codecs","_howls","_muted","_volume","_canPlayEvent","_navigator","navigator","masterGain","noAudio","usingWebAudio","autoSuspend","ctx","autoUnlock","_setup","volume","vol","parseFloat","setupAudioContext","gain","setValueAtTime","currentTime","i","length","_webAudio","ids","_getSoundIds","j","sound","_soundById","_node","mute","muted","stop","unload","close","codecs","ext","replace","state","_autoSuspend","Audio","oncanplaythrough","e","_setupCodecs","audioTest","err","canPlayType","mpegTest","checkOpera","userAgent","match","isOldOpera","parseInt","split","mp3","mpeg","opus","ogg","oga","wav","aac","caf","m4a","m4b","mp4","weba","webm","dolby","flac","_unlockAudio","_audioUnlocked","_mobileUnloaded","sampleRate","_scratchBuffer","createBuffer","unlock","audioNode","_unlocked","_releaseHtml5Audio","load","_autoResume","source","createBufferSource","buffer","connect","destination","noteOn","resume","onended","disconnect","removeEventListener","_emit","_obtainHtml5Audio","pop","testPlay","play","catch","console","warn","audio","push","suspend","_sounds","_paused","_suspendTimer","clearTimeout","setTimeout","handleSuspension","_resumeAfterSuspend","Howl","o","src","_autoplay","autoplay","_format","format","_html5","html5","_loop","loop","_pool","pool","_preload","preload","_rate","rate","_sprite","sprite","_src","undefined","_xhr","method","xhr","headers","withCredentials","_duration","_state","_endTimers","_queue","_playLock","_onend","onend","fn","_onfade","onfade","_onload","onload","_onloaderror","onloaderror","_onplayerror","onplayerror","_onpause","onpause","_onplay","onplay","_onstop","onstop","_onmute","onmute","_onvolume","onvolume","_onrate","onrate","_onseek","onseek","_onunlock","onunlock","_onresume","event","action","url","str","exec","toLowerCase","location","protocol","slice","Sound","loadBuffer","internal","id","num","_ended","_id","_inactiveSound","soundId","_loadQueue","seek","Math","max","_seek","duration","timeout","abs","setParams","_start","_stop","node","playWebAudio","_refreshBuffer","_playStart","bufferSource","noteGrainOn","Infinity","bind","once","_clearTimer","playHtml5","playbackRate","paused","loadedNoReadyState","ejecta","readyState","isCocoonJS","listener","pause","_rateSeek","_stopFade","noteOff","_cleanBuffer","isNaN","arguments","_clearSound","_interval","args","index","indexOf","apply","fade","to","len","min","end","linearRampToValueAtTime","_startFadeInterval","isGroup","diff","steps","stepLen","lastTick","Date","now","_fadeTo","setInterval","tick","round","clearInterval","cancelScheduledValues","loopStart","loopEnd","playing","realTime","rateSeek","seekAndEmit","emitSeek","sounds","_errorFn","_loadFn","_endFn","splice","remCache","cache","on","events","off","isId","keys","Object","isArray","msg","call","task","shift","ended","_drain","reset","limit","cnt","_panner","isIOS","vendor","test","howl","_parent","parent","create","createGain","createGainNode","_errorListener","_loadListener","_endListener","code","ceil","__default","loadSound","data","atob","dataView","Uint8Array","charCodeAt","decodeAudioData","XMLHttpRequest","open","responseType","forEach","key","setRequestHeader","status","response","onerror","safeXhrSend","send","arraybuffer","success","AudioContext","webkitAudioContext","iOS","platform","appVersion","version","safari","exports","global","_super","_pos","_orientation","stereo","pan","pos","x","y","z","positionX","setTargetAtTime","positionY","positionZ","setPosition","orientation","xUp","yUp","zUp","or","forwardX","forwardY","forwardZ","upX","upY","upZ","setOrientation","_stereo","_pannerAttr","coneInnerAngle","coneOuterAngle","coneOuterGain","distanceModel","maxDistance","panningModel","refDistance","rolloffFactor","_onstereo","onstereo","_onpos","onpos","_onorientation","onorientation","pannerType","createStereoPanner","setupPanner","orientationX","orientationY","orientationZ","pannerAttr","_coneInnerAngle","_coneOuterAngle","_coneOuterGain","_distanceModel","_maxDistance","_refDistance","_rolloffFactor","_panningModel","pa","panner","type","createPanner","Game","engine","constructor","ECS","music","MusicManager","mouse","MouseManager","clock","ClockManager","renderer","Renderer","GameStateManager","world","WorldManager","chunks","ChunkManager","MapManager","camera","CameraManager","factions","FactionManager","player","PlayerManager","commands","CommandManager","screens","ScreenManager","input","InputController","ConsoleManager","bitmasks","BitmaskManager","actionSystem","ActionSystem","deathSystem","DeathSystem","statusSystem","StatusSystem","FOVSystem","renderSystem","RenderSystem","UISystem","particles","ParticleSystem","fps","FPSMonitoringSystem","destroySystem","DestroySystem","liquidSystem","LiquidSystem","trapSystem","TrapSystem","fireSystem","FireSystem","temperature","TemperatureSystem","abilities","AbilitySystem","compression","CompressionSystem","healthShardSystem","HealthShardSystem","boundLoop","requestAnimationFrame","updateAdventureSystems","dt","update","playerTurn","updatePlayerSystems","render","t","Manager","display","canvas","super","spritesheets","spritesheet","name","Display","width","height","tileWidth","tileHeight","body","appendChild","resizeDisplay","zoom","setSize","draw","char","fg1","fg2","bg","tiles","getSprite","drawUI","ui","computeTextWidth","text","computeTextWidthTile","drawTextWrapping","drawText","left","right","lastSpace","nextLeft","substr","charAt","trimLeft","font","drawTextCenter","clear","clearArea","pxToTile","xPx","yPx","trunc","onNewGame","getSaveGameData","cells","Grid","suppressOOBWarn","createElement","getContext","alpha","globalCompositeOperation","textBaseline","widthPx","heightPx","style","cssText","clearAndResize","set","colorize","fillStyle","clearColor","fillRect","offsetX","cellX","cellY","filter","c","cell","pixelX","pixelY","drawImage","_width","_height","defaultValueGenerator","idx","coord","size","setAll","value","isOutOfBounds","serialize","entries","deserialize","get","getNeighbors","tileImage","getElementById","fontImage","uiImage","SpriteSheet","image","spriteWidth","spriteCountX","spriteHeight","spriteCountY","cp437","row","glyph","Sprite","sheet","sourceX","sourceY","primaryCss","secondaryCss","primary","parseColor","secondary","_cache","hasOwnProperty","pixels","getImageData","r","g","b","a","isBlack","isWhite","cvs","putImageData","colorStr","parsed","colorParse","values","cstr","m","space","parts","names","base","isRGB","trim","baseHues","join","red","R","green","G","blue","B","h","hue","H","s","saturation","S","l","lightness","L","brightness","opacity","orange","yellow","purple","module","HSLToRGB","lerpHSL","deg","lerp","sat","light","onKeydown","container","onMouseClick","onMouseMove","onMouseEnter","onMouseLeave","evt","InputKeyboardEvent","keyCode","shiftKey","ctrl","ctrlKey","alt","altKey","meta","metaKey","preventDefault","onInputEvent","offsetY","InputMouseEvent","button","updatePosition","updateMouseEnter","updateMouseLeave","InputEvent","tileX","tileY","System","createQuery","Actor","none","IsDestroying","IsDead","entities","sorted","sort","actor","energy","entity","hasEnergy","incrementTick","addEnergy","tickDelta","isIncapacitated","fireEvent","isPlayer","pushScreen","SCREEN_WAIT","time","getNextAction","SCREEN_MAIN_MENU","SCREEN_ADVENTURE","SCREEN_DEATH","SCREEN_INVENTORY","SCREEN_INTERACT_MODAL","SCREEN_CURSOR","SCREEN_LOAD_AREA","SCREEN_EQUIPMENT","SCREEN_LIST_SELECT","SCREEN_CHARACTER","SCREEN_ABILITIES","SCREEN_CONFIRM","SCREEN_CHANNEL","Component","onEnergyConsumed","reduceEnergy","onTick","camelCase","options","TypeError","pascalCase","string","isLastCharLower","isLastCharUpper","isLastLastCharUpper","character","preserveCamelCase","_","p1","camelCache","camelString","camelcaseSlow","pascalCache","Property","component","enumerable","v","onDestroyed","cleanupReference","SimpleProperty","EntityProperty","getEntity","EntityArrayProperty","Proxy","target","prop","receiver","Reflect","old","deleteProperty","proxy","ref","PropertyStrategy","Boolean","ob","properties","_onAttached","_onDetached","_onDestroyed","onAttached","onDetached","remove","destroy","clone","createComponent","_onEvent","handlerName","onEvent","_defaultPropertyValue","propertyName","_defineProxies","initialProperties","initialValue","property","PropertyFactory","ComponentRegistry","Map","register","getAccessor","typeOrClassOrComponent","_getType","_definitions","typeOrClass","definition","isMergeableObject","isNonNullObject","stringValue","isReactElement","isSpecial","REACT_ELEMENT_TYPE","Symbol","cloneUnlessOtherwiseSpecified","deepmerge","val","defaultArrayMerge","element","getKeys","getEnumerableOwnPropertySymbols","propertyIsOnObject","object","mergeObject","propertyIsUnsafe","customMerge","getMergeFunction","sourceIsArray","array","Error","prev","next","PrefabComponent","componentDef","overwrite","applyToEntity","initialProps","props","merge","Prefab","addComponent","prefabComponent","arrComps","accessor","components","initialCompProps","PrefabRegistry","registered","prefab","inherit","comps","componentData","def","_ecs","nameOrClassOrPrefab","_prefabs","nameOrClass","EntityEvent","is","handle","prevent","Entity","has","hasType","nestedComponent","add","attach","configurable","writable","allowMultiple","owns","isComponent","instance","o2","k2","v2","EntityRegistry","_entities","createOrGetById","onEntityDestroyed","cleanupRefs","refs","_refs","addRef","entityId","Set","removeRef","json","list","entityData","deserializeEntity","pascalString","d","Query","any","isMatch","hasAny","_filter","some","hasAll","every","hasNone","onEntityAdded","onEntityRemoved","candidate","isTracking","cb","_onEntityCreated","_onComponentAdded","_onComponentRemoved","_onEntityDestroyed","bustCache","QueryRegistry","filters","query","onComponentAdded","onComponentRemoved","onEntityCreated","Engine","nanoid","generateId","createEntity","createPrefab","prefabs","destroyEntity","registerPrefab","registerComponent","queries","pass","LiquidContainer","isEmpty","liquids","content","maxVolume","overridePrimary","liquid","overrideSecondary","_checkDestroyOnEmpty","destroyOnEmpty","isDestroying","pour","quantity","isPourable","spawn","SPWN_POOL_LIQUID","combineFrom","other","sum","onTryPour","interactor","position","getPos","onTryDrink","drinkLiquid","onGetInteractions","interactions","LIQUID_BLOOD","isFreeFlowing","SPWN_VIAL_HONEY","SPWN_VIAL_BLOOD","SPWN_VIAL_WATER","SPWN_STONE","SPWN_TWIG","SPWN_ASH","SPWN_GOBLIN_GRUNT","SPWN_GOBLIN_BRUISER","SPWN_GOBLIN_STARGAZER","SPWN_HUMAN_WANDERER","SPWN_PINE_TREE","SPWN_CLIFF","SPWN_WOOD_WALL","SPWN_WOOD_DOOR","SPWN_WOOD_CHEST","SPWN_STONE_WALL","SPWN_DIRT_PATH","SPWN_CORPSE","SPWN_GLASS_SHARD","SPWN_HEALTH_SHARD","SPWN_AMULET","SPWN_CLOTH_ARMOR","SPWN_LEATHER_BOOTS","SPWN_SHORTSWORD","SPWN_GREATSWORD","SPWN_BATTLE_AXE","SPWN_HATCHET","SPWN_MACE","SPWN_WOOD_CLUB","SPWN_GROUND_SAND","SPWN_GROUND_GRASS","SPWN_GROUND_GRASS_DEAD","SPWN_GROUND_STONE","SPWN_HEAVY_PLATE_ARMOR","SPWN_LEATHER_ARMOR","SPWN_CLOTH_HOOD","SPWN_WIZARD_CAP","SPWN_HELM","SPWN_SNAKE","SPWN_BEAR","SPWN_DESERT_REED","simplePrefab","prefabName","spawnables","VialHoney","VialBlood","VialWater","Grass","DeadGrass","Sand","GoblinGrunt","GoblinBruiser","GoblinStargazer","HumanWanderer","Snake","Bear","PineTree","PoolLiquid","Cliff","spawnForChunk","chunk","chunkId","setPos","createSpawnable","vial","liquidContainer","LIQUID_HONEY","LIQUID_WATER","LIQUID_OIL","colorDesc","onDrink","log","direction","glyphs","fg1s","speed","lifetime","goblin","brain","pushGoal","BoredGoalType","sword","equipmentSlot","handRight","equip","GoalType","goal","targets","killGoal","KillSomethingGoalType","SUCCESS","boredomGoal","FAILURE","originalIntent","INVALID","isDead","isDestroyed","targetPos","result","computeAStar","cost","diagonalDistance","blocker","sharpTrap","path","segment","delta","moveGoal","MoveGoalType","allowDiagonals","neighbors","defaultSettings","settings","heuristic","manhattanDistance","PriorityQueue","cameFrom","costSoFar","startKey","goalKey","costs","put","currentKey","current","nextKey","graphCost","newCost","priority","previous","previousKey","unshift","dx","dy","peek","item","createItem","handled","EatFoodGoalType","food","bruiser","club","pickRandom","arr","floor","random","randomInt","randomBool","randomWeightedBool","weight","wanderer","grass","ch","color","sand","cliff","snake","bear","Door","isOpen","chOpen","chClosed","openDoor","shadowcaster","closeDoor","Blocker","Shadowcaster","onTryCloseDoor","onTryOpenDoor","onProjectileHit","stopProjectile","deflectProjectile","isAttached","onCompressed","removeOnCompression","Loot","take","newOwner","isInventoried","isOwnedBy","owner","inventory","removeLoot","addLoot","IsInventoried","Inventory","hasLoot","onEquipped","onTryPickUp","onTryTake","onQueryOwnership","getStackable","stackableIdentifier","find","Stackable","stackable","identifier","loot","existing","addOther","dropLoot","dropper","onTryOpen","accessible","isOpenable","onTryDrop","onThrown","increment","amount","STACKABLE_DEFAULT","STACKABLE_STONE","STACKABLE_ASH","STACKABLE_GLASS_SHARD","Throwable","throw","trajectory","initiator","stopped","deflected","hit","projectile","getStat","STAT_STRENGTH","damage","die","modifier","attack","Attack","attacker","defender","weaponName","moniker","damageType","ignoreDodge","onTryThrow","range","getSkillValue","SKILL_THROWING","simpleLineRenderer","onResult","cursor","bresenhamLine","onCancel","DMG_TYPE_BLUDGEONING","SKILL_SPEED","SKILL_HEALTH","SKILL_ARMOR","SKILL_DODGE","SKILL_BRAWLING","SKILL_AXE","SKILL_BLADE","SKILL_CUDGEL","lookup","ArmorSkill","HealthSkill","SpeedSkill","ThrowingSkill","DodgeSkill","BrawlingSkill","AxeSkill","BladeSkill","CudgelSkill","getSkill","getSkillName","compute","getSkillsByStat","stat","baseStat","getSkillEquippedMod","modifiers","skill","getAllSkillEquippedMods","reduce","mods","getAllSkillEquippedModSums","mod","getArmorBlockPercent","getArmorBlockPercentDisplay","prcnt","Skill","getModifiers","getModifierSum","cur","STAT_FINESSE","STAT_ATHLETICISM","STAT_TRICKERY","STAT_FAITH","abbreviation","getStatName","getStatAbbreviation","stats","rollStat","statCheck","getSpeedPercent","getSpeedPercentDisplay","getDodgePercent","unscaled","DMG_TYPE_PIERCING","DMG_TYPE_SLASHING","DMG_TYPE_NECROTIC","verb","getDmgTypeName","getDmgTypeVerb","x0","y0","x1","y1","sx","sy","e2","bresenhamLineExclusive","line","truthy","isValid","opts","screen","FragileGlass","shatter","CONSOLE_EVENT_SHATTER","onCollideGround","onCollide","CONSOLE_EVENT_DAMAGE","CONSOLE_EVENT_DEAD","CONSOLE_EVENT_MISS","CONSOLE_EVENT_BLOCK","CONSOLE_EVENT_TRAP_SHARP","CONSOLE_EVENT_LEVEL","getMonikerSubject","Moniker","simpleDisplay","getMonikerIndirectObject","mapping","message","level","shouldAppear","isVisible","dodgePrcnt","dmgVerb","dmg","blocked","blockText","trap","getMessage","Brain","goals","onTakeAction","peekGoal","isFinished","popGoal","currentGoal","takeAction","removeGoal","goalsToDestroy","isSelf","isSiblingGoal","Body","onDeath","corpse","corpseSpawnable","Goal","GoalEvaluator","goalTypeMap","GoalTypes","goalType","getGoalType","disp","door","Logger","onLog","Position","equals","Glyph","col","primaryColorOverride","secondaryColorOverride","Motor","onTryMove","targetX","targetY","targetTileEntities","nonHostile","factionMember","IsPlayer","Wandering","onBoredom","directionDelta","directions","shortName","fullName","adjacent","DIR_NW","DIR_N","DIR_NE","DIR_W","DIR_Z","DIR_E","DIR_SW","DIR_S","DIR_SE","allDirections","getAdjacentDeltas","directionFromDelta","dir","IsVisible","Explorable","Explored","Health","onSpawned","applyDamage","onAttacked","dodge","isDodged","isKilled","armor","armorPrcnt","enemy","onHeal","FactionMember","getFactionByName","FACTION_PLAYER","FACTION_VILLAGER","FACTION_GOBLIN","FACTION_BEAR","FACTION_SERPENT","Faction","villager","serpent","Eyes","canSee","onTryDetectHostiles","Particle","age","frame","percent","fg2s","bgs","startX","startY","ParticleEmitter","createParticle","particle","particleData","count","LootDropper","spawnLoot","tables","TBL_LOOT_GOBLIN","LootTableGoblin","TBL_LOOT_FOREST","LootTableForest","TBL_LOOT_BRUISER","LootTableBruiser","getTable","tableKey","pickLoot","tableKeys","WeightedTable","pick","spawnable","rows","currentW","chance","maxWeight","table","goblins","forest","IsEquipped","slotKey","onDropped","slot","unequip","Equipment","onTryEquip","slots","slotTypes","includes","slotType","header","icon","leadText","onRenderRow","isSelected","onSelect","onTryUnequip","isEquipped","EQ_SLOT_BODY","EQ_SLOT_HEAD","EQ_SLOT_FACE","EQ_SLOT_NECK","EQ_SLOT_FEET","EQ_SLOT_ARM","EQ_SLOT_HAND","EQ_SLOT_TAIL","EquipmentSlot","equipment","doMeleeAttack","defaultWpnType","getWeaponType","doOffhandAttack","offhandAttack","onTryMelee","selfPos","isPrimary","onQuerySkillMod","WPN_TYPE_WAR_HAMMER","WPN_TYPE_SLEDGE_HAMMER","WPN_TYPE_CLUB","WPN_TYPE_MACE","WPN_TYPE_HEAVY_AXE","WPN_TYPE_BATTLE_AXE","WPN_TYPE_GREATSWORD","WPN_TYPE_SHORTSWORD","WPN_TYPE_DAGGER","WPN_TYPE_STAFF","WPN_TYPE_HALBERD","WPN_TYPE_JAVELIN","WPN_TYPE_UNARMED","WPN_TYPE_FANGS","WPN_TYPE_CLAW","WpnTypeUnarmed","WpnTypeFangs","WpnTypeClaw","family","WPN_FAMILY_HAMMER","WPN_FAMILY_AXE","WpnTypeBattleAxe","WpnTypeGreatsword","WpnTypeShortsword","WpnTypeMace","WPN_FAMILY_BLADE","WPN_FAMILY_POLEARM","getWeaponTypeName","getWeaponTypeFamily","getWeaponTypeDmgType","WPN_FAMILY_ARCHERY","WPN_FAMILY_UNARMED","WPN_FAMILY_CUDGEL","getWeaponFamilyName","WeaponType","_createAttack","weapon","roll","attacks","secondAttack","weaponDamageText","user","getShortDescription","fam","getAttacks","_getNeighborAttacks","attackerPos","defenderPos","deltaX","deltaY","flat","hostile","_tryAttackDefender","addStatus","STATUS_STUNNED","STATUS_BLEEDING","STATUS_REGENERATION","StatusBleeding","StatusStunned","StatusRegeneration","getStatus","Status","STATUS_TYPE_CONDITION","isDot","getDmgPerTurn","potency","getPipCount","ticks","remainingLifetime","health","STATUS_TYPE_BOON","IsIncapacitated","isCompleted","brawling","Stats","_sumMods","getStatModifiers","getStatModifierSum","capitalize","modSum","strength","finesse","athleticism","trickery","faith","baseStrength","baseFinesse","baseAthleticism","baseTrickery","baseFaith","n","clamp","toUpperCase","substring","template","group1","group2","obj","replaced","first","Race","getRaceData","getModifier","onQueryStatMod","RACE_HUMAN","RACE_GOBLIN","RACE_SNAKE","RACE_BEAR","RaceData","Weapon","weaponType","onTryUseMelee","onTryUseMeleeOffhand","Ground","SharpTrap","challenge","EquippedSkillMod","onQuerySkillModEquipped","Combustible","fire","fuel","getTemperature","setTemperature","getDieOutChance","getSparkChance","getCatchChance","intensity","onSpark","isOnFire","Fire","flashPoint","onTryIgnite","spawnableRemains","burnRate","extinguish","onTryExtinguish","ThermalCapacity","Abilities","onQueryAbilities","known","AbilityStatus","getAbility","isCoolingDown","cooldownDuration","currentCooldownDuration","currentDuration","currentChannelDuration","channelDuration","ability","isToggleable","isToggledOn","startCooldown","isComplete","skillMods","statMods","ABILITY_SPRINT","ABILITY_RAGE","ABILITY_CRIMSON_WELL","ABILITY_BLINK","ABILITY_JUMP","ABILITY_PRAYER_PROTECTION","SprintAbility","RageAbility","CrimsonWellAbility","BlinkAbility","JumpAbility","PrayerOfProtectionAbility","getAbilityStatus","abilityStatus","getStance","isStance","getChanneling","isChanneled","isChanneling","SimpleChannelAbility","ABILITY_TYPE_PRAYER","getCooldownDuration","getChannelDuration","getArmorModifier","getDescription","getSkillMods","onChannelComplete","createEmitter","ABILITY_TYPE_STANCE","ABILITY_TYPE_SHOUT","ABILITY_TYPE_STUNT","ABILITY_TYPE_SPELL","getAbilityTypeName","Ability","getDuration","execute","getStatMods","initiate","onConfirm","toggleOn","toggleOff","channel","cancelChannel","isCooldownComplete","getDisplayText","cd","remainingCooldownDuration","toFixed","isEnabled","simpleCursorRenderer","visible","prevPos","nextPos","SimpleDurationAbility","performLifeteal","enemyPos","SimpleToggledAbility","computeStrengthMod","computeSpeedMod","getJumpDistance","distance","word","BitmaskGlyph","BITMASK_WALL","updateGlyph","getMaskGlyph","mask","Level","levelUp","skillPoints","addXP","xp","nextLevelReq","onEnemyKilled","levelFactor","Skills","Compressable","compressedCh","massRequirement","isCompressed","Mass","HealthShard","SHARD_VAL_LARGE","SHARD_VAL_MEDIUM","SHARD_VAL_SMALL","HealthShardDropper","lvlDiff","emptyCells","shardCount","shardPos","shardValue","healthShard","HealthShardConsumer","modeLookup","background","explored","worldX","worldY","temp","rgb","sqrt","temperatureGradient","renderTile","screenToWorld","isInView","getEntitiesAt","renderableZ","renderable","mode","beingsQuery","renderNearbyCreatures","beings","glyphOffset","relation","getEntityRelation","getAttitudeGlyph","statusOffset","dotLevel","statusType","barWidth","healthWidth","middle","primaryHP","secondaryHp","showTicks","turn","subTurn","padEnd","chunkCoordinate","INPUT_DOMAIN_DEFAULT","cmd","registerCommand","_inputStack","getNextCommand","getCommandForInputEvent","pushDomain","domain","_domainStack","popDomain","lastIndexOf","getDomainCommands","_commands","matches","command","INPUT_DOMAIN_MAIN_MENU","INPUT_DOMAIN_ADVENTURE","INPUT_DOMAIN_LOOK","INPUT_DOMAIN_LIST","isKeyboard","InputCommand","INPUT_CMD_CONFIRM","KEY_ENTER","KEY_SPACE","INPUT_CMD_CANCEL","KEY_ESCAPE","INPUT_CMD_SAVE","KEY_S","INPUT_CMD_LOAD","KEY_L","INPUT_CMD_NEW_GAME","KEY_N","INPUT_CMD_WAIT","INPUT_CMD_MOVE_NW","KEY_Q","INPUT_CMD_MOVE_N","KEY_W","KEY_UP","INPUT_CMD_MOVE_NE","KEY_E","INPUT_CMD_MOVE_W","KEY_A","KEY_LEFT","INPUT_CMD_MOVE_E","KEY_D","KEY_RIGHT","INPUT_CMD_MOVE_SW","KEY_Z","INPUT_CMD_MOVE_S","KEY_X","KEY_DOWN","INPUT_CMD_MOVE_SE","KEY_C","INPUT_CMD_SELECT_NW","INPUT_CMD_SELECT_N","INPUT_CMD_SELECT_NE","INPUT_CMD_SELECT_W","INPUT_CMD_SELECT_E","INPUT_CMD_SELECT_SW","INPUT_CMD_SELECT_S","INPUT_CMD_SELECT_SE","INPUT_CMD_INTERACT","INPUT_CMD_LOOK","INPUT_CMD_PICK_UP","KEY_G","KEY_J","INPUT_CMD_INVENTORY","KEY_I","INPUT_CMD_EQUIPMENT","KEY_O","INPUT_CMD_CHARACTER","KEY_P","INPUT_CMD_ABILITIES","KEY_T","inputEvent","KEY_CANCEL","KEY_HELP","KEY_BACK_SPACE","KEY_TAB","KEY_CLEAR","KEY_ENTER_SPECIAL","KEY_SHIFT","KEY_CONTROL","KEY_ALT","KEY_PAUSE","KEY_CAPS_LOCK","KEY_KANA","KEY_EISU","KEY_JUNJA","KEY_FINAL","KEY_HANJA","KEY_CONVERT","KEY_NONCONVERT","KEY_ACCEPT","KEY_MODECHANGE","KEY_PAGE_UP","KEY_PAGE_DOWN","KEY_END","KEY_HOME","KEY_SELECT","KEY_PRINT","KEY_EXECUTE","KEY_PRINTSCREEN","KEY_INSERT","KEY_DELETE","KEY_NUM_0","KEY_NUM_1","KEY_NUM_2","KEY_NUM_3","KEY_NUM_4","KEY_NUM_5","KEY_NUM_6","KEY_NUM_7","KEY_NUM_8","KEY_NUM_9","KEY_COLON","KEY_SEMICOLON","KEY_LESS_THAN","KEY_EQUALS","KEY_GREATER_THAN","KEY_QUESTION_MARK","KEY_AT","KEY_B","KEY_F","KEY_H","KEY_K","KEY_M","KEY_R","KEY_U","KEY_V","KEY_Y","KEY_META","KEY_CONTEXT_MENU","KEY_SLEEP","KEY_NUMPAD_0","KEY_NUMPAD_1","KEY_NUMPAD_2","KEY_NUMPAD_3","KEY_NUMPAD_4","KEY_NUMPAD_5","KEY_NUMPAD_6","KEY_NUMPAD_7","KEY_NUMPAD_8","KEY_NUMPAD_9","KEY_MULTIPLY","KEY_ADD","KEY_SEPARATOR","KEY_SUBTRACT","KEY_DECIMAL","KEY_DIVIDE","KEY_F1","KEY_F2","KEY_F3","KEY_F4","KEY_F5","KEY_F6","KEY_F7","KEY_F8","KEY_F9","KEY_F10","KEY_F11","KEY_F12","KEY_F13","KEY_F14","KEY_F15","KEY_F16","KEY_F17","KEY_F18","KEY_F19","KEY_F20","KEY_F21","KEY_F22","KEY_F23","KEY_F24","KEY_NUM_LOCK","KEY_SCROLL_LOCK","KEY_WIN_OEM_FJ_JISHO","KEY_WIN_OEM_FJ_MASSHOU","KEY_WIN_OEM_FJ_TOUROKU","KEY_WIN_OEM_FJ_LOYA","KEY_WIN_OEM_FJ_ROYA","KEY_CIRCUMFLEX","KEY_EXCLAMATION","KEY_DOUBLE_QUOTE","KEY_HASH","KEY_DOLLAR","KEY_PERCENT","KEY_AMPERSAND","KEY_UNDERSCORE","KEY_OPEN_PAREN","KEY_CLOSE_PAREN","KEY_ASTERISK","KEY_PLUS","KEY_PIPE","KEY_HYPHEN_MINUS","KEY_OPEN_CURLY_BRACKET","KEY_CLOSE_CURLY_BRACKET","KEY_TILDE","KEY_VOLUME_MUTE","KEY_VOLUME_DOWN","KEY_VOLUME_UP","KEY_SEMICOLON_2","KEY_EQUALS_2","KEY_COMMA","KEY_MINUS","KEY_PERIOD","KEY_SLASH","KEY_BACK_QUOTE","KEY_OPEN_BRACKET","KEY_BACK_SLASH","KEY_CLOSE_BRACKET","KEY_QUOTE","KEY_META_2","KEY_ALTGR","KEY_WIN_ICO_HELP","KEY_WIN_ICO_00","KEY_WIN_ICO_CLEAR","KEY_WIN_OEM_RESET","KEY_WIN_OEM_JUMP","KEY_WIN_OEM_PA1","KEY_WIN_OEM_PA2","KEY_WIN_OEM_PA3","KEY_WIN_OEM_WSCTRL","KEY_WIN_OEM_CUSEL","KEY_WIN_OEM_ATTN","KEY_WIN_OEM_FINISH","KEY_WIN_OEM_COPY","KEY_WIN_OEM_AUTO","KEY_WIN_OEM_ENLW","KEY_WIN_OEM_BACKTAB","KEY_ATTN","KEY_CRSEL","KEY_EXSEL","KEY_EREOF","KEY_PLAY","KEY_ZOOM","KEY_PA1","KEY_WIN_OEM_CLEAR","MainMenuScreen","AdventureScreen","DeathScreen","InventoryScreen","InteractModalScreen","CursorScreen","LoadAreaScreen","EquipmentScreen","ListSelectionScreen","CharacterScreen","AbilityScreen","ConfirmationScreen","WaitScreen","ChannelScreen","setScreen","screenType","onLeave","onEnter","screenCtx","replaceScreen","popScreen","onUpdate","Screen","computeFOV","setFocus","onDirectionInput","playerPosition","targetPosition","hostileEntities","areEntitiesHostile","melee","doorEntity","move","onPickUpCommand","lootable","onInteract","items","interactable","onInteractDirection","handleInput","saveGame","loadGame","drawTags","drawFaction","drawTemperature","wait","isStarted","newGame","inputCommand","UI_GLYPH_BORDER_TERM_L","UI_BORDER_FG1","UI_BORDER_FG2","UI_GLYPH_BORDER_TERM_R","UI_GLYPH_BORDER_T","UI_GLYPH_BORDER_TL","UI_GLYPH_BORDER_TR","UI_GLYPH_BORDER_L","UI_GLYPH_BORDER_R","UI_GLYPH_BORDER_BL","UI_GLYPH_BORDER_B","UI_GLYPH_BORDER_BR","drawUIBox","drawUIWindow","title","titleText","titleWidth","titleOffset","iconWidth","gameOver","SelectableList","setItems","selectItem","selected","up","down","ypos","textLen","_items","_idx","refreshList","isBack","interaction","top","listPadding","xpos","weaponDmg","hasMod","NOOP","getOpts","worldToScreen","faction","getDisplay","tmpC","tmpF","prevousArea","nextArea","renderLoadingText","areaId","entry","loadGameData","onAreaLoaded","prevText","nextText","selectSlot","onGetRowName","defaultRowRender","cancel","yOffset","skills","back","renderSkills","posY","selector","nextLevelReqXp","healthMax","skillPointColor","modDir","PADDING_RIGHT","PADDING_HEIGHT","stance","xOffset","description","textW","confirmText","cancelText","onSelection","toggleSelection","option","confirm","bottom","textWidth","curTime","renderChanneling","center","maxLength","fract","getSetupData","serialized","setup","owned","teardown","actionQueue","turns","idGenerator","destroyEntities","cloneEntity","stringify","JSON","parse","initiateTeardown","initiateSetup","prompt","filename","deleteFile","localStorage","setItem","file","startsWith","removeItem","saveChunkPositionData","loadChunkPositionData","getItem","saveChunkEntityData","loadChunkEntityData","saveAreaPositionData","positionData","saveAreaTemperatureData","temperatureData","saveAreaEntityData","loadAreaEntityData","loadAreaPositionData","loadAreaTemperatureData","loadSavefileData","prevTurn","curTurn","chunkCountX","chunkWidth","chunkCountY","chunkHeight","getRandomEmptyPosition","area","getPosition","includeGround","isAdjacent","x2","y2","getEntitiesInRect","getEntitiesInRange","diameter","getNeighborEntities","isOutOfbounds","onPlayerOutOfBounds","enterArea","northArea","southArea","eastArea","westArea","FastMap","_data","getValues","_idHash","delete","fov","FOV","isSquareVisible","setVisible","explorable","bitmaskGlyph","refreshMaskAndNeighbors","visibility","Util","util","Color","Text","FRAC","RNG","_seed","_s0","_s1","_s2","_c","getSeed","setSeed","seed","getUniform","getUniformInt","lowerBound","upperBound","getNormal","mean","stddev","u","getPercentage","shuffle","getWeightedValue","total","part","getState","setState","BACKENDS","Hex","Rect","Tile","TileGL","Term","DEFAULT_OPTIONS","DEFAULT_WIDTH","DEFAULT_HEIGHT","transpose","layout","fontSize","spacing","border","forceSquareRatio","fontFamily","fontStyle","fg","tileMap","tileSet","tileColorize","_dirty","_options","assign","setOptions","DEBUG","_tick","_backend","schedule","what","colors","ctor","getOptions","getContainer","computeSize","availWidth","availHeight","computeFontSize","computeTileSize","eventToPosition","touches","clientX","clientY","maxWidth","cx","cy","lines","tokens","token","isSpace","isPrevSpace","isFullWidth","isPrevFullWidth","cc","cch","_draw","clearBefore","Canvas","_spacingX","_spacingY","_hexSize","px","reverse","_ctx","_fill","chars","concat","fillText","hexSizeWidth","hexSizeHeight","hexSize","oldFont","measureText","ratio","_normalizedEventToPosition","nodeSize","beginPath","moveTo","lineTo","fill","_updateSize","charWidth","xprop","yprop","Backend","textAlign","rect","getBoundingClientRect","_canvasCache","_drawWithCache","_drawNoCache","hash","boxWidth","boxHeight","widthFraction","_colorCanvas","clearRect","fgs","tile","context","_uniforms","_gl","_initWebGL","alert","preserveDrawingBuffer","_updateTexture","gl","scissorY","scissor","COLOR_BUFFER_BIT","uniform2fv","uniform1f","uniform4fv","drawArrays","TRIANGLE_STRIP","program","vss","fss","vs","createShader","VERTEX_SHADER","shaderSource","compileShader","getShaderParameter","COMPILE_STATUS","getShaderInfoLog","fs","FRAGMENT_SHADER","p","createProgram","attachShader","linkProgram","getProgramParameter","LINK_STATUS","getProgramInfoLog","VS","FS","useProgram","Float32Array","buf","bindBuffer","ARRAY_BUFFER","bufferData","STATIC_DRAW","enableVertexAttribArray","vertexAttribPointer","FLOAT","createQuad","UNIFORMS","getUniformLocation","_program","enable","BLEND","blendFuncSeparate","SRC_ALPHA","ONE_MINUS_SRC_ALPHA","ONE","SCISSOR_TEST","canvasSize","viewport","createTexture","bindTexture","TEXTURE_2D","texParameteri","TEXTURE_MAG_FILTER","NEAREST","TEXTURE_MIN_FILTER","TEXTURE_WRAP_S","REPEAT","TEXTURE_WRAP_T","pixelStorei","UNPACK_FLIP_Y_WEBGL","texImage2D","RGBA","UNSIGNED_BYTE","colorCache","Number","$","fromString","cached","CACHE","color1","add_","multiply","multiply_","interpolate","color2","factor","interpolateHSL","hsl1","rgb2hsl","hsl2","hsl2rgb","randomize","hue2rgb","q","toRGB","clamped","toHex","toString","padStart","termcolor","DST_COLORS","_offset","_cursor","_lastColor","avail","process","stdout","write","positionToAnsi","newColor","colorToAnsi","columns","RE_COLORS","TYPE_TEXT","TYPE_NEWLINE","TYPE_FG","TYPE_BG","measure","tokenize","lineWidth","offset","lineLength","lastTokenWithSpace","breakInsideToken","nextIndex","breakIndex","lastTextToken","breakLines","tokenIndex","removeBreakChar","newBreakToken","newTextToken","DIRS","4","8","6","KEYS","VK_CANCEL","VK_HELP","VK_BACK_SPACE","VK_TAB","VK_CLEAR","VK_RETURN","VK_ENTER","VK_SHIFT","VK_CONTROL","VK_ALT","VK_PAUSE","VK_CAPS_LOCK","VK_ESCAPE","VK_SPACE","VK_PAGE_UP","VK_PAGE_DOWN","VK_END","VK_HOME","VK_LEFT","VK_UP","VK_RIGHT","VK_DOWN","VK_PRINTSCREEN","VK_INSERT","VK_DELETE","VK_0","VK_1","VK_2","VK_3","VK_4","VK_5","VK_6","VK_7","VK_8","VK_9","VK_COLON","VK_SEMICOLON","VK_LESS_THAN","VK_EQUALS","VK_GREATER_THAN","VK_QUESTION_MARK","VK_AT","VK_A","VK_B","VK_C","VK_D","VK_E","VK_F","VK_G","VK_H","VK_I","VK_J","VK_K","VK_L","VK_M","VK_N","VK_O","VK_P","VK_Q","VK_R","VK_S","VK_T","VK_U","VK_V","VK_W","VK_X","VK_Y","VK_Z","VK_CONTEXT_MENU","VK_NUMPAD0","VK_NUMPAD1","VK_NUMPAD2","VK_NUMPAD3","VK_NUMPAD4","VK_NUMPAD5","VK_NUMPAD6","VK_NUMPAD7","VK_NUMPAD8","VK_NUMPAD9","VK_MULTIPLY","VK_ADD","VK_SEPARATOR","VK_SUBTRACT","VK_DECIMAL","VK_DIVIDE","VK_F1","VK_F2","VK_F3","VK_F4","VK_F5","VK_F6","VK_F7","VK_F8","VK_F9","VK_F10","VK_F11","VK_F12","VK_F13","VK_F14","VK_F15","VK_F16","VK_F17","VK_F18","VK_F19","VK_F20","VK_F21","VK_F22","VK_F23","VK_F24","VK_NUM_LOCK","VK_SCROLL_LOCK","VK_CIRCUMFLEX","VK_EXCLAMATION","VK_DOUBLE_QUOTE","VK_HASH","VK_DOLLAR","VK_PERCENT","VK_AMPERSAND","VK_UNDERSCORE","VK_OPEN_PAREN","VK_CLOSE_PAREN","VK_ASTERISK","VK_PLUS","VK_PIPE","VK_HYPHEN_MINUS","VK_OPEN_CURLY_BRACKET","VK_CLOSE_CURLY_BRACKET","VK_TILDE","VK_COMMA","VK_PERIOD","VK_SLASH","VK_BACK_QUOTE","VK_OPEN_BRACKET","VK_BACK_SLASH","VK_CLOSE_BRACKET","VK_QUOTE","VK_META","VK_ALTGR","VK_WIN","VK_KANA","VK_HANGUL","VK_EISU","VK_JUNJA","VK_FINAL","VK_HANJA","VK_KANJI","VK_CONVERT","VK_NONCONVERT","VK_ACCEPT","VK_MODECHANGE","VK_SELECT","VK_PRINT","VK_EXECUTE","VK_SLEEP","StringGenerator","words","order","prior","_boundary","String","fromCharCode","_suffix","_prefix","_priorValues","generate","_sample","_join","observe","_split","subcontext","_observeEvent","getStats","priorCount","dataCount","eventCount","_backoff","available","EventQueue","_time","_events","MinHeap","getTime","getEventTime","heap","timestamp","lessThan","loc","updateUp","updateDown","last","parentNode","leftChildNode","rightChildNode","existNode","swap","minNode","numbers","validnumbers","minimal","leftChild","rightChild","debugPrint","Simple","Speed","Action","Scheduler","repeat","_current","_repeat","getTimeOf","getSpeed","_defaultDuration","setDuration","DiscreteShadowcasting","PreciseShadowcasting","RecursiveShadowcasting","callback","_lightPasses","A","blocks","DATA","_getCircle","angle","_visibleCoords","v1","lightPassesCallback","topology","dirs","countFactor","startOffset","A1","A2","SHADOWS","neighborCount","_checkVisibility","index1","edge1","index2","edge2","visibleLength","P","P1","P2","OCTANTS","_renderOctant","compute180","previousOctant","nextPreviousOctant","nextOctant","compute90","octant","_castVisibility","visSlopeStart","visSlopeEnd","radius","xx","xy","yx","yy","newStart","mapX","mapY","slopeStart","slopeEnd","Arena","Uniform","Cellular","Digger","EllerMaze","DividedMaze","IceyMaze","Rogue","w","_fillMap","Dungeon","roomWidth","roomHeight","roomDugPercentage","timeLimit","_map","_dug","_roomAttempts","_corridorAttempts","_connected","_unconnected","_digCallback","_canBeDugCallback","_isWallCallback","t1","_rooms","_generateRooms","_generateCorridors","room","_generateRoom","Room","_corridors","clearDoors","connected","room1","_closestRoom","room2","_connectRooms","rooms","dist","getCenter","dirIndex1","dirIndex2","center1","center2","diffX","diffY","getLeft","getRight","getTop","getBottom","_placeInWall","_digLine","rotation","mid","mid1","mid2","addDoor","dirIndex","lastBadIndex","points","corridor","Corridor","getRooms","getCorridors","Feature","doorX","doorY","_x1","_y1","_x2","_y2","_doors","getDoors","addDoors","isWallCallback","debug","canBeDugCallback","digCallback","endX","endY","_startX","_startY","_endX","_endY","_endsWithAWall","corridorLength","nx","ny","ok","firstCornerBad","secondCornerBad","createPriorityWalls","priorityWallCallback","born","survive","_dirs","probability","newMap","widthStep","widthStart","ncount","_getNeighbors","_serviceCallback","connectionCallback","allFreeSpace","notConnected","widthStarts","_freeSpace","_pointKey","_findConnected","_getFromTo","local","_tunnelToConnected6","_tunnelToConnected","k","pp","connectedKeys","notConnectedKeys","_getClosest","point","minPoint","minDist","stack","keepNotConnected","tests","pkey","stepWidth","FEATURES","dugPercentage","_features","_featureAttempts","_walls","_priorityWallCallback","_firstRoom","priorityWalls","wall","_findWall","_getDiggingDirection","featureAttempts","_tryFeature","_removeSurroundingWalls","_addDoors","prio1","prio2","featureName","feature","createRandomAt","deltas","addToList","removeFromList","_stack","_process","_partitionRoom","availX","availY","walls","solid","hole","regularity","_regularity","done","_randomize","_isFree","connectedCells","cellWidth","cellHeight","_calculateRoomSize","_initRooms","_connectUnconnectedRooms","_createRandomRoomConnections","_createRooms","_createCorridors","ncgx","ncgy","otherRoom","dirToCheck","cgx","cgy","found","validRoom","cw","dirIdx","newI","newJ","roomw","roomh","cwp","chp","sxOffset","syOffset","ii","jj","_getWallPosition","aRoom","aDirection","rx","ry","_drawCorridor","startPosition","endPosition","tempDist","xDir","yDir","moves","xAbs","yAbs","firstHalf","secondHalf","connection","otherWall","Simplex","F2","G2","Noise","gradients","_gradients","permutations","_perms","_indexes","xin","yin","gi","i1","j1","perms","indexes","n0","n1","n2","t0","grad","t2","Dijkstra","AStar","Path","toX","toY","passableCallback","_computed","_todo","_add","fromX","fromY","_compute","neighbor","_toX","_toY","_passableCallback","_done","_fromX","_fromY","_distance","f","itemF","scheduler","_scheduler","_lock","lock","act","Lighting","reflectivityCallback","_reflectivityCallback","passes","emissionThreshold","_lights","_reflectivityCache","_fovCache","setFOV","_fov","setLight","clearLights","lightingCallback","doneCells","emittingCells","litCells","_emitLight","_computeEmitters","litKey","_emitLightFromCell","reflectivity","emission","_updateFOV","fovKey","formFactor","key1","vis","emitterData","emitter","particleEmitter","isExpired","targetCount","setRelation","getFactionById","isHostile","factionA","factionB","_relationKey","idA","idB","relations","getRelation","entityA","entityB","memberA","memberB","onWindowResize","topLeftWorldX","topLeftWorldY","clampX","innerWidth","renderedTileWidth","clampY","innerHeight","renderedTileHeight","padding","_focusX","_focusY","setZoom","setPadding","getScreenRect","fpsElement","getElementsByClassName","frames","frameCount","innerText","getArea","WorldData","getStartingArea","exploredAreaIds","Area","getAreaByCoord","getExits","exits","connectionsNorth","connectionsWest","generator","getGenerator","populate","ForestGenerator","ForestStrongholdGenerator","ForestCabinsGenerator","ForestTownGenerator","CanyonGenerator","DesertGenerator","AreaGenerator","UniformScheme","theme","TILE_THEME_FOREST","mediumRooms","TILE_THEME_CABIN","includeWalls","distancedRooms","getUnassignedTiles","digExits","digExit","exit","closest","closestDistance","isType","TILE_TYPE_FLOOR","getClosestTile","setTileType","TILE_TYPE_WALL","isOnEdge","tileTypeMatches","getRoomForTile","addExit","TILE_TYPE_OUT_OF_BOUNDS","TileData","TILE_THEME_CASTLE","createTileData","TILE_THEME_CANYON","TILE_THEME_DESERT","ForestTheme","CastleTheme","CabinTheme","CanyonTheme","DesertTheme","getThemePopulator","TileThemePopulator","getEntities","populateTile","trySpawn","ground","tileArr","attempts","getRandomEmptyTile","interiorTiles","chest","TileScheme","TileContainer","MapGenerator","digPercentage","createRoom","defaultType","getTile","setTileTheme","getTileType","addRoom","RoomData","combineOther","cloneTo","setTheme","relativeExits","endWidth","endHeight","borders","interior","addRelativeExit","containsPoint","intersects","c1","c2","c3","c4","bytes","crypto","getRandomValues","customRandom","alphabet","getRandom","LN2","step","customAlphabet","byte","urlAlphabet","exitOffset","castle","DenseCastleScheme","curId","createNodeId","splitNodeVertical","cut","leftId","rightId","isLeaf","parentId","siblingId","splitNodeHorizontal","topId","bottomId","minRoomWidth","minRoomHeight","maxRoomWidth","maxRoomHeight","splitIgnoreChance","loopiness","nodes","graph","sibling","doorCandidates","hasSib","tryAddLoop","north","south","east","west","ScatteredScheme","minCount","edges","borderTiles","isTopLeftCorner","isBottomLeftCorner","isBottomRightCorner","isTopRightCorner","addBorder","populateRoom","doors","walkways","generatePath","doorA","doorB","attempt","maxAttempts","roomPadding","maxCount","minWidth","minHeight","maxHeight","createBox","overlaps","box","SquareScheme","messages","msgs","consoleHeight","removeEntity","Track","intro","isPlaying","host","pathname","track","tracks","currentTrack","rv","sharpTrapQuery","turnDelta","trapEntity","combustible","sparkChance","dieChance","isOutOfFuel","grid","MemoryGrid","getAmbientTemperature","ambient","getAmbientCapacity","capacity","getCapacity","hasCap","hasFire","cap","thermalCapacity","sumArray","avgArray","f0","f1","lerp2","copyToPrevious","shards","shardEntity","shard","healthShardConsumer","healValue","compressables","compressableEntity","compressable","mass","getMaskNeighbors","refreshMask","sumMask","refreshAll","Chunk","localCoordinate","getChunkById","chunkPos","getChunk","chunkX","chunkY","isLoaded","saved","generateChunk","simplex","SimplexNoise","noise2D","G3","F4","G4","randomOrSeed","s0","s1","s2","mash","masher","alea","buildPermutationTable","perm","permMod12","aux","grad3","grad4","gi0","gi1","gi2","noise3D","zin","n3","k1","i2","j2","z0","z1","z2","x3","y3","z3","kk","t3","gi3","noise4D","n4","l1","l2","i3","j3","k3","l3","w0","rankx","ranky","rankz","rankw","w1","w2","w3","x4","y4","z4","w4","ll","t4","gi4","_buildPermutationTable","define","__webpack_module_cache__","__webpack_require__","moduleId","__webpack_modules__","getter","__esModule","getPrototypeOf","__proto__","ns","getOwnPropertyNames","defineProperty","globalThis","Function","toStringTag"],"mappings":";UACIA,eADAC,S,wRCGJC,gEAAaC,MAAK,KACd,MAAM,MAAWC,oBAAQ,GAEzBC,OAAOC,KAAOA,KACdD,OAAOE,IAAMD,KAAKC,IAElBD,KAAKE,WAGTC,kDAAc,I,mMCZd,MAAMC,UAAaC,KACf,IAAIC,SAAQ,CAACC,QAASC,UACdH,IAAII,UACJF,UAGJF,IAAIK,iBAAiB,QAAQ,KACzBH,aAGJF,IAAIK,iBAAiB,SAAUC,QAC3BH,OAAOG,aAINf,WAAa,KACtB,MAAMgB,KAAOC,MAAMC,KAAKC,SAASC,iBAAiB,QAElD,OAAOV,QAAQW,IAAIL,KAAKM,IAAId,c,uCClBhC,mCAUA,WAEE,aASA,IAAIe,aAAe,WACjBC,KAAKC,QAEPF,aAAaG,UAAY,CAKvBD,KAAM,WACJ,IAAIE,KAAOH,MAAQjB,OA8BnB,OA3BAoB,KAAKC,SAAW,IAGhBD,KAAKE,gBAAkB,GACvBF,KAAKG,cAAgB,GAGrBH,KAAKI,QAAU,GACfJ,KAAKK,OAAS,GACdL,KAAKM,QAAS,EACdN,KAAKO,QAAU,EACfP,KAAKQ,cAAgB,iBACrBR,KAAKS,WAAgC,oBAAXjC,QAA0BA,OAAOkC,UAAalC,OAAOkC,UAAY,KAG3FV,KAAKW,WAAa,KAClBX,KAAKY,SAAU,EACfZ,KAAKa,eAAgB,EACrBb,KAAKc,aAAc,EACnBd,KAAKe,IAAM,KAGXf,KAAKgB,YAAa,EAGlBhB,KAAKiB,SAEEjB,MAQTkB,OAAQ,SAASC,KACf,IAAInB,KAAOH,MAAQjB,OAQnB,GAPAuC,IAAMC,WAAWD,KAGZnB,KAAKe,KACRM,yBAGiB,IAARF,KAAuBA,KAAO,GAAKA,KAAO,EAAG,CAItD,GAHAnB,KAAKO,QAAUY,IAGXnB,KAAKM,OACP,OAAON,KAILA,KAAKa,eACPb,KAAKW,WAAWW,KAAKC,eAAeJ,IAAKvC,OAAOmC,IAAIS,aAItD,IAAK,IAAIC,EAAE,EAAGA,EAAEzB,KAAKK,OAAOqB,OAAQD,IAClC,IAAKzB,KAAKK,OAAOoB,GAAGE,UAKlB,IAHA,IAAIC,IAAM5B,KAAKK,OAAOoB,GAAGI,eAGhBC,EAAE,EAAGA,EAAEF,IAAIF,OAAQI,IAAK,CAC/B,IAAIC,MAAQ/B,KAAKK,OAAOoB,GAAGO,WAAWJ,IAAIE,IAEtCC,OAASA,MAAME,QACjBF,MAAME,MAAMf,OAASa,MAAMxB,QAAUY,KAM7C,OAAOnB,KAGT,OAAOA,KAAKO,SAOd2B,KAAM,SAASC,OACb,IAAInC,KAAOH,MAAQjB,OAGdoB,KAAKe,KACRM,oBAGFrB,KAAKM,OAAS6B,MAGVnC,KAAKa,eACPb,KAAKW,WAAWW,KAAKC,eAAeY,MAAQ,EAAInC,KAAKO,QAAS3B,OAAOmC,IAAIS,aAI3E,IAAK,IAAIC,EAAE,EAAGA,EAAEzB,KAAKK,OAAOqB,OAAQD,IAClC,IAAKzB,KAAKK,OAAOoB,GAAGE,UAKlB,IAHA,IAAIC,IAAM5B,KAAKK,OAAOoB,GAAGI,eAGhBC,EAAE,EAAGA,EAAEF,IAAIF,OAAQI,IAAK,CAC/B,IAAIC,MAAQ/B,KAAKK,OAAOoB,GAAGO,WAAWJ,IAAIE,IAEtCC,OAASA,MAAME,QACjBF,MAAME,MAAME,QAASA,OAAgBJ,MAAMzB,QAMnD,OAAON,MAMToC,KAAM,WAIJ,IAHA,IAAIpC,KAAOH,MAAQjB,OAGV6C,EAAE,EAAGA,EAAEzB,KAAKK,OAAOqB,OAAQD,IAClCzB,KAAKK,OAAOoB,GAAGW,OAGjB,OAAOpC,MAOTqC,OAAQ,WAGN,IAFA,IAAIrC,KAAOH,MAAQjB,OAEV6C,EAAEzB,KAAKK,OAAOqB,OAAO,EAAGD,GAAG,EAAGA,IACrCzB,KAAKK,OAAOoB,GAAGY,SAUjB,OANIrC,KAAKa,eAAiBb,KAAKe,UAAiC,IAAnBf,KAAKe,IAAIuB,QACpDtC,KAAKe,IAAIuB,QACTtC,KAAKe,IAAM,KACXM,qBAGKrB,MAQTuC,OAAQ,SAASC,KACf,OAAQ3C,MAAQjB,QAAQwB,QAAQoC,IAAIC,QAAQ,MAAO,MAOrDxB,OAAQ,WACN,IAAIjB,KAAOH,MAAQjB,OASnB,GANAoB,KAAK0C,MAAQ1C,KAAKe,KAAMf,KAAKe,IAAI2B,OAAuB,YAGxD1C,KAAK2C,gBAGA3C,KAAKa,cAER,GAAqB,oBAAV+B,MACT,SAIuC,KAH1B,IAAIA,OAGCC,mBACd7C,KAAKQ,cAAgB,WAEvB,MAAMsC,GACN9C,KAAKY,SAAU,OAGjBZ,KAAKY,SAAU,EAKnB,KACa,IAAIgC,OACNT,QACPnC,KAAKY,SAAU,GAEjB,MAAOkC,IAOT,OAJK9C,KAAKY,SACRZ,KAAK+C,eAGA/C,MAOT+C,aAAc,WACZ,IAAI/C,KAAOH,MAAQjB,OACfoE,UAAY,KAGhB,IACEA,UAA8B,oBAAVJ,MAAyB,IAAIA,MAAU,KAC3D,MAAOK,KACP,OAAOjD,KAGT,IAAKgD,WAA8C,mBAA1BA,UAAUE,YACjC,OAAOlD,KAGT,IAAImD,SAAWH,UAAUE,YAAY,eAAeT,QAAQ,OAAQ,IAGhEW,WAAapD,KAAKS,YAAcT,KAAKS,WAAW4C,UAAUC,MAAM,kBAChEC,WAAcH,YAAcI,SAASJ,WAAW,GAAGK,MAAM,KAAK,GAAI,IAAM,GAoB5E,OAlBAzD,KAAKI,QAAU,CACbsD,MAASH,aAAeJ,WAAYH,UAAUE,YAAY,cAAcT,QAAQ,OAAQ,KACxFkB,OAAQR,SACRS,OAAQZ,UAAUE,YAAY,4BAA4BT,QAAQ,OAAQ,IAC1EoB,MAAOb,UAAUE,YAAY,8BAA8BT,QAAQ,OAAQ,IAC3EqB,MAAOd,UAAUE,YAAY,8BAA8BT,QAAQ,OAAQ,IAC3EsB,OAAQf,UAAUE,YAAY,0BAA4BF,UAAUE,YAAY,cAAcT,QAAQ,OAAQ,IAC9GuB,MAAOhB,UAAUE,YAAY,cAAcT,QAAQ,OAAQ,IAC3DwB,MAAOjB,UAAUE,YAAY,gBAAgBT,QAAQ,OAAQ,IAC7DyB,OAAQlB,UAAUE,YAAY,iBAAmBF,UAAUE,YAAY,eAAiBF,UAAUE,YAAY,eAAeT,QAAQ,OAAQ,IAC7I0B,OAAQnB,UAAUE,YAAY,iBAAmBF,UAAUE,YAAY,eAAiBF,UAAUE,YAAY,eAAeT,QAAQ,OAAQ,IAC7I2B,OAAQpB,UAAUE,YAAY,iBAAmBF,UAAUE,YAAY,eAAiBF,UAAUE,YAAY,eAAeT,QAAQ,OAAQ,IAC7I4B,OAAQrB,UAAUE,YAAY,+BAA+BT,QAAQ,OAAQ,IAC7E6B,OAAQtB,UAAUE,YAAY,+BAA+BT,QAAQ,OAAQ,IAC7E8B,QAASvB,UAAUE,YAAY,4BAA4BT,QAAQ,OAAQ,IAC3E+B,QAASxB,UAAUE,YAAY,kBAAoBF,UAAUE,YAAY,gBAAgBT,QAAQ,OAAQ,KAGpGzC,MASTyE,aAAc,WACZ,IAAIzE,KAAOH,MAAQjB,OAGnB,IAAIoB,KAAK0E,gBAAmB1E,KAAKe,IAAjC,CAIAf,KAAK0E,gBAAiB,EACtB1E,KAAKgB,YAAa,EAKbhB,KAAK2E,iBAA2C,QAAxB3E,KAAKe,IAAI6D,aACpC5E,KAAK2E,iBAAkB,EACvB3E,KAAKqC,UAKPrC,KAAK6E,eAAiB7E,KAAKe,IAAI+D,aAAa,EAAG,EAAG,OAKlD,IAAIC,OAAS,SAASjC,GAOpB,KAAO9C,KAAKE,gBAAgBwB,OAAS1B,KAAKG,eACxC,IACE,IAAI6E,UAAY,IAAIpC,MAIpBoC,UAAUC,WAAY,EAGtBjF,KAAKkF,mBAAmBF,WACxB,MAAOlC,GACP9C,KAAKY,SAAU,EACf,MAKJ,IAAK,IAAIa,EAAE,EAAGA,EAAEzB,KAAKK,OAAOqB,OAAQD,IAClC,IAAKzB,KAAKK,OAAOoB,GAAGE,UAKlB,IAHA,IAAIC,IAAM5B,KAAKK,OAAOoB,GAAGI,eAGhBC,EAAE,EAAGA,EAAEF,IAAIF,OAAQI,IAAK,CAC/B,IAAIC,MAAQ/B,KAAKK,OAAOoB,GAAGO,WAAWJ,IAAIE,IAEtCC,OAASA,MAAME,QAAUF,MAAME,MAAMgD,YACvClD,MAAME,MAAMgD,WAAY,EACxBlD,MAAME,MAAMkD,QAOpBnF,KAAKoF,cAGL,IAAIC,OAASrF,KAAKe,IAAIuE,qBACtBD,OAAOE,OAASvF,KAAK6E,eACrBQ,OAAOG,QAAQxF,KAAKe,IAAI0E,kBAGI,IAAjBJ,OAAO1G,MAChB0G,OAAOK,OAAO,GAEdL,OAAO1G,MAAM,GAIgB,mBAApBqB,KAAKe,IAAI4E,QAClB3F,KAAKe,IAAI4E,SAIXN,OAAOO,QAAU,WACfP,OAAOQ,WAAW,GAGlB7F,KAAK0E,gBAAiB,EAGtBlF,SAASsG,oBAAoB,aAAcf,QAAQ,GACnDvF,SAASsG,oBAAoB,WAAYf,QAAQ,GACjDvF,SAASsG,oBAAoB,QAASf,QAAQ,GAG9C,IAAK,IAAItD,EAAE,EAAGA,EAAEzB,KAAKK,OAAOqB,OAAQD,IAClCzB,KAAKK,OAAOoB,GAAGsE,MAAM,YAU3B,OAJAvG,SAASL,iBAAiB,aAAc4F,QAAQ,GAChDvF,SAASL,iBAAiB,WAAY4F,QAAQ,GAC9CvF,SAASL,iBAAiB,QAAS4F,QAAQ,GAEpC/E,OAQTgG,kBAAmB,WACjB,IAAIhG,KAAOH,MAAQjB,OAGnB,GAAIoB,KAAKE,gBAAgBwB,OACvB,OAAO1B,KAAKE,gBAAgB+F,MAI9B,IAAIC,UAAW,IAAItD,OAAQuD,OAO3B,OANID,UAA+B,oBAAZnH,UAA4BmH,oBAAoBnH,SAAoC,mBAAlBmH,SAAS5H,OAChG4H,SAASE,OAAM,WACbC,QAAQC,KAAK,6EAIV,IAAI1D,OAObsC,mBAAoB,SAASqB,OAC3B,IAAIvG,KAAOH,MAAQjB,OAOnB,OAJI2H,MAAMtB,WACRjF,KAAKE,gBAAgBsG,KAAKD,OAGrBvG,MAQT2C,aAAc,WACZ,IAAI3C,KAAOH,KAEX,GAAKG,KAAKc,aAAgBd,KAAKe,UAAmC,IAArBf,KAAKe,IAAI0F,SAA4B7H,OAAOiC,cAAzF,CAKA,IAAK,IAAIY,EAAE,EAAGA,EAAEzB,KAAKK,OAAOqB,OAAQD,IAClC,GAAIzB,KAAKK,OAAOoB,GAAGE,UACjB,IAAK,IAAIG,EAAE,EAAGA,EAAE9B,KAAKK,OAAOoB,GAAGiF,QAAQhF,OAAQI,IAC7C,IAAK9B,KAAKK,OAAOoB,GAAGiF,QAAQ5E,GAAG6E,QAC7B,OAAO3G,KAkCf,OA5BIA,KAAK4G,eACPC,aAAa7G,KAAK4G,eAIpB5G,KAAK4G,cAAgBE,YAAW,WAC9B,GAAK9G,KAAKc,YAAV,CAIAd,KAAK4G,cAAgB,KACrB5G,KAAK0C,MAAQ,aAGb,IAAIqE,iBAAmB,WACrB/G,KAAK0C,MAAQ,YAET1C,KAAKgH,6BACAhH,KAAKgH,oBACZhH,KAAKoF,gBAMTpF,KAAKe,IAAI0F,UAAUnI,KAAKyI,iBAAkBA,qBACzC,KAEI/G,OAOToF,YAAa,WACX,IAAIpF,KAAOH,KAEX,GAAKG,KAAKe,UAAkC,IAApBf,KAAKe,IAAI4E,QAA2B/G,OAAOiC,cAyBnE,MArBmB,YAAfb,KAAK0C,OAA0C,gBAAnB1C,KAAKe,IAAI2B,OAA2B1C,KAAK4G,eACvEC,aAAa7G,KAAK4G,eAClB5G,KAAK4G,cAAgB,MACG,cAAf5G,KAAK0C,OAAwC,YAAf1C,KAAK0C,OAA0C,gBAAnB1C,KAAKe,IAAI2B,OAC5E1C,KAAKe,IAAI4E,SAASrH,MAAK,WACrB0B,KAAK0C,MAAQ,UAGb,IAAK,IAAIjB,EAAE,EAAGA,EAAEzB,KAAKK,OAAOqB,OAAQD,IAClCzB,KAAKK,OAAOoB,GAAGsE,MAAM,aAIrB/F,KAAK4G,gBACPC,aAAa7G,KAAK4G,eAClB5G,KAAK4G,cAAgB,OAEC,eAAf5G,KAAK0C,QACd1C,KAAKgH,qBAAsB,GAGtBhH,OAKX,IAAIpB,OAAS,IAAIgB,aASbqH,KAAO,SAASC,GAIbA,EAAEC,KAAwB,IAAjBD,EAAEC,IAAIzF,OAHT7B,KAQNC,KAAKoH,GAJRb,QAAQjH,MAAM,+DAMlB6H,KAAKlH,UAAY,CAMfD,KAAM,SAASoH,GACb,IAAIlH,KAAOH,KA2EX,OAxEKjB,OAAOmC,KACVM,oBAIFrB,KAAKoH,UAAYF,EAAEG,WAAY,EAC/BrH,KAAKsH,QAA+B,iBAAbJ,EAAEK,OAAuBL,EAAEK,OAAS,CAACL,EAAEK,QAC9DvH,KAAKwH,OAASN,EAAEO,QAAS,EACzBzH,KAAKM,OAAS4G,EAAEhF,OAAQ,EACxBlC,KAAK0H,MAAQR,EAAES,OAAQ,EACvB3H,KAAK4H,MAAQV,EAAEW,MAAQ,EACvB7H,KAAK8H,SAAiC,kBAAdZ,EAAEa,SAAuC,aAAdb,EAAEa,SAA0Bb,EAAEa,QACjF/H,KAAKgI,MAAQd,EAAEe,MAAQ,EACvBjI,KAAKkI,QAAUhB,EAAEiB,QAAU,GAC3BnI,KAAKoI,KAAyB,iBAAVlB,EAAEC,IAAoBD,EAAEC,IAAM,CAACD,EAAEC,KACrDnH,KAAKO,aAAuB8H,IAAbnB,EAAEhG,OAAuBgG,EAAEhG,OAAS,EACnDlB,KAAKsI,KAAO,CACVC,OAAQrB,EAAEsB,KAAOtB,EAAEsB,IAAID,OAASrB,EAAEsB,IAAID,OAAS,MAC/CE,QAASvB,EAAEsB,KAAOtB,EAAEsB,IAAIC,QAAUvB,EAAEsB,IAAIC,QAAU,KAClDC,mBAAiBxB,EAAEsB,MAAOtB,EAAEsB,IAAIE,kBAAkBxB,EAAEsB,IAAIE,iBAI1D1I,KAAK2I,UAAY,EACjB3I,KAAK4I,OAAS,WACd5I,KAAK0G,QAAU,GACf1G,KAAK6I,WAAa,GAClB7I,KAAK8I,OAAS,GACd9I,KAAK+I,WAAY,EAGjB/I,KAAKgJ,OAAS9B,EAAE+B,MAAQ,CAAC,CAACC,GAAIhC,EAAE+B,QAAU,GAC1CjJ,KAAKmJ,QAAUjC,EAAEkC,OAAS,CAAC,CAACF,GAAIhC,EAAEkC,SAAW,GAC7CpJ,KAAKqJ,QAAUnC,EAAEoC,OAAS,CAAC,CAACJ,GAAIhC,EAAEoC,SAAW,GAC7CtJ,KAAKuJ,aAAerC,EAAEsC,YAAc,CAAC,CAACN,GAAIhC,EAAEsC,cAAgB,GAC5DxJ,KAAKyJ,aAAevC,EAAEwC,YAAc,CAAC,CAACR,GAAIhC,EAAEwC,cAAgB,GAC5D1J,KAAK2J,SAAWzC,EAAE0C,QAAU,CAAC,CAACV,GAAIhC,EAAE0C,UAAY,GAChD5J,KAAK6J,QAAU3C,EAAE4C,OAAS,CAAC,CAACZ,GAAIhC,EAAE4C,SAAW,GAC7C9J,KAAK+J,QAAU7C,EAAE8C,OAAS,CAAC,CAACd,GAAIhC,EAAE8C,SAAW,GAC7ChK,KAAKiK,QAAU/C,EAAEgD,OAAS,CAAC,CAAChB,GAAIhC,EAAEgD,SAAW,GAC7ClK,KAAKmK,UAAYjD,EAAEkD,SAAW,CAAC,CAAClB,GAAIhC,EAAEkD,WAAa,GACnDpK,KAAKqK,QAAUnD,EAAEoD,OAAS,CAAC,CAACpB,GAAIhC,EAAEoD,SAAW,GAC7CtK,KAAKuK,QAAUrD,EAAEsD,OAAS,CAAC,CAACtB,GAAIhC,EAAEsD,SAAW,GAC7CxK,KAAKyK,UAAYvD,EAAEwD,SAAW,CAAC,CAACxB,GAAIhC,EAAEwD,WAAa,GACnD1K,KAAK2K,UAAY,GAGjB3K,KAAK2B,UAAY/C,OAAOiC,gBAAkBb,KAAKwH,YAGrB,IAAf5I,OAAOmC,KAAuBnC,OAAOmC,KAAOnC,OAAOoC,YAC5DpC,OAAO6F,eAIT7F,OAAOyB,OAAOmG,KAAKxG,MAGfA,KAAKoH,WACPpH,KAAK8I,OAAOtC,KAAK,CACfoE,MAAO,OACPC,OAAQ,WACN7K,KAAKmG,UAMPnG,KAAK8H,UAA8B,SAAlB9H,KAAK8H,UACxB9H,KAAKmF,OAGAnF,MAOTmF,KAAM,WACJ,IACI2F,IAAM,KAGV,GAAIlM,OAAOgC,QAJAf,KAKJkG,MAAM,YAAa,KAAM,yBADhC,CAMyB,iBAVdlG,KAUKuI,OAVLvI,KAWJuI,KAAO,CAXHvI,KAWSuI,OAIpB,IAAK,IAAI3G,EAAE,EAAGA,EAfH5B,KAeUuI,KAAK1G,OAAQD,IAAK,CACrC,IAAIe,IAAKuI,IAET,GAlBSlL,KAkBAyH,SAlBAzH,KAkBgByH,QAAQ7F,GAE/Be,IApBO3C,KAoBIyH,QAAQ7F,OACd,CAGL,GAAmB,iBADnBsJ,IAvBOlL,KAuBIuI,KAAK3G,IACa,CAxBtB5B,KAyBAkG,MAAM,YAAa,KAAM,0DAC9B,UAIFvD,IAAM,0BAA0BwI,KAAKD,QAEnCvI,IAAM,aAAawI,KAAKD,IAAItH,MAAM,IAAK,GAAG,KAGxCjB,MACFA,IAAMA,IAAI,GAAGyI,eAUjB,GALKzI,KACH6D,QAAQC,KAAK,8FAIX9D,KAAO5D,OAAO2D,OAAOC,KAAM,CAC7BsI,IA/COjL,KA+CIuI,KAAK3G,GAChB,OAIJ,GAAKqJ,IAuBL,OA3EWjL,KAyDNuI,KAAO0C,IAzDDjL,KA0DN+I,OAAS,UAImB,WAA7BpK,OAAO0M,SAASC,UAA6C,UAApBL,IAAIM,MAAM,EAAG,KA9D/CvL,KA+DJ2H,QAAS,EA/DL3H,KAgEJ8B,WAAY,GAInB,IAAI0J,MApEOxL,WAuEF8B,WACP2J,WAxESzL,gBAqDJkG,MAAM,YAAa,KAAM,kDA+BlCI,KAAM,SAASgC,OAAQoD,UACrB,IAAIvL,KAAOH,KACP2L,GAAK,KAGT,GAAsB,iBAAXrD,OACTqD,GAAKrD,OACLA,OAAS,SACJ,IAAsB,iBAAXA,QAAuC,WAAhBnI,KAAK4I,SAAwB5I,KAAKkI,QAAQC,QAEjF,OAAO,KACF,QAAsB,IAAXA,SAEhBA,OAAS,aAIJnI,KAAK+I,WAAW,CAEnB,IADA,IAAI0C,IAAM,EACDhK,EAAE,EAAGA,EAAEzB,KAAK0G,QAAQhF,OAAQD,IAC/BzB,KAAK0G,QAAQjF,GAAGkF,UAAY3G,KAAK0G,QAAQjF,GAAGiK,SAC9CD,MACAD,GAAKxL,KAAK0G,QAAQjF,GAAGkK,KAIb,IAARF,IACFtD,OAAS,KAETqD,GAAK,MAMX,IAAIzJ,MAAQyJ,GAAKxL,KAAKgC,WAAWwJ,IAAMxL,KAAK4L,iBAG5C,IAAK7J,MACH,OAAO,KAWT,GAPIyJ,KAAOrD,SACTA,OAASpG,MAAMmG,SAAW,aAMR,WAAhBlI,KAAK4I,OAAqB,CAE5B7G,MAAMmG,QAAUC,OAGhBpG,MAAM2J,QAAS,EAGf,IAAIG,QAAU9J,MAAM4J,IAQpB,OAPA3L,KAAK8I,OAAOtC,KAAK,CACfoE,MAAO,OACPC,OAAQ,WACN7K,KAAKmG,KAAK0F,YAIPA,QAIT,GAAIL,KAAOzJ,MAAM4E,QAMf,OAJK4E,UACHvL,KAAK8L,WAAW,QAGX/J,MAAM4J,IAIX3L,KAAK2B,WACP/C,OAAOwG,cAIT,IAAI2G,KAAOC,KAAKC,IAAI,EAAGlK,MAAMmK,MAAQ,EAAInK,MAAMmK,MAAQlM,KAAKkI,QAAQC,QAAQ,GAAK,KAC7EgE,SAAWH,KAAKC,IAAI,GAAKjM,KAAKkI,QAAQC,QAAQ,GAAKnI,KAAKkI,QAAQC,QAAQ,IAAM,IAAQ4D,MACtFK,QAAsB,IAAXD,SAAmBH,KAAKK,IAAItK,MAAMiG,OAC7CrJ,MAAQqB,KAAKkI,QAAQC,QAAQ,GAAK,IAClC/F,MAAQpC,KAAKkI,QAAQC,QAAQ,GAAKnI,KAAKkI,QAAQC,QAAQ,IAAM,IACjEpG,MAAMmG,QAAUC,OAIhBpG,MAAM2J,QAAS,EAGf,IAAIY,UAAY,WACdvK,MAAM4E,SAAU,EAChB5E,MAAMmK,MAAQH,KACdhK,MAAMwK,OAAS5N,MACfoD,MAAMyK,MAAQpK,KACdL,MAAM2F,SAAW3F,MAAM2F,QAAS1H,KAAKkI,QAAQC,QAAQ,KAIvD,KAAI4D,MAAQ3J,MAAZ,CAMA,IAAIqK,KAAO1K,MAAME,MACjB,GAAIjC,KAAK2B,UAAW,CAElB,IAAI+K,aAAe,WACjB1M,KAAK+I,WAAY,EACjBuD,YACAtM,KAAK2M,eAAe5K,OAGpB,IAAIZ,IAAOY,MAAMzB,QAAUN,KAAKM,OAAU,EAAIyB,MAAMxB,QACpDkM,KAAKnL,KAAKC,eAAeJ,IAAKvC,OAAOmC,IAAIS,aACzCO,MAAM6K,WAAahO,OAAOmC,IAAIS,iBAGS,IAA5BiL,KAAKI,aAAalO,MAC3BoD,MAAM2F,MAAQ+E,KAAKI,aAAaC,YAAY,EAAGf,KAAM,OAASU,KAAKI,aAAaC,YAAY,EAAGf,KAAMI,UAErGpK,MAAM2F,MAAQ+E,KAAKI,aAAalO,MAAM,EAAGoN,KAAM,OAASU,KAAKI,aAAalO,MAAM,EAAGoN,KAAMI,UAIvFC,UAAYW,MACd/M,KAAK6I,WAAW9G,MAAM4J,KAAO7E,WAAW9G,KAAK0L,OAAOsB,KAAKhN,KAAM+B,OAAQqK,UAGpEb,UACHzE,YAAW,WACT9G,KAAK+F,MAAM,OAAQhE,MAAM4J,KACzB3L,KAAK8L,eACJ,IAIc,YAAjBlN,OAAO8D,OAA4C,gBAArB9D,OAAOmC,IAAI2B,MAC3CgK,gBAEA1M,KAAK+I,WAAY,EAGjB/I,KAAKiN,KAAK,SAAUP,cAGpB1M,KAAKkN,YAAYnL,MAAM4J,UAEpB,CAEL,IAAIwB,UAAY,WACdV,KAAKjL,YAAcuK,KACnBU,KAAKtK,MAAQJ,MAAMzB,QAAUN,KAAKM,QAAU1B,OAAO0B,QAAUmM,KAAKtK,MAClEsK,KAAKvL,OAASa,MAAMxB,QAAU3B,OAAOsC,SACrCuL,KAAKW,aAAerL,MAAMiG,MAG1B,IACE,IAAI7B,KAAOsG,KAAKtG,OAwChB,GArCIA,MAA2B,oBAAZpH,UAA4BoH,gBAAgBpH,SAAgC,mBAAdoH,KAAK7H,OAEpF0B,KAAK+I,WAAY,EAGjBuD,YAGAnG,KACG7H,MAAK,WACJ0B,KAAK+I,WAAY,EACjB0D,KAAKxH,WAAY,EACZsG,WACHvL,KAAK+F,MAAM,OAAQhE,MAAM4J,KACzB3L,KAAK8L,iBAGR1F,OAAM,WACLpG,KAAK+I,WAAY,EACjB/I,KAAK+F,MAAM,YAAahE,MAAM4J,IAAK,+IAInC5J,MAAM2J,QAAS,EACf3J,MAAM4E,SAAU,MAEV4E,WACVvL,KAAK+I,WAAY,EACjBuD,YACAtM,KAAK+F,MAAM,OAAQhE,MAAM4J,KACzB3L,KAAK8L,cAIPW,KAAKW,aAAerL,MAAMiG,MAGtByE,KAAKY,OAGP,YAFArN,KAAK+F,MAAM,YAAahE,MAAM4J,IAAK,+IAMtB,cAAXxD,QAA0BpG,MAAM2F,MAClC1H,KAAK6I,WAAW9G,MAAM4J,KAAO7E,WAAW9G,KAAK0L,OAAOsB,KAAKhN,KAAM+B,OAAQqK,UAEvEpM,KAAK6I,WAAW9G,MAAM4J,KAAO,WAE3B3L,KAAK0L,OAAO3J,OAGZ0K,KAAK3G,oBAAoB,QAAS9F,KAAK6I,WAAW9G,MAAM4J,MAAM,IAEhEc,KAAKtN,iBAAiB,QAASa,KAAK6I,WAAW9G,MAAM4J,MAAM,IAE7D,MAAO1I,KACPjD,KAAK+F,MAAM,YAAahE,MAAM4J,IAAK1I,OAKtB,2FAAbwJ,KAAKtF,MACPsF,KAAKtF,IAAMnH,KAAKoI,KAChBqE,KAAKtH,QAIP,IAAImI,mBAAsB9O,QAAUA,OAAO+O,SAAad,KAAKe,YAAc5O,OAAO6B,WAAWgN,WAC7F,GAAIhB,KAAKe,YAAc,GAAKF,mBAC1BH,gBACK,CACLnN,KAAK+I,WAAY,EAEjB,IAAI2E,SAAW,WAEbP,YAGAV,KAAK3G,oBAAoBlH,OAAO4B,cAAekN,UAAU,IAE3DjB,KAAKtN,iBAAiBP,OAAO4B,cAAekN,UAAU,GAGtD1N,KAAKkN,YAAYnL,MAAM4J,MAI3B,OAAO5J,MAAM4J,IAtJX3L,KAAK0L,OAAO3J,QA8JhB4L,MAAO,SAASnC,IACd,IAAIxL,KAAOH,KAGX,GAAoB,WAAhBG,KAAK4I,QAAuB5I,KAAK+I,UAQnC,OAPA/I,KAAK8I,OAAOtC,KAAK,CACfoE,MAAO,QACPC,OAAQ,WACN7K,KAAK2N,MAAMnC,OAIRxL,KAMT,IAFA,IAAI4B,IAAM5B,KAAK6B,aAAa2J,IAEnB/J,EAAE,EAAGA,EAAEG,IAAIF,OAAQD,IAAK,CAE/BzB,KAAKkN,YAAYtL,IAAIH,IAGrB,IAAIM,MAAQ/B,KAAKgC,WAAWJ,IAAIH,IAEhC,GAAIM,QAAUA,MAAM4E,UAElB5E,MAAMmK,MAAQlM,KAAK+L,KAAKnK,IAAIH,IAC5BM,MAAM6L,UAAY,EAClB7L,MAAM4E,SAAU,EAGhB3G,KAAK6N,UAAUjM,IAAIH,IAEfM,MAAME,OACR,GAAIjC,KAAK2B,UAAW,CAElB,IAAKI,MAAME,MAAM4K,aACf,cAG2C,IAAlC9K,MAAME,MAAM4K,aAAazK,KAClCL,MAAME,MAAM4K,aAAaiB,QAAQ,GAEjC/L,MAAME,MAAM4K,aAAazK,KAAK,GAIhCpC,KAAK+N,aAAahM,MAAME,YACd+L,MAAMjM,MAAME,MAAMkK,WAAapK,MAAME,MAAMkK,WAAaY,KAClEhL,MAAME,MAAM0L,QAMbM,UAAU,IACbjO,KAAK+F,MAAM,QAAShE,MAAQA,MAAM4J,IAAM,MAI5C,OAAO3L,MASToC,KAAM,SAASoJ,GAAID,UACjB,IAAIvL,KAAOH,KAGX,GAAoB,WAAhBG,KAAK4I,QAAuB5I,KAAK+I,UAQnC,OAPA/I,KAAK8I,OAAOtC,KAAK,CACfoE,MAAO,OACPC,OAAQ,WACN7K,KAAKoC,KAAKoJ,OAIPxL,KAMT,IAFA,IAAI4B,IAAM5B,KAAK6B,aAAa2J,IAEnB/J,EAAE,EAAGA,EAAEG,IAAIF,OAAQD,IAAK,CAE/BzB,KAAKkN,YAAYtL,IAAIH,IAGrB,IAAIM,MAAQ/B,KAAKgC,WAAWJ,IAAIH,IAE5BM,QAEFA,MAAMmK,MAAQnK,MAAMwK,QAAU,EAC9BxK,MAAM6L,UAAY,EAClB7L,MAAM4E,SAAU,EAChB5E,MAAM2J,QAAS,EAGf1L,KAAK6N,UAAUjM,IAAIH,IAEfM,MAAME,QACJjC,KAAK2B,UAEHI,MAAME,MAAM4K,oBAC+B,IAAlC9K,MAAME,MAAM4K,aAAazK,KAClCL,MAAME,MAAM4K,aAAaiB,QAAQ,GAEjC/L,MAAME,MAAM4K,aAAazK,KAAK,GAIhCpC,KAAK+N,aAAahM,MAAME,QAEhB+L,MAAMjM,MAAME,MAAMkK,WAAapK,MAAME,MAAMkK,WAAaY,MAClEhL,MAAME,MAAMT,YAAcO,MAAMwK,QAAU,EAC1CxK,MAAME,MAAM0L,QAGR5L,MAAME,MAAMkK,WAAaY,KAC3B/M,KAAKkO,YAAYnM,MAAME,SAKxBsJ,UACHvL,KAAK+F,MAAM,OAAQhE,MAAM4J,MAK/B,OAAO3L,MASTkC,KAAM,SAASC,MAAOqJ,IACpB,IAAIxL,KAAOH,KAGX,GAAoB,WAAhBG,KAAK4I,QAAsB5I,KAAK+I,UAQlC,OAPA/I,KAAK8I,OAAOtC,KAAK,CACfoE,MAAO,OACPC,OAAQ,WACN7K,KAAKkC,KAAKC,MAAOqJ,OAIdxL,KAIT,QAAkB,IAAPwL,GAAoB,CAC7B,GAAqB,kBAAVrJ,MAGT,OAAOnC,KAAKM,OAFZN,KAAKM,OAAS6B,MASlB,IAFA,IAAIP,IAAM5B,KAAK6B,aAAa2J,IAEnB/J,EAAE,EAAGA,EAAEG,IAAIF,OAAQD,IAAK,CAE/B,IAAIM,MAAQ/B,KAAKgC,WAAWJ,IAAIH,IAE5BM,QACFA,MAAMzB,OAAS6B,MAGXJ,MAAMoM,WACRnO,KAAK6N,UAAU9L,MAAM4J,KAGnB3L,KAAK2B,WAAaI,MAAME,MAC1BF,MAAME,MAAMX,KAAKC,eAAeY,MAAQ,EAAIJ,MAAMxB,QAAS3B,OAAOmC,IAAIS,aAC7DO,MAAME,QACfF,MAAME,MAAME,QAAQvD,OAAO0B,QAAgB6B,OAG7CnC,KAAK+F,MAAM,OAAQhE,MAAM4J,MAI7B,OAAO3L,MAWTkB,OAAQ,WACN,IAEIC,IAAKqK,GAqBLzJ,MAvBA/B,KAAOH,KACPuO,KAAOH,UAIX,GAAoB,IAAhBG,KAAK1M,OAEP,OAAO1B,KAAKO,QACP,GAAoB,IAAhB6N,KAAK1M,QAAgC,IAAhB0M,KAAK1M,aAAmC,IAAZ0M,KAAK,GAAoB,CAEnF,IAAIxM,IAAM5B,KAAK6B,eACXwM,MAAQzM,IAAI0M,QAAQF,KAAK,IACzBC,OAAS,EACX7C,GAAKhI,SAAS4K,KAAK,GAAI,IAEvBjN,IAAMC,WAAWgN,KAAK,SAEfA,KAAK1M,QAAU,IACxBP,IAAMC,WAAWgN,KAAK,IACtB5C,GAAKhI,SAAS4K,KAAK,GAAI,KAKzB,UAAmB,IAARjN,KAAuBA,KAAO,GAAKA,KAAO,GA2CnD,OADAY,MAAQyJ,GAAKxL,KAAKgC,WAAWwJ,IAAMxL,KAAK0G,QAAQ,IACjC3E,MAAMxB,QAAU,EAzC/B,GAAoB,WAAhBP,KAAK4I,QAAsB5I,KAAK+I,UAQlC,OAPA/I,KAAK8I,OAAOtC,KAAK,CACfoE,MAAO,SACPC,OAAQ,WACN7K,KAAKkB,OAAOqN,MAAMvO,KAAMoO,SAIrBpO,UAIS,IAAPwL,KACTxL,KAAKO,QAAUY,KAIjBqK,GAAKxL,KAAK6B,aAAa2J,IACvB,IAAK,IAAI/J,EAAE,EAAGA,EAAE+J,GAAG9J,OAAQD,KAEzBM,MAAQ/B,KAAKgC,WAAWwJ,GAAG/J,OAGzBM,MAAMxB,QAAUY,IAGXiN,KAAK,IACRpO,KAAK6N,UAAUrC,GAAG/J,IAGhBzB,KAAK2B,WAAaI,MAAME,QAAUF,MAAMzB,OAC1CyB,MAAME,MAAMX,KAAKC,eAAeJ,IAAKvC,OAAOmC,IAAIS,aACvCO,MAAME,QAAUF,MAAMzB,SAC/ByB,MAAME,MAAMf,OAASC,IAAMvC,OAAOsC,UAGpClB,KAAK+F,MAAM,SAAUhE,MAAM4J,MAQjC,OAAO3L,MAWTwO,KAAM,SAASjP,KAAMkP,GAAIC,IAAKlD,IAC5B,IAAIxL,KAAOH,KAGX,GAAoB,WAAhBG,KAAK4I,QAAuB5I,KAAK+I,UAQnC,OAPA/I,KAAK8I,OAAOtC,KAAK,CACfoE,MAAO,OACPC,OAAQ,WACN7K,KAAKwO,KAAKjP,KAAMkP,GAAIC,IAAKlD,OAItBxL,KAITT,KAAOyM,KAAK2C,IAAI3C,KAAKC,IAAI,EAAG7K,WAAW7B,OAAQ,GAC/CkP,GAAKzC,KAAK2C,IAAI3C,KAAKC,IAAI,EAAG7K,WAAWqN,KAAM,GAC3CC,IAAMtN,WAAWsN,KAGjB1O,KAAKkB,OAAO3B,KAAMiM,IAIlB,IADA,IAAI5J,IAAM5B,KAAK6B,aAAa2J,IACnB/J,EAAE,EAAGA,EAAEG,IAAIF,OAAQD,IAAK,CAE/B,IAAIM,MAAQ/B,KAAKgC,WAAWJ,IAAIH,IAGhC,GAAIM,MAAO,CAOT,GALKyJ,IACHxL,KAAK6N,UAAUjM,IAAIH,IAIjBzB,KAAK2B,YAAcI,MAAMzB,OAAQ,CACnC,IAAIkB,YAAc5C,OAAOmC,IAAIS,YACzBoN,IAAMpN,YAAekN,IAAM,IAC/B3M,MAAMxB,QAAUhB,KAChBwC,MAAME,MAAMX,KAAKC,eAAehC,KAAMiC,aACtCO,MAAME,MAAMX,KAAKuN,wBAAwBJ,GAAIG,KAG/C5O,KAAK8O,mBAAmB/M,MAAOxC,KAAMkP,GAAIC,IAAK9M,IAAIH,QAAkB,IAAP+J,KAIjE,OAAOxL,MAYT8O,mBAAoB,SAAS/M,MAAOxC,KAAMkP,GAAIC,IAAKlD,GAAIuD,SACrD,IAAI/O,KAAOH,KACPsB,IAAM5B,KACNyP,KAAOP,GAAKlP,KACZ0P,MAAQjD,KAAKK,IAAI2C,KAAO,KACxBE,QAAUlD,KAAKC,IAAI,EAAIgD,MAAQ,EAAKP,IAAMO,MAAQP,KAClDS,SAAWC,KAAKC,MAGpBtN,MAAMuN,QAAUb,GAGhB1M,MAAMoM,UAAYoB,aAAY,WAE5B,IAAIC,MAAQJ,KAAKC,MAAQF,UAAYT,IACrCS,SAAWC,KAAKC,MAChBlO,KAAO6N,KAAOQ,KAGdrO,IAAM6K,KAAKyD,MAAY,IAANtO,KAAa,IAI5BA,IADE6N,KAAO,EACHhD,KAAKC,IAAIwC,GAAItN,KAEb6K,KAAK2C,IAAIF,GAAItN,KAIjBnB,KAAK2B,UACPI,MAAMxB,QAAUY,IAEhBnB,KAAKkB,OAAOC,IAAKY,MAAM4J,KAAK,GAI1BoD,UACF/O,KAAKO,QAAUY,MAIZsN,GAAKlP,MAAQ4B,KAAOsN,IAAQA,GAAKlP,MAAQ4B,KAAOsN,MACnDiB,cAAc3N,MAAMoM,WACpBpM,MAAMoM,UAAY,KAClBpM,MAAMuN,QAAU,KAChBtP,KAAKkB,OAAOuN,GAAI1M,MAAM4J,KACtB3L,KAAK+F,MAAM,OAAQhE,MAAM4J,QAE1BuD,UASLrB,UAAW,SAASrC,IAClB,IACIzJ,MADOlC,KACMmC,WAAWwJ,IAc5B,OAZIzJ,OAASA,MAAMoM,YAHRtO,KAIA8B,WACPI,MAAME,MAAMX,KAAKqO,sBAAsB/Q,OAAOmC,IAAIS,aAGpDkO,cAAc3N,MAAMoM,WACpBpM,MAAMoM,UAAY,KATTtO,KAUJqB,OAAOa,MAAMuN,QAAS9D,IAC3BzJ,MAAMuN,QAAU,KAXPzP,KAYJkG,MAAM,OAAQyF,KAZV3L,MA0Bb8H,KAAM,WACJ,IAEIA,KAAM6D,GAAIzJ,MAFV/B,KAAOH,KACPuO,KAAOH,UAIX,GAAoB,IAAhBG,KAAK1M,OAEP,OAAO1B,KAAK0H,MACP,GAAoB,IAAhB0G,KAAK1M,OAAc,CAC5B,GAAuB,kBAAZ0M,KAAK,GAMd,SADArM,MAAQ/B,KAAKgC,WAAWwB,SAAS4K,KAAK,GAAI,OAC3BrM,MAAM2F,MALrBC,KAAOyG,KAAK,GACZpO,KAAK0H,MAAQC,UAMU,IAAhByG,KAAK1M,SACdiG,KAAOyG,KAAK,GACZ5C,GAAKhI,SAAS4K,KAAK,GAAI,KAKzB,IADA,IAAIxM,IAAM5B,KAAK6B,aAAa2J,IACnB/J,EAAE,EAAGA,EAAEG,IAAIF,OAAQD,KAC1BM,MAAQ/B,KAAKgC,WAAWJ,IAAIH,OAG1BM,MAAM2F,MAAQC,KACV3H,KAAK2B,WAAaI,MAAME,OAASF,MAAME,MAAM4K,eAC/C9K,MAAME,MAAM4K,aAAalF,KAAOA,KAC5BA,OACF5F,MAAME,MAAM4K,aAAa+C,UAAY7N,MAAMwK,QAAU,EACrDxK,MAAME,MAAM4K,aAAagD,QAAU9N,MAAMyK,SAMjD,OAAOxM,MAWTiI,KAAM,WACJ,IAEIA,KAAMuD,GAqBNzJ,MAvBA/B,KAAOH,KACPuO,KAAOH,UAIX,GAAoB,IAAhBG,KAAK1M,OAEP8J,GAAKxL,KAAK0G,QAAQ,GAAGiF,SAChB,GAAoB,IAAhByC,KAAK1M,OAAc,CAE5B,IAAIE,IAAM5B,KAAK6B,eACXwM,MAAQzM,IAAI0M,QAAQF,KAAK,IACzBC,OAAS,EACX7C,GAAKhI,SAAS4K,KAAK,GAAI,IAEvBnG,KAAO7G,WAAWgN,KAAK,SAEA,IAAhBA,KAAK1M,SACduG,KAAO7G,WAAWgN,KAAK,IACvB5C,GAAKhI,SAAS4K,KAAK,GAAI,KAKzB,GAAoB,iBAATnG,KAwDT,OADAlG,MAAQ/B,KAAKgC,WAAWwJ,KACTzJ,MAAMiG,MAAQhI,KAAKgI,MAtDlC,GAAoB,WAAhBhI,KAAK4I,QAAuB5I,KAAK+I,UAQnC,OAPA/I,KAAK8I,OAAOtC,KAAK,CACfoE,MAAO,OACPC,OAAQ,WACN7K,KAAKiI,KAAKsG,MAAMvO,KAAMoO,SAInBpO,UAIS,IAAPwL,KACTxL,KAAKgI,MAAQC,MAIfuD,GAAKxL,KAAK6B,aAAa2J,IACvB,IAAK,IAAI/J,EAAE,EAAGA,EAAE+J,GAAG9J,OAAQD,IAIzB,GAFAM,MAAQ/B,KAAKgC,WAAWwJ,GAAG/J,IAEhB,CAGLzB,KAAK8P,QAAQtE,GAAG/J,MAClBM,MAAM6L,UAAY5N,KAAK+L,KAAKP,GAAG/J,IAC/BM,MAAM6K,WAAa5M,KAAK2B,UAAY/C,OAAOmC,IAAIS,YAAcO,MAAM6K,YAErE7K,MAAMiG,MAAQC,KAGVjI,KAAK2B,WAAaI,MAAME,OAASF,MAAME,MAAM4K,aAC/C9K,MAAME,MAAM4K,aAAaO,aAAa7L,eAAe0G,KAAMrJ,OAAOmC,IAAIS,aAC7DO,MAAME,QACfF,MAAME,MAAMmL,aAAenF,MAI7B,IAAI8D,KAAO/L,KAAK+L,KAAKP,GAAG/J,IACpB0K,UAAanM,KAAKkI,QAAQnG,MAAMmG,SAAS,GAAKlI,KAAKkI,QAAQnG,MAAMmG,SAAS,IAAM,IAAQ6D,KACxFK,QAAsB,IAAXD,SAAmBH,KAAKK,IAAItK,MAAMiG,QAG7ChI,KAAK6I,WAAW2C,GAAG/J,KAAQM,MAAM4E,UACnC3G,KAAKkN,YAAY1B,GAAG/J,IACpBzB,KAAK6I,WAAW2C,GAAG/J,IAAMqF,WAAW9G,KAAK0L,OAAOsB,KAAKhN,KAAM+B,OAAQqK,UAGrEpM,KAAK+F,MAAM,OAAQhE,MAAM4J,KAQ/B,OAAO3L,MAWT+L,KAAM,WACJ,IAEIA,KAAMP,GAFNxL,KAAOH,KACPuO,KAAOH,UAIX,GAAoB,IAAhBG,KAAK1M,OAEP8J,GAAKxL,KAAK0G,QAAQ,GAAGiF,SAChB,GAAoB,IAAhByC,KAAK1M,OAAc,CAE5B,IAAIE,IAAM5B,KAAK6B,eACXwM,MAAQzM,IAAI0M,QAAQF,KAAK,IACzBC,OAAS,EACX7C,GAAKhI,SAAS4K,KAAK,GAAI,IACdpO,KAAK0G,QAAQhF,SACtB8J,GAAKxL,KAAK0G,QAAQ,GAAGiF,IACrBI,KAAO3K,WAAWgN,KAAK,UAEA,IAAhBA,KAAK1M,SACdqK,KAAO3K,WAAWgN,KAAK,IACvB5C,GAAKhI,SAAS4K,KAAK,GAAI,KAIzB,QAAkB,IAAP5C,GACT,OAAOxL,KAIT,GAAoB,iBAAT+L,OAAsC,WAAhB/L,KAAK4I,QAAuB5I,KAAK+I,WAQhE,OAPA/I,KAAK8I,OAAOtC,KAAK,CACfoE,MAAO,OACPC,OAAQ,WACN7K,KAAK+L,KAAKwC,MAAMvO,KAAMoO,SAInBpO,KAIT,IAAI+B,MAAQ/B,KAAKgC,WAAWwJ,IAE5B,GAAIzJ,MAAO,CACT,KAAoB,iBAATgK,MAAqBA,MAAQ,GAwCjC,CACL,GAAI/L,KAAK2B,UAAW,CAClB,IAAIoO,SAAW/P,KAAK8P,QAAQtE,IAAM5M,OAAOmC,IAAIS,YAAcO,MAAM6K,WAAa,EAC1EoD,SAAWjO,MAAM6L,UAAY7L,MAAM6L,UAAY7L,MAAMmK,MAAQ,EACjE,OAAOnK,MAAMmK,OAAS8D,SAAWD,SAAW/D,KAAKK,IAAItK,MAAMiG,QAE3D,OAAOjG,MAAME,MAAMT,YA5CrB,IAAIsO,QAAU9P,KAAK8P,QAAQtE,IACvBsE,SACF9P,KAAK2N,MAAMnC,IAAI,GAIjBzJ,MAAMmK,MAAQH,KACdhK,MAAM2J,QAAS,EACf1L,KAAKkN,YAAY1B,IAGZxL,KAAK2B,YAAaI,MAAME,OAAU+L,MAAMjM,MAAME,MAAMkK,YACvDpK,MAAME,MAAMT,YAAcuK,MAI5B,IAAIkE,YAAc,WAChBjQ,KAAK+F,MAAM,OAAQyF,IAGfsE,SACF9P,KAAKmG,KAAKqF,IAAI,IAKlB,GAAIsE,UAAY9P,KAAK2B,UAAW,CAC9B,IAAIuO,SAAW,WACRlQ,KAAK+I,UAGRjC,WAAWoJ,SAAU,GAFrBD,eAKJnJ,WAAWoJ,SAAU,QAErBD,cAaN,OAAOjQ,MAQT8P,QAAS,SAAStE,IAIhB,GAAkB,iBAAPA,GAAiB,CAC1B,IAAIzJ,MAJKlC,KAIQmC,WAAWwJ,IAC5B,QAAOzJ,QAASA,MAAM4E,QAIxB,IAAK,IAAIlF,EAAE,EAAGA,EATH5B,KASU6G,QAAQhF,OAAQD,IACnC,IAVS5B,KAUC6G,QAAQjF,GAAGkF,QACnB,OAAO,EAIX,OAAO,GAQTwF,SAAU,SAASX,IACjB,IACIW,SADOtM,KACS8I,UAGhB5G,MAJOlC,KAIMmC,WAAWwJ,IAK5B,OAJIzJ,QACFoK,SANStM,KAMOqI,QAAQnG,MAAMmG,SAAS,GAAK,KAGvCiE,UAOTzJ,MAAO,WACL,OAAO7C,KAAK+I,QAOdvG,OAAQ,WAKN,IAJA,IAAIrC,KAAOH,KAGPsQ,OAASnQ,KAAK0G,QACTjF,EAAE,EAAGA,EAAE0O,OAAOzO,OAAQD,IAExB0O,OAAO1O,GAAGkF,SACb3G,KAAKoC,KAAK+N,OAAO1O,GAAGkK,KAIjB3L,KAAK2B,YAER3B,KAAKkO,YAAYiC,OAAO1O,GAAGQ,OAG3BkO,OAAO1O,GAAGQ,MAAM6D,oBAAoB,QAASqK,OAAO1O,GAAG2O,UAAU,GACjED,OAAO1O,GAAGQ,MAAM6D,oBAAoBlH,OAAO4B,cAAe2P,OAAO1O,GAAG4O,SAAS,GAC7EF,OAAO1O,GAAGQ,MAAM6D,oBAAoB,QAASqK,OAAO1O,GAAG6O,QAAQ,GAG/D1R,OAAOsG,mBAAmBiL,OAAO1O,GAAGQ,eAI/BkO,OAAO1O,GAAGQ,MAGjBjC,KAAKkN,YAAYiD,OAAO1O,GAAGkK,KAI7B,IAAI0C,MAAQzP,OAAOyB,OAAOiO,QAAQtO,MAC9BqO,OAAS,GACXzP,OAAOyB,OAAOkQ,OAAOlC,MAAO,GAI9B,IAAImC,UAAW,EACf,IAAK/O,EAAE,EAAGA,EAAE7C,OAAOyB,OAAOqB,OAAQD,IAChC,GAAI7C,OAAOyB,OAAOoB,GAAG2G,OAASpI,KAAKoI,MAAQpI,KAAKoI,KAAKkG,QAAQ1P,OAAOyB,OAAOoB,GAAG2G,OAAS,EAAG,CACxFoI,UAAW,EACX,MAgBJ,OAZIC,OAASD,iBACJC,MAAMzQ,KAAKoI,MAIpBxJ,OAAOgC,SAAU,EAGjBZ,KAAK4I,OAAS,WACd5I,KAAK0G,QAAU,GACf1G,KAAO,KAEA,MAWT0Q,GAAI,SAAS9F,MAAO1B,GAAIsC,GAAIyB,MAC1B,IACI0D,OADO9Q,KACO,MAAQ+K,OAM1B,MAJkB,mBAAP1B,IACTyH,OAAOnK,KAAKyG,KAAO,CAACzB,GAAQtC,GAAQ+D,MAAc,CAACzB,GAAQtC,KAJlDrJ,MAiBb+Q,IAAK,SAAShG,MAAO1B,GAAIsC,IACvB,IACImF,OADO9Q,KACO,MAAQ+K,OACtBnJ,EAAI,EAQR,GALkB,iBAAPyH,KACTsC,GAAKtC,GACLA,GAAK,MAGHA,IAAMsC,GAER,IAAK/J,EAAE,EAAGA,EAAEkP,OAAOjP,OAAQD,IAAK,CAC9B,IAAIoP,KAAQrF,KAAOmF,OAAOlP,GAAG+J,GAC7B,GAAItC,KAAOyH,OAAOlP,GAAGyH,IAAM2H,OAAS3H,IAAM2H,KAAM,CAC9CF,OAAOJ,OAAO9O,EAAG,GACjB,YAGC,GAAImJ,MAnBA/K,KAqBJ,MAAQ+K,OAAS,OACjB,CAEL,IAAIkG,KAAOC,OAAOD,KAxBTjR,MAyBT,IAAK4B,EAAE,EAAGA,EAAEqP,KAAKpP,OAAQD,IACS,IAA3BqP,KAAKrP,GAAG6M,QAAQ,QAAiBhP,MAAM0R,QA1BrCnR,KA0BkDiR,KAAKrP,OA1BvD5B,KA2BAiR,KAAKrP,IAAM,IAKtB,OAhCW5B,MA0CboN,KAAM,SAASrC,MAAO1B,GAAIsC,IAMxB,OALW3L,KAGN6Q,GAAG9F,MAAO1B,GAAIsC,GAAI,GAHZ3L,MAebkG,MAAO,SAAS6E,MAAOY,GAAIyF,KAKzB,IAJA,IACIN,OADO9Q,KACO,MAAQ+K,OAGjBnJ,EAAEkP,OAAOjP,OAAO,EAAGD,GAAG,EAAGA,IAE3BkP,OAAOlP,GAAG+J,IAAMmF,OAAOlP,GAAG+J,KAAOA,IAAgB,SAAVZ,QAC1C9D,WAAW,SAASoC,IAClBA,GAAGgI,KAAKrR,KAAM2L,GAAIyF,MAClBjE,KATKnN,KASM8Q,OAAOlP,GAAGyH,IAAK,GAGxByH,OAAOlP,GAAGwL,MAZPpN,KAaA+Q,IAAIhG,MAAO+F,OAAOlP,GAAGyH,GAAIyH,OAAOlP,GAAG+J,KAQ9C,OArBW3L,KAmBNiM,WAAWlB,OAnBL/K,MA8BbiM,WAAY,SAASlB,OAGnB,GAFW/K,KAEFiJ,OAAOpH,OAAS,EAAG,CAC1B,IAAIyP,KAHKtR,KAGOiJ,OAAO,GAGnBqI,KAAKvG,QAAUA,QANV/K,KAOFiJ,OAAOsI,QAPLvR,KAQFiM,cAIFlB,OACHuG,KAAKtG,SAIT,OAjBWhL,MAyBb6L,OAAQ,SAAS3J,OACf,IACIoG,OAASpG,MAAMmG,QAKnB,IANWrI,KAMD8B,WAAaI,MAAME,QAAUF,MAAME,MAAMoL,SAAWtL,MAAME,MAAMoP,OAAStP,MAAME,MAAMT,YAAcO,MAAMyK,MAEjH,OADA1F,WAPSjH,KAOO6L,OAAOsB,KAPdnN,KAOyBkC,OAAQ,KAPjClC,KAYX,IAAI8H,QAAU5F,MAAM2F,QAZT7H,KAYuBqI,QAAQC,QAAQ,IAWlD,GAvBWtI,KAeNkG,MAAM,MAAOhE,MAAM4J,MAfb9L,KAkBD8B,WAAagG,MAlBZ9H,KAmBJuC,KAAKL,MAAM4J,KAAK,GAAMxF,KAAKpE,MAAM4J,KAnB7B9L,KAuBF8B,WAAagG,KAAM,CAvBjB9H,KAwBJkG,MAAM,OAAQhE,MAAM4J,KACzB5J,MAAMmK,MAAQnK,MAAMwK,QAAU,EAC9BxK,MAAM6L,UAAY,EAClB7L,MAAM6K,WAAahO,OAAOmC,IAAIS,YAE9B,IAAI4K,QAA0C,KAA9BrK,MAAMyK,MAAQzK,MAAMwK,QAAkBP,KAAKK,IAAItK,MAAMiG,OA7B5DnI,KA8BJgJ,WAAW9G,MAAM4J,KAAO7E,WA9BpBjH,KA8BoC6L,OAAOsB,KA9B3CnN,KA8BsDkC,OAAQqK,SAuBzE,OArDWvM,KAkCF8B,YAAcgG,OACrB5F,MAAM4E,SAAU,EAChB5E,MAAM2J,QAAS,EACf3J,MAAMmK,MAAQnK,MAAMwK,QAAU,EAC9BxK,MAAM6L,UAAY,EAtCT/N,KAuCJqN,YAAYnL,MAAM4J,KAvCd9L,KA0CJkO,aAAahM,MAAME,OAGxBrD,OAAO+D,gBA7CE9C,KAiDD8B,WAAcgG,MAjDb9H,KAkDJuC,KAAKL,MAAM4J,KAAK,GAlDZ9L,MA6DbqN,YAAa,SAAS1B,IAGpB,GAFW3L,KAEFgJ,WAAW2C,IAAK,CAEvB,GAAmC,mBAJ1B3L,KAIOgJ,WAAW2C,IACzB3E,aALOhH,KAKWgJ,WAAW2C,SACxB,CACL,IAAIzJ,MAPGlC,KAOUmC,WAAWwJ,IACxBzJ,OAASA,MAAME,OACjBF,MAAME,MAAM6D,oBAAoB,QAT3BjG,KASyCgJ,WAAW2C,KAAK,UATzD3L,KAaGgJ,WAAW2C,IAGzB,OAhBW3L,MAwBbmC,WAAY,SAASwJ,IAInB,IAHA,IAGS/J,EAAE,EAAGA,EAHH5B,KAGU6G,QAAQhF,OAAQD,IACnC,GAAI+J,KAJK3L,KAIO6G,QAAQjF,GAAGkK,IACzB,OALO9L,KAKK6G,QAAQjF,GAIxB,OAAO,MAOTmK,eAAgB,WACH/L,KAENyR,SAGL,IAAK,IAAI7P,EAAE,EAAGA,EALH5B,KAKU6G,QAAQhF,OAAQD,IACnC,GANS5B,KAMA6G,QAAQjF,GAAGiK,OAClB,OAPO7L,KAOK6G,QAAQjF,GAAG8P,QAK3B,OAAO,IAAIlG,MAZAxL,OAkBbyR,OAAQ,WACN,IACIE,MADO3R,KACM+H,MACb6J,IAAM,EACNhQ,EAAI,EAGR,KANW5B,KAMF6G,QAAQhF,OAAS8P,OAA1B,CAKA,IAAK/P,EAAE,EAAGA,EAXC5B,KAWM6G,QAAQhF,OAAQD,IAXtB5B,KAYA6G,QAAQjF,GAAGiK,QAClB+F,MAKJ,IAAKhQ,EAlBM5B,KAkBC6G,QAAQhF,OAAS,EAAGD,GAAG,EAAGA,IAAK,CACzC,GAAIgQ,KAAOD,MACT,OApBO3R,KAuBA6G,QAAQjF,GAAGiK,SAvBX7L,KAyBE8B,WAzBF9B,KAyBoB6G,QAAQjF,GAAGQ,OAzB/BpC,KA0BA6G,QAAQjF,GAAGQ,MAAM4D,WAAW,GA1B5BhG,KA8BF6G,QAAQ6J,OAAO9O,EAAG,GACvBgQ,UAUN5P,aAAc,SAAS2J,IAGrB,QAAkB,IAAPA,GAAoB,CAE7B,IADA,IAAI5J,IAAM,GACDH,EAAE,EAAGA,EAJL5B,KAIY6G,QAAQhF,OAAQD,IACnCG,IAAI4E,KALG3G,KAKO6G,QAAQjF,GAAGkK,KAG3B,OAAO/J,IAEP,MAAO,CAAC4J,KASZmB,eAAgB,SAAS5K,OAsBvB,OAlBAA,MAAME,MAAM4K,aAAejO,OAAOmC,IAAIuE,qBACtCvD,MAAME,MAAM4K,aAAatH,OAASkL,MAJvB5Q,KAIkCuI,MAGzCrG,MAAM2P,QACR3P,MAAME,MAAM4K,aAAarH,QAAQzD,MAAM2P,SAEvC3P,MAAME,MAAM4K,aAAarH,QAAQzD,MAAME,OAIzCF,MAAME,MAAM4K,aAAalF,KAAO5F,MAAM2F,MAClC3F,MAAM2F,QACR3F,MAAME,MAAM4K,aAAa+C,UAAY7N,MAAMwK,QAAU,EACrDxK,MAAME,MAAM4K,aAAagD,QAAU9N,MAAMyK,OAAS,GAEpDzK,MAAME,MAAM4K,aAAaO,aAAa7L,eAAeQ,MAAMiG,MAAOpJ,OAAOmC,IAAIS,aAnBlE3B,MA6BbkO,aAAc,SAAStB,MACrB,IACIkF,MAAQ/S,OAAO6B,YAAc7B,OAAO6B,WAAWmR,OAAOtD,QAAQ,UAAY,EAE9E,GAAI1P,OAAOiG,gBAAkB4H,KAAKI,eAChCJ,KAAKI,aAAajH,QAAU,KAC5B6G,KAAKI,aAAahH,WAAW,GACzB8L,OACF,IAAMlF,KAAKI,aAAatH,OAAS3G,OAAOiG,eAAkB,MAAM/B,IAKpE,OAFA2J,KAAKI,aAAe,KAVThN,MAmBbqO,YAAa,SAASzB,MACN,kBAAkBoF,KAAKjT,OAAO6B,YAAc7B,OAAO6B,WAAW4C,aAE1EoJ,KAAKtF,IAAM,4FAYjB,IAAIkE,MAAQ,SAASyG,MACnBjS,KAAKkS,QAAUD,KACfjS,KAAKC,QAEPuL,MAAMtL,UAAY,CAKhBD,KAAM,WACJ,IACIkS,OADOnS,KACOkS,QAqBlB,OAtBWlS,KAINS,OAAS0R,OAAO1R,OAJVT,KAKN6H,MAAQsK,OAAOtK,MALT7H,KAMNU,QAAUyR,OAAOzR,QANXV,KAONmI,MAAQgK,OAAOhK,MAPTnI,KAQNqM,MAAQ,EARFrM,KASN8G,SAAU,EATJ9G,KAUN6L,QAAS,EAVH7L,KAWNqI,QAAU,YAXJrI,KAcN8L,MAAQ/M,OAAOqB,SAGpB+R,OAAOtL,QAAQF,KAjBJ3G,WAoBNoS,SApBMpS,MA6BboS,OAAQ,WACN,IACID,OADOnS,KACOkS,QACd7Q,OAAUtC,OAAO0B,QAFVT,KAEyBS,QAFzBT,KAEwCkS,QAAQzR,OAAU,EAF1DT,KAEmEU,QAkC9E,OAhCIyR,OAAOrQ,WAJA9B,KAMJoC,WAA0C,IAA1BrD,OAAOmC,IAAImR,WAA8BtT,OAAOmC,IAAIoR,iBAAmBvT,OAAOmC,IAAImR,aAN9FrS,KAOJoC,MAAMX,KAAKC,eAAeL,OAAQtC,OAAOmC,IAAIS,aAPzC3B,KAQJoC,MAAMoL,QAAS,EARXxN,KASJoC,MAAMuD,QAAQ5G,OAAO+B,aAChB/B,OAAOgC,UAVRf,KAYJoC,MAAQrD,OAAOoH,oBAZXnG,KAeJuQ,SAfIvQ,KAeYuS,eAAepF,KAf3BnN,WAgBJoC,MAAM9C,iBAAiB,QAhBnBU,KAgBiCuQ,UAAU,GAhB3CvQ,KAmBJwQ,QAnBIxQ,KAmBWwS,cAAcrF,KAnBzBnN,WAoBJoC,MAAM9C,iBAAiBP,OAAO4B,cApB1BX,KAoB8CwQ,SAAS,GApBvDxQ,KAwBJyQ,OAxBIzQ,KAwBUyS,aAAatF,KAxBvBnN,WAyBJoC,MAAM9C,iBAAiB,QAzBnBU,KAyBiCyQ,QAAQ,GAzBzCzQ,KA4BJoC,MAAMkF,IAAM6K,OAAO5J,KA5BfvI,KA6BJoC,MAAM8F,SAA8B,IAApBiK,OAAOlK,SAAoB,OAASkK,OAAOlK,SA7BvDjI,KA8BJoC,MAAMf,OAASA,OAAStC,OAAOsC,SA9B3BrB,KAiCJoC,MAAMkD,QAjCFtF,MA2Cb0R,MAAO,WACL,IACIS,OADOnS,KACOkS,QAgBlB,OAjBWlS,KAINS,OAAS0R,OAAO1R,OAJVT,KAKN6H,MAAQsK,OAAOtK,MALT7H,KAMNU,QAAUyR,OAAOzR,QANXV,KAONmI,MAAQgK,OAAOhK,MAPTnI,KAQNqM,MAAQ,EARFrM,KASN+N,UAAY,EATN/N,KAUN8G,SAAU,EAVJ9G,KAWN6L,QAAS,EAXH7L,KAYNqI,QAAU,YAZJrI,KAeN8L,MAAQ/M,OAAOqB,SAfTJ,MAuBbuS,eAAgB,WACHvS,KAGNkS,QAAQhM,MAAM,YAHRlG,KAG0B8L,IAH1B9L,KAGoCoC,MAAM7C,MAH1CS,KAGuDoC,MAAM7C,MAAMmT,KAAO,GAH1E1S,KAMNoC,MAAM6D,oBAAoB,QANpBjG,KAMkCuQ,UAAU,IAMzDiC,cAAe,WACb,IACIL,OADOnS,KACOkS,QAGlBC,OAAOrJ,UAAYqD,KAAKwG,KAA2B,GAJxC3S,KAIuBoC,MAAMkK,UAAiB,GAGd,IAAvC4E,OAAOD,KAAKkB,OAAO9J,SAASxG,SAC9BsQ,OAAO9J,QAAU,CAACuK,UAAW,CAAC,EAAsB,IAAnBT,OAAOrJ,aAGpB,WAAlBqJ,OAAOpJ,SACToJ,OAAOpJ,OAAS,SAChBoJ,OAAOjM,MAAM,QACbiM,OAAOlG,cAdEjM,KAkBNoC,MAAM6D,oBAAoBlH,OAAO4B,cAlB3BX,KAkB+CwQ,SAAS,IAMrEiC,aAAc,WACZ,IACIN,OADOnS,KACOkS,QAGdC,OAAOrJ,YAAcoE,MAGvBiF,OAAOrJ,UAAYqD,KAAKwG,KAA2B,GAP1C3S,KAOyBoC,MAAMkK,UAAiB,GAGrD6F,OAAO9J,QAAQuK,UAAU,KAAO1F,MAClCiF,OAAO9J,QAAQuK,UAAU,GAAwB,IAAnBT,OAAOrJ,WAIvCqJ,OAAOtG,OAfE7L,YAmBNoC,MAAM6D,oBAAoB,QAnBpBjG,KAmBkCyQ,QAAQ,KAOzD,IAAIG,MAAQ,GAMRnF,WAAa,SAAStL,MACxB,IAAI8K,IAAM9K,KAAKoI,KAGf,GAAIqI,MAAM3F,KAOR,OALA9K,KAAK2I,UAAY8H,MAAM3F,KAAKqB,cAG5BuG,UAAU1S,MAKZ,GAAI,sBAAsB6R,KAAK/G,KAAM,CAInC,IAFA,IAAI6H,KAAOC,KAAK9H,IAAIrH,MAAM,KAAK,IAC3BoP,SAAW,IAAIC,WAAWH,KAAKjR,QAC1BD,EAAE,EAAGA,EAAEkR,KAAKjR,SAAUD,EAC7BoR,SAASpR,GAAKkR,KAAKI,WAAWtR,GAGhCuR,gBAAgBH,SAAStN,OAAQvF,UAC5B,CAEL,IAAIwI,IAAM,IAAIyK,eACdzK,IAAI0K,KAAKlT,KAAKsI,KAAKC,OAAQuC,KAAK,GAChCtC,IAAIE,gBAAkB1I,KAAKsI,KAAKI,gBAChCF,IAAI2K,aAAe,cAGfnT,KAAKsI,KAAKG,SACZsI,OAAOD,KAAK9Q,KAAKsI,KAAKG,SAAS2K,SAAQ,SAASC,KAC9C7K,IAAI8K,iBAAiBD,IAAKrT,KAAKsI,KAAKG,QAAQ4K,SAIhD7K,IAAIc,OAAS,WAEX,IAAIiJ,MAAQ/J,IAAI+K,OAAS,IAAI,GAChB,MAAThB,MAAyB,MAATA,MAAyB,MAATA,KAKpCS,gBAAgBxK,IAAIgL,SAAUxT,MAJ5BA,KAAK+F,MAAM,YAAa,KAAM,0CAA4CyC,IAAI+K,OAAS,MAM3F/K,IAAIiL,QAAU,WAERzT,KAAK2B,YACP3B,KAAKwH,QAAS,EACdxH,KAAK2B,WAAY,EACjB3B,KAAK0G,QAAU,UACR+J,MAAM3F,KACb9K,KAAKmF,SAGTuO,YAAYlL,OAQZkL,YAAc,SAASlL,KACzB,IACEA,IAAImL,OACJ,MAAO7Q,GACP0F,IAAIiL,YASJT,gBAAkB,SAASY,YAAa5T,MAE1C,IAAIZ,MAAQ,WACVY,KAAK+F,MAAM,YAAa,KAAM,gCAI5B8N,QAAU,SAAStO,QACjBA,QAAUvF,KAAK0G,QAAQhF,OAAS,GAClC+O,MAAMzQ,KAAKoI,MAAQ7C,OACnBmN,UAAU1S,KAAMuF,SAEhBnG,SAKmB,oBAAZL,SAAiE,IAAtCH,OAAOmC,IAAIiS,gBAAgBtR,OAC/D9C,OAAOmC,IAAIiS,gBAAgBY,aAAatV,KAAKuV,SAASzN,MAAMhH,OAE5DR,OAAOmC,IAAIiS,gBAAgBY,YAAaC,QAASzU,QASjDsT,UAAY,SAAS1S,KAAMuF,QAEzBA,SAAWvF,KAAK2I,YAClB3I,KAAK2I,UAAYpD,OAAO4G,UAIe,IAArC4E,OAAOD,KAAK9Q,KAAKkI,SAASxG,SAC5B1B,KAAKkI,QAAU,CAACuK,UAAW,CAAC,EAAoB,IAAjBzS,KAAK2I,aAIlB,WAAhB3I,KAAK4I,SACP5I,KAAK4I,OAAS,SACd5I,KAAK+F,MAAM,QACX/F,KAAK8L,eAOLzK,kBAAoB,WAEtB,GAAKzC,OAAOiC,cAAZ,CAKA,IAC8B,oBAAjBiT,aACTlV,OAAOmC,IAAM,IAAI+S,aACsB,oBAAvBC,mBAChBnV,OAAOmC,IAAM,IAAIgT,mBAEjBnV,OAAOiC,eAAgB,EAEzB,MAAMiC,GACNlE,OAAOiC,eAAgB,EAIpBjC,OAAOmC,MACVnC,OAAOiC,eAAgB,GAKzB,IAAImT,IAAO,iBAAiBnC,KAAKjT,OAAO6B,YAAc7B,OAAO6B,WAAWwT,UACpEC,WAAatV,OAAO6B,YAAc7B,OAAO6B,WAAWyT,WAAW5Q,MAAM,0BACrE6Q,QAAUD,WAAa1Q,SAAS0Q,WAAW,GAAI,IAAM,KACzD,GAAIF,KAAOG,SAAWA,QAAU,EAAG,CACjC,IAAIC,OAAS,SAASvC,KAAKjT,OAAO6B,YAAc7B,OAAO6B,WAAW4C,UAAU4H,eACxErM,OAAO6B,aAAe2T,SACxBxV,OAAOiC,eAAgB,GAKvBjC,OAAOiC,gBACTjC,OAAO+B,gBAA+C,IAA1B/B,OAAOmC,IAAImR,WAA8BtT,OAAOmC,IAAIoR,iBAAmBvT,OAAOmC,IAAImR,aAC9GtT,OAAO+B,WAAWW,KAAKC,eAAe3C,OAAO0B,OAAS,EAAI1B,OAAO2B,QAAS3B,OAAOmC,IAAIS,aACrF5C,OAAO+B,WAAW6E,QAAQ5G,OAAOmC,IAAI0E,cAIvC7G,OAAOqC,gBAKD,8CACJ,MAAO,CACLrC,OACAqI,OAHE,cAAC,OAAD,8CAUNoN,eAAiBzV,OACjByV,aAAepN,UAIK,IAAXqN,uBACTA,sBAAO1U,aAAeA,aACtB0U,sBAAO1V,OAASA,OAChB0V,sBAAOrN,KAAOA,KACdqN,sBAAOjJ,MAAQA,OACY,oBAAX7M,SAChBA,OAAOoB,aAAeA,aACtBpB,OAAOI,OAASA,OAChBJ,OAAOyI,KAAOA,KACdzI,OAAO6M,MAAQA,OAz/EnB,GA0gFA,WAEE,aA8HuB,IAASkJ,OA3HhC3U,aAAaG,UAAUyU,KAAO,CAAC,EAAG,EAAG,GACrC5U,aAAaG,UAAU0U,aAAe,CAAC,EAAG,GAAI,EAAG,EAAG,EAAG,GAWvD7U,aAAaG,UAAU2U,OAAS,SAASC,KAIvC,IAHW9U,KAGDkB,MAHClB,KAGYkB,IAAI2M,SACzB,OAJS7N,KAQX,IAAK,IAAI4B,EARE5B,KAQKQ,OAAOqB,OAAO,EAAGD,GAAG,EAAGA,IAR5B5B,KASJQ,OAAOoB,GAAGiT,OAAOC,KAGxB,OAZW9U,MAuBbD,aAAaG,UAAU6U,IAAM,SAASC,EAAGC,EAAGC,GAI1C,OAHWlV,KAGDkB,KAHClB,KAGYkB,IAAI2M,UAK3BoH,EAAkB,iBAANA,EARDjV,KAQwB2U,KAAK,GAAKM,EAC7CC,EAAkB,iBAANA,EATDlV,KASwB2U,KAAK,GAAKO,EAE5B,iBAANF,EAXAhV,KAsBG2U,MAtBH3U,KAYJ2U,KAAO,CAACK,EAAGC,EAAGC,QAEwB,IAdlClV,KAcOkB,IAAI2M,SAASsH,WAdpBnV,KAeFkB,IAAI2M,SAASsH,UAAUC,gBAfrBpV,KAe0C2U,KAAK,GAAI5V,OAAOmC,IAAIS,YAAa,IAf3E3B,KAgBFkB,IAAI2M,SAASwH,UAAUD,gBAhBrBpV,KAgB0C2U,KAAK,GAAI5V,OAAOmC,IAAIS,YAAa,IAhB3E3B,KAiBFkB,IAAI2M,SAASyH,UAAUF,gBAjBrBpV,KAiB0C2U,KAAK,GAAI5V,OAAOmC,IAAIS,YAAa,KAjB3E3B,KAmBFkB,IAAI2M,SAAS0H,YAnBXvV,KAmB4B2U,KAAK,GAnBjC3U,KAmB0C2U,KAAK,GAnB/C3U,KAmBwD2U,KAAK,IAnB7D3U,aA0CbD,aAAaG,UAAUsV,YAAc,SAASR,EAAGC,EAAGC,EAAGO,IAAKC,IAAKC,KAI/D,IAHW3V,KAGDkB,MAHClB,KAGYkB,IAAI2M,SACzB,OAJS7N,KAQX,IAAI4V,GARO5V,KAQG4U,aAOd,OANAK,EAAkB,iBAANA,EAAkBW,GAAG,GAAKX,EACtCC,EAAkB,iBAANA,EAAkBU,GAAG,GAAKV,EACtCO,IAAsB,iBAARA,IAAoBG,GAAG,GAAKH,IAC1CC,IAAsB,iBAARA,IAAoBE,GAAG,GAAKF,IAC1CC,IAAsB,iBAARA,IAAoBC,GAAG,GAAKD,IAEzB,iBAANX,EAcFY,IA7BE5V,KAgBJ4U,aAAe,CAACI,EAAGC,EAAGC,EAAGO,IAAKC,IAAKC,UAEE,IAlBjC3V,KAkBOkB,IAAI2M,SAASgI,UAlBpB7V,KAmBFkB,IAAI2M,SAASgI,SAAST,gBAAgBJ,EAAGjW,OAAOmC,IAAIS,YAAa,IAnB/D3B,KAoBFkB,IAAI2M,SAASiI,SAASV,gBAAgBH,EAAGlW,OAAOmC,IAAIS,YAAa,IApB/D3B,KAqBFkB,IAAI2M,SAASkI,SAASX,gBAAgBF,EAAGnW,OAAOmC,IAAIS,YAAa,IArB/D3B,KAsBFkB,IAAI2M,SAASmI,IAAIZ,gBAAgBK,IAAK1W,OAAOmC,IAAIS,YAAa,IAtB5D3B,KAuBFkB,IAAI2M,SAASoI,IAAIb,gBAAgBM,IAAK3W,OAAOmC,IAAIS,YAAa,IAvB5D3B,KAwBFkB,IAAI2M,SAASqI,IAAId,gBAAgBO,IAAK5W,OAAOmC,IAAIS,YAAa,KAxB5D3B,KA0BFkB,IAAI2M,SAASsI,eAAenB,EAAGC,EAAGC,EAAGO,IAAKC,IAAKC,KA1B7C3V,OA2CboH,KAAKlH,UAAUD,MAAiByU,OA2B7BtN,KAAKlH,UAAUD,KA1BT,SAASoH,GAwBd,OAvBWrH,KAGN4U,aAAevN,EAAEmO,aAAe,CAAC,EAAG,EAAG,GAHjCxV,KAINoW,QAAU/O,EAAEwN,QAAU,KAJhB7U,KAKN2U,KAAOtN,EAAE0N,KAAO,KALV/U,KAMNqW,YAAc,CACjBC,oBAA4C,IAArBjP,EAAEiP,eAAiCjP,EAAEiP,eAAiB,IAC7EC,oBAA4C,IAArBlP,EAAEkP,eAAiClP,EAAEkP,eAAiB,IAC7EC,mBAA0C,IAApBnP,EAAEmP,cAAgCnP,EAAEmP,cAAgB,EAC1EC,mBAA0C,IAApBpP,EAAEoP,cAAgCpP,EAAEoP,cAAgB,UAC1EC,iBAAsC,IAAlBrP,EAAEqP,YAA8BrP,EAAEqP,YAAc,IACpEC,kBAAwC,IAAnBtP,EAAEsP,aAA+BtP,EAAEsP,aAAe,OACvEC,iBAAsC,IAAlBvP,EAAEuP,YAA8BvP,EAAEuP,YAAc,EACpEC,mBAA0C,IAApBxP,EAAEwP,cAAgCxP,EAAEwP,cAAgB,GAdjE7W,KAkBN8W,UAAYzP,EAAE0P,SAAW,CAAC,CAAC1N,GAAIhC,EAAE0P,WAAa,GAlBxC/W,KAmBNgX,OAAS3P,EAAE4P,MAAQ,CAAC,CAAC5N,GAAIhC,EAAE4P,QAAU,GAnB/BjX,KAoBNkX,eAAiB7P,EAAE8P,cAAgB,CAAC,CAAC9N,GAAIhC,EAAE8P,gBAAkB,GAG3DzC,OAAOrD,KAAKrR,KAAMqH,KAU7BD,KAAKlH,UAAU2U,OAAS,SAASC,IAAKnJ,IACpC,IAAIxL,KAAOH,KAGX,IAAKG,KAAK2B,UACR,OAAO3B,KAIT,GAAoB,WAAhBA,KAAK4I,OAQP,OAPA5I,KAAK8I,OAAOtC,KAAK,CACfoE,MAAO,SACPC,OAAQ,WACN7K,KAAK0U,OAAOC,IAAKnJ,OAIdxL,KAIT,IAAIiX,gBAAuD,IAAlCrY,OAAOmC,IAAImW,mBAAsC,UAAY,SAGtF,QAAkB,IAAP1L,GAAoB,CAE7B,GAAmB,iBAARmJ,IAIT,OAAO3U,KAAKiW,QAHZjW,KAAKiW,QAAUtB,IACf3U,KAAKwU,KAAO,CAACG,IAAK,EAAG,GAQzB,IADA,IAAI/S,IAAM5B,KAAK6B,aAAa2J,IACnB/J,EAAE,EAAGA,EAAEG,IAAIF,OAAQD,IAAK,CAE/B,IAAIM,MAAQ/B,KAAKgC,WAAWJ,IAAIH,IAEhC,GAAIM,MAAO,CACT,GAAmB,iBAAR4S,IA4BT,OAAO5S,MAAMkU,QA3BblU,MAAMkU,QAAUtB,IAChB5S,MAAMyS,KAAO,CAACG,IAAK,EAAG,GAElB5S,MAAME,QAERF,MAAMmU,YAAYM,aAAe,aAG5BzU,MAAM2P,SAAY3P,MAAM2P,QAAQiD,KACnCwC,YAAYpV,MAAOkV,YAGF,YAAfA,gBACqC,IAA5BlV,MAAM2P,QAAQsD,WACvBjT,MAAM2P,QAAQsD,UAAUzT,eAAeoT,IAAK/V,OAAOmC,IAAIS,aACvDO,MAAM2P,QAAQwD,UAAU3T,eAAe,EAAG3C,OAAOmC,IAAIS,aACrDO,MAAM2P,QAAQyD,UAAU5T,eAAe,EAAG3C,OAAOmC,IAAIS,cAErDO,MAAM2P,QAAQ0D,YAAYT,IAAK,EAAG,GAGpC5S,MAAM2P,QAAQiD,IAAIpT,eAAeoT,IAAK/V,OAAOmC,IAAIS,cAIrDxB,KAAK+F,MAAM,SAAUhE,MAAM4J,MAOjC,OAAO3L,MAWTiH,KAAKlH,UAAU6U,IAAM,SAASC,EAAGC,EAAGC,EAAGvJ,IACrC,IAAIxL,KAAOH,KAGX,IAAKG,KAAK2B,UACR,OAAO3B,KAIT,GAAoB,WAAhBA,KAAK4I,OAQP,OAPA5I,KAAK8I,OAAOtC,KAAK,CACfoE,MAAO,MACPC,OAAQ,WACN7K,KAAK4U,IAAIC,EAAGC,EAAGC,EAAGvJ,OAIfxL,KAQT,GAJA8U,EAAkB,iBAANA,EAAkB,EAAIA,EAClCC,EAAkB,iBAANA,GAAmB,GAAMA,OAGnB,IAAPvJ,GAAoB,CAE7B,GAAiB,iBAANqJ,EAGT,OAAO7U,KAAKwU,KAFZxU,KAAKwU,KAAO,CAACK,EAAGC,EAAGC,GAQvB,IADA,IAAInT,IAAM5B,KAAK6B,aAAa2J,IACnB/J,EAAE,EAAGA,EAAEG,IAAIF,OAAQD,IAAK,CAE/B,IAAIM,MAAQ/B,KAAKgC,WAAWJ,IAAIH,IAEhC,GAAIM,MAAO,CACT,GAAiB,iBAAN8S,EAoBT,OAAO9S,MAAMyS,KAnBbzS,MAAMyS,KAAO,CAACK,EAAGC,EAAGC,GAEhBhT,MAAME,QAEHF,MAAM2P,UAAW3P,MAAM2P,QAAQiD,KAClCwC,YAAYpV,MAAO,gBAGkB,IAA5BA,MAAM2P,QAAQsD,WACvBjT,MAAM2P,QAAQsD,UAAUzT,eAAesT,EAAGjW,OAAOmC,IAAIS,aACrDO,MAAM2P,QAAQwD,UAAU3T,eAAeuT,EAAGlW,OAAOmC,IAAIS,aACrDO,MAAM2P,QAAQyD,UAAU5T,eAAewT,EAAGnW,OAAOmC,IAAIS,cAErDO,MAAM2P,QAAQ0D,YAAYP,EAAGC,EAAGC,IAIpC/U,KAAK+F,MAAM,MAAOhE,MAAM4J,MAO9B,OAAO3L,MAaTiH,KAAKlH,UAAUsV,YAAc,SAASR,EAAGC,EAAGC,EAAGvJ,IAC7C,IAAIxL,KAAOH,KAGX,IAAKG,KAAK2B,UACR,OAAO3B,KAIT,GAAoB,WAAhBA,KAAK4I,OAQP,OAPA5I,KAAK8I,OAAOtC,KAAK,CACfoE,MAAO,cACPC,OAAQ,WACN7K,KAAKqV,YAAYR,EAAGC,EAAGC,EAAGvJ,OAIvBxL,KAQT,GAJA8U,EAAkB,iBAANA,EAAkB9U,KAAKyU,aAAa,GAAKK,EACrDC,EAAkB,iBAANA,EAAkB/U,KAAKyU,aAAa,GAAKM,OAGnC,IAAPvJ,GAAoB,CAE7B,GAAiB,iBAANqJ,EAGT,OAAO7U,KAAKyU,aAFZzU,KAAKyU,aAAe,CAACI,EAAGC,EAAGC,GAQ/B,IADA,IAAInT,IAAM5B,KAAK6B,aAAa2J,IACnB/J,EAAE,EAAGA,EAAEG,IAAIF,OAAQD,IAAK,CAE/B,IAAIM,MAAQ/B,KAAKgC,WAAWJ,IAAIH,IAEhC,GAAIM,MAAO,CACT,GAAiB,iBAAN8S,EAyBT,OAAO9S,MAAM0S,aAxBb1S,MAAM0S,aAAe,CAACI,EAAGC,EAAGC,GAExBhT,MAAME,QAEHF,MAAM2P,UAEJ3P,MAAMyS,OACTzS,MAAMyS,KAAOxU,KAAKwU,MAAQ,CAAC,EAAG,GAAI,KAGpC2C,YAAYpV,MAAO,iBAGqB,IAA/BA,MAAM2P,QAAQ0F,cACvBrV,MAAM2P,QAAQ0F,aAAa7V,eAAesT,EAAGjW,OAAOmC,IAAIS,aACxDO,MAAM2P,QAAQ2F,aAAa9V,eAAeuT,EAAGlW,OAAOmC,IAAIS,aACxDO,MAAM2P,QAAQ4F,aAAa/V,eAAewT,EAAGnW,OAAOmC,IAAIS,cAExDO,MAAM2P,QAAQsE,eAAenB,EAAGC,EAAGC,IAIvC/U,KAAK+F,MAAM,cAAehE,MAAM4J,MAOtC,OAAO3L,MAiCTiH,KAAKlH,UAAUwX,WAAa,WAC1B,IAEIrQ,EAAGsE,GAAIzJ,MAFP/B,KAAOH,KACPuO,KAAOH,UAIX,IAAKjO,KAAK2B,UACR,OAAO3B,KAIT,GAAoB,IAAhBoO,KAAK1M,OAEP,OAAO1B,KAAKkW,YACP,GAAoB,IAAhB9H,KAAK1M,OAAc,CAC5B,GAAuB,iBAAZ0M,KAAK,GAgCd,OADArM,MAAQ/B,KAAKgC,WAAWwB,SAAS4K,KAAK,GAAI,MAC3BrM,MAAMmU,YAAclW,KAAKkW,YA/BxChP,EAAIkH,KAAK,QAGS,IAAP5C,KACJtE,EAAEqQ,aACLrQ,EAAEqQ,WAAa,CACbpB,eAAgBjP,EAAEiP,eAClBC,eAAgBlP,EAAEkP,eAClBC,cAAenP,EAAEmP,cACjBC,cAAepP,EAAEoP,cACjBC,YAAarP,EAAEqP,YACfE,YAAavP,EAAEuP,YACfC,cAAexP,EAAEwP,cACjBF,aAActP,EAAEsP,eAIpBxW,KAAKkW,YAAc,CACjBC,oBAAuD,IAAhCjP,EAAEqQ,WAAWpB,eAAiCjP,EAAEqQ,WAAWpB,eAAiBnW,KAAKwX,gBACxGpB,oBAAuD,IAAhClP,EAAEqQ,WAAWnB,eAAiClP,EAAEqQ,WAAWnB,eAAiBpW,KAAKyX,gBACxGpB,mBAAqD,IAA/BnP,EAAEqQ,WAAWlB,cAAgCnP,EAAEqQ,WAAWlB,cAAgBrW,KAAK0X,eACrGpB,mBAAqD,IAA/BpP,EAAEqQ,WAAWjB,cAAgCpP,EAAEqQ,WAAWjB,cAAgBtW,KAAK2X,eACrGpB,iBAAiD,IAA7BrP,EAAEqQ,WAAWhB,YAA8BrP,EAAEqQ,WAAWhB,YAAcvW,KAAK4X,aAC/FnB,iBAAiD,IAA7BvP,EAAEqQ,WAAWd,YAA8BvP,EAAEqQ,WAAWd,YAAczW,KAAK6X,aAC/FnB,mBAAqD,IAA/BxP,EAAEqQ,WAAWb,cAAgCxP,EAAEqQ,WAAWb,cAAgB1W,KAAK8X,eACrGtB,kBAAmD,IAA9BtP,EAAEqQ,WAAWf,aAA+BtP,EAAEqQ,WAAWf,aAAexW,KAAK+X,qBAQ/E,IAAhB3J,KAAK1M,SACdwF,EAAIkH,KAAK,GACT5C,GAAKhI,SAAS4K,KAAK,GAAI,KAKzB,IADA,IAAIxM,IAAM5B,KAAK6B,aAAa2J,IACnB/J,EAAE,EAAGA,EAAEG,IAAIF,OAAQD,IAG1B,GAFAM,MAAQ/B,KAAKgC,WAAWJ,IAAIH,IAEjB,CAET,IAAIuW,GAAKjW,MAAMmU,YACf8B,GAAK,CACH7B,oBAA4C,IAArBjP,EAAEiP,eAAiCjP,EAAEiP,eAAiB6B,GAAG7B,eAChFC,oBAA4C,IAArBlP,EAAEkP,eAAiClP,EAAEkP,eAAiB4B,GAAG5B,eAChFC,mBAA0C,IAApBnP,EAAEmP,cAAgCnP,EAAEmP,cAAgB2B,GAAG3B,cAC7EC,mBAA0C,IAApBpP,EAAEoP,cAAgCpP,EAAEoP,cAAgB0B,GAAG1B,cAC7EC,iBAAsC,IAAlBrP,EAAEqP,YAA8BrP,EAAEqP,YAAcyB,GAAGzB,YACvEE,iBAAsC,IAAlBvP,EAAEuP,YAA8BvP,EAAEuP,YAAcuB,GAAGvB,YACvEC,mBAA0C,IAApBxP,EAAEwP,cAAgCxP,EAAEwP,cAAgBsB,GAAGtB,cAC7EF,kBAAwC,IAAnBtP,EAAEsP,aAA+BtP,EAAEsP,aAAewB,GAAGxB,cAI5E,IAAIyB,OAASlW,MAAM2P,QACfuG,QACFA,OAAO9B,eAAiB6B,GAAG7B,eAC3B8B,OAAO7B,eAAiB4B,GAAG5B,eAC3B6B,OAAO5B,cAAgB2B,GAAG3B,cAC1B4B,OAAO3B,cAAgB0B,GAAG1B,cAC1B2B,OAAO1B,YAAcyB,GAAGzB,YACxB0B,OAAOxB,YAAcuB,GAAGvB,YACxBwB,OAAOvB,cAAgBsB,GAAGtB,cAC1BuB,OAAOzB,aAAewB,GAAGxB,eAGpBzU,MAAMyS,OACTzS,MAAMyS,KAAOxU,KAAKwU,MAAQ,CAAC,EAAG,GAAI,KAIpC2C,YAAYpV,MAAO,YAKzB,OAAO/B,MAWTqL,MAAMtL,UAAUD,KAAQ,SAASyU,QAC/B,OAAO,WACL,IACIvC,OADOnS,KACOkS,QADPlS,KAIN4U,aAAezC,OAAOyC,aAJhB5U,KAKNoW,QAAUjE,OAAOiE,QALXpW,KAMN2U,KAAOxC,OAAOwC,KANR3U,KAONqW,YAAclE,OAAOkE,YAG1B3B,OAAOrD,KAAKrR,MAVDA,KAaFoW,QACPjE,OAAO0C,OAdE7U,KAcUoW,SAdVpW,KAeK2U,MACdxC,OAAO4C,IAhBE/U,KAgBO2U,KAAK,GAhBZ3U,KAgBqB2U,KAAK,GAhB1B3U,KAgBmC2U,KAAK,GAhBxC3U,KAgBiD8L,MAlBxC,CAqBrBN,MAAMtL,UAAUD,MAOnBuL,MAAMtL,UAAUwR,MAAS,SAASgD,QAChC,OAAO,WACL,IACIvC,OADOnS,KACOkS,QAqBlB,OAtBWlS,KAIN4U,aAAezC,OAAOyC,aAJhB5U,KAKNoW,QAAUjE,OAAOiE,QALXpW,KAMN2U,KAAOxC,OAAOwC,KANR3U,KAONqW,YAAclE,OAAOkE,YAPfrW,KAUFoW,QACPjE,OAAO0C,OAXE7U,KAWUoW,SAXVpW,KAYK2U,KACdxC,OAAO4C,IAbE/U,KAaO2U,KAAK,GAbZ3U,KAaqB2U,KAAK,GAb1B3U,KAamC2U,KAAK,GAbxC3U,KAaiD8L,KAbjD9L,KAcK6R,UAdL7R,KAgBJ6R,QAAQ7L,WAAW,GAhBfhG,KAiBJ6R,aAAUrJ,EACf2J,OAAOrF,eAlBE9M,OAsBJ0U,OAAOrD,KAAKrR,OAxBE,CA0BtBwL,MAAMtL,UAAUwR,OAUnB,IAAI4F,YAAc,SAASpV,MAAOmW,MAInB,aAHbA,KAAOA,MAAQ,YAIbnW,MAAM2P,QAAU9S,OAAOmC,IAAIoX,eAC3BpW,MAAM2P,QAAQyE,eAAiBpU,MAAMmU,YAAYC,eACjDpU,MAAM2P,QAAQ0E,eAAiBrU,MAAMmU,YAAYE,eACjDrU,MAAM2P,QAAQ2E,cAAgBtU,MAAMmU,YAAYG,cAChDtU,MAAM2P,QAAQ4E,cAAgBvU,MAAMmU,YAAYI,cAChDvU,MAAM2P,QAAQ6E,YAAcxU,MAAMmU,YAAYK,YAC9CxU,MAAM2P,QAAQ+E,YAAc1U,MAAMmU,YAAYO,YAC9C1U,MAAM2P,QAAQgF,cAAgB3U,MAAMmU,YAAYQ,cAChD3U,MAAM2P,QAAQ8E,aAAezU,MAAMmU,YAAYM,kBAER,IAA5BzU,MAAM2P,QAAQsD,WACvBjT,MAAM2P,QAAQsD,UAAUzT,eAAeQ,MAAMyS,KAAK,GAAI5V,OAAOmC,IAAIS,aACjEO,MAAM2P,QAAQwD,UAAU3T,eAAeQ,MAAMyS,KAAK,GAAI5V,OAAOmC,IAAIS,aACjEO,MAAM2P,QAAQyD,UAAU5T,eAAeQ,MAAMyS,KAAK,GAAI5V,OAAOmC,IAAIS,cAEjEO,MAAM2P,QAAQ0D,YAAYrT,MAAMyS,KAAK,GAAIzS,MAAMyS,KAAK,GAAIzS,MAAMyS,KAAK,SAG3B,IAA/BzS,MAAM2P,QAAQ0F,cACvBrV,MAAM2P,QAAQ0F,aAAa7V,eAAeQ,MAAM0S,aAAa,GAAI7V,OAAOmC,IAAIS,aAC5EO,MAAM2P,QAAQ2F,aAAa9V,eAAeQ,MAAM0S,aAAa,GAAI7V,OAAOmC,IAAIS,aAC5EO,MAAM2P,QAAQ4F,aAAa/V,eAAeQ,MAAM0S,aAAa,GAAI7V,OAAOmC,IAAIS,cAE5EO,MAAM2P,QAAQsE,eAAejU,MAAM0S,aAAa,GAAI1S,MAAM0S,aAAa,GAAI1S,MAAM0S,aAAa,MAGhG1S,MAAM2P,QAAU9S,OAAOmC,IAAImW,qBAC3BnV,MAAM2P,QAAQiD,IAAIpT,eAAeQ,MAAMkU,QAASrX,OAAOmC,IAAIS,cAG7DO,MAAM2P,QAAQlM,QAAQzD,MAAME,OAGvBF,MAAM4E,SACT5E,MAAMgQ,QAAQpE,MAAM5L,MAAM4J,KAAK,GAAMxF,KAAKpE,MAAM4J,KAAK,IAjoB3D,I,u+FCl/Ee,MAAMyM,KAGjB,UACI,OAAOvY,KAAKwY,OAAOA,OAGvBC,cAAc,iDACVzY,KAAKwY,OAAS,IAAIE,0CAAI1Y,MACtBA,KAAK2Y,MAAQ,IAAIC,oDAAa5Y,MAC9BA,KAAK6Y,MAAQ,IAAIC,yDAAa9Y,MAC9BA,KAAK+Y,MAAQ,IAAIC,oDAAahZ,MAC9BA,KAAKiZ,SAAW,IAAIC,8DAASlZ,MAC7BA,KAAK6C,MAAQ,IAAIsW,wDAAiBnZ,MAClCA,KAAKoZ,MAAQ,IAAIC,yDAAarZ,MAC9BA,KAAKsZ,OAAS,IAAIC,oDAAavZ,MAC/BA,KAAKF,IAAM,IAAI0Z,kDAAWxZ,MAC1BA,KAAKyZ,OAAS,IAAIC,qDAAc1Z,MAChCA,KAAK2Z,SAAW,IAAIC,sDAAe5Z,MACnCA,KAAK6Z,OAAS,IAAIC,oDAAc9Z,MAChCA,KAAK+Z,SAAW,IAAIC,2DAAeha,MACnCA,KAAKia,QAAU,IAAIC,4DAAcla,MACjCA,KAAKma,MAAQ,IAAIC,4DAAgBpa,MACjCA,KAAKwG,QAAU,IAAI6T,sDAAera,MAClCA,KAAKsa,SAAW,IAAIC,sDAAeva,MAEnCA,KAAKwa,aAAe,IAAIC,2DAAaza,MACrCA,KAAK0a,YAAc,IAAIC,2DAAY3a,MACnCA,KAAK4a,aAAe,IAAIC,4DAAa7a,MACrCA,KAAK8a,UAAY,IAAIA,yDAAU9a,MAC/BA,KAAK+a,aAAe,IAAIC,2DAAahb,MACrCA,KAAKib,SAAW,IAAIA,uDAASjb,MAC7BA,KAAKkb,UAAY,IAAIC,8DAAenb,MACpCA,KAAKob,IAAM,IAAIC,mEAAoBrb,MACnCA,KAAKsb,cAAgB,IAAIC,6DAAcvb,MACvCA,KAAKwb,aAAe,IAAIC,4DAAazb,MACrCA,KAAK0b,WAAa,IAAIC,0DAAW3b,MACjCA,KAAK4b,WAAa,IAAIC,0DAAW7b,MACjCA,KAAK8b,YAAc,IAAIC,iEAAkB/b,MACzCA,KAAKgc,UAAY,IAAIC,6DAAcjc,MACnCA,KAAKkc,YAAc,IAAIC,iEAAkBnc,MACzCA,KAAKoc,kBAAoB,IAAIC,iEAAkBrc,MAGnDlB,QACI,sBAAAkB,KAAA,YAAmBuP,KAAKC,OACxBxP,KAAKsc,UAAYtc,KAAK8H,KAAKqF,KAAKnN,MAChCuc,sBAAsBvc,KAAK8H,KAAKqF,KAAKnN,OAGzCwc,uBAAuBC,IACnB,IAAK,IAAI7a,EAAI,EAAGA,EAAI,GAAIA,IAAK,CACzB5B,KAAK+Y,MAAM2D,OAAOD,IAElB,MAAME,WAAa3c,KAAKwa,aAAakC,OAAOD,IAc5C,GAZAzc,KAAKkc,YAAYQ,OAAOD,IACxBzc,KAAKoc,kBAAkBM,OAAOD,IAC9Bzc,KAAKwb,aAAakB,OAAOD,IACzBzc,KAAK0b,WAAWgB,OAAOD,IACvBzc,KAAK4b,WAAWc,OAAOD,IACvBzc,KAAK8b,YAAYY,OAAOD,IACxBzc,KAAK4a,aAAa8B,OAAOD,IACzBzc,KAAKgc,UAAUU,OAAOD,IACtBzc,KAAK0a,YAAYgC,OAAOD,IACxBzc,KAAKsb,cAAcoB,OAAOD,IAC1Bzc,KAAKsZ,OAAOoD,OAAOD,IAEfE,WAEA,YADA3c,KAAK4c,oBAAoBH,KAMrCG,oBAAoBH,IAChBzc,KAAK8a,UAAU4B,OAAOD,IACtBzc,KAAK+a,aAAa2B,OAAOD,IACzBzc,KAAKkb,UAAUwB,OAAOD,IACtBzc,KAAKib,SAASyB,OAAOD,IACrBzc,KAAKF,IAAI4c,OAAOD,IAChBzc,KAAKwG,QAAQqW,OAAOJ,IAGxB3U,KAAKgV,GACD,MAAMtN,IAAMD,KAAKC,MACXiN,GAAKjN,I,gOAAM,CAAAxP,KAAH,aAEdA,KAAKia,QAAQyC,OAAOD,IACpBzc,KAAKob,IAAIsB,OAAOD,IAChBzc,KAAKiZ,SAAS4D,SAEd,sBAAA7c,KAAA,YAAmBwP,KAEnB+M,sBAAsBvc,KAAKsc,YAI5B,MAAM1d,KAAO,IAAI2Z,M,q0BChIT,MAAMW,iBAAiB6D,8CAMlC,cACI,6BAAO/c,KAAP,UAGJ,aACI,OAAOA,KAAKgd,QAAQC,OAGxBxE,YAAY7Z,MACRse,MAAMte,MADQ,iCAbN,IAaM,kCAZL,IAYK,0CAXF,KAWE,qCAVP,QAaPue,wDAAe5J,SAAS6J,cACpB,sBAAApd,KAAA,eAAmBod,YAAYC,MAAQD,e,4UAG3C,CAAApd,KAAA,SAAgB,IAAIsd,8CAAQ,CACxBC,MAAO,GACPC,OAAQ,GACRC,UAAWzd,KAAKyd,UAChBC,WAAY1d,KAAK0d,cAGrB/d,SAASge,KAAKC,YAAY5d,KAAKgd,QAAQC,QAG3CY,cAAcN,MAAOC,OAAQM,MACzB9d,KAAKgd,QAAQe,QAAQR,MAAOC,OAAQM,MAGxCE,KAAKhJ,EAAGC,EAAGgJ,KAAMC,IAAM,UAAWC,IAAM,OAAQC,IAC5C,MAAM9V,OAAS,sBAAAtI,KAAA,eAAmBqe,MAAMC,UAAUL,MAElDje,KAAKgd,QAAQgB,KAAKhJ,EAAGC,EAAG3M,OAAQ4V,IAAKC,IAAKC,IAG9CG,OAAOvJ,EAAGC,EAAGgJ,KAAMC,IAAM,UAAWC,IAAM,OAAQC,IAC9C,MAAM9V,OAAS,sBAAAtI,KAAA,eAAmBwe,GAAGF,UAAUL,MAE/Cje,KAAKgd,QAAQgB,KAAKhJ,EAAGC,EAAG3M,OAAQ4V,IAAKC,IAAKC,IAG9CK,iBAAiBC,MACb,MAAqB,GAAdA,KAAK7c,OAGhB8c,qBAAqBD,MACjB,OAAOvS,KAAKwG,KAAK3S,KAAKye,iBAAiBC,OAG3CE,iBAAiB5J,EAAGC,EAAGsI,MAAOmB,KAAMR,IAAKC,IAAKC,IAC1C,GAAIpe,KAAK2e,qBAAqBD,MAAQnB,MAClC,OAAOvd,KAAK6e,SAAS7J,EAAGC,EAAGyJ,KAAMR,IAAKC,IAAKC,IAG/C,IAAIU,KACAC,MACAC,WAAa,EAEjB,IAAK,IAAIpd,EAAI,EAAGA,EAAI8c,KAAK7c,OAAQD,IAAK,CAClC,MAAMqd,SAAWP,KAAKQ,OAAO,EAAGtd,GAEhC,GAAI5B,KAAK2e,qBAAqBM,WAAa1B,MACvC,MAGmB,MAAnBmB,KAAKS,OAAOvd,KACZkd,KAAOG,SACPF,MAAQL,KAAKQ,OAAOtd,EAAG8c,KAAK7c,OAASid,KAAKjd,QAAQud,WAClDJ,UAAYpd,GAIhBod,WAAa,IACbhf,KAAK6e,SAAS7J,EAAGC,EAAG6J,KAAMZ,IAAKC,IAAKC,IACpCpe,KAAK4e,iBAAiB5J,EAAGC,EAAI,EAAGsI,MAAOwB,MAAOb,IAAKC,IAAKC,KAIhES,SAAS7J,EAAGC,EAAGyJ,KAAMR,IAAM,UAAWC,IAAM,OAAQC,IAChD,IAAK,IAAIxc,EAAI,EAAGA,EAAI8c,KAAK7c,OAAQD,IAAK,CAClC,MAAM0G,OAAS,sBAAAtI,KAAA,eAAmBqf,KAAKf,UAAUI,KAAKS,OAAOvd,IAE7D5B,KAAKgd,QAAQgB,KAAKhJ,EAAI,GAAMpT,EAAGqT,EAAG3M,OAAQ4V,IAAKC,IAAKC,KAI5DkB,eAAerK,EAAGyJ,KAAMR,IAAM,UAAWC,IAAM,OAAQC,IACnD,MAAMvP,IAAM7O,KAAKye,iBAAiBC,MAElC1e,KAAK6e,SACD1S,KAAKwG,MAAM3S,KAAKpB,KAAK6a,OAAO8D,MAAQ1O,KAAO,GAC3CoG,EACAyJ,KACAR,IACAC,IACAC,IAIRmB,QACIvf,KAAKgd,QAAQuC,QAGjBC,UAAUxK,EAAGC,EAAGsI,MAAOC,QACnBxd,KAAKgd,QAAQwC,UAAUxK,EAAGC,EAAGsI,MAAOC,QAGxCiC,SAASC,IAAKC,KAIV,MAAO,CAAE3K,EAHC7I,KAAKyT,MAAMF,IAAM1f,KAAKyd,WAGpBxI,EAFF9I,KAAKyT,MAAMD,IAAM3f,KAAK0d,aAKpCb,SACI7c,KAAKgd,QAAQH,Y,mNC7HN,MAAME,QAGjB,WACI,O,gOAAA,CAAO/c,KAAP,OAGJyY,YAAY7Z,MAAM,2C,4UACd,CAAAoB,KAAA,MAAapB,MAGjBihB,aACAC,sB,+ZCVW,MAAMxC,QAWjB7E,aAAY,oCAA0C,gLAN/C,GAM+C,0JAFzC,WAGTzY,KAAKyd,UAAYA,UACjBzd,KAAK0d,WAAaA,WAElB1d,KAAK+f,MAAQ,IAAIC,iDAAa,EAARzC,MAAWC,QAAQ,IAAM,OAC/Cxd,KAAK+f,MAAME,iBAAkB,EAE7BjgB,KAAKid,OAAStd,SAASugB,cAAc,UACrClgB,KAAKkB,IAAMlB,KAAKid,OAAOkD,WAAW,KAAM,CAAEC,OAAO,IACjDpgB,KAAKkB,IAAImf,yBAA2B,mBAEpCrgB,KAAKkB,IAAIme,KAAT,UAAmBrf,KAAK0d,WAAxB,gBACA1d,KAAKkB,IAAIof,aAAe,MAExBtgB,KAAK+d,QAAQR,MAAOC,QAGxBO,QAAQR,MAAOC,OAAQM,MACnB9d,KAAKud,MAAQA,MACbvd,KAAKwd,OAASA,OACdxd,KAAK8d,KAAOA,KAEZ,MAAMyC,QAAUvgB,KAAKyd,UAAYzd,KAAKud,MAChCiD,SAAWxgB,KAAK0d,WAAa1d,KAAKwd,OAExCxd,KAAKid,OAAOwD,MAAMC,QAAlB,iBAAsCH,QAAtC,uBAA4DC,SAA5D,gCAA4FxgB,KAAK8d,KAAjG,KACA9d,KAAKid,OAAOM,MAAQgD,QACpBvgB,KAAKid,OAAOO,OAASgD,SAErBxgB,KAAK+f,MAAMY,eAAuB,EAARpD,MAAWC,QAGzCQ,KAAKhJ,EAAGC,EAAG3M,OAAQ4V,IAAKC,IAAKC,IACzBpe,KAAK+f,MAAMa,IAAQ,EAAJ5L,EAAOC,EAAG,CACrBhW,IAAKqJ,OAAOuY,SAAS3C,IAAKC,KAC1BZ,MAAOjV,OAAOiV,MACdC,OAAQlV,OAAOkV,OACfY,GACApJ,EACAC,IAIRsK,QACIvf,KAAKkB,IAAI4f,UAAY9gB,KAAK+gB,WAC1B/gB,KAAKkB,IAAI8f,SACL,EACA,EACAhhB,KAAKyd,UAAYzd,KAAKud,MACtBvd,KAAK0d,WAAa1d,KAAKwd,QAE3Bxd,KAAK+f,MAAMR,QAGfC,UAAUxK,EAAGC,EAAGsI,MAAOC,QACnBxd,KAAKkB,IAAI4f,UAAY9gB,KAAK+gB,WAC1B/gB,KAAKkB,IAAI8f,SACLhM,EAAIhV,KAAKyd,UACTxI,EAAIjV,KAAK0d,WACT1d,KAAKyd,UAAYF,MACjBvd,KAAK0d,WAAaF,QAGtB,MAAMyD,QAAc,EAAJjM,EAEhB,IAAK,IAAIpT,EAAI,EAAGA,EAAI2b,MAAO3b,IACvB,IAAK,IAAIK,EAAI,EAAGA,EAAIub,OAAQvb,IAAK,CAC7B,MAAMif,MAAQD,QAAc,EAAJrf,EAClBuf,MAAQlM,EAAIhT,EAElBjC,KAAK+f,MAAMa,IAAIM,MAAOC,WAAO3Y,GAC7BxI,KAAK+f,MAAMa,IAAIM,MAAQ,EAAGC,WAAO3Y,IAK7CqU,SACI7c,KAAK+f,MAAMjN,KACNsO,QAAQC,GAAMA,IACd9N,SAAS+N,OACN,MAAMC,OAASD,KAAKtM,EAAIhV,KAAKyd,UACvB+D,OAASF,KAAKrM,EAAIjV,KAAK0d,WAEzB4D,KAAKlD,KACLpe,KAAKkB,IAAI4f,UAAYQ,KAAKlD,GAC1Bpe,KAAKkB,IAAI8f,SAASO,OAAQC,OAAQF,KAAK/D,MAAO+D,KAAK9D,SAGnD8D,KAAKriB,KACLe,KAAKkB,IAAIugB,UAAUH,KAAKriB,IAAKsiB,OAAQC,c,wVCtG1C,MAAMxB,KAOjB,YACI,OAAOhgB,KAAK0hB,OAGhB,aACI,OAAO1hB,KAAK2hB,QAGhB,WACI,OAAO3hB,KAAK0hB,OAAS1hB,KAAK2hB,QAG9BlJ,YAAY8E,MAAOC,OAAQoE,sBAAwB,KAAM,OAAM,8BAlBtD,GAkBsD,+BAjBrD,GAiBqD,4BAhBxD,IAgBwD,wCAf7C,GAe6C,8CAdvC,IAAM,OAe1B5hB,KAAK0hB,OAASnE,MACdvd,KAAK2hB,QAAUnE,OACfxd,KAAK4hB,sBAAwBA,sBAE7B5hB,KAAKuf,QAGTsC,IAAI7M,EAAGC,GACH,OAAOA,EAAIjV,KAAK0hB,OAAS1M,EAG7B8M,MAAMD,KACF,MAAO,CACH7M,EAAG7I,KAAKyT,MAAMiC,IAAM7hB,KAAK0hB,QACzBzM,EAAG9I,KAAKyT,MAAMiC,IAAM7hB,KAAK0hB,SAIjCnC,QACIvf,KAAK8S,KAAO,GAEZ,IAAK,IAAIlR,EAAI,EAAGA,EAAI5B,KAAK+hB,KAAMngB,IAAK,CAChC,MAAM,KAAW5B,KAAK8hB,MAAMlgB,GAE5B5B,KAAK8S,KAAKlR,GAAK5B,KAAK4hB,sBAAsB5M,EAAGC,EAAGjV,KAAK6hB,IAAI7M,EAAGC,KAIpE+M,OAAOC,OACHjiB,KAAK8S,KAAO,GAEZ,IAAK,IAAIlR,EAAI,EAAGA,EAAI5B,KAAK+hB,KAAMngB,IAC3B5B,KAAK8S,KAAKlR,GAAKqgB,MAIvBrB,IAAI5L,EAAGC,EAAGgN,OACN,GAAIjiB,KAAKkiB,cAAclN,EAAGC,GAMtB,YALKjV,KAAKigB,iBACNzZ,QAAQC,KAAR,mDACgDuO,EADhD,aACsDC,EADtD,sBACqEgN,SAM7E,MAAMJ,IAAM7hB,KAAK6hB,IAAI7M,EAAGC,GAExBjV,KAAK8S,KAAK+O,KAAOI,MAGrBE,YACI,MAAMC,QAAU,IAAIpiB,KAAK8S,MAEzB,MAAO,CACHyK,MAAOvd,KAAKud,MACZC,OAAQxd,KAAKwd,OACb4E,SAIRC,YAAYvP,MACR9S,KAAK0hB,OAAS5O,KAAKyK,MACnBvd,KAAK2hB,QAAU7O,KAAK0K,OACpBxd,KAAK8S,KAAOA,KAAKsP,QAGrBE,IAAItN,EAAGC,GACH,OAAIjV,KAAKkiB,cAAclN,EAAGC,GACfjV,KAAK4hB,wBAGT5hB,KAAK8S,KAAK9S,KAAK6hB,IAAI7M,EAAGC,IAGjCiN,cAAclN,EAAGC,GACb,OAAOD,EAAI,GAAKC,EAAI,GAAKD,GAAKhV,KAAK0hB,QAAUzM,GAAKjV,KAAKwd,OAG3D+E,aAAavN,EAAGC,GACZ,MAAO,CACHjV,KAAKsiB,IAAItN,EAAI,EAAGC,EAAI,GACpBjV,KAAKsiB,IAAItN,EAAGC,EAAI,GAChBjV,KAAKsiB,IAAItN,EAAI,EAAGC,EAAI,GACpBjV,KAAKsiB,IAAItN,EAAI,EAAGC,GAChBjV,KAAKsiB,IAAItN,EAAI,EAAGC,GAChBjV,KAAKsiB,IAAItN,EAAI,EAAGC,EAAI,GACpBjV,KAAKsiB,IAAItN,EAAGC,EAAI,GAChBjV,KAAKsiB,IAAItN,EAAI,EAAGC,EAAI,IAI5B0L,eAAepD,MAAOC,QAClBxd,KAAK0hB,OAASnE,MACdvd,KAAK2hB,QAAUnE,OACfxd,KAAKuf,W,qRCjHb,sCACI,MAAMiD,UAAY7iB,SAAS8iB,eAAe,qBACpCC,UAAY/iB,SAAS8iB,eAAe,oBACpCE,QAAUhjB,SAAS8iB,eAAe,kBAExC,MAAO,CACH,IAAIG,kDAAY,QAASJ,WACzB,IAAII,kDAAY,OAAQF,WACxB,IAAIE,kDAAY,KAAMD,Y,ynBCPf,MAAMC,YAKjB,WACI,6BAAO5iB,KAAP,OAGJ,YACI,OAAOA,KAAK6iB,MAAMtF,MAGtB,aACI,OAAOvd,KAAK6iB,MAAMrF,OAGtB,mBACI,OAAO,GAGX,mBACI,OAAO,GAGX/E,YAAY4E,KAAMwF,OAAO,kCAxBjB,OAwBiB,0CAvBT,MAuBS,qCAtBd,K,4UAuBP,CAAA7iB,KAAA,MAAaqd,MACbrd,KAAK6iB,MAAQA,MAEb7iB,KAAK8iB,YAAc9iB,KAAK6iB,MAAMtF,MAAQvd,KAAK+iB,aAC3C/iB,KAAKgjB,aAAehjB,KAAK6iB,MAAMrF,OAASxd,KAAKijB,aAE7CC,qDAAc,CAACC,IAAKvhB,KAChBuhB,IAAI5P,SAAQ,CAAC6P,MAAOnhB,KAChB,sBAAAjC,KAAA,UAAcojB,OAAS,IAAIC,6CAAOD,MAAOpjB,KAAMiC,EAAGL,SAK9D0c,UAAU8E,OACN,OAAI,sBAAApjB,KAAA,UAAcojB,OACP,sBAAApjB,KAAA,UAAcojB,OAGlB,sBAAApjB,KAAA,gCAAcA,KAAd,mB,gNC9Cf,kCACI,CAAC,MAAO,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC9E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC5E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAM,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC7E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC5E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC5E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,IAAK,IAAK,KAC7E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC5E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC5E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC5E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC5E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC5E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC5E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC5E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC5E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAC5E,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,U,2gCCdjE,MAAMqjB,OAQjB,YACI,6BAAOrjB,KAAP,QAGJ,QACI,6BAAOA,KAAP,IAGJ,QACI,6BAAOA,KAAP,IAGJ,YACI,6BAAOA,KAAP,QAGJ,YACI,OAAOA,KAAKsjB,MAAMT,MAGtB,cACI,OAAO7iB,KAAKsjB,MAAMR,YAAc9iB,KAAKgV,EAGzC,cACI,OAAOhV,KAAKsjB,MAAMN,aAAehjB,KAAKiV,EAG1C,YACI,OAAOjV,KAAKsjB,MAAMR,YAGtB,aACI,OAAO9iB,KAAKsjB,MAAMN,aAGtBvK,YAAY2K,MAAOE,MAAOtO,EAAGC,G,kBAAG,iCA3CzB,OA2CyB,mCA1CvB,OA0CuB,mCAzCvB,OAyCuB,+BAxC3B,OAwC2B,+BAvC3B,O,MACI,I,IAsCuB,Y,IAAA,M,gGAC5B,sBAAAjV,KAAA,OAAcojB,OACd,sBAAApjB,KAAA,OAAcsjB,OACd,sBAAAtjB,KAAA,GAAUgV,GACV,sBAAAhV,KAAA,GAAUiV,GAEV,MAAMgI,OAAStd,SAASugB,cAAc,UAEtCjD,OAAOM,MAAQvd,KAAKud,MACpBN,OAAOO,OAASxd,KAAKwd,OAErB,sBAAAxd,KAAA,KAAYid,OAAOkD,WAAW,OAE9B,sBAAAngB,KAAA,MAAUyhB,UACNzhB,KAAKsjB,MAAMT,MACX7iB,KAAKujB,QACLvjB,KAAKwjB,QACLxjB,KAAKud,MACLvd,KAAKwd,OACL,EACA,EACAxd,KAAKud,MACLvd,KAAKwd,QAIbqD,SAAS4C,WAAYC,cACjB,MAAMC,SAAUC,8DAAWH,YACrBI,WAAYD,8DAAWF,cAEvBlQ,IAAM,GAAH,OAAMmQ,QAAQnQ,IAAd,YAAqBqQ,UAAUrQ,KAExC,GAAIxT,KAAK8jB,OAAOC,eAAevQ,KAC3B,OAAOxT,KAAK8jB,OAAOtQ,KAGvB,MAAMwQ,OAAS,sBAAAhkB,KAAA,MAAUikB,aAAa,EAAG,EAAGjkB,KAAKud,MAAOvd,KAAKwd,QAE7D,IAAK,IAAI5b,EAAI,EAAGA,EAAIoiB,OAAOlR,KAAKjR,OAAQD,GAAK,EAAG,CAC5C,MAAMsiB,EAAIF,OAAOlR,KAAKlR,EAAI,GACpBuiB,EAAIH,OAAOlR,KAAKlR,EAAI,GACpBwiB,EAAIJ,OAAOlR,KAAKlR,EAAI,GACpByiB,EAAIL,OAAOlR,KAAKlR,EAAI,IAEtB0iB,yDAAQJ,EAAGC,EAAGC,IACdJ,OAAOlR,KAAKlR,GAAK+hB,QAAQ,GACzBK,OAAOlR,KAAKlR,EAAI,GAAK+hB,QAAQ,GAC7BK,OAAOlR,KAAKlR,EAAI,GAAK+hB,QAAQ,GAC7BK,OAAOlR,KAAKlR,EAAI,GAAKyiB,IACdE,yDAAQL,EAAGC,EAAGC,KACrBJ,OAAOlR,KAAKlR,GAAKiiB,UAAU,GAC3BG,OAAOlR,KAAKlR,EAAI,GAAKiiB,UAAU,GAC/BG,OAAOlR,KAAKlR,EAAI,GAAKiiB,UAAU,GAC/BG,OAAOlR,KAAKlR,EAAI,GAAKyiB,GAI7B,MAAMG,IAAM7kB,SAASugB,cAAc,UASnC,OAPAsE,IAAIjH,MAAQvd,KAAKud,MACjBiH,IAAIhH,OAASxd,KAAKwd,OAElBgH,IAAIrE,WAAW,MAAMsE,aAAaT,OAAQ,EAAG,GAE7ChkB,KAAK8jB,OAAOtQ,KAAOgR,IAEZA,O,wQC/Gf,MAAM5T,MAAQ,GAEDgT,WAAcc,WACvB,IAAK9T,MAAMmT,eAAeW,UAAW,CACjC,MAAMC,QAASC,oDAAWF,UAAUG,OAC9B/R,KAAO,CAAC6R,OAAO,GAAIA,OAAO,GAAIA,OAAO,GAAIA,OAAOvE,OAEtDtN,KAAKU,IAAL,UAAcV,KAAK,GAAnB,YAAyBA,KAAK,GAA9B,YAAoCA,KAAK,GAAzC,YAA+CA,KAAK,IAEpDlC,MAAM8T,UAAY5R,KAGtB,OAAOlC,MAAM8T,Y,gSCTjB,iCAqBA,SAAgBI,MACf,IAAIC,EAA0BC,MAAvBC,MAAQ,GAAI7E,MAAQ,EAE3B,GAAoB,iBAAT0E,KAEV,GAAII,wCAAMJ,MACTG,MAAQC,wCAAMJ,MAAMvZ,QACpByZ,MAAQ,WAIJ,GAAa,gBAATF,KACR1E,MAAQ,EACR4E,MAAQ,MACRC,MAAQ,CAAC,EAAE,EAAE,QAIT,GAAI,kBAAkBjT,KAAK8S,MAAO,CACtC,IACI/C,MADAoD,KAAOL,KAAKvZ,MAAM,IACN1J,OAEhBue,MAAQ,EADM2B,MAAQ,GAIrBkD,MAAQ,CACPthB,SAASwhB,KAAK,GAAKA,KAAK,GAAI,IAC5BxhB,SAASwhB,KAAK,GAAKA,KAAK,GAAI,IAC5BxhB,SAASwhB,KAAK,GAAKA,KAAK,GAAI,KAEhB,IAATpD,OACH3B,MAAQzc,SAASwhB,KAAK,GAAKA,KAAK,GAAI,IAAM,OAI3CF,MAAQ,CACPthB,SAASwhB,KAAK,GAAKA,KAAK,GAAI,IAC5BxhB,SAASwhB,KAAK,GAAKA,KAAK,GAAI,IAC5BxhB,SAASwhB,KAAK,GAAKA,KAAK,GAAI,KAEhB,IAATpD,OACH3B,MAAQzc,SAASwhB,KAAK,GAAKA,KAAK,GAAI,IAAM,MAIvCF,MAAM,KAAIA,MAAM,GAAK,GACrBA,MAAM,KAAIA,MAAM,GAAK,GACrBA,MAAM,KAAIA,MAAM,GAAK,GAE1BD,MAAQ,WAIJ,GAAID,EAAI,mFAAmF5Z,KAAK2Z,MAAO,CAC3G,IAAIzH,KAAO0H,EAAE,GACTK,MAAiB,QAAT/H,KACR8H,KAAO9H,KAAKza,QAAQ,KAAM,IAC9BoiB,MAAQG,KACJpD,KAAgB,SAAToD,KAAkB,EAAa,SAATA,KAAkB,EAAI,EACvDF,MAAQF,EAAE,GAAGM,OACXzhB,MAAM,mBACN9D,KAAI,SAAUkV,EAAGpT,GAEjB,GAAI,KAAKoQ,KAAKgD,GAEb,OAAIpT,IAAMmgB,KAAaxgB,WAAWyT,GAAK,IAE1B,QAATmQ,KAAuC,IAAhB5jB,WAAWyT,GAAW,IAC1CzT,WAAWyT,GAGd,GAAgB,MAAZmQ,KAAKvjB,GAAY,CAEzB,GAAI,OAAOoQ,KAAKgD,GACf,OAAOzT,WAAWyT,GAGd,QAAoBxM,IAAhB8c,SAAStQ,GACjB,OAAOsQ,SAAStQ,GAGlB,OAAOzT,WAAWyT,MAGhBqI,OAAS8H,MAAMF,MAAMte,KAAK,GAC9ByZ,MAASgF,YAA8B5c,IAAhByc,MAAMlD,MAAX,EAAsCkD,MAAMlD,MAC9DkD,MAAQA,MAAM1Z,MAAM,EAAGwW,WAIf+C,KAAKjjB,OAAS,IAAM,iBAAiBmQ,KAAK8S,QAClDG,MAAQH,KAAKrhB,MAAM,aAAa3D,KAAI,SAAUmiB,OAC7C,OAAO1gB,WAAW0gB,UAGnB+C,MAAQF,KAAKrhB,MAAM,aAAa8hB,KAAK,IAAIna,oBAKjC+C,MAAM2W,MAMPrlB,MAAM0R,QAAQ2T,OAASA,KAAKjjB,QACpCojB,MAAQ,CAACH,KAAK,GAAIA,KAAK,GAAIA,KAAK,IAChCE,MAAQ,MACR5E,MAAwB,IAAhB0E,KAAKjjB,OAAeijB,KAAK,GAAK,GAI9BA,gBAAgB5T,SACV,MAAV4T,KAAKZ,GAAyB,MAAZY,KAAKU,KAAyB,MAAVV,KAAKW,GAC9CT,MAAQ,MACRC,MAAQ,CACPH,KAAKZ,GAAKY,KAAKU,KAAOV,KAAKW,GAAK,EAChCX,KAAKX,GAAKW,KAAKY,OAASZ,KAAKa,GAAK,EAClCb,KAAKV,GAAKU,KAAKc,MAAQd,KAAKe,GAAK,KAIlCb,MAAQ,MACRC,MAAQ,CACPH,KAAKgB,GAAKhB,KAAKiB,KAAOjB,KAAKkB,GAAK,EAChClB,KAAKmB,GAAKnB,KAAKoB,YAAcpB,KAAKqB,GAAK,EACvCrB,KAAKsB,GAAKtB,KAAKuB,WAAavB,KAAKwB,GAAKxB,KAAKV,GAAKU,KAAKyB,aAIvDnG,MAAQ0E,KAAKT,GAAKS,KAAK1E,OAAS0E,KAAK0B,SAAW,EAE5B,MAAhB1B,KAAK0B,UAAiBpG,OAAS,OAhCnC4E,MAAQ,MACRC,MAAQ,CAACH,OAAS,IAAY,MAAPA,QAAqB,EAAU,IAAPA,OAkChD,MAAO,CACNE,MACAH,OAAQI,MACR7E,QAzJF,IAAIkF,SAAW,CACdE,IAAK,EACLiB,OAAQ,GACRC,OAAQ,IACRhB,MAAO,IACPE,KAAM,IACNe,OAAQ,M,sBChBTC,OAAOpS,QAAU,CAChB,UAAa,CAAC,IAAK,IAAK,KACxB,aAAgB,CAAC,IAAK,IAAK,KAC3B,KAAQ,CAAC,EAAG,IAAK,KACjB,WAAc,CAAC,IAAK,IAAK,KACzB,MAAS,CAAC,IAAK,IAAK,KACpB,MAAS,CAAC,IAAK,IAAK,KACpB,OAAU,CAAC,IAAK,IAAK,KACrB,MAAS,CAAC,EAAG,EAAG,GAChB,eAAkB,CAAC,IAAK,IAAK,KAC7B,KAAQ,CAAC,EAAG,EAAG,KACf,WAAc,CAAC,IAAK,GAAI,KACxB,MAAS,CAAC,IAAK,GAAI,IACnB,UAAa,CAAC,IAAK,IAAK,KACxB,UAAa,CAAC,GAAI,IAAK,KACvB,WAAc,CAAC,IAAK,IAAK,GACzB,UAAa,CAAC,IAAK,IAAK,IACxB,MAAS,CAAC,IAAK,IAAK,IACpB,eAAkB,CAAC,IAAK,IAAK,KAC7B,SAAY,CAAC,IAAK,IAAK,KACvB,QAAW,CAAC,IAAK,GAAI,IACrB,KAAQ,CAAC,EAAG,IAAK,KACjB,SAAY,CAAC,EAAG,EAAG,KACnB,SAAY,CAAC,EAAG,IAAK,KACrB,cAAiB,CAAC,IAAK,IAAK,IAC5B,SAAY,CAAC,IAAK,IAAK,KACvB,UAAa,CAAC,EAAG,IAAK,GACtB,SAAY,CAAC,IAAK,IAAK,KACvB,UAAa,CAAC,IAAK,IAAK,KACxB,YAAe,CAAC,IAAK,EAAG,KACxB,eAAkB,CAAC,GAAI,IAAK,IAC5B,WAAc,CAAC,IAAK,IAAK,GACzB,WAAc,CAAC,IAAK,GAAI,KACxB,QAAW,CAAC,IAAK,EAAG,GACpB,WAAc,CAAC,IAAK,IAAK,KACzB,aAAgB,CAAC,IAAK,IAAK,KAC3B,cAAiB,CAAC,GAAI,GAAI,KAC1B,cAAiB,CAAC,GAAI,GAAI,IAC1B,cAAiB,CAAC,GAAI,GAAI,IAC1B,cAAiB,CAAC,EAAG,IAAK,KAC1B,WAAc,CAAC,IAAK,EAAG,KACvB,SAAY,CAAC,IAAK,GAAI,KACtB,YAAe,CAAC,EAAG,IAAK,KACxB,QAAW,CAAC,IAAK,IAAK,KACtB,QAAW,CAAC,IAAK,IAAK,KACtB,WAAc,CAAC,GAAI,IAAK,KACxB,UAAa,CAAC,IAAK,GAAI,IACvB,YAAe,CAAC,IAAK,IAAK,KAC1B,YAAe,CAAC,GAAI,IAAK,IACzB,QAAW,CAAC,IAAK,EAAG,KACpB,UAAa,CAAC,IAAK,IAAK,KACxB,WAAc,CAAC,IAAK,IAAK,KACzB,KAAQ,CAAC,IAAK,IAAK,GACnB,UAAa,CAAC,IAAK,IAAK,IACxB,KAAQ,CAAC,IAAK,IAAK,KACnB,MAAS,CAAC,EAAG,IAAK,GAClB,YAAe,CAAC,IAAK,IAAK,IAC1B,KAAQ,CAAC,IAAK,IAAK,KACnB,SAAY,CAAC,IAAK,IAAK,KACvB,QAAW,CAAC,IAAK,IAAK,KACtB,UAAa,CAAC,IAAK,GAAI,IACvB,OAAU,CAAC,GAAI,EAAG,KAClB,MAAS,CAAC,IAAK,IAAK,KACpB,MAAS,CAAC,IAAK,IAAK,KACpB,SAAY,CAAC,IAAK,IAAK,KACvB,cAAiB,CAAC,IAAK,IAAK,KAC5B,UAAa,CAAC,IAAK,IAAK,GACxB,aAAgB,CAAC,IAAK,IAAK,KAC3B,UAAa,CAAC,IAAK,IAAK,KACxB,WAAc,CAAC,IAAK,IAAK,KACzB,UAAa,CAAC,IAAK,IAAK,KACxB,qBAAwB,CAAC,IAAK,IAAK,KACnC,UAAa,CAAC,IAAK,IAAK,KACxB,WAAc,CAAC,IAAK,IAAK,KACzB,UAAa,CAAC,IAAK,IAAK,KACxB,UAAa,CAAC,IAAK,IAAK,KACxB,YAAe,CAAC,IAAK,IAAK,KAC1B,cAAiB,CAAC,GAAI,IAAK,KAC3B,aAAgB,CAAC,IAAK,IAAK,KAC3B,eAAkB,CAAC,IAAK,IAAK,KAC7B,eAAkB,CAAC,IAAK,IAAK,KAC7B,eAAkB,CAAC,IAAK,IAAK,KAC7B,YAAe,CAAC,IAAK,IAAK,KAC1B,KAAQ,CAAC,EAAG,IAAK,GACjB,UAAa,CAAC,GAAI,IAAK,IACvB,MAAS,CAAC,IAAK,IAAK,KACpB,QAAW,CAAC,IAAK,EAAG,KACpB,OAAU,CAAC,IAAK,EAAG,GACnB,iBAAoB,CAAC,IAAK,IAAK,KAC/B,WAAc,CAAC,EAAG,EAAG,KACrB,aAAgB,CAAC,IAAK,GAAI,KAC1B,aAAgB,CAAC,IAAK,IAAK,KAC3B,eAAkB,CAAC,GAAI,IAAK,KAC5B,gBAAmB,CAAC,IAAK,IAAK,KAC9B,kBAAqB,CAAC,EAAG,IAAK,KAC9B,gBAAmB,CAAC,GAAI,IAAK,KAC7B,gBAAmB,CAAC,IAAK,GAAI,KAC7B,aAAgB,CAAC,GAAI,GAAI,KACzB,UAAa,CAAC,IAAK,IAAK,KACxB,UAAa,CAAC,IAAK,IAAK,KACxB,SAAY,CAAC,IAAK,IAAK,KACvB,YAAe,CAAC,IAAK,IAAK,KAC1B,KAAQ,CAAC,EAAG,EAAG,KACf,QAAW,CAAC,IAAK,IAAK,KACtB,MAAS,CAAC,IAAK,IAAK,GACpB,UAAa,CAAC,IAAK,IAAK,IACxB,OAAU,CAAC,IAAK,IAAK,GACrB,UAAa,CAAC,IAAK,GAAI,GACvB,OAAU,CAAC,IAAK,IAAK,KACrB,cAAiB,CAAC,IAAK,IAAK,KAC5B,UAAa,CAAC,IAAK,IAAK,KACxB,cAAiB,CAAC,IAAK,IAAK,KAC5B,cAAiB,CAAC,IAAK,IAAK,KAC5B,WAAc,CAAC,IAAK,IAAK,KACzB,UAAa,CAAC,IAAK,IAAK,KACxB,KAAQ,CAAC,IAAK,IAAK,IACnB,KAAQ,CAAC,IAAK,IAAK,KACnB,KAAQ,CAAC,IAAK,IAAK,KACnB,WAAc,CAAC,IAAK,IAAK,KACzB,OAAU,CAAC,IAAK,EAAG,KACnB,cAAiB,CAAC,IAAK,GAAI,KAC3B,IAAO,CAAC,IAAK,EAAG,GAChB,UAAa,CAAC,IAAK,IAAK,KACxB,UAAa,CAAC,GAAI,IAAK,KACvB,YAAe,CAAC,IAAK,GAAI,IACzB,OAAU,CAAC,IAAK,IAAK,KACrB,WAAc,CAAC,IAAK,IAAK,IACzB,SAAY,CAAC,GAAI,IAAK,IACtB,SAAY,CAAC,IAAK,IAAK,KACvB,OAAU,CAAC,IAAK,GAAI,IACpB,OAAU,CAAC,IAAK,IAAK,KACrB,QAAW,CAAC,IAAK,IAAK,KACtB,UAAa,CAAC,IAAK,GAAI,KACvB,UAAa,CAAC,IAAK,IAAK,KACxB,UAAa,CAAC,IAAK,IAAK,KACxB,KAAQ,CAAC,IAAK,IAAK,KACnB,YAAe,CAAC,EAAG,IAAK,KACxB,UAAa,CAAC,GAAI,IAAK,KACvB,IAAO,CAAC,IAAK,IAAK,KAClB,KAAQ,CAAC,EAAG,IAAK,KACjB,QAAW,CAAC,IAAK,IAAK,KACtB,OAAU,CAAC,IAAK,GAAI,IACpB,UAAa,CAAC,GAAI,IAAK,KACvB,OAAU,CAAC,IAAK,IAAK,KACrB,MAAS,CAAC,IAAK,IAAK,KACpB,MAAS,CAAC,IAAK,IAAK,KACpB,WAAc,CAAC,IAAK,IAAK,KACzB,OAAU,CAAC,IAAK,IAAK,GACrB,YAAe,CAAC,IAAK,IAAK,M,2PCtJpB,MAAMqS,SAAW,CAACf,EAAGG,EAAGG,KAC3BH,GAAK,IACLG,GAAK,IAEL,IAAI/E,GAAK,EAAIlV,KAAKK,IAAI,EAAI4Z,EAAI,IAAMH,EAChCjR,EAAIqM,GAAK,EAAIlV,KAAKK,IAAMsZ,EAAI,GAAM,EAAK,IACvCf,EAAIqB,EAAI/E,EAAI,EACZ6C,EAAI,EACJC,EAAI,EACJC,EAAI,EA4BR,OA1BI,GAAK0B,GAAKA,EAAI,IACd5B,EAAI7C,EACJ8C,EAAInP,EACJoP,EAAI,GACG,IAAM0B,GAAKA,EAAI,KACtB5B,EAAIlP,EACJmP,EAAI9C,EACJ+C,EAAI,GACG,KAAO0B,GAAKA,EAAI,KACvB5B,EAAI,EACJC,EAAI9C,EACJ+C,EAAIpP,GACG,KAAO8Q,GAAKA,EAAI,KACvB5B,EAAI,EACJC,EAAInP,EACJoP,EAAI/C,GACG,KAAOyE,GAAKA,EAAI,KACvB5B,EAAIlP,EACJmP,EAAI,EACJC,EAAI/C,GACG,KAAOyE,GAAKA,EAAI,MACvB5B,EAAI7C,EACJ8C,EAAI,EACJC,EAAIpP,GAGD,CACH7I,KAAKyD,MAAgB,KAATsU,EAAIa,IAChB5Y,KAAKyD,MAAgB,KAATuU,EAAIY,IAChB5Y,KAAKyD,MAAgB,KAATwU,EAAIW,MAIX+B,QAAU,CAACzC,EAAGD,EAAGtH,KAC1B,MAAMiK,IAAM5a,KAAKyT,MAAMoH,KAAK3C,EAAE,GAAID,EAAE,GAAItH,IAClCmK,IAAM9a,KAAKyT,MAAMoH,KAAK3C,EAAE,GAAID,EAAE,GAAItH,IAClCoK,MAAQ/a,KAAKyT,MAAMoH,KAAK3C,EAAE,GAAID,EAAE,GAAItH,IAE1C,OAAO+J,SAASE,IAAKE,IAAKC,QAGjB3C,QAAU,CAACL,EAAGC,EAAGC,IAAY,MAANF,GAAmB,MAANC,GAAmB,MAANC,EACjDE,QAAU,CAACJ,EAAGC,EAAGC,IAAY,IAANF,GAAiB,IAANC,GAAiB,IAANC,G,maCjD3C,MAAMhK,wBAAwB2C,8CACzCtE,YAAY7Z,MACRse,MAAMte,MACNe,SAASL,iBAAiB,UAAWU,KAAKmnB,UAAUha,KAAKnN,OAEzD,MAAMonB,UAAYpnB,KAAKpB,KAAKqa,SAASgE,OAErCmK,UAAU9nB,iBAAiB,QAASU,KAAKqnB,aAAala,KAAKnN,OAC3DonB,UAAU9nB,iBAAiB,YAAaU,KAAKsnB,YAAYna,KAAKnN,OAC9DonB,UAAU9nB,iBAAiB,aAAcU,KAAKunB,aAAapa,KAAKnN,OAChEonB,UAAU9nB,iBAAiB,aAAcU,KAAKwnB,aAAara,KAAKnN,OAGpEmnB,UAAUlkB,GACN,MAAMwkB,IAAM,IAAIC,gEAAmB,CAC/BlU,IAAKvQ,EAAE0kB,QACPpW,MAAOtO,EAAE2kB,SACTC,KAAM5kB,EAAE6kB,QACRC,IAAK9kB,EAAE+kB,OACPC,KAAMhlB,EAAEilB,UAGZjlB,EAAEklB,iBAEFnoB,KAAKpB,KAAKmb,SAASqO,aAAaX,KAGpCJ,aAAapkB,GACT,MAAMyc,IAAMzc,EAAEge,QACRtB,IAAM1c,EAAEolB,SACR,KAAWroB,KAAKpB,KAAKqa,SAASwG,SAASC,IAAKC,KAE5C8H,IAAM,IAAIa,6DAAgB,CAC5B9U,IAAKvQ,EAAEslB,OACPvT,EACAC,EACA1D,MAAOtO,EAAE2kB,SACTC,KAAM5kB,EAAE6kB,QACRC,IAAK9kB,EAAE+kB,OACPC,KAAMhlB,EAAEilB,QACRxI,IACAC,MAGJ3f,KAAKpB,KAAKmb,SAASqO,aAAaX,KAGpCH,YAAYrkB,GACR,MAAMyc,IAAMzc,EAAEge,QACRtB,IAAM1c,EAAEolB,SACR,KAAWroB,KAAKpB,KAAKqa,SAASwG,SAASC,IAAKC,KAElD3f,KAAKpB,KAAKia,MAAM2P,eAAexT,EAAGC,GAGtCsS,aAAatkB,GACTjD,KAAKpB,KAAKia,MAAM4P,mBAGpBjB,aAAavkB,GACTjD,KAAKpB,KAAKia,MAAM6P,sB,6QC9DT,MAAMhB,2BAA2BiB,oD,8VCFjC,MAAMA,WAOjBlQ,YAAY3F,MAAM,4BANZ,GAMY,8BALV,GAKU,6BAJX,GAIW,4BAHZ,GAGY,6BAFX,GAGH9S,KAAKwT,IAAMV,KAAKU,IAChBxT,KAAKuR,MAAQuB,KAAKvB,MAClBvR,KAAK6nB,KAAO/U,KAAK+U,KACjB7nB,KAAK+nB,IAAMjV,KAAKiV,IAChB/nB,KAAKioB,KAAOnV,KAAKmV,Q,waCVV,MAAMK,wBAAwBK,iDAMzClQ,YAAY3F,MACRoK,MAAMpK,MADQ,0BALd,GAKc,0BAJd,GAIc,8BAHV,GAGU,8BAFV,GAIJ9S,KAAKgV,EAAIlC,KAAKkC,EACdhV,KAAKiV,EAAInC,KAAKmC,EACdjV,KAAK4oB,MAAQ9V,KAAK8V,MAClB5oB,KAAK6oB,MAAQ/V,KAAK+V,S,8aCTX,MAAMpO,qBAAqBqO,6CAGtCrQ,YAAY7Z,MACRse,MAAMte,MADQ,mCAFT,O,4UAKL,CAAAoB,KAAA,OAAcpB,KAAKC,IAAIkqB,YAAY,CAC/BlpB,IAAK,CAACmpB,oDACNC,KAAM,CAACC,0DAAcC,wDAI7BzM,OAAOD,IACH,MAAM2M,S,gOAAW,CAAAppB,KAAA,QAAYsiB,MACvB+G,OAAS5pB,MAAMC,KAAK0pB,UAE1BC,OAAOC,MAAK,CAACjF,EAAGD,IAAOC,EAAEkF,MAAMC,OAASpF,EAAEmF,MAAMC,OAAS,GAAK,IAE9D,IAAIC,OAASJ,OAAO,GAUpB,IARII,SAAWA,OAAOF,MAAMG,YACxB1pB,KAAKpB,KAAKma,MAAM4Q,eAAe,EAAIF,OAAOF,MAAMC,QAEhDJ,SAAS7V,SAAStQ,IACdA,EAAEsmB,MAAMK,UAAU5pB,KAAKpB,KAAKma,MAAM8Q,eAInCJ,QAAUA,OAAOF,MAAMG,WAC1B,GAAID,OAAOK,iBAEP,GADAL,OAAOM,UAAU,kBAAmB,KAChCN,OAAOO,SAIP,OAHAhqB,KAAKpB,KAAKqb,QAAQgQ,WAAWC,kEAAa,CACtCC,KAAM,MAEH,MANf,CAWA,GAAIV,OAAOO,SAAU,CACjB,MAAMhf,OAAShL,KAAKpB,KAAKib,OAAOuQ,gBAMhC,OAJIpf,QACAA,UAGG,EAGXye,OAAOM,UAAU,eACjBN,OAASJ,OAAO9X,QAGpB,OAAO,K,2qBC1DR,MAAM8Y,iBAAmB,EACnBC,iBAAmB,EACnBC,aAAe,EACfC,iBAAmB,EACnBC,sBAAwB,EACxBC,cAAgB,EAChBC,iBAAmB,EACnBC,iBAAmB,EACnBC,mBAAqB,EACrBC,iBAAmB,EACnBC,iBAAmB,GACnBC,eAAiB,GACjBd,YAAc,GACde,eAAiB,I,+hPCXvB,MAAMjC,cAAckC,8CAKvB,gBACI,OAAOlrB,KAAKwpB,QAAU,EAG1B2B,iBAAiB1D,KACbznB,KAAKorB,aAAa3D,IAAI3U,MAG1BuY,OAAO5D,KACHznB,KAAK4pB,UAAU,GAGnBA,UAAU3H,OACNjiB,KAAKwpB,QAAUvH,MAEXjiB,KAAKwpB,QAAU,IACfxpB,KAAKwpB,OAAS,GAItB4B,aAAanJ,OACTjiB,KAAK4pB,WAAmB,EAAT3H,Q,MAzBC,CAChBuH,OAAQ,I,wBAFHR,O,gfCAb,MA6BMsC,UAAY,CAACnR,MAAOoR,WACzB,GAAuB,iBAAVpR,QAAsB1a,cAAnC,OACC,MAAM,IAAI+rB,UAAV,gDAGDD,QAAU,CACLE,YAAY,KACbF,SAaJ,QAPCpR,MADG1a,cAAJ,OACS0a,WAAUnF,GAAKA,EAAfmF,iBACCnF,GAAKA,EADNmF,cAARA,KAIQA,MAARA,QAGGA,OACH,SAGD,OAAIA,aACH,OAAOoR,mBAAqBpR,MAArBoR,oBAAiDpR,MAAxD,oBAeD,OAZqBA,QAAUA,MAA/B,sBAGCA,MA5DwBuR,UACzB,IAAIC,iBAAJ,EACIC,iBAAJ,EACIC,qBAAJ,EAEA,IAAK,IAAIjqB,EAAT,EAAgBA,EAAI8pB,OAApB,OAAmC9pB,IAAK,CACvC,MAAMkqB,UAAYJ,OAAlB,GAEIC,iBAAmB,YAAY3Z,KAAnC,YACC0Z,OAASA,sBAA2BA,aAApCA,GACAC,mBACAE,oCACAD,mBACAhqB,KACUgqB,sCAA0C,YAAY5Z,KAA1D,YACN0Z,OAASA,eAAgB9pB,EAAhB8pB,OAA+BA,aAAa9pB,EAArD8pB,GACAG,oCACAD,mBACAD,qBAEAA,gBAAkBG,2CAA+CA,gCAAjEH,UACAE,oCACAD,gBAAkBE,2CAA+CA,gCAAjEF,WAIF,eAkCSG,CAAR5R,QAGDA,MAAQA,6FAGqC,CAAC6R,EAAGC,KAAOA,GAHhD9R,4DAIgC4K,GAAKA,EAJ7C5K,sBAxBoBnF,EA8BpB,MA9ByBuW,mBAAqBvW,gCAAkCA,QAAvDuW,GAAzB,EAAoBvW,OAiCrB4R,wBAEAA,mB,2BC1EA,MAAMsF,WAAN,GAEaC,YAAelK,QACnBiK,0BAAL,SACIA,kBAAoBE,UAApBF,QAGGA,WAAP,QAGEG,YAAc,IAApB,ICZe,MAAMC,SAGjB7T,YAAY8T,WAAW,yCACnBvsB,KAAA,oBAGJ,UACI,OAAOA,KAAKusB,UAAZ,IAGJ,iBACI,MAAO,CACHC,YADG,EAEHlK,IAAK,IAAMtiB,KAFR,MAGH4gB,IAAM6L,GAAMzsB,KAAK4gB,IAAI6L,IAI7BnK,OAIA1B,IAAIqB,QAEJE,aAIAuK,eAEAC,iBAAiBlD,UC7BN,MAAMmD,uBAAuBN,SAAS,uEAGjD1L,IAAIqB,OACAjiB,KAAA,YAGJsiB,MACI,OAAOtiB,KAAP,MAGJmiB,YACI,OAAOniB,KAAP,OCZO,MAAM6sB,uBAAuBP,SAAS,sEAGjD1L,IAAIqB,OAKA,OAJIjiB,KAAK2L,IAAQsW,OAASA,WAAajiB,KAAvB,IAAkCiiB,QAAUjiB,KAA5D,IACIA,KAAA,uBAA4BA,KAA5B,GAAAA,MAGAiiB,OAASA,MAAb,IACIjiB,KAAA,oBAAyBiiB,MAAzB,GAAAjiB,WACAA,KAAA,GAAUiiB,MAAV,KAIJ,iBAAWA,OACPjiB,KAAA,0BAAAA,WACAA,KAAA,gBAIJA,KAAA,WAGJsiB,MACI,OAAOtiB,KAAK2L,IAAM3L,KAAKusB,UAAU1tB,IAAIiuB,UAAU9sB,KAA/C,IAGJmiB,YACI,OAAOniB,KAAP,GAGJ0sB,cACQ1sB,KAAJ,IACIA,KAAA,uBAA4BA,KAA5B,GAAAA,MAIR2sB,iBAAiBlD,QACTzpB,KAAK2L,KAAO8d,OAAhB,GACIzpB,KAAA,UAEAwG,4EAC4DijB,OAD5DjjB,uCCzCG,MAAMumB,4BAA4BT,SAG7C7T,YAAY8T,WACRrP,MAAA,WADmB,6BAFf,IAIJld,KAAA,MAAa,IAAIgtB,MAAM,GAAI,CACvB1K,IAAK,CAAC2K,OAAQC,KAAMC,WACTC,wBAAP,UAEJxM,IAAK,CAACqM,OAAQC,KAAMjL,MAAOkL,YACvB,GAAIhf,MAAJ,MACI,OAAOif,8BAAP,UAGJ,MAAMC,IAAMD,wBAAZ,UAUA,MARA,iBAAWnL,QACPA,MAAQjiB,KAAKnB,IAAIuqB,SAAS9G,IAA1BL,QAGAoL,KAAOA,KAAX,OACIrtB,KAAA,6BAAAA,MAGAiiB,OAASA,MAAb,IACIjiB,KAAA,oBAAyBiiB,MAAzB,GAAAjiB,MAEOotB,8BAAP,WAGGA,8BAAP,WAEJE,eAAgB,CAACL,OAAQC,QACrB,GAAI/e,MAAJ,MACI,OAAOif,8BAAP,MAGJ,MAAMnL,MAAQmL,mBAAd,MAGA,OAFAptB,KAAA,6BAAAA,MAEOotB,8BAAP,SAKZxM,IAAIiE,OAAD,IACC,MAAMhW,IAAM1C,SAAS0Y,OAAT1Y,OAAwBnM,KAAKutB,MAAzC,QAEA,IAAK,IAAI3rB,EAAT,EAAgBA,EAAhB,IAAyBA,IACjBA,KAAJ,OACI5B,KAAA,SAAgB6kB,OAAhB,UAEO7kB,KAAKutB,MAAZ,GAIRvtB,KAAA,aAAoB6kB,OAApB,OAGJvC,MACI,OAAOtiB,KAAP,MAGJmiB,YACI,OAAOniB,KAAKutB,MAAMztB,KAAK0tB,KAAQA,IAA/B,KAGJd,cACI1sB,KAAA,QAGJ2sB,iBAAiBlD,QACbzpB,KAAA,IAASA,KAAKutB,MAAMnM,QAAQoM,KAAQA,SAAW/D,OAA/C,OCrEO,MAAMgE,iBACjB,+BACI,cACI,eACI,OAAO,IAAIZ,eAAX,WACJ,oBACI,OAAO,IAAIE,oBAAX,WACJ,QACI,OAAO,IAAIH,eAAX,aCVD,MAAM1B,UAUjB,kBACI,OAAOlrB,KAAP,KAGJ,WACI,OAAOA,KAAKyY,YAAZ,KAGJ,iBACI,OAAOiV,QAAQ1tB,KAAf,QAGJ,kBACI,OAAOA,KAAP,aAGJ,oBACI,OAAOA,KAAKyY,YAAZ,cAGJ,kBACI,OAAOzY,KAAKyY,YAAZ,YAGJ,iBACI,MAAMkV,GAAN,GAEA,IAAK,MAAOna,IAAZ,SAA2BtC,eAAelR,KAA1C,QACI2tB,QAAU1L,MAAV0L,MAGJ,UAGJ,UACI,OAAO3tB,KAAKA,KAAZ,aAGJyY,YAAY5Z,IAAK+uB,WAAN,IAAuB,8BA/CzB,MA+CyB,2BA9C5B,MA8C4B,8BA7CzB,IA6CyB,qCA5CnB,GA6CX5tB,KAAA,QACAA,KAAA,2BAGJmiB,YACI,OAAOjR,OAAA,QAAelR,KAAf,gBACH,CAACqH,GAAImM,IAAL,cAAsB,EAElB,MAAOyO,qBAHf,IASJ4L,YAAYpE,QACRzpB,KAAA,cACAA,KAAA,oCAAAA,MACAA,KAAA,aAGJ8tB,cACQ9tB,KAAJ,aACIA,KAAA,aACAA,KAAA,aAIR+tB,eACI/tB,KAAA,gBACAA,KAAA,cAEA,IAAK,MAAL,QAAmBkR,cAAclR,KAAjC,QACIktB,mBAIRc,cAEAC,cAEAvB,eAEAwB,OAAOC,SAAD,GACEnuB,KAAJ,YACIA,KAAA,cAAAA,MAEJ,SACIA,KAAA,eAIRmuB,UACInuB,KAAA,WAGJouB,QACI,OAAOpuB,KAAKnB,IAAIwvB,gBAAgBruB,KAAzB,KAAoCA,KAA3C,aAGJsuB,SAAS7G,KACLznB,KAAA,aAEA,MAAMuuB,YAAcpC,YAAY,MAAD,OAAO1E,IAAtC,OAEA,mBAAWznB,KAAP,cACAA,KAAA,kBAIRwuB,QAAQ/G,MAERgH,sBAAsBC,cAClB,MAAMzM,MAAQjiB,KAAKyY,YAAYmV,WAA/B,cAEA,wBAAI3L,MACA,GAGJ,aAAIA,MAIJ,WAJA,EAOJ0M,eAAeC,mBACX,IAAK,MAAL,OAAkB5uB,KAAKyY,YAAvB,WAA+C,CAC3C,MAAMoW,aAAeD,sCACfA,kBADeA,KAEf5uB,KAAKyuB,sBAFX,KAGMK,SAAWC,6BAEb/uB,KAAKyY,YAAYmV,WAFrB,MAKA5tB,KAAA,qBACAkR,+BAAiC4d,SAAjC5d,YACA4d,6B,gBAlJS5D,2BAMM,G,gBANNA,wBAOI,M,gBAPJA,uBAQG,ICRT,MAAM8D,kBAIjBvW,YAAY5Z,KAAK,oCAHF,IAAIowB,KAGF,4BAFV,MAGHjvB,KAAA,SAGJkvB,SAAS3C,WACLvsB,KAAA,iBAAsBusB,UAAtB,gBACAJ,YAAYI,UAFI,MAKpB4C,YAAY9W,MACR,OAAO8T,YAAP,MAGJ7J,IAAI8M,wBACA,MAAM/W,KAAOrY,KAAKqvB,SAAlB,wBAEA,YAOOrvB,KAAKsvB,aAAahN,IAAzB,OANI9b,4JAGA,MAMR4L,OAAOmd,YAAa3B,WAAd,IACF,MAAM4B,WAAaxvB,KAAKsiB,IAAxB,aAEA,cACI,OAAO,IAAIkN,WAAWxvB,KAAf,KAAP,YAGJwG,6GAKJ6oB,SAASD,wBACL,uBAAWA,uBACP,uBAGAA,kCAAJ,UACWA,uBAAP,KAGAA,4CAAJ,UACWA,uBAAP,KAGJ,MCxDR,IAAIK,kBAAoB,SAA2BxN,OAClD,OAID,SAAyBA,OACxB,QAAO,OAAP,iBAAyBA,MALlByN,UAQR,SAAmBzN,OAClB,IAAI0N,YAAcze,+BAAlB,OAEA,MAAOye,mDACHA,aAQL,SAAwB1N,OACvB,OAAOA,iBAAP,mBARI2N,CAFJ,OAVKC,CADL,QAiBD,IACIC,mBADiC,mBAAXC,QAAyBA,OAAnD,IACwCA,WAAH,iBAArC,MAUA,SAASC,8BAA8B/N,MAAOsJ,SAC7C,OAAQA,mBAA2BA,0BAA5B,OACJ0E,WANiBC,IAMR,MALLzwB,sBAAP,IAKY,MADL,SAAP,MALD,IAAqBywB,IAUrB,SAASC,kBAAkBlD,OAAQznB,OAAQ+lB,SAC1C,OAAO0B,OAAA,oBAA0B,kBAChC,OAAO+C,8BAA8BI,QAArC,YAoBF,SAASC,QAAQpD,QAChB,OAAO/b,2BATR,SAAyC+b,QACxC,OAAO/b,OAAA,sBACJA,OAAA,sCAA4C,iBAC7C,OAAO+b,4BAAP,WAFF,GAQkCqD,CAAlC,SAGD,SAASC,mBAAmBC,OAAQ1B,UACnC,IACC,OAAOA,YAAP,OACC,SACD,UAWF,SAAS2B,YAAYxD,OAAQznB,OAAQ+lB,SACpC,IAAI3lB,YAAJ,GAiBA,OAhBI2lB,0BAAJ,SACC8E,yBAAwB,cACvBzqB,iBAAmBoqB,8BAA8B/C,OAAD,KAAhDrnB,YAGFyqB,yBAAwB,eAbzB,SAA0BpD,OAAQzZ,KACjC,OAAO+c,mBAAmBtD,OAAnB,QACD/b,OAAA,iCACDA,wCAHiC,OAcjCwf,CAAiBzD,OAArB,OAIIsD,mBAAmBtD,OAAnBsD,MAAmChF,0BAA0B/lB,OAAjE,MACCI,iBAhDH,SAA0B4N,IAAK+X,SAC9B,IAAKA,QAAL,YACC,iBAED,IAAIoF,YAAcpF,oBAAlB,KACA,MAA8B,mBAAhBoF,YAA6BA,YAA3C,UA2CqBC,CAAiBpd,IAAjBod,SAA+B3D,OAA/B2D,KAA4CprB,OAA5CorB,KAAnBhrB,SAEAA,iBAAmBoqB,8BAA8BxqB,OAAD,KAAhDI,aAGF,YAGD,SAASqqB,UAAUhD,OAAQznB,OAAQ+lB,UAClCA,QAAUA,SAAVA,IACAA,WAAqBA,oBAArBA,kBACAA,0BAA4BA,2BAHe,kBAM3CA,oEAEA,IAAIsF,cAAgBpxB,cAApB,QAIA,OAFgCoxB,gBADZpxB,cAApB,QAKWoxB,cACHtF,iCAAP,SAEOkF,YAAYxD,OAAQznB,OAA3B,SAJOwqB,8BAA8BxqB,OAArC,SAQFyqB,cAAgB,SAAsBa,MAAOvF,SAC5C,IAAK9rB,cAAL,OACC,MAAM,IAAIsxB,MAAV,qCAGD,OAAOD,MAAA,QAAa,oBACnB,OAAOb,UAAUe,KAAMC,KAAvB,WADD,KAKD,IAEArK,IAFA,UChIe,MAAMsK,gBACjB,WACI,OAAOlxB,KAAKmxB,aAAZ,KAGJ1Y,YAAY0Y,aAAcvD,WAAf,GAAgCwD,WAAhC,GACPpxB,KAAA,0BACAA,KAAA,sBACAA,KAAA,oBAGJqxB,cAAc5H,OAAQ6H,aAAT,IACT,IAAKtxB,KAAKmxB,aAAN,eAAoC1H,WAAWzpB,KAAnD,cAAuE,CACnE,IAAIA,KAAJ,UAMI,YAHAwG,iDACkCxG,KAAKqY,KADvC7R,+BACkEijB,OADlEjjB,0BAFAijB,cAAczpB,KAAdypB,cASR,MAAM8H,MAAQC,IAAMxxB,KAAD,WAAnB,cAEAypB,WAAWzpB,KAAXypB,qBC3BO,MAAMgI,OAKjBhZ,YAAY5Z,IAAKwe,MAAM,4BAJhB,IAIgB,+BAHb,IAGa,kCAFV,IAGTrd,KAAA,QACAA,KAAA,UAGJ0xB,aAAaC,iBACT3xB,KAAA,iCAGJqxB,cAAc5H,OAAQ6H,aAAT,IACTtxB,KAAA,iBAAsBmS,SAClBA,6CAGJ,MAAMyf,SAAN,GAqCA,OAnCA5xB,KAAA,oBAAwB,CAACusB,UAAW3qB,KAChC,MAAM4tB,WAAajD,UAAnB,aACMsF,SAAW7xB,KAAKnB,IAAIizB,WAAW3C,YAAYK,WAAjD,MAEA,IAAIuC,iBAAJ,GAEA,GAAIvC,WAAJ,cACI,GAAIA,WAAJ,YAA4B,CACxB,MAAMhc,IAAM+Y,qBAAqBiD,WAAjC,aAEI8B,wBAA0BA,uBAA9B,OACIS,iBAAmBT,uBAAnBS,WAGCH,SAAL,YACIA,sBAIAN,wBACAA,uBAAuBM,SAF3B,aAIIG,iBACIT,uBAAuBM,SAD3BG,YAIJH,0BAGJG,iBAAmBT,aAAnBS,UAGJxF,oDAGJ,QCpDO,MAAMyF,eAIjBvZ,YAAY5Z,KAAK,gCAHN,IAGM,4BAFV,MAGHmB,KAAA,SAGJqiB,YAAYvP,MACR,MAAMmf,WAAajyB,KAAKsiB,IAAIxP,KAA5B,MAEA,cACI,kBAGJ,MAAMof,OAAS,IAAIT,OAAOzxB,KAAX,KAAsB8S,KAArC,MAEA,YAGIqf,QADA1yB,cAAcqT,KAAlB,SACcA,KAAVqf,QACG,iBAAWrf,KAAP,QACG,CAACA,KAAXqf,SAEAA,GAGJD,eAAiBC,QAAA,KAAahgB,SAC1B,MAAMqb,IAAMxtB,KAAKsiB,IAAjB,QAEA,aACI9b,+BACesM,KAAKuK,KADpB7W,oIAGA,WAMR,MAAM4rB,MAAQtf,iBAAd,GAEA,IAAK,MAAL,uBACI,GAC6B,iBAAlBuf,eACPA,mCAFJ,UAGE,CACE,MAAMC,IAAMtyB,KAAKuyB,KAAKT,WAAWxP,IAAjC,eACA,KACI4P,oBAAoB,IAAIhB,gBAAxBgB,WAED,oBAAWG,cAA4B,CAC1C,MAAMha,KAAOga,cAAb,KACMC,IAAMtyB,KAAKuyB,KAAKT,WAAWxP,IAAjC,MACA,KACI4P,oBACI,IAAIhB,gBAAgB,IAEhBmB,cAFJ,WAGIA,cAJRH,iBASJ1rB,yDACyC6rB,cADzC7rB,wBACsEsM,KADtEtM,kEAQR,OAFAxG,KAAA,iBAEA,OAGJkvB,SAASgD,QACLlyB,KAAA,SAAckyB,OAAd,aAGJ5P,IAAIkQ,qBACA,MAAMnV,KAAO2U,wBAAb,qBAEA,OAAOhyB,KAAKyyB,SAAZ,MAGJrgB,OAAOsgB,YAAapB,aAAd,IACF,MAAMY,OAASlyB,KAAKsiB,IAApB,aAEA,WAKI,YAJA9b,oGAOJ,MAAMijB,OAASzpB,KAAKuyB,KAApB,eAGA,OAFAL,0CAEA,OAGJ,qCACI,uBAAWM,oBACP,oBAGAA,+BAAJ,QAIIA,yCAAJ,OAHWA,oBAAP,KAOJ,MCvHO,MAAMG,YAKjB,gBACI,OAAO3yB,KAAP,WAGJ,cACI,OAAOA,KAAP,SAGJyY,YAAY4E,KAAMvK,KAAP,IAAkB,4BAZtB,IAYsB,mCAXhB,GAWgB,iCAVlB,GAWP9S,KAAA,UACAA,KAAA,UAGJ4yB,GAAGvV,MACC,OAAOrd,KAAKqd,OAAZ,KAGJwV,SACI7yB,KAAA,YACAA,KAAA,cAGJ8yB,UACI9yB,KAAA,eCzBO,MAAM+yB,OAMjB,kBACI,OAAO/yB,KAAP,aAGJyY,YAAY5Z,IAAK8M,GAAN,MAAiB,0BATvB,MASuB,kCARf,IAQe,2BAPtB,MAOsB,qCANb,GAOX3L,KAAA,QACAA,KAAA,GAAU2L,IAAM9M,IAAhB,aAGJm0B,IAAIzD,YAAa/b,IAAd,MACC,MAAM6E,KAAOrY,KAAKnB,IAAIizB,WAAWzC,SAAjC,aACMwC,SAAW7xB,KAAKnB,IAAIizB,WAAW3C,YAArC,MACM8D,QAAUjzB,KAAK+jB,eAArB,UAEA,OAAIkP,SAAJ,IACWjzB,KAAK6xB,UAAU9N,eAAtB,KAGJ,QAGJzB,IAAIiN,YAAa/b,IAAd,MACC,MAAM6E,KAAOrY,KAAKnB,IAAIizB,WAAWzC,SAAjC,aAEMyC,WAAa9xB,KADFA,KAAKnB,IAAIizB,WAAW3C,YAArC,OAGA,OAAI2C,YAAJ,IACWA,WAAP,KAGJ,WAGJ3D,UACInuB,KAAA,gBAEA,IAAK,MAAL,aAAwBkR,cAAclR,KAAtC,YACI,GAAIusB,qBAAJ,UACIA,yBAEA,IAAK,MAAL,mBAA8Brb,cAA9B,WACIgiB,0BAKZlzB,KAAA,+BAAAA,MAGJmzB,IAAI5D,YAAa3B,WAAd,IACC,GAAI2B,uBAAJ,UACI,OAAIA,YAAJ,YACI/oB,wBACQ+oB,YADR/oB,kFAGA,GAGGxG,KAAKozB,OAAZ,aAGJ,MAAM7G,UAAYvsB,KAAKnB,IAAIizB,WAAW1f,OAAOmd,YAA7C,YAEA,iBAOOvvB,KAAKozB,OAAZ,YANI5sB,kGAGA,GAMR4sB,OAAO7G,WACH,MAAMsF,SAAW7xB,KAAKnB,IAAIizB,WAAW3C,YAAY5C,UAAjD,MAEA,OAAKA,UAAL,cAsBKA,UAAL,YAkBKA,UAAL,KAOKvsB,KAAK8xB,WAAV,YACI9xB,KAAA,wBACAkR,oCAAsC,CAClCmiB,cADkC,EAElC7G,YAFkC,EAGlC8G,UAHkC,EAIlCrR,MAAOjiB,KAAK8xB,WAAWD,aAI/B7xB,KAAA,qBAA0BusB,UAA1B,eAEAA,6BAEA,IApBI/lB,wBACQ+lB,UAAUlU,KADlB7R,2CACyD+lB,UAAU/Y,IADnEhN,yCACuG+lB,UADvG/lB,oBAGA,IArBKxG,KAAK8xB,WAAV,YACI9xB,KAAA,wBACAkR,oCAAsC,CAClCmiB,cADkC,EAElC7G,YAFkC,EAGlC8G,UAHkC,EAIlCrR,MAAOjiB,KAAK8xB,WAAWD,aAI/B7xB,KAAA,qCAEAusB,6BAEA,GApCIvsB,KAAKgzB,IAAIzG,UAAb,OACI/lB,wBACQ+lB,UAAUlU,KADlB7R,gDAC8D+lB,UAAUgH,cADxE/sB,8BAC2G+lB,UAD3G/lB,0DAGA,IAGJxG,KAAA,+BAEAkR,oCAAsC,CAClCsb,YADkC,EAElC6G,cAFkC,EAGlCC,UAHkC,EAIlCrR,MAAOjiB,KAAK8xB,WAAWD,YAG3BtF,6BAEA,GA6CRiH,KAAKjH,WACD,OAAOA,mBAAP,KAGJ2B,OAAOkB,uBAAwB5b,IAAzB,MACF,MAAMigB,YAAcrE,kCAApB,UACA5b,IAAMigB,YAAcrE,uBAAH,IAAjB5b,IAEA,MAAMgc,WAAaxvB,KAAKnB,IAAIizB,WAAWxP,IAAvC,wBAEMuP,SAAW7xB,KAAKnB,IAAIizB,WAAW3C,YAAYK,WAAjD,MAEA,GAAIA,WAAJ,cAA8B,CAC1B,IAAKA,WAAL,YAA6B,CACzB,gBAyBO,CACH,IAAK,MAAL,YAAuBxvB,KAAK8xB,WAA5B,UACI4B,uBAOJ,cAJO1zB,KAAP,iBACOA,KAAK8xB,WAAZ,UACA9xB,KAAA,+BAAAA,OAEA,EAlCa,CACb,MAAMH,IAAMG,KAAK8xB,WAAjB,UAEA,QAII,YAHAtrB,2CAC2BgpB,WAD3BhpB,2DAMJ,MAAMgI,MAAQ3O,YAAd,wBAEA,GAAI2O,OAAJ,EAWI,OAVA3O,oBACAuvB,qCAEA,IAAIvvB,oBACOG,KAAP,iBACOA,KAAK8xB,WAAZ,WAGJ9xB,KAAA,+BAAAA,OAEA,GAeZ,QAII,YAHAwG,2CAC2BgpB,WAD3BhpB,sEAMJ,MAAM3G,IAAMG,KAAK8xB,WAAjB,UACMvF,UAAY1sB,IAAlB,KAEA,yBACWA,IAAP,KACA0sB,wBACIrb,yBAAJ,WACWlR,KAAP,iBACOA,KAAK8xB,WAAZ,WAEJ9xB,KAAA,+BAAAA,MAEA,gBAEAwG,2CAC2BgpB,WAAWnX,KADtC7R,2EAOR,GAAIqrB,YAAJ,KAAsB,CAClB,MAAMtF,UAAYvsB,KAAK8xB,WAAvB,UAOA,cALO9xB,KAAP,iBACOA,KAAK8xB,WAAZ,UACAvF,wBACAvsB,KAAA,+BAAAA,MAEA,UAGJwG,2CAC2BgpB,WAD3BhpB,2DAKJ2b,YACI,OAAOjR,OAAA,QAAelR,KAAf,oBACH,CAACqH,GAAImM,IAAL,SACQyO,iBAAJ,UACW,MAEH,MAAOA,mBAIXxiB,cAAJ,OACW,MAEH,MAAOwiB,WAAWwK,GAAMA,EAAjBxK,eAIR,MAEH,MAAO/Q,OAAA,uBACH,CAACyiB,IAAKC,GAAN,WAAmB,GAEf,KAAMC,kBAHP,MASf,CACIloB,GAAI3L,KAAK2L,KAKrBoe,UAAU1M,KAAMvK,MACZ,MAAM2U,IAAM,IAAIkL,YAAYtV,KAA5B,MAEA,IAAK,MAAL,aAAwBnM,cAAclR,KAAtC,YACI,GAAIusB,qBAAJ,WAGI,GAFAA,wBAEI9E,IAAJ,UACI,gBAGJ,IAAK,MAAL,mBAA8BvW,cAA9B,WAGI,GAFAgiB,8BAEIzL,IAAJ,UACI,WAMhB,YCzSO,MAAMqM,eAKjBrb,YAAY5Z,KAAK,iCAJL,IAAIowB,KAIC,4BAHV,MAGU,6BAFT,IAAIA,KAGRjvB,KAAA,SAGJ,UACI,OAAOA,KAAK+zB,UAAZ,SAGJ7E,SAASzF,QAGL,OAFAzpB,KAAA,cAAmBypB,OAAnB,WAEA,OAGJnH,IAAI3W,IACA,OAAO3L,KAAK+zB,UAAUzR,IAAtB,IAGJ0R,gBAAgBroB,IACZ,MAAM8d,OAASzpB,KAAKsiB,IAApB,IAEA,eAIOtiB,KAAKoS,OAAZ,IAGJA,OAAOzG,IACH,MAAM8d,OAAS,IAAIsJ,OAAO/yB,KAAX,KAAf,IAMA,OAJAA,KAAA,iBAEAA,KAAA,qCAEA,OAGJmuB,QAAQ1E,QACJA,iBAGJwK,kBAAkBxK,QACdzpB,KAAA,oBACAA,KAAA,iBAAsBypB,OAAtB,IACAzpB,KAAA,uCAGJk0B,YAAYzK,QACR,MAAM0K,KAAOn0B,KAAKo0B,MAAM9R,IAAImH,OAA5B,IAEA,SAIA,IAAK,MAAL,YACI+D,oCAGGxtB,KAAKo0B,MAAM3K,OAAlB,KAGJ4K,OAAOC,SAAUxF,UACR9uB,KAAKo0B,MAAMpB,IAAhB,UAKAhzB,KAAA,kCAJIA,KAAA,mBAAyB,IAAIu0B,IAAI,CAAjC,YAORC,UAAUF,SAAUxF,UACZ9uB,KAAKo0B,MAAMpB,IAAf,WACIhzB,KAAA,qCAIRmiB,UAAUiH,UACN,MAAMqL,KAAN,GAOA,OANarL,UAAsBppB,KAAnC,WAEA00B,SAAcjL,SACVgL,UAAUhL,OAAVgL,gBAGJ,KAGJpS,YAAYvP,MACR,IAAK,MAAL,cAAyBA,KAAzB,SACI9S,KAAA,gBAAqB20B,WAArB,IAGJ,IAAK,MAAL,cAAyB7hB,KAAzB,SACI9S,KAAA,8BAIR40B,kBAAkB9hB,MACd,MAAM,MAASuf,eAAf,KACM5I,OAASzpB,KAAKg0B,gBAApB,IAEA9iB,uCAAsC,EAAEsC,IAAF,UAClC,MAAM6E,KdjGW4J,SACpBoK,gBAAL,QACIA,sBAAuBD,UAAcnK,MAAO,CAAEwJ,YAAY,KAGvDY,gBAAP,Qc4FqBwI,CAAb,KACMrF,WAAaxvB,KAAKuyB,KAAKT,WAAWxP,IAAxC,MAEIkN,WAAJ,cACIte,8BAA8B4jB,IAC1BrL,4BAGJA,iCCrHD,MAAMsL,MAOjBtc,YAAY5Z,IAAKuiB,OAAN,IAAmB,0HAJJ,IAII,iDAHF,IAGE,8BAFrB,IAAImT,KAGTv0B,KAAA,SACAA,KAAA,QAAewxB,IAAM,CAAEwD,IAAF,GAAWn1B,IAAX,GAAoBopB,KAAM,IAA/C,QACAjpB,KAAA,YAGJi1B,QAAQxL,QACJ,MAAMyL,QAASl1B,KAAKm1B,QAAQH,IAAInzB,QAC1B7B,KAAKm1B,QAAQH,IAAII,MAAM/T,GAAMoI,WADpB,KAGT4L,OAASr1B,KAAKm1B,QAAQt1B,IAAIy1B,OAAOjU,GAAMoI,WAA7CpI,KACMkU,SAAWv1B,KAAKm1B,QAAQlM,KAAKmM,MAAM/T,GAAMoI,WAA/CpI,KAEA,OAAO6T,gBAAP,QAGJM,cAAcnsB,IACVrJ,KAAA,iCAGJy1B,gBAAgBpsB,IACZrJ,KAAA,mCAGJgzB,IAAIvJ,QACA,OAAOzpB,KAAK8jB,OAAOkP,IAAnB,QAGJ0C,UAAUjM,QACN,MAAMkM,WAAa31B,KAAKgzB,IAAxB,QAEA,OAAIhzB,KAAKi1B,QAAT,SACI,aACIj1B,KAAA,mBACAA,KAAA,iCAAsC41B,IAAOA,GAA7C,YAGJ,IAGJ,aACI51B,KAAA,sBACAA,KAAA,mCAAwC41B,IAAOA,GAA/C,YAGJ,GAGJC,iBAAiBpM,QACbzpB,KAAA,kBAGJ81B,kBAAkBrM,QACdzpB,KAAA,kBAGJ+1B,oBAAoBtM,QAChBzpB,KAAA,kBAGJg2B,mBAAmBvM,QACXzpB,KAAKgzB,IAAT,UACIhzB,KAAA,sBACAA,KAAA,mCAAwC41B,IAAOA,GAA/C,WAIRK,YACIj2B,KAAA,eAEA,IAAK,MAAL,UAAqBA,KAAKuyB,KAAKnJ,SAA/B,IACIppB,KAAA,kBAGJ,OAAOA,KAAP,OAGJsiB,MACI,OAAOtiB,KAAP,QCrFO,MAAMk2B,cAIjBzd,YAAY5Z,KAAK,oEAFN,IAGPmB,KAAA,SAGJoS,OAAO+jB,SACH,MAAMC,MAAQ,IAAIrB,MAAM/0B,KAAV,KAAd,SAIA,OAFAA,KAAA,qBAEA,MAGJq2B,iBAAiB5M,QACbzpB,KAAA,kBAAuBo2B,OAAUA,wBAAjC,UAGJE,mBAAmB7M,QACfzpB,KAAA,kBAAuBo2B,OAAUA,0BAAjC,UAGJG,gBAAgB9M,QACZzpB,KAAA,kBAAuBo2B,OAAUA,uBAAjC,UAGJnC,kBAAkBxK,QACdzpB,KAAA,kBAAuBo2B,OAAUA,yBAAjC,WCzBO,MAAMI,OACjB/d,cACIzY,KAAA,YAAmB,ICUd,EAAC+hB,KAAD,MACX,IAAIpW,GADsB,GAGtB/J,EAAJ,KACA,KAAOA,KAEL+J,IAtBJ,mEAsBsBQ,iBAAlBR,GAEF,WDlB+B8qB,GACzBz2B,KAAA,WAAkB,IAAIgvB,kBAAtBhvB,MACAA,KAAA,QAAe,IAAIgyB,eAAnBhyB,MACAA,KAAA,SAAgB,IAAI8zB,eAApB9zB,MACAA,KAAA,QAAe,IAAIk2B,cAAnBl2B,MAGJ02B,aACI,OAAO12B,KAAP,cAGJ22B,aAAahrB,IACT,OAAO3L,KAAKopB,SAAShX,OAArB,IAGJwkB,aAAalE,YAAapB,aAAd,IACR,OAAOtxB,KAAK62B,QAAQzkB,OAAOsgB,YAA3B,cAGJoE,cAAcrN,QACV,OAAOzpB,KAAKopB,SAAS+E,QAArB,QAGJ4I,eAAejkB,MACX9S,KAAA,0BAGJg3B,kBAAkBzK,WACdvsB,KAAA,+BAGJ8sB,UAAUnhB,IACN,OAAO3L,KAAKopB,SAAS9G,IAArB,IAGJ+L,gBAAgBhW,KAAMuV,YAClB,OAAO5tB,KAAK8xB,WAAW1f,OAAOiG,KAA9B,YAGJ0Q,YAAYoN,SACR,OAAOn2B,KAAKi3B,QAAQ7kB,OAApB,SAGJ+P,UAAUiH,UACN,MAAO,CACHA,SAAUppB,KAAKopB,SAASjH,UAAUiH,WAI1C/G,YAAYvP,MACR,OAAIA,KAAJ,GACW9S,KAAKopB,SAASwL,kBAArB,MAGG50B,KAAKopB,SAAS/G,YAArB,S,qRE5DD,MAAM6G,qBAAqBgC,+C,MACV,CAChBgM,KAAM,I,wBAFDhO,c,gpBCIN,MAAMiO,wBAAwBjM,8CAYjC,aACI,OAAQlrB,KAAKo3B,SAAWC,wDAAQr3B,KAAKs3B,SAGzC,cACI,OAAOnpB,MAAMnO,KAAKs3B,UAAYt3B,KAAKqB,QAAU,EAGjD,cACI,OAAIrB,KAAKo3B,QACL,kBAAkBp3B,KAAKqB,OAAvB,YAAiCrB,KAAKu3B,WAG1C,WAAWF,wDAAQr3B,KAAKs3B,SAASja,KAAjC,aAA0Crd,KAAKqB,OAA/C,YACIrB,KAAKu3B,WAIb,2BACI,OAAIv3B,KAAKw3B,iBAAmBx3B,KAAKy3B,OACtBz3B,KAAKy3B,OAAO9T,QAGhB,KAGX,6BACI,OAAI3jB,KAAK03B,mBAAqB13B,KAAKy3B,OACxBz3B,KAAKy3B,OAAO5T,UAGhB,KAGX8T,uBACQ33B,KAAK43B,gBAAkB53B,KAAKo3B,UAAYp3B,KAAKypB,OAAOoO,cACpD73B,KAAKypB,OAAO0J,IAAIjK,yDAIxB4O,KAAK9iB,EAAGC,EAAG8iB,UACP,OAAK/3B,KAAKg4B,WAKNh4B,KAAKqB,QAAU,GACfmF,QAAQC,KAAK,iDACN,KAGP0H,MAAM4pB,WAAaA,UAAY/3B,KAAKqB,UACpC02B,SAAW/3B,KAAKqB,QAGpBrB,KAAKqB,QAAU02B,UAEfE,oDAAMC,+DAAkBljB,EAAGC,EAAG,CAC1BqiB,QAASt3B,KAAKs3B,QACdj2B,OAAQ02B,WAGZ/3B,KAAK23B,wBAEE,IAtBHnxB,QAAQC,KAAK,oCACN,GAwBf0xB,YAAYC,OACR,GAAIp4B,KAAKs3B,UAAYc,MAAMd,QAGvB,OAFA9wB,QAAQC,KAAK,0CAEN,EAGX,MAAM4xB,IAAMr4B,KAAKqB,OAAS+2B,MAAM/2B,OAiBhC,OAfIg3B,IAAMr4B,KAAKu3B,WACX/wB,QAAQC,KACJ,0DAEJzG,KAAKqB,OAASrB,KAAKu3B,UAEnBa,MAAM/2B,QAAUg3B,IAAMr4B,KAAKu3B,YAE3Bv3B,KAAKqB,QAAU+2B,MAAM/2B,OAErB+2B,MAAM/2B,QAAU+2B,MAAM/2B,QAG1B+2B,MAAMT,wBAEC,EAGXW,UAAU7Q,KACN,GAAIznB,KAAKo3B,QAEL,YADA5wB,QAAQC,KAAK,2BAIjB,MAAMsO,IAAM0S,IAAI3U,KAAKylB,WAAWC,SAASC,SAEzCz4B,KAAK83B,KAAK/iB,IAAIC,EAAGD,IAAIE,EAAGwS,IAAI3U,KAAKzR,QAEjComB,IAAI3U,KAAKylB,WAAWxO,UAAU,kBAAmB,KACjDtC,IAAIoL,SAGR6F,WAAWjR,KACHznB,KAAKo3B,QACL5wB,QAAQC,KAAK,6BAIjBkyB,+DAAYlR,IAAI3U,KAAKylB,WAAYv4B,KAAKs3B,QAASt3B,KAAKqB,QACpDrB,KAAKqB,OAAS,EACdrB,KAAK23B,uBAELlQ,IAAI3U,KAAKylB,WAAWxO,UAAU,kBAAmB,KACjDtC,IAAIoL,UAGR+F,kBAAkBnR,KACVznB,KAAKo3B,UAIT3P,IAAI3U,KAAK+lB,aAAalyB,KAAK,CACvB0W,KAAM,QACNoK,IAAK,cAGLznB,KAAKg4B,YACLvQ,IAAI3U,KAAK+lB,aAAalyB,KAAK,CACvB0W,KAAM,OACNoK,IAAK,e,IAnJR0P,gB,uBACW,CAChBG,QAASwB,6DACTz3B,OAAQ,GACRk2B,UAAW,GACXC,iBAAiB,EACjBE,mBAAmB,EACnBM,YAAY,EACZJ,gBAAgB,EAChBmB,eAAe,G,+tDCfhB,MAAMC,gBAAkB,kBAClBC,gBAAkB,kBAClBC,gBAAkB,kBAClBC,WAAa,aACbC,UAAY,YACZC,SAAW,WACXC,kBAAoB,oBACpBC,oBAAsB,sBACtBC,sBAAwB,wBACxBC,oBAAsB,sBACtBC,eAAiB,iBACjBC,WAAa,aACbC,eAAiB,iBACjBC,eAAiB,iBACjBC,gBAAkB,kBAClBC,gBAAkB,kBAClBC,eAAiB,iBACjBC,YAAc,cACd/B,iBAAmB,mBACnBgC,iBAAmB,mBACnBC,kBAAoB,oBACpBC,YAAc,cACdC,iBAAmB,mBACnBC,mBAAqB,qBACrBC,gBAAkB,kBAClBC,gBAAkB,kBAClBC,gBAAkB,kBAClBC,aAAe,eACfC,UAAY,YACZC,eAAiB,iBACjBC,iBAAmB,mBACnBC,kBAAoB,oBACpBC,uBAAyB,yBACzBC,kBAAoB,oBACpBC,uBAAyB,yBACzBC,mBAAqB,qBACrBC,gBAAkB,kBAClBC,gBAAkB,kBAClBC,UAAY,YACZC,WAAa,aACbC,UAAY,YACZC,iBAAmB,oB,wgDCvBhC,MAAMC,aAAgBC,YAAgB5oB,MAClClU,8DAAsB88B,WAAY5oB,MAEhC6oB,WAAa,CACf3C,gBAAiB4C,4EACjB3C,gBAAiB4C,4EACjB3C,gBAAiB4C,4EACjB3C,WAAYsC,aAAa,SACzB7B,eAAgB6B,aAAa,YAC7B5B,eAAgB4B,aAAa,QAC7B3B,gBAAiB2B,aAAa,SAC9B1B,gBAAiB0B,aAAa,QAC9BzB,eAAgByB,aAAa,eAC7BxB,YAAawB,aAAa,UAC1BvB,iBAAkBuB,aAAa,cAC/BtB,kBAAmBsB,aAAa,eAChCrB,YAAaqB,aAAa,UAC1BpB,iBAAkBoB,aAAa,cAC/BR,uBAAwBQ,aAAa,cACrCP,mBAAoBO,aAAa,gBACjCnB,mBAAoBmB,aAAa,SACjClB,gBAAiBkB,aAAa,cAC9BjB,gBAAiBiB,aAAa,cAC9BhB,gBAAiBgB,aAAa,aAC9Bf,aAAce,aAAa,WAC3Bd,UAAWc,aAAa,QACxBb,eAAgBa,aAAa,YAC7BX,kBAAmBiB,yEACnBhB,uBAAwBiB,6EACxBnB,iBAAkBoB,wEAClBjB,kBAAmBS,aAAa,eAChCN,gBAAiBM,aAAa,aAC9BL,gBAAiBK,aAAa,aAC9BJ,UAAWI,aAAa,QACxBrC,UAAWqC,aAAa,QACxBpC,SAAUoC,aAAa,OACvBnC,kBAAmB4C,8EACnB3C,oBAAqB4C,gFACrB3C,sBAAuB4C,kFACvB3C,oBAAqB4C,gFACrBf,WAAYgB,yEACZf,UAAWgB,wEACX7C,eAAgB8C,2EAChBtE,iBAAkBuE,6EAClB9C,WAAY+C,yEACZlB,iBAAkBC,aAAa,eAGtBkB,cAAgB,CAACnpB,IAAKwB,EAAGC,EAAGnC,KAAO,GAAI8pB,SAChD,MAAMnT,OAASkS,WAAWnoB,KAAKV,KAAMkC,EAAGC,GASxC,OAPK9G,MAAM6G,IAAO7G,MAAM8G,KAAMwU,OAAO+O,WACjC/O,OAAO+O,SAASqE,QAAUD,MAAMjxB,GAChCixB,MAAMrnB,YAAYP,EAAGC,EAAGwU,OAAO9d,KAGnC8d,OAAOM,UAAU,WAEVN,QAGEwO,MAAQ,CAACzkB,IAAKwB,EAAGC,EAAGnC,KAAO,MACpC,MAAM2W,OAASkS,WAAWnoB,KAAKV,KAAMkC,EAAGC,GAQxC,OANK9G,MAAM6G,IAAO7G,MAAM8G,KAAMwU,OAAO+O,UACjC/O,OAAO+O,SAASsE,OAAO9nB,EAAGC,GAG9BwU,OAAOM,UAAU,WAEVN,S,wVCrFJ,MAAMsT,gBAAkB,KAC3B,MAAMC,KAAOp+B,8DAAsB,QAInC,OAFAo+B,KAAKC,gBAAgB3F,QAAU4F,6DAExBF,O,gZCNJ,MAAMG,aAAe,EACfrE,aAAe,EACfoE,aAAe,EACfE,WAAa,EAEb/F,QAAU,CACnB,CAAC8F,cAAe,CACZ9f,KAAM,QACNggB,UAAW,SACX1Z,QAAS,UACTE,UAAW,UACXyZ,QAAU7T,SACNjjB,QAAQ+2B,IAAI,6BAGpB,CAACzE,cAAe,CACZzb,KAAM,QACNggB,UAAW,SACX1Z,QAAS,UACTE,UAAW,UACXyZ,QAAS,CAAC7T,OAAQpoB,UACdmF,QAAQ+2B,IAAI,uCACZ9T,OAAOM,UAAU,OAAQ,CACrB9H,MAAgB,EAAT5gB,WAInB,CAAC67B,cAAe,CACZ7f,KAAM,QACNggB,UAAW,eACX1Z,QAAS,UACTE,UAAW,UACXyZ,QAAS,CAAC7T,OAAQpoB,UACd,MAAM0T,IAAM0U,OAAO+O,SAASC,SAE5B75B,qEACImW,IAAIC,EACJD,IAAIE,EAAI,EACR,CACI7M,KAAM,GAEV,CACIo1B,UAAW,CACPxoB,EAAG,EACHC,GAAI,GAERwoB,OAAQ,CAAC,IAAK,KACdC,KAAM,CAAC,WACPC,MAAO,IACPC,SAAU,MAIlBnU,OAAOM,UAAU,OAAQ,CACrB9H,MAAgB,EAAT5gB,YAMVs3B,YAAc,CAAClP,OAAQpR,KAAMhX,UACtCg2B,QAAQhf,MAAMilB,QAAQ7T,OAAQpoB,U,wVC5D3B,MAAM07B,gBAAkB,KAC3B,MAAMC,KAAOp+B,8DAAsB,QAInC,OAFAo+B,KAAKC,gBAAgB3F,QAAUwB,6DAExBkE,O,wVCLJ,MAAMD,gBAAkB,KAC3B,MAAMC,KAAOp+B,8DAAsB,QAInC,OAFAo+B,KAAKC,gBAAgB3F,QAAU6F,6DAExBH,O,kdCHJ,MAAMD,gBAAkB,KAC3B,MAAMc,OAASj/B,8DAAsB,UAErCi/B,OAAOC,MAAMC,SAASC,mEAEtB,MAAMC,OAAQhG,+CAAMsC,0DAIpB,OAFAsD,OAAOK,cAAcC,UAAUC,MAAMH,OAE9BJ,S,+0CCVJ,MAAMG,sBAAsBK,iD,gBAAtBL,c,OACK,S,gBADLA,c,cAGW,CAACvU,OAAQ6U,QAClB,I,gBAJFN,c,cAOW,CAACvU,OAAQ6U,QAEzB,MAAMC,QAAU,IAAIhK,IAMpB,GAJA9K,OAAOM,UAAU,sBAAuB,CACpCwU,UAGAA,QAAQxc,KAAO,EAAG,CAClB,MAAMkL,OAAS,IAAIsR,SAAS,GAEtBC,SAAWC,0FAAsCH,KAAM,CACzDrR,OAAQA,OAAOthB,KAOnB,OAJA8d,OAAOqU,MAAMC,SAASS,UAEtB/U,OAAOM,UAAU,eAEV2U,uDAIX,MAAMC,YAAclV,OAAOM,UAAU,WAErC,OAAI4U,YAAY7rB,KAAKwrB,MACjB7U,OAAOqU,MAAMC,SAASY,YAAY7rB,KAAKwrB,MACvC7U,OAAOM,UAAU,eAEV2U,yDAIXjV,OAAOM,UAAU,kBAAmB,KAE7B2U,4D,uVC3CR,MAAML,SAGT,kBAAkB5U,OAAQ6U,MACtB,OAAO,EAGX,kBAAkB7U,OAAQ6U,MACtB,OAAOM,uDAGX,uBAAuBC,eAAgBjR,WAAa,IAChD,OAAO5tB,KAAKoS,OAAO,IACZwb,WACHiR,eAAgBA,eAAepV,OAAO9d,KAI9C,cAAciiB,WAAa,IACvB,OAAOhvB,8DAAsB,OAAQ,CACjC0/B,KAAM,CACFjhB,KAAMrd,KAAKqd,QACRuQ,cAER0Q,M,MAvBO,W,kBADLD,U,sUCHN,MAAMK,QAAU,UACVE,QAAU,UACVE,QAAU,W,kxBCKhB,MAAML,8BAA8BJ,iD,gBAA9BI,sB,OACK,iB,gBADLA,sB,cAGW,CAAChV,OAAQ6U,QACjBA,KAAKrR,QAAUqR,KAAKrR,OAAO8R,QAAUT,KAAKrR,OAAO+R,c,gBAJpDP,sB,cAOW,CAAChV,OAAQ6U,QAMzB,GAJU7U,OAAOM,UAAU,YAAa,CACpCkD,OAAQqR,KAAKrR,SAGTna,KAAKkB,QACT,OAAO0qB,uDAGX,MAAM5/B,MAAQ2qB,OAAO+O,SAASC,SACxBwG,UAAYX,KAAKrR,OAAOuL,SAASC,SAGjCyG,QAASC,0DAAa,CACxBrgC,MACAw/B,KAAMW,UACNG,KAAM,CAAC/a,EAAGD,KACN,GAAIxlB,+DAAuBwlB,EAAEpP,EAAGoP,EAAEnP,GAC9B,OAAO/H,IAGX,GAAIkX,EAAEpP,IAAMiqB,UAAUjqB,GAAKoP,EAAEnP,IAAMgqB,UAAUhqB,EACzC,OAAOoqB,yEAAiBhb,EAAGD,GAG/B,MAAMgF,SAAWxqB,+DAAuBwlB,EAAEpP,EAAGoP,EAAEnP,GAE/C,OAAImU,SAASgM,MAAMnyB,GAAMA,EAAEq8B,WAKvBlW,SAASgM,MACJnyB,GACGA,EAAE0I,KAAO8d,OAAO9d,IAAM1I,EAAE0a,OAAS1a,EAAE6mB,kBANpC5c,IAYPkc,SAASgM,MAAMnyB,GAAMA,EAAEs8B,YAChB,GAGJF,yEAAiBhb,EAAGD,MAInC,GAAI8a,OAAOlrB,SAAWkrB,OAAOE,KAAO,IAAMF,OAAOM,KAAK39B,OAAS,EAAG,CAC9D,MAAM49B,QAAUP,OAAOM,KAAK,GACtBE,MAAQ,CACV1qB,EAAGyqB,QAAQzqB,EAAIlW,MAAMkW,EACrBC,EAAGwqB,QAAQxqB,EAAInW,MAAMmW,GAEnB0qB,SAAWC,wEAA6BtB,KAAM,CAChDxrB,KAAM4sB,QAOV,OAJAjW,OAAOqU,MAAMC,SAAS4B,UAEtBlW,OAAOM,UAAU,eAEV2U,uDAWX,OAFAjV,OAAOM,UAAU,kBAAmB,KAE7B6U,2D,8ZCpFf,MAAMrc,aAAe,CAACvN,EAAGC,EAAG4qB,gBAAiB,KACzC,MAAMC,UAAY,CACd,CACI9qB,EACAC,EAAGA,EAAI,GAEX,CACID,EAAGA,EAAI,EACPC,GAEJ,CACID,EAAGA,EAAI,EACPC,GAEJ,CACID,EACAC,EAAGA,EAAI,IAyBf,OArBI4qB,gBACAC,UAAUn5B,KACN,CACIqO,EAAGA,EAAI,EACPC,EAAGA,EAAI,GAEX,CACID,EAAGA,EAAI,EACPC,EAAGA,EAAI,GAEX,CACID,EAAGA,EAAI,EACPC,EAAGA,EAAI,GAEX,CACID,EAAGA,EAAI,EACPC,EAAGA,EAAI,IAKZ6qB,WAGLtsB,IAAOuB,KAAD,UAAYA,IAAIC,EAAhB,YAAqBD,IAAIE,GAE/B8qB,gBAAkB,CACpBjhC,MAAO,GACPw/B,KAAM,GACNc,KAAM,OACNS,gBAAgB,GAGPV,aAAe,CAACa,SAAWD,mBACpC,MAAME,UAAYD,SAASH,eACrBR,gEACAa,kEACAphC,MAAQkhC,SAASlhC,MACjBw/B,KAAO0B,SAAS1B,KAChBc,KAAOY,SAASZ,KAEhB/rB,KAAO,IAAI8sB,oDACXC,SAAW,GACXC,UAAY,GACZC,SAAW9sB,IAAI1U,OACfyhC,QAAU/sB,IAAI8qB,MAEdY,OAAS,CACXlrB,SAAS,EACTwrB,KAAM,GACNgB,MAAO,GACPpB,KAAMlyB,IACNpO,MACAw/B,MAGJ,GAAIc,KAAKtgC,MAAOw/B,QAAUpxB,IACtB,OAAOgyB,OAaX,IAVA7rB,KAAKotB,IACD,CACIjtB,IAAK8sB,SACLvrB,IAAKjW,OAET,GAGJuhC,UAAUC,UAAY,GAEdjtB,KAAK+jB,WAAW,CACpB,MAAQ5jB,IAAKktB,WAAY3rB,IAAK4rB,SAAYttB,KAAKjN,MAE/C,GAAIs6B,aAAeH,QAAS,CACxBrB,OAAOlrB,SAAU,EACjB,MAGJ,MAAM8rB,UAAYvd,aACdoe,QAAQ3rB,EACR2rB,QAAQ1rB,EACR+qB,SAASH,gBAGb,IAAK,IAAI5O,QAAQ6O,UAAW,CACxB,MAAMc,QAAUptB,IAAIyd,MACd4P,UAAYD,UAAYL,QAAU,EAAInB,KAAKuB,QAAS1P,MAE1D,GAAI4P,YAAc3zB,IACd,SAGJ,MAAM4zB,QAAUT,UAAUK,YAAcG,UAExC,KAAMD,WAAWP,YAAcS,QAAUT,UAAUO,SAAU,CACzDP,UAAUO,SAAWE,QAErB,MAAMC,SAAWD,QAAUb,UAAUhP,KAAMqN,MAE3CjrB,KAAKotB,IACD,CACIjtB,IAAKotB,QACL7rB,IAAKkc,MAET8P,UAGJX,SAASQ,SAAWD,UAKhC,IAAKzB,OAAOlrB,QACR,OAAOkrB,OAGXA,OAAOM,KAAO,CAAClB,MACfY,OAAOE,KAAOiB,UAAUE,SACxBrB,OAAOsB,MAAQ,CAACH,UAAUE,UAE1B,IAAIS,SAAWZ,SAAS5sB,IAAI8qB,OAE5B,KAAO0C,UAAU,CACb,MAAMC,YAAcztB,IAAIwtB,UAExB9B,OAAOM,KAAK0B,QAAQF,UACpB9B,OAAOsB,MAAMU,QAAQb,UAAUY,cAE/BD,SAAWZ,SAASa,aAGxB,OAAO/B,S,+MC3JJ,MAAMG,iBAAmB,CAAChb,EAAGD,KAChC,MAAM+c,GAAKh1B,KAAKK,IAAI6X,EAAErP,EAAIoP,EAAEpP,GACtBosB,GAAKj1B,KAAKK,IAAI6X,EAAEpP,EAAImP,EAAEnP,GAE5B,OAAO,GAAKksB,GAAKC,KAAO,KAAO,GAASj1B,KAAK2C,IAAIqyB,GAAIC,M,iNCJlD,MAAMlB,kBAAoB,CAAC7b,EAAGD,IAC1BjY,KAAKK,IAAI6X,EAAErP,EAAIoP,EAAEpP,GAAK7I,KAAKK,IAAI6X,EAAEpP,EAAImP,EAAEnP,I,gdCCnC,MAAMkrB,cAAc,iDACtB,KAET/I,UACI,OAAO,sBAAAp3B,KAAA,QAAY6B,QAAU,EAGjCuE,MACI,IAAKpG,KAAKo3B,UACN,OAAO,sBAAAp3B,KAAA,QAAYuR,QAAQ0Q,MAInCof,OACI,IAAKrhC,KAAKo3B,UACN,OAAO,sBAAAp3B,KAAA,QAAY,GAAGiiB,MAI9Bwe,IAAIxe,MAAO8e,UACP,MAAMO,KAtBK,EAACrf,MAAO8e,YAAR,CAAwB9e,MAAO8e,WAsB7BQ,CAAWtf,MAAO8e,UAE/B,IAAK,IAAIn/B,EAAI,EAAGA,EAAI,sBAAA5B,KAAA,QAAY6B,OAAQD,IACpC,GAAI,sBAAA5B,KAAA,QAAY4B,GAAGm/B,SAAWO,KAAKP,SAE/B,YADA,sBAAA/gC,KAAA,QAAY0Q,OAAO9O,EAAG,EAAG0/B,MAKjC,sBAAAthC,KAAA,QAAY2G,KAAK26B,S,+eC5BlB,MAAM1B,qBAAqBvB,iD,gBAArBuB,a,OACK,Q,gBADLA,a,cAGW,CAACnW,OAAQ6U,OAClBA,KAAKj/B,W,gBAJPugC,a,cAOW,CAACnW,OAAQ6U,OACb7U,OAAOM,UAAU,WAAY,CACrC/U,EAAGspB,KAAKxrB,KAAKkC,EACbC,EAAGqpB,KAAKxrB,KAAKmC,IAGTusB,SACJlD,KAAKj/B,UAAW,EAETq/B,wDAGJE,0D,qfCnBR,MAAM6C,wBAAwBpD,iD,gBAAxBoD,gB,OACK,W,gBADLA,gB,cAGW,CAAChY,OAAQ6U,OAClBA,KAAKj/B,W,gBAJPoiC,gB,cAOW,CAAChY,OAAQ6U,OACb7U,OAAOM,UAAU,eAAgB,CACzC2X,KAAM,MAGFF,SACJlD,KAAKj/B,UAAW,EAETq/B,wDAGJE,0D,kdChBR,MAAM7B,gBAAkB,KAC3B,MAAM4E,QAAU/iC,8DAAsB,iBAEtC+iC,QAAQ7D,MAAMC,SAASC,mEAEvB,MAAM4D,MAAO3J,+CAAM2C,yDAInB,OAFA+G,QAAQzD,cAAcC,UAAUC,MAAMwD,MAE/BD,U,mYCTJ,MAAM5E,gBAAkB,KAC3B,MAAM4E,QAAU/iC,8DAAsB,mBAQtC,OANA+iC,QAAQ7D,MAAMC,SAASC,mEAMhB2D,U,iVCXJ,MAAM5E,gBAAkB,KAC3B,MAAM1kB,MAAOwpB,uDAAW,CAAC,WAAY,kBAGrC,OAFajjC,8DAAsByZ,Q,+RCLhC,MAAMwpB,WAAcC,KAChBA,IAAI31B,KAAK41B,MAAM51B,KAAK61B,SAAWF,IAAIjgC,SAGjCogC,UAAY,CAACnzB,IAAK1C,MACpBD,KAAK41B,MAAM51B,KAAK61B,UAAY51B,IAAM0C,IAAM,GAAKA,KAG3CozB,WAAa,IACfL,WAAW,EAAC,GAAM,IAGhBM,mBAAqB,CAACC,OAAS,KACjCj2B,KAAK61B,UAAYI,Q,mVCVrB,MAAMrF,gBAAkB,KAC3B,MAAMsF,SAAWzjC,8DAAsB,iBAIvC,OAFAyjC,SAASvE,MAAMC,SAASC,mEAEjBqE,W,gRCNJ,MAAMtF,gBAAmBjqB,MACrBlU,8DAAsB,OAAQ,CACjCq+B,gBAAiB,CACb3F,QAASxkB,KAAKwkB,QACdj2B,OAAQyR,KAAKzR,W,iVCHlB,MAAM07B,gBAAkB,KAC3B,MAAMuF,MAAQ1jC,8DAAsB,SAC9B2jC,IAAKV,uDAAW,CAAC,IAAK,IAAK,IAAK,MAItC,OAFAS,MAAMlf,MAAMmf,GAAKA,GAEVD,Q,uVCNJ,MAAMvF,gBAAkB,KAC3B,MAAMuF,MAAQvG,+DACRyG,OAAQX,uDAAW,CACrB,UACA,UACA,UACA,UACA,YAKJ,OAFAS,MAAMlf,MAAMlF,IAAMskB,MAEXF,Q,kRCbJ,MAAMvF,gBAAkB,KAC3B,MAAM0F,KAAO7jC,KAAKC,IAAI+3B,aAAa,QAC7B2L,IAAKV,uDAAW,CAAC,IAAK,IAAK,IAAK,MAItC,OAFAY,KAAKrf,MAAMmf,GAAKA,GAETE,O,iVCLJ,MAAM1F,gBAAkB,KAC3B,MAAM2F,MAAQ9jC,8DAAsB,SAC9B2jC,IAAKV,uDAAW,CAAC,IAAK,IAAK,IAAK,MAItC,OAFAa,MAAMtf,MAAMmf,GAAKA,GAEVG,Q,mVCNJ,MAAM3F,gBAAkB,KAC3B,MAAM4F,MAAQ/jC,8DAAsB,SAIpC,OAFA+jC,MAAM7E,MAAMC,SAASC,mEAEd2E,Q,mVCLJ,MAAM5F,gBAAkB,KAC3B,MAAM6F,KAAOhkC,8DAAsB,QAInC,OAFAgkC,KAAK9E,MAAMC,SAASC,mEAEb4E,O,sYCJJ,MAAMC,aAAa3X,8CAOtB,SACI,OAAOlrB,KAAK8iC,OAAS9iC,KAAK+iC,OAAS/iC,KAAKgjC,SAG5C,cACI,OAAOhjC,KAAK8iC,OAAS,SAAW,WAGpCG,WACI,GAAIjjC,KAAK8iC,OACL,OAAO,EAGX9iC,KAAK8iC,QAAS,EAEd,MAAM1f,MAAQpjB,KAAKypB,OAAOrG,MAS1B,OAPIA,QACAA,MAAMmf,GAAKviC,KAAKuiC,IAGpBviC,KAAKypB,OAAO6V,QAAQnR,UACpBnuB,KAAKypB,OAAOyZ,aAAa/U,WAElB,EAGXgV,YACI,IAAKnjC,KAAK8iC,OACN,OAAO,EAIX9iC,KAAK8iC,QAAS,EAEd,MAAM1f,MAAQpjB,KAAKypB,OAAOrG,MAS1B,OAPIA,QACAA,MAAMmf,GAAKviC,KAAKuiC,IAGpBviC,KAAKypB,OAAO0J,IAAIiQ,+CAChBpjC,KAAKypB,OAAO0J,IAAIkQ,0DAET,EAGXzK,kBAAkBnR,KACVznB,KAAK8iC,OACLrb,IAAI3U,KAAK+lB,aAAalyB,KAAK,CACvB0W,KAAM,aACNoK,IAAK,mBAGTA,IAAI3U,KAAK+lB,aAAalyB,KAAK,CACvB0W,KAAM,YACNoK,IAAK,kBAKjB6b,eAAe7b,KACPznB,KAAKmjC,aACL1b,IAAI3U,KAAKylB,WAAWxO,UAAU,kBAAmB,KAErDtC,IAAIoL,SAGR0Q,cAAc9b,KACNznB,KAAKijC,YACLxb,IAAI3U,KAAKylB,WAAWxO,UAAU,kBAAmB,KAErDtC,IAAIoL,SAGR2Q,gBAAgB/b,KACPznB,KAAK8iC,SACNrb,IAAI3U,KAAK2wB,gBAAiB,EAC1Bhc,IAAI3U,KAAK4wB,mBAAoB,GAGjC1jC,KAAKijC,Y,MAvFW,CAChBH,QAAQ,EACRC,OAAQ,IACRC,SAAU,M,wBAJLH,M,8VCFN,MAAMO,gBAAgBlY,8CACzBsY,gBAAgB/b,KAEPznB,KAAK2jC,aAIVlc,IAAI3U,KAAK2wB,gBAAiB,EAC1Bhc,IAAI3U,KAAK4wB,mBAAoB,M,qRCR9B,MAAML,qBAAqBnY,8CAK9B0Y,eACQ5jC,KAAK6jC,qBACL7jC,KAAKmuB,W,MANO,CAChB0V,qBAAqB,I,wBAFhBR,c,4dCEN,MAAMS,aAAa5Y,8CACtB6Y,KAAKC,UACD,GAAIhkC,KAAKypB,OAAOwa,cAAe,CAC3B,GAAIjkC,KAAKypB,OAAOwa,cAAcC,UAAUF,UACpC,OAAO,EAGGhkC,KAAKypB,OAAOwa,cAAcE,MAElCC,UAAUC,WAAWrkC,KAAKypB,QAKpC,OAFAua,SAASI,UAAUE,QAAQtkC,KAAKypB,SAEzB,EAGXmP,kBAAkBnR,KACd,MAAM8Q,WAAa9Q,IAAI3U,KAAKylB,WACtB0L,cAAgBjkC,KAAKypB,OAAOuJ,IAAIuR,2DAEjChM,WAAWvF,IAAIwR,qDAIhBP,cACI1L,WAAW6L,UAAUK,QAAQzkC,KAAKypB,QAClChC,IAAI3U,KAAK+lB,aAAalyB,KAAK,CACvB0W,KAAM,OACNoK,IAAK,aAGTA,IAAI3U,KAAK+lB,aAAalyB,KAAK,CACvB0W,KAAM,OACNoK,IAAK,aAIbA,IAAI3U,KAAK+lB,aAAalyB,KAAK,CACvB0W,KAAM,SACNoK,IAAK,iBAKjBid,WAAWjd,KACFA,IAAI3U,KAAKylB,WAAWvF,IAAIwR,qDAIzB/c,IAAI3U,KAAKylB,WAAW6L,UAAUK,QAAQzkC,KAAKypB,SAI/ChC,IAAI3U,KAAKylB,WAAW6L,UAAUE,QAAQtkC,KAAKypB,SAG/Ckb,YAAYld,KACRznB,KAAK+jC,KAAKtc,IAAI3U,KAAKylB,YAEnB9Q,IAAI3U,KAAKylB,WAAWxO,UAAU,kBAAmB,KACjDtC,IAAIoL,SAGR+R,UAAUnd,KACNznB,KAAK+jC,KAAKtc,IAAI3U,KAAKylB,YAEnB9Q,IAAI3U,KAAKylB,WAAWxO,UAAU,kBAAmB,KACjDtC,IAAIoL,Y,giBClEL,MAAM2R,kBAAkBtZ,8CAM3BwB,cACI1sB,KAAKs3B,QAAQ/jB,SAASkW,QAAWA,OAAO0E,YAG5C0W,iBAAiBpd,KACbznB,KAAKs3B,QAAQ/jB,SAASkW,SAClBhC,IAAI3U,KAAKosB,OAAO/L,IAAI1J,QACpBA,OAAOM,UAAU,kBAAmB,CAAEmV,OAAQzX,IAAI3U,KAAKosB,YAI/D4F,aAAaC,qBACT,OAAO/kC,KAAKs3B,QAAQ0N,MAAMvb,QAElBA,OAAOuJ,IAAIiS,oDACXxb,OAAOyb,UAAUC,aAAeJ,sBAK5CT,QAAQc,MACJ,GAAIA,KAAKpS,IAAIiS,mDAAY,CACrB,MAAMI,SAAWrlC,KAAK8kC,aAAaM,KAAKF,UAAUC,YAElD,GAAIE,SAGA,YAFAA,SAASH,UAAUI,SAASF,MAMpCA,KAAKjS,IAAIoR,0DAAe,CACpBJ,MAAOnkC,KAAKypB,SAGhBzpB,KAAKs3B,QAAQ3wB,KAAKy+B,MAGtBX,QAAQW,MAGJ,OAFYplC,KAAKs3B,QAAQ7oB,QAAQ22B,OAEnB,EAGlBf,WAAWe,KAAMrN,UAGb,GAFoBqN,KAAKpS,IAAIiS,qDAET92B,MAAM4pB,UAGtB,OAFAqN,KAAKF,UAAUthC,MAAMm0B,UAEd/3B,KAAKqkC,WAAWe,MAG3B,MAAMvjB,IAAM7hB,KAAKs3B,QAAQ7oB,QAAQ22B,MAOjC,OALIvjB,KAAO,IACP7hB,KAAKs3B,QAAQ5mB,OAAOmR,IAAK,GACzBujB,KAAKnB,cAAc9V,WAGhBiX,KAGXG,SAASH,KAAMrN,UACX,MAAMpK,GAAK3tB,KAAKqkC,WAAWe,KAAMrN,UAC3BhjB,IAAM/U,KAAKypB,OAAO+O,SAASC,SAQjC,OANA9K,GAAG6K,SAASsE,OAAO/nB,IAAIC,EAAGD,IAAIE,GAE9B0Y,GAAG5D,UAAU,UAAW,CACpByb,QAASxlC,KAAKypB,SAGXkE,GAGX8X,UAAUhe,KACN7oB,mEAA2B4rB,uEAAkB,CACzCkb,WAAY1lC,KAAKypB,OACjBoI,SAAUpK,IAAI3U,KAAKylB,aAEvB9Q,IAAIoL,SAGR+F,kBAAkBnR,KACVznB,KAAK2lC,YACLle,IAAI3U,KAAK+lB,aAAalyB,KAAK,CACvB0W,KAAM,OACNoK,IAAK,c,MA7FG,CAChB6P,QAAS,gBACTqO,YAAY,I,wBAHPnB,W,wbCHN,MAAMD,sBAAsBrZ,8CAK/BgZ,UAAUza,QACN,OAAOzpB,KAAKmkC,OAASnkC,KAAKmkC,MAAMx4B,KAAO8d,OAAO9d,GAGlDk5B,iBAAiBpd,KACbA,IAAI3U,KAAKosB,OAAO/L,IAAInzB,KAAKypB,QAG7Bmc,UAAUne,KACNznB,KAAKmkC,MAAMC,UAAUmB,SAASvlC,KAAKypB,QAEnChC,IAAI3U,KAAKylB,WAAWxO,UAAU,kBAAmB,KAEjDtC,IAAIoL,SAGRgT,SAASpe,KACL,MACMsQ,SADc/3B,KAAKypB,OAAOuJ,IAAIiS,mDACL,EAAI,KAEnCjlC,KAAKmkC,MAAMC,UAAUC,WAAWrkC,KAAKypB,OAAQsO,W,MAxB7B,CAChBoM,MAAO,a,wBAFFI,e,6nBCGN,MAAMU,kBAAkB/Z,8CAM3B,cACI,kBAAYlrB,KAAK+3B,UAGrB+N,UAAUC,QACN/lC,KAAK+3B,UAAYgO,OAGrBT,SAASlN,OACLp4B,KAAK8lC,UAAU1N,MAAM8M,UAAUnN,UAC/BK,MAAM8M,UAAUnN,SAAW,EAC3BK,MAAMjF,IAAIjK,yDAGdtlB,MAAMm0B,UACF,GAAIA,UAAY/3B,KAAK+3B,SAEjB,OADAA,SAAW/3B,KAAK+3B,SACT/3B,KAAKypB,OAGhB,MAAM2E,MAAQxvB,gEAAwBoB,KAAKypB,QAU3C,OATA2E,MAAM8W,UAAUnN,UAAYA,SAE5B/3B,KAAK+3B,SAAWA,SAEZ3J,MAAM4E,IAAIuR,4DAEVnW,MAAM6V,cAAcE,MAAMC,UAAU9M,QAAQ3wB,KAAKynB,OAG9CA,O,IApCF6W,U,uBACW,CAChBE,WAAYa,iEACZjO,SAAU,G,ibCTX,MAAMiO,kBAAoB,oBACpBC,gBAAkB,kBAClBC,cAAgB,gBAChBC,sBAAwB,yB,08BCS9B,MAAMC,kBAAkBlb,8CAQ3B0N,kBAAkBnR,KACTA,IAAI3U,KAAKylB,WAAWvF,IAAIwR,oDAIxB/c,IAAI3U,KAAKylB,WAAW6L,UAAUK,QAAQzkC,KAAKypB,SAIhDhC,IAAI3U,KAAK+lB,aAAalyB,KAAK,CACvB0W,KAAM,QACNoK,IAAK,cAIb4e,MAAMC,WAAYC,WACdvmC,KAAKypB,OAAOM,UAAU,SAAU,CAC5Bwc,UACAD,aAGJ,IAAK,IAAI1kC,EAAI,EAAGA,EAAI0kC,WAAWzkC,OAAQD,IAAK,CACxC,GAAS,GAALA,EACA,SAGJ,MAAM42B,SAAW8N,WAAW1kC,GACtBwnB,SAAWoP,SAASpP,SAE1B,IAAIod,SAAU,EACVC,WAAY,EAEhB,MAAMC,IAAMtd,SAAS4b,MAAMvb,SACvB,MAAMhC,IAAMgC,OAAOM,UAAU,iBAAkB,CAC3Cwc,UACAD,WACAK,WAAY3mC,KAAKypB,SAMrB,OAHA+c,QAAU/e,IAAI3U,KAAK2wB,eACnBgD,UAAYhf,IAAI3U,KAAK4wB,kBAEd8C,SAAWC,aAGtB,GAAIC,IAAK,CACL,GAAID,UAAW,CACX,MAAMzV,KAAOsV,WAAW1kC,EAAI,GAE5B5B,KAAKypB,OAAO+O,SAASsE,OAAO9L,KAAKhc,EAAGgc,KAAK/b,GACzCjV,KAAKypB,OAAOM,UAAU,iBAAkB,CACpCwc,UACAvxB,EAAGgc,KAAKhc,EACRC,EAAG+b,KAAK/b,QAET,CACHjV,KAAKypB,OAAO+O,SAASsE,OAAOtE,SAASxjB,EAAGwjB,SAASvjB,GACjDjV,KAAKypB,OAAOM,UAAU,UAAW,CAC7Bwc,UACAG,IACA1xB,EAAGwjB,SAASxjB,EACZC,EAAGujB,SAASvjB,IAGhB,MAAM/J,KAAM07B,oDAAQC,uDAAeN,WAE7BO,QADM7E,sDAAU,EAAGjiC,KAAK+mC,KACT77B,IAAMlL,KAAKgnC,SAC1BC,OAAS,IAAIC,kDAAO,CACtBC,SAAUZ,UACVa,SAAUV,IACVW,WAAYrnC,KAAKypB,OAAO6d,QAAQtqB,QAChC8pB,OACAS,WAAYvnC,KAAKunC,WACjBC,aAAa,IAGjBd,IAAI3c,UAAU,WAAY,CAAEkd,SAGhC,MACOrlC,IAAM0kC,WAAWzkC,OAAS,IACjC7B,KAAKypB,OAAO+O,SAASsE,OAAOtE,SAASxjB,EAAGwjB,SAASvjB,GACjDjV,KAAKypB,OAAOM,UAAU,iBAAkB,CACpCwc,UACAvxB,EAAGwjB,SAASxjB,EACZC,EAAGujB,SAASvjB,MAM5BwyB,WAAWhgB,KACP,MAAMigB,OAAQC,2DAAcC,yDAAgBngB,IAAI3U,KAAKylB,YAAc,EAEnE35B,gEAAwB8rB,oEAAe,CACnCzR,UAAU4uB,uFACV/oC,MAAO2oB,IAAI3U,KAAKylB,WAAWC,SAASC,SACpCqP,SAAWC,SACPnpC,+DAAuB0rB,wEAEvBtqB,KAAKypB,OAAO+O,SAASsE,OAAOiL,OAAOjpC,MAAMkW,EAAG+yB,OAAOjpC,MAAMmW,GAEzD,MAMMqxB,YANO0B,mEACTD,OAAOjpC,MAAMkW,EACb+yB,OAAOjpC,MAAMmW,EACb8yB,OAAOvP,SAASxjB,EAChB+yB,OAAOvP,SAASvjB,GAEI1J,MAAM,EAAGm8B,MAAQ,GAAG5nC,KAAKiV,MAAD,CAC5CC,EAAGD,IAAIC,EACPC,EAAGF,IAAIE,EACPmU,SAAUxqB,+DAAuBmW,IAAIC,EAAGD,IAAIE,OAGhDwS,IAAI3U,KAAKylB,WAAWxO,UAAU,kBAAmB/pB,KAAKo/B,MAEtDp/B,KAAKqmC,MAAMC,WAAY7e,IAAI3U,KAAKylB,aAEpC0P,SAAU,KACNrpC,qE,IA/HHwnC,U,uBACW,CAChBW,IAAK,EACLC,SAAU,EACV5H,KAAM,IACNmI,WAAYW,qE,i8CCPb,MAAMC,YAAc,cACdC,aAAe,eACfR,eAAiB,iBACjBS,YAAc,cACdC,YAAc,cACdC,eAAiB,iBACjBC,UAAY,YACZC,YAAc,cACdC,aAAe,eAEtBC,OAAS,CACXN,YAAa,IAAIO,wDACjBR,aAAc,IAAIS,yDAClBV,YAAa,IAAIW,wDACjBlB,eAAgB,IAAImB,2DACpBT,YAAa,IAAIU,wDACjBT,eAAgB,IAAIU,2DACpBT,UAAW,IAAIU,sDACfT,YAAa,IAAIU,wDACjBT,aAAc,IAAIU,0DAGTC,SAAY71B,KAAQm1B,OAAOn1B,KAC3B81B,aAAgB91B,KAAQm1B,OAAOn1B,KAAK6J,KACpCsqB,cAAgB,CAACn0B,IAAKiW,SAAWkf,OAAOn1B,KAAK+1B,QAAQ9f,QACrD+f,gBAAmBC,MAC5Bv4B,OAAO2T,OAAO8jB,QAAQvnB,QAAQ6E,GAAMA,EAAEyjB,WAAaD,OAC1CE,oBAAsB,CAACn2B,IAAKiW,UACrC,MAAMmgB,UAAY,GAOlB,OALAngB,OAAOM,UAAP,2BAA6C,CACzC8f,MAAOr2B,IACPo2B,YAGGA,WAEEE,wBAA2BrgB,QAC7BvY,OAAOD,KAAK03B,QAAQoB,QACvB,CAACC,KAAMH,SAAP,IACOG,KACH,CAACH,OAAQF,oBAAoBE,MAAOpgB,WAExC,IAGKwgB,2BAA8BxgB,SACvC,MAAMugB,KAAOF,wBAAwBrgB,QAErC,OAAOvY,OAAOD,KAAK+4B,MAAMD,QACrB,CAAClqC,IAAKgqC,SAAN,IACOhqC,IACH,CAACgqC,OAAQG,KAAKH,OAAOE,QAAO,CAAC1R,IAAK6R,MAAQ7R,IAAM6R,IAAIA,KAAK,MAE7D,M,uaC7DD,MAAMC,qBAAuB,CAACN,MAAQ,IAGlC,EAFM,IAEMA,MAFN,IAKJO,4BAA8B,CAACP,MAAQ,KAChD,MAAMQ,MAAQF,qBAAqBN,OAEnC,OAAO19B,KAAK41B,MAAc,IAARsI,QAGP,MAAMzB,mBAAmB0B,4CACpC7xB,cACIyE,MAAMmrB,iDAAa,Y,yZCfZ,MAAMiC,MAKjB7xB,YAAYjF,IAAK6J,KAAMqsB,UAAU,4BAJ1B,GAI0B,4BAH1B,SAG0B,gCAFtB,MAGP1pC,KAAKwT,IAAMA,IACXxT,KAAKqd,KAAOA,KACZrd,KAAK0pC,SAAWA,SAGpBa,aAAa9gB,QAOT,OANYA,OAAOM,UAAP,kBAAoC,CAC5C1M,KAAMrd,KAAKqd,KACXwsB,MAAO7pC,KAAKwT,IACZo2B,UAAW,KAGJ92B,KAAK82B,UAGpBY,eAAe/gB,QAGX,OAFkBzpB,KAAKuqC,aAAa9gB,QAEnBsgB,QAAO,CAAC1R,IAAKoS,MAAQpS,IAAMoS,IAAIP,KAAK,GAGzDX,QAAQ9f,QAIJ,OAHazpB,KAAK0pC,UAAW9C,+CAAQ5mC,KAAK0pC,SAAUjgB,QAAU,GAC7CzpB,KAAKwqC,eAAe/gB,W,shBC7BtC,MAAMod,cAAgB,gBAChB6D,aAAe,eACfC,iBAAmB,mBACnBC,cAAgB,gBAChBC,WAAa,aAEpBlC,OAAS,CACX,CAAC9B,eAAgB,CACbxpB,KAAM,WACNytB,aAAc,OAElB,CAACJ,cAAe,CACZrtB,KAAM,UACNytB,aAAc,OAElB,CAACH,kBAAmB,CAChBttB,KAAM,cACNytB,aAAc,OAElB,CAACF,eAAgB,CACbvtB,KAAM,WACNytB,aAAc,OAElB,CAACD,YAAa,CACVxtB,KAAM,QACNytB,aAAc,QAITC,YAAetB,MAASd,OAAOc,MAAMpsB,KACrC2tB,oBAAuBvB,MAASd,OAAOc,MAAMqB,aAC7ClE,QAAU,CAAC6C,KAAMhgB,UAC1B,MAAMpM,KAAOsrB,OAAOc,MAAMpsB,KAE1B,OAAOoM,OAAOwhB,MAAM5tB,SAEX6tB,SAAW,CAACzB,KAAMhgB,UACpBwY,sDAAU,EAAG,IAAM2E,QAAQ6C,KAAMhgB,QAE/B0hB,UAAY,CAAC1B,KAAMhgB,OAAQwD,SAC7Bie,SAASzB,KAAMhgB,SAAWwD,Q,+cCtC9B,MAAMme,gBAAkB,CAACvB,MAAQ,IACvB,KACeA,OAKnBwB,uBAAyB,CAACxB,MAAQ,KAC3C,MAAMQ,MAAQe,gBAAgBvB,OAE9B,OAAO19B,KAAK41B,MAAc,IAARsI,QAGP,MAAMvB,mBAAmBwB,4CACpC7xB,cACIyE,MAAMirB,iDAAa,QAASwC,yD,4XCfrB,MAAM5B,sBAAsBuB,4CACvC7xB,cACIyE,MAAM0qB,oDAAgB,WAAY+C,sDAGtCpB,QAAQ9f,QACJ,MAAMtE,MAAOyhB,+CAAQ+D,qDAAkBlhB,QACjCud,SAAWhnC,KAAKwqC,eAAe/gB,QAErC,OAAOtd,KAAKC,IAAI,EAAG+Y,KAAO6hB,a,6ZCT3B,MAAMsE,gBAAkB,CAACzB,MAAQ,KACpC,MACM0B,SAAW,EADJ,GACgB1B,MADhB,GAGb,OAAO19B,KAAK41B,MAAiB,IAAXwJ,WAGP,MAAMvC,mBAAmBsB,4CACpC7xB,cACIyE,MAAMorB,iDAAa,QAASoC,qD,4XCTrB,MAAMzB,sBAAsBqB,4CACvC7xB,cACIyE,MAAMqrB,oDAAgB,WAAY1B,sD,uXCF3B,MAAMqC,iBAAiBoB,4CAClC7xB,cACIyE,MAAMsrB,+CAAW,OAAQ3B,sD,yXCFlB,MAAMsC,mBAAmBmB,4CACpC7xB,cACIyE,MAAMurB,iDAAa,SAAU5B,sD,0XCFtB,MAAMuC,oBAAoBkB,4CACrC7xB,cACIyE,MAAMwrB,kDAAc,UAAW7B,sD,0XCFxB,MAAMgC,oBAAoByB,4CACrC7xB,cACIyE,MAAMkrB,kDAAc,SAAUuC,yD,4LCNvB,MAAMzD,OACjBzuB,YAAY3F,MACR9S,KAAKmnC,SAAWr0B,KAAKq0B,SACrBnnC,KAAKonC,SAAWt0B,KAAKs0B,SACrBpnC,KAAKqnC,WAAav0B,KAAKu0B,WACvBrnC,KAAK8mC,OAASh0B,KAAKg0B,OACnB9mC,KAAKunC,WAAaz0B,KAAKy0B,WACvBvnC,KAAKwnC,YAAc10B,KAAK00B,e,mZCPzB,MAAMU,qBAAuB,uBACvBsD,kBAAoB,oBACpBC,kBAAoB,oBACpBC,kBAAoB,oBAE3B/C,OAAS,CACX,CAACT,sBAAuB,CACpB7qB,KAAM,cACNsuB,KAAM,aAEV,CAACH,mBAAoB,CACjBnuB,KAAM,WACNsuB,KAAM,WAEV,CAACF,mBAAoB,CACjBpuB,KAAM,WACNsuB,KAAM,WAEV,CAACD,mBAAoB,CACjBruB,KAAM,WACNsuB,KAAM,SAIDC,eAAkBvzB,MAASswB,OAAOtwB,MAAMgF,KACxCwuB,eAAkBxzB,MAASswB,OAAOtwB,MAAMszB,M,2PCzB9C,MAAM3D,cAAgB,CAAC8D,GAAIC,GAAIC,GAAIC,MACtC,MAAM9K,GAAKh1B,KAAKK,IAAIw/B,GAAKF,IACnB1K,GAAKj1B,KAAKK,IAAIy/B,GAAKF,IACnBG,GAAKJ,GAAKE,GAAK,GAAK,EACpBG,GAAKJ,GAAKE,GAAK,GAAK,EACpB/M,OAAS,GAEf,IAAI97B,IAAM+9B,GAAKC,GAEf,KACIlC,OAAOv4B,KAAK,CACRqO,EAAG82B,GACH72B,EAAG82B,KAGHD,KAAOE,IAAMD,KAAOE,IANf,CAUT,MAAMG,GAAK,EAAIhpC,IAEXgpC,IAAMhL,KACNh+B,KAAOg+B,GACP0K,IAAMI,IAENE,GAAKjL,KACL/9B,KAAO+9B,GACP4K,IAAMI,IAId,OAAOjN,QAGEmN,uBAAyB,CAACP,GAAIC,GAAIC,GAAIC,MAC/C,MAAMK,KAAOtE,cAAc8D,GAAIC,GAAIC,GAAIC,IAKvC,OAHAK,KAAK/6B,QACL+6B,KAAKlmC,MAEEkmC,O,sRCtCX,MAAMC,OAAS,KAAM,EAER1E,mBAAqB,CAACtc,QAAU,MACzC,MAAMihB,QAAUjhB,QAAQihB,SAAWD,OAEnC,MAAO,CACHC,QACA3vB,OAAS4vB,OACLA,KAAKH,KAAK/4B,SAAQ,EAAGyB,EAAGC,GAAK4M,OACzB,GAAY,IAARA,IACA,OAGJ,MAAM2gB,MAAQgK,QACV,IACOC,KACHz3B,EACAC,GAEJ4M,KAEE,OACA,MACA6qB,OAAS9tC,kEAA0BoW,EAAGC,GAE5CrW,2DAAmB8tC,OAAO13B,EAAG03B,OAAOz3B,EAAG,IAAKutB,c,kqBCnBrD,MAAMmK,qBAAqBzhB,8CAC9B0hB,QAAQ53B,EAAGC,IACPgjB,oDAAMiC,+DAAkBllB,EAAGC,EAAG,CAC1BiwB,UAAW,CACPnN,SAAU,KAId/3B,KAAKypB,OAAOuJ,IAAImE,+DACZn3B,KAAKypB,OAAOwT,gBAAgBnF,KAAK9iB,EAAGC,IACpCrW,2DAAmBiuC,wEAAuB,CACtC5f,OAAQjtB,KAAKypB,OACbgO,OAAQz3B,KAAKypB,OAAOwT,gBAAgB3F,UAI5C14B,2DAAmBiuC,wEAAuB,CACtC5f,OAAQjtB,KAAKypB,SAIrBzpB,KAAKypB,OAAO0J,IAAIjK,yDAGpB4jB,gBAAgBrlB,KACZznB,KAAK4sC,QAAQnlB,IAAI3U,KAAKkC,EAAGyS,IAAI3U,KAAKmC,GAGtC83B,UAAUtlB,KACNznB,KAAK4sC,QAAQnlB,IAAI3U,KAAKkC,EAAGyS,IAAI3U,KAAKmC,M,mvBCjCnC,MAAM+3B,qBAAuB,EACvBC,mBAAqB,EACrBJ,sBAAwB,EACxBK,mBAAqB,EACrBC,oBAAsB,EACtBC,yBAA2B,EAC3BC,oBAAsB,EAE7BC,kBAAqB7jB,QACnBA,OAAOuJ,IAAIua,sDACX,cAAc9jB,OAAO6d,QAAQkG,cAAcpiC,eAG/C,YAGEqiC,yBAA4BhkB,QAC1BA,OAAOO,SACA,MAGPP,OAAOuJ,IAAIua,sDACX,cAAc9jB,OAAO6d,QAAQkG,cAAcpiC,oBAD/C,EAKEsiC,QAAU,CACZ,CAACL,qBAAsB,CACnBM,QAAQ76B,MACJ,MAAM2W,OAAS6jB,kBAAkBx6B,KAAK2W,QAEtC,gBAAUA,OAAV,4BAAoC3W,KAAK86B,MAAzC,OAEJC,aAAa/6B,MACFA,KAAK2W,OAAOO,UAAYlX,KAAK2W,OAAOqkB,WAGnD,CAACZ,oBAAqB,CAClBS,QAAQ76B,MACJ,MAAMq0B,SAAWsG,yBAAyB36B,KAAKq0B,UACzCC,SAAWkG,kBAAkBx6B,KAAKs0B,UAExC,gBAAUA,SAAV,kCAA4CD,SAA5C,aAAyDr0B,KAAKi7B,WAA9D,OAEJF,aAAa/6B,MACFA,KAAKs0B,SAASpd,UAAYlX,KAAKq0B,SAAS2G,WAGvD,CAACd,sBAAuB,CACpBW,QAAQ76B,MACJ,MAAMtN,OAAS8nC,kBAAkBx6B,KAAKtN,QAChCynB,OAASwgB,yBAAyB36B,KAAKma,QACvC+gB,SAAUnC,iEAAe/4B,KAAKy0B,YAC9B0G,IAAMn7B,KAAKg0B,OACXoH,QAAUp7B,KAAKo7B,QAEfC,UACFD,QAAU,EAAV,aAAoBA,QAApB,wBAAoD,GAExD,gBAAU1oC,OAAV,YAAoBwoC,QAApB,YAA+B/gB,OAA/B,gBAA6CghB,IAA7C,cAAsDE,YAE1DN,aAAa/6B,MACFA,KAAKma,OAAOjD,UAAYlX,KAAKma,OAAO6gB,WAGnD,CAACb,oBAAqB,CAClBU,QAAQ76B,MACJ,MAAMtN,OAAS8nC,kBAAkBx6B,KAAKtN,QAChCynB,OAASwgB,yBAAyB36B,KAAKma,QACvC+gB,SAAUnC,iEAAe/4B,KAAKy0B,YAEpC,gBAAU/hC,OAAV,YAAoBwoC,QAApB,YAA+B/gB,OAA/B,cAEJ4gB,aAAa/6B,MACFA,KAAKma,OAAOjD,UAAYlX,KAAKma,OAAO6gB,WAGnD,CAACjB,uBAAwB,CACrBc,QAAQ76B,MACA3E,MAAM2E,KAAK2kB,QACX,UAAU6V,kBAAkBx6B,KAAKma,QAAjC,cAEA,UAAUqgB,kBACNx6B,KAAKma,QADT,oCAGIoK,kDAAQvkB,KAAK2kB,QAAQ4F,UAHzB,aAORwQ,aAAa/6B,MACFA,KAAKma,OAAO6gB,WAG3B,CAACV,0BAA2B,CACxBO,QAAQ76B,MACJ,UAAUw6B,kBACNx6B,KAAK2W,QADT,+BAEwBgkB,yBACpB36B,KAAKs7B,MAHT,wBAMJP,aAAa/6B,MACFA,KAAKs7B,KAAKN,YAKhBO,WAAa,CAAC5mB,IAAK3U,OACrB46B,QAAQjmB,KAAKkmB,QAAQ76B,MAGnB+6B,aAAe,CAACpmB,IAAK3U,OACvB46B,QAAQjmB,KAAKomB,aAAa/6B,O,iVCjH9B,MAAMw7B,cAAcpjB,8CAKvBwB,cACI1sB,KAAKuuC,MAAMh7B,SAASkW,SAChBA,OAAO0E,aAIfqgB,aAAa/mB,KACT,KAAOznB,KAAKyuC,YAAczuC,KAAKyuC,WAAWC,cACtC1uC,KAAK2uC,UAAUllB,OAAO0E,UAG1B,MAAMygB,YAAc5uC,KAAKyuC,WACnBvP,OAAS0P,YAAYC,aAEvB3P,SAAWN,0DACX5+B,KAAK8uC,WAAWF,aACT1P,SAAWJ,4DAClB9+B,KAAK8uC,WAAWF,aAChB5uC,KAAKypB,OAAOM,UAAU,gBAG1BtC,IAAIoL,SAGRic,WAAWxQ,MACP,MAAMyQ,eAAiB,GAEvB/uC,KAAKuuC,MAAQvuC,KAAKuuC,MAAMntB,QAAQ+C,IAC5B,MAAM6qB,OAASthB,QAAQvJ,EAAExY,KAAO2yB,KAAK7U,OAAO9d,IACtCsjC,cAAgBvhB,QAClBvJ,EAAEma,KAAKO,gBACH1a,EAAEma,KAAKO,eAAelzB,KAAO2yB,KAAKO,eAAelzB,IAGzD,OAAIqjC,SAAUC,gBACVF,eAAepoC,KAAKwd,EAAEma,OACf,MAMfyQ,eAAex7B,SAAS4Q,GAAMA,EAAEsF,OAAO0E,YAG3C4P,SAASO,MACL,KAAMA,gBAAgBpT,+CAClB,MAAM,IAAI6F,MAAM,8BAA+BuN,MAKnD,OAFAA,KAAKnsB,OAASnS,KAAKypB,OAEZzpB,KAAKuuC,MAAM5nC,KAAK23B,KAAK7U,QAGhCklB,UACI,OAAO3uC,KAAKuuC,MAAMnoC,MAAMk4B,KAG5BmQ,WACI,OAAOzuC,KAAKuuC,MAAMvuC,KAAKuuC,MAAM1sC,OAAS,GAAGy8B,M,MAhEzB,CAChBiQ,MAAO,kB,wBAFFD,O,+eCCN,MAAMY,aAAahkB,8CAKtBikB,QAAQ1nB,KACJ,IAAKznB,KAAKypB,OAAOuJ,IAAI,YACjB,OAGJ,MAAMje,IAAM/U,KAAKypB,OAAO+O,SAASC,SAC3B2W,QAASnX,oDAAMj4B,KAAKqvC,gBAAiBt6B,IAAIC,EAAGD,IAAIE,GAElDjV,KAAKypB,OAAOuJ,IAAI,aAChBoc,OAAO9H,QAAQjqB,KAAf,UAAyBrd,KAAKypB,OAAO6d,QAAQjqB,KAA7C,YAIRmmB,gBAAgB/b,KACZA,IAAI3U,KAAK2wB,gBAAiB,G,IAnBrByL,K,uBACW,CAChBG,gBAAiBpV,2D,wbCHlB,MAAMqV,aAAapkB,8CAUtBwjB,aACI,OAAOa,0DAAyBvvC,KAAKmS,OAAQnS,MAGjD6uC,aACI,OAAOU,0DAAyBvvC,KAAKmS,OAAQnS,O,MAd7B,CAChBqd,KAAM,QACNwhB,eAAgB,WAChB1sB,OAAQ,WACR8a,OAAQ,WACR5tB,UAAU,EACVyT,KAAM,K,wBAPDw8B,M,kYCDb,MAAME,YAAc,GAEpBt+B,OAAO2T,OAAO4qB,yCAAWl8B,SAASm8B,WAC9BF,YAAYE,SAASryB,MAAQqyB,YAGjC,MAAMC,YAAetyB,OACjB,MAAMhF,KAAOm3B,YAAYnyB,MAMzB,OAJKhF,MACD7R,QAAQC,KAAR,oBAA0B4W,KAA1B,iBAGGhF,MAGEq2B,WAAa,CAACjlB,OAAQ6U,OAClBqR,YAAYrR,KAAKjhB,MAElBqxB,WAAWjlB,OAAQ6U,MAGtBuQ,WAAa,CAACplB,OAAQ6U,OAClBqR,YAAYrR,KAAKjhB,MAElBwxB,WAAWplB,OAAQ6U,O,4cCtB5B,MAAMiP,gBAAgBriB,8CAKzB,oBACI,OAAOlrB,KAAKqd,KAGhB,cAGI,GAFkBrd,KAAKypB,OAAOuJ,IAAImE,+DAEnB,CACX,MAAMyY,KAAO5vC,KAAKypB,OAAOwT,gBAAgBjgB,QAEzC,gBAAUhd,KAAKqd,KAAf,YAAuBuyB,MAK3B,GAFqB5vC,KAAKypB,OAAOuJ,IAAIiS,mDAEnB,CACd,MAAM2K,KAAO5vC,KAAKypB,OAAOyb,UAAUloB,QAEnC,gBAAUhd,KAAKqd,KAAf,YAAuBuyB,MAK3B,GAFgB5vC,KAAKypB,OAAOuJ,IAAI6P,yCAEnB,CACT,MAAM+M,KAAO5vC,KAAKypB,OAAOomB,KAAK7yB,QAE9B,gBAAUhd,KAAKqd,KAAf,YAAuBuyB,MAG3B,OAAO5vC,KAAKqd,M,MAjCI,CAChBA,KAAM,Y,wBAFDkwB,S,0ZCFN,MAAMuC,eAAe5kB,8CACxB,cACI,OAAOlrB,KAAKypB,OAAOuJ,IAAIua,+CACjBvtC,KAAKypB,OAAO6d,QAAQtqB,QACpB,UAGV+yB,MAAMtoB,KACFjhB,QAAQ+2B,IAAR,WAAgBv9B,KAAKsnC,QAArB,KAAiC7f,IAAI3U,MACrC2U,IAAIoL,Y,4UCTL,MAAMmd,iBAAiB9kB,8CAK1BuN,SACI,OAAO75B,6DAAqBoB,KAAKypB,OAAO9d,GAAI3L,KAAK68B,SAGrDC,OAAO9nB,EAAGC,GACN,OAAOrW,6DAAqBoW,EAAGC,EAAGjV,KAAKypB,OAAO9d,GAAI3L,KAAK68B,SAG3DoT,OAAOj7B,EAAGC,GACN,MAAMF,IAAM/U,KAAKy4B,SAEjB,OAAO1jB,IAAIC,IAAMA,GAAKD,IAAIE,IAAMA,G,MAfhB,CAChB4nB,QAAS,I,wBAFJmT,U,8aCAN,MAAME,cAAchlB,8CASvB,cACI,GAAIlrB,KAAKypB,OAAOuJ,IAAImE,+DAAkB,CAClC,MAAMgZ,IAAMnwC,KAAKypB,OAAOwT,gBAAgBmT,qBAExC,GAAID,IACA,OAAOA,IAIf,OAAOnwC,KAAKke,IAGhB,gBACI,GAAIle,KAAKypB,OAAOuJ,IAAImE,+DAAkB,CAClC,MAAMgZ,IAAMnwC,KAAKypB,OAAOwT,gBAAgBoT,uBAExC,GAAIF,IACA,OAAOA,IAIf,OAAOnwC,KAAKme,IAGhB,iBACI,OAAOne,KAAKoe,GAGhB,WACI,OAAOpe,KAAKuiC,I,MArCI,CAChBrkB,IAAK,OACLC,IAAK,OACLC,GAAI,KACJmkB,GAAI,IACJrtB,EAAG,M,wBANEg7B,O,yhBCEN,MAAMI,cAAcplB,8CACvBqlB,UAAU9oB,KACN,MAAM+Q,SAAWx4B,KAAKypB,OAAO+O,SAASC,SAChC+X,QAAUhY,SAASxjB,EAAIyS,IAAI3U,KAAKkC,EAChCy7B,QAAUjY,SAASvjB,EAAIwS,IAAI3U,KAAKmC,EAEhCy7B,mBAAqB9xC,+DAAuB4xC,QAASC,SAE3D,GAAIC,mBAAmBtb,MAAM3L,QAAWA,OAAOuJ,IAAIoQ,iDAC/C,OAGJ,MAAMuN,WAAaD,mBAAmB1L,MAAMvb,QAEpCA,OAAOmnB,gBACNhyC,yEAAiC6qB,OAAQzpB,KAAKypB,UAKnDknB,YACAA,WAAWnY,SAASsE,OAAOtE,SAASxjB,EAAGwjB,SAASvjB,GAGpD,MACMmqB,KAAQ,IAAM,IADNuI,2DAAcQ,sDAAanoC,KAAKypB,SACX,IAEnCzpB,KAAKypB,OAAOM,UAAU,kBAAmBqV,MACzCp/B,KAAKypB,OAAO+O,SAASsE,OAAO0T,QAASC,SAErChpB,IAAIoL,Y,+PCjCL,MAAMge,iBAAiB3lB,iD,2YCEvB,MAAM4lB,kBAAkB5lB,8CAC3B6lB,UAAUtpB,KACN,GAAItb,KAAK61B,SAAW,GAChB,OAGJ,MAAMxE,UAAYrxB,KAAK41B,MAAsB,EAAhB51B,KAAK61B,UAC5BtC,OAAQsR,iEAAexT,WAE7B/V,IAAI3U,KAAKwrB,KAAOsB,+DAAoB,CAChC9sB,KAAM4sB,QAEVjY,IAAIoL,Y,yhBChBZ,MAAMoe,WAAa,CACf,CACIz9B,IAAK,EACL09B,UAAW,KACXC,SAAU,YACVzR,MAAO,CACH1qB,GAAI,EACJC,GAAI,IAGZ,CACIzB,IAAK,EACL09B,UAAW,IACXC,SAAU,QACVzR,MAAO,CACH1qB,EAAG,EACHC,GAAI,IAGZ,CACIzB,IAAK,EACL09B,UAAW,KACXC,SAAU,YACVzR,MAAO,CACH1qB,EAAG,EACHC,GAAI,IAGZ,CACIzB,IAAK,EACL09B,UAAW,IACXC,SAAU,OACVzR,MAAO,CACH1qB,GAAI,EACJC,EAAG,IAGX,CACIzB,IAAK,EACL09B,UAAW,IACXC,SAAU,OACVzR,MAAO,CACH1qB,EAAG,EACHC,EAAG,GAEPm8B,SAAU,IAEd,CACI59B,IAAK,EACL09B,UAAW,IACXC,SAAU,OACVzR,MAAO,CACH1qB,EAAG,EACHC,EAAG,IAGX,CACIzB,IAAK,EACL09B,UAAW,KACXC,SAAU,YACVzR,MAAO,CACH1qB,GAAI,EACJC,EAAG,IAGX,CACIzB,IAAK,EACL09B,UAAW,IACXC,SAAU,QACVzR,MAAO,CACH1qB,EAAG,EACHC,EAAG,IAGX,CACIzB,IAAK,EACL09B,UAAW,KACXC,SAAU,YACVzR,MAAO,CACH1qB,EAAG,EACHC,EAAG,KAKFo8B,OAAS,EACTC,MAAQ,EACRC,OAAS,EACTC,MAAQ,EACRC,MAAQ,EACRC,MAAQ,EACRC,OAAS,EACTC,MAAQ,EACRC,OAAS,EAEtBZ,WAAWI,QAAQD,SAAW,CAACE,MAAOE,OACtCP,WAAWK,OAAOF,SAAW,CAACC,OAAQE,QACtCN,WAAWM,QAAQH,SAAW,CAACE,MAAOI,OACtCT,WAAWO,OAAOJ,SAAW,CAACC,OAAQM,QACtCV,WAAWS,OAAON,SAAW,CAACG,OAAQM,QACtCZ,WAAWU,QAAQP,SAAW,CAACI,MAAOI,OACtCX,WAAWW,OAAOR,SAAW,CAACO,OAAQE,QACtCZ,WAAWY,QAAQT,SAAW,CAACQ,MAAOF,OAE/B,MAAMI,cAAgB,IAAM,CAC/BT,OACAC,MACAC,OACAC,MACAE,MACAC,OACAC,MACAC,QAGSX,UAAa1T,WAAcyT,WAAWzT,WAAW0T,UAEjDC,SAAY3T,WAAcyT,WAAWzT,WAAW2T,SAEhDH,eAAkBxT,WAAcyT,WAAWzT,WAAWkC,MAEtD0R,SAAY5T,WAAcyT,WAAWzT,WAAW4T,SAEhDW,kBAAqBvU,WAC9B4T,SAAS5T,WAAW19B,IAAIkxC,gBAEfgB,mBAAqB,CAACh9B,EAAGC,IAC3B/D,OAAO2T,OAAOosB,YAAYjM,MAAMiN,KAC5BA,IAAIvS,MAAM1qB,IAAMA,GAAKi9B,IAAIvS,MAAMzqB,IAAMA,K,+QC9H7C,MAAMi9B,kBAAkBhnB,+C,MACP,CAChB6a,OAAQ,EACR2B,MAAO,I,wBAHFwK,W,oWCAN,MAAMC,mBAAmBjnB,iD,+PCAzB,MAAMknB,iBAAiBlnB,iD,6uBCgBvB,MAAMmnB,eAAennB,8CAKxB,UAII,OAAO,GAAa,EAHNlrB,KAAKypB,OAAOmkB,MAAMA,MAGA,GAFlBjG,2DAAcS,uDAAcpoC,KAAKypB,QAKnD6oB,YACItyC,KAAKiiB,MAAQjiB,KAAKoM,IAGtBmmC,YAAYzL,QAGR,OAFA9mC,KAAKiiB,OAAS6kB,OAEV9mC,KAAKiiB,OAAS,IACdjiB,KAAKiiB,MAAQ,EACbjiB,KAAKypB,OAAO0J,IAAIhK,8CAET,GAMfqpB,WAAW/qB,KACP,MAAMwf,OAASxf,IAAI3U,KAAKm0B,OAClBE,SAAWF,OAAOE,SAClBC,SAAWH,OAAOG,SAClBqL,OAAQ9K,2DAAcW,sDAAalB,UACnC2G,YAAazC,wEAAgBmH,OAEnC,IAAKxL,OAAOO,cAAevF,sDAAU,EAAG,MAAQ8L,WAY5C,OAXAnvC,2DAAmBsuC,qEAAoB,CACnC9F,SACAD,SACA4G,aAGJtmB,IAAI3U,KAAKg0B,OAAS,EAClBrf,IAAI3U,KAAK4/B,UAAW,EACpBjrB,IAAI3U,KAAK6/B,UAAW,OACpBlrB,IAAIoL,SAKRpL,IAAI3U,KAAK4/B,UAAW,EAEpB,MAAME,OAAQjL,2DAAcU,sDAAajB,UACnCyL,YAAa1I,6EAAqByI,OAClC1E,QAAU/hC,KAAK41B,MAAMkF,OAAOH,OAAS+L,YACrC/L,OAAS36B,KAAKC,IAAI,EAAG66B,OAAOH,OAASoH,SAC3CzmB,IAAI3U,KAAKg0B,OAASA,OAElB,MAAM6L,SAAW3yC,KAAKuyC,YAAYzL,QAGlC,GAFArf,IAAI3U,KAAK6/B,SAAWA,SAEhBA,SAcA,OAbA/zC,2DAAmBquC,qEAAoB,CACnChgB,OAAQma,SACR5hC,OAAQ2hC,SACRL,OACAS,WAAYN,OAAOM,aAGvBJ,SAASpd,UAAU,eAAgB,CAC/B+oB,MAAO1L,gBAGX3f,IAAIoL,SAKRj0B,2DAAmBouC,uEAAsB,CACrC/f,OAAQma,SACR5hC,OAAQ2hC,SACRL,OACAS,WAAYN,OAAOM,WACnB2G,UAGJ,MAAMn5B,IAAM/U,KAAKypB,OAAO+O,SAASC,SAEjC75B,sEAA8BmW,IAAIC,EAAGD,IAAIE,EAAG,CACxC2oB,SAAU,IACVF,KAAM,CAAC,UAAW,WAClBD,OAAQ,CAAC,OAGbhW,IAAIoL,SAGRkgB,OAAOtrB,KACHznB,KAAKiiB,OAASwF,IAAI3U,KAAKmP,MAEnBjiB,KAAKiiB,MAAQjiB,KAAKoM,MAClBpM,KAAKiiB,MAAQjiB,KAAKoM,KAGtBqb,IAAIoL,U,MAxGY,CAChB5Q,MAAO,K,wBAFFowB,Q,4VChBN,MAAMlpB,eAAe+B,iD,6VCCrB,MAAM8nB,sBAAsB9nB,8CAK/B,cACI,OAAO+nB,iEAAiBjzC,KAAKqd,O,MALb,CAChBA,KAAM,Y,wBAFD21B,e,0jBCDN,MAAME,eAAiB,EACjBC,iBAAmB,EACnBC,eAAiB,EACjBC,aAAe,EACfC,gBAAkB,EAElB35B,SAAW,CACpBE,OAAQ,IAAI05B,mDAAQ,CAChB5nC,GAAIunC,eACJ71B,KAAM,SACNL,QAAS,WAEbw2B,SAAU,IAAID,mDAAQ,CAClB5nC,GAAIwnC,iBACJ91B,KAAM,WACNL,QAAS,aAEb6gB,OAAQ,IAAI0V,mDAAQ,CAChB5nC,GAAIynC,eACJ/1B,KAAM,SACNL,QAAS,WAEby2B,QAAS,IAAIF,mDAAQ,CACjB5nC,GAAI2nC,gBACJj2B,KAAM,UACNL,QAAS,YAEb4lB,KAAM,IAAI2Q,mDAAQ,CACd5nC,GAAI0nC,aACJh2B,KAAM,OACNL,QAAS,UAIJi2B,iBAAoB51B,MAAS1D,SAAS0D,O,2VCpCpC,MAAMk2B,QAKjB96B,YAAYmV,YAAY,0BAJnB,GAImB,4BAHjB,WAGiB,+BAFd,WAGN5tB,KAAK2L,GAAKiiB,WAAWjiB,GACrB3L,KAAKqd,KAAOuQ,WAAWvQ,KACvBrd,KAAKgd,QAAU4Q,WAAW5Q,W,idCH3B,MAAM02B,aAAaxoB,8CAKtByoB,OAAOlqB,QACH,MAAM3qB,MAAQkB,KAAKypB,OAAO+O,SAASC,SAC7B1pB,IAAM0a,OAAO+O,SAASC,SAEtB6T,MAAOtE,mEAAclpC,MAAMkW,EAAGlW,MAAMmW,EAAGlG,IAAIiG,EAAGjG,IAAIkG,GAExD,QAAIq3B,KAAKzqC,OAAS7B,KAAK0nC,SAIf4E,KAAKlX,MAAMqK,SACR7gC,+DACY6gC,QAAQzqB,EAAGyqB,QAAQxqB,GACjCmgB,MAAM3L,QAAWA,OAAOuJ,IAAIqQ,6DAIzCuQ,oBAAoBnsB,KAChB,MAAM+Q,SAAW55B,6DAAqBoB,KAAKypB,OAAO9d,IAElD,IAAK6sB,SACD,OAIJ,MAAM+F,QAAU3/B,oEACQ45B,SAASxjB,EAAGwjB,SAASvjB,EAAGjV,KAAK0nC,OAChDtmB,QAAQne,KACAA,EAAEsmB,SAGHtmB,EAAE87B,WAGDngC,yEAAiCoB,KAAKypB,OAAQxmB,IAI5CjD,KAAK2zC,OAAO1wC,OAGvBs7B,QAAQ18B,OAAS,IACjB08B,QAAQhrB,SAAStQ,IACbwkB,IAAI3U,KAAKyrB,QAAQpL,IAAIlwB,MAEzBwkB,IAAIoL,W,MAjDQ,CAChB6U,MAAO,I,wBAFFgM,M,8WCHN,MAAMG,iBAAiB3oB,8CAmB1B,gBACI,OAAOlrB,KAAK8zC,KAAO9zC,KAAK49B,SAG5B,cACI,OAAO59B,KAAK8zC,IAAM9zC,KAAK49B,SAG3BmW,MAAMjS,IAAM,IACR,MACMxoB,OAAS,EADHwoB,IAAIjgC,OAGhB,OAAOsK,KAAKyT,MAAM5f,KAAKg0C,QAAU16B,QAGrC,YACI,MAAMy6B,MAAQ/zC,KAAK+zC,MAAM/zC,KAAKy9B,QAE9B,OAAOz9B,KAAKy9B,OAAOsW,OAGvB,UACI,MAAMA,MAAQ/zC,KAAK+zC,MAAM/zC,KAAK09B,MAE9B,OAAO19B,KAAK09B,KAAKqW,OAGrB,UACI,MAAMA,MAAQ/zC,KAAK+zC,MAAM/zC,KAAKi0C,MAE9B,OAAOj0C,KAAKi0C,KAAKF,OAGrB,SACI,MAAMA,MAAQ/zC,KAAK+zC,MAAM/zC,KAAKk0C,KAE9B,OAAOl0C,KAAKk0C,IAAIH,Q,MAtDA,CAChBnW,SAAU,IACVF,KAAM,CAAC,UAAW,WAClBuW,KAAM,GACNC,IAAK,GACLzW,OAAQ,CAAC,KACTE,MAAO,IACPmW,IAAK,EACL9+B,EAAG,EACHC,EAAG,EACHk/B,OAAQ,EACRC,OAAQ,EACR5W,UAAW,CACPxoB,EAAG,EACHC,EAAG,K,wBAfF4+B,U,4bCCN,MAAMQ,wBAAwBnpB,8CAWjC,gBACI,OAAOlrB,KAAK8zC,KAAO9zC,KAAKsM,SAG5B,cACI,OAAOtM,KAAK8zC,IAAM9zC,KAAKsM,SAG3BgoC,iBACI,MAAMC,SAAWv0C,KAAKnB,IAAI83B,eAU1B,OARA4d,SAASphB,IAAI0gB,gDAAU,IAChB7zC,KAAKw0C,aACRx/B,EAAGhV,KAAKgV,EACRC,EAAGjV,KAAKiV,IAGZjV,KAAKy0C,OAAS,EAEPF,SAGXR,MAAMjS,IAAM,IACR,MACMxoB,OAAS,EADHwoB,IAAIjgC,OAGhB,OAAOsK,KAAKyT,MAAM5f,KAAKg0C,QAAU16B,S,MApCjB,CAChBk7B,aAAc,GACdloC,SAAU,IACVlE,KAAM,EACN0rC,IAAK,EACL9+B,EAAG,EACHC,EAAG,EACHw/B,MAAO,I,wBARFJ,iB,icCAN,MAAMK,oBAAoBxpB,8CAK7BikB,QAAQ1nB,KACJ,MAAM1S,IAAM/U,KAAKypB,OAAO+O,SAASC,UAEjCkc,iEAAU30C,KAAK40C,OAAQ7/B,IAAIC,EAAGD,IAAIE,I,MAPlB,CAChB2/B,OAAQ,K,wBAFHF,a,gsBCGb,MAAME,OAAS,CACXC,gBAAiBC,2DACjBC,gBAAiBC,2DACjBC,iBAAkBC,6DAGTC,SAAYC,UAAaR,OAAOQ,UAEhCC,SAAW,CAACC,UAAY,MACjC,MAAMV,OAASU,UAAUx1C,IAAIq1C,UAG7B,OAFcI,kEAAsBX,QAEvBY,QAGJb,UAAY,CAACW,UAAY,GAAItgC,EAAGC,KACzC,MAAMwgC,UAAYJ,SAASC,WAE3B,OAAOrd,+CAAMwd,UAAWzgC,EAAGC,K,kQCtBhB,MAAMsgC,cAAc,c,wBACxB,I,IADwB,U,IAAA,M,gGAG/B,UACI,OAAOv1C,KAAK01C,KAAK3L,QAAO,CAAC1R,IAAKoS,MAAQpS,IAAMoS,IAAIrI,QAAQ,GAG5DoT,OACI,MAAMtxB,GAAI+d,gDAAU,EAAGjiC,KAAKq4B,KAE5B,IAAIsd,SAAW,EACf,MAAMxyB,IAAMnjB,KAAK01C,KAAK1Q,MAAM7hB,MACxBwyB,UAAYxyB,IAAIif,OAETuT,UAAYzxB,KAGvB,GAAIf,IACA,OAAOA,IAAIlB,MAInB2zB,OAAO3zB,OACH,MAAMkB,IAAMnjB,KAAKsiB,IAAIL,OAErB,OAAKkB,IAIEA,IAAIif,OAASpiC,KAAKq4B,IAHd,EAMf/V,IAAIL,OACA,OAAOjiB,KAAK01C,KAAK1Q,MAAM7hB,KAAQA,IAAIlB,QAAUA,QAGjDkR,IAAIiP,OAAQngB,OACR,MAAMojB,SAAWrlC,KAAKsiB,IAAIL,OAE1B,GAAKojB,SAKE,CAEH,MAAMwQ,UAAY1pC,KAAKC,IAAIi5B,SAASjD,OAAQA,QAE5CiD,SAASjD,OAASyT,eARlB71C,KAAK01C,KAAK/uC,KAAK,CACXy7B,OACAngB,QASRjiB,KAAK01C,KAAKpsB,MAAK,CAACjF,EAAGD,IAAMC,EAAE+d,OAAShe,EAAEge,SAG1C,eAAewS,OAAS,IACpB,MAAMkB,MAAQ,IAAIP,cAMlB,OAJAX,OAAOrhC,SAAS6kB,QACZA,MAAMsd,KAAKniC,SAAS4P,KAAQ2yB,MAAM3iB,IAAIhQ,IAAIif,OAAQjf,IAAIlB,YAGnD6zB,S,gWCtDf,MAAMC,QAAU,IAAIR,0DAEpBQ,QAAQ5iB,IAAI,EAAGgG,qDACf4c,QAAQ5iB,IAAI,EAAG6F,0DACf+c,QAAQ5iB,IAAI,EAAGiH,sDACf2b,QAAQ5iB,IAAI,EAAGkH,2DACf0b,QAAQ5iB,IAAI,EAAGoH,0DAEf,0C,gWCdA,MAAMyb,OAAS,IAAIT,0DAEnBS,OAAO7iB,IAAI,EAAGgG,qDACd6c,OAAO7iB,IAAI,EAAG6F,0DAEd,yC,gWCLA,MAAM2I,QAAU,IAAI4T,0DAEpB5T,QAAQxO,IAAI,GAAIyH,yDAChB+G,QAAQxO,IAAI,EAAG6F,0DAEf,0C,iRCNO,MAAMid,mBAAmB/qB,8CAM5B,WACI,OAAOlrB,KAAKmkC,MAAMjG,cAAcl+B,KAAKk2C,SAGzCC,UAAU1uB,KACNznB,KAAKo2C,KAAKC,UAGdxQ,SAASpe,KACLznB,KAAKo2C,KAAKC,W,MAdM,CAChBH,QAAS,GACT/R,MAAO,a,wBAHF8R,Y,6oBCIN,MAAMK,kBAAkBprB,8CAK3BqrB,WAAW9uB,KACP,MAAM+uB,MAAQtlC,OAAO2T,OAAO4C,IAAI3U,KAAKylB,WAAW2F,eAAe9c,QAC1Dg1B,MACUp2C,KAAKy2C,UAAUC,SAASN,KAAKO,YAI5C/3C,gEAAwBisB,yEAAoB,CACxC+rB,OAAQ52C,KAAKypB,OAAO6d,QAAQtqB,QAC5B65B,KAAM72C,KAAKypB,OAAOrG,MAClB0zB,SAAU,gBACVpiB,KAAM8hB,MACNO,YAAa,CAACX,KAAMphC,EAAGC,EAAG+hC,cACtB,IAAIt4B,KAAO03B,KAAK/4B,KAEX+4B,KAAKhf,UACN1Y,MAAQ,KAAJ,OAAS03B,KAAK9e,QAAQgQ,QAAQtqB,QAA9B,MAGJg6B,WACAp4C,+DAAuBoW,EAAGC,EAA1B,YAAkCyJ,MAAQ,UAE1C9f,+DAAuBoW,EAAGC,EAA1B,YAAkCyJ,QAG1Cu4B,SAAWb,OACPA,KAAKC,UACLD,KAAKhY,MAAMp+B,KAAKypB,QAChBhC,IAAI3U,KAAKylB,WAAWxO,UAAU,kBAAmB,KACjDtC,IAAIoL,SACJj0B,oEAKZs4C,aAAazvB,KACT,MAAMyuB,QAAUl2C,KAAKypB,OAAO0tB,WAAWjB,QACjCE,KAAO3uB,IAAI3U,KAAKylB,WAAW2F,cAAcgY,SAE3CE,OACAA,KAAK9e,QAAU,MAGnB7P,IAAI3U,KAAKylB,WAAWxO,UAAU,kBAAmB,KAEjD/pB,KAAKypB,OAAO0tB,WAAWhpB,UACvB1G,IAAIoL,SAGR+F,kBAAkBnR,KACVznB,KAAKypB,OAAOuJ,IAAIijB,qDAChBxuB,IAAI3U,KAAK+lB,aAAalyB,KAAK,CACvB0W,KAAM,YAAF,OAAcrd,KAAKypB,OAAO0tB,WAAWf,KAAK/4B,KAA1C,KACJoK,IAAK,gBAGTA,IAAI3U,KAAK+lB,aAAalyB,KAAK,CACvB0W,KAAM,QACNoK,IAAK,e,IA/DR6uB,U,uBACW,CAChBG,UAAW,CAACW,oE,mgBCRb,MAAMC,aAAe,eACfC,aAAe,eACfC,aAAe,eACfH,aAAe,eACfI,aAAe,eACfC,YAAc,cACdC,aAAe,eACfC,aAAe,gB,8rBCDrB,MAAMC,sBAAsB1sB,8CAY/B,cACI,OAAQlrB,KAAKs3B,QAGjB5K,cACS1sB,KAAKo3B,SACNp3B,KAAKs3B,QAAQnJ,UAIrBkoB,UACI,GAAIr2C,KAAKo3B,QACL,OAAO,EAGX,MAAME,QAAUt3B,KAAKs3B,QAErBt3B,KAAKs3B,QAAU,KAEfA,QAAQ6f,WAAWhpB,UACnBmJ,QAAQvN,UAAU,aAAc,CAC5BwO,WAAYv4B,KAAKypB,SAIzB2U,MAAMyZ,WACFA,UAAUzS,KAAKrB,KAAK/jC,KAAKypB,QAEzBouB,UAAU1kB,IAAI8iB,oDAAY,CACtBC,QAASl2C,KAAKwT,IACd2wB,MAAOnkC,KAAKypB,SAGhBzpB,KAAKs3B,QAAUugB,UAEfA,UAAU9tB,UAAU,WAAY,CAC5BwO,WAAYv4B,KAAKypB,SAIzBquB,cAAc7qB,QACV,IAAIjtB,KAAKo3B,QAUF,CAMH,OALkBp3B,KAAKs3B,QAAQvN,UAAU,gBAAiB,CACtDwO,WAAYv4B,KAAKypB,OACjBwD,SAGana,KAAKkB,QAftB,GAAIhU,KAAK+3C,eAAgB,CAOrB,OANmBC,gEAAch4C,KAAK+3C,gBAE3B9Q,OAAOjnC,KAAKypB,OAAQwD,QAE/BjtB,KAAKypB,OAAOM,UAAU,kBAAmB,MAElC,EAWf,OAAO,EAGXkuB,gBAAgBhrB,QACZ,IAAIjtB,KAAKo3B,QAQF,CAMH,OALkBp3B,KAAKs3B,QAAQvN,UAAU,wBAAyB,CAC9DwO,WAAYv4B,KAAKypB,OACjBwD,SAGana,KAAKkB,QAbtB,GAAIhU,KAAK+3C,eAAgB,CAKrB,OAJmBC,gEAAch4C,KAAK+3C,gBAE3BG,cAAcl4C,KAAKypB,OAAQwD,SAE/B,EAWf,OAAO,EAGXkrB,WAAW1wB,KACP,MAAMwX,UAAYxX,IAAI3U,KAAKma,OAAOuL,SAASC,SACrC2f,QAAUp4C,KAAKypB,OAAO+O,SAASC,SAClB75B,4DACfw5C,QAAQpjC,EACRojC,QAAQnjC,EACRgqB,UAAUjqB,EACViqB,UAAUhqB,KAOVjV,KAAKq4C,UACDr4C,KAAK83C,cAAcrwB,IAAI3U,KAAKma,UAC5BxF,IAAI3U,KAAKkB,SAAU,GAGvBhU,KAAKi4C,gBAAgBxwB,IAAI3U,KAAKma,SAItCqrB,gBAAgB7wB,KACRznB,KAAKo3B,SAITp3B,KAAKs3B,QAAQvN,UAAb,2BAAmD,CAC/C8f,MAAOpiB,IAAI3U,KAAK+2B,MAChBD,UAAWniB,IAAI3U,KAAK82B,a,gBA9HnBgO,c,iBACc,G,gBADdA,c,cAEY,O,gBAFZA,c,aAGW,CAChBv6B,KAAM,OACN7J,IAAK,OACLmjC,SAAUS,kEACV9f,QAAS,WACT+gB,WAAW,EACXN,eAAgB,Q,+jDCKjB,MAAMQ,oBAAsB,sBACtBC,uBAAyB,yBAEzBC,cAAgB,gBAChBC,cAAgB,gBAEhBC,mBAAqB,qBACrBC,oBAAsB,sBAEtBC,oBAAsB,sBACtBC,oBAAsB,sBACtBC,gBAAkB,kBAElBC,eAAiB,iBACjBC,iBAAmB,mBACnBC,iBAAmB,mBAEnBC,iBAAmB,mBACnBC,eAAiB,iBACjBC,cAAgB,gBAEvB1Q,OAAS,CACX,CAACwQ,kBAAmB,IAAIG,6DACxB,CAACF,gBAAiB,IAAIG,2DACtB,CAACF,eAAgB,IAAIG,0DACrB,CAACjB,qBAAsB,CACnBl7B,KAAM,aACNo8B,OAAQC,+DACRlmC,IAAK+kC,oBACLhR,WAAYW,gEAEhB,CAACsQ,wBAAyB,CACtBn7B,KAAM,gBACNo8B,OAAQC,+DACRlmC,IAAKglC,uBACLjR,WAAYW,gEAEhB,CAACuQ,eAAgB,CACbp7B,KAAM,OACNo8B,OAAQC,+DACRlmC,IAAKilC,cACLlR,WAAYW,gEAEhB,CAACwQ,eAAgB,CACbr7B,KAAM,OACNo8B,OAAQC,+DACRlmC,IAAKklC,cACLnR,WAAYW,gEAEhB,CAACyQ,oBAAqB,CAClBt7B,KAAM,YACNo8B,OAAQE,4DACRnmC,IAAKmlC,mBACLpR,WAAYkE,6DAEhB,CAACmN,qBAAsB,IAAIgB,+DAC3B,CAACf,qBAAsB,IAAIgB,gEAC3B,CAACf,qBAAsB,IAAIgB,gEAC3B,CAACpB,eAAgB,IAAIqB,0DACrB,CAAChB,iBAAkB,CACf17B,KAAM,SACNo8B,OAAQO,8DACRxmC,IAAKulC,gBACLxR,WAAYkE,6DAEhB,CAACuN,gBAAiB,CACd37B,KAAM,QACNo8B,OAAQQ,gEACRzmC,IAAKwlC,eACLzR,WAAYW,gEAEhB,CAAC+Q,kBAAmB,CAChB57B,KAAM,UACNo8B,OAAQQ,gEACRzmC,IAAKylC,iBACL1R,WAAYiE,6DAEhB,CAAC0N,kBAAmB,CAChB77B,KAAM,UACNo8B,OAAQQ,gEACRzmC,IAAK0lC,iBACL3R,WAAYiE,8DAIPwM,cAAiB3/B,MAASswB,OAAOtwB,MACjC6hC,kBAAqB7hC,MAASswB,OAAOtwB,MAAMgF,KAC3C88B,oBAAuB9hC,MAASswB,OAAOtwB,MAAMohC,OAC7CW,qBAAwB/hC,MAASswB,OAAOtwB,MAAMkvB,Y,2eC5GpD,MAAMmS,kBAAoB,oBACpBC,eAAiB,iBACjBK,iBAAmB,mBACnBK,mBAAqB,qBACrBJ,mBAAqB,qBACrBK,mBAAqB,qBACrBC,kBAAoB,oBAE3B5R,OAAS,CACX,CAAC+Q,mBAAoB,CACjBr8B,KAAM,UAEV,CAACs8B,gBAAiB,CACdt8B,KAAM,OAEV,CAAC28B,kBAAmB,CAChB38B,KAAM,SAEV,CAACg9B,oBAAqB,CAClBh9B,KAAM,WAEV,CAAC48B,oBAAqB,CAClB58B,KAAM,WAEV,CAACi9B,oBAAqB,CAClBj9B,KAAM,WAEV,CAACk9B,mBAAoB,CACjBl9B,KAAM,WAIDm9B,oBAAuBf,QAAW9Q,OAAO8Q,QAAQp8B,M,kpBCxB/C,MAAMu8B,yBAAyBa,iDAC1ChiC,cACIyE,MAAM,CACF1J,IAAKolC,8DACLv7B,KAAM,aACNo8B,OAAQE,4DACRpS,WAAYkE,4DACZ5B,MAAOrB,iDAIfkS,cAAcvT,SAAUC,SAAUuT,QAC9B,MAAMzvC,KAAMy8B,sDAAc3nC,KAAK6pC,MAAO1C,UAEhCL,OADM6T,OAAOC,OACE1vC,IAErB,OAAO,IAAIg8B,6CAAO,CACdC,SACAC,SACAC,WAAYsT,OAAOt9B,KACnBypB,OACAS,WAAYvnC,KAAKunC,aAIzBN,OAAOE,SAAUC,SAAUuT,QACvB,MAAM1T,OAASjnC,KAAK06C,cAAcvT,SAAUC,SAAUuT,QAChDzb,OAASkI,SAASrd,UAAU,WAAY,CAAEkd,SAC1C4T,QAAU,CAAC5T,QAEjB,IAAK/H,OAAOpsB,KAAK4/B,WAAaxT,OAAOpsB,KAAK6/B,WAAYzQ,yDAAc,CAChE,MAAM4Y,aAAe96C,KAAK06C,cAAcvT,SAAUC,SAAUuT,QAE5DE,QAAQl0C,KAAKm0C,cAEb1T,SAASrd,UAAU,WAAY,CAAEkd,SAGrC,OAAO4T,W,wYC1CA,MAAMJ,WACjBhiC,YAAY3F,MACR9S,KAAKqd,KAAOvK,KAAKuK,KACjBrd,KAAKy5C,OAAS3mC,KAAK2mC,OACnBz5C,KAAKwT,IAAMV,KAAKU,IAChBxT,KAAKunC,WAAaz0B,KAAKy0B,WACvBvnC,KAAK6pC,MAAQ/2B,KAAK+2B,MAGtBkR,iBAAiBC,KAAML,QACnB,IAAIj8B,KAAO,KAAH,OAAQi8B,OAAO5T,KACvB,MAAM8C,OAAQlC,sDAAc3nC,KAAK6pC,MAAOmR,MAClC9Q,IAAMyQ,OAAO3T,SAAW6C,MAU9B,OARIK,MAEIxrB,MADAwrB,IAAM,EACE,MAAJ,OAAUA,KAEN,MAAJ,OAAU/9B,KAAKK,IAAI09B,OAIxBxrB,KAGXu8B,oBAAoBD,KAAML,QACtB,MAAMO,KAAMV,oEAAoBx6C,KAAKy5C,QAErC,gBAAUyB,IAAV,aAAkBl7C,KAAK+6C,iBAAiBC,KAAML,SAGlDQ,WAAWhU,SAAUC,SAAUuT,QAC3B,MAAO,GAGX1T,OAAOE,SAAUC,SAAUuT,QAGvB,OAFgB36C,KAAKm7C,WAAWhU,SAAUC,SAAUuT,QAErC76C,KAAKmnC,SAChBA,OAAOG,SAASrd,UAAU,WAAY,CAAEkd,YAIhDiR,cAAc/Q,SAAUC,SAAUuT,SAC1BxY,+DAAmB,KACnBniC,KAAKinC,OAAOE,SAAUC,SAAUuT,W,8oBCzC7B,MAAMpB,qBAAqBkB,iDACtChiC,cACIyE,MAAM,CACF1J,IAAK4lC,yDACL/7B,KAAM,QACNo8B,OAAQa,gEACR/S,WAAYiE,4DACZ3B,MAAOtB,sDAIf4S,WAAWhU,SAAUC,SAAUuT,QAC3B,MAAM9Q,OAAQlC,sDAAc3nC,KAAK6pC,MAAO1C,UAElCL,QADM7E,sDAAU,EAAG,GACJ4H,MAErB,MAAO,CACH,IAAI3C,6CAAO,CACPC,SACAC,SACAC,YAAYxF,uDAAW,CAAC,OAAQ,SAChCiF,OACAS,WAAYvnC,KAAKunC,iB,6oBCtBlB,MAAMiS,oBAAoBiB,iDACrChiC,cACIyE,MAAM,CACF1J,IAAK6lC,wDACLh8B,KAAM,QACNo8B,OAAQa,gEACR/S,WAAYkE,4DACZ5B,MAAOtB,sDAIf4S,WAAWhU,SAAUC,SAAUuT,QAC3B,MAAM9Q,OAAQlC,sDAAc3nC,KAAK6pC,MAAO1C,UAElCL,QADM7E,sDAAU,EAAG,GACJ4H,MAErB,MAAO,CACH,IAAI3C,6CAAO,CACPC,SACAC,SACAC,YAAYxF,uDAAW,CAAC,SACxBiF,OACAS,WAAYvnC,KAAKunC,iB,wtBCrBlB,MAAMsS,0BAA0BY,iDAC3ChiC,cACIyE,MAAM,CACF1J,IAAKqlC,8DACLx7B,KAAM,aACNo8B,OAAQO,8DACRzS,WAAYkE,4DACZ5B,MAAOpB,mDAIf2S,oBAAoBjU,SAAUC,SAAUuT,OAAQ7T,QAC5C,MAAMuU,YAAclU,SAAS3O,SAASC,SAChC6iB,YAAclU,SAAS5O,SAASC,SAChC8iB,OAASD,YAAYtmC,EAAIqmC,YAAYrmC,EACrCwmC,OAASF,YAAYrmC,EAAIomC,YAAYpmC,EACrCuoB,WAAYwU,qEAAmBuJ,OAAQC,QAG7C,OAFuBzJ,oEAAkBvU,UAAUhqB,KAG9C1T,KAAK4/B,OACF9gC,+DACIy8C,YAAYrmC,EAAI0qB,MAAM1qB,EACtBqmC,YAAYpmC,EAAIyqB,MAAMzqB,KAG7BwmC,OACAr6B,QAAQne,GAAMrE,yEAAiCqE,EAAGkkC,YAClDrnC,KAAK47C,SACK,IAAIxU,6CAAO,CACdC,SACAK,aAAa,EACbJ,SAAUsU,QACVrU,WAAYsT,OAAOt9B,KACnBypB,OAAQ36B,KAAK41B,MAAM+E,OAAS,GAC5BS,WAAYvnC,KAAKunC,eAKjCoU,mBAAmBxU,SAAUC,SAAUuT,OAAQ7T,QAC3C,MAAMG,OAAS,IAAIC,6CAAO,CACtBC,SACAC,SACAC,WAAYsT,OAAOt9B,KACnBypB,OACAS,WAAYvnC,KAAKunC,aAGrB,OAAOH,SAASrd,UAAU,WAAY,CAAEkd,SAG5CA,OAAOE,SAAUC,SAAUuT,QACvB,MAAMzvC,KAAMy8B,sDAAc3nC,KAAK6pC,MAAO1C,UAEhCL,OADM6T,OAAOC,OACE1vC,IACfg0B,OAASl/B,KAAK27C,mBAChBxU,SACAC,SACAuT,OACA7T,QAGE+T,QAAU,CAAC3b,QAEjB,IAAKA,OAAOpsB,KAAK4/B,SAAU,CACC1yC,KAAKo7C,oBACzBjU,SACAC,SACAuT,OACA7T,QAGYvzB,SAAS0zB,SACrB4T,QAAQl0C,KAAKsgC,QACbA,OAAOG,SAASrd,UAAU,WAAY,CAAEkd,YAIhD,OAAO4T,W,6sBC/EA,MAAMd,oBAAoBU,iDACrChiC,cACIyE,MAAM,CACF1J,IAAKklC,wDACLr7B,KAAM,OACNo8B,OAAQc,+DACRhT,WAAYW,+DACZ2B,MAAOnB,oDAIfgS,cAAcvT,SAAUC,SAAUuT,QAC9B,MAAMzvC,KAAMy8B,sDAAc3nC,KAAK6pC,MAAO1C,UAEhCL,OADM6T,OAAOC,OACE1vC,IAErB,OAAO,IAAIg8B,6CAAO,CACdC,SACAC,SACAC,WAAYsT,OAAOt9B,KACnBypB,OACAS,WAAYvnC,KAAKunC,aAIzBN,OAAOE,SAAUC,SAAUuT,QACvB,MAAM1T,OAASjnC,KAAK06C,cAAcvT,SAAUC,SAAUuT,QAChDzb,OAASkI,SAASrd,UAAU,WAAY,CAAEkd,SAC1C4T,QAAU,CAAC5T,QAYjB,OATK/H,OAAOpsB,KAAK4/B,UACZxT,OAAOpsB,KAAK6/B,YACbxQ,+DAAmB,MAEnByZ,oDAAUC,sDAAgBzU,SAAU,CAChC96B,SAAU,MAIXuuC,W,ooBC5CR,MAAMiB,gBAAkB,kBAClBD,eAAiB,iBACjBE,oBAAsB,sBAE7BpT,OAAS,CACXmT,gBAAiB,IAAIE,8DACrBH,eAAgB,IAAII,6DACpBF,oBAAqB,IAAIG,mEAGhBC,UAAa3oC,KAAQm1B,OAAOn1B,KAC5BooC,UAAY,CAACpoC,IAAKiW,OAAQmE,WAAa,KACzCnE,OAAO0J,IAAIipB,oDAAQ,IACnBxuB,WACHpa,O,slBCZO,MAAMwoC,uBAAuBI,6CACxC3jC,cAOIyE,MAAM4+B,uDAAiB,WAAYO,sEANrB,CACVn+B,IAAK,UACLC,IAAK,UACLC,GAAI,KACJmkB,GAAI,MAGRviC,KAAKs8C,OAAQ,EAGjBC,cAAcC,SACV,OAAO,EAAIA,QAAU,GAGzBC,YAAYD,SACR,OAAOrwC,KAAKyD,MAAM,EAAI4sC,SAG1B9/B,OAAOggC,MAAOjzB,OAAQ/V,QAClB,MAAM/D,KAAOxD,KAAK2C,IAAI4tC,MAAOhpC,OAAOipC,qBAE9B7V,OADa9mC,KAAKu8C,cAAc7oC,OAAO8oC,UAChB7sC,KAAO,KAEpC8Z,OAAOmzB,OAAOrK,YAAYzL,QAE1B,MAAMtO,SAAW/O,OAAO+O,SAASC,UAEjCR,+CAAMC,0DAAkBM,SAASxjB,EAAGwjB,SAASvjB,EAAG,CAC5CqiB,QAASwB,6DACTz3B,OAAQ8K,KAAKwG,KAAc,EAATm0B,UAGtBpzB,OAAOkqB,UAAYjuB,Q,+PCzCpB,MAAM0sC,sBAAwB,wBACxBQ,iBAAmB,oB,4LCDjB,MAAMT,OAGjBK,YAAYD,SACR,OAAO,EAGX/jC,YAAYjF,IAAK6J,KAAMhF,KAAM+K,Q,mIAAO,eAN5B,GAOJpjB,KAAKwT,IAAMA,IACXxT,KAAKqd,KAAOA,KACZrd,KAAKqY,KAAOA,KACZrY,KAAKojB,MAAQA,S,mZCPN,MAAM84B,2BAA2BE,6CAC5C3jC,cAOIyE,MAAM6+B,2DAAqB,eAAgBc,iEAN7B,CACV3+B,IAAK,UACLC,IAAK,UACLC,GAAI,KACJmkB,GAAI,MAGRviC,KAAKs8C,OAAQ,EAGjB5/B,OAAOggC,MAAOjzB,OAAQ/V,QAClB,MAAM/D,KAAOxD,KAAK2C,IAAI4tC,MAAOhpC,OAAOipC,qBAE9B16B,MAAQ9V,KAAK41B,MAAmBpyB,KAAO,IAD3B,GAGlB8Z,OAAOM,UAAU,OAAQ,CACrB9H,QAGJvO,OAAOkqB,UAAYjuB,Q,khBCnBZ,MAAMssC,sBAAsBG,6CACvC3jC,cAOIyE,MAAM2+B,sDAAgB,UAAWQ,sEANnB,CACVn+B,IAAK,UACLC,IAAK,UACLC,GAAI,KACJmkB,GAAI,MAKZ7lB,OAAOggC,MAAOjzB,OAAQ/V,QAGlB,GAFAA,OAAOkqB,UAAY8e,OAEdjzB,OAAOK,gBAAiB,CACzBL,OAAO0J,IAAI2pB,8DAEX,MAAM/nC,IAAM0U,OAAO+O,SAASC,SAE5B75B,sEAA8BmW,IAAIC,EAAGD,IAAIE,EAAG,CACxC2oB,SAAU,IACVF,KAAM,CAAC,UACPD,OAAQ,CAAC,OAIb/pB,OAAOqpC,eACPtzB,OAAOK,gBAAgBqE,a,klBC1BpB,MAAM2rB,0BAA0BW,iDAC3ChiC,cACIyE,MAAM,CACF1J,IAAKslC,8DACLz7B,KAAM,aACNo8B,OAAQO,8DACRzS,WAAYkE,4DACZ5B,MAAOpB,mDAIf0S,WAAWhU,SAAUC,SAAUuT,QAC3B,MAAMzvC,KAAMy8B,sDAAc3nC,KAAK6pC,MAAO1C,UAEhCL,OADM6T,OAAOC,OACE1vC,IAErB,MAAO,CACH,IAAIg8B,6CAAO,CACPC,SACAC,SACAC,WAAYsT,OAAOt9B,KACnBypB,OACAS,WAAYvnC,KAAKunC,iB,gpBCrBlB,MAAM+R,uBAAuBmB,iDACxChiC,cACIyE,MAAM,CACF1J,IAAK2lC,2DACL97B,KAAM,UACNo8B,OAAQa,gEACR/S,WAAYW,+DACZ2B,MAAOtB,sDAIf4S,WAAWhU,SAAUC,SAAUuT,QAC3B,MAAMqC,UAAWrV,sDAAc3nC,KAAK6pC,MAAO1C,UAErCL,QADM7E,sDAAU,EAAG,GACJ+a,SAErB,MAAO,CACH,IAAI9V,6CAAO,CACPC,SACAC,SACAC,YAAYxF,uDAAW,CAAC,QAAS,SACjCiF,OACAS,WAAYvnC,KAAKunC,iB,8YClB1B,MAAM0V,cAAc/xB,8CASvBgyB,SAAStT,WACL,OAAOA,UAAUG,QAAO,CAAC1R,IAAKoS,MAAQpS,IAAMoS,IAAIP,KAAK,GAGzDiT,iBAAiB1T,MAOb,OANYzpC,KAAKypB,OAAOM,UAAZ,iBAAwC,CAChD1M,MAAM0tB,wDAAYtB,MAClBA,KACAG,UAAW,KAGJ92B,KAAK82B,UAGpBwT,mBAAmB3T,MACf,MAAMO,KAAOhqC,KAAKm9C,iBAAiB1T,MAEnC,OAAOzpC,KAAKk9C,SAASlT,MAGzBl3B,KAAK22B,MACD,MAAMpsB,MAAO0tB,wDAAYtB,MACnBqB,cAAeE,gEAAoBvB,MACnCG,UAAY5pC,KAAKm9C,iBAAiB1T,MAClCtkB,KAAOnlB,KAAK,OAAL,QAAYq9C,2DAAWhgC,QAC9BigC,OAASt9C,KAAKk9C,SAAStT,WAG7B,MAAO,CACHH,KACAqB,aACAztB,KACAusB,UACAzkB,KACAkT,IARQlT,KAAOm4B,OASfA,QAIRz9C,MACI,MAAO,CACH09C,SAAUv9C,KAAK8S,KAAK+zB,wDACpB2W,QAASx9C,KAAK8S,KAAK43B,uDACnB+S,YAAaz9C,KAAK8S,KAAK63B,2DACvB+S,SAAU19C,KAAK8S,KAAK83B,wDACpB+S,MAAO39C,KAAK8S,KAAK+3B,sDAIzB0S,WACI,MAAMrT,IAAMlqC,KAAKo9C,mBAAmBvW,wDAEpC,OAAO7mC,KAAK49C,aAAe1T,IAG/BsT,UACI,MAAMtT,IAAMlqC,KAAKo9C,mBAAmB1S,uDAEpC,OAAO1qC,KAAK69C,YAAc3T,IAG9BuT,cACI,MAAMvT,IAAMlqC,KAAKo9C,mBAAmBzS,2DAEpC,OAAO3qC,KAAK89C,gBAAkB5T,IAGlCwT,WACI,MAAMxT,IAAMlqC,KAAKo9C,mBAAmBxS,wDAEpC,OAAO5qC,KAAK+9C,aAAe7T,IAG/ByT,QACI,MAAMzT,IAAMlqC,KAAKo9C,mBAAmBvS,qDAEpC,OAAO7qC,KAAKg+C,UAAY9T,K,MApFR,CAChB0T,aAAc,EACdC,YAAa,EACbC,gBAAiB,EACjBC,aAAc,EACdC,UAAW,I,wBANNf,O,kLCNN,SAAS/S,IAAIl1B,EAAGipC,GACnB,OAAQjpC,EAAIipC,EAAIA,GAAKA,EAElB,SAASC,MAAMhuB,IAAKphB,IAAM,EAAG1C,IAAM,GACtC,OAAI8jB,IAAMphB,IACCA,IACPohB,IAAM9jB,IACCA,IACJ8jB,IAEJ,SAASmtB,WAAW3xB,QACvB,OAAOA,OAAOvM,OAAO,GAAGg/B,cAAgBzyB,OAAO0yB,UAAU,GAOtD,SAAS12C,OAAO22C,YAAa9vC,MAChC,IAAIzO,IAAM4H,OAAO5H,IAwBjB,OAAOu+C,SAASz7C,QAAQ,iCAvBT,SAAUa,MAAO66C,OAAQC,OAAQ/vC,OAC5C,GAAkC,KAA9B6vC,SAASl/B,OAAO3Q,MAAQ,GACxB,OAAO/K,MAAM26C,UAAU,GAE3B,IAAK7vC,KAAK1M,OACN,OAAO4B,MAEX,IAAI+6C,IAAMjwC,KAAK,GAEX0W,OADQq5B,QAAUC,QACJ36C,MAAM,KACpByZ,KAAO4H,MAAM1T,SAAW,GACxB7I,OAAS5I,IAAIud,KAAKjS,eACtB,IAAK1C,OACD,OAAOjF,MAEX+6C,IAAMjwC,KAAKgD,QACX,IAAIktC,SAAWD,IAAI91C,QAAQgG,MAAM8vC,IAAKv5B,OAClCy5B,MAAQrhC,KAAK8B,OAAO,GAIxB,OAHIu/B,OAASA,MAAMtzC,gBACfqzC,SAAWpB,WAAWoB,WAEnBA,Y,gKAIf/2C,OAAO5H,IAAM,CACT,EAAK,a,yYChDF,MAAM6+C,aAAazzB,8CAKtBpY,OACI,OAAO8rC,wDAAY5+C,KAAKwT,KAG5B,WACI,OAAOxT,KAAK8S,OAAOuK,KAGvB,YACI,OAAOrd,KAAK8S,OAAO6qB,MAGvBkhB,YAAYpV,MACR,OAAOzpC,KAAK8S,OAAO22B,MAGvBqV,eAAer3B,KACX,MAAMyiB,IAAMlqC,KAAK6+C,YAAYp3B,IAAI3U,KAAK22B,MAE1B,IAARS,KACAziB,IAAI3U,KAAK82B,UAAUjjC,KAAK,CACpBnB,OAAQxF,KAAKqd,KACb6sB,MAKZoO,gBAAgB7wB,KACZ,GAAIA,IAAI3U,KAAK+2B,QAAU1B,sDAAa,CAChC,MAAM+B,IAAMlqC,KAAK29B,MAEjBlW,IAAI3U,KAAK82B,UAAUjjC,KAAK,CACpBnB,OAAQxF,KAAKqd,KACb6sB,Q,IAtCHyU,K,uBACW,CAChBnrC,IAAKurC,qD,6dCJN,MAAMA,WAAa,aACbC,YAAc,cACdC,WAAa,aACbC,UAAY,YAEnBvW,OAAS,CACX,CAACoW,YAAa,IAAII,+CAAS,CACvB9hC,KAAM,QACN7J,IAAKurC,WACLphB,MAAO,EACPkJ,cAAe,EACf6D,aAAc,EACdC,iBAAkB,EAClBC,cAAe,EACfC,WAAY,IAEhB,CAACmU,aAAc,IAAIG,+CAAS,CACxB9hC,KAAM,SACN7J,IAAKwrC,YACLrhB,MAAO,EACPkJ,eAAgB,EAChB6D,aAAc,EACdC,iBAAkB,EAClBC,cAAe,EACfC,WAAY,IAEhB,CAACoU,YAAa,IAAIE,+CAAS,CACvB9hC,KAAM,QACN7J,IAAKyrC,WACLthB,MAAO,EACPkJ,eAAgB,EAChB6D,aAAc,EACdC,kBAAmB,EACnBC,cAAe,EACfC,WAAY,IAEhB,CAACqU,WAAY,IAAIC,+CAAS,CACtB9hC,KAAM,OACN7J,IAAK0rC,UACLvhB,MAAO,EACPkJ,cAAe,EACf6D,cAAe,EACfC,iBAAkB,EAClBC,eAAgB,EAChBC,YAAa,KAIR+T,YAAevhC,MAASsrB,OAAOtrB,O,4VClD7B,MAAM8hC,SAUjB1mC,YAAY3F,MAAM,4BATX,IASW,6BARV,GAQU,2BAPZ,GAOY,qCANF,GAME,oCALH,GAKG,wCAJC,GAID,qCAHF,GAGE,kCAFL,GAGT9S,KAAKqd,KAAOvK,KAAKuK,MAAQ,GACzBrd,KAAK29B,MAAQ7qB,KAAK6qB,OAAS,EAC3B39B,KAAKwT,IAAMV,KAAKU,IAEhBxT,KAAK6mC,cAAgB/zB,KAAK+zB,eAAiB,EAC3C7mC,KAAK0qC,aAAe53B,KAAK43B,cAAgB,EACzC1qC,KAAK2qC,iBAAmB73B,KAAK63B,kBAAoB,EACjD3qC,KAAK4qC,cAAgB93B,KAAK83B,eAAiB,EAC3C5qC,KAAK6qC,WAAa/3B,KAAK+3B,YAAc,K,kZCVtC,MAAMuU,eAAel0B,8CAQxB,WACI,OAAOgvB,oEAAkBl6C,KAAKq/C,YAGlC,aACI,OAAOlF,sEAAoBn6C,KAAKq/C,YAGpC,iBACI,OAAOjF,uEAAqBp6C,KAAKq/C,YAGrCpE,oBAAoBD,MAChB,OAAOhD,gEAAch4C,KAAKq/C,YAAYpE,oBAAoBD,KAAMh7C,MAGpE46C,OAGI,OAFU3Y,sDAAU,EAAGjiC,KAAK+mC,KAEjB/mC,KAAKgnC,SAGpBsY,cAAc73B,MACSuwB,gEAAch4C,KAAKq/C,YAE3BpY,OAAOxf,IAAI3U,KAAKylB,WAAY9Q,IAAI3U,KAAKma,OAAQjtB,MAExDynB,IAAI3U,KAAKylB,WAAWxO,UAAU,kBAAmB/pB,KAAKo/B,MAEtD3X,IAAI3U,KAAKkB,SAAU,EAGvBurC,qBAAqB93B,MACEuwB,gEAAch4C,KAAKq/C,YAE3BnH,cAAczwB,IAAI3U,KAAKylB,WAAY9Q,IAAI3U,KAAKma,OAAQjtB,MAE/DynB,IAAI3U,KAAKkB,SAAU,G,MA5CH,CAChBqrC,WAAY,kBACZtY,IAAK,EACLC,SAAU,EACV5H,KAAM,M,wBALDggB,Q,+jBCNN,MAAMhD,eAAelxB,8CASxByxB,oBACI,OAAO38C,KAAKsM,SAAWtM,KAAK49B,SAGhCmf,cACI,OAAO/8C,KAAK49B,UAAY59B,KAAKsM,U,gBAdxB8vC,O,iBACc,G,gBADdA,O,aAEW,CAChB5oC,IAAKsoC,4DACLxvC,SAAU,IACVsxB,SAAU,EACV4e,QAAS,M,2PCPV,MAAMgD,eAAet0B,iD,6QCArB,MAAM4xB,wBAAwB5xB,iD,gVCC9B,MAAMu0B,kBAAkBv0B,8CAK3BlZ,KAAKyX,QACD,OAAO0hB,sDAAUT,sDAAcjhB,OAAQzpB,KAAK0/C,Y,MAL5B,CAChBA,UAAW,K,wBAFND,W,8gBCDN,MAAME,yBAAyBz0B,8CAclC00B,wBAAwBn4B,KACpB,MAAMyiB,IAAMlqC,KAAKynB,IAAI3U,KAAK+2B,OAEtBK,KACAziB,IAAI3U,KAAK82B,UAAUjjC,KAAK,CACpBnB,OAAQxF,KAAKypB,OAAO6d,QAAQjqB,KAC5B6sB,O,gBApBHyV,iB,iBACc,G,gBADdA,iB,aAEW,CAChBtX,YAAa,EACbD,aAAc,EACdD,YAAa,EACbP,eAAgB,EAChBU,YAAa,EACbC,eAAgB,EAChBC,UAAW,EACXC,YAAa,EACbC,aAAc,K,+cCRf,MAAMmX,oBAAoB30B,8CAQ7B,eACI,QAASlrB,KAAKypB,OAAOq2B,KAGzB,kBACI,OAAO9/C,KAAK+/C,MAAQ,EAGxBC,iBACI,MAAMjrC,IAAM/U,KAAKypB,OAAO+O,SAASC,SAEjC,OAAO75B,wEAAgCmW,IAAIC,EAAGD,IAAIE,GAGtDgrC,eAAeh+B,OACX,MAAMlN,IAAM/U,KAAKypB,OAAO+O,SAASC,SAEjC,OAAO75B,wEAAgCmW,IAAIC,EAAGD,IAAIE,EAAGgN,OAGzDi+B,kBACI,MAAO,IAGXC,iBACI,OAAOngD,KAAKggD,iBAAmB,IAGnCI,eAAeC,WACX,GAAIrgD,KAAK+/C,MAAQ,EACb,OAAO,EAKX,OAFoB//C,KAAKggD,iBAEHK,UAAa,IAGvCC,QAAQ74B,KACJ,GAAIznB,KAAKugD,SACL,OAGJ,MAAMF,UAAY54B,IAAI3U,KAAKutC,WAEvBle,+DAAmBniC,KAAKogD,eAAeC,cACvCrgD,KAAKypB,OAAO0J,IAAIqtB,wCAAM,CAClBH,YAEJrgD,KAAKigD,eAAejgD,KAAKygD,aAIjCC,YAAYj5B,KACRznB,KAAKypB,OAAO0J,IAAIqtB,wCAAM,CAClBH,UAAW,IAEfrgD,KAAKigD,eAAejgD,KAAKygD,YAG7B7nB,kBAAkBnR,KACTznB,KAAKugD,UAAavgD,KAAKypB,OAAOwa,eAC/Bxc,IAAI3U,KAAK+lB,aAAalyB,KAAK,CACvB0W,KAAM,SACNoK,IAAK,aACL44B,UAAW,K,MAxEH,CAChBN,KAAM,IACNU,WAAY,IACZE,iBAAkB,KAClBC,SAAU,I,wBALLf,a,sWCHN,MAAMW,aAAat1B,8CAKtB21B,aACI7gD,KAAKmuB,UAGT2yB,gBAAgBr5B,KACZznB,KAAK6gD,aAGTjoB,kBAAkBnR,KACdA,IAAI3U,KAAK+lB,aAAalyB,KAAK,CACvB0W,KAAM,aACNoK,IAAK,oB,MAfO,CAChB44B,UAAW,I,wBAFNG,M,4XCAN,MAAMO,wBAAwB71B,+C,MACb,CAChBjJ,MAAO,K,wBAFF8+B,iB,gXCAN,MAAMC,kBAAkB91B,8CAM3B+1B,iBAAiBx5B,KACbA,IAAI3U,KAAKkJ,UAAUrV,QAAQ3G,KAAKkhD,Q,MANhB,CAChBA,MAAO,GACPr+C,MAAO,K,wBAHFm+C,W,8kBCCN,MAAMG,sBAAsBj2B,8CAiB/B,cACI,OAAOk2B,2DAAWphD,KAAKwT,KAG3B,gCACI,OAAKxT,KAAKqhD,cAIHrhD,KAAKshD,iBAAmBthD,KAAKuhD,wBAHzBr0C,IAMf,wBACI,OAAIlN,KAAKqhD,cACE,EAGJrhD,KAAKsM,SAAWtM,KAAKwhD,gBAGhC,mBACI,OACKxhD,KAAKqhD,eACNrhD,KAAKyhD,uBAAyBzhD,KAAK0hD,gBAI3C,iBACI,OACI1hD,KAAKwhD,iBAAmBxhD,KAAKsM,UAC5BtM,KAAK2hD,QAAQC,eAAiB5hD,KAAK6hD,YAI5C,yBACI,OACI7hD,KAAKqhD,eACLrhD,KAAKuhD,yBAA2BvhD,KAAKshD,iBAI7CQ,gBACI9hD,KAAKqhD,eAAgB,EACrBrhD,KAAK6hD,aAAc,EAGvBvJ,gBAAgB7wB,KACZ,GAAIznB,KAAK+hD,WACL,OAGJ,MAAM7X,IAAMlqC,KAAKgiD,UAAUv6B,IAAI3U,KAAK+2B,OAEhCK,KACAziB,IAAI3U,KAAK82B,UAAUjjC,KAAK,CACpBnB,OAAQxF,KAAK2hD,QAAQtkC,KACrB6sB,MAKZ4U,eAAer3B,KACX,GAAIznB,KAAKqhD,cACL,OAGJ,MAAMnX,IAAMlqC,KAAKiiD,SAASx6B,IAAI3U,KAAK22B,MAE/BS,KACAziB,IAAI3U,KAAK82B,UAAUjjC,KAAK,CACpBnB,OAAQxF,KAAK2hD,QAAQtkC,KACrB6sB,O,gBAxFHiX,c,iBACc,G,gBADdA,c,cAEY,O,gBAFZA,c,aAGW,CAChB3tC,IAAK,iBACL6tC,eAAe,EACfQ,aAAa,EACbP,iBAAkB,IAClBC,wBAAyB,EACzBj1C,SAAU,IACVk1C,gBAAiB,EACjBE,gBAAiB,EACjBD,uBAAwB,EACxBQ,SAAU,GACVD,UAAW,M,4hCCVZ,MAAME,eAAiB,iBACjBC,aAAe,eACfC,qBAAuB,uBACvBC,cAAgB,gBAChBC,aAAe,eACfC,0BAA4B,4BAEnC5Z,OAAS,CACXuZ,eAAgB,IAAIM,sEACpBL,aAAc,IAAIM,oEAClBL,qBAAsB,IAAIM,0EAC1BL,cAAe,IAAIM,oEACnBL,aAAc,IAAIM,mEAClBL,0BAA2B,IAAIM,mFAGtBzB,WAAc5tC,KAAQm1B,OAAOn1B,KAC7BsvC,iBAAmB,CAACtvC,IAAKiW,UAClC,GAAIA,OAAOs5B,cACP,OAAOt5B,OAAOs5B,cAAcvvC,MAGvBwvC,UAAav5B,SACtB,GAAKA,OAAOs5B,cAIZ,OAAO7xC,OAAO2T,OAAO4E,OAAOs5B,eAAe/d,MAAMtxB,QAEzCA,OAAOiuC,QAAQsB,WACdvvC,OAAO2tC,gBACP3tC,OAAOquC,cAIPmB,cAAiBz5B,SAC1B,GAAKA,OAAOs5B,cAIZ,OAAO7xC,OAAO2T,OAAO4E,OAAOs5B,eAAe/d,MAAMtxB,QACtCA,OAAOiuC,QAAQwB,aAAezvC,OAAO0vC,iB,2sBC1CrC,MAAMP,kCAAkCQ,2DAAqB,+DAClEd,mEADkE,4BAEjEe,sEAFiE,4BAGjE,wBAEPC,oBAAoB95B,QAChB,OAAO,IAGX+5B,mBAAmB/5B,QACf,OAAO,IAGXg6B,iBAAiBh6B,QACb,OAAOtd,KAAKC,IAAI,GAAGw6B,+CAAQiE,+CAAYphB,SAG3Ci6B,eAAej6B,QACX,MAAMmpB,MAAQ5yC,KAAKyjD,iBAAiBh6B,QAEpC,uBAAiBmpB,MAAjB,uBAGJ+Q,aAAal6B,QACT,MAAO,CACH4e,YAAaroC,KAAKyjD,iBAAiBh6B,SAI3Cm6B,kBAAkBlwC,QACd,MAAMqB,IAAMrB,OAAO+V,OAAO+O,SAASC,UAEnCqZ,kEAAgBv+B,SAAS0+B,MACrBrzC,KAAKsc,UAAU2oC,cACX9uC,IAAIC,EACJD,IAAIE,EACJ,CACI7M,KAAM,GAEV,CACIq1B,OAAQ,CAAC,IAAK,IAAK,KACnBC,KAAM,CAAC,UACPC,MAAO,IACPH,WAAWwT,iEAAeiB,KAC1BrU,SAAU,Y,yaClDvB,MAAMkmB,oBAAsB,EACtBC,mBAAqB,EACrBC,mBAAqB,EACrBC,mBAAqB,EACrBX,oBAAsB,EAE7B3a,OAAS,CACX,CAACmb,qBAAsB,CACnBzmC,KAAM,UAEV,CAAC0mC,oBAAqB,CAClB1mC,KAAM,SAEV,CAAC2mC,oBAAqB,CAClB3mC,KAAM,SAEV,CAAC4mC,oBAAqB,CAClB5mC,KAAM,SAEV,CAACimC,qBAAsB,CACnBjmC,KAAM,WAID6mC,mBAAsB1wC,KAAQm1B,OAAOn1B,KAAK6J,M,ugBCpBxC,MAAMgmC,6BAA6Bc,8CAAQ,yEACvC,GADuC,oCAExC,GAEdC,YAAY36B,QACR,OAAO,IAGX85B,oBAAoB95B,QAChB,OAAO,IAGX+5B,mBAAmB/5B,QACf,OAAO,IAGX46B,QAAQ56B,OAAQ3W,MACZ2W,OAAO0J,IAAIguB,2DAAe,CACtB3tC,IAAKxT,KAAKwT,IACV6tC,eAAe,EACfK,gBAAiB1hD,KAAKwjD,mBAAmB/5B,QACzCg4B,uBAAwB,EACxBH,iBAAkBthD,KAAKujD,oBAAoB95B,QAC3Cw4B,SAAUjiD,KAAKskD,YAAY76B,QAC3Bu4B,UAAWhiD,KAAK2jD,aAAal6B,a,8lBCtB1B,MAAM06B,QAOjB,eACI,OAAOnkD,KAAKqY,OAASyrC,qEAGzBJ,eAAej6B,QACX,MAAO,GAGX85B,oBAAoB95B,QAChB,OAAO,IAGX+5B,mBAAmB/5B,QACf,OAAO,EAGXhR,YAAYjF,IAAK6E,KAAMgF,MAAM,2BAtBvB,IAsBuB,4BArBtB,GAqBsB,4BApBtB,IAoBsB,qCAnBd,GAmBc,oCAlBf,GAmBVrd,KAAKwT,IAAMA,IACXxT,KAAKqY,KAAOA,KACZrY,KAAKqd,KAAOA,KAGhBumC,kBAAkBlwC,SAElB6wC,SAAS96B,OAAQ8B,SACbA,QAAQi5B,YAGZH,QAAQ56B,OAAQ3W,MACZ2W,OAAO0J,IAAIguB,2DAAe,CACtB3tC,IAAKxT,KAAKwT,IACV6tC,eAAe,EACfC,iBAAkBthD,KAAKujD,oBAAoB95B,UAInD66B,YAAY76B,QACR,MAAO,GAGXk6B,aAAal6B,QACT,MAAO,GAGXg7B,SAASh7B,QAWL,OAVAA,OAAO0J,IAAIguB,2DAAe,CACtB3tC,IAAKxT,KAAKwT,IACVquC,aAAa,EACbR,eAAe,EACf/0C,SAAUtM,KAAKokD,YAAY36B,QAC3B63B,iBAAkBthD,KAAKujD,oBAAoB95B,QAC3Cw4B,SAAUjiD,KAAKskD,YAAY76B,QAC3Bu4B,UAAWhiD,KAAK2jD,aAAal6B,WAG1B,EAGXi7B,UAAUj7B,OAAQ/V,QACdA,OAAOouC,gBAGX6C,QAAQn7B,OAAQ9V,QACZA,OAAO+tC,wBAA0Bj4B,OAE7B9V,OAAO+tC,wBAA0B/tC,OAAOguC,kBACxCl4B,OACI9V,OAAOguC,iBACNhuC,OAAO+tC,uBAAyBj4B,QACrC9V,OAAO+tC,uBAAyB/tC,OAAOguC,gBACvChuC,OAAOouC,gBACP9hD,KAAK4jD,kBAAkBlwC,SAO3B,OAJeA,OAAO+V,OAEfM,UAAU,kBAAmBP,QAE7BA,OAGXo7B,cAAclxC,QACVA,OAAO8tC,gBAAkB9tC,OAAOpH,SAChCoH,OAAOouC,gBAGXplC,OAAOD,GAAI/I,QACHA,OAAO2tC,eACP3tC,OAAO6tC,yBAA2B9kC,GAE9B/I,OAAO6tC,wBAA0B7tC,OAAO4tC,mBACxC5tC,OAAO6tC,wBAA0B7tC,OAAO4tC,mBAErC5tC,OAAOquC,YACdruC,OAAOouC,gBAGPpuC,OAAO0vC,eAIN1vC,OAAOquC,aACRruC,OAAO8tC,iBAAmB/kC,IAG1B/I,OAAOmxC,oBACPnxC,OAAOya,WAIf22B,eAAer7B,QACX,MAAM/V,QAASovC,4DAAiB9iD,KAAKwT,IAAKiW,QAE1C,GAAI/V,QAAUA,OAAO2tC,cAAe,CAChC,MAAM0D,IAAMrxC,OAAOsxC,0BAA4B,KAAMC,QAAQ,GAE7D,MAAO,CACHvmC,KAAM,GAAF,OAAK1e,KAAKqd,KAAV,aAAmB0nC,GAAnB,KACJG,WAAW,GAInB,OAAIllD,KAAK4hD,aACDluC,QAAUA,OAAOmuC,YACV,CACHnjC,KAAM,GAAF,OAAK1e,KAAKqd,KAAV,iBACJ6nC,WAAW,GAGR,CACHxmC,KAAM,GAAF,OAAK1e,KAAKqd,KAAV,gBACJ6nC,WAAW,GAKhB,CACHxmC,KAAM1e,KAAKqd,KACX6nC,WAAW,M,oxBChJR,MAAMvC,qBAAqBwB,8CAAQ,+DACxC9B,uDADwC,4BAEvC4B,qEAFuC,4BAGvC,SAEPV,oBAAoB95B,QAChB,OAAO,IAGXi6B,eAAej6B,QACX,wCAGJ86B,SAAS96B,OAAQ8B,SACb3sB,gEAAwB8rB,oEAAe,CACnCzR,UAAUksC,wFAAqB,CAC3B3Y,QAAS,EAAGx3B,EAAGC,MAEX,MAAMmwC,QAAUxmD,+DACGoW,EAAGC,GAAG,GACpBmM,QAAQne,GAAMA,EAAE6qC,YAGrB,QAAIsX,QAAQvjD,QAAU,KAKdujD,QAAQhwB,MAAMnyB,GAAMA,EAAEq8B,SAAWr8B,EAAE0a,UAGnDmqB,SAAW5I,SACPtgC,iEACA2sB,QAAQi5B,UAAUtlB,SAEtB+I,SAAU,KACNrpC,iEACA2sB,QAAQ0c,cAKpBoc,QAAQ56B,OAAQ3W,MACZoK,MAAMmnC,QAAQ56B,OAAQ3W,MAEtB,MAAMuyC,QAAU57B,OAAO+O,SAASC,SAC1B6sB,QAAUxyC,KAAK0lB,SAErB55B,qEACIymD,QAAQrwC,EACRqwC,QAAQpwC,EACR,CACI7M,KAAM,GAEV,CACIq1B,OAAQ,CAAC,IAAK,IAAK,KACnBC,KAAM,CAAC,UACPC,MAAO,EACPC,SAAU,MAIlBnU,OAAO+O,SAASsE,OAAOhqB,KAAK0lB,SAASxjB,EAAGlC,KAAK0lB,SAASvjB,GAEtDrW,qEACI0mD,QAAQtwC,EACRswC,QAAQrwC,EACR,CACI7M,KAAM,GAEV,CACIq1B,OAAQ,CAAC,IAAK,IAAK,KACnBC,KAAM,CAAC,UACPC,MAAO,EACPC,SAAU,S,0RC/E1B,MAAM2O,OAAS,KAAM,EAER4Y,qBAAuB,CAAC55B,QAAU,MAC3C,MAAMihB,QAAUjhB,QAAQihB,SAAWD,OAEnC,MAAO,CACHC,QACA3vB,OAAS4vB,OACL,MAAMjK,MAAQgK,QAAQC,MAAQ,OAAS,MACjCC,OAAS9tC,kEAA0B6tC,KAAKz3B,EAAGy3B,KAAKx3B,GAEtDrW,2DAAmB8tC,OAAO13B,EAAG03B,OAAOz3B,EAAG,IAAKutB,W,g0BCLzC,MAAMkgB,2BAA2B6C,4DAAsB,+DAC5DnD,8DAD4D,4BAE3D6B,qEAF2D,4BAG3D,gBAEPG,YAAY36B,QACR,OAAO,IAGX85B,oBAAoB95B,QAChB,OAAO,IAGXi6B,eAAej6B,QACX,+DAAyD,EAAzD,2EAGJ46B,QAAQ56B,OAAQ3W,MACZoK,MAAMmnC,QAAQ56B,OAAQ3W,OACtB8oC,oDAAUE,uDAAiBryB,OAAQ,CAC/Bnd,SAAUtM,KAAKokD,YAAY36B,QAC3B+yB,QAAS,KAGb,MAAM9oC,QAASovC,4DAAiB9iD,KAAKwT,IAAKiW,QAE1CzpB,KAAKwlD,gBAAgB9xC,QAGzB8xC,gBAAgB9xC,QACZ,MAAM+V,OAAS/V,OAAO+V,OAChB1U,IAAMrB,OAAO+V,OAAO+O,SAASC,SACnC75B,qEACyBmW,IAAIC,EAAGD,IAAIE,GAC/BwmC,OACAr6B,QAAQne,GAAMrE,yEAAiCqE,EAAGwmB,UAClD3pB,KAAK47C,UACF,MAAMzU,OAAS,IAAIC,6CAAO,CACtBC,SAAU1d,OACV+d,aAAa,EACbJ,SAAUsU,QACVrU,WAAYrnC,KAAKqd,KACjBypB,OAAQ,EACRS,WAAYmE,8DAGVjkB,IAAMi0B,QAAQ3xB,UAAU,WAAY,CAAEkd,SAE5C,GAAIxf,IAAI3U,KAAKg0B,OAAS,EAAG,CACrBrd,OAAOM,UAAU,OAAQ,CACrB9H,MAAOwF,IAAI3U,KAAKg0B,SAGpB,MAAM2e,SAAW/J,QAAQljB,SAASC,SAClC75B,qEACI6mD,SAASzwC,EACTywC,SAASxwC,EACT,CACI7M,KAAM,GAEV,CACIq1B,OAAQ,CAAC,IAAK,KACdC,KAAM,CAAC,OACPC,MAAO,IACPC,SAAU,UAM9Bh/B,qEACImW,IAAIC,EACJD,IAAIE,EACJ,CACI7M,KAAM,GAEV,CACIq1B,OAAQ,CAAC,IAAK,KACdC,KAAM,CAAC,OACPC,MAAO,IACPC,SAAU,MAKtBlhB,OAAOD,GAAI/I,QACPwJ,MAAMR,OAAOD,GAAI/I,QAEb9U,8DAAwB,GAAK8U,OAAOquC,YAIxC/hD,KAAKwlD,gBAAgB9xC,W,maChGd,MAAM6xC,8BAA8BpB,8CAC/CC,YAAY36B,QACR,OAAO,IAGX85B,oBAAoB95B,QAChB,OAAO,IAGX46B,QAAQ56B,OAAQ3W,MAGZ,QAFegwC,4DAAiB9iD,KAAKwT,IAAKiW,UAM1CA,OAAO0J,IAAIguB,yEAAe,CACtB3tC,IAAKxT,KAAKwT,IACVquC,aAAa,EACbR,eAAe,EACf/0C,SAAUtM,KAAKokD,YAAY36B,QAC3B63B,iBAAkBthD,KAAKujD,oBAAoB95B,QAC3Cw4B,SAAUjiD,KAAKskD,YAAY76B,QAC3Bu4B,UAAWhiD,KAAK2jD,aAAal6B,WAG1B,M,snBCzBA,MAAMg5B,oBAAoBiD,2DAAqB,+DACpDvD,sDADoD,4BAEnD2B,sEAFmD,4BAGnD,QAEP6B,mBAAmBl8B,QACf,OAAwC,GAAjCmd,+CAAQC,kDAAepd,QAGlC26B,YAAY36B,QACR,OAAO,IAGX85B,oBAAoB95B,QAChB,OAAO,IAGXi6B,eAAej6B,QACX,MAAMve,IAAMlL,KAAK2lD,mBAAmBl8B,QAEpC,2CAAqCve,IAArC,qBAAqD,EAArD,iBAGJy4C,aAAal6B,QACT,MAAO,CACH6e,aAAc,GAItBgc,YAAY76B,QACR,MAAO,CACHod,cAAe7mC,KAAK2lD,mBAAmBl8B,Y,sSCjCpC,MAAMi8B,6BAA6BvB,8CAAQ,qB,kBAAA,e,OACvC,G,IADuC,kB,IAAA,M,gGAGtDC,YAAY36B,QACR,OAAO,IAGX85B,oBAAoB95B,QAChB,OAAO,IAGX46B,QAAQ56B,OAAQ3W,U,wnBCTL,MAAM0vC,sBAAsBkD,2DAAqB,+DACtDxD,wDADsD,4BAErD4B,sEAFqD,4BAGrD,UAEP8B,gBAAgBn8B,QACZ,OAAO,EAAI,GAAImd,+CAAQ+D,qDAAkBlhB,QAG7C26B,YAAY36B,QACR,OAAO,IAGX85B,oBAAoB95B,QAChB,OAAO,IAGXi6B,eAAej6B,QACX,MAAMkU,MAAQ39B,KAAK4lD,gBAAgBn8B,QAEnC,sBAAgBkU,MAAhB,sBAGJgmB,aAAal6B,QACT,MAAO,CACH0e,YAAanoC,KAAK4lD,gBAAgBn8B,Y,40BCtB/B,MAAMm5B,oBAAoBuB,8CAAQ,+DACvC7B,sDADuC,4BAEtC0B,qEAFsC,4BAGtC,QAEPT,oBAAoB95B,QAChB,OAAO,IAGXo8B,gBAAgBp8B,QACZ,OAAOtd,KAAK41B,MAAM51B,KAAKC,IAAI,GAAGw6B,+CAAQ+D,qDAAkBlhB,SAAW,GAGvEi6B,eAAej6B,QACX,MAAMq8B,SAAW9lD,KAAK6lD,gBAAgBp8B,QAChCs8B,KAAOD,SAAW,EAAI,QAAU,OAEtC,2BAAqBA,SAArB,YAAiCC,KAAjC,sDAGJxB,SAAS96B,OAAQ8B,SACb,MAAMu6B,SAAW9lD,KAAK6lD,gBAAgBp8B,QAEtC7qB,gEAAwB8rB,oEAAe,CACnChU,YAAaovC,SAAW,EACxB7sC,UAAU4uB,oFAAmB,CACzB2E,QAAS,EAAGx3B,EAAGC,GAAK4M,OAEhB,GAAIA,IAAM,EAAIikC,SACV,OAAO,EAIX,MAAMV,QAAUxmD,+DACGoW,EAAGC,GAAG,GACpBmM,QAAQne,GAAMA,EAAE6qC,YAGrB,QAAIsX,QAAQvjD,QAAU,KAKdujD,QAAQhwB,MAAMnyB,GAAMA,EAAEq8B,SAAWr8B,EAAE0a,UAGnDmqB,SAAW5I,SACPtgC,iEACA2sB,QAAQi5B,UAAUtlB,SAEtB+I,SAAU,KACNrpC,iEACA2sB,QAAQ0c,cAKpBoc,QAAQ56B,OAAQ3W,MACZoK,MAAMmnC,QAAQ56B,OAAQ3W,MAEtB2W,OAAO+O,SAASsE,OAAOhqB,KAAK0lB,SAASxjB,EAAGlC,KAAK0lB,SAASvjB,M,0VCjEvD,MAAM+wC,qBAAqB96B,+C,IAArB86B,a,uBACW,CAChBxyC,IAAKyyC,yDACLC,aAAa,EACbjkC,MAAO,G,iVCPR,MAAMgkC,aAAe,eAKtBnmD,IAAM,CACRmmD,aAAehkC,QACX,OAAQA,OACJ,KAAK,EACL,KAAK,EACL,KAAK,EACL,KAAK,EACL,KAAK,EACL,KAAK,GACL,KAAK,GACD,MAAO,IACX,KAAK,EACL,KAAK,EACL,KAAK,GACL,KAAK,GACL,KAAK,GACL,KAAK,IACD,MAAO,IACX,KAAK,GACL,KAAK,GACL,KAAK,IACL,KAAK,IACD,MAAO,IACX,KAAK,EACL,KAAK,GACL,KAAK,GACL,KAAK,GACL,KAAK,GACL,KAAK,GACL,KAAK,GACL,KAAK,GACL,KAAK,GACL,KAAK,GACL,KAAK,GACL,KAAK,IACL,KAAK,IACL,KAAK,IACL,KAAK,IACL,KAAK,IACL,KAAK,IACL,KAAK,IACD,MAAO,IACX,KAAK,GACL,KAAK,GACD,MAAO,IACX,KAAK,GACL,KAAK,GACL,KAAK,IACD,MAAO,IACX,KAAK,GACL,KAAK,IACD,MAAO,IACX,KAAK,GACL,KAAK,GACD,MAAO,IACX,KAAK,GACL,KAAK,GACL,KAAK,IACD,MAAO,IACX,KAAK,GACL,KAAK,GACL,KAAK,IACD,MAAO,IACX,KAAK,GACL,KAAK,GACL,KAAK,IACD,MAAO,IACX,KAAK,GACL,KAAK,GACD,MAAO,IACX,KAAK,GACD,MAAO,IACX,QACI,MAAO,OAKVkkC,aAAe,CAAC3yC,IAAK4yC,OAAStmD,IAAI0T,KAAK4yC,O,ucCzE7C,MAAMC,cAAcn7B,8CAOvB,mBACI,OAAO/e,KAAK41B,MAbC,IAcR/hC,KAAK4tC,OAAyB5tC,KAAK4tC,MAbxB,KAiBpB0Y,UACItmD,KAAK4tC,QACL5tC,KAAKumD,aAjBkB,EAmBvB3nD,2DAAmByuC,sEAAqB,CACpC5jB,OAAQzpB,KAAKypB,OACbmkB,MAAO5tC,KAAK4tC,SAGhBgO,yDAAUG,gEAAqB/7C,KAAKypB,OAAQ,CACxCnd,SAAU,MAGd,MAAMyI,IAAM/U,KAAKypB,OAAO+O,SAASC,SAEjC75B,qEACImW,IAAIC,EACJD,IAAIE,EACJ,CACI7M,KAAM,EACNkE,SAAU,MAEd,CACImxB,OAAQ,CAAC,KACTC,KAAM,CAAC,UACPC,MAAO,KACPH,UAAW,CACPxoB,GAAI,EACJC,GAAI,GAER2oB,SAAU,MAGlBh/B,qEACImW,IAAIC,EACJD,IAAIE,EACJ,CACI7M,KAAM,EACNkE,SAAU,MAEd,CACImxB,OAAQ,CAAC,KACTC,KAAM,CAAC,UACPC,MAAO,KACPH,UAAW,CACPxoB,EAAG,EACHC,GAAI,GAER2oB,SAAU,MAGlBh/B,qEACImW,IAAIC,EACJD,IAAIE,EACJ,CACI7M,KAAM,EACNkE,SAAU,MAEd,CACImxB,OAAQ,CAAC,KACTC,KAAM,CAAC,UACPC,MAAO,KACPH,UAAW,CACPxoB,EAAG,EACHC,GAAI,GAER2oB,SAAU,MAKtB4oB,MAAMC,IACFzmD,KAAKymD,IAAMA,GAEPzmD,KAAKymD,IAAMzmD,KAAK0mD,eAChB1mD,KAAKymD,IAAMzmD,KAAK0mD,aAEhB1mD,KAAKsmD,WAIbK,cAAcl/B,KACV,IAAKA,IAAI3U,KAAKggC,MAAMlF,MAChB,OAGJ,MAAMgZ,YAAmBn/B,IAAI3U,KAAKggC,MAAMlF,MAAMA,MAAQ5tC,KAAK4tC,MAAvC,EAEhBgZ,YAAc,GAIlB5mD,KAAKwmD,MA5GmB,GA4GbI,c,wBAxGK,CAChBH,GAAI,EACJ7Y,MAAO,EACP2Y,YAAa,I,wBAJRF,O,0WCRN,MAAMQ,eAAe37B,8CAaxBotB,gBAAgB7wB,KACZ,MAAMyiB,IAAMlqC,KAAKynB,IAAI3U,KAAK+2B,OAEtBK,KACAziB,IAAI3U,KAAK82B,UAAUjjC,KAAK,CACpBnB,OAAQxF,KAAKypB,OAAO6d,QAAQjqB,KAC5B6sB,O,MAlBQ,CAChB7B,YAAa,EACbD,aAAc,EACdD,YAAa,EACbP,eAAgB,EAChBU,YAAa,EACbC,eAAgB,EAChBC,UAAW,EACXC,YAAa,EACbC,aAAc,I,wBAVTme,Q,sXCAN,MAAMC,qBAAqB57B,+C,MACV,CAChB67B,aAAc,IACdC,gBAAiB,GACjBC,cAAc,I,wBAJTH,c,sWCAN,MAAMI,aAAah8B,+C,MACF,CAChBjJ,MAAO,K,wBAFFilC,M,8bCCN,MAAMC,oBAAoBj8B,8CAK7B,gBACI,OAAOlrB,KAAKiiB,MAGhBqwB,YACI,MAAMj1B,KAAOrd,KAAKypB,OAAO6d,QAAQjqB,KAE7Brd,KAAKiiB,OAASmlC,kEACdpnD,KAAKypB,OAAOrG,MAAMmf,GAAK,IACvBviC,KAAKypB,OAAO6d,QAAQjqB,KAApB,gBAAoCA,OAC7Brd,KAAKiiB,OAASolC,mEACrBrnD,KAAKypB,OAAOrG,MAAMmf,GAAK,IACvBviC,KAAKypB,OAAO6d,QAAQjqB,KAApB,iBAAqCA,QAErCrd,KAAKypB,OAAOrG,MAAMmf,GAAK,IACvBviC,KAAKypB,OAAO6d,QAAQjqB,KAApB,gBAAoCA,Q,MAnBxB,CAChB4E,MAAO,I,wBAFFklC,a,kzBCIN,MAAMG,gBAAkB,EAClBD,iBAAmB,EACnBD,gBAAkB,EAExB,MAAMG,2BAA2Br8B,8CACpCikB,QAAQ1nB,KACJ,MAEM+/B,QAFMxnD,KAAKypB,OAAOmkB,MAAMA,MACZhvC,uEACF,EAEhB,GAAI4oD,QAAU,EACV,OAGJ,MAAMzyC,IAAM/U,KAAKypB,OAAO+O,SAASC,SAC3BgvB,WAAa,IAEnB3V,kEAAgBv+B,SAAS0+B,MACrB,MAAMvS,OAAQsR,iEAAeiB,KACvBb,SAAW,CACbp8B,EAAGD,IAAIC,EAAI0qB,MAAM1qB,EACjBC,EAAGF,IAAIE,EAAIyqB,MAAMzqB,GAEJrW,+DAAuBwyC,SAASp8B,EAAGo8B,SAASn8B,GAEhDpT,QAAU,GACnB4lD,WAAW9gD,KAAKyqC,aAIpBqW,WAAW5lD,QAAU,GACrB4lD,WAAW9gD,KAAKoO,KAGpB,IAAI2yC,WAAaF,QACb5lD,EAAI,EAER,KAAO8lD,WAAa,GAAG,CACnB,MAAMC,SAAWF,WAAW7lD,EAAI6lD,WAAW5lD,QAC3C,IAAI+lD,WAAaN,gBAEbI,YAAcN,kBAAmBjlB,+DAAmB,IACpDylB,WAAaR,gBACNM,YAAcL,mBAAoBllB,+DAAmB,MAC5DylB,WAAaP,kBAGjBK,YAAcE,YAEd3vB,oDAAMkC,gEAAmBwtB,SAAS3yC,EAAG2yC,SAAS1yC,EAAG,CAC7C4yC,YAAa,CACT5lC,MAAO2lC,cAIfhmD,Q,qRC5DL,MAAMkmD,4BAA4B58B,iD,kNCF1B,MAAMpC,OAGjB,WACI,O,gOAAA,CAAO9oB,KAAP,OAGJyY,YAAY7Z,MAAM,kCANV,O,4UAOJ,CAAAoB,KAAA,MAAapB,MAGjB8d,OAAOD,Q,yYCPX,MAWMsrC,WAAa,CACf,EAAuB,CAAC/yC,EAAGC,EAAGhS,KACtBA,EAAE6qC,UACFlvC,2DACIoW,EACAC,EACAhS,EAAEmgB,MAAMnF,KACRhb,EAAEmgB,MAAMO,QACR1gB,EAAEmgB,MAAMS,UACR5gB,EAAEmgB,MAAM4kC,YAEL/kD,EAAEglD,UACTrpD,2DAAmBoW,EAAGC,EAAGhS,EAAEmgB,MAAMnF,KAAM,UAAW,YAG1D,EAA2B,CAACjJ,EAAGC,EAAGhS,EAAGilD,OAAQC,UACzC,MAAMC,KAAOxpD,wEAAgCspD,OAAQC,QAAU,IACzD/pC,GAzBeqO,KACzB,MAEM47B,KAAMvhC,yDAFC,CAAC,IAAK,GAAI,IACX,CAAC,EAAG,GAAI,IACW3a,KAAKm8C,KAAK77B,IAEzC,oBAAc47B,IAAI,GAAlB,YAAwBA,IAAI,GAA5B,YAAkCA,IAAI,GAAtC,MAoBeE,CAAoBp8C,KAAK2C,IAAI,EAAGs5C,OAEvCnlD,EAAE6qC,UACFlvC,2DACIoW,EACAC,EACAhS,EAAEmgB,MAAMnF,KACRhb,EAAEmgB,MAAMO,QACR1gB,EAAEmgB,MAAMS,UACRzF,IAGJxf,2DAAmBoW,EAAGC,EAAGhS,EAAEmgB,MAAMnF,KAAM,UAAW,UAAWG,MAK1D,MAAMpD,qBAAqB8N,6CAAO,qB,kBAAA,e,MA7CrB,G,IA6CqB,U,IAAA,M,gGAG7C0/B,WAAWxzC,EAAGC,GACV,MAAMmE,MAAQpZ,KAAKpB,KAAK6a,OAAOgvC,cAAczzC,EAAGC,GAEhD,IAAKjV,KAAKpB,KAAK6a,OAAOivC,SAAStvC,MAAMpE,EAAGoE,MAAMnE,GAC1C,OAGJ,MAAMmU,SAAWppB,KAAKpB,KAAKkB,IACtB6oD,cAAcvvC,MAAMpE,EAAGoE,MAAMnE,GAAG,GAChCmM,QAAQne,GAAMA,EAAEmgB,QAAUngB,EAAEghC,gBAAkBhhC,EAAE40B,eAErD,GAAIzO,SAASvnB,QAAU,EACnB,OAGJ,IAAI+mD,aAAe,EACfC,WAAa,KAEjBz/B,SAAS7V,SAAStQ,IACVA,EAAEmgB,MAAMlO,GAAK0zC,cACbC,WAAa5lD,EACb2lD,YAAc3lD,EAAEmgB,MAAMlO,MAI9B6yC,WAAW/nD,KAAK8oD,MAAM9zC,EAAGC,EAAG4zC,WAAYzvC,MAAMpE,EAAGoE,MAAMnE,GAG3D4H,OAAOJ,IACHzc,KAAKpB,KAAKqa,SAASsG,QAEnB,IAAK,IAAIvK,EAAI,EAAGA,EAAIhV,KAAKpB,KAAK6a,OAAO8D,MAAOvI,IACxC,IAAK,IAAIC,EAAI,EAAGA,EAAIjV,KAAKpB,KAAK6a,OAAO+D,OAAQvI,IACzCjV,KAAKwoD,WAAWxzC,EAAGC,GAK/ByH,OAAOD,IACHzc,KAAK6c,Y,wiBCvFE,MAAM5B,iBAAiB6N,6CAIlCrQ,YAAY7Z,MACRse,MAAMte,MADQ,kCAHN,GAGM,mCAFJ,MAIVoB,KAAK+oD,YAAc/oD,KAAKpB,KAAKC,IAAIkqB,YAAY,CACzClpB,IAAK,CAAC0tC,qDAASvkB,mDAAOkpB,wDACtBjpB,KAAM,CAACsb,8DAIfykB,wBACI,MAAMC,OAASjpD,KAAK+oD,YAAYzmC,MAGhC,IAAI+F,QAAU,EAEd4gC,OAAO11C,SAASkW,SACZ,IAAI6d,QAAU7d,OAAO6d,QAAQtqB,QACzBksC,YALQ,EAOZ,GAAIz/B,OAAOmnB,cAAe,CACtB,MAAMuY,SAAWnpD,KAAKpB,KAAK+a,SAASyvC,kBAChCxqD,KAAKib,OAAO4P,OACZA,QAEErG,MAAQpjB,KAAKpB,KAAK+a,SAAS0vC,iBAAiBF,UAElDnpD,KAAKpB,KAAKqa,SAASsF,OAdX,EAgBJ8J,QACAjF,MAAMnF,KACNmF,MAAMlF,IACNkF,MAAMjF,KAGV+qC,aAAe,IAGnBlpD,KAAKpB,KAAKqa,SAAS4F,SAASqqC,YAAa7gC,QAASif,SAElD,IAAIgiB,aACAtpD,KAAKpB,KAAKqa,SAASwF,iBAAiB6oB,SACpC4hB,YACA,GAEAK,SAAW,EAqBf,GAnBI9/B,OAAO/V,QACP+V,OAAO/V,OAAOH,SAASG,SACnB,MAAM81C,YAAarN,yDAAUzoC,OAAOF,KAEpC+1C,UAAYC,WAAW/M,YAAY/oC,OAAO8oC,SAE1Cx8C,KAAKpB,KAAKqa,SAASsF,OACf+qC,aACAjhC,QACAmhC,WAAWpmC,MAAMmf,GACjBinB,WAAWpmC,MAAMlF,IACjBsrC,WAAWpmC,MAAMjF,KAErBmrC,kBAIRC,SAAWp9C,KAAK2C,IAAI,EAAGy6C,UAEnB9/B,OAAOmzB,OAAQ,CACfv0B,UAEA,MAAMu0B,OAASnzB,OAAOmzB,OAChB6M,SAAW,EAEXpf,MAAQuS,OAAO36B,MAAQ26B,OAAOxwC,IAC9Bs9C,YAAcv9C,KAAKwG,KAAK03B,MAAQof,SAAW,GAAK,EAChDE,OAASx9C,KAAK41B,MAAM0nB,SAAW,GAAK,EAEpCG,UAAY,UACZC,YAAc,UAEpB,IAAK,IAAIjoD,EAAI,EAAGA,EAAI6nD,SAAU7nD,IAAK,CAC/B,MAAMuN,KAAOu6C,YAAc9nD,EACvB2nD,UAAY3nD,IAAM+nD,OACL,KAATx6C,KACiB,IAAbo6C,SACAvpD,KAAKpB,KAAKqa,SAASsF,OACf3c,EAxEZ,EAyEYymB,QACA,IACAuhC,UACAC,aAEgB,IAAbN,SACPvpD,KAAKpB,KAAKqa,SAASsF,OACf3c,EAhFZ,EAiFYymB,QACA,IACAuhC,UACAC,aAEgB,IAAbN,UACPvpD,KAAKpB,KAAKqa,SAASsF,OACf3c,EAxFZ,EAyFYymB,QACA,IACAuhC,UACAC,aAGD16C,KAAO,EACG,IAAbo6C,SACAvpD,KAAKpB,KAAKqa,SAASsF,OACf3c,EAlGZ,EAmGYymB,QACA,IACAuhC,UACAC,aAEgB,IAAbN,SACPvpD,KAAKpB,KAAKqa,SAASsF,OACf3c,EA1GZ,EA2GYymB,QACA,IACAuhC,UACAC,aAEgB,IAAbN,UACPvpD,KAAKpB,KAAKqa,SAASsF,OACf3c,EAlHZ,EAmHYymB,QACA,IACAuhC,UACAC,aAIS,IAAbN,SACAvpD,KAAKpB,KAAKqa,SAASsF,OACf3c,EA5HZ,EA6HYymB,QACA,IACAwhC,YACAD,WAEgB,IAAbL,SACPvpD,KAAKpB,KAAKqa,SAASsF,OACf3c,EApIZ,EAqIYymB,QACA,IACAwhC,YACAD,WAEgB,IAAbL,UACPvpD,KAAKpB,KAAKqa,SAASsF,OACf3c,EA5IZ,EA6IYymB,QACA,IACAwhC,YACAD,WAII,KAATz6C,KACPnP,KAAKpB,KAAKqa,SAASsF,OACf3c,EAtJJ,EAuJIymB,QACA,IACAuhC,UACAC,aAEG16C,KAAO,EACdnP,KAAKpB,KAAKqa,SAASsF,OACf3c,EA9JJ,EA+JIymB,QACA,IACAuhC,UACAC,aAGJ7pD,KAAKpB,KAAKqa,SAASsF,OACf3c,EAtKJ,EAuKIymB,QACA,IACAwhC,cAMhBxhC,aAIR3L,OAAOD,IACH,GAAIzc,KAAK8pD,UAAW,CAChB,MAAMC,KAAO/pD,KAAKpB,KAAKma,MAAMgxC,KACvBC,QAAU,UAAGhqD,KAAKpB,KAAKma,MAAMixC,QAAQ/E,QAAQ,IAAKgF,OACpD,EACA,KAGE/+C,IAAM,GAAH,OAAM6+C,KAAN,YAAcC,SACjBn7C,IAAM1C,KAAKwG,KAAK3S,KAAKpB,KAAKqa,SAASwF,iBAAiBvT,MAC1DlL,KAAKpB,KAAKqa,SAAS4F,SACf7e,KAAKpB,KAAK6a,OAAO8D,MAAQ,EAAI1O,IAC7B,EACA3D,KAIR,MAAMkO,MAAQpZ,KAAKpB,KAAKib,OAAO2e,SACzBoE,MAAQ58B,KAAKpB,KAAK0a,OAAO4wC,gBAAgB9wC,MAAMpE,EAAGoE,MAAMnE,GAE9DjV,KAAKpB,KAAKqa,SAAS4F,SAAS7e,KAAKpB,KAAK6a,OAAO8D,MAAQ,EAAG,EAAxD,iBAAqEnE,MAAMpE,EAA3E,aAAiFoE,MAAMnE,EAAvF,MACAjV,KAAKpB,KAAKqa,SAAS4F,SAAS7e,KAAKpB,KAAK6a,OAAO8D,MAAQ,EAAG,EAAxD,iBAAqEqf,MAAM5nB,EAA3E,aAAiF4nB,MAAM3nB,EAAvF,MAEAjV,KAAKgpD,2B,+5BC3NE,MAAMlwC,qBAAqBiE,8CAAQ,mEACzC,IADyC,+BAEzC,IAFyC,uCAGlC,IAEZ,QACI,6BAAO/c,KAAP,IAGJ,QACI,6BAAOA,KAAP,IAGJ,eACI,6BAAOA,KAAP,WAGJwoB,eAAexT,EAAGC,GACd,sBAAAjV,KAAA,GAAUmM,KAAKC,IAAI,EAAG4I,IACtB,sBAAAhV,KAAA,GAAUmM,KAAKC,IAAI,EAAG6I,IAG1BwT,mBACI,sBAAAzoB,KAAA,WAAiB,GAGrB0oB,mBACI,sBAAA1oB,KAAA,WAAiB,M,0iBCzBV,MAAMga,uBAAuB+C,8CAKxCtE,YAAY7Z,MACRse,MAAMte,MADQ,iCAJN,IAIM,oCAHH,CAACurD,qEAGE,mCAFJ,IAIVpwC,wDAAkBqwC,KAAQpqD,KAAKqqD,gBAAgBD,OAGnDhiC,aAAaX,KACTznB,KAAKsqD,YAAY3jD,KAAK8gB,KAG1B8iC,iBACI,MAAM9iC,IAAMznB,KAAKsqD,YAAY/4C,QAE7B,GAAIkW,IACA,OAAOznB,KAAKwqD,wBAAwB/iC,KAI5CgjC,WAAWC,QACP1qD,KAAK2qD,aAAahkD,KAAK+jD,QAG3BE,UAAUF,QACN,MAAMl8C,MAAQxO,KAAK2qD,aAAaE,YAAYH,QAExCl8C,OAAS,GACTxO,KAAK2qD,aAAaj6C,OAAOlC,MAAO,GAIxCs8C,kBAAkBJ,QACd,OAAO1qD,KAAK+qD,UAAUL,SAAW,GAGrCF,wBAAwB/iC,KACpB,IAAK,IAAI7lB,EAAI5B,KAAK2qD,aAAa9oD,OAAS,EAAGD,GAAK,EAAGA,IAAK,CACpD,MAAM8oD,OAAS1qD,KAAK2qD,aAAa/oD,GAE3BwoD,IADOpqD,KAAK8qD,kBAAkBJ,QACnB1lB,MAAMolB,KAAQA,IAAIY,QAAQvjC,OAE3C,GAAI2iC,IACA,OAAOA,KAKnBC,gBAAgBY,SACPjrD,KAAK+qD,UAAUE,QAAQP,UACxB1qD,KAAK+qD,UAAUE,QAAQP,QAAU,IAGrC1qD,KAAK+qD,UAAUE,QAAQP,QAAQ/jD,KAAKskD,Y,2YC3DrC,MAAMd,qBAAuB,EACvBe,uBAAyB,EACzBC,uBAAyB,EACzBC,kBAAoB,EACpBC,kBAAoB,G,ueC6DjC,MAAMjB,IAAM,CAACM,OAAQryC,KAAMgF,KAAMiuC,WAAY93C,IAAKjC,MAAOsW,KAAME,IAAKE,OAChE,IAAIsjC,mDAAa,CACbb,OACAryC,KACAgF,KACAiuC,WACA93C,IACAjC,MACAsW,KACAE,IACAE,OAIR,4BAEImiC,IAAID,mEAAwBqB,iEAAgC,WAA0B,EAAMC,kDAAc,GAAO,GAAO,GAAO,GAC/HrB,IAAID,mEAAwBqB,iEAAgC,YAA0B,EAAME,kDAAc,GAAO,GAAO,GAAO,GAC/HtB,IAAID,mEAAwBwB,gEAAgC,UAA0B,EAAMC,mDAAc,GAAO,GAAO,GAAO,GAC/HxB,IAAIc,qEAAwBW,8DAAgC,QAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAC/H1B,IAAIc,qEAAwBa,8DAAgC,QAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAC/H5B,IAAIc,qEAAwBe,kEAAgC,YAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAC/H9B,IAAIe,qEAAwBgB,8DAAgC,QAA0B,EAAML,8CAAc,GAAO,GAAO,GAAO,GAE/H1B,IAAID,mEAAwBiC,iEAAgC,WAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAC/HjC,IAAID,mEAAwBmC,gEAAgC,UAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAC/HnC,IAAID,mEAAwBmC,gEAAgC,WAA0B,EAAME,+CAAc,GAAO,GAAO,GAAO,GAC/HpC,IAAID,mEAAwBsC,iEAAgC,WAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAC/HtC,IAAID,mEAAwBwC,gEAAgC,UAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAC/HxC,IAAID,mEAAwBwC,gEAAgC,WAA0B,EAAME,iDAAc,GAAO,GAAO,GAAO,GAC/HzC,IAAID,mEAAwB2C,gEAAgC,UAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAC/H3C,IAAID,mEAAwB2C,gEAAgC,WAA0B,EAAME,kDAAc,GAAO,GAAO,GAAO,GAC/H5C,IAAID,mEAAwB8C,iEAAgC,WAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAC/H9C,IAAID,mEAAwBgD,gEAAgC,UAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAC/HhD,IAAID,mEAAwBgD,gEAAgC,WAA0B,EAAME,iDAAc,GAAO,GAAO,GAAO,GAC/HjD,IAAID,mEAAwBmD,iEAAgC,WAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAE/HnD,IAAID,mEAAwBqD,mEAAgC,aAA0B,EAAMnB,8CAAc,GAAO,GAAO,GAAO,GAC/HjC,IAAID,mEAAwBsD,kEAAgC,YAA0B,EAAMlB,8CAAc,GAAO,GAAO,GAAO,GAC/HnC,IAAID,mEAAwBsD,kEAAgC,aAA0B,EAAMjB,+CAAc,GAAO,GAAO,GAAO,GAC/HpC,IAAID,mEAAwBuD,mEAAgC,aAA0B,EAAMhB,8CAAc,GAAO,GAAO,GAAO,GAC/HtC,IAAID,mEAAwBwD,kEAAgC,YAA0B,EAAMf,8CAAc,GAAO,GAAO,GAAO,GAC/HxC,IAAID,mEAAwBwD,kEAAgC,aAA0B,EAAMd,iDAAc,GAAO,GAAO,GAAO,GAC/HzC,IAAID,mEAAwByD,kEAAgC,YAA0B,EAAMb,8CAAc,GAAO,GAAO,GAAO,GAC/H3C,IAAID,mEAAwByD,kEAAgC,aAA0B,EAAMZ,kDAAc,GAAO,GAAO,GAAO,GAC/H5C,IAAID,mEAAwB0D,mEAAgC,aAA0B,EAAMX,8CAAc,GAAO,GAAO,GAAO,GAC/H9C,IAAID,mEAAwB2D,kEAAgC,YAA0B,EAAMV,8CAAc,GAAO,GAAO,GAAO,GAC/HhD,IAAID,mEAAwB2D,kEAAgC,aAA0B,EAAMT,iDAAc,GAAO,GAAO,GAAO,GAC/HjD,IAAID,mEAAwB4D,mEAAgC,aAA0B,EAAMR,8CAAc,GAAO,GAAO,GAAO,GAC/HnD,IAAID,mEAAwB6D,kEAAgC,UAA0B,EAAMlC,8CAAc,GAAO,GAAO,GAAO,GAE/H1B,IAAIe,qEAAwB8C,8DAAgC,QAA0B,EAAMjC,8CAAc,GAAO,GAAO,GAAO,GAC/H5B,IAAIe,qEAAwB+C,iEAAgC,WAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAC/H/D,IAAIe,qEAAwB6C,kEAAgC,YAA0B,EAAMI,8CAAc,GAAO,GAAO,GAAO,GAC/HhE,IAAIe,qEAAwBkD,mEAAgC,aAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAC/HlE,IAAIe,qEAAwBoD,mEAAgC,aAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAC/HpE,IAAIe,qEAAwBsD,mEAAgC,aAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,GAC/HtE,IAAIe,qEAAwBwD,mEAAgC,aAA0B,EAAMC,8CAAc,GAAO,GAAO,GAAO,K,8QCxHpH,MAAMrD,aACjB9yC,YAAY3F,MACR9S,KAAK0qD,OAAS53C,KAAK43C,OACnB1qD,KAAKqY,KAAOvF,KAAKuF,KACjBrY,KAAKqd,KAAOvK,KAAKuK,KACjBrd,KAAKsrD,WAAax4C,KAAKw4C,WACvBtrD,KAAKwT,IAAMV,KAAKU,IAChBxT,KAAKuR,MAAQuB,KAAKvB,MAClBvR,KAAK6nB,KAAO/U,KAAK+U,KACjB7nB,KAAK+nB,IAAMjV,KAAKiV,IAChB/nB,KAAKioB,KAAOnV,KAAKmV,KAGrB+iC,QAAQ6D,YACJ,MAAMvD,WAAauD,sBAAsBnnC,wDAEzC,OACI1nB,KAAKsrD,YAAcA,YACnBtrD,KAAKwT,KAAOq7C,WAAWr7C,KACvBxT,KAAKuR,OAASs9C,WAAWt9C,OACzBvR,KAAK6nB,MAAQgnC,WAAWhnC,MACxB7nB,KAAK+nB,KAAO8mC,WAAW9mC,KACvB/nB,KAAKioB,MAAQ4mC,WAAW5mC,Q,2zCCxB7B,MAAMmkC,kBAAoB,EACpBE,iBAAmB,EACnBG,kBAAoB,EACpBE,iBAAmB,EACnBG,iBAAmB,EACnBG,kBAAoB,EACpBE,iBAAmB,EACnBG,kBAAoB,EAEpBnB,eAAiB,EACjBX,kBAAoB,EACpBG,iBAAmB,GACnBE,eAAiB,GACjBE,eAAiB,GACjBkC,eAAiB,GAEjBC,kBAAoB,GACpBF,mBAAqB,GACrBK,oBAAsB,GAEtBb,oBAAsB,GACtBC,mBAAqB,GACrBC,oBAAsB,GACtBC,mBAAqB,GACrBC,mBAAqB,GACrBC,oBAAsB,GACtBC,mBAAqB,GACrBC,oBAAsB,GACtB9B,mBAAqB,GAErBsC,oBAAsB,GACtBE,oBAAsB,GACtBE,oBAAsB,I,ijKChC5B,MAAMG,WAAa,EACbC,SAAW,EACXC,eAAiB,EACjBC,QAAU,EACVC,UAAY,GACZzD,UAAY,GACZ0D,kBAAoB,GACpBC,UAAY,GACZC,YAAc,GACdC,QAAU,GACVC,UAAY,GACZC,cAAgB,GAChBC,SAAW,GACXC,SAAW,GACXC,UAAY,GACZC,UAAY,GACZC,UAAY,GACZjE,WAAa,GACbkE,YAAc,GACdC,eAAiB,GACjBC,WAAa,GACbC,eAAiB,GACjBvE,UAAY,GACZwE,YAAc,GACdC,cAAgB,GAChBC,QAAU,GACVC,SAAW,GACXxD,SAAW,GACXL,OAAS,GACTQ,UAAY,GACZK,SAAW,GACXiD,WAAa,GACbC,UAAY,GACZC,YAAc,GACdC,gBAAkB,GAClBC,WAAa,GACbC,WAAa,GACbC,UAAY,GACZC,UAAY,GACZC,UAAY,GACZC,UAAY,GACZC,UAAY,GACZC,UAAY,GACZC,UAAY,GACZC,UAAY,GACZC,UAAY,GACZC,UAAY,GACZC,UAAY,GACZC,cAAgB,GAChBC,cAAgB,GAChBC,WAAa,GACbC,iBAAmB,GACnBC,kBAAoB,GACpBC,OAAS,GACThF,MAAQ,GACRiF,MAAQ,GACRtE,MAAQ,GACRR,MAAQ,GACRL,MAAQ,GACRoF,MAAQ,GACR3D,MAAQ,GACR4D,MAAQ,GACRzD,MAAQ,GACRF,MAAQ,GACR4D,MAAQ,GACRhG,MAAQ,GACRiG,MAAQ,GACR/F,MAAQ,GACRsC,MAAQ,GACRE,MAAQ,GACRrC,MAAQ,GACR6F,MAAQ,GACRpG,MAAQ,GACR8C,MAAQ,GACRuD,MAAQ,GACRC,MAAQ,GACR7F,MAAQ,GACRa,MAAQ,GACRiF,MAAQ,GACRnF,MAAQ,GACRoF,SAAW,GACXC,iBAAmB,GACnBC,UAAY,GACZC,aAAe,GACfC,aAAe,GACfC,aAAe,GACfC,aAAe,GACfC,aAAe,IACfC,aAAe,IACfC,aAAe,IACfC,aAAe,IACfC,aAAe,IACfC,aAAe,IACfC,aAAe,IACfC,QAAU,IACVC,cAAgB,IAChBC,aAAe,IACfC,YAAc,IACdC,WAAa,IACbC,OAAS,IACTC,OAAS,IACTC,OAAS,IACTC,OAAS,IACTC,OAAS,IACTC,OAAS,IACTC,OAAS,IACTC,OAAS,IACTC,OAAS,IACTC,QAAU,IACVC,QAAU,IACVC,QAAU,IACVC,QAAU,IACVC,QAAU,IACVC,QAAU,IACVC,QAAU,IACVC,QAAU,IACVC,QAAU,IACVC,QAAU,IACVC,QAAU,IACVC,QAAU,IACVC,QAAU,IACVC,QAAU,IACVC,QAAU,IACVC,aAAe,IACfC,gBAAkB,IAClBC,qBAAuB,IACvBC,uBAAyB,IACzBC,uBAAyB,IACzBC,oBAAsB,IACtBC,oBAAsB,IACtBC,eAAiB,IACjBC,gBAAkB,IAClBC,iBAAmB,IACnBC,SAAW,IACXC,WAAa,IACbC,YAAc,IACdC,cAAgB,IAChBC,eAAiB,IACjBC,eAAiB,IACjBC,gBAAkB,IAClBC,aAAe,IACfC,SAAW,IACXC,SAAW,IACXC,iBAAmB,IACnBC,uBAAyB,IACzBC,wBAA0B,IAC1BC,UAAY,IACZC,gBAAkB,IAClBC,gBAAkB,IAClBC,cAAgB,IAChBC,gBAAkB,IAClBC,aAAe,IACfC,UAAY,IACZC,UAAY,IACZC,WAAa,IACbC,UAAY,IACZC,eAAiB,IACjBC,iBAAmB,IACnBC,eAAiB,IACjBC,kBAAoB,IACpBC,UAAY,IACZC,WAAa,IACbC,UAAY,IACZC,iBAAmB,IACnBC,eAAiB,IACjBC,kBAAoB,IACpBC,kBAAoB,IACpBC,iBAAmB,IACnBC,gBAAkB,IAClBC,gBAAkB,IAClBC,gBAAkB,IAClBC,mBAAqB,IACrBC,kBAAoB,IACpBC,iBAAmB,IACnBC,mBAAqB,IACrBC,iBAAmB,IACnBC,iBAAmB,IACnBC,iBAAmB,IACnBC,oBAAsB,IACtBC,SAAW,IACXC,UAAY,IACZC,UAAY,IACZC,UAAY,IACZC,SAAW,IACXC,SAAW,IACXC,QAAU,IACVC,kBAAoB,K,8rDC1JlB,MAAM9+C,sBAAsB6C,8CAIvCtE,YAAY7Z,MACRse,MAAMte,MADQ,qCAHP,KAGO,yCAFH,K,4UAIX,CAAAoB,KAAA,SAAgB,CACZ,CAACqqB,2DAAmB,IAAI4uC,6DAAer6D,MACvC,CAAC0rB,2DAAmB,IAAI4uC,8DAAgBt6D,MACxC,CAAC2rB,uDAAe,IAAI4uC,0DAAYv6D,MAChC,CAAC4rB,2DAAmB,IAAI4uC,8DAAgBx6D,MACxC,CAAC6rB,gEAAwB,IAAI4uC,kEAAoBz6D,MACjD,CAAC8rB,wDAAgB,IAAI4uC,2DAAa16D,MAClC,CAAC+rB,2DAAmB,IAAI4uC,6DAAe36D,MACvC,CAACgsB,2DAAmB,IAAI4uC,8DAAgB56D,MACxC,CAACisB,6DAAqB,IAAI4uC,mEAAoB76D,MAC9C,CAACksB,2DAAmB,IAAI4uC,+DAAgB96D,MACxC,CAACmsB,2DAAmB,IAAI4uC,6DAAc/6D,MACtC,CAACosB,yDAAiB,IAAI4uC,kEAAmBh7D,MACzC,CAACsrB,sDAAc,IAAI2vC,0DAAWj7D,MAC9B,CAACqsB,yDAAiB,IAAI6uC,6DAAcl7D,QAExCoB,KAAK+5D,UAAU1vC,2DAGnB,iBACI,OAAO,sBAAArqB,KAAA,cAAkB,sBAAAA,KAAA,cAAkB6B,OAAS,GAAGwW,KAG3D,gBACI,OAAO,sBAAArY,KAAA,cAAkB,sBAAAA,KAAA,cAAkB6B,OAAS,GAAGX,IAG3D,aACI,OAAO,sBAAAlB,KAAA,UAAcA,KAAKg6D,YAG9BD,UAAUC,WAAY94D,IAAM,IACxB,KAAO,sBAAAlB,KAAA,cAAkB6B,OAAS,GAC9B7B,KAAK0sC,OAAOutB,QAAQ/4D,KACpB,sBAAAlB,KAAA,cAAkBoG,MAGtB,sBAAApG,KAAA,cAAkB2G,KAAK,CACnB0R,KAAM2hD,WACN94D,MAEJlB,KAAK0sC,OAAOwtB,QAAQl6D,KAAKm6D,WAG7BC,cAAcJ,WAAY94D,IAAM,IAC5BlB,KAAK0sC,OAAOutB,QAAQ/4D,KACpB,sBAAAlB,KAAA,cAAkBoG,MAClB,sBAAApG,KAAA,cAAkB2G,KAAK,CACnB0R,KAAM2hD,WACN94D,MAEJlB,KAAK0sC,OAAOwtB,QAAQl6D,KAAKm6D,WAG7BlwC,WAAW+vC,WAAY94D,IAAM,IACzBlB,KAAK0sC,OAAOutB,QAAQ/4D,KACpB,sBAAAlB,KAAA,cAAkB2G,KAAK,CACnB0R,KAAM2hD,WACN94D,MAEJlB,KAAK0sC,OAAOwtB,QAAQl6D,KAAKm6D,WAG7BE,UAAUn5D,IAAM,IACZlB,KAAK0sC,OAAOutB,QAAQ/4D,KACpB,sBAAAlB,KAAA,cAAkBoG,MAClBpG,KAAK0sC,OAAOwtB,QAAQl6D,KAAKm6D,WAG7Bz9C,OAAOD,IACHzc,KAAK0sC,OAAO4tB,SAAS79C,O,wsBCrDd,MAAMy8C,wBAAwBqB,6CACzCL,UACIl6D,KAAKpB,KAAKmb,SAAS0wC,WAAWU,4EAC9BnrD,KAAKpB,KAAKkc,UAAU0/C,aAEpB,MAAMhiC,SAAWx4B,KAAKpB,KAAKib,OAAO2e,SAElCx4B,KAAKpB,KAAK6a,OAAOghD,SAASjiC,SAASxjB,EAAGwjB,SAASvjB,GAGnDglD,UACIj6D,KAAKpB,KAAKmb,SAAS6wC,UAAUO,4EAGjCuP,iBAAiBzoB,KACb,MAAMvS,OAAQsR,iEAAeiB,KACvB0oB,eAAiB36D,KAAKpB,KAAKib,OAAO2e,SAClCoiC,eAAiB,CACnB5lD,EAAG2lD,eAAe3lD,EAAI0qB,MAAM1qB,EAC5BC,EAAG0lD,eAAe1lD,EAAIyqB,MAAMzqB,GAE1BmU,SAAWppB,KAAKpB,KAAKkB,IAAI6oD,cAC3BiS,eAAe5lD,EACf4lD,eAAe3lD,GAGb4lD,gBAAkBzxC,SAAShI,QAAQne,GACrCjD,KAAKpB,KAAK+a,SAASmhD,mBAAmB73D,EAAGjD,KAAKpB,KAAKib,OAAO4P,UAG9D,GAAIoxC,gBAAgBh5D,OAAS,EACzB7B,KAAKpB,KAAKib,OAAOkhD,MAAMF,gBAAgB,QACpC,CACH,MAAMG,WAAa5xC,SAAS4b,MAAM/hC,GAAMA,EAAE+vB,IAAI6P,qDAE1Cm4B,aAAeA,WAAWnrB,KAAK/M,OAC/Bk4B,WAAWjxC,UAAU,gBAAiB,CAClCwO,WAAYv4B,KAAKpB,KAAKib,OAAO4P,SAGjCzpB,KAAKpB,KAAKib,OAAOohD,KAAKhpB,MAKlCipB,kBACI,MAAM1iC,SAAWx4B,KAAKpB,KAAKib,OAAO2e,SAG5B2iC,SAFWn7D,KAAKpB,KAAKkB,IAAI6oD,cAAcnwB,SAASxjB,EAAGwjB,SAASvjB,GAExC+vB,MAAMvb,QAAWA,OAAOuJ,IAAI8Q,qDAElDq3B,SACAA,SAASpxC,UAAU,cAAe,CAC9BwO,WAAYv4B,KAAKpB,KAAKib,OAAO4P,SAGjCjjB,QAAQ+2B,IAAI,qCAIpB69B,WAAWpmD,EAAGC,GACV,MAIMomD,MAJWr7D,KAAKpB,KAAKkB,IACtB6oD,cAAc3zC,EAAGC,GACjBmM,QAAQne,IAAOA,EAAE+mB,WAEC5I,QAAQqI,QACfA,OAAOM,UAAU,mBAAoB,CAC7CwO,WAAYv4B,KAAKpB,KAAKib,OAAO4P,OAC7BoP,aAAc,KAGP/lB,KAAK+lB,aAAah3B,OAAS,IAGtCw5D,MAAMx5D,QAAU,IAIA,GAAhBw5D,MAAMx5D,QAQVw5D,MAAM/xC,MAAK,CAACjF,EAAGD,IAAOC,EAAEjB,MAAMlO,EAAIkP,EAAEhB,MAAMlO,EAAI,GAAK,IAEnDtW,KAAKqb,QAAQgQ,WAAWY,4DAAoB,CACxC+rB,OAAQ,SACRE,SAAU,6BACVpiB,KAAM2mC,MACNtkB,YAAa,CAACzV,KAAMtsB,EAAGC,EAAG+hC,cACtB,MAAMt4B,KAAO,IAAH,OAAO4iB,KAAKgG,QAAQtqB,SAE9Bhd,KAAKpB,KAAKqa,SAAS+E,KACfhJ,EAAI,EACJC,EACAqsB,KAAKle,MAAMnF,KACXqjB,KAAKle,MAAMO,QACX2d,KAAKle,MAAMS,UACXyd,KAAKle,MAAM4kC,YAGXhR,YACAh3C,KAAKpB,KAAKqa,SAAS4F,SAAS7J,EAAGC,EAAG,IAAK,UACvCjV,KAAKpB,KAAKqa,SAAS4F,SAAS7J,EAAI,EAAGC,EAAGyJ,KAAM,YAE5C1e,KAAKpB,KAAKqa,SAAS4F,SAAS7J,EAAGC,EAAG,KAClCjV,KAAKpB,KAAKqa,SAAS4F,SAAS7J,EAAI,EAAGC,EAAGyJ,QAG9Cu4B,SAAW3V,OACPthC,KAAKpB,KAAKqb,QAAQmgD,cAAc3vC,+DAAuB,CACnD8N,WAAYv4B,KAAKpB,KAAKib,OAAO4P,OAC7B6xC,aAAch6B,WApCtBthC,KAAKpB,KAAKqb,QAAQgQ,WAAWQ,+DAAuB,CAChD8N,WAAYv4B,KAAKpB,KAAKib,OAAO4P,OAC7B6xC,aAAcD,MAAM,MAwChCE,oBAAoBtpB,KAChB,MAAMvS,OAAQsR,iEAAeiB,KACvB0oB,eAAiB36D,KAAKpB,KAAKib,OAAO2e,SAClCoiC,eAAiB,CACnB5lD,EAAG2lD,eAAe3lD,EAAI0qB,MAAM1qB,EAC5BC,EAAG0lD,eAAe1lD,EAAIyqB,MAAMzqB,GAGhCjV,KAAKo7D,WAAWR,eAAe5lD,EAAG4lD,eAAe3lD,GAGrDumD,cACI,MAAMpR,IAAMpqD,KAAKpB,KAAKmb,SAASwwC,iBAE/B,GAAKH,IAAL,CAuBA,GAnBIA,IAAI/xC,OAASwzC,qEACb7rD,KAAKpB,KAAKiE,MAAM44D,WAEhBrR,IAAI/xC,OAAS0zC,qEACb/rD,KAAKpB,KAAKiE,MAAM64D,WAEhBtR,IAAI/xC,OAAS41C,qEACbrvD,KAAKqb,QAAQgQ,WAAWS,uDAAe,CACnCixC,UAAU,EACVC,aAAa,EACbC,iBAAiB,EACjB5iD,UAAUksC,0FACVrd,SAAU,IAAMlpC,KAAKqb,QAAQogD,YAC7BpyB,SAAU,IAAMrpC,KAAKqb,QAAQogD,cAGjCjQ,IAAI/xC,OAAS61C,wEACbluD,KAAKk7D,kBAEL9Q,IAAI/xC,OAAS21C,wEAAoB,CACjC,MAAMj5C,IAAM/U,KAAKpB,KAAKib,OAAO2e,SAE7Bx4B,KAAKo7D,WAAWrmD,IAAIC,EAAGD,IAAIE,GAE3Bm1C,IAAI/xC,OAASg2C,0EACbruD,KAAKpB,KAAKqb,QAAQgQ,WAAWO,0DAAkB,CAC3Ckb,WAAY1lC,KAAKpB,KAAKib,OAAO4P,OAC7BoI,SAAU7xB,KAAKpB,KAAKib,OAAO4P,SAG/B2gC,IAAI/xC,OAASs2C,0EACb3uD,KAAKpB,KAAKqb,QAAQgQ,WAAWc,0DAAkB,CAC3Ce,UAAW9rB,KAAKpB,KAAKib,OAAO4P,SAGhC2gC,IAAI/xC,OAASk2C,0EACbvuD,KAAKpB,KAAKqb,QAAQgQ,WAAWW,0DAAkB,CAC3CiH,SAAU7xB,KAAKpB,KAAKib,OAAO4P,SAG/B2gC,IAAI/xC,OAASo2C,0EACbzuD,KAAKpB,KAAKqb,QAAQgQ,WAAWa,0DAAkB,CAC3CgB,UAAW9rB,KAAKpB,KAAKib,OAAO4P,SAGhC2gC,IAAI/xC,OAASszC,uEACb3rD,KAAKpB,KAAKqb,QAAQ8/C,UAAU1vC,2DAE5B+/B,IAAI/xC,OAAS8zC,qEACbnsD,KAAKpB,KAAKib,OAAOiiD,OAEjB1R,IAAI/xC,OAAS+zC,wEACbpsD,KAAK06D,iBAAiBrpB,uDAEtB+Y,IAAI/xC,OAASi0C,uEACbtsD,KAAK06D,iBAAiBppB,sDAEtB8Y,IAAI/xC,OAASo0C,wEACbzsD,KAAK06D,iBAAiBnpB,uDAEtB6Y,IAAI/xC,OAASs0C,uEACb3sD,KAAK06D,iBAAiBlpB,sDAEtB4Y,IAAI/xC,OAASy0C,uEACb9sD,KAAK06D,iBAAiBhpB,sDAEtB0Y,IAAI/xC,OAAS40C,wEACbjtD,KAAK06D,iBAAiB/oB,uDAEtByY,IAAI/xC,OAAS80C,uEACbntD,KAAK06D,iBAAiB9oB,sDAEtBwY,IAAI/xC,OAASi1C,wEACbttD,KAAK06D,iBAAiB7oB,uDAEtBuY,IAAI/xC,OAASm1C,0EACbxtD,KAAKu7D,oBAAoBlqB,uDAEzB+Y,IAAI/xC,OAASo1C,yEACbztD,KAAKu7D,oBAAoBjqB,sDAEzB8Y,IAAI/xC,OAASq1C,0EACb1tD,KAAKu7D,oBAAoBhqB,uDAEzB6Y,IAAI/xC,OAASs1C,yEACb3tD,KAAKu7D,oBAAoB/pB,sDAEzB4Y,IAAI/xC,OAASu1C,yEACb5tD,KAAKu7D,oBAAoB7pB,sDAEzB0Y,IAAI/xC,OAASw1C,0EACb7tD,KAAKu7D,oBAAoB5pB,uDAEzByY,IAAI/xC,OAASy1C,yEACb9tD,KAAKu7D,oBAAoB3pB,sDAEzBwY,IAAI/xC,OAAS01C,0EACb/tD,KAAKu7D,oBAAoB1pB,wDAIjCyoB,SAAS79C,IACLzc,KAAKw7D,cACLx7D,KAAKpB,KAAK4d,uBAAuBC,O,kNCzS1B,MAAM89C,OAGjB,WACI,O,gOAAA,CAAOv6D,KAAP,OAGJyY,YAAY7Z,MAAM,2C,4UACd,CAAAoB,KAAA,MAAapB,MAGjBs7D,WAEAD,WAEAK,SAAS79C,Q,knBCCE,MAAMw8C,uBAAuBsB,6CACxCL,UACIl6D,KAAKpB,KAAKmb,SAAS0wC,WAAWS,4EAEzBlrD,KAAKpB,KAAKiE,MAAMk5D,WACjB/7D,KAAKpB,KAAK+Z,MAAMrS,KAAK,cAI7B2zD,UACIj6D,KAAKpB,KAAKmb,SAAS6wC,UAAUM,4EAGjC1G,YACQxkD,KAAKpB,KAAKiE,MAAMk5D,UAChB/7D,KAAKpB,KAAKqb,QAAQ8/C,UAAUzvC,2DAE5BtqB,KAAKpB,KAAKiE,MAAMm5D,UAIxBC,eACI,MAAM7R,IAAMpqD,KAAKpB,KAAKmb,SAASwwC,iBAE1BH,MAIDA,IAAI/xC,OAASmzC,wEACbxrD,KAAKwkD,YAGL4F,IAAI/xC,OAASwzC,qEACb7rD,KAAKpB,KAAKiE,MAAM44D,WAGhBrR,IAAI/xC,OAAS0zC,qEACb/rD,KAAKpB,KAAKiE,MAAM64D,WAGhBtR,IAAI/xC,OAAS4zC,yEACbjsD,KAAKpB,KAAKiE,MAAMm5D,WAIxB1B,SAAS79C,IACLzc,KAAKi8D,eACLj8D,KAAKpB,KAAKqa,SAASsG,QACnBvf,KAAKpB,KAAKqa,SAAS+E,KAAK,EAAG,EAAG,IAAK,UAAW,WAC9Che,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,EAA/B,kBAAqD,WAErD,IAAK,IAAIjd,EAAI,EAAGA,EAAI5B,KAAKpB,KAAK6a,OAAO8D,MAAQ,EAAG3b,IAClC,IAANA,EACA5B,KAAKpB,KAAKqa,SAASsF,OACf3c,EACA,EACAs6D,oEACAC,+DACAC,gEAEGx6D,IAAM5B,KAAKpB,KAAK6a,OAAO8D,MAAQ,EACtCvd,KAAKpB,KAAKqa,SAASsF,OACf3c,EACA,EACAy6D,oEACAF,+DACAC,gEAGJp8D,KAAKpB,KAAKqa,SAASsF,OACf3c,EACA,EACA06D,+DACAH,+DACAC,gEAKZp8D,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,EAA/B,cACA7e,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,EAA/B,cACA7e,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,EAA/B,cACA7e,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,EAA/B,cACA7e,KAAKpB,KAAKqa,SAAS4F,SACf,EACA,GAFJ,4CAMA7e,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,GAA/B,cACA7e,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,GAA/B,mBACA7e,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,GAA/B,0BACA7e,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,GAA/B,mBACA7e,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,GAA/B,mBACA7e,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,GAA/B,qBACA7e,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,GAA/B,kBAEA7e,KAAKpB,KAAKqa,SAASqG,eAAe,GAAlC,8BACAtf,KAAKpB,KAAKqa,SAASqG,eAAe,GAAlC,gBAAuD,c,qlBClHxD,MAAMi9C,mBAAqB,IACrBD,kBAAoB,IACpBE,mBAAqB,IACrBC,kBAAoB,IACpBC,kBAAoB,IACpBC,mBAAqB,IACrBC,kBAAoB,IACpBC,mBAAqB,IACrBR,uBAAyB,IACzBH,uBAAyB,K,waCK/B,MAAMC,cAAgB,UAChBC,cAAgB,UAEhBU,UAAY,CAAC9nD,EAAGC,EAAGsI,MAAOC,UACnC5e,gEAAwBoW,EAAGC,EAAGsI,MAAQ,EAAGC,OAAS,GAElD,IAAK,IAAI5b,EAAIoT,EAAGpT,EAAIoT,EAAIuI,MAAO3b,IAC3BhD,6DACIgD,EACAqT,EACAqnD,+DACAH,cACAC,eAEJx9D,6DACIgD,EACAqT,EAAIuI,OACJo/C,+DACAT,cACAC,eAIR,IAAK,IAAIx6D,EAAIqT,EAAGrT,EAAIqT,EAAIuI,OAAQ5b,IAC5BhD,6DACIoW,EACApT,EACA66D,+DACAN,cACAC,eAEJx9D,6DACIoW,EAAIuI,MACJ3b,EACA86D,+DACAP,cACAC,eAIRx9D,6DACIoW,EACAC,EACAsnD,gEACAJ,cACAC,eAEJx9D,6DACIoW,EAAIuI,MACJtI,EACAunD,gEACAL,cACAC,eAEJx9D,6DACIoW,EACAC,EAAIuI,OACJm/C,gEACAR,cACAC,eAEJx9D,6DACIoW,EAAIuI,MACJtI,EAAIuI,OACJq/C,gEACAV,cACAC,gBAIKW,aAAe,CAAC/nD,EAAGC,EAAGsI,MAAOC,OAAQw/C,MAAOnmB,QACrDimB,UAAU9nD,EAAGC,EAAGsI,MAAOC,QAEvB,MAAMy/C,UAAYpmB,KAAO,IAAH,OAAOmmB,OAAUA,MACjCE,WAAa/wD,KAAKwG,KAAK/T,uEAA+Bq+D,YAEtDE,YAAcnoD,EAAI,EAClBooD,UAAYvmB,KAAO,EAAI,EAE7Bj4C,6DACIu+D,YAAc,EACdloD,EACAonD,oEACAF,cACAC,eAEJx9D,6DACIu+D,YAAcC,UAAYF,WAC1BjoD,EACAinD,oEACAC,cACAC,eAGAvlB,MACAj4C,2DACIu+D,YACAloD,EACA4hC,KAAK54B,KACL44B,KAAKlzB,QACLkzB,KAAKhzB,UACLgzB,KAAKmR,YAIbppD,+DAAuBu+D,YAAcC,UAAWnoD,EAAGgoD,a,+dClHxC,MAAM9D,oBAAoBoB,6CACrCL,UACIl6D,KAAKpB,KAAKiE,MAAMw6D,WAChBr9D,KAAKpB,KAAKmb,SAAS0wC,WAAWS,4EAGlC+O,UACIj6D,KAAKpB,KAAKmb,SAAS6wC,UAAUM,4EAGjCsQ,cACI,MAAMpR,IAAMpqD,KAAKpB,KAAKmb,SAASwwC,iBAE1BH,KAIDA,IAAI/xC,OAASmzC,wEACbxrD,KAAKpB,KAAKqb,QAAQ8/C,UAAU1vC,2DAIpCiwC,SAAS79C,IACLzc,KAAKw7D,cACLx7D,KAAKpB,KAAKmc,aAAa2B,OAAOD,IAI9Bzc,KAAKpB,KAAKqa,SAASqG,eAAe,GAFrB,mCAE+B,UAAW,c,qsCCtBhD,MAAM85C,wBAAwBmB,6CAAO,qB,kBAAA,+G,IAAA,K,IAAA,O,MAGzC,IAAI+C,2D,2GAEXpD,QAAQh5D,KACJlB,KAAKpB,KAAKmb,SAAS0wC,WAAWS,4EAC9B,sBAAAlrD,KAAA,YAAmBkB,IAAIwkC,YACvB,sBAAA1lC,KAAA,UAAiBkB,IAAI2wB,UACrB7xB,KAAK00B,KAAK6oC,SAAS,sBAAAv9D,KAAA,aAAiBokC,UAAU9M,SAGlD2iC,UACIj6D,KAAKpB,KAAKmb,SAAS6wC,UAAUM,4EAGjCsS,aACI,MAAMlC,aAAet7D,KAAK00B,KAAK+oC,SAE3BnC,cACAt7D,KAAKpB,KAAKqb,QAAQgQ,WAAWQ,+DAAuB,CAChD6wC,aACA/iC,WAAY,sBAAAv4B,KAAF,aAKtBw7D,cACI,MAAMpR,IAAMpqD,KAAKpB,KAAKmb,SAASwwC,iBAE1BH,MAIDA,IAAI/xC,OAASszC,uEACb3rD,KAAKpB,KAAKqb,QAAQogD,YAGlBjQ,IAAI/xC,OAASi0C,uEACbtsD,KAAK00B,KAAKgpC,KAGVtT,IAAI/xC,OAAS80C,uEACbntD,KAAK00B,KAAKipC,OAGVvT,IAAI/xC,OAASmzC,wEACbxrD,KAAKw9D,cAIblD,SAAS79C,IACLzc,KAAKw7D,cACLx7D,KAAKpB,KAAKqa,SAASsG,QACnBvf,KAAKpB,KAAKqa,SAASqG,eACf,EADJ,YAES,sBAAAtf,KAAA,aAAiBsnC,QAAQtqB,QAFlC,gBAGI,UAG2B,IAA3Bhd,KAAK00B,KAAK2mC,MAAMx5D,QAChB7B,KAAKpB,KAAKqa,SAASqG,eAAe,EAAG,0BAGzCtf,KAAK00B,KAAK5hB,KAAKS,SAAQ,EAAG+tB,KAAMzf,IAAKm1B,eACjC,MAAM4mB,KAAO/7C,IAAM,EAEfm1B,WACAh3C,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG++C,KAAM,IAAK,UAE1C59D,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG++C,KAAM,KAGzC59D,KAAKpB,KAAKqa,SAAS+E,KACf,EACA4/C,KACAt8B,KAAKle,MAAMnF,KACXqjB,KAAKle,MAAMO,QACX2d,KAAKle,MAAMS,UACXyd,KAAKle,MAAM4kC,YAGf,MAAM6V,QAAU79D,KAAKpB,KAAKqa,SAASwF,iBAC/B6iB,KAAKgG,QAAQtqB,SAKjB,GAFAhd,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG++C,KAAMt8B,KAAKgG,QAAQtqB,SAE9CskB,KAAK6V,WAAY,CACjB,MAAMf,KAAO9U,KAAK6V,WAAWf,KAAK/4B,KAElCrd,KAAKpB,KAAKqa,SAAS4F,SACf,EAAIg/C,QAAU,GACdD,KAFJ,WAGQxnB,KAHR,KAII,eAKZp2C,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,EAAG,mB,kWC/G3B,MAAMy+C,eAIjB,eACI,OAAOt9D,KAAK89D,OAAO99D,KAAK+9D,MAG5B,YACI,OAAO/9D,KAAK89D,OAGhB,WACI,OAAO99D,KAAK89D,OAAOh+D,KAAI,CAACwhC,KAAMzf,OAAP,CACnByf,KACAzf,IACAm1B,WAAYn1B,MAAQ7hB,KAAK+9D,SAIjC,cACI,OAAO/9D,KAAK89D,OAAOj8D,QAAU,EAGjC,aACI,OAAO7B,KAAK89D,OAAOj8D,OAGvB4W,YAAY4iD,MAAQ,GAAIx5C,IAAM,GAAG,8BA3BxB,IA2BwB,4BA1B1B,GA2BH7hB,KAAK+9D,KAAOl8C,IACZ7hB,KAAKu9D,SAASlC,OAGlBkC,SAASlC,MAAQ,IACbr7D,KAAK89D,OAASzC,MACdr7D,KAAK+9D,KAAO5xD,KAAK2C,IAAI3C,KAAKC,IAAIpM,KAAK+9D,KAAM,GAAI/9D,KAAK89D,OAAOj8D,OAAS,GAGtE67D,KACI19D,KAAK+9D,OAED/9D,KAAK+9D,KAAO,IACZ/9D,KAAK+9D,KAAO/9D,KAAK89D,OAAOj8D,OAAS,GAIzC87D,OACI39D,KAAK+9D,OAED/9D,KAAK+9D,MAAQ/9D,KAAK89D,OAAOj8D,SACzB7B,KAAK+9D,KAAO,M,+zCCtCT,MAAM1E,4BAA4BkB,6CAAO,qB,kBAAA,kDAC3C,KAD2C,oCAE1C,KAF0C,oG,IAAA,K,IAAA,O,MAK7C,IAAI+C,2D,2GAEX,WACI,OAAOnxD,KAAK41B,OAAO/hC,KAAKpB,KAAK6a,OAAO8D,MAAjB,sBAAyBvd,KAAzB,SAAwC,GAG/D,UACI,OAAOmM,KAAK41B,OAAO/hC,KAAKpB,KAAK6a,OAAO+D,OAAjB,sBAA0Bxd,KAA1B,UAA0C,GAGjEk6D,QAAQh5D,KACJlB,KAAKpB,KAAKmb,SAAS0wC,WAAWS,4EAC9B,sBAAAlrD,KAAA,cAAqBkB,IAAIo6D,cACzB,sBAAAt7D,KAAA,YAAmBkB,IAAIq3B,YAEvBv4B,KAAKg+D,cAGTA,cACI,MAAMv2C,IAAM,sBAAAznB,KAAA,eAAmB+pB,UAAU,mBAAoB,CACzDwO,WAAY,sBAAAv4B,KAAF,aACV64B,aAAc,KAGlB74B,KAAK00B,KAAK6oC,SAAS,IACZ91C,IAAI3U,KAAK+lB,aACZ,CACIxb,KAAM,OACN4gD,QAAQ,KAKpBhE,UACIj6D,KAAKpB,KAAKmb,SAAS6wC,UAAUM,4EAGjCsS,aACI,MAAMU,YAAcl+D,KAAK00B,KAAK+oC,SAE1BS,YAAYD,OACZj+D,KAAKpB,KAAKqb,QAAQogD,aAItB,sBAAAr6D,KAAA,eAAmB+pB,UAAUm0C,YAAYz2C,IAAK,CAC1C8Q,WAAY,sBAAAv4B,KAAF,eAGV,sBAAAA,KAAA,eAAmBg/B,YACnBh/B,KAAKpB,KAAKqb,QAAQogD,YAKtBr6D,KAAKg+D,eAGTxC,cACI,MAAMpR,IAAMpqD,KAAKpB,KAAKmb,SAASwwC,iBAE1BH,MAIDA,IAAI/xC,OAASszC,uEACb3rD,KAAKpB,KAAKqb,QAAQogD,YAGlBjQ,IAAI/xC,OAASi0C,uEACbtsD,KAAK00B,KAAKgpC,KAGVtT,IAAI/xC,OAAS80C,uEACbntD,KAAK00B,KAAKipC,OAGVvT,IAAI/xC,OAASmzC,wEACbxrD,KAAKw9D,cAIblD,SAAS79C,IACLzc,KAAKw7D,eAELuB,iEACI/8D,KAAK8e,KACL9e,KAAKm+D,IAFG,sBAGRn+D,KAHQ,8BAIRA,KAJQ,SAKR,sBAAAA,KAAA,eAAmBsnC,QAAQtqB,QAC3B,sBAAAhd,KAAA,eAAmBojB,OAGvB,IAAIg7C,YAAc,EAClB,MAAMC,KAAOr+D,KAAK8e,KAAO,EAEzB,GAAI,sBAAA9e,KAAA,eAAmB26C,OAAQ,CAC3B,MAAM2jB,UAAY,sBAAAt+D,KAAA,eAAmB26C,OAAOM,oBAA1B,sBACdj7C,KADc,cAIlBA,KAAKpB,KAAKqa,SAAS4F,SACfw/C,KACAr+D,KAAKm+D,IAAMC,YACXE,WAGJF,aAAe,EAGnB,MAAMx0B,WAAYK,wEAA2B,sBAAAjqC,KAAD,gBAC5C,IAAIu+D,QAAS,EAEbrtD,OAAOD,KAAK24B,WAAWr2B,SAASs2B,QAC5B,MAAM7C,SAAW4C,UAAUC,OAE3B,GAAiB,IAAb7C,SACA,OAGJu3B,QAAS,EAET,MAAMlhD,MAAOisB,0DAAaO,OACpB+zB,KAAO59D,KAAKm+D,IAAMC,YAExBp+D,KAAKpB,KAAKqa,SAAS4F,SAASw/C,KAAMT,KAAMvgD,MACxC,MAAMxO,IAAM7O,KAAKpB,KAAKqa,SAASwF,iBAAiBpB,MAE5C2pB,SAAW,EACXhnC,KAAKpB,KAAKqa,SAAS4F,SACfw/C,KAAOxvD,IACP+uD,KAFJ,YAGS52B,UACL,SAGJhnC,KAAKpB,KAAKqa,SAAS4F,SACfw/C,KAAOxvD,IACP+uD,KAFJ,YAGS52B,UACL,OAIRo3B,iBAGAG,QACAH,cAGJp+D,KAAK00B,KAAK5hB,KAAKS,SAAQ,EAAG+tB,KAAMzf,IAAKm1B,eACjC,MAAM4mB,KAAO/7C,IAAM7hB,KAAKm+D,IAAMC,YAE1BpnB,WACAh3C,KAAKpB,KAAKqa,SAAS4F,SACfw/C,KACAT,KAFJ,YAGSt8B,KAAKjkB,MACV,UAGJrd,KAAKpB,KAAKqa,SAAS4F,SAASw/C,KAAMT,KAAlC,YAA6Ct8B,KAAKjkB,a,wzBCvJlE,MAAMmhD,KAAO,OAEE,MAAMlF,qBAAqBiB,6CAAO,6DACzC,GADyC,yBAEzC,GAFyC,mCAG/BrtD,KAH+B,6BAIrC,IAJqC,iCAKlC,GALkC,oCAM/B,GAN+B,wCAO3B,GAP2B,gCAQlCsxD,MARkC,gCASlCA,MAEXtE,QAAQh5D,KACJlB,KAAKpB,KAAKqa,SAASsG,QACnBvf,KAAKpB,KAAKkc,UAAU0/C,aAEpBx6D,KAAKlB,MAAQoC,IAAIpC,OAASkB,KAAKpB,KAAKib,OAAO2e,SAC3Cx4B,KAAK27D,SAAWz6D,IAAIy6D,WAAY,EAChC37D,KAAK47D,YAAc16D,IAAI06D,cAAe,EACtC57D,KAAK67D,gBAAkB36D,IAAI26D,kBAAmB,EAC9C77D,KAAK8nC,SAAW5mC,IAAI4mC,UAAY02B,KAChCx+D,KAAKioC,SAAW/mC,IAAI+mC,UAAYu2B,KAChCx+D,KAAKiZ,SAAW/X,IAAI+X,WAAYksC,0FAChCnlD,KAAK0W,YAAcxV,IAAIwV,aAAexJ,IAEtClN,KAAKgV,EAAIhV,KAAKlB,MAAMkW,EACpBhV,KAAKiV,EAAIjV,KAAKlB,MAAMmW,EAGxBylD,iBAAiBl9B,WACb,MAAMkC,OAAQsR,iEAAexT,WAEzBrxB,KAAKK,IAAIxM,KAAKlB,MAAMkW,GAAKhV,KAAKgV,EAAI0qB,MAAM1qB,KAAOhV,KAAK0W,cACpD1W,KAAKgV,GAAK0qB,MAAM1qB,GAEhB7I,KAAKK,IAAIxM,KAAKlB,MAAMmW,GAAKjV,KAAKiV,EAAIyqB,MAAMzqB,KAAOjV,KAAK0W,cACpD1W,KAAKiV,GAAKyqB,MAAMzqB,GAIxBuvC,YACI,MAAM/X,KAAOzsC,KAAKy+D,UAEdz+D,KAAKiZ,SAASuzB,QAAQC,OACtBzsC,KAAK8nC,SAAS2E,MAItBxE,WACIjoC,KAAKioC,WAGTuzB,cACI,MAAMpR,IAAMpqD,KAAKpB,KAAKmb,SAASwwC,iBAE1BH,MAIDA,IAAI/xC,OAASmzC,wEACbxrD,KAAKwkD,YAEL4F,IAAI/xC,OAASszC,uEACb3rD,KAAKioC,WAELmiB,IAAI/xC,OAAS+zC,wEACbpsD,KAAK06D,iBAAiBrpB,uDAEtB+Y,IAAI/xC,OAASi0C,uEACbtsD,KAAK06D,iBAAiBppB,sDAEtB8Y,IAAI/xC,OAASo0C,wEACbzsD,KAAK06D,iBAAiBnpB,uDAEtB6Y,IAAI/xC,OAASs0C,uEACb3sD,KAAK06D,iBAAiBlpB,sDAEtB4Y,IAAI/xC,OAASy0C,uEACb9sD,KAAK06D,iBAAiBhpB,sDAEtB0Y,IAAI/xC,OAAS40C,wEACbjtD,KAAK06D,iBAAiB/oB,uDAEtByY,IAAI/xC,OAAS80C,uEACbntD,KAAK06D,iBAAiB9oB,sDAEtBwY,IAAI/xC,OAASi1C,wEACbttD,KAAK06D,iBAAiB7oB,wDAI9B4sB,UACI,MAAO,CACH3/D,MAAO,CACHkW,EAAGhV,KAAKlB,MAAMkW,EACdC,EAAGjV,KAAKlB,MAAMmW,GAElBujB,SAAU,CACNxjB,EAAGhV,KAAKgV,EACRC,EAAGjV,KAAKiV,GAEZD,EAAGhV,KAAKgV,EACRC,EAAGjV,KAAKiV,EACRy3B,OAAQ1sC,KAAKpB,KAAK6a,OAAOilD,cAAc1+D,KAAKgV,EAAGhV,KAAKiV,GACpDq3B,MAAMtE,mEAAchoC,KAAKlB,MAAMkW,EAAGhV,KAAKlB,MAAMmW,EAAGjV,KAAKgV,EAAGhV,KAAKiV,IAIrEqlD,SAAS79C,IAUL,GATAzc,KAAKw7D,cACLx7D,KAAKpB,KAAK4d,uBAAuBC,IAEjCzc,KAAKiZ,SAAS4D,OAAO7c,KAAKy+D,WAEtBz+D,KAAK27D,WACLA,uDAAS37D,KAAKgV,EAAGhV,KAAKiV,GAGtBjV,KAAK47D,YAAa,CAClB,MAAM3uC,OAASjtB,KAAKpB,KAAKkB,IACpB6oD,cAAc3oD,KAAKgV,EAAGhV,KAAKiV,GAC3BmM,QAAQne,GAAMA,EAAE6qC,WAAa7qC,EAAE2tC,gBAC/BxqC,MAECyT,OAAS7Z,KAAKpB,KAAKib,OAAO4P,OAEhC,GAAIwD,OAAQ,CACR,MAAM0xC,QAAU1xC,OAAO2jB,cAAc+tB,QAC/BxV,SAAWnpD,KAAKpB,KAAK+a,SAASyvC,kBAChCvvC,OACAoT,QAGJ,IAAI2iB,KAAO5vC,KAAKpB,KAAK+a,SAASilD,WAAWzV,UAEzCnpD,KAAKpB,KAAKqa,SAASqG,eACf,EADJ,UAEOq/C,QAAQ3hD,QAFf,qBAEmC4yB,KAFnC,OAOR,GAAI5vC,KAAK67D,gBAAiB,CACtB,MAAMgD,KAAO7+D,KAAKpB,KAAKkd,YAAYkkC,eAAehgD,KAAKgV,EAAGhV,KAAKiV,GACzD6pD,KAAe,EAAPD,KAAY,EAAI,GAE9B7+D,KAAKpB,KAAKqa,SAAS4F,SACf7e,KAAKpB,KAAK6a,OAAO8D,MAAQ,GACzBvd,KAAKpB,KAAK6a,OAAO+D,OAAS,EAF9B,UAGOrR,KAAKyD,MAAMkvD,MAHlB,eAG8B3yD,KAAKyD,MAAMivD,MAHzC,Y,kQC9KL,MAAMlD,SAAW,CAAC3mD,EAAGC,KACxB,MAAMmU,SAAWxqB,+DACEoW,EAAGC,GACjBmM,QAAQne,GAAMA,EAAEqkC,SAAWrkC,EAAE6qC,YAC5BpB,OAAS9tC,kEAA0BoW,EAAGC,GAExCy3B,OAAO13B,EAAIpW,0DAAoB,EAC/BwqB,SAAS7V,SAAQ,CAACkW,OAAQ7nB,KACtB,MAAMyf,EAAU,IAANzf,EAAU,IAAM,IAC1BhD,+DAAuB8tC,OAAO13B,EAAI,EAAG03B,OAAOz3B,EAAIrT,EAAhD,UAAsDyf,EAAtD,KAA4D,QAC5DziB,+DACI8tC,OAAO13B,EAAI,EACX03B,OAAOz3B,EAAIrT,EACX6nB,OAAO6d,QAAQtqB,QAAU,IACzB,UACA,QACA,WAIRoM,SAAS7V,SAAQ,CAACkW,OAAQ7nB,KACtB,MAAMyf,EAAU,IAANzf,EAAU,IAAM,IAC1BhD,+DAAuB8tC,OAAO13B,EAAI,EAAG03B,OAAOz3B,EAAIrT,EAAhD,WAAuDyf,GAAK,QAC5D,MAAMxS,IAAMjQ,uEAA+B6qB,OAAO6d,QAAQtqB,SAC1Dpe,+DACI8tC,OAAO13B,EAAInG,IAAM,IACjB69B,OAAOz3B,EAAIrT,EACX,IAAM6nB,OAAO6d,QAAQtqB,QACrB,UACA,QACA,a,89BC7BD,MAAMu8C,uBAAuBgB,6CAAO,qIAI/CL,QAAQh5D,KAMJ,GALA,sBAAAlB,KAAA,aAAoBkB,IAAI69D,aACxB,sBAAA/+D,KAAA,UAAiBkB,IAAI89D,UAErBh/D,KAAKi/D,oBAED/9D,IAAI69D,YAAa,CACjB,MAAMjsD,KAAO9S,KAAKpB,KAAKiE,MAAM44D,WAO7B,OALA3oD,KAAKsG,MAAM8lD,OAASh+D,IAAI89D,SAASrzD,GACjCmH,KAAKhT,IAAI66D,eAAiBz5D,IAAIi+D,WAE9Bn/D,KAAKpB,KAAKiE,MAAMu8D,aAAatsD,MAKjC9S,KAAKpB,KAAKwa,MAAMimD,aAAan+D,IAAI89D,SAAU99D,IAAIi+D,OAC/Cn/D,KAAKpB,KAAKkB,IAAIu/D,aAAan+D,IAAI89D,SAAU99D,IAAIi+D,OAC7Cn/D,KAAKpB,KAAK+Z,MAAM0mD,aAAan+D,IAAI89D,SAAU99D,IAAIi+D,OAC/Cn/D,KAAKpB,KAAKkd,YAAYujD,aAAan+D,IAAI89D,SAAU99D,IAAIi+D,OAErDn/D,KAAKpB,KAAKqb,QAAQ8/C,UAAUzvC,2DAGhC20C,oBAEI,GADAj/D,KAAKpB,KAAKqa,SAASsG,QACnB,sBAAIvf,KAAJ,cAAuB,CACnB,MAAMs/D,SAAW,wBAAH,OAA2B,sBAAAt/D,KAAA,cAAkB2L,IAC3D3L,KAAKpB,KAAKqa,SAASqG,eAAe,GAAIggD,SAAU,eAC7C,CACH,MAAMC,SAAW,yBAAH,OAA4B,sBAAAv/D,KAAA,WAAe2L,IACzD3L,KAAKpB,KAAKqa,SAASqG,eAAe,GAAIigD,SAAU,YAIxDjF,SAAS79C,IACLzc,KAAKi/D,uB,+zBCjCE,MAAMzF,wBAAwBe,6CAAO,qB,kBAAA,8D,IAAA,K,IAAA,O,MAEzC,IAAI+C,2D,2GAEXpD,QAAQh5D,KACJlB,KAAKpB,KAAKmb,SAAS0wC,WAAWS,4E,4UAC9B,CAAAlrD,KAAA,UAAiBkB,IAAI2wB,UACrB7xB,KAAK00B,KAAK6oC,SAASrsD,OAAO2T,OAAO,sBAAA7kB,KAAA,WAAek+B,gBAGpD+7B,UACIj6D,KAAKpB,KAAKmb,SAAS6wC,UAAUM,4EAGjCsU,aACI,MAAMlE,aAAet7D,KAAK00B,KAAK+oC,SAASnmC,QAEpCgkC,cACAt7D,KAAKpB,KAAKqb,QAAQgQ,WAAWQ,+DAAuB,CAChD6wC,aACA/iC,WAAY,sBAAAv4B,KAAF,aAKtBw7D,cACI,MAAMpR,IAAMpqD,KAAKpB,KAAKmb,SAASwwC,iBAE1BH,MAIDA,IAAI/xC,OAASszC,uEACb3rD,KAAKpB,KAAKqb,QAAQogD,YAGlBjQ,IAAI/xC,OAASi0C,uEACbtsD,KAAK00B,KAAKgpC,KAGVtT,IAAI/xC,OAAS80C,uEACbntD,KAAK00B,KAAKipC,OAGVvT,IAAI/xC,OAASmzC,wEACbxrD,KAAKw/D,cAIblF,SAAS79C,IACLzc,KAAKw7D,cACLx7D,KAAKpB,KAAKqa,SAASsG,QACnBvf,KAAKpB,KAAKqa,SAASqG,eACf,EADJ,YAES,sBAAAtf,KAAA,WAAesnC,QAAQtqB,QAFhC,gBAGI,UAGAhd,KAAK00B,KAAK0C,SACVp3B,KAAKpB,KAAKqa,SAASqG,eAAe,EAAG,0BAGzCtf,KAAK00B,KAAK5hB,KAAKS,SAAQ,EAAG+tB,KAAMzf,IAAKm1B,eACjC,MAAMZ,KAAO9U,KACPs8B,KAAO/7C,IAAM,EAgBnB,GAbIm1B,YACAh3C,KAAKpB,KAAKqa,SAAS4F,SACf,EACA++C,KAFJ,YAGSxnB,KAAK/4B,MANI,UASlBrd,KAAKpB,KAAKqa,SAAS4F,SAAS,GAAI++C,KAAM,IATpB,YAWlB59D,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG++C,KAA/B,YAA0CxnB,KAAK/4B,OAC/Crd,KAAKpB,KAAKqa,SAAS4F,SAAS,GAAI++C,KAAM,IAAK,YAG3CxnB,KAAKhf,QACLp3B,KAAKpB,KAAKqa,SAAS4F,SAAS,GAAI++C,KAAM,UAAW,eAC9C,CACH,MAAMtmC,QAAU8e,KAAK9e,QACrBt3B,KAAKpB,KAAKqa,SAAS+E,KACf,GACA4/C,KACAtmC,QAAQlU,MAAMnF,KACdqZ,QAAQlU,MAAMO,QACd2T,QAAQlU,MAAMS,UACdyT,QAAQlU,MAAM4kC,YAElBhoD,KAAKpB,KAAKqa,SAAS4F,SACf,GACA++C,KAFJ,WAGQtmC,QAAQgQ,QAAQtqB,cAKhChd,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,EAAG,mB,0tBCpG1C,MAAM2/C,KAAO,OAEE,MAAM/E,4BAA4Bc,6CAAO,iEAC5C,IAD4C,8BAE3C,IAF2C,4BAG7C,IAAI+C,4DAHyC,8BAI3C,IAJ2C,4BAK7C,MAL6C,gCAMzC,MAEX,WACI,OAAOnxD,KAAK41B,OAAO/hC,KAAKpB,KAAK6a,OAAO8D,MAAQvd,KAAKud,OAAS,GAG9D,UACI,OAAOpR,KAAK41B,OAAO/hC,KAAKpB,KAAK6a,OAAO+D,OAASxd,KAAKwd,QAAU,GAGhE08C,QAAQh5D,KACJlB,KAAKpB,KAAKmb,SAAS0wC,WAAWS,4EAC9BlrD,KAAK00B,KAAK6oC,SAASr8D,IAAIwzB,MAAQ,IAC/B10B,KAAK42C,OAAS11C,IAAI01C,QAAU,SAC5B52C,KAAK62C,KAAO31C,IAAI21C,MAAQ,KACxB72C,KAAK82C,SAAW51C,IAAI41C,UAAY,KAChC92C,KAAKi3C,SAAW/1C,IAAI+1C,UAAYunB,KAChCx+D,KAAKioC,SAAW/mC,IAAI+mC,UAAYu2B,KAChCx+D,KAAKy/D,aAAev+D,IAAIu+D,cAAgBjB,KACxCx+D,KAAK+2C,YAAc71C,IAAI61C,aAAe/2C,KAAK0/D,iBAAiBvyD,KAAKnN,MAGrEi6D,UACIj6D,KAAKpB,KAAKmb,SAAS6wC,UAAUM,4EAGjCsS,aACIx9D,KAAKi3C,SAASj3C,KAAK00B,KAAK+oC,UAG5BkC,SACI3/D,KAAKioC,WACLjoC,KAAKpB,KAAKqb,QAAQogD,YAGtBmB,cACI,MAAMpR,IAAMpqD,KAAKpB,KAAKmb,SAASwwC,iBAE1BH,MAIDA,IAAI/xC,OAASszC,uEACb3rD,KAAK2/D,SAGLvV,IAAI/xC,OAASi0C,uEACbtsD,KAAK00B,KAAKgpC,KAGVtT,IAAI/xC,OAAS80C,uEACbntD,KAAK00B,KAAKipC,OAGVvT,IAAI/xC,OAASmzC,wEACbxrD,KAAKw9D,cAIbkC,iBAAiBv8C,IAAKnO,EAAGC,EAAG+hC,YACxB,MAAMt4B,KAAO1e,KAAKy/D,aAAat8C,IAAKnO,EAAGC,EAAG+hC,YAEtCA,WACAh3C,KAAKpB,KAAKqa,SAAS4F,SAAS7J,EAAGC,EAA/B,YAAuCyJ,MAAQ,UAE/C1e,KAAKpB,KAAKqa,SAAS4F,SAAS7J,EAAGC,EAA/B,YAAuCyJ,OAI/C47C,SAAS79C,IACLzc,KAAKw7D,eAELuB,iEACI/8D,KAAK8e,KACL9e,KAAKm+D,IACLn+D,KAAKud,MACLvd,KAAKwd,OACLxd,KAAK42C,OACL52C,KAAK62C,MAGT,IAAI+oB,QAAU5/D,KAAKm+D,IAAM,EAEzB,MAAME,KAAOr+D,KAAK8e,KAAO,EAErB9e,KAAK82C,WACL92C,KAAKpB,KAAKqa,SAAS4F,SAASw/C,KAAMuB,QAAS5/D,KAAK82C,UAEhD8oB,SAAW,GAGf5/D,KAAK00B,KAAK5hB,KAAKS,SAAQ,EAAG+tB,KAAMzf,IAAKm1B,eACjC,MAAM4mB,KAAOgC,QAAU/9C,IAEvB7hB,KAAK+2C,YAAYzV,KAAM+8B,KAAMT,KAAM5mB,WAAYn1B,W,m2BC7F5C,MAAM63C,wBAAwBa,6CAAO,yGAHlC,GAOdL,QAAQh5D,KACJlB,KAAKpB,KAAKmb,SAAS0wC,WAAWS,4EAC9BlrD,KAAK8rB,UAAY5qB,IAAI4qB,UAErB,MAAMmf,MAAQjrC,KAAK8rB,UAAUmf,MAAMprC,MAEnCG,KAAKirC,MAAQ,IAAIqyB,2DAAepsD,OAAO2T,OAAOomB,QAC9CjrC,KAAK6/D,OAAS,IAAIvC,2DAGtBrD,UACIj6D,KAAKpB,KAAKmb,SAAS6wC,UAAUM,4EAGjCsS,aACI,GAtBU,IAsBNx9D,KAAK8oD,KACL9oD,KAAK8oD,KAtBE,MAuBJ,CAGH,GAFoB9oD,KAAK8rB,UAAU8hB,MAAM2Y,YAEvB,EAAG,CACjB,MAAM1c,MAAQ7pC,KAAK6/D,OAAOpC,SAE1Bz9D,KAAK8rB,UAAU+zC,OAAOh2B,MAAMr2B,OAC5BxT,KAAK8rB,UAAU8hB,MAAM2Y,gBAKjCmX,KApCc,IAqCN19D,KAAK8oD,KACL9oD,KAAKirC,MAAMyyB,KAEX19D,KAAK6/D,OAAOnC,KAIpBoC,OA5Cc,IA6CN9/D,KAAK8oD,KACL9oD,KAAKpB,KAAKqb,QAAQogD,YAElBr6D,KAAK8oD,KAhDC,EAoDd6U,OApDc,IAqDN39D,KAAK8oD,KACL9oD,KAAKirC,MAAM0yB,OAEX39D,KAAK6/D,OAAOlC,OAIpBnC,cACI,MAAMpR,IAAMpqD,KAAKpB,KAAKmb,SAASwwC,iBAE1BH,MAIDA,IAAI/xC,OAASszC,uEACb3rD,KAAK8/D,OAGL1V,IAAI/xC,OAASi0C,uEACbtsD,KAAK09D,KAGLtT,IAAI/xC,OAAS80C,uEACbntD,KAAK29D,OAGLvT,IAAI/xC,OAASmzC,wEACbxrD,KAAKw9D,cAIbuC,aAAat2B,KAAMphB,SACfroB,KAAK6/D,OAAOtC,UAAS/zB,6DAAgBC,KAAKA,OAE1CzpC,KAAKpB,KAAKqa,SAAS4F,SACf,GACAwJ,QAFJ,WAGOg1B,6DAAW5T,KAAKpsB,MAHvB,WAII,UAGJrd,KAAK6/D,OAAO/sD,KAAKS,SAAQ,EAAG+tB,KAAMzf,IAAKm1B,eACnC,MAAMnN,MAAQvI,KACR0+B,KAAO,EAAIn+C,IAAMwG,QACjBpG,OAAQ0lB,2DAAckC,MAAMr2B,IAAKxT,KAAK8rB,WAE5C,GAAIkrB,WAAY,CACZ,MAAMxU,MAnGH,IAmGWxiC,KAAK8oD,KAAsB,SAAW,UAEpD9oD,KAAKpB,KAAKqa,SAAS4F,SAAS,GAAImhD,KAAhC,YAA2Cn2B,MAAMxsB,MAAQmlB,OACzDxiC,KAAKpB,KAAKqa,SAAS4F,SAAS,GAAImhD,KAAhC,WAA0C/9C,OAASugB,WAChD,CACH,MAAMy9B,SAxGH,IAwGcjgE,KAAK8oD,KAAsB,IAAM,IAElD9oD,KAAKpB,KAAKqa,SAAS4F,SACf,GACAmhD,KAFJ,UAGOC,SAHP,YAGmBp2B,MAAMxsB,OAEzBrd,KAAKpB,KAAKqa,SAAS4F,SAAS,GAAImhD,KAAhC,WAA0C/9C,YAKtDq4C,SAAS79C,IACLzc,KAAKw7D,cAELx7D,KAAKpB,KAAKqa,SAASsG,QACnBvf,KAAKpB,KAAKqa,SAASqG,eACf,EADJ,YAEStf,KAAK8rB,UAAUwb,QAAQtqB,QAFhC,gBAGI,UAGJ,MAAM4wB,MAAQ5tC,KAAK8rB,UAAU8hB,MAAMA,MAC7B6Y,GAAKzmD,KAAK8rB,UAAU8hB,MAAM6Y,GAC1ByZ,eAAiBlgE,KAAK8rB,UAAU8hB,MAAM8Y,aAE5C,IAAIr+B,QAAU,EAEdroB,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAGwJ,QAAS,SACxCroB,KAAKpB,KAAKqa,SAAS4F,SACf,EACAwJ,QAFJ,UAGOulB,MAHP,aAGiB6Y,GAHjB,YAGuByZ,eAHvB,SAMA73C,UAEA,MAAMu0B,OAASzwC,KAAKwG,KAAK3S,KAAK8rB,UAAU8wB,OAAO36B,OACzCk+C,UAAYngE,KAAK8rB,UAAU8wB,OAAOxwC,IAExCpM,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAGwJ,QAAS,UACxCroB,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAGwJ,QAA/B,UAA2Cu0B,OAA3C,YAAqDujB,YAErD93C,UAEA,MAAMuqB,OAAQjL,2DAAcU,sDAAaroC,KAAK8rB,WACxC+mB,YAAazI,oFAA4BwI,OAE/C5yC,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAGwJ,QAAS,SACxCroB,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAGwJ,QAA/B,UAA2CuqB,MAA3C,aAAqDC,WAArD,OAEAxqB,UAEA,MAAMk+B,YAAcvmD,KAAK8rB,UAAU8hB,MAAM2Y,YACnC6Z,gBAAkB7Z,YAAc,EAAI,aAAU/9C,EAEpDxI,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAGwJ,QAAS,gBACxCroB,KAAKpB,KAAKqa,SAAS4F,SACf,EACAwJ,QAFJ,UAGOk+B,aACH6Z,iBAGJ/3C,UACAA,UAEAroB,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAGwJ,QAAS,QAAS,UAEjDroB,KAAKirC,MAAMn4B,KAAKS,SAAQ,EAAG+tB,KAAMzf,IAAKm1B,eAClC,MAAMvN,KAAOnI,KACPs8B,KAAOv1C,QAAUxG,IAAM,EACvBw+C,OAAS52B,KAAK6T,QAAU,EAAI,IAAM,IAExC,GAAItG,WAAY,CACZ,MAAMxU,MApLJ,IAoLYxiC,KAAK8oD,KAAqB,SAAW,UAEnD9oD,KAAKpB,KAAKqa,SAAS4F,SACf,EACA++C,KAFJ,YAGSn0B,KAAKqB,aAHd,YAG8BrB,KAAKpsB,MAC/BmlB,OAEJxiC,KAAKpB,KAAKqa,SAAS4F,SACf,GACA++C,KAFJ,UAGOyC,QAHP,OAGgB52B,KAAKpR,KACjBmK,WAED,CACH,MAAMy9B,SAnMJ,IAmMejgE,KAAK8oD,KAAqB,IAAM,IAEjD9oD,KAAKpB,KAAKqa,SAAS4F,SACf,EACA++C,KAFJ,UAGOqC,SAHP,YAGmBx2B,KAAKqB,aAHxB,YAGwCrB,KAAKpsB,OAE7Crd,KAAKpB,KAAKqa,SAAS4F,SAAS,GAAI++C,KAAhC,UAAyCyC,QAAzC,OAAkD52B,KAAKpR,UAI/Dr4B,KAAK+/D,aAAa//D,KAAKirC,MAAMwyB,SAAUp1C,SAEvCroB,KAAKpB,KAAKqa,SAAS4F,SAAS,EAAG,EAAG,mB,mMCjOnC,MAAMw+B,WAAcnyC,KAChBA,IAAIiU,OAAO,GAAGg/B,cAAgBjzC,IAAIK,MAAM,I,q6BCiBpC,MAAMouD,sBAAsBY,6CAAO,iEACtC,IADsC,qCAE9B,GAF8B,sCAG7B,GAH6B,qEAKvC,IAAI+C,4DAEX,WACI,OAAOnxD,KAAK41B,MACR/hC,KAAKpB,KAAK6a,OAAO8D,MAAQvd,KAAKud,MAAQvd,KAAKsgE,eAInD,UACI,OAAOtgE,KAAKugE,eAGhB,aACI,OAAOp0D,KAAK41B,MAAM/hC,KAAKpB,KAAK6a,OAAO+D,OAA+B,EAAtBxd,KAAKugE,gBAGrDrG,QAAQh5D,KACJlB,KAAKpB,KAAKmb,SAAS0wC,WAAWS,4EAC9BlrD,KAAK8rB,UAAY5qB,IAAI4qB,UAErB9rB,KAAKg+D,cAGTA,cACI,MAAMv2C,IAAMznB,KAAK8rB,UAAU/B,UAAU,kBAAmB,CACpD/N,UAAW,KAGfhc,KAAK00B,KAAK6oC,SAAS,IACZ91C,IAAI3U,KAAKkJ,UAAUlc,KAAKuY,OAAS+oC,2DAAW/oC,QAC/C,CACIgF,KAAM,OACN4gD,QAAQ,KAKpBhE,UACIj6D,KAAKpB,KAAKmb,SAAS6wC,UAAUM,4EAGjCsS,aACI,MAAM7b,QAAU3hD,KAAK00B,KAAK+oC,SAE1B,GAAI9b,QAAQsc,OAER,YADAj+D,KAAKpB,KAAKqb,QAAQogD,YAItB,MAAM3mD,QAASovC,iEAAiBnB,QAAQnuC,IAAKxT,KAAK8rB,WAGlD,IAAIpY,SAAUA,OAAO2tC,cAArB,CAKA,GAAI3tC,QAAUA,OAAOmuC,YAGjB,OAFAF,QAAQ+C,UAAU1kD,KAAK8rB,UAAWpY,aAClC1T,KAAKpB,KAAKqb,QAAQogD,YAKtB,GAAI1Y,QAAQsB,SAAU,CAClB,MAAMud,QAASxd,0DAAUhjD,KAAK8rB,WAE9B,GAAI00C,OAUA,YATAxgE,KAAKpB,KAAKqb,QAAQgQ,WAAWe,wDAAgB,CACzC4rB,OAAQ,iBACRE,SAAU,uEAAF,OAAyE0pB,OAAO7e,QAAQtkC,KAAxF,eAAmGskC,QAAQtkC,KAA3G,KACRmnC,UAAW,KACPgc,OAAO7e,QAAQ+C,UAAU1kD,KAAK8rB,UAAW00C,QACzC7e,QAAQ8C,SAASzkD,KAAK8rB,WACtB9rB,KAAKpB,KAAKqb,QAAQogD,eAOlC,IAAK3mD,QAAUiuC,QAAQC,aAGnB,OAFAD,QAAQ8C,SAASzkD,KAAK8rB,gBACtB9rB,KAAKpB,KAAKqb,QAAQogD,YAItB1Y,QAAQ4C,SAASvkD,KAAK8rB,UAAW,CAC7B04B,UAAY1xC,OACR6uC,QAAQ0C,QAAQrkD,KAAK8rB,UAAWhZ,MAEhC9S,KAAKpB,KAAKqb,QAAQogD,YAEd1Y,QAAQwB,aAAenjD,KAAK8rB,UAAU9B,UACtChqB,KAAKpB,KAAKqb,QAAQgQ,WAAWgB,wDAAgB,CACzCxB,OAAQzpB,KAAK8rB,aAIzBmc,SAAU,UAIlBuzB,cACI,MAAMpR,IAAMpqD,KAAKpB,KAAKmb,SAASwwC,iBAE1BH,MAIDA,IAAI/xC,OAASszC,uEACb3rD,KAAKpB,KAAKqb,QAAQogD,YAGlBjQ,IAAI/xC,OAASi0C,uEACbtsD,KAAK00B,KAAKgpC,KAGVtT,IAAI/xC,OAAS80C,uEACbntD,KAAK00B,KAAKipC,OAGVvT,IAAI/xC,OAASmzC,wEACbxrD,KAAKw9D,cAIblD,SAAS79C,IACLzc,KAAKpB,KAAK4d,uBAAuBC,IACjCzc,KAAKw7D,eAELuB,iEACI/8D,KAAK8e,KACL9e,KAAKm+D,IACLn+D,KAAKud,MACLvd,KAAKwd,OACL,YACAxd,KAAK8rB,UAAU1I,OAGnB,IAAIw8C,QAAU5/D,KAAKm+D,IAAM,EACrBsC,QAAUzgE,KAAK8e,KAAO,EAE1B9e,KAAK00B,KAAK5hB,KAAKS,SAAQ,EAAG+tB,KAAMqgB,QAAS9/B,IAAKm1B,eAC1C,GAAI2K,QAAQsc,OAeR,YAdIjnB,WACAh3C,KAAKpB,KAAKqa,SAAS4F,SACf4hD,QACAb,QAAU/9C,IACV,SACA,UAGJ7hB,KAAKpB,KAAKqa,SAAS4F,SACf4hD,QACAb,QAAU/9C,IACV,WAMZ,MAAM7E,QAAU2kC,QAAQmD,eAAe9kD,KAAK8rB,WAExCkrB,WACIh6B,QAAQkoC,UACRllD,KAAKpB,KAAKqa,SAAS4F,SACf4hD,QACAb,QAAU/9C,IAFd,YAGS7E,QAAQ0B,MACb,UAGJ1e,KAAKpB,KAAKqa,SAAS4F,SACf4hD,QACAb,QAAU/9C,IAFd,YAGS7E,QAAQ0B,MACb,QAIJ1B,QAAQkoC,UACRllD,KAAKpB,KAAKqa,SAAS4F,SACf4hD,QACAb,QAAU/9C,IAFd,YAGS7E,QAAQ0B,OAGjB1e,KAAKpB,KAAKqa,SAAS4F,SACf4hD,QACAb,QAAU/9C,IAFd,YAGS7E,QAAQ0B,MACb,WAMhB,MAAMijC,QAAU3hD,KAAK00B,KAAK+oC,SAE1B,GAAI9b,QAAQsc,OACR,OAGJ,MAAMyC,YAAc,GAAH,QAAMxc,uEACnBvC,QAAQtpC,MADK,aAEXspC,QAAQ+B,eAAe1jD,KAAK8rB,YAElC9rB,KAAKpB,KAAKqa,SAAS2F,iBACf6hD,QACAb,QAAU5/D,KAAK00B,KAAK7yB,OAAS,EAC7B7B,KAAKud,MAAQ,EACbmjD,gB,6oBC/NZ,MAAMlC,KAAO,OAKE,MAAM5E,2BAA2BW,6CAAO,iEAC3C,IAD2C,8BAE1C,GAET,aACI,IAAKv6D,KAAK82C,SACN,OAAO,EAGX,MAAM6pB,MAAQ3gE,KAAKpB,KAAKqa,SAAS0F,qBAAqB3e,KAAK82C,UAE3D,OAAO3qC,KAAKwG,KAAKguD,OAAS3gE,KAAKud,MAAQ,GAAK,GAGhD,WACI,OAAOpR,KAAK41B,OAAO/hC,KAAKpB,KAAK6a,OAAO8D,MAAQvd,KAAKud,OAAS,GAG9D,UACI,OAAOpR,KAAK41B,OAAO/hC,KAAKpB,KAAK6a,OAAO+D,OAASxd,KAAKwd,QAAU,GAGhE,aACI,OAAOxd,KAAKm+D,IAAMn+D,KAAKwd,OAG3B,YACI,OAAOxd,KAAK8e,KAAO9e,KAAKud,MAG5B28C,QAAQh5D,KACJlB,KAAKpB,KAAKmb,SAAS0wC,WAAWS,4EAE9BlrD,KAAK42C,OAAS11C,IAAI01C,QAAU,gBAC5B52C,KAAKwkD,UAAYtjD,IAAIsjD,WAAaga,KAClCx+D,KAAKioC,SAAW/mC,IAAI+mC,UAAYu2B,KAChCx+D,KAAK8nC,SAAW5mC,IAAI4mC,UAAY02B,KAChCx+D,KAAK4gE,YAAc1/D,IAAI0/D,aAAe,UACtC5gE,KAAK6gE,WAAa3/D,IAAI2/D,YAAc,SACpC7gE,KAAK82C,SAAW51C,IAAI41C,UAAY,GAGpCmjB,UACIj6D,KAAKpB,KAAKmb,SAAS6wC,UAAUM,4EAGjC4V,YAAY5hC,QACRl/B,KAAKpB,KAAKqb,QAAQogD,YAEdn7B,OACAl/B,KAAKwkD,YAELxkD,KAAKioC,WAGTjoC,KAAK8nC,SAAS5I,QAGlB6hC,kBACI/gE,KAAKghE,OAAShhE,KAAKghE,OA7DZ,EADC,EAiEZxF,cACI,MAAMpR,IAAMpqD,KAAKpB,KAAKmb,SAASwwC,iBAE1BH,MAKD,CACIkC,sEACAQ,sEACAK,sEACAR,uEACFjW,SAAS0T,IAAI/xC,OAEfrY,KAAK+gE,kBAGL3W,IAAI/xC,OAASszC,uEACb3rD,KAAK8gE,YAnFF,GAsFH1W,IAAI/xC,OAASmzC,wEACbxrD,KAAK8gE,YAAY9gE,KAAKghE,SAI9B1G,SAAS79C,IACLzc,KAAKw7D,eAELuB,iEAAa/8D,KAAK8e,KAAM9e,KAAKm+D,IAAKn+D,KAAKud,MAAOvd,KAAKwd,OAAQxd,KAAK42C,QAE5D52C,KAAK82C,UACL92C,KAAKpB,KAAKqa,SAAS2F,iBACf5e,KAAK8e,KAAO,EACZ9e,KAAKm+D,IAAM,EACXn+D,KAAKud,MAAQ,EACbvd,KAAK82C,UAIb,MAAM6oB,OAAS3/D,KAAKghE,OAAL,YACJhhE,KAAK6gE,YADD,YAEJ7gE,KAAK6gE,YACVI,QAAUjhE,KAAKghE,OAAL,YACLhhE,KAAK4gE,aADA,YAEL5gE,KAAK4gE,aAEhB5gE,KAAKpB,KAAKqa,SAAS4F,SACf7e,KAAK8e,KAAO,EACZ9e,KAAKkhE,OAAS,EACdvB,OACA3/D,KAAKghE,YAASx4D,EAAY,UAG9B,MAAM24D,UAAYnhE,KAAKpB,KAAKqa,SAASwF,iBAAiBwiD,SAEtDjhE,KAAKpB,KAAKqa,SAAS4F,SACf7e,KAAK+e,MAAQ,EAAIoiD,UACjBnhE,KAAKkhE,OAAS,EACdD,QACAjhE,KAAKghE,OAAS,cAAWx4D,M,6eCzItB,MAAMqxD,mBAAmBU,6CAAO,gEACpC,KADoC,+BAEjC,GAEVL,QAAQh5D,KACJlB,KAAKmqB,KAAOjpB,IAAIipB,MAAQ,IACxBnqB,KAAKohE,QAAU,EACfphE,KAAKpB,KAAKmb,SAAS0wC,WAAWU,4EAGlC8O,UACIj6D,KAAKpB,KAAKmb,SAAS6wC,UAAUO,4EAGjCqQ,cACgBx7D,KAAKpB,KAAKmb,SAASwwC,iBAOnC+P,SAAS79C,IACLzc,KAAKohE,SAAW3kD,GAEZzc,KAAKohE,SAAWphE,KAAKmqB,KACrBnqB,KAAKpB,KAAKqb,QAAQogD,YAItBr6D,KAAKw7D,iB,seC5BE,MAAM1B,sBAAsBS,6CACvCL,QAAQh5D,KACJlB,KAAKypB,OAASvoB,IAAIuoB,OAClBzpB,KAAK2kD,SAAUzB,8DAAcljD,KAAKypB,QAClCzpB,KAAKpB,KAAKmb,SAAS0wC,WAAWU,4EAGlC8O,UACIj6D,KAAKpB,KAAKmb,SAAS6wC,UAAUO,4EAGjCqQ,cACI,MAAMpR,IAAMpqD,KAAKpB,KAAKmb,SAASwwC,iBAE1BH,MAIDA,IAAI/xC,OAAS8zC,qEACbnsD,KAAK2kD,QAAQhD,QAAQgD,QAAQ,IAAK3kD,KAAK2kD,SAGvCyF,IAAI/xC,OAASszC,uEACb3rD,KAAK2kD,QAAQhD,QAAQiD,cAAc5kD,KAAK2kD,UAIhD0c,mBACI,MAAMrtB,QACFh0C,KAAK2kD,QAAQlD,uBAAyBzhD,KAAK2kD,QAAQjD,gBAEjD7/C,OAASsK,KAAKwG,KADF,GACOqhC,QAAsB,GAAK,EAC9CstB,OAASn1D,KAAK41B,MAAM/hC,KAAKpB,KAAK6a,OAAO8D,MAAQ,GAAKgkD,EAClDL,OAASlhE,KAAKpB,KAAK6a,OAAO+D,OAAS,EAEnCgkD,MAAQ,IAAH,QACPr1D,KAAK41B,MAAM/hC,KAAK2kD,QAAQlD,uBAAyB,KAAO,IAC1DwD,QAAQ,GAFC,YAEK94C,KAAKwG,KAAK3S,KAAK2kD,QAAQjD,gBAAkB,KAAO,GAFrD,KAGX1hD,KAAKpB,KAAKqa,SAASqG,eACf4hD,OADJ,qBAEkBlhE,KAAK2kD,QAAQhD,QAAQtkC,KAFvC,YAE+CmkD,QAE/CxhE,KAAKpB,KAAKqa,SAASqG,eACf4hD,OAAS,EACT,0CACA,WAGJ,IAAK,IAAIt/D,EAAI,EAAGA,EAlBE,GAkBaA,IAAK,CAChC,MAAMuN,KAAOtN,OAASD,EAEV,IAARuN,KACAnP,KAAKpB,KAAKqa,SAASsF,OACf+iD,OAAS1/D,EACTs/D,OAAS,EACT,IACA,UACA,WAEG/xD,KAAO,EACdnP,KAAKpB,KAAKqa,SAASsF,OACf+iD,OAAS1/D,EACTs/D,OAAS,EACT,IACA,WAGJlhE,KAAKpB,KAAKqa,SAASsF,OACf+iD,OAAS1/D,EACTs/D,OAAS,EACT,IACA,YAMhB5G,SAAS79C,IACLzc,KAAKw7D,cAELx7D,KAAKpB,KAAK4d,uBAAuBC,IACjCzc,KAAKqhE,mBAEArhE,KAAK2kD,QAAQvB,cACdpjD,KAAKpB,KAAKqb,QAAQogD,e,y8BCtFf,MAAMvgD,sBAAsBiD,8CAAQ,qB,kBAAA,qDACnC,O,MACE,I,IAFiC,iB,IAAA,M,gGAI/C,aACI,OAAO/c,KAAKpB,KAAKC,IAAIiuB,UAAd,sBAAwB9sB,KAAxB,YAGX,SACI,6BAAOA,KAAP,WAGJ,aACI,OAAOA,KAAKypB,OAAOF,MAAMG,UAG7B,eACI,OAAO1pB,KAAKypB,OAAO+O,SAASC,SAGhCR,QACI,MAAMxO,OAASzpB,KAAKpB,KAAKC,IAAI+3B,aAAa,UAI1C,OAFA,sBAAA52B,KAAA,UAAiBypB,OAAO9d,IAEjB3L,KAAKypB,OAGhBg4C,eAKI,MAAMh4C,OAASzpB,KAAKpB,KAAKC,IAAI+3B,aAAa,UACpCtC,SAAW7K,OAAO9d,GAClB+1D,WAAaj4C,OAAOtH,YAI1B,OAFAsH,OAAO0E,UAEA,CACHmG,SACA7K,OAAQi4C,YAIhBC,MAAM7uD,MACF,sBAAA9S,KAAA,UAAiB8S,KAAKwhB,UACtBt0B,KAAKpB,KAAKC,IAAIwjB,YAAYvP,KAAK2W,QAGnC3J,kBACI,MAAMwU,SAAWt0B,KAAKypB,OAAO9d,GAGvB8b,IAAMznB,KAAKypB,OAAOM,UAAU,kBAAmB,CACjDmV,OAAQ,IAAI3K,IAAI,CAACv0B,KAAKypB,WAEpBm4C,MAAQniE,MAAMC,KAAK+nB,IAAI3U,KAAKosB,QAC5BwiC,WAAa1hE,KAAKpB,KAAKC,IAAIsjB,UAAUy/C,OAI3C,OAFAA,MAAMruD,SAAStQ,GAAMA,EAAEkrB,YAEhB,CACHmG,SACA7K,OAAQi4C,YAIhBG,WACQ7hE,KAAKypB,QACLzpB,KAAKypB,OAAO0E,UAEhB,sBAAAnuB,KAAA,UAAiB,MAGrBoqB,gBACI,OAAOpqB,KAAK8hE,YAAYvwD,QAG5B0pD,KAAKz9B,WACDx9B,KAAK8hE,YAAYn7D,MAAK,KAClB,MAAM+4B,OAAQsR,iEAAexT,WAE7Bx9B,KAAKypB,OAAOM,UAAU,WAAY2V,UAI1Cq7B,MAAM9tC,QACFjtB,KAAK8hE,YAAYn7D,MAAK,KACdsmB,OAAO+R,aAAe/R,OAAO8R,OAC7Bv4B,QAAQC,KAAR,2CAAiDwmB,SAKrDjtB,KAAKypB,OAAOM,UAAU,YAAa,CAC/BkD,YAKZ6uC,KAAKiG,MAAQ,GACT/hE,KAAK8hE,YAAYn7D,MAAK,KAClB3G,KAAKypB,OAAOM,UAAU,kBAA2B,IAARg4C,a,ukCCpGtC,MAAMrpD,YAAYqE,mDAI7B,aACI,6BAAO/c,KAAP,SAGJyY,YAAY7Z,MACRse,MAAMte,MADQ,6EANZ,IAQF,sBAAAoB,KAAA,QAAe,IAAIw2B,4CACnB,sBAAAx2B,KAAA,SAAagiE,YAAc,0DAAUhiE,KAAV,uCAAUA,KAAV,mBAE3BkR,OAAO2T,OAAOiN,0CAAYve,SAASgZ,YAC/B,sBAAAvsB,KAAA,SAAag3B,kBAAkBzK,cAGnCrb,OAAO2T,OAAOgS,uCAAStjB,SAAS2e,SAC5B,sBAAAlyB,KAAA,SAAa+2B,eAAe7E,WAIpC2vC,WACI7hE,KAAKiiE,kBAGTA,kBACI,IAAK,IAAIx4C,UAAU,sBAAAzpB,KAAA,SAAaopB,SAASvpB,IACrC4pB,OAAO0E,UAIf+zC,YAAYz4C,QACR,MAAM3W,KAAO2W,OAAOtH,YAMpB,OAJArP,KAAKnH,GAAK3L,KAAKwY,OAAOke,aAEtB12B,KAAKwY,OAAO6J,YAAYvP,MAEjB9S,KAAKwY,OAAOsU,UAAUha,KAAKnH,O,ozpCC1C1C,MAAMw2D,UAAYC,KAAKD,UACjBE,MAAQD,KAAKC,M,iDAEJ,MAAMlpD,yBAAyB4D,8CAAQ,4EACrC,IADqC,sCAEtC,SAEZ,eACI,6BAAO/c,KAAP,WAGJ,gBACI,6BAAOA,KAAP,YAGJq9D,WACI,sBAAAr9D,KAAA,YAAkB,GAGtBsiE,mBACI,sBAAAtiE,KAAA,YAAkB,GAElBA,KAAKpB,KAAKib,OAAOgoD,WACjB7hE,KAAKpB,KAAKkB,IAAI+hE,WACd7hE,KAAKpB,KAAK4Z,OAAOqpD,WACjB7hE,KAAKpB,KAAKwa,MAAMyoD,WAChB7hE,KAAKpB,KAAKkd,YAAY+lD,WACtB7hE,KAAKpB,KAAK4H,QAAQq7D,WAGtBU,cAAczvD,MACV,sBAAA9S,KAAA,YAAkB,GAElBA,KAAKpB,KAAKma,MAAM4oD,MAAM7uD,KAAKiG,OAC3B/Y,KAAKpB,KAAKib,OAAO8nD,MAAM7uD,KAAK+G,QAC5B7Z,KAAKpB,KAAKwa,MAAMuoD,MAAM7uD,KAAKsG,OAC3BpZ,KAAKpB,KAAKkB,IAAI6hE,MAAM7uD,KAAKhT,KAG7Bk8D,UAGI,GAFA,sBAAAh8D,KAAA,UAAiBwiE,OAAO,kBAAmB,WAEtCxiE,KAAKyiE,SACN,OAGJziE,KAAK0iE,WAAW1iE,KAAKyiE,UAGNziE,KAAKpB,KAAKib,OAAOoe,QACzBO,SAASsE,OAAO,EAAG,GAE1B98B,KAAKpB,KAAKqb,QAAQ8/C,UAAUzvC,mEAmBhCmxC,WACI,IAAKz7D,KAAK+7D,UAEN,YADAv1D,QAAQC,KAAK,2CAIjB,MAAMqM,KAAO,CACT2vD,SAAUziE,KAAKyiE,SACf1pD,MAAO/Y,KAAKpB,KAAKma,MAAM+G,kBACvBhgB,IAAKE,KAAKpB,KAAKkB,IAAIggB,kBACnBjG,OAAQ7Z,KAAKpB,KAAKib,OAAOiG,kBACzB1G,MAAOpZ,KAAKpB,KAAKwa,MAAM0G,kBACvBhE,YAAa9b,KAAKpB,KAAKkd,YAAYgE,mBAOvC,OAJAtZ,QAAQ+2B,IAAI,YAAazqB,MAEzB6vD,aAAaC,QAAQ5iE,KAAKyiE,SAAUN,UAAUrvD,OAEvCA,KAGX4vD,WAAWD,UACOvxD,OAAOD,KAAK0xD,cAEpBpvD,SAASsvD,OACPA,KAAKC,WAAL,UAAmBL,SAAnB,OACAE,aAAaI,WAAWF,SAKpCG,sBAAsBnmC,QAAS/pB,MAC3B6vD,aAAaC,QAAb,UACO5iE,KAAKyiE,SADZ,kBAC8B5lC,QAD9B,cAEIslC,UAAUrvD,OAIlBmwD,sBAAsBpmC,SAClB,MAAMpI,KAAOkuC,aAAaO,QAAb,UACNljE,KAAKyiE,SADC,kBACiB5lC,QADjB,eAIb,OAAOpI,MAAQ4tC,MAAM5tC,MAGzB0uC,oBAAoBtmC,QAASlI,YACzBguC,aAAaC,QAAb,UACO5iE,KAAKyiE,SADZ,kBAC8B5lC,QAD9B,aAEIslC,UAAUxtC,aAIlByuC,oBAAoBvmC,SAChB,MAAMpI,KAAOkuC,aAAaO,QAAb,UACNljE,KAAKyiE,SADC,kBACiB5lC,QADjB,cAIb,OAAOpI,MAAQ4tC,MAAM5tC,MAGzB4uC,qBAAqBnE,OAAQoE,cACzBX,aAAaC,QAAb,UACO5iE,KAAKyiE,SADZ,YACwBvD,OADxB,cAEIiD,UAAUmB,eAIlBC,wBAAwBrE,OAAQsE,iBAC5Bb,aAAaC,QAAb,UACO5iE,KAAKyiE,SADZ,YACwBvD,OADxB,iBAEIiD,UAAUqB,kBAIlBC,mBAAmBvE,OAAQvqC,YACvBguC,aAAaC,QAAb,UACO5iE,KAAKyiE,SADZ,YACwBvD,OADxB,aAEIiD,UAAUxtC,aAIlB+uC,mBAAmBxE,QACf,MAAMzqC,KAAOkuC,aAAaO,QAAb,UACNljE,KAAKyiE,SADC,YACWvD,OADX,cAIb,OAAOzqC,MAAQ4tC,MAAM5tC,MAGzBkvC,qBAAqBzE,QACjB,MAAMzqC,KAAOkuC,aAAaO,QAAb,UACNljE,KAAKyiE,SADC,YACWvD,OADX,eAIb,OAAOzqC,MAAQ4tC,MAAM5tC,MAGzBmvC,wBAAwB1E,QACpB,MAAMzqC,KAAOkuC,aAAaO,QAAb,UACNljE,KAAKyiE,SADC,YACWvD,OADX,kBAIb,OAAOzqC,MAAQ4tC,MAAM5tC,MAGzBovC,iBAAiBpB,UACb,MAAMhuC,KAAOkuC,aAAaO,QAAQT,UAElC,OAAOhuC,MAAQ4tC,MAAM5tC,MAGzBinC,WACI,MAAM+G,SAAWD,OAAO,8BAA+B,QAEjD1vD,KAAO9S,KAAK6jE,iBAAiBpB,UAE9B3vD,MACDtM,QAAQC,KAAR,oBAA0Bg8D,SAA1B,eAGJ,sBAAAziE,KAAA,UAAiByiE,UAEjBj8D,QAAQ+2B,IAAI,eAAgBzqB,MAE5B9S,KAAKsiE,mBACLtiE,KAAKuiE,cAAczvD,MAGvBssD,aAAatsD,MACT9S,KAAKsiE,mBACLtiE,KAAKuiE,cAAczvD,S,26BC5MZ,MAAMkG,qBAAqB+D,8CAAQ,sEACtC,IADsC,uCAEjC,IAFiC,uCAGjC,IAEb,WACI,6BAAO/c,KAAP,OAGJ,gBACI,6BAAOA,KAAP,YAGJ,gBACI,6BAAOA,KAAP,YAGJ,WACI,OAAOmM,KAAK41B,MAAM,sBAAA/hC,KAAA,OAAa,KAGnC,cACI,OAAO,sBAAAA,KAAA,OAAyB,IAAZA,KAAK+pD,KAG7B0X,eACI,MAAO,CACH9xD,KAAM,EACNka,UAAW,GAInB/J,kBACI,MAAO,CACHnQ,KAAM3P,KAAK2P,KACXka,UAAW7pB,KAAK6pB,WAIxB83C,MAAM7uD,MACF,sBAAA9S,KAAA,MAAa8S,KAAKnD,MAClB,sBAAA3P,KAAA,WAAkB8S,KAAK+W,WAG3BF,cAAc+V,OACV,MAAMokC,SAAW9jE,KAAK+pD,KAEtB,sBAAA/pD,KAAA,WAAkB0/B,OAClB,sBAAA1/B,KAAA,4BAAAA,KAAA,OAAc0/B,OAEd,MAAMqkC,QAAU/jE,KAAK+pD,KAErB,sBAAA/pD,KAAA,WAAkB+jE,QAAUD,UAGhCpnD,OAAOD,IACH,sBAAAzc,KAAA,WAAkB,GAClB,sBAAAA,KAAA,WAAkB,M,4XCvDX,MAAMwZ,mBAAmBuD,8CAMpC,YACI,OAAO/c,KAAKpB,KAAK0a,OAAO0qD,YAAchkE,KAAKpB,KAAK0a,OAAO2qD,WAG3D,aACI,OAAOjkE,KAAKpB,KAAK0a,OAAO4qD,YAAclkE,KAAKpB,KAAK0a,OAAO6qD,YAG3D1rD,YAAY7Z,M,kBACRse,MAAMte,MADQ,+CAbG,O,WAaH,G,IAAA,e,IAAA,M,gGAAA,mCAXT,KAWS,oCAVR,KA6BV6iE,eACI,MAAO,GAGXI,Y,4UACI,CAAA7hE,KAAA,oBAA0B,GAI9B2hE,MAAM7uD,MACF,GAAIA,KAAK6nD,eACL36D,KAAKpB,KAAKib,OAAO4P,OAAO+O,SAASsE,OAC7BhqB,KAAK6nD,eAAe3lD,EACpBlC,KAAK6nD,eAAe1lD,OAErB,CACH,MAAMujB,SAAWx4B,KAAKokE,yBACtBpkE,KAAKpB,KAAKib,OAAO4P,OAAO+O,SAASsE,OAAOtE,SAASxjB,EAAGwjB,SAASvjB,GAGjEjV,KAAKpB,KAAKkc,UAAU0/C,aAGxB16C,kBAKI,MAAO,CACH66C,eAAgB36D,KAAKpB,KAAKib,OAAO2e,UAIzC6mC,aAAagF,OAUbC,YAAYhwC,SAAUuI,SAClB,OAAO78B,KAAKpB,KAAK0a,OAAOgrD,YAAYhwC,SAAUuI,SAGlDtnB,YAAYP,EAAGC,EAAGqf,SAAUuI,SACxB78B,KAAKpB,KAAK0a,OAAO/D,YAAYP,EAAGC,EAAGqf,SAAUuI,SAEzCvI,WAAat0B,KAAKpB,KAAKib,OAAOlO,IAC9B3L,KAAKpB,KAAK6a,OAAOghD,SAASzlD,EAAGC,GAIrC0zC,cAAc3zC,EAAGC,EAAGsvD,eAAgB,GAChC,OAAOvkE,KAAKpB,KAAK0a,OAAOqvC,cAAc3zC,EAAGC,EAAGsvD,eAYhDC,WAAWx4B,GAAIC,GAAIw4B,GAAIC,IACnB,OAAOv4D,KAAKK,IAAIw/B,GAAKy4B,KAAO,GAAKt4D,KAAKK,IAAIy/B,GAAKy4B,KAAO,EAG1DC,kBAAkB3vD,EAAGC,EAAGsI,MAAOC,QAC3B,MAAM4L,SAAW,GAEjB,IAAK,IAAIxnB,EAAIoT,EAAGpT,EAAIoT,EAAIuI,MAAQ,EAAG3b,IAC/B,IAAK,IAAIK,EAAIgT,EAAGhT,EAAIgT,EAAIuI,OAAS,EAAGvb,IAChCmnB,SAASziB,QAAQ3G,KAAK2oD,cAAc/mD,EAAGK,IAI/C,OAAOmnB,SAGXw7C,mBAAmB5vD,EAAGC,EAAGyyB,OACrB,MAAMm9B,SAAmB,EAARn9B,MAEjB,OAAO1nC,KAAK2kE,kBAAkB3vD,EAAI0yB,MAAOzyB,EAAIyyB,MAAOm9B,SAAUA,UAGlEC,oBAAoB9vD,EAAGC,GACnB,MAAO,CACHjV,KAAK2oD,cAAc3zC,EAAI,EAAGC,EAAI,GAC9BjV,KAAK2oD,cAAc3zC,EAAGC,EAAI,GAC1BjV,KAAK2oD,cAAc3zC,EAAI,EAAGC,EAAI,GAC9BjV,KAAK2oD,cAAc3zC,EAAI,EAAGC,GAC1BjV,KAAK2oD,cAAc3zC,EAAI,EAAGC,GAC1BjV,KAAK2oD,cAAc3zC,EAAI,EAAGC,EAAI,GAC9BjV,KAAK2oD,cAAc3zC,EAAGC,EAAI,GAC1BjV,KAAK2oD,cAAc3zC,EAAI,EAAGC,EAAI,IAItCmvD,yBACI,IAAIpvD,EAAGC,EACP,GACID,EAAI7I,KAAKyT,MAAMzT,KAAK61B,SAAWhiC,KAAKud,OACpCtI,EAAI9I,KAAKyT,MAAMzT,KAAK61B,SAAWhiC,KAAKwd,cAC/Bxd,KAAK2oD,cAAc3zC,EAAGC,GAAG,GAAOpT,OAAS,GAElD,MAAO,CAAEmT,EAAGC,GAGhB8vD,cAAc/vD,EAAGC,GACb,OAAOD,EAAI,GAAKC,EAAI,GAAKD,GAAKhV,KAAKud,OAAStI,GAAKjV,KAAKwd,OAG1DwnD,oBAAoBhwD,EAAGC,GACfA,EAAI,GACJjV,KAAKpB,KAAKwa,MAAM6rD,UAAUjlE,KAAKpB,KAAKwa,MAAMirD,KAAKa,UAAW,CACtDlwD,EACAC,EAAGjV,KAAKwd,OAAS,IAGrBvI,GAAKjV,KAAKwd,QACVxd,KAAKpB,KAAKwa,MAAM6rD,UAAUjlE,KAAKpB,KAAKwa,MAAMirD,KAAKc,UAAW,CACtDnwD,EACAC,EAAG,IAGPD,GAAKhV,KAAKud,OACVvd,KAAKpB,KAAKwa,MAAM6rD,UAAUjlE,KAAKpB,KAAKwa,MAAMirD,KAAKe,SAAU,CACrDpwD,EAAG,EACHC,IAGJD,EAAI,GACJhV,KAAKpB,KAAKwa,MAAM6rD,UAAUjlE,KAAKpB,KAAKwa,MAAMirD,KAAKgB,SAAU,CACrDrwD,EAAGhV,KAAKud,MAAQ,EAChBtI,IAKZyH,OAAOD,Q,2VCrLI,MAAM6oD,QAMjB,YACI,OAAOtlE,KAAK0hB,OAGhB,aACI,OAAO1hB,KAAK2hB,QAGhB,WACI,OAAO3hB,KAAK0hB,OAAS1hB,KAAK2hB,QAG9BlJ,YAAY8E,MAAOC,QAAQ,8BAjBlB,GAiBkB,+BAhBjB,GAgBiB,6BAfnB,IAemB,+BAdjB,IAAIyR,KAeVjvB,KAAK0hB,OAASnE,MACdvd,KAAK2hB,QAAUnE,OAEf,IAAK,IAAI5b,EAAI,EAAGA,EAAI5B,KAAK+hB,KAAMngB,IAC3B5B,KAAKulE,MAAM3jE,GAAK,IAAI2yB,IAI5B1S,IAAI7M,EAAGC,GACH,OAAOA,EAAIjV,KAAKud,MAAQvI,EAG5B8M,MAAMD,KACF,MAAO,CACH7M,EAAG7I,KAAKyT,MAAMiC,IAAM7hB,KAAKud,OACzBtI,EAAG9I,KAAKyT,MAAMiC,IAAM7hB,KAAKud,QAIjCioD,YACI,OAAO/lE,MAAMC,KAAKM,KAAKylE,QAAQx0D,QAGnCsO,QACIvf,KAAKylE,QAAQlmD,QAEb,IAAK,IAAI3d,EAAI,EAAGA,EAAI5B,KAAK+hB,KAAMngB,IAC3B5B,KAAKulE,MAAM3jE,GAAG2d,QAItB4C,YACI,MAAMC,QAAUpiB,KAAKulE,MAAMzlE,KAAKg1B,GAAMr1B,MAAMC,KAAKo1B,KAEjD,MAAO,CACHvX,MAAOvd,KAAKud,MACZC,OAAQxd,KAAKwd,OACb4E,SAIRC,YAAYvP,MACR9S,KAAK0hB,OAAS5O,KAAKyK,MACnBvd,KAAK2hB,QAAU7O,KAAK0K,OACpBxd,KAAKylE,QAAU,IAAIx2C,IAEnB,IAAK,IAAIrtB,EAAI,EAAGA,EAAIkR,KAAKsP,QAAQvgB,OAAQD,IAAK,CAC1C,MAAMkgB,MAAQ9hB,KAAK8hB,MAAMlgB,GACzB5B,KAAKulE,MAAM3jE,GAAK,IAAI2yB,IAAIzhB,KAAKsP,QAAQxgB,IAErCkR,KAAKsP,QAAQxgB,GAAG2R,SAAS5H,KACrB3L,KAAKylE,QAAQ7kD,IAAIjV,GAAImW,WAKjClB,IAAI5L,EAAGC,EAAGtJ,IACN,GAAI3L,KAAKkiB,cAAclN,EAAGC,GAItB,YAHAzO,QAAQC,KAAR,kCAC+BkF,GAD/B,mCAC4DqJ,EAD5D,aACkEC,IAKtE,MAAM4M,IAAM7hB,KAAK6hB,IAAI7M,EAAGC,GAExBjV,KAAKkuB,OAAOviB,IAEZ3L,KAAKylE,QAAQ7kD,IAAIjV,GAAI,CAAEqJ,EAAGC,IAC1BjV,KAAKulE,MAAM1jD,KAAKsR,IAAIxnB,IAGxB2W,IAAItN,EAAGC,GACH,OAAIjV,KAAKkiB,cAAclN,EAAGC,GACf,GAGJxV,MAAMC,KAAKM,KAAKulE,MAAMvlE,KAAK6hB,IAAI7M,EAAGC,KAG7C+d,IAAIrnB,IACA,OAAO3L,KAAKylE,QAAQzyC,IAAIrnB,IAG5B24D,YAAY34D,IACR,MAAMoJ,IAAM/U,KAAKylE,QAAQnjD,IAAI3W,IAM7B,OAJKoJ,KACDvO,QAAQC,KAAK,sBAAuBkF,IAGjCoJ,IAGXmZ,OAAOviB,IACH,IAAK3L,KAAKgzB,IAAIrnB,IACV,OAGJ,MAAMoJ,IAAM/U,KAAKskE,YAAY34D,IACvBkW,IAAM7hB,KAAK6hB,IAAI9M,IAAIC,EAAGD,IAAIE,GAEhCjV,KAAKylE,QAAQC,OAAO/5D,IACpB3L,KAAKulE,MAAM1jD,KAAK6jD,OAAO/5D,IAG3BuW,cAAclN,EAAGC,GACb,OAAOD,EAAI,GAAKC,EAAI,GAAKD,GAAKhV,KAAKud,OAAStI,GAAKjV,KAAKwd,U,mYCrH/C,MAAM1C,kBAAkBgO,6CACnCrQ,YAAY7Z,MACRse,MAAMte,MAENoB,KAAK2lE,IAAM,IAAIC,8DAAyB,CAAC5wD,EAAGC,IACxCjV,KAAK6lE,gBAAgB7wD,EAAGC,KAG5BjV,KAAKo2B,MAAQp2B,KAAKpB,KAAKC,IAAIkqB,YAAY,CACnClpB,IAAK,CAACqyC,0DAId2zB,gBAAgB7wD,EAAGC,GACf,OAAQjV,KAAKpB,KAAKkB,IACb6oD,cAAc3zC,EAAGC,GACjBmgB,MAAMnyB,GAAMA,EAAE+vB,IAAIqQ,6DAG3ByiC,WAAW9wD,EAAGC,EAAG8wB,OAAQ2B,OACrB1nC,KAAKpB,KAAKkB,IAAI6oD,cAAc3zC,EAAGC,GAAG,GAAM1B,SAAStQ,IAC7CA,EAAEkwB,IAAI+e,uDAAW,CACbxK,MACA3B,SAEA9iC,EAAE8iE,aAAe9iE,EAAEglD,WACnBhlD,EAAEkwB,IAAIif,uDACFnvC,EAAE+iE,cACFhmE,KAAKpB,KAAK0b,SAAS2rD,wBAAwBhjE,OAM3Du3D,aACIx6D,KAAKo2B,MAAM9T,MAAM/O,SAAStQ,GAAMA,EAAE6qC,UAAU3f,YAE5C,MAAMpZ,IAAM/U,KAAKpB,KAAKib,OAAO2e,SAE7Bx4B,KAAK2lE,IAAIp8B,QAAQx0B,IAAIC,EAAGD,IAAIE,EAAG,GAAG,CAACD,EAAGC,EAAGiP,EAAGgiD,cACxClmE,KAAK8lE,WAAW9wD,EAAGC,EAAGixD,WAAYhiD,MAI1CxH,OAAOD,IACCzc,KAAKpB,KAAKma,MAAM8Q,WAChB7pB,KAAKw6D,gB,oqEC1CV,MAAM2L,KAAOC,uCAEPC,MAAQ7jC,wCAER8jC,KAAO5nD,wC,gNCbpB,MAAM6nD,KAAO,uBACb,MAAMC,IACF/tD,cACIzY,KAAKymE,MAAQ,EACbzmE,KAAK0mE,IAAM,EACX1mE,KAAK2mE,IAAM,EACX3mE,KAAK4mE,IAAM,EACX5mE,KAAK6mE,GAAK,EAEdC,UAAY,OAAO9mE,KAAKymE,MAIxBM,QAAQC,MASJ,OARAA,KAAQA,KAAO,EAAI,EAAIA,KAAOA,KAC9BhnE,KAAKymE,MAAQO,KACbhnE,KAAK0mE,KAAOM,OAAS,GAAKT,KAC1BS,KAAe,MAAPA,KAAe,IAAO,EAC9BhnE,KAAK2mE,IAAMK,KAAOT,KAClBS,KAAe,MAAPA,KAAe,IAAO,EAC9BhnE,KAAK4mE,IAAMI,KAAOT,KAClBvmE,KAAK6mE,GAAK,EACH7mE,KAKXinE,aACI,IAAInqD,EAAI,QAAU9c,KAAK0mE,IAAM1mE,KAAK6mE,GAAKN,KAKvC,OAJAvmE,KAAK0mE,IAAM1mE,KAAK2mE,IAChB3mE,KAAK2mE,IAAM3mE,KAAK4mE,IAChB5mE,KAAK6mE,GAAS,EAAJ/pD,EACV9c,KAAK4mE,IAAM9pD,EAAI9c,KAAK6mE,GACb7mE,KAAK4mE,IAOhBM,cAAcC,WAAYC,YACtB,IAAIh7D,IAAMD,KAAKC,IAAI+6D,WAAYC,YAC3Bt4D,IAAM3C,KAAK2C,IAAIq4D,WAAYC,YAC/B,OAAOj7D,KAAK41B,MAAM/hC,KAAKinE,cAAgB76D,IAAM0C,IAAM,IAAMA,IAO7Du4D,UAAUC,KAAO,EAAGC,OAAS,GACzB,IAAIC,EAAG/6C,EAAGvI,EACV,GACIsjD,EAAI,EAAIxnE,KAAKinE,aAAe,EAC5Bx6C,EAAI,EAAIzsB,KAAKinE,aAAe,EAC5B/iD,EAAIsjD,EAAIA,EAAI/6C,EAAIA,QACXvI,EAAI,GAAU,GAALA,GAElB,OAAOojD,KADKE,EAAIr7D,KAAKm8C,MAAM,EAAIn8C,KAAKoxB,IAAIrZ,GAAKA,GACvBqjD,OAK1BE,gBACI,OAAO,EAAIt7D,KAAK41B,MAA0B,IAApB/hC,KAAKinE,cAK/B/D,QAAQpyC,OACJ,OAAKA,MAAMjvB,OAGJivB,MAAM3kB,KAAK41B,MAAM/hC,KAAKinE,aAAen2C,MAAMjvB,SAFvC,KAOf6lE,QAAQ52C,OACJ,IAAIoO,OAAS,GACT9Q,MAAQ0C,MAAMvlB,QAClB,KAAO6iB,MAAMvsB,QAAQ,CACjB,IAAI2M,MAAQ4f,MAAM3f,QAAQzO,KAAKkjE,QAAQ90C,QACvC8Q,OAAOv4B,KAAKynB,MAAM1d,OAAOlC,MAAO,GAAG,IAEvC,OAAO0wB,OAMXyoC,iBAAiB70D,MACb,IAAI80D,MAAQ,EACZ,IAAK,IAAIj8D,MAAMmH,KACX80D,OAAS90D,KAAKnH,IAElB,IACIA,GADAq2B,OAAShiC,KAAKinE,aAAeW,MACzBC,KAAO,EACf,IAAKl8D,MAAMmH,KAEP,GADA+0D,MAAQ/0D,KAAKnH,IACTq2B,OAAS6lC,KACT,OAAOl8D,GAKf,OAAOA,GAMXm8D,WAAa,MAAO,CAAC9nE,KAAK0mE,IAAK1mE,KAAK2mE,IAAK3mE,KAAK4mE,IAAK5mE,KAAK6mE,IAIxDkB,SAASllE,OAKL,OAJA7C,KAAK0mE,IAAM7jE,MAAM,GACjB7C,KAAK2mE,IAAM9jE,MAAM,GACjB7C,KAAK4mE,IAAM/jE,MAAM,GACjB7C,KAAK6mE,GAAKhkE,MAAM,GACT7C,KAKXouB,QAEI,OADY,IAAIo4C,KACHuB,SAAS/nE,KAAK8nE,aAGnC,kCAAe,IAAItB,KAAMO,QAAQx3D,KAAKC,Q,opBChItC,MAAMw4D,SAAW,CACb,IAAOC,6CACP,KAAQC,8CACR,KAAQC,8CACR,UAAWC,iDACX,KAAQC,+CAENC,gBAAkB,CACpB/qD,MAAOgrD,yDACP/qD,OAAQgrD,0DACRC,WAAW,EACXC,OAAQ,OACRC,SAAU,GACVC,QAAS,EACTC,OAAQ,EACRC,kBAAkB,EAClBC,WAAY,YACZC,UAAW,GACXC,GAAI,OACJ7qD,GAAI,OACJX,UAAW,GACXC,WAAY,GACZwrD,QAAS,GACTC,QAAS,KACTC,cAAc,GAuOlB,iCAlO4B,MACxB,MAAM9rD,QACF7E,YAAY8S,QAAU,IAClBvrB,KAAKulE,MAAQ,GACbvlE,KAAKqpE,QAAS,EACdrpE,KAAKspE,SAAW,GAChB/9C,QAAUra,OAAOq4D,OAAO,GAAIjB,gBAAiB/8C,SAC7CvrB,KAAKwpE,WAAWj+C,SAChBvrB,KAAKypE,MAAQzpE,KAAKypE,MAAMt8D,KAAKnN,MAC7BA,KAAK0pE,MAAQ1pE,KAAK0pE,MAAMv8D,KAAKnN,MAC7BA,KAAK2pE,SAASC,SAAS5pE,KAAK0pE,OAQhCD,MAAMz0D,EAAGC,EAAG40D,MACR,IAAIC,OAAS,CAAC9pE,KAAKspE,SAASlrD,GAAIpe,KAAKspE,SAASL,IAC9CjpE,KAAKge,KAAKhJ,EAAGC,EAAG,KAAM,KAAM60D,OAAOD,KAAOC,OAAOjoE,SAKrD0d,QACIvf,KAAKulE,MAAQ,GACbvlE,KAAKqpE,QAAS,EAKlBG,WAAWj+C,SAEP,GADAra,OAAOq4D,OAAOvpE,KAAKspE,SAAU/9C,SACzBA,QAAQhO,OAASgO,QAAQ/N,QAAU+N,QAAQo9C,UAAYp9C,QAAQw9C,YAAcx9C,QAAQq9C,SAAWr9C,QAAQm9C,OAAQ,CAChH,GAAIn9C,QAAQm9C,OAAQ,CAChB,IAAIqB,KAAO/B,SAASz8C,QAAQm9C,QAC5B1oE,KAAK2pE,SAAW,IAAII,KAExB/pE,KAAK2pE,SAASH,WAAWxpE,KAAKspE,UAC9BtpE,KAAKqpE,QAAS,EAElB,OAAOrpE,KAKXgqE,aAAe,OAAOhqE,KAAKspE,SAI3BW,eAAiB,OAAOjqE,KAAK2pE,SAASM,eAOtCC,YAAYC,WAAYC,aACpB,OAAOpqE,KAAK2pE,SAASO,YAAYC,WAAYC,aAQjDC,gBAAgBF,WAAYC,aACxB,OAAOpqE,KAAK2pE,SAASU,gBAAgBF,WAAYC,aAErDE,gBAAgBH,WAAYC,aAGxB,MAAO,CAFKj+D,KAAK41B,MAAMooC,WAAanqE,KAAKspE,SAAS/rD,OACrCpR,KAAK41B,MAAMqoC,YAAcpqE,KAAKspE,SAAS9rD,SAQxD+sD,gBAAgBtnE,GACZ,IAAI+R,EAAGC,EASP,MARI,YAAahS,GACb+R,EAAI/R,EAAEunE,QAAQ,GAAGC,QACjBx1D,EAAIhS,EAAEunE,QAAQ,GAAGE,UAGjB11D,EAAI/R,EAAEwnE,QACNx1D,EAAIhS,EAAEynE,SAEH1qE,KAAK2pE,SAASY,gBAAgBv1D,EAAGC,GAS5C+I,KAAKhJ,EAAGC,EAAGstB,GAAI0mC,GAAI7qD,IACV6qD,KACDA,GAAKjpE,KAAKspE,SAASL,IAElB7qD,KACDA,GAAKpe,KAAKspE,SAASlrD,IAEvB,IAAI5K,IAAM,GAAH,OAAMwB,EAAN,YAAWC,GAClBjV,KAAKulE,MAAM/xD,KAAO,CAACwB,EAAGC,EAAGstB,GAAI0mC,GAAI7qD,KACb,IAAhBpe,KAAKqpE,SAGJrpE,KAAKqpE,SACNrpE,KAAKqpE,OAAS,IAElBrpE,KAAKqpE,OAAO71D,MAAO,GAUvBqL,SAAS7J,EAAGC,EAAGyJ,KAAMisD,UACjB,IAAI1B,GAAK,KACL7qD,GAAK,KACLwsD,GAAK51D,EACL61D,GAAK51D,EACL61D,MAAQ,EACPH,WACDA,SAAW3qE,KAAKspE,SAAS/rD,MAAQvI,GAErC,IAAI+1D,OAASzE,+CAAc5nD,KAAMisD,UACjC,KAAOI,OAAOlpE,QAAQ,CAClB,IAAImpE,MAAQD,OAAOx5D,QACnB,OAAQy5D,MAAM3yD,MACV,KAAKiuD,gDACD,IAAI2E,SAAU,EAAOC,aAAc,EAAOC,aAAc,EAAOC,iBAAkB,EACjF,IAAK,IAAIxpE,EAAI,EAAGA,EAAIopE,MAAM/oD,MAAMpgB,OAAQD,IAAK,CACzC,IAAIypE,GAAKL,MAAM/oD,MAAM/O,WAAWtR,GAC5Byf,EAAI2pD,MAAM/oD,MAAM9C,OAAOvd,GAC3B,GAA6B,SAAzB5B,KAAKspE,SAASZ,OAAmB,CACjC,IAAI4C,IAAMD,IAAM,EAEhB,GADoB,KAARC,KAAiBA,KAAO,IAAQA,KAAO,KAAUA,KAAO,KAAQA,KAAO,KAAUD,IAAM,OAAUA,IAAM,MACxG,CACPrrE,KAAKge,KAAK4sD,GAAK,EAAGC,GAAIxpD,EAAG4nD,GAAI7qD,IAC7Bpe,KAAKge,KAAK4sD,GAAK,EAAGC,GAAI,KAAM5B,GAAI7qD,IAChCwsD,IAAM,EACN,UAIRO,YAAeE,GAAK,OAAUA,GAAK,OAAYA,GAAK,OAAUA,GAAK,OAAWA,GAAK,MAEnFJ,QAA8B,IAAnB5pD,EAAEnO,WAAW,IAAiC,OAAnBmO,EAAEnO,WAAW,IAG/Ck4D,iBAAoBD,aAAgBF,SACpCL,KAIAO,cAAgBD,aAChBN,KAEJ5qE,KAAKge,KAAK4sD,KAAMC,GAAIxpD,EAAG4nD,GAAI7qD,IAC3B8sD,YAAcD,QACdG,gBAAkBD,YAEtB,MACJ,KAAK7E,8CACD2C,GAAK+B,MAAM/oD,OAAS,KACpB,MACJ,KAAKqkD,8CACDloD,GAAK4sD,MAAM/oD,OAAS,KACpB,MACJ,KAAKqkD,mDACDsE,GAAK51D,EACL61D,KACAC,SAIZ,OAAOA,MAKXpB,QAEI,GADA1pE,KAAK2pE,SAASC,SAAS5pE,KAAK0pE,OACvB1pE,KAAKqpE,OAAV,CAGA,IAAoB,IAAhBrpE,KAAKqpE,OAAiB,CACtBrpE,KAAK2pE,SAASpqD,QACd,IAAK,IAAI5T,MAAM3L,KAAKulE,MAChBvlE,KAAKurE,MAAM5/D,IAAI,QAInB,IAAK,IAAI6H,OAAOxT,KAAKqpE,OACjBrpE,KAAKurE,MAAM/3D,KAAK,GAGxBxT,KAAKqpE,QAAS,GAMlBkC,MAAM/3D,IAAKg4D,aACP,IAAI14D,KAAO9S,KAAKulE,MAAM/xD,KAClBV,KAAK,IAAM9S,KAAKspE,SAASlrD,KACzBotD,aAAc,GAElBxrE,KAAK2pE,SAAS3rD,KAAKlL,KAAM04D,cAQjC,OALAluD,QAAQ4qD,KAAOA,8CACf5qD,QAAQ2qD,IAAMA,6CACd3qD,QAAQ6qD,KAAOA,8CACf7qD,QAAQ8qD,OAASA,iDACjB9qD,QAAQ+qD,KAAOA,8CACR/qD,SAhOiB,I,6TC9Bb,MAAM2qD,YAAYwD,gDAC7BhzD,cACIyE,QACAld,KAAK0rE,UAAY,EACjB1rE,KAAK2rE,UAAY,EACjB3rE,KAAK4rE,SAAW,EAEpB5tD,KAAKlL,KAAM04D,aACP,IAAKx2D,EAAGC,EAAGstB,GAAI0mC,GAAI7qD,IAAMtL,KACrB+4D,GAAK,EACJ72D,EAAI,GAAKhV,KAAK0rE,UACfz2D,EAAIjV,KAAK2rE,UAAY3rE,KAAK4rE,UAS9B,GAPI5rE,KAAKspE,SAASb,WACdoD,GAAGC,UAEHN,cACAxrE,KAAK+rE,KAAKjrD,UAAY1C,GACtBpe,KAAKgsE,MAAMH,GAAG,GAAIA,GAAG,MAEpBtpC,GACD,OAEJviC,KAAK+rE,KAAKjrD,UAAYmoD,GACtB,IAAIgD,MAAQ,GAAGC,OAAO3pC,IACtB,IAAK,IAAI3gC,EAAI,EAAGA,EAAIqqE,MAAMpqE,OAAQD,IAC9B5B,KAAK+rE,KAAKI,SAASF,MAAMrqE,GAAIiqE,GAAG,GAAI1/D,KAAKwG,KAAKk5D,GAAG,KAGzD3B,YAAYC,WAAYC,aAQpB,OAPIpqE,KAAKspE,SAASb,YACd0B,YAAcC,YAEdD,YADAC,YAAcD,WAAaC,aAKxB,CAFKj+D,KAAK41B,MAAMooC,WAAanqE,KAAK0rE,WAAa,EACzCv/D,KAAK41B,OAAOqoC,YAAc,EAAIpqE,KAAK4rE,UAAY5rE,KAAK2rE,UAAY,IAGjFtB,gBAAgBF,WAAYC,aACpBpqE,KAAKspE,SAASb,YACd0B,YAAcC,YAEdD,YADAC,YAAcD,WAAaC,aAG/B,IAAIgC,aAAe,EAAIjC,aAAenqE,KAAKspE,SAAS/rD,MAAQ,GAAKpR,KAAKm8C,KAAK,IAAM,EAC7E+jB,cAAgBjC,aAAe,EAAI,KAAOpqE,KAAKspE,SAAS9rD,OAAS,IACjE8uD,QAAUngE,KAAK2C,IAAIs9D,aAAcC,eAEjCE,QAAUvsE,KAAK+rE,KAAK1sD,KACxBrf,KAAK+rE,KAAK1sD,KAAO,SAAWrf,KAAKspE,SAASP,WAC1C,IAAIxrD,MAAQpR,KAAKwG,KAAK3S,KAAK+rE,KAAKS,YAAY,KAAKjvD,OACjDvd,KAAK+rE,KAAK1sD,KAAOktD,QACjB,IAAIE,MAAQlvD,MAAQ,IACpB+uD,QAAUngE,KAAK41B,MAAMuqC,SAAW,EAEhC,IAAI3D,SAAW,EAAI2D,SAAWtsE,KAAKspE,SAASV,SAAW,EAAI6D,MAAQtgE,KAAKm8C,KAAK,KAE7E,OAAOn8C,KAAKwG,KAAKg2D,UAAY,EAEjC+D,2BAA2B13D,EAAGC,GAC1B,IAAI03D,SACA3sE,KAAKspE,SAASb,WACdzzD,GAAKC,EAELD,GADAC,EAAID,EAAIC,EAER03D,SAAW3sE,KAAK+rE,KAAK9uD,OAAOM,OAG5BovD,SAAW3sE,KAAK+rE,KAAK9uD,OAAOO,OAEhC,IAAIuE,KAAO4qD,SAAW3sE,KAAKspE,SAAS9rD,OASpC,OARAvI,EAAI9I,KAAK41B,MAAM9sB,EAAI8M,OACfmoB,6CAAIj1B,EAAG,IACPD,GAAKhV,KAAK0rE,UACV12D,EAAI,EAAI,EAAI7I,KAAK41B,MAAM/sB,GAAK,EAAIhV,KAAK0rE,aAGrC12D,EAAI,EAAI7I,KAAK41B,MAAM/sB,GAAK,EAAIhV,KAAK0rE,YAE9B,CAAC12D,EAAGC,GAKf+2D,MAAMpB,GAAIC,IACN,IAAIxmD,EAAIrkB,KAAK4rE,SACTxnD,EAAIpkB,KAAKspE,SAAST,OACtB,MAAM3nE,IAAMlB,KAAK+rE,KACjB7qE,IAAI0rE,YACA5sE,KAAKspE,SAASb,WACdvnE,IAAI2rE,OAAOjC,GAAKvmD,EAAID,EAAGymD,IACvB3pE,IAAI4rE,OAAOlC,GAAKvmD,EAAI,EAAID,EAAGymD,GAAK7qE,KAAK0rE,UAAYtnD,GACjDljB,IAAI4rE,OAAOlC,GAAKvmD,EAAI,EAAID,EAAGymD,GAAK7qE,KAAK0rE,UAAYtnD,GACjDljB,IAAI4rE,OAAOlC,GAAKvmD,EAAID,EAAGymD,IACvB3pE,IAAI4rE,OAAOlC,GAAKvmD,EAAI,EAAID,EAAGymD,GAAK7qE,KAAK0rE,UAAYtnD,GACjDljB,IAAI4rE,OAAOlC,GAAKvmD,EAAI,EAAID,EAAGymD,GAAK7qE,KAAK0rE,UAAYtnD,GACjDljB,IAAI4rE,OAAOlC,GAAKvmD,EAAID,EAAGymD,MAGvB3pE,IAAI2rE,OAAOjC,GAAIC,GAAKxmD,EAAID,GACxBljB,IAAI4rE,OAAOlC,GAAK5qE,KAAK0rE,UAAYtnD,EAAGymD,GAAKxmD,EAAI,EAAID,GACjDljB,IAAI4rE,OAAOlC,GAAK5qE,KAAK0rE,UAAYtnD,EAAGymD,GAAKxmD,EAAI,EAAID,GACjDljB,IAAI4rE,OAAOlC,GAAIC,GAAKxmD,EAAID,GACxBljB,IAAI4rE,OAAOlC,GAAK5qE,KAAK0rE,UAAYtnD,EAAGymD,GAAKxmD,EAAI,EAAID,GACjDljB,IAAI4rE,OAAOlC,GAAK5qE,KAAK0rE,UAAYtnD,EAAGymD,GAAKxmD,EAAI,EAAID,GACjDljB,IAAI4rE,OAAOlC,GAAIC,GAAKxmD,EAAID,IAE5BljB,IAAI6rE,OAERC,cACI,MAAMvgC,KAAOzsC,KAAKspE,SACZ2D,UAAY9gE,KAAKwG,KAAK3S,KAAK+rE,KAAKS,YAAY,KAAKjvD,OAIvD,IAAI2vD,MACAC,MAJJntE,KAAK4rE,SAAWz/D,KAAK41B,MAAM0K,KAAKm8B,SAAWn8B,KAAKk8B,SAAWsE,UAAY9gE,KAAKm8C,KAAK,IAAM,GACvFtoD,KAAK0rE,UAAY1rE,KAAK4rE,SAAWz/D,KAAKm8C,KAAK,GAAK,EAChDtoD,KAAK2rE,UAA4B,IAAhB3rE,KAAK4rE,SAGlBn/B,KAAKg8B,WACLyE,MAAQ,SACRC,MAAQ,UAGRD,MAAQ,QACRC,MAAQ,UAEZntE,KAAK+rE,KAAK9uD,OAAOiwD,OAAS/gE,KAAKwG,MAAM85B,KAAKlvB,MAAQ,GAAKvd,KAAK0rE,WAC5D1rE,KAAK+rE,KAAK9uD,OAAOkwD,OAAShhE,KAAKwG,MAAM85B,KAAKjvB,OAAS,GAAKxd,KAAK2rE,UAAY,EAAI3rE,KAAK4rE,a,kQCpI3E,MAAMH,eAAe2B,iDAChC30D,cACIyE,QACAld,KAAK+rE,KAAOpsE,SAASugB,cAAc,UAAUC,WAAW,MAE5DypD,SAASh0C,IAAMrZ,sBAAsBqZ,IACrCq0C,eAAiB,OAAOjqE,KAAK+rE,KAAK9uD,OAClCusD,WAAW/8B,MACPvvB,MAAMssD,WAAW/8B,MACjB,MAAMhsB,MAASgsB,KAAKu8B,UAAL,UAAoBv8B,KAAKu8B,UAAzB,QACT3pD,KAAO,GAAH,OAAMoB,MAAN,YAAegsB,KAAKk8B,SAApB,cAAkCl8B,KAAKs8B,YACjD/oE,KAAK+rE,KAAK1sD,KAAOA,KACjBrf,KAAKgtE,cACLhtE,KAAK+rE,KAAK1sD,KAAOA,KACjBrf,KAAK+rE,KAAKsB,UAAY,SACtBrtE,KAAK+rE,KAAKzrD,aAAe,SAE7Bf,QACIvf,KAAK+rE,KAAKjrD,UAAY9gB,KAAKspE,SAASlrD,GACpCpe,KAAK+rE,KAAK/qD,SAAS,EAAG,EAAGhhB,KAAK+rE,KAAK9uD,OAAOM,MAAOvd,KAAK+rE,KAAK9uD,OAAOO,QAEtE+sD,gBAAgBv1D,EAAGC,GACf,IAAIgI,OAASjd,KAAK+rE,KAAK9uD,OACnBqwD,KAAOrwD,OAAOswD,wBAKlB,OAJAv4D,GAAKs4D,KAAKxuD,KACV7J,GAAKq4D,KAAKnP,IACVnpD,GAAKiI,OAAOM,MAAQ+vD,KAAK/vD,MACzBtI,GAAKgI,OAAOO,OAAS8vD,KAAK9vD,OACtBxI,EAAI,GAAKC,EAAI,GAAKD,GAAKiI,OAAOM,OAAStI,GAAKgI,OAAOO,OAC5C,EAAE,GAAI,GAEVxd,KAAK0sE,2BAA2B13D,EAAGC,M,6LC5BnC,MAAMm4D,QACjBnD,eAAiB,OAAO,KACxBT,WAAWj+C,SAAWvrB,KAAKspE,SAAW/9C,W,qRCsG1C,iCAvGyB,MACrB,MAAM28C,aAAauD,gDACfhzD,cACIyE,QACAld,KAAK0rE,UAAY,EACjB1rE,KAAK2rE,UAAY,EACjB3rE,KAAKwtE,aAAe,GAExBhE,WAAWj+C,SACPrO,MAAMssD,WAAWj+C,SACjBvrB,KAAKwtE,aAAe,GAExBxvD,KAAKlL,KAAM04D,aACHtD,KAAKt3D,MACL5Q,KAAKytE,eAAe36D,MAGpB9S,KAAK0tE,aAAa56D,KAAM04D,aAGhCiC,eAAe36D,MACX,IAEImK,QAFCjI,EAAGC,EAAGstB,GAAI0mC,GAAI7qD,IAAMtL,KACrB66D,KAAO,GAAKprC,GAAK0mC,GAAK7qD,GAE1B,GAAIuvD,QAAQ3tE,KAAKwtE,aACbvwD,OAASjd,KAAKwtE,aAAaG,UAE1B,CACD,IAAIvpD,EAAIpkB,KAAKspE,SAAST,OACtB5rD,OAAStd,SAASugB,cAAc,UAChC,IAAIhf,IAAM+b,OAAOkD,WAAW,MAK5B,GAJAlD,OAAOM,MAAQvd,KAAK0rE,UACpBzuD,OAAOO,OAASxd,KAAK2rE,UACrBzqE,IAAI4f,UAAY1C,GAChBld,IAAI8f,SAASoD,EAAGA,EAAGnH,OAAOM,MAAQ6G,EAAGnH,OAAOO,OAAS4G,GACjDme,GAAI,CACJrhC,IAAI4f,UAAYmoD,GAChB/nE,IAAIme,KAAOrf,KAAK+rE,KAAK1sD,KACrBne,IAAImsE,UAAY,SAChBnsE,IAAIof,aAAe,SACnB,IAAI2rD,MAAQ,GAAGC,OAAO3pC,IACtB,IAAK,IAAI3gC,EAAI,EAAGA,EAAIqqE,MAAMpqE,OAAQD,IAC9BV,IAAIirE,SAASF,MAAMrqE,GAAI5B,KAAK0rE,UAAY,EAAGv/D,KAAKwG,KAAK3S,KAAK2rE,UAAY,IAG9E3rE,KAAKwtE,aAAaG,MAAQ1wD,OAE9Bjd,KAAK+rE,KAAKtqD,UAAUxE,OAAQjI,EAAIhV,KAAK0rE,UAAWz2D,EAAIjV,KAAK2rE,WAE7D+B,aAAa56D,KAAM04D,aACf,IAAKx2D,EAAGC,EAAGstB,GAAI0mC,GAAI7qD,IAAMtL,KACzB,GAAI04D,YAAa,CACb,IAAIpnD,EAAIpkB,KAAKspE,SAAST,OACtB7oE,KAAK+rE,KAAKjrD,UAAY1C,GACtBpe,KAAK+rE,KAAK/qD,SAAShM,EAAIhV,KAAK0rE,UAAYtnD,EAAGnP,EAAIjV,KAAK2rE,UAAYvnD,EAAGpkB,KAAK0rE,UAAYtnD,EAAGpkB,KAAK2rE,UAAYvnD,GAE5G,IAAKme,GACD,OAEJviC,KAAK+rE,KAAKjrD,UAAYmoD,GACtB,IAAIgD,MAAQ,GAAGC,OAAO3pC,IACtB,IAAK,IAAI3gC,EAAI,EAAGA,EAAIqqE,MAAMpqE,OAAQD,IAC9B5B,KAAK+rE,KAAKI,SAASF,MAAMrqE,IAAKoT,EAAI,IAAOhV,KAAK0rE,UAAWv/D,KAAKwG,MAAMsC,EAAI,IAAOjV,KAAK2rE,YAG5FzB,YAAYC,WAAYC,aAGpB,MAAO,CAFKj+D,KAAK41B,MAAMooC,WAAanqE,KAAK0rE,WAC5Bv/D,KAAK41B,MAAMqoC,YAAcpqE,KAAK2rE,YAG/CtB,gBAAgBF,WAAYC,aACxB,IAAIwD,SAAWzhE,KAAK41B,MAAMooC,WAAanqE,KAAKspE,SAAS/rD,OACjDswD,UAAY1hE,KAAK41B,MAAMqoC,YAAcpqE,KAAKspE,SAAS9rD,QAEnD+uD,QAAUvsE,KAAK+rE,KAAK1sD,KACxBrf,KAAK+rE,KAAK1sD,KAAO,SAAWrf,KAAKspE,SAASP,WAC1C,IAAIxrD,MAAQpR,KAAKwG,KAAK3S,KAAK+rE,KAAKS,YAAY,KAAKjvD,OACjDvd,KAAK+rE,KAAK1sD,KAAOktD,QACjB,IACIuB,cADQvwD,MAAQ,IACQswD,UAAYD,SAIxC,OAHIE,cAAgB,IAChBD,UAAY1hE,KAAK41B,MAAM8rC,UAAYC,gBAEhC3hE,KAAK41B,MAAM8rC,UAAY7tE,KAAKspE,SAASV,SAEhD8D,2BAA2B13D,EAAGC,GAC1B,MAAO,CAAC9I,KAAK41B,MAAM/sB,EAAIhV,KAAK0rE,WAAYv/D,KAAK41B,MAAM9sB,EAAIjV,KAAK2rE,YAEhEqB,cACI,MAAMvgC,KAAOzsC,KAAKspE,SACZ2D,UAAY9gE,KAAKwG,KAAK3S,KAAK+rE,KAAKS,YAAY,KAAKjvD,OACvDvd,KAAK0rE,UAAYv/D,KAAKwG,KAAK85B,KAAKm8B,QAAUqE,WAC1CjtE,KAAK2rE,UAAYx/D,KAAKwG,KAAK85B,KAAKm8B,QAAUn8B,KAAKk8B,UAC3Cl8B,KAAKq8B,mBACL9oE,KAAK0rE,UAAY1rE,KAAK2rE,UAAYx/D,KAAKC,IAAIpM,KAAK0rE,UAAW1rE,KAAK2rE,YAEpE3rE,KAAK+rE,KAAK9uD,OAAOM,MAAQkvB,KAAKlvB,MAAQvd,KAAK0rE,UAC3C1rE,KAAK+rE,KAAK9uD,OAAOO,OAASivB,KAAKjvB,OAASxd,KAAK2rE,WAIrD,OADAzD,KAAKt3D,OAAQ,EACNs3D,MArGc,I,+PCAV,MAAMC,aAAasD,gDAC9BhzD,cACIyE,QACAld,KAAK+tE,aAAepuE,SAASugB,cAAc,UAE/ClC,KAAKlL,KAAM04D,aACP,IAAKx2D,EAAGC,EAAGstB,GAAI0mC,GAAI7qD,IAAMtL,KACrB2K,UAAYzd,KAAKspE,SAAS7rD,UAC1BC,WAAa1d,KAAKspE,SAAS5rD,WAU/B,GATI8tD,cACIxrE,KAAKspE,SAASF,aACdppE,KAAK+rE,KAAKiC,UAAUh5D,EAAIyI,UAAWxI,EAAIyI,WAAYD,UAAWC,aAG9D1d,KAAK+rE,KAAKjrD,UAAY1C,GACtBpe,KAAK+rE,KAAK/qD,SAAShM,EAAIyI,UAAWxI,EAAIyI,WAAYD,UAAWC,eAGhE6kB,GACD,OAEJ,IAAI0pC,MAAQ,GAAGC,OAAO3pC,IAClB0rC,IAAM,GAAG/B,OAAOjD,IAChB/0B,IAAM,GAAGg4B,OAAO9tD,IACpB,IAAK,IAAIxc,EAAI,EAAGA,EAAIqqE,MAAMpqE,OAAQD,IAAK,CACnC,IAAIssE,KAAOluE,KAAKspE,SAASJ,QAAQ+C,MAAMrqE,IACvC,IAAKssE,KACD,MAAM,IAAIn9C,MAAJ,gBAAmBk7C,MAAMrqE,GAAzB,2BAEV,GAAI5B,KAAKspE,SAASF,aAAc,CAC5B,IAAInsD,OAASjd,KAAK+tE,aACdI,QAAUlxD,OAAOkD,WAAW,MAChCguD,QAAQ9tD,yBAA2B,cACnC8tD,QAAQH,UAAU,EAAG,EAAGvwD,UAAWC,YACnC,IAAIurD,GAAKgF,IAAIrsE,GACTwc,GAAK81B,IAAItyC,GACbusE,QAAQ1sD,UAAUzhB,KAAKspE,SAASH,QAAS+E,KAAK,GAAIA,KAAK,GAAIzwD,UAAWC,WAAY,EAAG,EAAGD,UAAWC,YACzF,eAANurD,KACAkF,QAAQrtD,UAAYmoD,GACpBkF,QAAQ9tD,yBAA2B,cACnC8tD,QAAQntD,SAAS,EAAG,EAAGvD,UAAWC,aAE5B,eAANU,KACA+vD,QAAQrtD,UAAY1C,GACpB+vD,QAAQ9tD,yBAA2B,mBACnC8tD,QAAQntD,SAAS,EAAG,EAAGvD,UAAWC,aAEtC1d,KAAK+rE,KAAKtqD,UAAUxE,OAAQjI,EAAIyI,UAAWxI,EAAIyI,WAAYD,UAAWC,iBAGtE1d,KAAK+rE,KAAKtqD,UAAUzhB,KAAKspE,SAASH,QAAS+E,KAAK,GAAIA,KAAK,GAAIzwD,UAAWC,WAAY1I,EAAIyI,UAAWxI,EAAIyI,WAAYD,UAAWC,aAI1IwsD,YAAYC,WAAYC,aAGpB,MAAO,CAFKj+D,KAAK41B,MAAMooC,WAAanqE,KAAKspE,SAAS7rD,WACrCtR,KAAK41B,MAAMqoC,YAAcpqE,KAAKspE,SAAS5rD,aAGxD2sD,kBACI,MAAM,IAAIt5C,MAAM,8CAEpB27C,2BAA2B13D,EAAGC,GAC1B,MAAO,CAAC9I,KAAK41B,MAAM/sB,EAAIhV,KAAKspE,SAAS7rD,WAAYtR,KAAK41B,MAAM9sB,EAAIjV,KAAKspE,SAAS5rD,aAElFsvD,cACI,MAAMvgC,KAAOzsC,KAAKspE,SAClBtpE,KAAK+rE,KAAK9uD,OAAOM,MAAQkvB,KAAKlvB,MAAQkvB,KAAKhvB,UAC3Czd,KAAK+rE,KAAK9uD,OAAOO,OAASivB,KAAKjvB,OAASivB,KAAK/uB,WAC7C1d,KAAK+tE,aAAaxwD,MAAQkvB,KAAKhvB,UAC/Bzd,KAAK+tE,aAAavwD,OAASivB,KAAK/uB,c,kUCrEzB,MAAM0qD,eAAegF,iDAChC30D,cACIyE,QACAld,KAAKouE,UAAY,GACjB,IACIpuE,KAAKquE,IAAMruE,KAAKsuE,aAEpB,MAAOrrE,GACHsrE,MAAMtrE,EAAE0qC,UAGhB,qBACI,QAAShuC,SAASugB,cAAc,UAAUC,WAAW,SAAU,CAAEquD,uBAAuB,IAE5F5E,SAASh0C,IAAMrZ,sBAAsBqZ,IACrCq0C,eAAiB,OAAOjqE,KAAKquE,IAAIpxD,OACjCusD,WAAW/8B,MACPvvB,MAAMssD,WAAW/8B,MACjBzsC,KAAKgtE,cACL,IAAI7D,QAAUnpE,KAAKspE,SAASH,QACxBA,SAAW,aAAcA,UAAYA,QAAQ9pE,SAC7C8pE,QAAQ7pE,iBAAiB,QAAQ,IAAMU,KAAKyuE,eAAetF,WAG3DnpE,KAAKyuE,eAAetF,SAG5BnrD,KAAKlL,KAAM04D,aACP,MAAMkD,GAAK1uE,KAAKquE,IACV5hC,KAAOzsC,KAAKspE,SAClB,IAAKt0D,EAAGC,EAAGstB,GAAI0mC,GAAI7qD,IAAMtL,KACrB67D,SAAWD,GAAGzxD,OAAOO,QAAUvI,EAAI,GAAKw3B,KAAK/uB,WAWjD,GAVAgxD,GAAGE,QAAQ55D,EAAIy3B,KAAKhvB,UAAWkxD,SAAUliC,KAAKhvB,UAAWgvB,KAAK/uB,YAC1D8tD,cACI/+B,KAAK28B,aACLsF,GAAG3tD,WAAW,EAAG,EAAG,EAAG,GAGvB2tD,GAAG3tD,cAAc6C,WAAWxF,KAEhCswD,GAAGnvD,MAAMmvD,GAAGG,oBAEXtsC,GACD,OAEJ,IAAI0pC,MAAQ,GAAGC,OAAO3pC,IAClB2R,IAAM,GAAGg4B,OAAO9tD,IAChB6vD,IAAM,GAAG/B,OAAOjD,IACpByF,GAAGI,WAAW9uE,KAAKouE,UAAL,aAAgC,CAACp5D,EAAGC,IAClD,IAAK,IAAIrT,EAAI,EAAGA,EAAIqqE,MAAMpqE,OAAQD,IAAK,CACnC,IAAIssE,KAAOluE,KAAKspE,SAASJ,QAAQ+C,MAAMrqE,IACvC,IAAKssE,KACD,MAAM,IAAIn9C,MAAJ,gBAAmBk7C,MAAMrqE,GAAzB,2BAEV8sE,GAAGK,UAAU/uE,KAAKouE,UAAL,SAA4B3hC,KAAK28B,aAAe,EAAI,GACjEsF,GAAGI,WAAW9uE,KAAKouE,UAAL,cAAiCF,MAC3CzhC,KAAK28B,eACLsF,GAAGM,WAAWhvE,KAAKouE,UAAL,KAAwBxqD,WAAWqqD,IAAIrsE,KACrD8sE,GAAGM,WAAWhvE,KAAKouE,UAAL,GAAsBxqD,WAAWswB,IAAItyC,MAEvD8sE,GAAGO,WAAWP,GAAGQ,eAAgB,EAAG,IA8C5C3vD,QACI,MAAMmvD,GAAK1uE,KAAKquE,IAChBK,GAAG3tD,cAAc6C,WAAW5jB,KAAKspE,SAASlrD,KAC1CswD,GAAGE,QAAQ,EAAG,EAAGF,GAAGzxD,OAAOM,MAAOmxD,GAAGzxD,OAAOO,QAC5CkxD,GAAGnvD,MAAMmvD,GAAGG,kBAEhB3E,YAAYC,WAAYC,aAGpB,MAAO,CAFKj+D,KAAK41B,MAAMooC,WAAanqE,KAAKspE,SAAS7rD,WACrCtR,KAAK41B,MAAMqoC,YAAcpqE,KAAKspE,SAAS5rD,aAGxD2sD,kBACI,MAAM,IAAIt5C,MAAM,8CAEpBw5C,gBAAgBv1D,EAAGC,GACf,IAAIgI,OAASjd,KAAKquE,IAAIpxD,OAClBqwD,KAAOrwD,OAAOswD,wBAKlB,OAJAv4D,GAAKs4D,KAAKxuD,KACV7J,GAAKq4D,KAAKnP,IACVnpD,GAAKiI,OAAOM,MAAQ+vD,KAAK/vD,MACzBtI,GAAKgI,OAAOO,OAAS8vD,KAAK9vD,OACtBxI,EAAI,GAAKC,EAAI,GAAKD,GAAKiI,OAAOM,OAAStI,GAAKgI,OAAOO,OAC5C,EAAE,GAAI,GAEVxd,KAAK0sE,2BAA2B13D,EAAGC,GAE9Cq5D,aACI,IAAII,GAAK/uE,SAASugB,cAAc,UAAUC,WAAW,SAAU,CAAEquD,uBAAuB,IACxF7vE,OAAO+vE,GAAKA,GACZ,IAAIS,QAuEZ,SAAuBT,GAAIU,IAAKC,KAC5B,MAAMC,GAAKZ,GAAGa,aAAab,GAAGc,eAG9B,GAFAd,GAAGe,aAAaH,GAAIF,KACpBV,GAAGgB,cAAcJ,KACZZ,GAAGiB,mBAAmBL,GAAIZ,GAAGkB,gBAC9B,MAAM,IAAI7+C,MAAM29C,GAAGmB,iBAAiBP,KAAO,IAE/C,MAAMQ,GAAKpB,GAAGa,aAAab,GAAGqB,iBAG9B,GAFArB,GAAGe,aAAaK,GAAIT,KACpBX,GAAGgB,cAAcI,KACZpB,GAAGiB,mBAAmBG,GAAIpB,GAAGkB,gBAC9B,MAAM,IAAI7+C,MAAM29C,GAAGmB,iBAAiBC,KAAO,IAE/C,MAAME,EAAItB,GAAGuB,gBAIb,GAHAvB,GAAGwB,aAAaF,EAAGV,IACnBZ,GAAGwB,aAAaF,EAAGF,IACnBpB,GAAGyB,YAAYH,IACVtB,GAAG0B,oBAAoBJ,EAAGtB,GAAG2B,aAC9B,MAAM,IAAIt/C,MAAM29C,GAAG4B,kBAAkBN,IAAM,IAE/C,OAAOA,EA3FWC,CAAcvB,GAAI6B,GAAIC,IAQpC,OAPA9B,GAAG+B,WAAWtB,SA4FtB,SAAoBT,IAChB,MAAM35D,IAAM,IAAI27D,aAAa,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,IAC7CC,IAAMjC,GAAGzpE,eACfypE,GAAGkC,WAAWlC,GAAGmC,aAAcF,KAC/BjC,GAAGoC,WAAWpC,GAAGmC,aAAc97D,IAAK25D,GAAGqC,aACvCrC,GAAGsC,wBAAwB,GAC3BtC,GAAGuC,oBAAoB,EAAG,EAAGvC,GAAGwC,OAAO,EAAO,EAAG,GAjG7CC,CAAWzC,IACX0C,SAAS79D,SAAQ8J,MAAQrd,KAAKouE,UAAU/wD,MAAQqxD,GAAG2C,mBAAmBlC,QAAS9xD,QAC/Erd,KAAKsxE,SAAWnC,QAChBT,GAAG6C,OAAO7C,GAAG8C,OACb9C,GAAG+C,kBAAkB/C,GAAGgD,UAAWhD,GAAGiD,oBAAqBjD,GAAGkD,IAAKlD,GAAGiD,qBACtEjD,GAAG6C,OAAO7C,GAAGmD,cACNnD,GAEXhC,2BAA2B13D,EAAGC,GAC1B,MAAO,CAAC9I,KAAK41B,MAAM/sB,EAAIhV,KAAKspE,SAAS7rD,WAAYtR,KAAK41B,MAAM9sB,EAAIjV,KAAKspE,SAAS5rD,aAElFsvD,cACI,MAAM0B,GAAK1uE,KAAKquE,IACV5hC,KAAOzsC,KAAKspE,SACZwI,WAAa,CAACrlC,KAAKlvB,MAAQkvB,KAAKhvB,UAAWgvB,KAAKjvB,OAASivB,KAAK/uB,YACpEgxD,GAAGzxD,OAAOM,MAAQu0D,WAAW,GAC7BpD,GAAGzxD,OAAOO,OAASs0D,WAAW,GAC9BpD,GAAGqD,SAAS,EAAG,EAAGD,WAAW,GAAIA,WAAW,IAC5CpD,GAAGI,WAAW9uE,KAAKouE,UAAL,SAA4B,CAAC3hC,KAAKhvB,UAAWgvB,KAAK/uB,aAChEgxD,GAAGI,WAAW9uE,KAAKouE,UAAL,WAA8B0D,YAEhDrD,eAAetF,UA8EnB,SAAuBuF,GAAI57D,MACvB,IAAIgK,EAAI4xD,GAAGsD,gBACXtD,GAAGuD,YAAYvD,GAAGwD,WAAYp1D,GAC9B4xD,GAAGyD,cAAczD,GAAGwD,WAAYxD,GAAG0D,mBAAoB1D,GAAG2D,SAC1D3D,GAAGyD,cAAczD,GAAGwD,WAAYxD,GAAG4D,mBAAoB5D,GAAG2D,SAC1D3D,GAAGyD,cAAczD,GAAGwD,WAAYxD,GAAG6D,eAAgB7D,GAAG8D,QACtD9D,GAAGyD,cAAczD,GAAGwD,WAAYxD,GAAG+D,eAAgB/D,GAAG8D,QACtD9D,GAAGgE,YAAYhE,GAAGiE,oBAAqB,GACvCjE,GAAGkE,WAAWlE,GAAGwD,WAAY,EAAGxD,GAAGmE,KAAMnE,GAAGmE,KAAMnE,GAAGoE,cAAehgE,MArFhEk/D,CAAchyE,KAAKquE,IAAKlF,UAGhC,MAAMiI,SAAW,CAAC,eAAgB,gBAAiB,WAAY,aAAc,WAAY,KAAM,QACzFb,GAAK,ocAkBRlrD,OACGmrD,GAAK,ihBAuBRnrD,OA0CH,IAAI0tD,WAAa,GACjB,SAASnvD,WAAW4e,OAChB,KAAMA,SAASuwC,YAAa,CACxB,IAAIpuD,OACJ,GAAa,eAAT6d,MACA7d,OAAS,CAAC,EAAG,EAAG,EAAG,QAElB,GAAI6d,MAAM/zB,QAAQ,SAAW,EAAG,CACjCkW,QAAU6d,MAAM/+B,MAAM,YAAc,IAAI3D,IAAIkzE,QAC5C,IAAK,IAAIpxE,EAAI,EAAGA,EAAI,EAAGA,IACnB+iB,OAAO/iB,GAAK+iB,OAAO/iB,GAAK,SAI5B+iB,OAAS0hD,kDAAiB7jC,OAAO1iC,KAAImzE,GAAKA,EAAI,MAC9CtuD,OAAOhe,KAAK,GAEhBosE,WAAWvwC,OAAS7d,OAExB,OAAOouD,WAAWvwC,S,4kBC9Qf,SAAS0wC,WAAWhoE,KACvB,IAAIioE,OAAQjvD,EACZ,GAAIhZ,OAAOkoE,MACPD,OAASC,MAAMloE,SAEd,CACD,GAAqB,KAAjBA,IAAIiU,OAAO,GAAW,CACtB,IACI0F,QADU3Z,IAAIzH,MAAM,eAAiB,IACpB3D,KAAKkV,GAAMrR,SAASqR,EAAG,MAC5C,GAAqB,GAAjB6P,OAAOhjB,OACPsxE,OAAStuD,OAAO/kB,KAAKkV,GAAU,GAAJA,QAE1B,CACD,IAAK,IAAIpT,EAAI,EAAGA,EAAI,EAAGA,IACnBijB,OAAOjjB,EAAI,IAAM,GAAKijB,OAAOjjB,GAC7BijB,OAAOnU,OAAO9O,EAAG,GAErBuxE,OAAStuD,aAIbsuD,QADMjvD,EAAIhZ,IAAIzH,MAAM,uBACXygB,EAAE,GAAGtgB,MAAM,WAAW9D,KAAKkV,GAAMrR,SAASqR,KAG1C,CAAC,EAAG,EAAG,GAEpBo+D,MAAMloE,KAAOioE,OAEjB,OAAOA,OAAO5nE,QAKX,SAAS4nB,IAAIkgD,UAAWvJ,QAC3B,IAAI5qC,OAASm0C,OAAO9nE,QACpB,IAAK,IAAI3J,EAAI,EAAGA,EAAI,EAAGA,IACnB,IAAK,IAAIK,EAAI,EAAGA,EAAI6nE,OAAOjoE,OAAQI,IAC/Bi9B,OAAOt9B,IAAMkoE,OAAO7nE,GAAGL,GAG/B,OAAOs9B,OAKJ,SAASo0C,KAAKD,UAAWvJ,QAC5B,IAAK,IAAIloE,EAAI,EAAGA,EAAI,EAAGA,IACnB,IAAK,IAAIK,EAAI,EAAGA,EAAI6nE,OAAOjoE,OAAQI,IAC/BoxE,OAAOzxE,IAAMkoE,OAAO7nE,GAAGL,GAG/B,OAAOyxE,OAKJ,SAASE,SAASF,UAAWvJ,QAChC,IAAI5qC,OAASm0C,OAAO9nE,QACpB,IAAK,IAAI3J,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,IAAK,IAAIK,EAAI,EAAGA,EAAI6nE,OAAOjoE,OAAQI,IAC/Bi9B,OAAOt9B,IAAMkoE,OAAO7nE,GAAGL,GAAK,IAEhCs9B,OAAOt9B,GAAKuK,KAAKyD,MAAMsvB,OAAOt9B,IAElC,OAAOs9B,OAKJ,SAASs0C,UAAUH,UAAWvJ,QACjC,IAAK,IAAIloE,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,IAAK,IAAIK,EAAI,EAAGA,EAAI6nE,OAAOjoE,OAAQI,IAC/BoxE,OAAOzxE,IAAMkoE,OAAO7nE,GAAGL,GAAK,IAEhCyxE,OAAOzxE,GAAKuK,KAAKyD,MAAMyjE,OAAOzxE,IAElC,OAAOyxE,OAKJ,SAASI,YAAYJ,OAAQK,OAAQC,OAAS,IACjD,IAAIz0C,OAASm0C,OAAO9nE,QACpB,IAAK,IAAI3J,EAAI,EAAGA,EAAI,EAAGA,IACnBs9B,OAAOt9B,GAAKuK,KAAKyD,MAAMsvB,OAAOt9B,GAAK+xE,QAAUD,OAAO9xE,GAAKyxE,OAAOzxE,KAEpE,OAAOs9B,OAEJ,MAAMlY,KAAOysD,YAIb,SAASG,eAAeP,OAAQK,OAAQC,OAAS,IACpD,IAAIE,KAAOC,QAAQT,QACfU,KAAOD,QAAQJ,QACnB,IAAK,IAAI9xE,EAAI,EAAGA,EAAI,EAAGA,IACnBiyE,KAAKjyE,IAAM+xE,QAAUI,KAAKnyE,GAAKiyE,KAAKjyE,IAExC,OAAOoyE,QAAQH,MAEZ,MAAM/sD,QAAU8sD,eAMhB,SAASK,UAAUzxC,MAAOrzB,MACvBA,gBAAgB1P,QAClB0P,KAAOhD,KAAKyD,MAAM42D,uDAAc,EAAGr3D,QAEvC,IAAI+vB,OAASsD,MAAMj3B,QACnB,IAAK,IAAI3J,EAAI,EAAGA,EAAI,EAAGA,IACnBs9B,OAAOt9B,IAAOuN,gBAAgB1P,MAAQ0M,KAAKyD,MAAM42D,uDAAc,EAAGr3D,KAAKvN,KAAOuN,KAElF,OAAO+vB,OAKJ,SAAS40C,QAAQtxC,OACpB,IAIWvc,EAJP/B,EAAIse,MAAM,GAAK,IACfre,EAAIqe,MAAM,GAAK,IACfpe,EAAIoe,MAAM,GAAK,IACfp2B,IAAMD,KAAKC,IAAI8X,EAAGC,EAAGC,GAAItV,IAAM3C,KAAK2C,IAAIoV,EAAGC,EAAGC,GAC9C0B,EAAI,EAAMM,GAAKha,IAAM0C,KAAO,EAChC,GAAI1C,KAAO0C,IACPmX,EAAI,MAEH,CACD,IAAI6O,EAAI1oB,IAAM0C,IAEd,OADAmX,EAAKG,EAAI,GAAM0O,GAAK,EAAI1oB,IAAM0C,KAAOgmB,GAAK1oB,IAAM0C,KACxC1C,KACJ,KAAK8X,EACD4B,GAAK3B,EAAIC,GAAK0Q,GAAK3Q,EAAIC,EAAI,EAAI,GAC/B,MACJ,KAAKD,EACD2B,GAAK1B,EAAIF,GAAK4Q,EAAI,EAClB,MACJ,KAAK1Q,EACD0B,GAAK5B,EAAIC,GAAK2Q,EAAI,EAG1BhP,GAAK,EAET,MAAO,CAACA,EAAGG,EAAGG,GAElB,SAAS8tD,QAAQlE,EAAGmE,EAAGr3D,GAKnB,OAJIA,EAAI,IACJA,GAAK,GACLA,EAAI,IACJA,GAAK,GACLA,EAAI,EAAI,EACDkzD,EAAc,GAATmE,EAAInE,GAASlzD,EACzBA,EAAI,GACGq3D,EACPr3D,EAAI,EAAI,EACDkzD,GAAKmE,EAAInE,IAAM,EAAI,EAAIlzD,GAAK,EAChCkzD,EAKJ,SAASgE,QAAQxxC,OACpB,IAAIpc,EAAIoc,MAAM,GACd,GAAgB,GAAZA,MAAM,GAEN,OADApc,EAAIja,KAAKyD,MAAU,IAAJwW,GACR,CAACA,EAAGA,EAAGA,GAEb,CACD,IAAIH,EAAIuc,MAAM,GACV2xC,EAAK/tD,EAAI,GAAMA,GAAK,EAAIH,GAAKG,EAAIH,EAAIG,EAAIH,EACzC+pD,EAAI,EAAI5pD,EAAI+tD,EACZjwD,EAAIgwD,QAAQlE,EAAGmE,EAAG3xC,MAAM,GAAK,EAAI,GACjCre,EAAI+vD,QAAQlE,EAAGmE,EAAG3xC,MAAM,IACxBpe,EAAI8vD,QAAQlE,EAAGmE,EAAG3xC,MAAM,GAAK,EAAI,GACrC,MAAO,CAACr2B,KAAKyD,MAAU,IAAJsU,GAAU/X,KAAKyD,MAAU,IAAJuU,GAAUhY,KAAKyD,MAAU,IAAJwU,KAG9D,SAASgwD,MAAM5xC,OAClB,IAAI6xC,QAAU7xC,MAAM1iC,KAAIkV,IAAKkpC,+CAAMlpC,EAAG,EAAG,OACzC,oBAAcq/D,QAAQ9uD,KAAK,KAA3B,KAEG,SAAS+uD,MAAM9xC,OAClB,IAAI6xC,QAAU7xC,MAAM1iC,KAAIkV,IAAKkpC,+CAAMlpC,EAAG,EAAG,KAAKu/D,SAAS,IAAIC,SAAS,EAAG,OACvE,iBAAWH,QAAQ9uD,KAAK,KAE5B,MAAM6tD,MAAQ,CACV,MAAS,CAAC,EAAG,EAAG,GAChB,KAAQ,CAAC,EAAG,EAAG,KACf,SAAY,CAAC,EAAG,EAAG,KACnB,WAAc,CAAC,EAAG,EAAG,KACrB,KAAQ,CAAC,EAAG,EAAG,KACf,UAAa,CAAC,EAAG,IAAK,GACtB,MAAS,CAAC,EAAG,IAAK,GAClB,KAAQ,CAAC,EAAG,IAAK,KACjB,SAAY,CAAC,EAAG,IAAK,KACrB,YAAe,CAAC,EAAG,IAAK,KACxB,cAAiB,CAAC,EAAG,IAAK,KAC1B,kBAAqB,CAAC,EAAG,IAAK,KAC9B,KAAQ,CAAC,EAAG,IAAK,GACjB,YAAe,CAAC,EAAG,IAAK,KACxB,KAAQ,CAAC,EAAG,IAAK,KACjB,KAAQ,CAAC,EAAG,IAAK,KACjB,aAAgB,CAAC,GAAI,GAAI,KACzB,WAAc,CAAC,GAAI,IAAK,KACxB,YAAe,CAAC,GAAI,IAAK,IACzB,SAAY,CAAC,GAAI,IAAK,IACtB,cAAiB,CAAC,GAAI,GAAI,IAC1B,cAAiB,CAAC,GAAI,GAAI,IAC1B,UAAa,CAAC,GAAI,IAAK,IACvB,eAAkB,CAAC,GAAI,IAAK,KAC5B,UAAa,CAAC,GAAI,IAAK,KACvB,UAAa,CAAC,GAAI,IAAK,KACvB,UAAa,CAAC,GAAI,IAAK,KACvB,cAAiB,CAAC,GAAI,GAAI,KAC1B,gBAAmB,CAAC,GAAI,IAAK,KAC7B,OAAU,CAAC,GAAI,EAAG,KAClB,eAAkB,CAAC,GAAI,IAAK,IAC5B,UAAa,CAAC,GAAI,IAAK,KACvB,eAAkB,CAAC,IAAK,IAAK,KAC7B,iBAAoB,CAAC,IAAK,IAAK,KAC/B,QAAW,CAAC,IAAK,IAAK,KACtB,QAAW,CAAC,IAAK,IAAK,KACtB,UAAa,CAAC,IAAK,GAAI,KACvB,UAAa,CAAC,IAAK,IAAK,IACxB,UAAa,CAAC,IAAK,IAAK,KACxB,UAAa,CAAC,IAAK,IAAK,KACxB,eAAkB,CAAC,IAAK,IAAK,KAC7B,eAAkB,CAAC,IAAK,IAAK,KAC7B,gBAAmB,CAAC,IAAK,IAAK,KAC9B,UAAa,CAAC,IAAK,IAAK,GACxB,WAAc,CAAC,IAAK,IAAK,GACzB,WAAc,CAAC,IAAK,IAAK,KACzB,OAAU,CAAC,IAAK,EAAG,GACnB,OAAU,CAAC,IAAK,EAAG,KACnB,MAAS,CAAC,IAAK,IAAK,GACpB,KAAQ,CAAC,IAAK,IAAK,KACnB,KAAQ,CAAC,IAAK,IAAK,KACnB,QAAW,CAAC,IAAK,IAAK,KACtB,aAAgB,CAAC,IAAK,IAAK,KAC3B,WAAc,CAAC,IAAK,GAAI,KACxB,QAAW,CAAC,IAAK,EAAG,GACpB,YAAe,CAAC,IAAK,EAAG,KACxB,YAAe,CAAC,IAAK,GAAI,IACzB,aAAgB,CAAC,IAAK,IAAK,KAC3B,WAAc,CAAC,IAAK,IAAK,KACzB,aAAgB,CAAC,IAAK,IAAK,KAC3B,WAAc,CAAC,IAAK,EAAG,KACvB,UAAa,CAAC,IAAK,IAAK,KACxB,WAAc,CAAC,IAAK,GAAI,KACxB,YAAe,CAAC,IAAK,IAAK,IAC1B,OAAU,CAAC,IAAK,GAAI,IACpB,MAAS,CAAC,IAAK,GAAI,IACnB,SAAY,CAAC,IAAK,IAAK,KACvB,SAAY,CAAC,IAAK,IAAK,KACvB,UAAa,CAAC,IAAK,IAAK,KACxB,YAAe,CAAC,IAAK,IAAK,IAC1B,cAAiB,CAAC,IAAK,IAAK,KAC5B,eAAkB,CAAC,IAAK,IAAK,KAC7B,WAAc,CAAC,IAAK,IAAK,KACzB,UAAa,CAAC,IAAK,GAAI,IACvB,cAAiB,CAAC,IAAK,IAAK,IAC5B,aAAgB,CAAC,IAAK,GAAI,KAC1B,UAAa,CAAC,IAAK,IAAK,KACxB,UAAa,CAAC,IAAK,IAAK,KACxB,OAAU,CAAC,IAAK,IAAK,KACrB,gBAAmB,CAAC,IAAK,GAAI,KAC7B,UAAa,CAAC,IAAK,GAAI,IACvB,KAAQ,CAAC,IAAK,IAAK,IACnB,UAAa,CAAC,IAAK,IAAK,IACxB,IAAO,CAAC,IAAK,IAAK,KAClB,UAAa,CAAC,IAAK,IAAK,KACxB,UAAa,CAAC,IAAK,IAAK,KACxB,cAAiB,CAAC,IAAK,IAAK,KAC5B,QAAW,CAAC,IAAK,IAAK,KACtB,OAAU,CAAC,IAAK,IAAK,KACrB,UAAa,CAAC,IAAK,IAAK,IACxB,QAAW,CAAC,IAAK,GAAI,IACrB,UAAa,CAAC,IAAK,IAAK,KACxB,KAAQ,CAAC,IAAK,IAAK,KACnB,UAAa,CAAC,IAAK,IAAK,KACxB,UAAa,CAAC,IAAK,IAAK,KACxB,SAAY,CAAC,IAAK,IAAK,KACvB,WAAc,CAAC,IAAK,IAAK,KACzB,OAAU,CAAC,IAAK,IAAK,KACrB,cAAiB,CAAC,IAAK,IAAK,KAC5B,WAAc,CAAC,IAAK,IAAK,KACzB,MAAS,CAAC,IAAK,IAAK,KACpB,UAAa,CAAC,IAAK,IAAK,KACxB,SAAY,CAAC,IAAK,IAAK,KACvB,MAAS,CAAC,IAAK,IAAK,KACpB,WAAc,CAAC,IAAK,IAAK,IACzB,MAAS,CAAC,IAAK,IAAK,KACpB,MAAS,CAAC,IAAK,IAAK,KACpB,WAAc,CAAC,IAAK,IAAK,KACzB,UAAa,CAAC,IAAK,IAAK,KACxB,WAAc,CAAC,IAAK,IAAK,KACzB,OAAU,CAAC,IAAK,IAAK,KACrB,aAAgB,CAAC,IAAK,IAAK,KAC3B,MAAS,CAAC,IAAK,IAAK,KACpB,qBAAwB,CAAC,IAAK,IAAK,KACnC,QAAW,CAAC,IAAK,IAAK,KACtB,IAAO,CAAC,IAAK,EAAG,GAChB,QAAW,CAAC,IAAK,EAAG,KACpB,QAAW,CAAC,IAAK,EAAG,KACpB,SAAY,CAAC,IAAK,GAAI,KACtB,UAAa,CAAC,IAAK,GAAI,GACvB,OAAU,CAAC,IAAK,GAAI,IACpB,QAAW,CAAC,IAAK,IAAK,KACtB,MAAS,CAAC,IAAK,IAAK,IACpB,WAAc,CAAC,IAAK,IAAK,GACzB,YAAe,CAAC,IAAK,IAAK,KAC1B,OAAU,CAAC,IAAK,IAAK,GACrB,UAAa,CAAC,IAAK,IAAK,KACxB,KAAQ,CAAC,IAAK,IAAK,KACnB,KAAQ,CAAC,IAAK,IAAK,GACnB,UAAa,CAAC,IAAK,IAAK,KACxB,YAAe,CAAC,IAAK,IAAK,KAC1B,SAAY,CAAC,IAAK,IAAK,KACvB,OAAU,CAAC,IAAK,IAAK,KACrB,UAAa,CAAC,IAAK,IAAK,KACxB,eAAkB,CAAC,IAAK,IAAK,KAC7B,WAAc,CAAC,IAAK,IAAK,KACzB,cAAiB,CAAC,IAAK,IAAK,KAC5B,SAAY,CAAC,IAAK,IAAK,KACvB,SAAY,CAAC,IAAK,IAAK,KACvB,aAAgB,CAAC,IAAK,IAAK,KAC3B,YAAe,CAAC,IAAK,IAAK,KAC1B,KAAQ,CAAC,IAAK,IAAK,KACnB,OAAU,CAAC,IAAK,IAAK,GACrB,YAAe,CAAC,IAAK,IAAK,KAC1B,MAAS,CAAC,IAAK,IAAK,KACpB,MAAS,CAAC,IAAK,IAAK,O,gUCnUxB,SAASqB,UAAUjyC,OAIf,IAAI6lB,IAAMge,kDAAiB7jC,OAI3B,OAAW,GAHHr2B,KAAK41B,MAFO2yC,SAEDrsB,IAAI,IAGH,EAFZl8C,KAAK41B,MAHO2yC,SAGDrsB,IAAI,IAEK,EADpBl8C,KAAK41B,MAJO2yC,SAIDrsB,IAAI,IACS,GAErB,MAAMggB,aAAa+E,iDAC9B30D,cACIyE,QACAld,KAAK20E,QAAU,CAAC,EAAG,GACnB30E,KAAK40E,QAAU,EAAE,GAAI,GACrB50E,KAAK60E,WAAa,GAEtBjL,SAASh0C,IAAM3uB,WAAW2uB,GAAI,IAAO,IACrC4zC,WAAWj+C,SACPrO,MAAMssD,WAAWj+C,SACjB,IAAIxJ,KAAO,CAACwJ,QAAQhO,MAAOgO,QAAQ/N,QAC/Bs3D,MAAQ90E,KAAKkqE,cACjBlqE,KAAK20E,QAAUG,MAAMh1E,KAAI,CAACowB,IAAK1hB,QAAUrC,KAAK41B,OAAO7R,IAAMnO,KAAKvT,QAAU,KAE9E+Q,QAjCJ,IAAqBnB,GAkCb22D,QAAQC,OAAOC,OAlCF72D,GAkCoBpe,KAAKspE,SAASlrD,GAjCnD,mBAAsBq2D,UAAUr2D,IAAhC,WAmCAJ,KAAKlL,KAAM04D,aAEP,IAAKx2D,EAAGC,EAAGstB,GAAI0mC,GAAI7qD,IAAMtL,KAErBquB,GAAKnhC,KAAK20E,QAAQ,GAAK3/D,EACvBosB,GAAKphC,KAAK20E,QAAQ,GAAK1/D,EACvB8M,KAAO/hB,KAAKkqE,cAChB,GAAI/oC,GAAK,GAAKA,IAAMpf,KAAK,GACrB,OAEJ,GAAIqf,GAAK,GAAKA,IAAMrf,KAAK,GACrB,OAeJ,GAbIof,KAAOnhC,KAAK40E,QAAQ,IAAMxzC,KAAOphC,KAAK40E,QAAQ,KAC9CG,QAAQC,OAAOC,MA5C3B,SAAwBjgE,EAAGC,GACvB,kBAAeA,EAAI,EAAnB,YAAwBD,EAAI,EAA5B,KA2C6BkgE,CAAe/zC,GAAIC,KACxCphC,KAAK40E,QAAQ,GAAKzzC,GAClBnhC,KAAK40E,QAAQ,GAAKxzC,IAIlBoqC,cACKjpC,KACDA,GAAK,OAIRA,GACD,OAGJ,IAAI4yC,SA/DZ,SAAqBlM,GAAI7qD,IACrB,yBAAsBq2D,UAAUxL,IAAhC,iBAA4CwL,UAAUr2D,IAAtD,KA8DmBg3D,CAAYnM,GAAI7qD,IAK/B,GAJI+2D,WAAan1E,KAAK60E,aAClBE,QAAQC,OAAOC,MAAME,UACrBn1E,KAAK60E,WAAaM,UAEZ,MAAN5yC,GAAY,CAEZ,IAAI0pC,MAAQ,GAAGC,OAAO3pC,IACtBwyC,QAAQC,OAAOC,MAAMhJ,MAAM,IAG/BjsE,KAAK40E,QAAQ,KACT50E,KAAK40E,QAAQ,IAAM7yD,KAAK,KACxB/hB,KAAK40E,QAAQ,GAAK,EAClB50E,KAAK40E,QAAQ,MAGrBvK,kBAAoB,MAAM,IAAIt5C,MAAM,+CACpCw5C,gBAAgBv1D,EAAGC,GAAK,MAAO,CAACD,EAAGC,GACnCi1D,cAAgB,MAAO,CAAC6K,QAAQC,OAAOK,QAASN,QAAQC,OAAOt/B,S,iTCnFnE,MAAM4/B,UAAY,oBAELC,UAAY,EACZC,aAAe,EACfC,QAAU,EACVC,QAAU,EAIhB,SAASC,QAAQzqE,IAAKy/D,UACzB,IAAIzrC,OAAS,CAAE3hB,MAAO,EAAGC,OAAQ,GAC7ButD,OAAS6K,SAAS1qE,IAAKy/D,UACvBkL,UAAY,EAChB,IAAK,IAAIj0E,EAAI,EAAGA,EAAImpE,OAAOlpE,OAAQD,IAAK,CACpC,IAAIopE,MAAQD,OAAOnpE,GACnB,OAAQopE,MAAM3yD,MACV,KAAKk9D,UACDM,WAAa7K,MAAM/oD,MAAMpgB,OACzB,MACJ,KAAK2zE,aACDt2C,OAAO1hB,SACP0hB,OAAO3hB,MAAQpR,KAAKC,IAAI8yB,OAAO3hB,MAAOs4D,WACtCA,UAAY,GAKxB,OADA32C,OAAO3hB,MAAQpR,KAAKC,IAAI8yB,OAAO3hB,MAAOs4D,WAC/B32C,OAKJ,SAAS02C,SAAS1qE,IAAKy/D,UAC1B,IAAIzrC,OAAS,GAET42C,OAAS,EACb5qE,IAAItI,QAAQ0yE,WAAW,SAAU7xE,MAAO4U,KAAMgF,KAAM7O,OAEhD,IAAIq5D,KAAO38D,IAAIkzC,UAAU03B,OAAQtnE,OAajC,OAZIq5D,KAAKhmE,QACLq9B,OAAOv4B,KAAK,CACR0R,KAAMk9D,UACNtzD,MAAO4lD,OAIf3oC,OAAOv4B,KAAK,CACR0R,KAAe,KAARA,KAAco9D,QAAUC,QAC/BzzD,MAAO5E,KAAKgI,SAEhBywD,OAAStnE,MAAQ/K,MAAM5B,OAChB,MAGX,IAAIgmE,KAAO38D,IAAIkzC,UAAU03B,QAOzB,OANIjO,KAAKhmE,QACLq9B,OAAOv4B,KAAK,CACR0R,KAAMk9D,UACNtzD,MAAO4lD,OAMnB,SAAoBkD,OAAQJ,UACnBA,WACDA,SAAWz9D,KAEf,IAAItL,EAAI,EACJm0E,WAAa,EACbC,oBAAsB,EAC1B,KAAOp0E,EAAImpE,OAAOlpE,QAAQ,CACtB,IAAImpE,MAAQD,OAAOnpE,GAKnB,GAJIopE,MAAM3yD,MAAQm9D,eACdO,WAAa,EACbC,oBAAsB,GAEtBhL,MAAM3yD,MAAQk9D,UAAW,CACzB3zE,IACA,SAGJ,KAAqB,GAAdm0E,YAA4C,KAAzB/K,MAAM/oD,MAAM9C,OAAO,IACzC6rD,MAAM/oD,MAAQ+oD,MAAM/oD,MAAMm8B,UAAU,GAGxC,IAAI5vC,MAAQw8D,MAAM/oD,MAAMxT,QAAQ,MAChC,IAAc,GAAVD,MAAa,CACbw8D,MAAM/oD,MAAQg0D,iBAAiBlL,OAAQnpE,EAAG4M,OAAO,GAEjD,IAAIszB,IAAMkpC,MAAM/oD,MAAMre,MAAM,IAC5B,KAAOk+B,IAAIjgC,QAAiC,KAAvBigC,IAAIA,IAAIjgC,OAAS,IAClCigC,IAAI17B,MAER4kE,MAAM/oD,MAAQ6f,IAAIvc,KAAK,IAG3B,GAAKylD,MAAM/oD,MAAMpgB,OAAjB,CAIA,GAAIk0E,WAAa/K,MAAM/oD,MAAMpgB,OAAS8oE,SAAU,CAE5C,IAAIn8D,OAAS,EACb,OAAU,CACN,IAAI0nE,UAAYlL,MAAM/oD,MAAMxT,QAAQ,IAAKD,MAAQ,GACjD,IAAkB,GAAd0nE,UACA,MAEJ,GAAIH,WAAaG,UAAYvL,SACzB,MAEJn8D,MAAQ0nE,UAEZ,IAAc,GAAV1nE,MACAw8D,MAAM/oD,MAAQg0D,iBAAiBlL,OAAQnpE,EAAG4M,OAAO,QAEhD,IAA2B,GAAvBwnE,mBAA0B,CAC/B,IAAIhL,MAAQD,OAAOiL,oBACfG,WAAanL,MAAM/oD,MAAM4oC,YAAY,KACzCmgB,MAAM/oD,MAAQg0D,iBAAiBlL,OAAQiL,mBAAoBG,YAAY,GACvEv0E,EAAIo0E,wBAGJhL,MAAM/oD,MAAQg0D,iBAAiBlL,OAAQnpE,EAAG+oE,SAAWoL,YAAY,QAIrEA,YAAc/K,MAAM/oD,MAAMpgB,QACO,GAA7BmpE,MAAM/oD,MAAMxT,QAAQ,OACpBunE,mBAAqBp0E,GAG7BA,SAnCImpE,OAAOr6D,OAAO9O,EAAG,GAqCzBmpE,OAAOpkE,KAAK,CAAE0R,KAAMm9D,eAEpB,IAAIY,cAAgB,KACpB,IAAK,IAAIx0E,EAAI,EAAGA,EAAImpE,OAAOlpE,OAAQD,IAAK,CACpC,IAAIopE,MAAQD,OAAOnpE,GACnB,OAAQopE,MAAM3yD,MACV,KAAKk9D,UACDa,cAAgBpL,MAChB,MACJ,KAAKwK,aACD,GAAIY,cAAe,CACf,IAAIt0C,IAAMs0C,cAAcn0D,MAAMre,MAAM,IACpC,KAAOk+B,IAAIjgC,QAAiC,KAAvBigC,IAAIA,IAAIjgC,OAAS,IAClCigC,IAAI17B,MAERgwE,cAAcn0D,MAAQ6f,IAAIvc,KAAK,IAEnC6wD,cAAgB,MAK5B,OADArL,OAAO3kE,MACA2kE,OAhGAsL,CAAWn3C,OAAQyrC,UA0G9B,SAASsL,iBAAiBlL,OAAQuL,WAAYH,WAAYI,iBACtD,IAAIC,cAAgB,CAChBn+D,KAAMm9D,cAENiB,aAAe,CACfp+D,KAAMk9D,UACNtzD,MAAO8oD,OAAOuL,YAAYr0D,MAAMm8B,UAAU+3B,YAAcI,gBAAkB,EAAI,KAGlF,OADAxL,OAAOr6D,OAAO4lE,WAAa,EAAG,EAAGE,cAAeC,cACzC1L,OAAOuL,YAAYr0D,MAAMm8B,UAAU,EAAG+3B,c,uQCnL1C,IAAI5N,cAAgB,GAEhBC,eAAiB,GACrB,MAAMkO,KAAO,CAChBC,EAAG,CAAC,CAAC,GAAI,GAAI,CAAC,EAAG,GAAI,CAAC,EAAG,GAAI,EAAE,EAAG,IAClCC,EAAG,CAAC,CAAC,GAAI,GAAI,CAAC,GAAI,GAAI,CAAC,EAAG,GAAI,CAAC,EAAG,GAAI,CAAC,EAAG,GAAI,EAAE,EAAG,GAAI,EAAE,EAAG,GAAI,EAAE,GAAI,IACtEC,EAAG,CAAC,EAAE,GAAI,GAAI,CAAC,GAAI,GAAI,CAAC,EAAG,GAAI,CAAC,EAAG,GAAI,EAAE,EAAG,GAAI,EAAE,EAAG,KAE5CC,KAAO,CAEhBC,UAAW,EAEXC,QAAS,EAETC,cAAe,EAEfC,OAAQ,EAERC,SAAU,GAEVC,UAAW,GAEXC,SAAU,GAEVC,SAAU,GAEVC,WAAY,GAEZC,OAAQ,GAERC,SAAU,GAEVC,aAAc,GAEdC,UAAW,GAEXC,SAAU,GAEVC,WAAY,GAEZC,aAAc,GAEdC,OAAQ,GAERC,QAAS,GAETC,QAAS,GAETC,MAAO,GAEPC,SAAU,GAEVC,QAAS,GAETC,eAAgB,GAEhBC,UAAW,GAEXC,UAAW,GAEXC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,SAAU,GAEVC,aAAc,GAEdC,aAAc,GAEdC,UAAW,GAEXC,gBAAiB,GAEjBC,iBAAkB,GAElBC,MAAO,GAEPC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,KAAM,GAENC,gBAAiB,GAEjBC,WAAY,GAEZC,WAAY,GAEZC,WAAY,GAEZC,WAAY,GAEZC,WAAY,IAEZC,WAAY,IAEZC,WAAY,IAEZC,WAAY,IAEZC,WAAY,IAEZC,WAAY,IAEZC,YAAa,IAEbC,OAAQ,IAERC,aAAc,IAEdC,YAAa,IAEbC,WAAY,IAEZC,UAAW,IAEXC,MAAO,IAEPC,MAAO,IAEPC,MAAO,IAEPC,MAAO,IAEPC,MAAO,IAEPC,MAAO,IAEPC,MAAO,IAEPC,MAAO,IAEPC,MAAO,IAEPC,OAAQ,IAERC,OAAQ,IAERC,OAAQ,IAERC,OAAQ,IAERC,OAAQ,IAERC,OAAQ,IAERC,OAAQ,IAERC,OAAQ,IAERC,OAAQ,IAERC,OAAQ,IAERC,OAAQ,IAERC,OAAQ,IAERC,OAAQ,IAERC,OAAQ,IAERC,OAAQ,IAERC,YAAa,IAEbC,eAAgB,IAEhBC,cAAe,IAEfC,eAAgB,IAEhBC,gBAAiB,IAEjBC,QAAS,IAETC,UAAW,IAEXC,WAAY,IAEZC,aAAc,IAEdC,cAAe,IAEfC,cAAe,IAEfC,eAAgB,IAEhBC,YAAa,IAEbC,QAAS,IAETC,QAAS,IAETC,gBAAiB,IAEjBC,sBAAuB,IAEvBC,uBAAwB,IAExBC,SAAU,IAEVC,SAAU,IAEVC,UAAW,IAEXC,SAAU,IAEVC,cAAe,IAEfC,gBAAiB,IAEjBC,cAAe,IAEfC,iBAAkB,IAElBC,SAAU,IAEVC,QAAS,IAETC,SAAU,IAEVC,OAAQ,GAERC,QAAS,GAETC,UAAW,GAEXC,QAAS,GAETC,SAAU,GAEVC,SAAU,GAEVC,SAAU,GAEVC,SAAU,GAEVC,WAAY,GAEZC,cAAe,GAEfC,UAAW,GAEXC,cAAe,GAEfC,UAAW,GAEXC,SAAU,GAEVC,WAAY,GAEZC,SAAU,K,uQCvTC,MAAMC,gBACjBhoE,YAAY8S,SACRvrB,KAAKspE,SAAW,CACZoX,OAAO,EACPC,MAAO,EACPC,MAAO,MAEX1vE,OAAOq4D,OAAOvpE,KAAKspE,SAAU/9C,SAC7BvrB,KAAK6gF,UAAYC,OAAOC,aAAa,GACrC/gF,KAAKghF,QAAUhhF,KAAK6gF,UACpB7gF,KAAKihF,QAAU,GACf,IAAK,IAAIr/E,EAAI,EAAGA,EAAI5B,KAAKspE,SAASqX,MAAO/+E,IACrC5B,KAAKihF,QAAQt6E,KAAK3G,KAAK6gF,WAE3B7gF,KAAKkhF,aAAe,GACpBlhF,KAAKkhF,aAAalhF,KAAK6gF,WAAa7gF,KAAKspE,SAASsX,MAClD5gF,KAAKulE,MAAQ,GAKjBhmD,QACIvf,KAAKulE,MAAQ,GACbvlE,KAAKkhF,aAAe,GAKxBC,WACI,IAAIjiD,OAAS,CAACl/B,KAAKohF,QAAQphF,KAAKihF,UAChC,KAAO/hD,OAAOA,OAAOr9B,OAAS,IAAM7B,KAAK6gF,WACrC3hD,OAAOv4B,KAAK3G,KAAKohF,QAAQliD,SAE7B,OAAOl/B,KAAKqhF,MAAMniD,OAAO3zB,MAAM,GAAI,IAKvC+1E,QAAQ51D,QACJ,IAAIq/C,OAAS/qE,KAAKuhF,OAAO71D,QACzB,IAAK,IAAI9pB,EAAI,EAAGA,EAAImpE,OAAOlpE,OAAQD,IAC/B5B,KAAKkhF,aAAanW,OAAOnpE,IAAM5B,KAAKspE,SAASsX,MAEjD7V,OAAS/qE,KAAKihF,QAAQ/U,OAAOnB,QAAQmB,OAAOlsE,KAAKghF,SACjD,IAAK,IAAIp/E,EAAI5B,KAAKspE,SAASqX,MAAO/+E,EAAImpE,OAAOlpE,OAAQD,IAAK,CACtD,IAAIusE,QAAUpD,OAAOx/D,MAAM3J,EAAI5B,KAAKspE,SAASqX,MAAO/+E,GAChDmJ,MAAQggE,OAAOnpE,GACnB,IAAK,IAAIK,EAAI,EAAGA,EAAIksE,QAAQtsE,OAAQI,IAAK,CACrC,IAAIu/E,WAAarT,QAAQ5iE,MAAMtJ,GAC/BjC,KAAKyhF,cAAcD,WAAYz2E,SAI3C22E,WACI,IAAIz8D,MAAQ,GACR08D,WAAazwE,OAAOD,KAAKjR,KAAKkhF,cAAcr/E,OAChD8/E,aACA18D,MAAMte,KAAK,qBAAuBg7E,YAClC,IAAIC,UAAY1wE,OAAOD,KAAKjR,KAAKulE,OAAO1jE,OACpCggF,WAAa,EACjB,IAAK,IAAI7R,KAAKhwE,KAAKulE,MACfsc,YAAc3wE,OAAOD,KAAKjR,KAAKulE,MAAMyK,IAAInuE,OAI7C,OAFAojB,MAAMte,KAAK,+BAAiCi7E,WAC5C38D,MAAMte,KAAK,6BAA+Bk7E,YACnC58D,MAAMM,KAAK,MAMtBg8D,OAAOr2E,KACH,OAAOA,IAAItH,MAAM5D,KAAKspE,SAASoX,MAAQ,MAAQ,IAMnDW,MAAMv/C,KACF,OAAOA,IAAIvc,KAAKvlB,KAAKspE,SAASoX,MAAQ,IAAM,IAMhDe,cAActT,QAASpjE,OACnB,IAAIyI,IAAMxT,KAAKqhF,MAAMlT,SACf36D,OAAOxT,KAAKulE,QACdvlE,KAAKulE,MAAM/xD,KAAO,IAEtB,IAAIV,KAAO9S,KAAKulE,MAAM/xD,KAChBzI,SAAS+H,OACXA,KAAK/H,OAAS,GAElB+H,KAAK/H,SAMTq2E,QAAQjT,SACJA,QAAUnuE,KAAK8hF,SAAS3T,SACxB,IAAI36D,IAAMxT,KAAKqhF,MAAMlT,SACjBr7D,KAAO9S,KAAKulE,MAAM/xD,KAClBuuE,UAAY,GAChB,GAAI/hF,KAAKspE,SAASsX,MAAO,CACrB,IAAK,IAAI71E,SAAS/K,KAAKkhF,aACnBa,UAAUh3E,OAAS/K,KAAKkhF,aAAan2E,OAEzC,IAAK,IAAIA,SAAS+H,KACdivE,UAAUh3E,QAAU+H,KAAK/H,YAI7Bg3E,UAAYjvE,KAEhB,OAAO0zD,8DAAqBub,WAMhCD,SAAS3T,SAOL,IANIA,QAAQtsE,OAAS7B,KAAKspE,SAASqX,MAC/BxS,QAAUA,QAAQ5iE,OAAOvL,KAAKspE,SAASqX,OAElCxS,QAAQtsE,OAAS7B,KAAKspE,SAASqX,QACpCxS,QAAUnuE,KAAKihF,QAAQ11E,MAAM,EAAGvL,KAAKspE,SAASqX,MAAQxS,QAAQtsE,QAAQqqE,OAAOiC,YAExEnuE,KAAKqhF,MAAMlT,WAAYnuE,KAAKulE,QAAU4I,QAAQtsE,OAAS,GAC5DssE,QAAUA,QAAQ5iE,MAAM,GAE5B,OAAO4iE,W,mQCzIA,MAAM6T,WAIjBvpE,cACIzY,KAAKiiF,MAAQ,EACbjiF,KAAKkiF,QAAU,IAAIC,8CAKvBC,UAAY,OAAOpiF,KAAKiiF,MAIxB1iE,QAEI,OADAvf,KAAKkiF,QAAU,IAAIC,8CACZniF,KAMXmzB,IAAIpoB,MAAOof,MACPnqB,KAAKkiF,QAAQv7E,KAAKoE,MAAOof,MAM7B7H,MACI,IAAKtiB,KAAKkiF,QAAQrzE,MACd,OAAO,KAEX,IAAM2E,IAAK2W,KAAMlI,MAAOlX,OAAU/K,KAAKkiF,QAAQ97E,MAK/C,OAJI+jB,KAAO,IACPnqB,KAAKiiF,OAAS93D,KACdnqB,KAAKkiF,QAAQ3wE,OAAO4Y,OAEjBpf,MAOXs3E,aAAat3E,OACT,MAAMmZ,EAAIlkB,KAAKkiF,QAAQl9C,KAAKj6B,OAC5B,GAAImZ,EAAG,CACH,MAAM,KAAUA,EAChB,OAAO1Q,KASf0a,OAAOnjB,OACH,OAAO/K,KAAKkiF,QAAQh0D,OAAOnjB,U,6LC7D5B,MAAMo3E,QACT1pE,cACIzY,KAAKsiF,KAAO,GACZtiF,KAAKuiF,UAAY,EAErBC,SAASn+D,EAAGD,GACR,OAAOC,EAAE7Q,KAAO4Q,EAAE5Q,IAAM6Q,EAAEk+D,UAAYn+D,EAAEm+D,UAAYl+D,EAAE7Q,IAAM4Q,EAAE5Q,IAElEjC,MAAMkb,GACFzsB,KAAKsiF,KAAOtiF,KAAKsiF,KAAKxiF,KAAI,EAAG0T,IAAKyO,MAAOsgE,cAAf,CAAkC/uE,IAAKA,IAAMiZ,EAAGxK,MAAOsgE,cAErF1zE,MACI,OAAO7O,KAAKsiF,KAAKzgF,OAErB8E,KAAKsb,MAAOzO,KACRxT,KAAKuiF,WAAa,EAClB,MAAME,IAAMziF,KAAK6O,MACjB7O,KAAKsiF,KAAK37E,KAAK,CAAEsb,MAAOsgE,UAAWviF,KAAKuiF,UAAW/uE,MACnDxT,KAAK0iF,SAASD,KAElBr8E,MACI,GAAkB,GAAdpG,KAAK6O,MACL,MAAM,IAAIkiB,MAAM,qBAEpB,MAAMotC,IAAMn+D,KAAKsiF,KAAK,GAQtB,OAPItiF,KAAK6O,MAAQ,GACb7O,KAAKsiF,KAAK,GAAKtiF,KAAKsiF,KAAKl8E,MACzBpG,KAAK2iF,WAAW,IAGhB3iF,KAAKsiF,KAAKl8E,MAEP+3D,IAEXn5B,KAAKvY,GACD,IAAK,IAAI7qB,EAAI,EAAGA,EAAI5B,KAAK6O,MAAOjN,IAC5B,GAAI6qB,GAAKzsB,KAAKsiF,KAAK1gF,GAAGqgB,MAClB,OAAOjiB,KAAKsiF,KAAK1gF,GAGzB,OAAO,KAEXssB,OAAOzB,GACH,IAAIje,MAAQ,KACZ,IAAK,IAAI5M,EAAI,EAAGA,EAAI5B,KAAK6O,MAAOjN,IACxB6qB,GAAKzsB,KAAKsiF,KAAK1gF,GAAGqgB,QAClBzT,MAAQ5M,GAGhB,GAAc,OAAV4M,MACA,OAAO,EAEX,GAAIxO,KAAK6O,MAAQ,EAAG,CAChB,IAAI+zE,KAAO5iF,KAAKsiF,KAAKl8E,MAKrB,OAJIw8E,KAAK3gE,OAASwK,IACdzsB,KAAKsiF,KAAK9zE,OAASo0E,KACnB5iF,KAAK2iF,WAAWn0E,SAEb,EAKX,OAFIxO,KAAKsiF,KAAKl8E,OAEP,EAEXy8E,WAAW7tE,GACP,OAAO7I,KAAK41B,OAAO/sB,EAAI,GAAK,GAEhC8tE,cAAc9tE,GACV,OAAO,EAAIA,EAAI,EAEnB+tE,eAAe/tE,GACX,OAAO,EAAIA,EAAI,EAEnBguE,UAAUhuE,GACN,OAAOA,GAAK,GAAKA,EAAIhV,KAAKsiF,KAAKzgF,OAEnCohF,KAAKjuE,EAAGC,GACJ,MAAM6H,EAAI9c,KAAKsiF,KAAKttE,GACpBhV,KAAKsiF,KAAKttE,GAAKhV,KAAKsiF,KAAKrtE,GACzBjV,KAAKsiF,KAAKrtE,GAAK6H,EAEnBomE,QAAQC,SACJ,MAAMC,aAAeD,QAAQ/hE,OAAOphB,KAAKgjF,UAAU71E,KAAKnN,OACxD,IAAIqjF,QAAUD,aAAa,GAC3B,IAAK,MAAMxhF,KAAKwhF,aACRpjF,KAAKwiF,SAASxiF,KAAKsiF,KAAK1gF,GAAI5B,KAAKsiF,KAAKe,YACtCA,QAAUzhF,GAGlB,OAAOyhF,QAEXX,SAAS1tE,GACL,GAAS,GAALA,EACA,OAEJ,MAAM7C,OAASnS,KAAK6iF,WAAW7tE,GAC3BhV,KAAKgjF,UAAU7wE,SAAWnS,KAAKwiF,SAASxiF,KAAKsiF,KAAKttE,GAAIhV,KAAKsiF,KAAKnwE,WAChEnS,KAAKijF,KAAKjuE,EAAG7C,QACbnS,KAAK0iF,SAASvwE,SAGtBwwE,WAAW3tE,GACP,MAAMsuE,UAAYtjF,KAAK8iF,cAAc9tE,GAC/BuuE,WAAavjF,KAAK+iF,eAAe/tE,GACvC,IAAKhV,KAAKgjF,UAAUM,WAChB,OAEJ,MAAMv+D,EAAI/kB,KAAKkjF,QAAQ,CAACluE,EAAGsuE,UAAWC,aAClCx+D,GAAK/P,IACLhV,KAAKijF,KAAKjuE,EAAG+P,GACb/kB,KAAK2iF,WAAW59D,IAGxBy+D,aACIh9E,QAAQ+2B,IAAIv9B,KAAKsiF,S,sZChHzB,kCAAiBmB,OAAF,gDAAUC,MAAV,+CAAiBC,OAAMA,kD,oQCCvB,MAAMF,eAAeG,mDAChCzwD,IAAImO,KAAMuiD,QAEN,OADA7jF,KAAKiJ,OAAOkqB,IAAImO,KAAM,GACfpkB,MAAMiW,IAAImO,KAAMuiD,QAE3B5yD,OAII,OAHsB,OAAlBjxB,KAAK8jF,WAA6D,GAAxC9jF,KAAK+jF,QAAQt1E,QAAQzO,KAAK8jF,WACpD9jF,KAAKiJ,OAAOkqB,IAAInzB,KAAK8jF,SAAU,GAE5B5mE,MAAM+T,U,wQCZN,MAAM2yD,UAIjBnrE,cACIzY,KAAKiJ,OAAS,IAAI+4E,oDAClBhiF,KAAK+jF,QAAU,GACf/jF,KAAK8jF,SAAW,KAKpB1B,UAAY,OAAOpiF,KAAKiJ,OAAOm5E,UAK/BjvD,IAAImO,KAAMuiD,QAIN,OAHIA,QACA7jF,KAAK+jF,QAAQp9E,KAAK26B,MAEfthC,KAOXgkF,UAAU1iD,MACN,OAAOthC,KAAKiJ,OAAOo5E,aAAa/gD,MAKpC/hB,QAII,OAHAvf,KAAKiJ,OAAOsW,QACZvf,KAAK+jF,QAAU,GACf/jF,KAAK8jF,SAAW,KACT9jF,KAOXkuB,OAAOoT,MACH,IAAIpC,OAASl/B,KAAKiJ,OAAOilB,OAAOoT,MAC5B9yB,MAAQxO,KAAK+jF,QAAQt1E,QAAQ6yB,MAOjC,OANc,GAAV9yB,OACAxO,KAAK+jF,QAAQrzE,OAAOlC,MAAO,GAE3BxO,KAAK8jF,UAAYxiD,OACjBthC,KAAK8jF,SAAW,MAEb5kD,OAMXjO,OAEI,OADAjxB,KAAK8jF,SAAW9jF,KAAKiJ,OAAOqZ,MACrBtiB,KAAK8jF,Y,mQC3DL,MAAMJ,cAAcE,mDAO/BzwD,IAAImO,KAAMuiD,OAAQ15D,MAEd,OADAnqB,KAAKiJ,OAAOkqB,IAAImO,UAAe94B,IAAT2hB,KAAqBA,KAAO,EAAImX,KAAK2iD,YACpD/mE,MAAMiW,IAAImO,KAAMuiD,QAK3B5yD,OAII,OAHIjxB,KAAK8jF,WAAoD,GAAxC9jF,KAAK+jF,QAAQt1E,QAAQzO,KAAK8jF,WAC3C9jF,KAAKiJ,OAAOkqB,IAAInzB,KAAK8jF,SAAU,EAAI9jF,KAAK8jF,SAASG,YAE9C/mE,MAAM+T,U,oQCjBN,MAAM0yD,eAAeC,mDAChCnrE,cACIyE,QACAld,KAAKkkF,iBAAmB,EACxBlkF,KAAK8I,UAAY9I,KAAKkkF,iBAQ1B/wD,IAAImO,KAAMuiD,OAAQ15D,MAEd,OADAnqB,KAAKiJ,OAAOkqB,IAAImO,KAAMnX,MAAQnqB,KAAKkkF,kBAC5BhnE,MAAMiW,IAAImO,KAAMuiD,QAE3BtkE,QAEI,OADAvf,KAAK8I,UAAY9I,KAAKkkF,iBACfhnE,MAAMqC,QAEjB2O,OAAOoT,MAIH,OAHIA,MAAQthC,KAAK8jF,WACb9jF,KAAK8I,UAAY9I,KAAKkkF,kBAEnBhnE,MAAMgR,OAAOoT,MAKxBrQ,OAKI,OAJsB,OAAlBjxB,KAAK8jF,WAA6D,GAAxC9jF,KAAK+jF,QAAQt1E,QAAQzO,KAAK8jF,YACpD9jF,KAAKiJ,OAAOkqB,IAAInzB,KAAK8jF,SAAU9jF,KAAK8I,WAAa9I,KAAKkkF,kBACtDlkF,KAAK8I,UAAY9I,KAAKkkF,kBAEnBhnE,MAAM+T,OAKjBkzD,YAAYh6D,MAIR,OAHInqB,KAAK8jF,WACL9jF,KAAK8I,UAAYqhB,MAEdnqB,Q,ucC7Cf,kCAAiBokF,sBAAF,gEAAyBC,qBAAzB,+DAA+CC,uBAAsBA,mE,6QCErE,MAAMF,8BAA8Bxe,6CAC/Cr8B,QAAQv0B,EAAGC,EAAGwQ,EAAG8+D,UAIb,GAFAA,SAASvvE,EAAGC,EAAG,EAAG,IAEbjV,KAAKwkF,aAAaxvE,EAAGC,GACtB,OAGJ,IACIwvE,EAAG5+D,EAAG+kD,GAAIC,GAAI6Z,OADdC,KAAO,GAGX,IAAK,IAAIzgE,EAAI,EAAGA,GAAKuB,EAAGvB,IAAK,CACzB,IAAI4b,UAAY9/B,KAAK4kF,WAAW5vE,EAAGC,EAAGiP,GAClC2gE,MAAQ,IAAM/kD,UAAUj+B,OAC5B,IAAK,IAAID,EAAI,EAAGA,EAAIk+B,UAAUj+B,OAAQD,IASlC,GARAgpE,GAAK9qC,UAAUl+B,GAAG,GAClBipE,GAAK/qC,UAAUl+B,GAAG,GAClB6iF,EAAII,OAASjjF,EAAI,IACjBikB,EAAI4+D,EAAII,MACRH,QAAU1kF,KAAKwkF,aAAa5Z,GAAIC,IAC5B7qE,KAAK8kF,eAAe34E,KAAK41B,MAAM0iD,GAAIt4E,KAAKwG,KAAKkT,GAAI6+D,OAAQC,OACzDJ,SAAS3Z,GAAIC,GAAI3mD,EAAG,GAEL,GAAfygE,KAAK9iF,QAA0B,GAAX8iF,KAAK,IAAsB,KAAXA,KAAK,GACzC,QAWhBG,eAAeL,EAAG5+D,EAAG6+D,OAAQC,MACzB,GAAIF,EAAI,EAAG,CACP,IAAIM,GAAK/kF,KAAK8kF,eAAe,EAAGj/D,EAAG6+D,OAAQC,MACvC9wD,GAAK7zB,KAAK8kF,eAAe,IAAML,EAAG,IAAKC,OAAQC,MACnD,OAAOI,IAAMlxD,GAEjB,IAAIrlB,MAAQ,EACZ,KAAOA,MAAQm2E,KAAK9iF,QAAU8iF,KAAKn2E,OAASi2E,GACxCj2E,QAEJ,GAAIA,OAASm2E,KAAK9iF,OAId,OAHI6iF,QACAC,KAAKh+E,KAAK89E,EAAG5+D,IAEV,EAEX,IAAI4uB,MAAQ,EACZ,GAAIjmC,MAAQ,EAAG,CACX,KAAOA,MAAQm2E,KAAK9iF,QAAU8iF,KAAKn2E,OAASqX,GACxCrX,QACAimC,QAEJ,OAAa,GAATA,QAGAiwC,SACIjwC,MAAQ,EACRkwC,KAAKj0E,OAAOlC,MAAQimC,MAAOA,MAAO5uB,GAGlC8+D,KAAKj0E,OAAOlC,MAAQimC,MAAOA,SAG5B,GAGP,KAAOjmC,MAAQm2E,KAAK9iF,QAAU8iF,KAAKn2E,OAASqX,GACxCrX,QACAimC,QAGJ,OAAIgwC,GAAKE,KAAKn2E,MAAQimC,QAAmB,GAATA,SAG5BiwC,SACIjwC,MAAQ,EACRkwC,KAAKj0E,OAAOlC,MAAQimC,MAAOA,MAAOgwC,GAGlCE,KAAKj0E,OAAOlC,MAAQimC,MAAOA,MAAOgwC,EAAG5+D,KAGtC,M,iQC1FJ,MAAM+/C,IAOjBntD,YAAYusE,oBAAqBz5D,QAAU,IACvCvrB,KAAKwkF,aAAeQ,oBACpBhlF,KAAKspE,SAAWp4D,OAAOq4D,OAAO,CAAE0b,SAAU,GAAK15D,SAQnDq5D,WAAWha,GAAIC,GAAI3mD,GACf,IACIghE,KAAMC,YAAaC,YADnBlmD,OAAS,GAEb,OAAQl/B,KAAKspE,SAAS2b,UAClB,KAAK,EACDE,YAAc,EACdC,YAAc,CAAC,EAAG,GAClBF,KAAO,CACHxO,sDACAA,sDACAA,sDACAA,uDAEJ,MACJ,KAAK,EACDwO,KAAOxO,mDACPyO,YAAc,EACdC,YAAc,EAAE,EAAG,GACnB,MACJ,KAAK,EACDF,KAAOxO,mDACPyO,YAAc,EACdC,YAAc,EAAE,EAAG,GACnB,MACJ,QACI,MAAM,IAAIr0D,MAAM,0CAIxB,IAAI/b,EAAI41D,GAAKwa,YAAY,GAAKlhE,EAC1BjP,EAAI41D,GAAKua,YAAY,GAAKlhE,EAE9B,IAAK,IAAItiB,EAAI,EAAGA,EAAIsjF,KAAKrjF,OAAQD,IAC7B,IAAK,IAAIK,EAAI,EAAGA,EAAIiiB,EAAIihE,YAAaljF,IACjCi9B,OAAOv4B,KAAK,CAACqO,EAAGC,IAChBD,GAAKkwE,KAAKtjF,GAAG,GACbqT,GAAKiwE,KAAKtjF,GAAG,GAGrB,OAAOs9B,U,4QCtDA,MAAMmlD,6BAA6Bze,6CAC9Cr8B,QAAQv0B,EAAGC,EAAGwQ,EAAG8+D,UAIb,GAFAA,SAASvvE,EAAGC,EAAG,EAAG,IAEbjV,KAAKwkF,aAAaxvE,EAAGC,GACtB,OAGJ,IACI21D,GAAIC,GAAI6Z,OAAQW,GAAIC,GAAIpf,WADxBqf,QAAU,GAGd,IAAK,IAAIrhE,EAAI,EAAGA,GAAKuB,EAAGvB,IAAK,CACzB,IAAI4b,UAAY9/B,KAAK4kF,WAAW5vE,EAAGC,EAAGiP,GAClCshE,cAAgB1lD,UAAUj+B,OAC9B,IAAK,IAAID,EAAI,EAAGA,EAAI4jF,cAAe5jF,IAW/B,GAVAgpE,GAAK9qC,UAAUl+B,GAAG,GAClBipE,GAAK/qC,UAAUl+B,GAAG,GAElByjF,GAAK,CAACzjF,EAAI,EAAIA,EAAI,EAAI,EAAI4jF,cAAgB,EAAG,EAAIA,eACjDF,GAAK,CAAC,EAAI1jF,EAAI,EAAG,EAAI4jF,eACrBd,QAAU1kF,KAAKwkF,aAAa5Z,GAAIC,IAChC3E,WAAalmE,KAAKylF,iBAAiBJ,GAAIC,GAAIZ,OAAQa,SAC/Crf,YACAqe,SAAS3Z,GAAIC,GAAI3mD,EAAGgiD,YAEF,GAAlBqf,QAAQ1jF,QAAgC,GAAjB0jF,QAAQ,GAAG,IAAWA,QAAQ,GAAG,IAAMA,QAAQ,GAAG,GACzE,QAWhBE,iBAAiBJ,GAAIC,GAAIZ,OAAQa,SAC7B,GAAIF,GAAG,GAAKC,GAAG,GAAI,CAGf,OAFStlF,KAAKylF,iBAAiBJ,GAAI,CAACA,GAAG,GAAIA,GAAG,IAAKX,OAAQa,SAClDvlF,KAAKylF,iBAAiB,CAAC,EAAG,GAAIH,GAAIZ,OAAQa,UAChC,EAGvB,IAAIG,OAAS,EAAGC,OAAQ,EACxB,KAAOD,OAASH,QAAQ1jF,QAAQ,CAC5B,IAAIwrB,IAAMk4D,QAAQG,QACdv2E,KAAOke,IAAI,GAAKg4D,GAAG,GAAKA,GAAG,GAAKh4D,IAAI,GACxC,GAAIle,MAAQ,EAAG,CACC,GAARA,MAAeu2E,OAAS,IACxBC,OAAQ,GAEZ,MAEJD,SAGJ,IAAIE,OAASL,QAAQ1jF,OAAQgkF,OAAQ,EACrC,KAAOD,UAAU,CACb,IAAIv4D,IAAMk4D,QAAQK,QACdz2E,KAAOm2E,GAAG,GAAKj4D,IAAI,GAAKA,IAAI,GAAKi4D,GAAG,GACxC,GAAIn2E,MAAQ,EAAG,CACC,GAARA,MAAcy2E,OAAS,IACvBC,OAAQ,GAEZ,OAGR,IAaIC,cAbA1gC,SAAU,EAUd,IATIsgC,QAAUE,SAAWD,OAASE,QAGzBF,OAASE,OAASH,OAAS,GAAKE,QAAWA,OAAS,GAGpDF,OAASE,QAAWF,OAAS,KALlCtgC,SAAU,IAQTA,QACD,OAAO,EAIX,IAAIl3B,OAAS03D,OAASF,OAAS,EAC/B,GAAIx3D,OAAS,EACT,GAAIw3D,OAAS,EAAG,CACZ,IAAIK,EAAIR,QAAQG,QAChBI,eAAiBR,GAAG,GAAKS,EAAE,GAAKA,EAAE,GAAKT,GAAG,KAAOS,EAAE,GAAKT,GAAG,IACvDZ,QACAa,QAAQ70E,OAAOg1E,OAAQx3D,OAAQo3D,QAGlC,CACD,IAAIS,EAAIR,QAAQK,QAChBE,eAAiBC,EAAE,GAAKV,GAAG,GAAKA,GAAG,GAAKU,EAAE,KAAOV,GAAG,GAAKU,EAAE,IACvDrB,QACAa,QAAQ70E,OAAOg1E,OAAQx3D,OAAQm3D,QAItC,CACD,KAAIK,OAAS,GAYT,OAHIhB,QACAa,QAAQ70E,OAAOg1E,OAAQx3D,OAAQm3D,GAAIC,IAEhC,EAZK,CACZ,IAAIU,GAAKT,QAAQG,QACbO,GAAKV,QAAQK,QACjBE,eAAiBG,GAAG,GAAKD,GAAG,GAAKA,GAAG,GAAKC,GAAG,KAAOD,GAAG,GAAKC,GAAG,IAC1DvB,QACAa,QAAQ70E,OAAOg1E,OAAQx3D,SAWnC,OAAO43D,gBADUR,GAAG,GAAKD,GAAG,GAAKA,GAAG,GAAKC,GAAG,KAAOD,GAAG,GAAKC,GAAG,Q,8QCxHtE,MAAMY,QAAU,CACZ,EAAE,EAAG,EAAG,EAAG,GACX,CAAC,GAAI,EAAG,EAAG,GACX,CAAC,GAAI,GAAI,EAAG,GACZ,EAAE,EAAG,EAAG,GAAI,GACZ,CAAC,EAAG,EAAG,GAAI,GACX,CAAC,EAAG,GAAI,EAAG,GACX,CAAC,EAAG,EAAG,EAAG,GACV,CAAC,EAAG,EAAG,EAAG,IAQC,MAAM5B,+BAA+B1e,6CAQhDr8B,QAAQv0B,EAAGC,EAAGwQ,EAAG8+D,UAEbA,SAASvvE,EAAGC,EAAG,EAAG,GAClB,IAAK,IAAIrT,EAAI,EAAGA,EAAIskF,QAAQrkF,OAAQD,IAChC5B,KAAKmmF,cAAcnxE,EAAGC,EAAGixE,QAAQtkF,GAAI6jB,EAAG8+D,UAWhD6B,WAAWpxE,EAAGC,EAAGwQ,EAAGwsB,IAAKsyC,UAErBA,SAASvvE,EAAGC,EAAG,EAAG,GAClB,IAAIoxE,gBAAkBp0C,IAAM,EAAI,GAAK,EACjCq0C,oBAAsBr0C,IAAM,EAAI,GAAK,EACrCs0C,YAAct0C,IAAM,EAAI,GAAK,EACjCjyC,KAAKmmF,cAAcnxE,EAAGC,EAAGixE,QAAQI,oBAAqB7gE,EAAG8+D,UACzDvkF,KAAKmmF,cAAcnxE,EAAGC,EAAGixE,QAAQG,gBAAiB5gE,EAAG8+D,UACrDvkF,KAAKmmF,cAAcnxE,EAAGC,EAAGixE,QAAQj0C,KAAMxsB,EAAG8+D,UAC1CvkF,KAAKmmF,cAAcnxE,EAAGC,EAAGixE,QAAQK,YAAa9gE,EAAG8+D,UAWrDiC,UAAUxxE,EAAGC,EAAGwQ,EAAGwsB,IAAKsyC,UAEpBA,SAASvvE,EAAGC,EAAG,EAAG,GAClB,IAAIoxE,gBAAkBp0C,IAAM,EAAI,GAAK,EACrCjyC,KAAKmmF,cAAcnxE,EAAGC,EAAGixE,QAAQj0C,KAAMxsB,EAAG8+D,UAC1CvkF,KAAKmmF,cAAcnxE,EAAGC,EAAGixE,QAAQG,gBAAiB5gE,EAAG8+D,UAUzD4B,cAAcnxE,EAAGC,EAAGwxE,OAAQhhE,EAAG8+D,UAE3BvkF,KAAK0mF,gBAAgB1xE,EAAGC,EAAG,EAAG,EAAK,EAAKwQ,EAAI,EAAGghE,OAAO,GAAIA,OAAO,GAAIA,OAAO,GAAIA,OAAO,GAAIlC,UAgB/FmC,gBAAgBvyC,OAAQC,OAAQjxB,IAAKwjE,cAAeC,YAAaC,OAAQC,GAAIC,GAAIC,GAAIC,GAAI1C,UACrF,KAAIoC,cAAgBC,aAGpB,IAAK,IAAIhlF,EAAIuhB,IAAKvhB,GAAKilF,OAAQjlF,IAAK,CAChC,IAAIu/B,IAAMv/B,EAAI,EACVw/B,IAAMx/B,EACNssC,SAAU,EACVg5C,SAAW,EAEf,KAAO/lD,IAAM,GAAG,CACZA,IAAM,EAEN,IAAIgmD,KAAOhzC,OAAShT,GAAK2lD,GAAK1lD,GAAK2lD,GAC/BK,KAAOhzC,OAASjT,GAAK6lD,GAAK5lD,GAAK6lD,GAE/BI,YAAclmD,GAAK,KAAQC,GAAK,IAChCkmD,UAAYnmD,GAAK,KAAQC,GAAK,IAElC,KAAIkmD,SAAWX,eAAf,CAIA,GAAIU,WAAaT,YACb,MAMJ,GAHKzlD,GAAKA,GAAKC,GAAKA,GAAOylD,OAASA,QAChCtC,SAAS4C,KAAMC,KAAMxlF,EAAG,GAEvBssC,QAQA,CAED,IAAKluC,KAAKwkF,aAAa2C,KAAMC,MAAO,CAChCF,SAAWI,SACX,SAGJp5C,SAAU,EACVy4C,cAAgBO,cAdXlnF,KAAKwkF,aAAa2C,KAAMC,OAASxlF,EAAIilF,SACtC34C,SAAU,EACVluC,KAAK0mF,gBAAgBvyC,OAAQC,OAAQxyC,EAAI,EAAG+kF,cAAeU,WAAYR,OAAQC,GAAIC,GAAIC,GAAIC,GAAI1C,UAC/F2C,SAAWI,WAcvB,GAAIp5C,QACA,U,uuBCxIhB,kCAAiBq5C,MAAF,+CAASC,QAAT,iDAAkBC,SAAlB,kDAA4BC,OAA5B,gDAAoCC,UAApC,mDAA+CC,YAA/C,qDAA4DC,SAA5D,kDAAsEC,MAAKA,iD,6PCH3E,MAAMP,cAAct4D,6CAC/B7c,OAAOmyE,UACH,IAAIwD,EAAI/nF,KAAK0hB,OAAS,EAClBoE,EAAI9lB,KAAK2hB,QAAU,EACvB,IAAK,IAAI/f,EAAI,EAAGA,GAAKmmF,EAAGnmF,IACpB,IAAK,IAAIK,EAAI,EAAGA,GAAK6jB,EAAG7jB,IAAK,CAEzBsiF,SAAS3iF,EAAGK,EADCL,GAAKK,GAAKL,EAAImmF,GAAK9lF,EAAI6jB,EACb,EAAI,GAGnC,OAAO9lB,Q,iQCbA,MAAMivB,IAMjBxW,YAAY8E,MAAQgrD,yDAAe/qD,OAASgrD,2DACxCxoE,KAAK0hB,OAASnE,MACdvd,KAAK2hB,QAAUnE,OAGnBwqE,SAAS/lE,OACL,IAAIniB,IAAM,GACV,IAAK,IAAI8B,EAAI,EAAGA,EAAI5B,KAAK0hB,OAAQ9f,IAAK,CAClC9B,IAAI6G,KAAK,IACT,IAAK,IAAI1E,EAAI,EAAGA,EAAIjC,KAAK2hB,QAAS1f,IAC9BnC,IAAI8B,GAAG+E,KAAKsb,OAGpB,OAAOniB,O,oYCbA,MAAM0nF,gBAAgBS,iDACjCxvE,YAAY8E,MAAOC,OAAQ+N,SACvBrO,MAAMK,MAAOC,QACbxd,KAAKspE,SAAW,CACZ4e,UAAW,CAAC,EAAG,GACfC,WAAY,CAAC,EAAG,GAChBC,kBAAmB,GACnBC,UAAW,KAEfn3E,OAAOq4D,OAAOvpE,KAAKspE,SAAU/9C,SAC7BvrB,KAAKsoF,KAAO,GACZtoF,KAAKuoF,KAAO,EACZvoF,KAAKwoF,cAAgB,GACrBxoF,KAAKyoF,kBAAoB,GACzBzoF,KAAK0oF,WAAa,GAClB1oF,KAAK2oF,aAAe,GACpB3oF,KAAK4oF,aAAe5oF,KAAK4oF,aAAaz7E,KAAKnN,MAC3CA,KAAK6oF,kBAAoB7oF,KAAK6oF,kBAAkB17E,KAAKnN,MACrDA,KAAK8oF,gBAAkB9oF,KAAK8oF,gBAAgB37E,KAAKnN,MAMrDoS,OAAOmyE,UACH,IAAIwE,GAAKx5E,KAAKC,MACd,OAAU,CAEN,GADSD,KAAKC,MACLu5E,GAAK/oF,KAAKspE,SAAS+e,UACxB,OAAO,KAOX,GALAroF,KAAKsoF,KAAOtoF,KAAKgoF,SAAS,GAC1BhoF,KAAKuoF,KAAO,EACZvoF,KAAKgpF,OAAS,GACdhpF,KAAK2oF,aAAe,GACpB3oF,KAAKipF,mBACDjpF,KAAKgpF,OAAOnnF,OAAS,IAGrB7B,KAAKkpF,qBACL,MAGR,GAAI3E,SACA,IAAK,IAAI3iF,EAAI,EAAGA,EAAI5B,KAAK0hB,OAAQ9f,IAC7B,IAAK,IAAIK,EAAI,EAAGA,EAAIjC,KAAK2hB,QAAS1f,IAC9BsiF,SAAS3iF,EAAGK,EAAGjC,KAAKsoF,KAAK1mF,GAAGK,IAIxC,OAAOjC,KAKXipF,iBACI,IAEIE,KAFApB,EAAI/nF,KAAK0hB,OAAS,EAClBoE,EAAI9lB,KAAK2hB,QAAU,EAEvB,GAEI,GADAwnE,KAAOnpF,KAAKopF,gBACRppF,KAAKuoF,MAAQR,EAAIjiE,GAAK9lB,KAAKspE,SAAS8e,kBACpC,YAECe,MAMbC,gBACI,IAAI30C,MAAQ,EACZ,KAAOA,MAAQz0C,KAAKwoF,eAAe,CAC/B/zC,QACA,IAAI00C,KAAOE,4DAAkBrpF,KAAK0hB,OAAQ1hB,KAAK2hB,QAAS3hB,KAAKspE,UAC7D,GAAK6f,KAAK38C,QAAQxsC,KAAK8oF,gBAAiB9oF,KAAK6oF,mBAK7C,OAFAM,KAAK/2E,OAAOpS,KAAK4oF,cACjB5oF,KAAKgpF,OAAOriF,KAAKwiF,MACVA,KAGX,OAAO,KAMXD,qBACI,IAAIt3E,IAAM,EACV,KAAOA,IAAM5R,KAAKyoF,mBAAmB,CACjC72E,MACA5R,KAAKspF,WAAa,GAElBtpF,KAAKsoF,KAAOtoF,KAAKgoF,SAAS,GAC1B,IAAK,IAAIpmF,EAAI,EAAGA,EAAI5B,KAAKgpF,OAAOnnF,OAAQD,IAAK,CACzC,IAAIunF,KAAOnpF,KAAKgpF,OAAOpnF,GACvBunF,KAAKI,aACLJ,KAAK/2E,OAAOpS,KAAK4oF,cAOrB,IALA5oF,KAAK2oF,aAAeniB,qDAAYxmE,KAAKgpF,OAAOz9E,SAC5CvL,KAAK0oF,WAAa,GACd1oF,KAAK2oF,aAAa9mF,QAClB7B,KAAK0oF,WAAW/hF,KAAK3G,KAAK2oF,aAAaviF,SAEjC,CAEN,IAAIojF,UAAYhjB,qDAAYxmE,KAAK0oF,YACjC,IAAKc,UACD,MAGJ,IAAIC,MAAQzpF,KAAK0pF,aAAa1pF,KAAK2oF,aAAca,WACjD,IAAKC,MACD,MAGJ,IAAIE,MAAQ3pF,KAAK0pF,aAAa1pF,KAAK0oF,WAAYe,OAC/C,IAAKE,MACD,MAGJ,IADS3pF,KAAK4pF,cAAcH,MAAOE,OAE/B,MAEJ,IAAK3pF,KAAK2oF,aAAa9mF,OACnB,OAAO,GAInB,OAAO,EAMX6nF,aAAaG,MAAOV,MAChB,IAAIW,KAAO58E,IACPo0D,OAAS6nB,KAAKY,YACd7qD,OAAS,KACb,IAAK,IAAIt9B,EAAI,EAAGA,EAAIioF,MAAMhoF,OAAQD,IAAK,CACnC,IAAIsiB,EAAI2lE,MAAMjoF,GACVyf,EAAI6C,EAAE6lE,YACN5oD,GAAK9f,EAAE,GAAKigD,OAAO,GACnBlgC,GAAK/f,EAAE,GAAKigD,OAAO,GACnBxsC,EAAIqM,GAAKA,GAAKC,GAAKA,GACnBtM,EAAIg1D,OACJA,KAAOh1D,EACPoK,OAAShb,GAGjB,OAAOgb,OAEX0qD,cAAcH,MAAOE,OAKjB,IAII7qF,MACAiQ,IACAi7E,UAAWC,UAAWn7E,IAAK1C,IAAKoC,MANhC07E,QAAUT,MAAMM,YAChBI,QAAUR,MAAMI,YAChBK,MAAQD,QAAQ,GAAKD,QAAQ,GAC7BG,MAAQF,QAAQ,GAAKD,QAAQ,GAmBjC,GAfI/9E,KAAKK,IAAI49E,OAASj+E,KAAKK,IAAI69E,QAC3BL,UAAaK,MAAQ,EAAI,EAAI,EAC7BJ,WAAaD,UAAY,GAAK,EAC9Bl7E,IAAM66E,MAAMW,UACZl+E,IAAMu9E,MAAMY,WACZ/7E,MAAQ,IAGRw7E,UAAaI,MAAQ,EAAI,EAAI,EAC7BH,WAAaD,UAAY,GAAK,EAC9Bl7E,IAAM66E,MAAMa,SACZp+E,IAAMu9E,MAAMc,YACZj8E,MAAQ,GAEZ1P,MAAQkB,KAAK0qF,aAAajB,MAAOO,YAC5BlrF,MACD,OAAO,EAEX,GAAIA,MAAM0P,QAAUM,KAAOhQ,MAAM0P,QAAUpC,IAAK,CAC5C2C,IAAMjQ,MAAMyM,QACZ,IAAI0W,MAAQ,EACZ,OAAQgoE,WACJ,KAAK,EACDhoE,MAAQ0nE,MAAMa,SAAW,EACzB,MACJ,KAAK,EACDvoE,MAAQ0nE,MAAMY,WAAa,EAC3B,MACJ,KAAK,EACDtoE,MAAQ0nE,MAAMc,YAAc,EAC5B,MACJ,KAAK,EACDxoE,MAAQ0nE,MAAMW,UAAY,EAGlCv7E,KAAKP,MAAQ,GAAK,GAAKyT,MACvBjiB,KAAK2qF,SAAS,CAAC7rF,MAAOiQ,WAErB,GAAIjQ,MAAM0P,OAASM,IAAM,GAAKhQ,MAAM0P,OAASpC,IAAM,EAAG,CACvD,IAAI+C,KAAOrQ,MAAM0P,OAAS27E,QAAQ37E,OAC9Bo8E,SAAW,EACf,OAAQX,WACJ,KAAK,EACL,KAAK,EACDW,SAAYz7E,KAAO,EAAI,EAAI,EAC3B,MACJ,KAAK,EACL,KAAK,EACDy7E,SAAYz7E,KAAO,EAAI,EAAI,EAKnC,GAFA86E,WAAaA,UAAYW,UAAY,EACrC77E,IAAM/O,KAAK0qF,aAAaf,MAAOM,YAC1Bl7E,IACD,OAAO,EAEX,IAAI87E,IAAM,CAAC,EAAG,GACdA,IAAIr8E,OAAS1P,MAAM0P,OACnB,IAAIo3E,QAAUp3E,MAAQ,GAAK,EAC3Bq8E,IAAIjF,QAAU72E,IAAI62E,QAClB5lF,KAAK2qF,SAAS,CAAC7rF,MAAO+rF,IAAK97E,UAE1B,CACD,IAAI62E,QAAUp3E,MAAQ,GAAK,EAE3B,GADAO,IAAM/O,KAAK0qF,aAAaf,MAAOM,YAC1Bl7E,IACD,OAAO,EAEX,IAAI87E,IAAM1+E,KAAKyD,OAAOb,IAAI62E,QAAU9mF,MAAM8mF,SAAW,GACjDkF,KAAO,CAAC,EAAG,GACXC,KAAO,CAAC,EAAG,GACfD,KAAKt8E,OAAS1P,MAAM0P,OACpBs8E,KAAKlF,QAAUiF,IACfE,KAAKv8E,OAASO,IAAIP,OAClBu8E,KAAKnF,QAAUiF,IACf7qF,KAAK2qF,SAAS,CAAC7rF,MAAOgsF,KAAMC,KAAMh8E,MActC,OAZA06E,MAAMuB,QAAQlsF,MAAM,GAAIA,MAAM,IAC9B6qF,MAAMqB,QAAQj8E,IAAI,GAAIA,IAAI,IAC1BP,MAAQxO,KAAK2oF,aAAal6E,QAAQg7E,QACpB,GAAVj7E,QACAxO,KAAK2oF,aAAaj4E,OAAOlC,MAAO,GAChCxO,KAAK0oF,WAAW/hF,KAAK8iF,QAEzBj7E,MAAQxO,KAAK2oF,aAAal6E,QAAQk7E,QACpB,GAAVn7E,QACAxO,KAAK2oF,aAAaj4E,OAAOlC,MAAO,GAChCxO,KAAK0oF,WAAW/hF,KAAKgjF,SAElB,EAEXe,aAAavB,KAAM8B,UACf,IAAInsF,MAAQ,CAAC,EAAG,GACZmzC,IAAM,CAAC,EAAG,GACVpwC,OAAS,EACb,OAAQopF,UACJ,KAAK,EACDh5C,IAAM,CAAC,EAAG,GACVnzC,MAAQ,CAACqqF,KAAKmB,UAAWnB,KAAKqB,SAAW,GACzC3oF,OAASsnF,KAAKoB,WAAapB,KAAKmB,UAAY,EAC5C,MACJ,KAAK,EACDr4C,IAAM,CAAC,EAAG,GACVnzC,MAAQ,CAACqqF,KAAKoB,WAAa,EAAGpB,KAAKqB,UACnC3oF,OAASsnF,KAAKsB,YAActB,KAAKqB,SAAW,EAC5C,MACJ,KAAK,EACDv4C,IAAM,CAAC,EAAG,GACVnzC,MAAQ,CAACqqF,KAAKmB,UAAWnB,KAAKsB,YAAc,GAC5C5oF,OAASsnF,KAAKoB,WAAapB,KAAKmB,UAAY,EAC5C,MACJ,KAAK,EACDr4C,IAAM,CAAC,EAAG,GACVnzC,MAAQ,CAACqqF,KAAKmB,UAAY,EAAGnB,KAAKqB,UAClC3oF,OAASsnF,KAAKsB,YAActB,KAAKqB,SAAW,EAGpD,IAAI1V,MAAQ,GACRoW,cAAgB,EACpB,IAAK,IAAItpF,EAAI,EAAGA,EAAIC,OAAQD,IAAK,CAC7B,IAAIoT,EAAIlW,MAAM,GAAK8C,EAAIqwC,IAAI,GACvBh9B,EAAInW,MAAM,GAAK8C,EAAIqwC,IAAI,GAC3B6iC,MAAMnuE,KAAK,MACsB,GAAnB3G,KAAKsoF,KAAKtzE,GAAGC,GAEnBi2E,cAAgBtpF,EAAI,IACpBkzE,MAAMlzE,GAAK,CAACoT,EAAGC,KAInBi2E,aAAetpF,EACXA,IACAkzE,MAAMlzE,EAAI,GAAK,OAI3B,IAAK,IAAIA,EAAIkzE,MAAMjzE,OAAS,EAAGD,GAAK,EAAGA,IAC9BkzE,MAAMlzE,IACPkzE,MAAMpkE,OAAO9O,EAAG,GAGxB,OAAQkzE,MAAMjzE,OAAS2kE,qDAAYsO,OAAS,KAKhD6V,SAASQ,QACL,IAAK,IAAIvpF,EAAI,EAAGA,EAAIupF,OAAOtpF,OAAQD,IAAK,CACpC,IAAI9C,MAAQqsF,OAAOvpF,EAAI,GACnBmN,IAAMo8E,OAAOvpF,GACbwpF,SAAW,IAAIC,mDAASvsF,MAAM,GAAIA,MAAM,GAAIiQ,IAAI,GAAIA,IAAI,IAC5Dq8E,SAASh5E,OAAOpS,KAAK4oF,cACrB5oF,KAAKspF,WAAW3iF,KAAKykF,WAG7BxC,aAAa5zE,EAAGC,EAAGgN,OACfjiB,KAAKsoF,KAAKtzE,GAAGC,GAAKgN,MACL,GAATA,OACAjiB,KAAKuoF,OAGbO,gBAAgB9zE,EAAGC,GACf,QAAID,EAAI,GAAKC,EAAI,GAAKD,GAAKhV,KAAK0hB,QAAUzM,GAAKjV,KAAK2hB,UAGzB,GAAnB3hB,KAAKsoF,KAAKtzE,GAAGC,GAEzB4zE,kBAAkB7zE,EAAGC,GACjB,QAAID,EAAI,GAAKC,EAAI,GAAKD,EAAI,GAAKhV,KAAK0hB,QAAUzM,EAAI,GAAKjV,KAAK2hB,UAGjC,GAAnB3hB,KAAKsoF,KAAKtzE,GAAGC,M,+PCpVd,MAAMgzE,gBAAgBh5D,6CACjCxW,YAAY8E,MAAOC,QACfN,MAAMK,MAAOC,QACbxd,KAAKgpF,OAAS,GACdhpF,KAAKspF,WAAa,GAMtBgC,WAAa,OAAOtrF,KAAKgpF,OAKzBuC,eAAiB,OAAOvrF,KAAKspF,c,+QCfjC,MAAMkC,SAYC,MAAMnC,aAAamC,QACtB/yE,YAAYuzB,GAAIC,GAAIw4B,GAAIC,GAAI+mB,MAAOC,OAC/BxuE,QACAld,KAAK2rF,IAAM3/C,GACXhsC,KAAK4rF,IAAM3/C,GACXjsC,KAAK6rF,IAAMpnB,GACXzkE,KAAK8rF,IAAMpnB,GACX1kE,KAAK+rF,OAAS,QACAvjF,IAAVijF,YAAiCjjF,IAAVkjF,OACvB1rF,KAAKgrF,QAAQS,MAAOC,OAO5B,sBAAsB12E,EAAGC,EAAGksB,GAAIC,GAAI7V,SAChC,IAAIzc,IAAMyc,QAAQ28D,UAAU,GACxB97E,IAAMmf,QAAQ28D,UAAU,GACxB3qE,MAAQipD,2DAAkB13D,IAAK1C,KACnC0C,IAAMyc,QAAQ48D,WAAW,GACzB/7E,IAAMmf,QAAQ48D,WAAW,GACzB,IAAI3qE,OAASgpD,2DAAkB13D,IAAK1C,KACpC,GAAU,GAAN+0B,GAAS,CACT,IAAIujC,GAAKzvD,EAAI9I,KAAK41B,MAAMykC,0DAAmBhpD,QAC3C,OAAO,IAAIxd,KAAKgV,EAAI,EAAG0vD,GAAI1vD,EAAIuI,MAAOmnD,GAAKlnD,OAAS,EAAGxI,EAAGC,GAE9D,IAAW,GAAPksB,GAAU,CACV,IAAIujC,GAAKzvD,EAAI9I,KAAK41B,MAAMykC,0DAAmBhpD,QAC3C,OAAO,IAAIxd,KAAKgV,EAAIuI,MAAOmnD,GAAI1vD,EAAI,EAAG0vD,GAAKlnD,OAAS,EAAGxI,EAAGC,GAE9D,GAAU,GAANmsB,GAAS,CACT,IAAIqjC,GAAKzvD,EAAI7I,KAAK41B,MAAMykC,0DAAmBjpD,OAC3C,OAAO,IAAIvd,KAAKykE,GAAIxvD,EAAI,EAAGwvD,GAAKlnD,MAAQ,EAAGtI,EAAIuI,OAAQxI,EAAGC,GAE9D,IAAW,GAAPmsB,GAAU,CACV,IAAIqjC,GAAKzvD,EAAI7I,KAAK41B,MAAMykC,0DAAmBjpD,OAC3C,OAAO,IAAIvd,KAAKykE,GAAIxvD,EAAIuI,OAAQinD,GAAKlnD,MAAQ,EAAGtI,EAAI,EAAGD,EAAGC,GAE9D,MAAM,IAAI8b,MAAM,4BAKpB,0BAA0B65C,GAAIC,GAAIt/C,SAC9B,IAAIzc,IAAMyc,QAAQ28D,UAAU,GACxB97E,IAAMmf,QAAQ28D,UAAU,GACxB3qE,MAAQipD,2DAAkB13D,IAAK1C,KACnC0C,IAAMyc,QAAQ48D,WAAW,GACzB/7E,IAAMmf,QAAQ48D,WAAW,GACzB,IAAI3qE,OAASgpD,2DAAkB13D,IAAK1C,KAChC4/B,GAAK4+B,GAAKz+D,KAAK41B,MAAMykC,0DAAmBjpD,OACxC0uB,GAAK4+B,GAAK1+D,KAAK41B,MAAMykC,0DAAmBhpD,QAG5C,OAAO,IAAIxd,KAAKgsC,GAAIC,GAFXD,GAAKzuB,MAAQ,EACb0uB,GAAKzuB,OAAS,GAM3B,oBAAoB2sD,WAAYC,YAAa7+C,SACzC,IAAIzc,IAAMyc,QAAQ28D,UAAU,GACxB97E,IAAMmf,QAAQ28D,UAAU,GACxB3qE,MAAQipD,2DAAkB13D,IAAK1C,KACnC0C,IAAMyc,QAAQ48D,WAAW,GACzB/7E,IAAMmf,QAAQ48D,WAAW,GACzB,IAAI3qE,OAASgpD,2DAAkB13D,IAAK1C,KAChC0S,KAAOqrD,WAAa5sD,MAAQ,EAC5B4gD,IAAMiM,YAAc5sD,OAAS,EAC7BwuB,GAAK,EAAI7/B,KAAK41B,MAAMykC,0DAAmB1nD,MACvCmtB,GAAK,EAAI9/B,KAAK41B,MAAMykC,0DAAmBrI,KAG3C,OAAO,IAAIn+D,KAAKgsC,GAAIC,GAFXD,GAAKzuB,MAAQ,EACb0uB,GAAKzuB,OAAS,GAG3BwtE,QAAQh2E,EAAGC,GAEP,OADAjV,KAAK+rF,OAAO/2E,EAAI,IAAMC,GAAK,EACpBjV,KAKXgsF,SAASp2D,IACL,IAAK,IAAIpiB,OAAOxT,KAAK+rF,OAAQ,CACzB,IAAI9mE,MAAQzR,IAAI5P,MAAM,KACtBgyB,GAAGjyB,SAASshB,MAAM,IAAKthB,SAASshB,MAAM,KAE1C,OAAOjlB,KAEXupF,aAEI,OADAvpF,KAAK+rF,OAAS,GACP/rF,KAEXisF,SAASC,gBACL,IAAIptE,KAAO9e,KAAK2rF,IAAM,EAClB5sE,MAAQ/e,KAAK6rF,IAAM,EACnB1tB,IAAMn+D,KAAK4rF,IAAM,EACjB1qB,OAASlhE,KAAK8rF,IAAM,EACxB,IAAK,IAAI92E,EAAI8J,KAAM9J,GAAK+J,MAAO/J,IAC3B,IAAK,IAAIC,EAAIkpD,IAAKlpD,GAAKisD,OAAQjsD,IACvBD,GAAK8J,MAAQ9J,GAAK+J,OAAS9J,GAAKkpD,KAAOlpD,GAAKisD,QAG5CgrB,eAAel3E,EAAGC,IAGtBjV,KAAKgrF,QAAQh2E,EAAGC,GAGxB,OAAOjV,KAEXmsF,QACI3lF,QAAQ+2B,IAAI,OAAQv9B,KAAK2rF,IAAK3rF,KAAK4rF,IAAK5rF,KAAK6rF,IAAK7rF,KAAK8rF,KAE3Dt/C,QAAQ0/C,eAAgBE,kBACpB,IAAIttE,KAAO9e,KAAK2rF,IAAM,EAClB5sE,MAAQ/e,KAAK6rF,IAAM,EACnB1tB,IAAMn+D,KAAK4rF,IAAM,EACjB1qB,OAASlhE,KAAK8rF,IAAM,EACxB,IAAK,IAAI92E,EAAI8J,KAAM9J,GAAK+J,MAAO/J,IAC3B,IAAK,IAAIC,EAAIkpD,IAAKlpD,GAAKisD,OAAQjsD,IAC3B,GAAID,GAAK8J,MAAQ9J,GAAK+J,OAAS9J,GAAKkpD,KAAOlpD,GAAKisD,QAC5C,IAAKgrB,eAAel3E,EAAGC,GACnB,OAAO,OAIX,IAAKm3E,iBAAiBp3E,EAAGC,GACrB,OAAO,EAKvB,OAAO,EAKX7C,OAAOi6E,aACH,IAAIvtE,KAAO9e,KAAK2rF,IAAM,EAClB5sE,MAAQ/e,KAAK6rF,IAAM,EACnB1tB,IAAMn+D,KAAK4rF,IAAM,EACjB1qB,OAASlhE,KAAK8rF,IAAM,EACpB7pE,MAAQ,EACZ,IAAK,IAAIjN,EAAI8J,KAAM9J,GAAK+J,MAAO/J,IAC3B,IAAK,IAAIC,EAAIkpD,IAAKlpD,GAAKisD,OAAQjsD,IAEvBgN,MADAjN,EAAI,IAAMC,KAAKjV,KAAK+rF,OACZ,EAEH/2E,GAAK8J,MAAQ9J,GAAK+J,OAAS9J,GAAKkpD,KAAOlpD,GAAKisD,OACzC,EAGA,EAEZmrB,YAAYr3E,EAAGC,EAAGgN,OAI9B8nE,YACI,MAAO,CAAC59E,KAAKyD,OAAO5P,KAAK2rF,IAAM3rF,KAAK6rF,KAAO,GAAI1/E,KAAKyD,OAAO5P,KAAK4rF,IAAM5rF,KAAK8rF,KAAO,IAEtFxB,UAAY,OAAOtqF,KAAK2rF,IACxBpB,WAAa,OAAOvqF,KAAK6rF,IACzBrB,SAAW,OAAOxqF,KAAK4rF,IACvBnB,YAAc,OAAOzqF,KAAK8rF,KAUvB,MAAMT,iBAAiBG,QAC1B/yE,YAAY07B,OAAQC,OAAQk4C,KAAMC,MAC9BrvE,QACAld,KAAKwsF,QAAUr4C,OACfn0C,KAAKysF,QAAUr4C,OACfp0C,KAAK0sF,MAAQJ,KACbtsF,KAAK2sF,MAAQJ,KACbvsF,KAAK4sF,gBAAiB,EAE1B,sBAAsB53E,EAAGC,EAAGksB,GAAIC,GAAI7V,SAChC,IAAIzc,IAAMyc,QAAQshE,eAAe,GAC7BzgF,IAAMmf,QAAQshE,eAAe,GAC7BhrF,OAAS2kE,2DAAkB13D,IAAK1C,KACpC,OAAO,IAAIpM,KAAKgV,EAAGC,EAAGD,EAAImsB,GAAKt/B,OAAQoT,EAAImsB,GAAKv/B,QAEpDsqF,QACI3lF,QAAQ+2B,IAAI,WAAYv9B,KAAKwsF,QAASxsF,KAAKysF,QAASzsF,KAAK0sF,MAAO1sF,KAAK2sF,OAEzEngD,QAAQ0/C,eAAgBE,kBACpB,IAAIlgD,GAAKlsC,KAAKwsF,QACVrgD,GAAKnsC,KAAKysF,QACVtrD,GAAKnhC,KAAK0sF,MAAQxgD,GAClB9K,GAAKphC,KAAK2sF,MAAQxgD,GAClBtqC,OAAS,EAAIsK,KAAKC,IAAID,KAAKK,IAAI20B,IAAKh1B,KAAKK,IAAI40B,KAC7CD,KACAA,IAAUh1B,KAAKK,IAAI20B,KAEnBC,KACAA,IAAUj1B,KAAKK,IAAI40B,KAEvB,IAAI0rD,GAAK1rD,GACL2rD,IAAM5rD,GACN6rD,IAAK,EACT,IAAK,IAAIprF,EAAI,EAAGA,EAAIC,OAAQD,IAAK,CAC7B,IAAIoT,EAAIk3B,GAAKtqC,EAAIu/B,GACblsB,EAAIk3B,GAAKvqC,EAAIw/B,GAUjB,GATKgrD,iBAAiBp3E,EAAGC,KACrB+3E,IAAK,GAEJd,eAAel3E,EAAI83E,GAAI73E,EAAI83E,MAC5BC,IAAK,GAEJd,eAAel3E,EAAI83E,GAAI73E,EAAI83E,MAC5BC,IAAK,IAEJA,GAAI,CACLnrF,OAASD,EACT5B,KAAK0sF,MAAQ13E,EAAImsB,GACjBnhC,KAAK2sF,MAAQ13E,EAAImsB,GACjB,OAOR,GAAc,GAAVv/B,OACA,OAAO,EAGX,GAAc,GAAVA,QAAeqqF,eAAelsF,KAAK0sF,MAAQvrD,GAAInhC,KAAK2sF,MAAQvrD,IAC5D,OAAO,EAcX,IAAI6rD,gBAAkBf,eAAelsF,KAAK0sF,MAAQvrD,GAAK2rD,GAAI9sF,KAAK2sF,MAAQvrD,GAAK2rD,IACzEG,iBAAmBhB,eAAelsF,KAAK0sF,MAAQvrD,GAAK2rD,GAAI9sF,KAAK2sF,MAAQvrD,GAAK2rD,IAE9E,OADA/sF,KAAK4sF,eAAiBV,eAAelsF,KAAK0sF,MAAQvrD,GAAInhC,KAAK2sF,MAAQvrD,KAC9D6rD,iBAAkBC,kBAAoBltF,KAAK4sF,eAQpDx6E,OAAOi6E,aACH,IAAIngD,GAAKlsC,KAAKwsF,QACVrgD,GAAKnsC,KAAKysF,QACVtrD,GAAKnhC,KAAK0sF,MAAQxgD,GAClB9K,GAAKphC,KAAK2sF,MAAQxgD,GAClBtqC,OAAS,EAAIsK,KAAKC,IAAID,KAAKK,IAAI20B,IAAKh1B,KAAKK,IAAI40B,KAC7CD,KACAA,IAAUh1B,KAAKK,IAAI20B,KAEnBC,KACAA,IAAUj1B,KAAKK,IAAI40B,KAEvB,IAAK,IAAIx/B,EAAI,EAAGA,EAAIC,OAAQD,IAAK,CAG7ByqF,YAFQngD,GAAKtqC,EAAIu/B,GACTgL,GAAKvqC,EAAIw/B,GACC,GAEtB,OAAO,EAEX+rD,oBAAoBC,sBAChB,IAAKptF,KAAK4sF,eACN,OAEJ,IAAI1gD,GAAKlsC,KAAKwsF,QACVrgD,GAAKnsC,KAAKysF,QACVtrD,GAAKnhC,KAAK0sF,MAAQxgD,GAClB9K,GAAKphC,KAAK2sF,MAAQxgD,GAClBhL,KACAA,IAAUh1B,KAAKK,IAAI20B,KAEnBC,KACAA,IAAUj1B,KAAKK,IAAI40B,KAEvB,IAAI0rD,GAAK1rD,GACL2rD,IAAM5rD,GACVisD,qBAAqBptF,KAAK0sF,MAAQvrD,GAAInhC,KAAK2sF,MAAQvrD,IACnDgsD,qBAAqBptF,KAAK0sF,MAAQI,GAAI9sF,KAAK2sF,MAAQI,IACnDK,qBAAqBptF,KAAK0sF,MAAQI,GAAI9sF,KAAK2sF,MAAQI,O,kYC7S5C,MAAMtF,iBAAiBx4D,6CAClCxW,YAAY8E,MAAOC,OAAQ+N,QAAU,IACjCrO,MAAMK,MAAOC,QACbxd,KAAKspE,SAAW,CACZ+jB,KAAM,CAAC,EAAG,EAAG,EAAG,GAChBC,QAAS,CAAC,EAAG,EAAG,EAAG,EAAG,GACtBrI,SAAU,GAEdjlF,KAAKwpE,WAAWj+C,SAChBvrB,KAAKutF,MAAQ7W,gDAAK12E,KAAKspE,SAAS2b,UAChCjlF,KAAKsoF,KAAOtoF,KAAKgoF,SAAS,GAM9B/T,UAAUuZ,aACN,IAAK,IAAI5rF,EAAI,EAAGA,EAAI5B,KAAK0hB,OAAQ9f,IAC7B,IAAK,IAAIK,EAAI,EAAGA,EAAIjC,KAAK2hB,QAAS1f,IAC9BjC,KAAKsoF,KAAK1mF,GAAGK,GAAMukE,0DAAmBgnB,YAAc,EAAI,EAGhE,OAAOxtF,KAMXwpE,WAAWj+C,SAAWra,OAAOq4D,OAAOvpE,KAAKspE,SAAU/9C,SACnD3K,IAAI5L,EAAGC,EAAGgN,OAASjiB,KAAKsoF,KAAKtzE,GAAGC,GAAKgN,MACrC7P,OAAOmyE,UACH,IAAIkJ,OAASztF,KAAKgoF,SAAS,GACvBqF,KAAOrtF,KAAKspE,SAAS+jB,KACrBC,QAAUttF,KAAKspE,SAASgkB,QAC5B,IAAK,IAAIrrF,EAAI,EAAGA,EAAIjC,KAAK2hB,QAAS1f,IAAK,CACnC,IAAIyrF,UAAY,EACZC,WAAa,EACa,GAA1B3tF,KAAKspE,SAAS2b,WACdyI,UAAY,EACZC,WAAa1rF,EAAI,GAErB,IAAK,IAAIL,EAAI+rF,WAAY/rF,EAAI5B,KAAK0hB,OAAQ9f,GAAK8rF,UAAW,CACtD,IAAIjjD,IAAMzqC,KAAKsoF,KAAK1mF,GAAGK,GACnB2rF,OAAS5tF,KAAK6tF,cAAcjsF,EAAGK,GAC/BwoC,MAAmC,GAA5B6iD,QAAQ7+E,QAAQm/E,QACvBH,OAAO7rF,GAAGK,GAAK,EAETwoC,MAAgC,GAAzB4iD,KAAK5+E,QAAQm/E,UAC1BH,OAAO7rF,GAAGK,GAAK,IAI3BjC,KAAKsoF,KAAOmF,OACZlJ,UAAYvkF,KAAK8tF,iBAAiBvJ,UAEtCuJ,iBAAiBvJ,UACb,IAAK,IAAItiF,EAAI,EAAGA,EAAIjC,KAAK2hB,QAAS1f,IAAK,CACnC,IAAIyrF,UAAY,EACZC,WAAa,EACa,GAA1B3tF,KAAKspE,SAAS2b,WACdyI,UAAY,EACZC,WAAa1rF,EAAI,GAErB,IAAK,IAAIL,EAAI+rF,WAAY/rF,EAAI5B,KAAK0hB,OAAQ9f,GAAK8rF,UAC3CnJ,SAAS3iF,EAAGK,EAAGjC,KAAKsoF,KAAK1mF,GAAGK,KAOxC4rF,cAAcjjB,GAAIC,IACd,IAAI3rC,OAAS,EACb,IAAK,IAAIt9B,EAAI,EAAGA,EAAI5B,KAAKutF,MAAM1rF,OAAQD,IAAK,CACxC,IAAIqwC,IAAMjyC,KAAKutF,MAAM3rF,GACjBoT,EAAI41D,GAAK34B,IAAI,GACbh9B,EAAI41D,GAAK54B,IAAI,GACbj9B,EAAI,GAAKA,GAAKhV,KAAK0hB,QAAUzM,EAAI,GAAKA,GAAKjV,KAAK2hB,UAGpDud,QAA8B,GAAnBl/B,KAAKsoF,KAAKtzE,GAAGC,GAAU,EAAI,GAE1C,OAAOiqB,OAQXv5B,QAAQ4+E,SAAUtiE,MAAO8rE,oBAChB9rE,QACDA,MAAQ,GACZ,IAAI+rE,aAAe,GACfC,aAAe,GAEfP,UAAY,EACZQ,YAAc,CAAC,EAAG,GACQ,GAA1BluF,KAAKspE,SAAS2b,WACdyI,UAAY,EACZQ,YAAc,CAAC,EAAG,IAEtB,IAAK,IAAIj5E,EAAI,EAAGA,EAAIjV,KAAK2hB,QAAS1M,IAC9B,IAAK,IAAID,EAAIk5E,YAAYj5E,EAAI,GAAID,EAAIhV,KAAK0hB,OAAQ1M,GAAK04E,UACnD,GAAI1tF,KAAKmuF,WAAWn5E,EAAGC,EAAGgN,OAAQ,CAC9B,IAAI+tD,EAAI,CAACh7D,EAAGC,GACZg5E,aAAajuF,KAAKouF,UAAUpe,IAAMA,EAClCge,aAAarnF,KAAK,CAACqO,EAAGC,IAIlC,IAAInW,MAAQkvF,aAAaxnB,2DAAkB,EAAGwnB,aAAansF,OAAS,IAChE2R,IAAMxT,KAAKouF,UAAUtvF,OACrB0qF,UAAY,GAKhB,IAJAA,UAAUh2E,KAAO1U,aACVmvF,aAAaz6E,KAEpBxT,KAAKquF,eAAe7E,UAAWyE,aAAc,CAACnvF,QAAQ,EAAOmjB,OACtD/Q,OAAOD,KAAKg9E,cAAcpsF,OAAS,GAAG,CAEzC,IAAImuE,EAAIhwE,KAAKsuF,WAAW9E,UAAWyE,cAC/BvuF,KAAOswE,EAAE,GACTphE,GAAKohE,EAAE,GAEPue,MAAQ,GACZA,MAAMvuF,KAAKouF,UAAU1uF,OAASA,KAC9BM,KAAKquF,eAAeE,MAAON,aAAc,CAACvuF,OAAO,EAAMuiB,QAEb,GAA1BjiB,KAAKspE,SAAS2b,SAAgBjlF,KAAKwuF,oBAAsBxuF,KAAKyuF,oBACrEp9E,KAAKrR,KAAM4O,GAAIlP,KAAM8pF,UAAWyE,aAAchsE,MAAO8rE,oBAE9D,IAAK,IAAIW,KAAKH,MAAO,CACjB,IAAII,GAAKJ,MAAMG,GACf1uF,KAAKsoF,KAAKqG,GAAG,IAAIA,GAAG,IAAM1sE,MAC1BunE,UAAUkF,GAAKC,UACRV,aAAaS,IAG5BnK,UAAYvkF,KAAK8tF,iBAAiBvJ,UAMtC+J,WAAW9E,UAAWyE,cAClB,IAAgCn5D,EAA5Bp1B,KAAO,CAAC,EAAG,GAAIkP,GAAK,CAAC,EAAG,GACxBggF,cAAgB19E,OAAOD,KAAKu4E,WAC5BqF,iBAAmB39E,OAAOD,KAAKg9E,cACnC,IAAK,IAAIrsF,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,GAAIgtF,cAAc/sF,OAASgtF,iBAAiBhtF,OAAQ,CAChD,IAAIoP,KAAO29E,cACXhgF,GAAK46E,UAAUv4E,KAAKu1D,2DAAkB,EAAGv1D,KAAKpP,OAAS,KACvDnC,KAAOM,KAAK8uF,YAAYlgF,GAAIq/E,kBAE3B,CACD,IAAIh9E,KAAO49E,iBACXnvF,KAAOuuF,aAAah9E,KAAKu1D,2DAAkB,EAAGv1D,KAAKpP,OAAS,KAC5D+M,GAAK5O,KAAK8uF,YAAYpvF,KAAM8pF,WAGhC,GADA10D,GAAKp1B,KAAK,GAAKkP,GAAG,KAAOlP,KAAK,GAAKkP,GAAG,KAAOlP,KAAK,GAAKkP,GAAG,KAAOlP,KAAK,GAAKkP,GAAG,IAC1EkmB,EAAI,GACJ,MAIR,MAAO,CAACp1B,KAAMkP,IAElBkgF,YAAYC,MAAO/pE,OACf,IAAIgqE,SAAW,KACXC,QAAU,KACd,IAAK,IAAIP,KAAK1pE,MAAO,CACjB,IAAIgrD,EAAIhrD,MAAM0pE,GACV55D,GAAKk7C,EAAE,GAAK+e,MAAM,KAAO/e,EAAE,GAAK+e,MAAM,KAAO/e,EAAE,GAAK+e,MAAM,KAAO/e,EAAE,GAAK+e,MAAM,KACnE,MAAXE,SAAmBn6D,EAAIm6D,WACvBA,QAAUn6D,EACVk6D,SAAWhf,GAGnB,OAAOgf,SAEXX,eAAe7E,UAAWyE,aAAciB,MAAOC,iBAAkBltE,OAC7D,KAAOitE,MAAMrtF,OAAS,GAAG,CACrB,IACIutF,MADApf,EAAIkf,MAAMx+E,OAAO,EAAG,GAAG,GAGvB0+E,MAD0B,GAA1BpvF,KAAKspE,SAAS2b,SACN,CACJ,CAACjV,EAAE,GAAK,EAAGA,EAAE,IACb,CAACA,EAAE,GAAK,EAAGA,EAAE,GAAK,GAClB,CAACA,EAAE,GAAK,EAAGA,EAAE,GAAK,GAClB,CAACA,EAAE,GAAK,EAAGA,EAAE,IACb,CAACA,EAAE,GAAK,EAAGA,EAAE,GAAK,GAClB,CAACA,EAAE,GAAK,EAAGA,EAAE,GAAK,IAId,CACJ,CAACA,EAAE,GAAK,EAAGA,EAAE,IACb,CAACA,EAAE,GAAK,EAAGA,EAAE,IACb,CAACA,EAAE,GAAIA,EAAE,GAAK,GACd,CAACA,EAAE,GAAIA,EAAE,GAAK,IAGtB,IAAK,IAAIpuE,EAAI,EAAGA,EAAIwtF,MAAMvtF,OAAQD,IAAK,CACnC,IAAI4R,IAAMxT,KAAKouF,UAAUgB,MAAMxtF,IACT,MAAlB4nF,UAAUh2E,MAAgBxT,KAAKmuF,WAAWiB,MAAMxtF,GAAG,GAAIwtF,MAAMxtF,GAAG,GAAIqgB,SACpEunE,UAAUh2E,KAAO47E,MAAMxtF,GAClButF,yBACMlB,aAAaz6E,KAExB07E,MAAMvoF,KAAKyoF,MAAMxtF,OAKjC6sF,mBAAmB7/E,GAAIlP,KAAM8pF,UAAWyE,aAAchsE,MAAO8rE,oBACzD,IAAI1pE,EAAGD,EACH1kB,KAAK,GAAKkP,GAAG,IACbyV,EAAI3kB,KACJ0kB,EAAIxV,KAGJyV,EAAIzV,GACJwV,EAAI1kB,MAER,IAAK,IAAIonF,GAAKziE,EAAE,GAAIyiE,IAAM1iE,EAAE,GAAI0iE,KAAM,CAClC9mF,KAAKsoF,KAAKxB,IAAIziE,EAAE,IAAMpC,MACtB,IAAI+tD,EAAI,CAAC8W,GAAIziE,EAAE,IACXgrE,KAAOrvF,KAAKouF,UAAUpe,GAC1BwZ,UAAU6F,MAAQrf,SACXie,aAAaoB,MAEpBtB,oBAAsB1pE,EAAE,GAAKD,EAAE,IAC/B2pE,mBAAmB1pE,EAAG,CAACD,EAAE,GAAIC,EAAE,KAGnC,IAAIrP,EAAIoP,EAAE,GACN1kB,KAAK,GAAKkP,GAAG,IACbyV,EAAI3kB,KACJ0kB,EAAIxV,KAGJyV,EAAIzV,GACJwV,EAAI1kB,MAER,IAAK,IAAIunF,GAAK5iE,EAAE,GAAI4iE,GAAK7iE,EAAE,GAAI6iE,KAAM,CACjCjnF,KAAKsoF,KAAKtzE,GAAGiyE,IAAMhlE,MACnB,IAAI+tD,EAAI,CAACh7D,EAAGiyE,IACRoI,KAAOrvF,KAAKouF,UAAUpe,GAC1BwZ,UAAU6F,MAAQrf,SACXie,aAAaoB,MAEpBtB,oBAAsB1pE,EAAE,GAAKD,EAAE,IAC/B2pE,mBAAmB,CAAC3pE,EAAE,GAAIC,EAAE,IAAK,CAACD,EAAE,GAAIA,EAAE,KAGlDoqE,oBAAoB5/E,GAAIlP,KAAM8pF,UAAWyE,aAAchsE,MAAO8rE,oBAC1D,IAAI1pE,EAAGD,EACH1kB,KAAK,GAAKkP,GAAG,IACbyV,EAAI3kB,KACJ0kB,EAAIxV,KAGJyV,EAAIzV,GACJwV,EAAI1kB,MAGR,IAAIonF,GAAKziE,EAAE,GACP4iE,GAAK5iE,EAAE,GACX,KAASyiE,IAAM1iE,EAAE,IAAM6iE,IAAM7iE,EAAE,IAAK,CAChC,IAAIkrE,UAAY,EACZrI,GAAK7iE,EAAE,IACP6iE,KACAqI,UAAY,GAEPrI,GAAK7iE,EAAE,KACZ6iE,KACAqI,UAAY,GAEZxI,GAAK1iE,EAAE,GACP0iE,IAAMwI,UAEDxI,GAAK1iE,EAAE,IAGPA,EAAE,GAAK,EAFZ0iE,IAAMwI,UAQNxI,IAAMwI,UAEVtvF,KAAKsoF,KAAKxB,IAAIG,IAAMhlE,MACpB,IAAI+tD,EAAI,CAAC8W,GAAIG,IACToI,KAAOrvF,KAAKouF,UAAUpe,GAC1BwZ,UAAU6F,MAAQrf,SACXie,aAAaoB,MAEpBtB,oBACAA,mBAAmBruF,KAAMkP,IAGjCu/E,WAAWn5E,EAAGC,EAAGgN,OACb,OAAOjN,GAAK,GAAKA,EAAIhV,KAAK0hB,QAAUzM,GAAK,GAAKA,EAAIjV,KAAK2hB,SAAW3hB,KAAKsoF,KAAKtzE,GAAGC,IAAMgN,MAEzFmsE,UAAUpe,GAAK,OAAOA,EAAE,GAAK,IAAMA,EAAE,M,ucC3TzC,MAAMuf,SAAW,CACb,KAAQlG,+CACR,SAAYgC,oDAOD,MAAM3D,eAAeO,iDAChCxvE,YAAY8E,MAAOC,OAAQ+N,QAAU,IACjCrO,MAAMK,MAAOC,QACbxd,KAAKspE,SAAWp4D,OAAOq4D,OAAO,CAC1B2e,UAAW,CAAC,EAAG,GACfC,WAAY,CAAC,EAAG,GAChB0E,eAAgB,CAAC,EAAG,IACpB2C,cAAe,GACfnH,UAAW,KACZ98D,SACHvrB,KAAKyvF,UAAY,CACb,KAAQ,EACR,SAAY,GAEhBzvF,KAAKsoF,KAAO,GACZtoF,KAAK0vF,iBAAmB,GACxB1vF,KAAK2vF,OAAS,GACd3vF,KAAKuoF,KAAO,EACZvoF,KAAK4oF,aAAe5oF,KAAK4oF,aAAaz7E,KAAKnN,MAC3CA,KAAK6oF,kBAAoB7oF,KAAK6oF,kBAAkB17E,KAAKnN,MACrDA,KAAK8oF,gBAAkB9oF,KAAK8oF,gBAAgB37E,KAAKnN,MACjDA,KAAK4vF,sBAAwB5vF,KAAK4vF,sBAAsBziF,KAAKnN,MAEjEoS,OAAOmyE,UACHvkF,KAAKgpF,OAAS,GACdhpF,KAAKspF,WAAa,GAClBtpF,KAAKsoF,KAAOtoF,KAAKgoF,SAAS,GAC1BhoF,KAAK2vF,OAAS,GACd3vF,KAAKuoF,KAAO,EACZ,IAAIlkB,MAAQrkE,KAAK0hB,OAAS,IAAM1hB,KAAK2hB,QAAU,GAC/C3hB,KAAK6vF,aACL,IACIC,cADA/G,GAAKx5E,KAAKC,MAEd,EAAG,CAGC,GAFAsgF,cAAgB,EACPvgF,KAAKC,MACLu5E,GAAK/oF,KAAKspE,SAAS+e,UACxB,MAGJ,IAAI0H,KAAO/vF,KAAKgwF,YAChB,IAAKD,KACD,MAEJ,IAAI9qE,MAAQ8qE,KAAKnsF,MAAM,KACnBoR,EAAIrR,SAASshB,MAAM,IACnBhQ,EAAItR,SAASshB,MAAM,IACnBgtB,IAAMjyC,KAAKiwF,qBAAqBj7E,EAAGC,GACvC,IAAKg9B,IACD,SAIJ,IAAIi+C,gBAAkB,EACtB,GAEI,GADAA,kBACIlwF,KAAKmwF,YAAYn7E,EAAGC,EAAGg9B,IAAI,GAAIA,IAAI,IAAK,CAExCjyC,KAAKowF,wBAAwBp7E,EAAGC,GAChCjV,KAAKowF,wBAAwBp7E,EAAIi9B,IAAI,GAAIh9B,EAAIg9B,IAAI,IACjD,aAECi+C,gBAAkBlwF,KAAK0vF,kBAChC,IAAK,IAAI/jF,MAAM3L,KAAK2vF,OACZ3vF,KAAK2vF,OAAOhkF,IAAM,GAClBmkF,sBAGH9vF,KAAKuoF,KAAOlkB,KAAOrkE,KAAKspE,SAASkmB,eAAiBM,eAE3D,GADA9vF,KAAKqwF,YACD9L,SACA,IAAK,IAAI3iF,EAAI,EAAGA,EAAI5B,KAAK0hB,OAAQ9f,IAC7B,IAAK,IAAIK,EAAI,EAAGA,EAAIjC,KAAK2hB,QAAS1f,IAC9BsiF,SAAS3iF,EAAGK,EAAGjC,KAAKsoF,KAAK1mF,GAAGK,IAMxC,OAFAjC,KAAK2vF,OAAS,GACd3vF,KAAKsoF,KAAO,GACLtoF,KAEX4oF,aAAa5zE,EAAGC,EAAGgN,OACF,GAATA,OAAuB,GAATA,OACdjiB,KAAKsoF,KAAKtzE,GAAGC,GAAK,EAClBjV,KAAKuoF,QAGLvoF,KAAK2vF,OAAO36E,EAAI,IAAMC,GAAK,EAGnC6zE,gBAAgB9zE,EAAGC,GACf,QAAID,EAAI,GAAKC,EAAI,GAAKD,GAAKhV,KAAK0hB,QAAUzM,GAAKjV,KAAK2hB,UAGzB,GAAnB3hB,KAAKsoF,KAAKtzE,GAAGC,GAEzB4zE,kBAAkB7zE,EAAGC,GACjB,QAAID,EAAI,GAAKC,EAAI,GAAKD,EAAI,GAAKhV,KAAK0hB,QAAUzM,EAAI,GAAKjV,KAAK2hB,UAGjC,GAAnB3hB,KAAKsoF,KAAKtzE,GAAGC,GAEzB26E,sBAAsB56E,EAAGC,GAAKjV,KAAK2vF,OAAO36E,EAAI,IAAMC,GAAK,EAEzD46E,aACI,IAAIjlB,GAAKz+D,KAAK41B,MAAM/hC,KAAK0hB,OAAS,GAC9BmpD,GAAK1+D,KAAK41B,MAAM/hC,KAAK2hB,QAAU,GAC/BwnE,KAAOE,kEAAwBze,GAAIC,GAAI7qE,KAAKspE,UAChDtpE,KAAKgpF,OAAOriF,KAAKwiF,MACjBA,KAAK/2E,OAAOpS,KAAK4oF,cAKrBoH,YACI,IAAIM,MAAQ,GACRC,MAAQ,GACZ,IAAK,IAAI5kF,MAAM3L,KAAK2vF,OAAQ,CAEZ,GADD3vF,KAAK2vF,OAAOhkF,IAEnB4kF,MAAM5pF,KAAKgF,IAGX2kF,MAAM3pF,KAAKgF,IAGnB,IAAIm2B,IAAOyuD,MAAM1uF,OAAS0uF,MAAQD,MAClC,IAAKxuD,IAAIjgC,OACL,OAAO,KAEX,IAAI8J,GAAK66D,qDAAY1kC,IAAIxY,QAEzB,cADOtpB,KAAK2vF,OAAOhkF,IACZA,GAMXwkF,YAAYn7E,EAAGC,EAAGksB,GAAIC,IAClB,IAAIovD,YAAchqB,8DAAqBxmE,KAAKyvF,WAExCgB,QADOlB,SAASiB,aACDE,eAAe17E,EAAGC,EAAGksB,GAAIC,GAAIphC,KAAKspE,UACrD,QAAKmnB,QAAQjkD,QAAQxsC,KAAK8oF,gBAAiB9oF,KAAK6oF,qBAKhD4H,QAAQr+E,OAAOpS,KAAK4oF,cAEhB6H,mBAAmBpH,gDACnBrpF,KAAKgpF,OAAOriF,KAAK8pF,SAEjBA,mBAAmBpF,qDACnBoF,QAAQtD,oBAAoBntF,KAAK4vF,uBACjC5vF,KAAKspF,WAAW3iF,KAAK8pF,WAElB,GAEXL,wBAAwBxlB,GAAIC,IACxB,IAAI8lB,OAASja,mDACb,IAAK,IAAI90E,EAAI,EAAGA,EAAI+uF,OAAO9uF,OAAQD,IAAK,CACpC,IAAI89B,MAAQixD,OAAO/uF,GACfoT,EAAI41D,GAAKlrC,MAAM,GACfzqB,EAAI41D,GAAKnrC,MAAM,UACZ1/B,KAAK2vF,OAAO36E,EAAI,IAAMC,GAC7BD,EAAI41D,GAAK,EAAIlrC,MAAM,GACnBzqB,EAAI41D,GAAK,EAAInrC,MAAM,UACZ1/B,KAAK2vF,OAAO36E,EAAI,IAAMC,IAMrCg7E,qBAAqBrlB,GAAIC,IACrB,GAAID,IAAM,GAAKC,IAAM,GAAKD,IAAM5qE,KAAK0hB,OAAS,GAAKmpD,IAAM7qE,KAAK2hB,QAAU,EACpE,OAAO,KAEX,IAAIud,OAAS,KACTyxD,OAASja,mDACb,IAAK,IAAI90E,EAAI,EAAGA,EAAI+uF,OAAO9uF,OAAQD,IAAK,CACpC,IAAI89B,MAAQixD,OAAO/uF,GACfoT,EAAI41D,GAAKlrC,MAAM,GACfzqB,EAAI41D,GAAKnrC,MAAM,GACnB,IAAK1/B,KAAKsoF,KAAKtzE,GAAGC,GAAI,CAClB,GAAIiqB,OACA,OAAO,KAEXA,OAASQ,OAIjB,OAAKR,OAGE,EAAEA,OAAO,IAAKA,OAAO,IAFjB,KAOfmxD,YACI,IAAIv9E,KAAO9S,KAAKsoF,KAChB,SAAS4D,eAAel3E,EAAGC,GACvB,OAAsB,GAAdnC,KAAKkC,GAAGC,GAGpB,IAAK,IAAIrT,EAAI,EAAGA,EAAI5B,KAAKgpF,OAAOnnF,OAAQD,IAAK,CACzC,IAAIunF,KAAOnpF,KAAKgpF,OAAOpnF,GACvBunF,KAAKI,aACLJ,KAAK8C,SAASC,oB,+TCxN1B,SAAS0E,UAAUhvF,EAAG0kB,EAAGb,GACrBA,EAAEa,EAAE1kB,EAAI,IAAM6jB,EAAE7jB,GAChB0kB,EAAEb,EAAE7jB,IAAM0kB,EAAE1kB,EAAI,GAChB6jB,EAAE7jB,GAAKA,EAAI,EACX0kB,EAAE1kB,EAAI,GAAKA,EAKf,SAASivF,eAAejvF,EAAG0kB,EAAGb,GAC1BA,EAAEa,EAAE1kB,IAAM6jB,EAAE7jB,GACZ0kB,EAAEb,EAAE7jB,IAAM0kB,EAAE1kB,GACZ6jB,EAAE7jB,GAAKA,EACP0kB,EAAE1kB,GAAKA,EAMI,MAAM+lF,kBAAkB14D,6CACnC7c,OAAOmyE,UACH,IAUItiF,EAVAnC,IAAME,KAAKgoF,SAAS,GACpBD,EAAI57E,KAAKwG,MAAM3S,KAAK0hB,OAAS,GAAK,GAElC4E,EAAI,GACJb,EAAI,GACR,IAAK,IAAI7jB,EAAI,EAAGA,EAAImmF,EAAGnmF,IACnB0kB,EAAE3f,KAAK/E,GACP6jB,EAAE9e,KAAK/E,GAIX,IAFA0kB,EAAE3f,KAAKohF,EAAI,GAEN9lF,EAAI,EAAGA,EAAI,EAAIjC,KAAK2hB,QAAS1f,GAAK,EAEnC,IAAK,IAAIL,EAAI,EAAGA,EAAImmF,EAAGnmF,IAAK,CAExB,IAAIoT,EAAI,EAAIpT,EAAI,EACZqT,EAAIhT,EACRnC,IAAIkV,GAAGC,GAAK,EAERrT,GAAK0kB,EAAE1kB,EAAI,IAAM4kE,0DAjBlB,OAkBCoqB,UAAUhvF,EAAG0kB,EAAGb,GAChB3lB,IAAIkV,EAAI,GAAGC,GAAK,GAGhBrT,GAAK0kB,EAAE1kB,IAAM4kE,0DAtBd,KAwBCqqB,eAAejvF,EAAG0kB,EAAGb,GAIrB3lB,IAAIkV,GAAGC,EAAI,GAAK,EAK5B,IAAK,IAAIrT,EAAI,EAAGA,EAAImmF,EAAGnmF,IAAK,CAExB,IAAIoT,EAAI,EAAIpT,EAAI,EACZqT,EAAIhT,EACRnC,IAAIkV,GAAGC,GAAK,EAERrT,GAAK0kB,EAAE1kB,EAAI,KAAOA,GAAK0kB,EAAE1kB,IAAM4kE,0DAvC5B,QAyCHoqB,UAAUhvF,EAAG0kB,EAAGb,GAChB3lB,IAAIkV,EAAI,GAAGC,GAAK,GAEpB47E,eAAejvF,EAAG0kB,EAAGb,GAEzB,IAAK,IAAI7jB,EAAI,EAAGA,EAAI5B,KAAK0hB,OAAQ9f,IAC7B,IAAK,IAAIK,EAAI,EAAGA,EAAIjC,KAAK2hB,QAAS1f,IAC9BsiF,SAAS3iF,EAAGK,EAAGnC,IAAI8B,GAAGK,IAG9B,OAAOjC,Q,iUCzEA,MAAM4nF,oBAAoB34D,6CACrCxW,cACIyE,SAAS9O,WACTpO,KAAK8wF,OAAS,GACd9wF,KAAKsoF,KAAO,GAEhBl2E,OAAOmyE,UACH,IAAIwD,EAAI/nF,KAAK0hB,OACToE,EAAI9lB,KAAK2hB,QACb3hB,KAAKsoF,KAAO,GACZ,IAAK,IAAI1mF,EAAI,EAAGA,EAAImmF,EAAGnmF,IAAK,CACxB5B,KAAKsoF,KAAK3hF,KAAK,IACf,IAAK,IAAI1E,EAAI,EAAGA,EAAI6jB,EAAG7jB,IAAK,CACxB,IAAI4mE,OAAe,GAALjnE,GAAe,GAALK,GAAUL,EAAI,GAAKmmF,GAAK9lF,EAAI,GAAK6jB,EACzD9lB,KAAKsoF,KAAK1mF,GAAG+E,KAAKkiE,OAAS,EAAI,IAGvC7oE,KAAK8wF,OAAS,CACV,CAAC,EAAG,EAAG/I,EAAI,EAAGjiE,EAAI,IAEtB9lB,KAAK+wF,WACL,IAAK,IAAInvF,EAAI,EAAGA,EAAImmF,EAAGnmF,IACnB,IAAK,IAAIK,EAAI,EAAGA,EAAI6jB,EAAG7jB,IACnBsiF,SAAS3iF,EAAGK,EAAGjC,KAAKsoF,KAAK1mF,GAAGK,IAIpC,OADAjC,KAAKsoF,KAAO,GACLtoF,KAEX+wF,WACI,KAAO/wF,KAAK8wF,OAAOjvF,QAAQ,CACvB,IAAIsnF,KAAOnpF,KAAK8wF,OAAOv/E,QACvBvR,KAAKgxF,eAAe7H,OAG5B6H,eAAe7H,MACX,IAAI8H,OAAS,GACTC,OAAS,GACb,IAAK,IAAItvF,EAAIunF,KAAK,GAAK,EAAGvnF,EAAIunF,KAAK,GAAIvnF,IAAK,CACxC,IAAIu8D,IAAMn+D,KAAKsoF,KAAK1mF,GAAGunF,KAAK,GAAK,GAC7BjoB,OAASlhE,KAAKsoF,KAAK1mF,GAAGunF,KAAK,GAAK,IAChChrB,MAAO+C,QAAYt/D,EAAI,GACvBqvF,OAAOtqF,KAAK/E,GAGpB,IAAK,IAAIK,EAAIknF,KAAK,GAAK,EAAGlnF,EAAIknF,KAAK,GAAIlnF,IAAK,CACxC,IAAI6c,KAAO9e,KAAKsoF,KAAKa,KAAK,GAAK,GAAGlnF,GAC9B8c,MAAQ/e,KAAKsoF,KAAKa,KAAK,GAAK,GAAGlnF,IAC/B6c,OAAQC,OAAW9c,EAAI,GACvBivF,OAAOvqF,KAAK1E,GAGpB,IAAKgvF,OAAOpvF,SAAWqvF,OAAOrvF,OAC1B,OAEJ,IAAImT,EAAIwxD,qDAAYyqB,QAChBh8E,EAAIuxD,qDAAY0qB,QACpBlxF,KAAKsoF,KAAKtzE,GAAGC,GAAK,EAClB,IAAIk8E,MAAQ,GACRpJ,EAAI,GACRoJ,MAAMxqF,KAAKohF,GACX,IAAK,IAAInmF,EAAIunF,KAAK,GAAIvnF,EAAIoT,EAAGpT,IACzB5B,KAAKsoF,KAAK1mF,GAAGqT,GAAK,EACdrT,EAAI,GACJmmF,EAAEphF,KAAK,CAAC/E,EAAGqT,IAEnB8yE,EAAI,GACJoJ,MAAMxqF,KAAKohF,GACX,IAAK,IAAInmF,EAAIoT,EAAI,EAAGpT,GAAKunF,KAAK,GAAIvnF,IAC9B5B,KAAKsoF,KAAK1mF,GAAGqT,GAAK,EACdrT,EAAI,GACJmmF,EAAEphF,KAAK,CAAC/E,EAAGqT,IAEnB8yE,EAAI,GACJoJ,MAAMxqF,KAAKohF,GACX,IAAK,IAAI9lF,EAAIknF,KAAK,GAAIlnF,EAAIgT,EAAGhT,IACzBjC,KAAKsoF,KAAKtzE,GAAG/S,GAAK,EACdA,EAAI,GACJ8lF,EAAEphF,KAAK,CAACqO,EAAG/S,IAEnB8lF,EAAI,GACJoJ,MAAMxqF,KAAKohF,GACX,IAAK,IAAI9lF,EAAIgT,EAAI,EAAGhT,GAAKknF,KAAK,GAAIlnF,IAC9BjC,KAAKsoF,KAAKtzE,GAAG/S,GAAK,EACdA,EAAI,GACJ8lF,EAAEphF,KAAK,CAACqO,EAAG/S,IAEnB,IAAImvF,MAAQ5qB,qDAAY2qB,OACxB,IAAK,IAAIvvF,EAAI,EAAGA,EAAIuvF,MAAMtvF,OAAQD,IAAK,CACnC,IAAImmF,EAAIoJ,MAAMvvF,GACd,GAAImmF,GAAKqJ,MACL,SAEJ,IAAIC,KAAO7qB,qDAAYuhB,GACvB/nF,KAAKsoF,KAAK+I,KAAK,IAAIA,KAAK,IAAM,EAElCrxF,KAAK8wF,OAAOnqF,KAAK,CAACwiF,KAAK,GAAIA,KAAK,GAAIn0E,EAAI,EAAGC,EAAI,IAC/CjV,KAAK8wF,OAAOnqF,KAAK,CAACqO,EAAI,EAAGm0E,KAAK,GAAIA,KAAK,GAAIl0E,EAAI,IAC/CjV,KAAK8wF,OAAOnqF,KAAK,CAACwiF,KAAK,GAAIl0E,EAAI,EAAGD,EAAI,EAAGm0E,KAAK,KAC9CnpF,KAAK8wF,OAAOnqF,KAAK,CAACqO,EAAI,EAAGC,EAAI,EAAGk0E,KAAK,GAAIA,KAAK,Q,8TCnGvC,MAAMtB,iBAAiB54D,6CAClCxW,YAAY8E,MAAOC,OAAQ8zE,WAAa,GACpCp0E,MAAMK,MAAOC,QACbxd,KAAKuxF,YAAcD,WACnBtxF,KAAKsoF,KAAO,GAEhBl2E,OAAOmyE,UACH,IAAIhnE,MAAQvd,KAAK0hB,OACblE,OAASxd,KAAK2hB,QACd7hB,IAAME,KAAKgoF,SAAS,GACxBzqE,OAAUA,MAAQ,EAAI,EAAI,EAC1BC,QAAWA,OAAS,EAAI,EAAI,EAC5B,IAAIotD,GAAK,EACLC,GAAK,EACLiiB,GAAK,EACLC,GAAK,EACLyE,KAAO,EACPtjD,SAAU,EACVg3C,KAAO,CACP,CAAC,EAAG,GACJ,CAAC,EAAG,GACJ,CAAC,EAAG,GACJ,CAAC,EAAG,IAER,GAMI,GALAta,GAAK,EAAI,EAAIz+D,KAAK41B,MAAMykC,2DAAoBjpD,MAAQ,GAAK,GACzDstD,GAAK,EAAI,EAAI1+D,KAAK41B,MAAMykC,2DAAoBhpD,OAAS,GAAK,GACrDg0E,OACD1xF,IAAI8qE,IAAIC,IAAM,IAEb/qE,IAAI8qE,IAAIC,IAAK,CACd7qE,KAAKyxF,WAAWvM,MAChB,EAAG,CAC8D,GAAzD/4E,KAAK41B,MAAMykC,2DAAoBxmE,KAAKuxF,YAAc,KAClDvxF,KAAKyxF,WAAWvM,MAEpBh3C,SAAU,EACV,IAAK,IAAItsC,EAAI,EAAGA,EAAI,EAAGA,IAGnB,GAFAkrF,GAAKliB,GAAkB,EAAbsa,KAAKtjF,GAAG,GAClBmrF,GAAKliB,GAAkB,EAAbqa,KAAKtjF,GAAG,GACd5B,KAAK0xF,QAAQ5xF,IAAKgtF,GAAIC,GAAIxvE,MAAOC,QAAS,CAC1C1d,IAAIgtF,IAAIC,IAAM,EACdjtF,IAAI8qE,GAAKsa,KAAKtjF,GAAG,IAAIipE,GAAKqa,KAAKtjF,GAAG,IAAM,EACxCgpE,GAAKkiB,GACLjiB,GAAKkiB,GACL7+C,SAAU,EACVsjD,OACA,cAGFtjD,gBAETsjD,KAAO,EAAIj0E,MAAQC,OAAS,GACrC,IAAK,IAAI5b,EAAI,EAAGA,EAAI5B,KAAK0hB,OAAQ9f,IAC7B,IAAK,IAAIK,EAAI,EAAGA,EAAIjC,KAAK2hB,QAAS1f,IAC9BsiF,SAAS3iF,EAAGK,EAAGnC,IAAI8B,GAAGK,IAI9B,OADAjC,KAAKsoF,KAAO,GACLtoF,KAEXyxF,WAAWvM,MACP,IAAK,IAAItjF,EAAI,EAAGA,EAAI,EAAGA,IACnBsjF,KAAKtjF,GAAG,GAAK,EACbsjF,KAAKtjF,GAAG,GAAK,EAEjB,OAAQuK,KAAK41B,MAAyB,EAAnBykC,4DACf,KAAK,EACD0e,KAAK,GAAG,IAAM,EACdA,KAAK,GAAG,GAAK,EACbA,KAAK,GAAG,IAAM,EACdA,KAAK,GAAG,GAAK,EACb,MACJ,KAAK,EACDA,KAAK,GAAG,IAAM,EACdA,KAAK,GAAG,GAAK,EACbA,KAAK,GAAG,IAAM,EACdA,KAAK,GAAG,GAAK,EACb,MACJ,KAAK,EACDA,KAAK,GAAG,IAAM,EACdA,KAAK,GAAG,GAAK,EACbA,KAAK,GAAG,IAAM,EACdA,KAAK,GAAG,GAAK,EACb,MACJ,KAAK,EACDA,KAAK,GAAG,IAAM,EACdA,KAAK,GAAG,GAAK,EACbA,KAAK,GAAG,IAAM,EACdA,KAAK,GAAG,GAAK,GAIzBwM,QAAQ5xF,IAAKkV,EAAGC,EAAGsI,MAAOC,QACtB,QAAIxI,EAAI,GAAKC,EAAI,GAAKD,GAAKuI,OAAStI,GAAKuI,SAGlC1d,IAAIkV,GAAGC,M,+XChGP,MAAM6yE,cAAc74D,6CAC/BxW,YAAY8E,MAAOC,OAAQ+N,SACvBrO,MAAMK,MAAOC,QACbxd,KAAKF,IAAM,GACXE,KAAK6pF,MAAQ,GACb7pF,KAAK2xF,eAAiB,IACtBpmE,QAAUra,OAAOq4D,OAAO,CACpBqoB,UAAW,EACXC,WAAY,GACbtmE,UAKUxH,eAAe,eACxBwH,QAAO,UAAgBvrB,KAAK8xF,mBAAmB9xF,KAAK0hB,OAAQ6J,QAAO,YAElEA,QAAQxH,eAAe,gBACxBwH,QAAO,WAAiBvrB,KAAK8xF,mBAAmB9xF,KAAK2hB,QAAS4J,QAAO,aAEzEvrB,KAAKspE,SAAW/9C,QAEpBnZ,OAAOmyE,UAUH,GATAvkF,KAAKF,IAAME,KAAKgoF,SAAS,GACzBhoF,KAAK6pF,MAAQ,GACb7pF,KAAK2xF,eAAiB,GACtB3xF,KAAK+xF,aACL/xF,KAAK4pF,gBACL5pF,KAAKgyF,2BACLhyF,KAAKiyF,+BACLjyF,KAAKkyF,eACLlyF,KAAKmyF,mBACD5N,SACA,IAAK,IAAI3iF,EAAI,EAAGA,EAAI5B,KAAK0hB,OAAQ9f,IAC7B,IAAK,IAAIK,EAAI,EAAGA,EAAIjC,KAAK2hB,QAAS1f,IAC9BsiF,SAAS3iF,EAAGK,EAAGjC,KAAKF,IAAI8B,GAAGK,IAIvC,OAAOjC,KAEX8xF,mBAAmB/vE,KAAMT,MACrB,IAAIlV,IAAMD,KAAK41B,MAAOhgB,KAAOT,KAAQ,IACjCxS,IAAM3C,KAAK41B,MAAOhgB,KAAOT,KAAQ,KAOrC,OANIxS,IAAM,IACNA,IAAM,GAEN1C,IAAM,IACNA,IAAM,GAEH,CAAC0C,IAAK1C,KAEjB2lF,aAEI,IAAK,IAAInwF,EAAI,EAAGA,EAAI5B,KAAKspE,SAASsoB,UAAWhwF,IAAK,CAC9C5B,KAAK6pF,MAAMljF,KAAK,IAChB,IAAK,IAAI1E,EAAI,EAAGA,EAAIjC,KAAKspE,SAASuoB,WAAY5vF,IAC1CjC,KAAK6pF,MAAMjoF,GAAG+E,KAAK,CAAE,EAAK,EAAG,EAAK,EAAG,MAAS,EAAG,OAAU,EAAG,YAAe,GAAI,MAAS/E,EAAG,MAASK,KAIlH2nF,gBAEI,IAEI/nE,IACAuwE,KACAC,KAEAlJ,KACAmJ,UACAC,WARAC,IAAMhsB,2DAAkB,EAAGxmE,KAAKspE,SAASsoB,UAAY,GACrDa,IAAMjsB,2DAAkB,EAAGxmE,KAAKspE,SAASuoB,WAAa,GAItDa,OAAQ,EAKZ,EAAG,CAECH,WAAa,CAAC,EAAG,EAAG,EAAG,GACvBA,WAAa/rB,qDAAY+rB,YACzB,GAKI,GAJAG,OAAQ,EACR7wE,IAAM0wE,WAAWnsF,MACjBgsF,KAAOI,IAAM9b,mDAAQ70D,KAAK,GAC1BwwE,KAAOI,IAAM/b,mDAAQ70D,KAAK,KACtBuwE,KAAO,GAAKA,MAAQpyF,KAAKspE,SAASsoB,WAGlCS,KAAO,GAAKA,MAAQryF,KAAKspE,SAASuoB,YAAtC,CAIA,GADA1I,KAAOnpF,KAAK6pF,MAAM2I,KAAKC,KACnBtJ,KAAI,YAAgBtnF,OAAS,GAEzBsnF,KAAI,YAAgB,GAAG,IAAMiJ,MAAQjJ,KAAI,YAAgB,GAAG,IAAMkJ,KAClE,MAGRC,UAAYtyF,KAAK6pF,MAAMuI,MAAMC,MACU,GAAnCC,UAAS,YAAgBzwF,SACzBywF,UAAS,YAAgB3rF,KAAK,CAAC6rF,IAAKC,MACpCzyF,KAAK2xF,eAAehrF,KAAK,CAACyrF,KAAMC,OAChCG,IAAMJ,KACNK,IAAMJ,KACNK,OAAQ,UAEPH,WAAW1wF,OAAS,GAAc,GAAT6wF,aAC7BH,WAAW1wF,OAAS,GAEjCmwF,2BAGI,IAGI7I,KACAmJ,UACAK,UALAC,GAAK5yF,KAAKspE,SAASsoB,UACnBrvD,GAAKviC,KAAKspE,SAASuoB,WACvB7xF,KAAK2xF,eAAiBnrB,qDAAYxmE,KAAK2xF,gBAIvC,IAAK,IAAI/vF,EAAI,EAAGA,EAAI5B,KAAKspE,SAASsoB,UAAWhwF,IACzC,IAAK,IAAIK,EAAI,EAAGA,EAAIjC,KAAKspE,SAASuoB,WAAY5vF,IAE1C,GADAknF,KAAOnpF,KAAK6pF,MAAMjoF,GAAGK,GACa,GAA9BknF,KAAI,YAAgBtnF,OAAa,CACjC,IAAIovC,WAAa,CAAC,EAAG,EAAG,EAAG,GAC3BA,WAAau1B,qDAAYv1B,YACzB0hD,WAAY,EACZ,EAAG,CACC,IAAIE,OAAS5hD,WAAW7qC,MACpB0sF,KAAOlxF,EAAI80E,mDAAQmc,QAAQ,GAC3BE,KAAO9wF,EAAIy0E,mDAAQmc,QAAQ,GAC/B,KAAIC,KAAO,GAAKA,MAAQF,IAAMG,KAAO,GAAKA,MAAQxwD,IAAlD,CAKA,GAFA+vD,UAAYtyF,KAAK6pF,MAAMiJ,MAAMC,MAC7BJ,WAAY,EAC2B,GAAnCL,UAAS,YAAgBzwF,OACzB,MAEJ,IAAK,IAAI6sF,EAAI,EAAGA,EAAI4D,UAAS,YAAgBzwF,OAAQ6sF,IACjD,GAAI4D,UAAS,YAAgB5D,GAAG,IAAM9sF,GAAK0wF,UAAS,YAAgB5D,GAAG,IAAMzsF,EAAG,CAC5E0wF,WAAY,EACZ,MAGR,GAAIA,UACA,aAEC1hD,WAAWpvC,QAChB8wF,UACAxJ,KAAI,YAAgBxiF,KAAK,CAAC2rF,UAAS,MAAWA,UAAS,QAGvD9rF,QAAQ+2B,IAAI,+BAMhC00D,gCAGAC,eACI,IAMIc,MACAC,MAGA/mD,GACAC,GACAmmD,UAZAvK,EAAI/nF,KAAK0hB,OACToE,EAAI9lB,KAAK2hB,QACTixE,GAAK5yF,KAAKspE,SAASsoB,UACnBrvD,GAAKviC,KAAKspE,SAASuoB,WACnBqB,IAAM/mF,KAAK41B,MAAM/hC,KAAK0hB,OAASkxE,IAC/BO,IAAMhnF,KAAK41B,MAAM/hC,KAAK2hB,QAAU4gB,IAGhC2lD,UAAYloF,KAAKspE,SAAL,UACZ6e,WAAanoF,KAAKspE,SAAL,WAIjB,IAAK,IAAI1nE,EAAI,EAAGA,EAAIgxF,GAAIhxF,IACpB,IAAK,IAAIK,EAAI,EAAGA,EAAIsgC,GAAItgC,IAAK,CAWzB,GAVAiqC,GAAKgnD,IAAMtxF,EACXuqC,GAAKgnD,IAAMlxF,EACD,GAANiqC,KACAA,GAAK,GAEC,GAANC,KACAA,GAAK,GAET6mD,MAAQxsB,2DAAkB0hB,UAAU,GAAIA,UAAU,IAClD+K,MAAQzsB,2DAAkB2hB,WAAW,GAAIA,WAAW,IAChDlmF,EAAI,EAEJ,IADAqwF,UAAYtyF,KAAK6pF,MAAMjoF,GAAGK,EAAI,GACvBkqC,IAAMmmD,UAAS,EAAQA,UAAS,QAAc,GACjDnmD,KAGR,GAAIvqC,EAAI,EAEJ,IADA0wF,UAAYtyF,KAAK6pF,MAAMjoF,EAAI,GAAGK,GACvBiqC,IAAMomD,UAAS,EAAQA,UAAS,OAAa,GAChDpmD,KAGR,IAAIknD,SAAWjnF,KAAKyD,MAAM42D,2DAAkB,EAAG0sB,IAAMF,OAAS,GAC1DK,SAAWlnF,KAAKyD,MAAM42D,2DAAkB,EAAG2sB,IAAMF,OAAS,GAC9D,KAAO/mD,GAAKknD,SAAWJ,OAASjL,GACxBqL,SACAA,WAGAJ,QAGR,KAAO7mD,GAAKknD,SAAWJ,OAASntE,GACxButE,SACAA,WAGAJ,QAGR/mD,IAAUknD,SACVjnD,IAAUknD,SACVrzF,KAAK6pF,MAAMjoF,GAAGK,GAAd,EAAwBiqC,GACxBlsC,KAAK6pF,MAAMjoF,GAAGK,GAAd,EAAwBkqC,GACxBnsC,KAAK6pF,MAAMjoF,GAAGK,GAAd,MAA4B+wF,MAC5BhzF,KAAK6pF,MAAMjoF,GAAGK,GAAd,OAA6BgxF,MAC7B,IAAK,IAAIK,GAAKpnD,GAAIonD,GAAKpnD,GAAK8mD,MAAOM,KAC/B,IAAK,IAAIC,GAAKpnD,GAAIonD,GAAKpnD,GAAK8mD,MAAOM,KAC/BvzF,KAAKF,IAAIwzF,IAAIC,IAAM,GAMvCC,iBAAiBC,MAAOC,YACpB,IAAIC,GACAC,GACA/jD,KAyBJ,OAxBkB,GAAd6jD,YAAiC,GAAdA,YACnBC,GAAKntB,2DAAkBitB,MAAK,EAAQ,EAAGA,MAAK,EAAQA,MAAK,MAAY,GACnD,GAAdC,YACAE,GAAKH,MAAK,EAAQ,EAClB5jD,KAAO+jD,GAAK,IAGZA,GAAKH,MAAK,EAAQA,MAAK,OAAa,EACpC5jD,KAAO+jD,GAAK,GAEhB5zF,KAAKF,IAAI6zF,IAAI9jD,MAAQ,IAGrB+jD,GAAKptB,2DAAkBitB,MAAK,EAAQ,EAAGA,MAAK,EAAQA,MAAK,OAAa,GACpD,GAAdC,YACAC,GAAKF,MAAK,EAAQA,MAAK,MAAY,EACnC5jD,KAAO8jD,GAAK,IAGZA,GAAKF,MAAK,EAAQ,EAClB5jD,KAAO8jD,GAAK,GAEhB3zF,KAAKF,IAAI+vC,MAAM+jD,IAAM,GAElB,CAACD,GAAIC,IAEhBC,cAAcC,cAAeC,aACzB,IAIIC,SACAC,KACAC,KACAj5B,KAPAwF,QAAUszB,YAAY,GAAKD,cAAc,GACzCl0B,QAAUm0B,YAAY,GAAKD,cAAc,GACzCz1B,KAAOy1B,cAAc,GACrBl2B,KAAOk2B,cAAc,GAKrBK,MAAQ,GACRC,KAAOjoF,KAAKK,IAAIi0D,SAChB4zB,KAAOloF,KAAKK,IAAIozD,SAChB5rB,QAAUwyB,0DACV8tB,UAAYtgD,QACZugD,WAAa,EAAIvgD,QAwBrB,IAvBAigD,KAAOxzB,QAAU,EAAI,EAAI,EACzByzB,KAAOt0B,QAAU,EAAI,EAAI,EACrBw0B,KAAOC,MAEPL,SAAW7nF,KAAKwG,KAAK0hF,KAAOC,WAC5BH,MAAMxtF,KAAK,CAACutF,KAAMF,WAElBG,MAAMxtF,KAAK,CAACstF,KAAMG,OAElBJ,SAAW7nF,KAAK41B,MAAMsyD,KAAOE,YAC7BJ,MAAMxtF,KAAK,CAACutF,KAAMF,aAIlBA,SAAW7nF,KAAKwG,KAAKyhF,KAAOE,WAC5BH,MAAMxtF,KAAK,CAACstF,KAAMD,WAElBG,MAAMxtF,KAAK,CAACutF,KAAMG,OAElBL,SAAW7nF,KAAK41B,MAAMqyD,KAAOG,YAC7BJ,MAAMxtF,KAAK,CAACstF,KAAMD,YAEtBh0F,KAAKF,IAAIu+D,MAAMT,MAAQ,EAChBu2B,MAAMtyF,OAAS,GAElB,IADAo5D,KAAOk5B,MAAM/tF,MACN60D,KAAK,GAAK,GACboD,MAAQqY,mDAAQzb,KAAK,IAAI,GACzB2C,MAAQ8Y,mDAAQzb,KAAK,IAAI,GACzBj7D,KAAKF,IAAIu+D,MAAMT,MAAQ,EACvB3C,KAAK,GAAKA,KAAK,GAAK,EAIhCk3B,mBAEI,IAEIhJ,KACAqL,WACAlC,UACAvC,KACA0E,UANA7B,GAAK5yF,KAAKspE,SAASsoB,UACnBrvD,GAAKviC,KAAKspE,SAASuoB,WAMvB,IAAK,IAAIjwF,EAAI,EAAGA,EAAIgxF,GAAIhxF,IACpB,IAAK,IAAIK,EAAI,EAAGA,EAAIsgC,GAAItgC,IAAK,CACzBknF,KAAOnpF,KAAK6pF,MAAMjoF,GAAGK,GACrB,IAAK,IAAIysF,EAAI,EAAGA,EAAIvF,KAAI,YAAgBtnF,OAAQ6sF,IAC5C8F,WAAarL,KAAI,YAAgBuF,GACjC4D,UAAYtyF,KAAK6pF,MAAM2K,WAAW,IAAIA,WAAW,IAG7ClC,UAAS,MAAYnJ,KAAI,OACzB4G,KAAO,EACP0E,UAAY,GAEPnC,UAAS,MAAYnJ,KAAI,OAC9B4G,KAAO,EACP0E,UAAY,GAEPnC,UAAS,MAAYnJ,KAAI,OAC9B4G,KAAO,EACP0E,UAAY,IAGZ1E,KAAO,EACP0E,UAAY,GAEhBz0F,KAAK6zF,cAAc7zF,KAAKwzF,iBAAiBrK,KAAM4G,MAAO/vF,KAAKwzF,iBAAiBlB,UAAWmC,gB,gNCxV3G,kCAAiBC,Q,yBAAOA,U,8XCExB,MAAMC,GAAK,IAAOxoF,KAAKm8C,KAAK,GAAK,GAC3BssC,IAAM,EAAIzoF,KAAKm8C,KAAK,IAAM,EASjB,MAAMosC,gBAAgBG,+CAIjCp8E,YAAYq8E,UAAY,KACpB53E,QACAld,KAAK+0F,WAAa,CACd,CAAC,GAAI,GACL,CAAC,GAAI,GACL,CAAC,EAAG,GACJ,CAAC,EAAG,GACJ,CAAC,EAAG,GACJ,EAAE,EAAG,GACL,EAAE,EAAG,GACL,EAAE,GAAI,IAEV,IAAIC,aAAe,GACnB,IAAK,IAAIpzF,EAAI,EAAGA,EAAIkzF,UAAWlzF,IAC3BozF,aAAaruF,KAAK/E,GAEtBozF,aAAexuB,qDAAYwuB,cAC3Bh1F,KAAKi1F,OAAS,GACdj1F,KAAKk1F,SAAW,GAChB,IAAK,IAAItzF,EAAI,EAAGA,EAAI,EAAIkzF,UAAWlzF,IAC/B5B,KAAKi1F,OAAOtuF,KAAKquF,aAAapzF,EAAIkzF,YAClC90F,KAAKk1F,SAASvuF,KAAK3G,KAAKi1F,OAAOrzF,GAAK5B,KAAK+0F,WAAWlzF,QAG5DygB,IAAI6yE,IAAKC,KACL,IAG4BC,GAYxBC,GAAIC,GAfJC,MAAQx1F,KAAKi1F,OACbQ,QAAUz1F,KAAKk1F,SACfzgD,MAAQ+gD,MAAM3zF,OAAS,EACvB6zF,GAAK,EAAGC,GAAK,EAAGC,GAAK,EAErB3vE,GAAKkvE,IAAMC,KAAOT,GAClB/yF,EAAIuK,KAAK41B,MAAMozD,IAAMlvE,GACrBhkB,EAAIkK,KAAK41B,MAAMqzD,IAAMnvE,GACrBnJ,GAAKlb,EAAIK,GAAK2yF,GAGd9oD,GAAKqpD,KAFAvzF,EAAIkb,GAGTivB,GAAKqpD,KAFAnzF,EAAI6a,GAMTgvB,GAAKC,IACLupD,GAAK,EACLC,GAAK,IAGLD,GAAK,EACLC,GAAK,GAKT,IAAIvpD,GAAKF,GAAKwpD,GAAKV,GACf3oD,GAAKF,GAAKwpD,GAAKX,GACfnwB,GAAK34B,GAAK,EAAI,EAAI8oD,GAClBlwB,GAAK34B,GAAK,EAAI,EAAI6oD,GAElBtB,IAAKppD,6CAAItoC,EAAG6yC,OACZ8+C,IAAKrpD,6CAAIjoC,EAAGwyC,OAEZohD,GAAK,GAAM/pD,GAAKA,GAAKC,GAAKA,GAC9B,GAAI8pD,IAAM,EAAG,CACTA,IAAMA,GACNR,GAAKI,QAAQnC,GAAKkC,MAAMjC,KACxB,IAAIuC,KAAO91F,KAAK+0F,WAAWM,IAC3BK,GAAKG,GAAKA,IAAMC,KAAK,GAAKhqD,GAAKgqD,KAAK,GAAK/pD,IAE7C,IAAIg9C,GAAK,GAAM/8C,GAAKA,GAAKC,GAAKA,GAC9B,GAAI88C,IAAM,EAAG,CACTA,IAAMA,GACNsM,GAAKI,QAAQnC,GAAKgC,GAAKE,MAAMjC,GAAKgC,KAClC,IAAIO,KAAO91F,KAAK+0F,WAAWM,IAC3BM,GAAK5M,GAAKA,IAAM+M,KAAK,GAAK9pD,GAAK8pD,KAAK,GAAK7pD,IAE7C,IAAI8pD,GAAK,GAAMtxB,GAAKA,GAAKC,GAAKA,GAC9B,GAAIqxB,IAAM,EAAG,CACTA,IAAMA,GACNV,GAAKI,QAAQnC,GAAK,EAAIkC,MAAMjC,GAAK,IACjC,IAAIuC,KAAO91F,KAAK+0F,WAAWM,IAC3BO,GAAKG,GAAKA,IAAMD,KAAK,GAAKrxB,GAAKqxB,KAAK,GAAKpxB,IAI7C,OAAO,IAAMgxB,GAAKC,GAAKC,O,2LCjGhB,MAAMf,S,uVCDrB,kCAAiBmB,SAAF,kDAAYC,MAAKA,iD,iQCIjB,MAAMD,iBAAiBE,8CAClCz9E,YAAY09E,IAAKC,IAAKC,iBAAkB9qE,SACpCrO,MAAMi5E,IAAKC,IAAKC,iBAAkB9qE,SAClCvrB,KAAKs2F,UAAY,GACjBt2F,KAAKu2F,MAAQ,GACbv2F,KAAKw2F,KAAKL,IAAKC,IAAK,MAMxB7sD,QAAQktD,MAAOC,MAAOnS,UAClB,IAAI/wE,IAAMijF,MAAQ,IAAMC,MAIxB,GAHMljF,OAAOxT,KAAKs2F,WACdt2F,KAAK22F,SAASF,MAAOC,SAEnBljF,OAAOxT,KAAKs2F,WACd,OAEJ,IAAIh1D,KAAOthC,KAAKs2F,UAAU9iF,KAC1B,KAAO8tB,MACHijD,SAASjjD,KAAKtsB,EAAGssB,KAAKrsB,GACtBqsB,KAAOA,KAAKtQ,KAMpB2lE,SAASF,MAAOC,OACZ,KAAO12F,KAAKu2F,MAAM10F,QAAQ,CACtB,IAAIy/B,KAAOthC,KAAKu2F,MAAMhlF,QACtB,GAAI+vB,KAAKtsB,GAAKyhF,OAASn1D,KAAKrsB,GAAKyhF,MAC7B,OAEJ,IAAI52D,UAAY9/B,KAAK6tF,cAAcvsD,KAAKtsB,EAAGssB,KAAKrsB,GAChD,IAAK,IAAIrT,EAAI,EAAGA,EAAIk+B,UAAUj+B,OAAQD,IAAK,CACvC,IAAIg1F,SAAW92D,UAAUl+B,GACrBoT,EAAI4hF,SAAS,GACb3hF,EAAI2hF,SAAS,GACR5hF,EAAI,IAAMC,KACTjV,KAAKs2F,WAGft2F,KAAKw2F,KAAKxhF,EAAGC,EAAGqsB,QAI5Bk1D,KAAKxhF,EAAGC,EAAG+b,MACP,IAAIwtB,IAAM,CACNxpC,EACAC,EACA+b,MAEJhxB,KAAKs2F,UAAUthF,EAAI,IAAMC,GAAKupC,IAC9Bx+C,KAAKu2F,MAAM5vF,KAAK63C,Q,kQCnDT,MAAM03C,KACjBz9E,YAAY09E,IAAKC,IAAKC,iBAAkB9qE,QAAU,IAC9CvrB,KAAK62F,KAAOV,IACZn2F,KAAK82F,KAAOV,IACZp2F,KAAK+2F,kBAAoBV,iBACzBr2F,KAAKspE,SAAWp4D,OAAOq4D,OAAO,CAC1B0b,SAAU,GACX15D,SACHvrB,KAAKutF,MAAQ7W,gDAAK12E,KAAKspE,SAAS2b,UACF,GAA1BjlF,KAAKspE,SAAS2b,WACdjlF,KAAKutF,MAAQ,CACTvtF,KAAKutF,MAAM,GACXvtF,KAAKutF,MAAM,GACXvtF,KAAKutF,MAAM,GACXvtF,KAAKutF,MAAM,GACXvtF,KAAKutF,MAAM,GACXvtF,KAAKutF,MAAM,GACXvtF,KAAKutF,MAAM,GACXvtF,KAAKutF,MAAM,KAIvBM,cAAcjjB,GAAIC,IACd,IAAI3rC,OAAS,GACb,IAAK,IAAIt9B,EAAI,EAAGA,EAAI5B,KAAKutF,MAAM1rF,OAAQD,IAAK,CACxC,IAAIqwC,IAAMjyC,KAAKutF,MAAM3rF,GACjBoT,EAAI41D,GAAK34B,IAAI,GACbh9B,EAAI41D,GAAK54B,IAAI,GACZjyC,KAAK+2F,kBAAkB/hF,EAAGC,IAG/BiqB,OAAOv4B,KAAK,CAACqO,EAAGC,IAEpB,OAAOiqB,U,8PCpCA,MAAM+2D,cAAcC,8CAC/Bz9E,YAAY09E,IAAKC,IAAKC,iBAAkB9qE,QAAU,IAC9CrO,MAAMi5E,IAAKC,IAAKC,iBAAkB9qE,SAClCvrB,KAAKu2F,MAAQ,GACbv2F,KAAKg3F,MAAQ,GAMjBztD,QAAQktD,MAAOC,MAAOnS,UAMlB,IALAvkF,KAAKu2F,MAAQ,GACbv2F,KAAKg3F,MAAQ,GACbh3F,KAAKi3F,OAASR,MACdz2F,KAAKk3F,OAASR,MACd12F,KAAKw2F,KAAKx2F,KAAK62F,KAAM72F,KAAK82F,KAAM,MACzB92F,KAAKu2F,MAAM10F,QAAQ,CACtB,IAAIy/B,KAAOthC,KAAKu2F,MAAMhlF,QAClB5F,GAAK21B,KAAKtsB,EAAI,IAAMssB,KAAKrsB,EAC7B,GAAItJ,MAAM3L,KAAKg3F,MACX,SAGJ,GADAh3F,KAAKg3F,MAAMrrF,IAAM21B,KACbA,KAAKtsB,GAAKyhF,OAASn1D,KAAKrsB,GAAKyhF,MAC7B,MAEJ,IAAI52D,UAAY9/B,KAAK6tF,cAAcvsD,KAAKtsB,EAAGssB,KAAKrsB,GAChD,IAAK,IAAIrT,EAAI,EAAGA,EAAIk+B,UAAUj+B,OAAQD,IAAK,CACvC,IAAIg1F,SAAW92D,UAAUl+B,GACrBoT,EAAI4hF,SAAS,GACb3hF,EAAI2hF,SAAS,GACR5hF,EAAI,IAAMC,KACTjV,KAAKg3F,OAGfh3F,KAAKw2F,KAAKxhF,EAAGC,EAAGqsB,OAGxB,IAAIA,KAAOthC,KAAKg3F,MAAMP,MAAQ,IAAMC,OACpC,GAAKp1D,KAGL,KAAOA,MACHijD,SAASjjD,KAAKtsB,EAAGssB,KAAKrsB,GACtBqsB,KAAOA,KAAKtQ,KAGpBwlE,KAAKxhF,EAAGC,EAAG+b,MACP,IAAIlL,EAAI9lB,KAAKm3F,UAAUniF,EAAGC,GACtBupC,IAAM,CACNxpC,EACAC,EACA+b,KACA7M,EAAI6M,KAAOA,KAAK7M,EAAI,EAAI,EACxB2B,GAGAsxE,EAAI54C,IAAIr6B,EAAIq6B,IAAI14B,EACpB,IAAK,IAAIlkB,EAAI,EAAGA,EAAI5B,KAAKu2F,MAAM10F,OAAQD,IAAK,CACxC,IAAI0/B,KAAOthC,KAAKu2F,MAAM30F,GAClBy1F,MAAQ/1D,KAAKnd,EAAImd,KAAKxb,EAC1B,GAAIsxE,EAAIC,OAAUD,GAAKC,OAASvxE,EAAIwb,KAAKxb,EAErC,YADA9lB,KAAKu2F,MAAM7lF,OAAO9O,EAAG,EAAG48C,KAIhCx+C,KAAKu2F,MAAM5vF,KAAK63C,KAEpB24C,UAAUniF,EAAGC,GACT,OAAQjV,KAAKspE,SAAS2b,UAClB,KAAK,EACD,OAAQ94E,KAAKK,IAAIwI,EAAIhV,KAAKi3F,QAAU9qF,KAAKK,IAAIyI,EAAIjV,KAAKk3F,QAE1D,KAAK,EACD,IAAI/1D,GAAKh1B,KAAKK,IAAIwI,EAAIhV,KAAKi3F,QACvB71D,GAAKj1B,KAAKK,IAAIyI,EAAIjV,KAAKk3F,QAC3B,OAAO91D,GAAKj1B,KAAKC,IAAI,GAAI+0B,GAAKC,IAAM,GAExC,KAAK,EACD,OAAOj1B,KAAKC,IAAID,KAAKK,IAAIwI,EAAIhV,KAAKi3F,QAAS9qF,KAAKK,IAAIyI,EAAIjV,KAAKk3F,a,4LCjF9D,MAAM1gE,OACjB/d,YAAY6+E,WACRt3F,KAAKu3F,WAAaD,UAClBt3F,KAAKw3F,MAAQ,EAKjB14F,QAAU,OAAOkB,KAAKkF,SAItBuyF,OAEI,OADAz3F,KAAKw3F,QACEx3F,KAKXkF,SACI,IAAKlF,KAAKw3F,MACN,MAAM,IAAIzmE,MAAM,iCAGpB,IADA/wB,KAAKw3F,SACGx3F,KAAKw3F,OAAO,CAChB,IAAIjuE,MAAQvpB,KAAKu3F,WAAWtmE,OAC5B,IAAK1H,MACD,OAAOvpB,KAAKy3F,OAEhB,IAAIv4D,OAAS3V,MAAMmuE,MACfx4D,QAAUA,OAAOzgC,OACjBuB,KAAKy3F,OACLv4D,OAAOzgC,KAAKuB,KAAKkF,OAAOiI,KAAKnN,QAGrC,OAAOA,Q,kQC/BA,MAAM23F,SACjBl/E,YAAYm/E,qBAAsBrsE,QAAU,IACxCvrB,KAAK63F,sBAAwBD,qBAC7B53F,KAAKspE,SAAW,GAChB/9C,QAAUra,OAAOq4D,OAAO,CACpBuuB,OAAQ,EACRC,kBAAmB,IACnBrwD,MAAO,IACRnc,SACHvrB,KAAKg4F,QAAU,GACfh4F,KAAKi4F,mBAAqB,GAC1Bj4F,KAAKk4F,UAAY,GACjBl4F,KAAKwpE,WAAWj+C,SAKpBi+C,WAAWj+C,SAKP,OAJAra,OAAOq4D,OAAOvpE,KAAKspE,SAAU/9C,SACzBA,SAAWA,QAAQmc,OACnB1nC,KAAK0R,QAEF1R,KAKXm4F,OAAOxyB,KAGH,OAFA3lE,KAAKo4F,KAAOzyB,IACZ3lE,KAAKk4F,UAAY,GACVl4F,KAKXq4F,SAASrjF,EAAGC,EAAGutB,OACX,IAAIhvB,IAAMwB,EAAI,IAAMC,EAOpB,OANIutB,MACAxiC,KAAKg4F,QAAQxkF,KAA0B,iBAAVgvB,MAAqB6jC,kDAAiB7jC,OAASA,aAGrExiC,KAAKg4F,QAAQxkF,KAEjBxT,KAKXs4F,cAAgBt4F,KAAKg4F,QAAU,GAI/BtmF,QAGI,OAFA1R,KAAKi4F,mBAAqB,GAC1Bj4F,KAAKk4F,UAAY,GACVl4F,KAKXupC,QAAQgvD,kBACJ,IAAIC,UAAY,GACZC,cAAgB,GAChBC,SAAW,GACf,IAAK,IAAIllF,OAAOxT,KAAKg4F,QAAS,CAC1B,IAAI9wE,MAAQlnB,KAAKg4F,QAAQxkF,KACzBilF,cAAcjlF,KAAO,CAAC,EAAG,EAAG,GAC5B6yD,4CAAWoyB,cAAcjlF,KAAM0T,OAEnC,IAAK,IAAItlB,EAAI,EAAGA,EAAI5B,KAAKspE,SAASwuB,OAAQl2F,IACtC5B,KAAK24F,WAAWF,cAAeC,SAAUF,WACrC52F,EAAI,GAAK5B,KAAKspE,SAASwuB,SAG3BW,cAAgBz4F,KAAK44F,iBAAiBF,SAAUF,YAEpD,IAAK,IAAIK,UAAUH,SAAU,CACzB,IAAIzzE,MAAQ4zE,OAAOj1F,MAAM,KAGzB20F,iBAFQ50F,SAASshB,MAAM,IACfthB,SAASshB,MAAM,IACAyzE,SAASG,SAEpC,OAAO74F,KAQX24F,WAAWF,cAAeC,SAAUF,WAChC,IAAK,IAAIhlF,OAAOilF,cAAe,CAC3B,IAAIxzE,MAAQzR,IAAI5P,MAAM,KAClBoR,EAAIrR,SAASshB,MAAM,IACnBhQ,EAAItR,SAASshB,MAAM,IACvBjlB,KAAK84F,mBAAmB9jF,EAAGC,EAAGwjF,cAAcjlF,KAAMklF,UAClDF,UAAUhlF,KAAO,EAErB,OAAOxT,KAKX44F,iBAAiBF,SAAUF,WACvB,IAAIt5D,OAAS,GACb,IAAK,IAAI1rB,OAAOklF,SAAU,CACtB,GAAIllF,OAAOglF,UACP,SAEJ,IACIO,aADAv2D,MAAQk2D,SAASllF,KAErB,GAAIA,OAAOxT,KAAKi4F,mBACZc,aAAe/4F,KAAKi4F,mBAAmBzkF,SAEtC,CACD,IAAIyR,MAAQzR,IAAI5P,MAAM,KAClBoR,EAAIrR,SAASshB,MAAM,IACnBhQ,EAAItR,SAASshB,MAAM,IACvB8zE,aAAe/4F,KAAK63F,sBAAsB7iF,EAAGC,GAC7CjV,KAAKi4F,mBAAmBzkF,KAAOulF,aAEnC,GAAoB,GAAhBA,aACA,SAGJ,IAAIC,SAAW,CAAC,EAAG,EAAG,GAClB34C,UAAY,EAChB,IAAK,IAAIz+C,EAAI,EAAGA,EAAI,EAAGA,IAAK,CACxB,IAAIimE,KAAO17D,KAAKyD,MAAM4yB,MAAM5gC,GAAKm3F,cACjCC,SAASp3F,GAAKimE,KACdxnB,WAAawnB,KAEbxnB,UAAYrgD,KAAKspE,SAASyuB,oBAC1B74D,OAAO1rB,KAAOwlF,UAGtB,OAAO95D,OAKX45D,mBAAmB9jF,EAAGC,EAAGutB,MAAOk2D,UAC5B,IACI/yB,IADAnyD,IAAMwB,EAAI,IAAMC,EAGhB0wD,IADAnyD,OAAOxT,KAAKk4F,UACNl4F,KAAKk4F,UAAU1kF,KAGfxT,KAAKi5F,WAAWjkF,EAAGC,GAE7B,IAAK,IAAIikF,UAAUvzB,IAAK,CACpB,IACIzmC,OADAi6D,WAAaxzB,IAAIuzB,QAEjBA,UAAUR,SACVx5D,OAASw5D,SAASQ,SAGlBh6D,OAAS,CAAC,EAAG,EAAG,GAChBw5D,SAASQ,QAAUh6D,QAEvB,IAAK,IAAIt9B,EAAI,EAAGA,EAAI,EAAGA,IACnBs9B,OAAOt9B,IAAMuK,KAAKyD,MAAM4yB,MAAM5gC,GAAKu3F,YAG3C,OAAOn5F,KAKXi5F,WAAWjkF,EAAGC,GACV,IAAImkF,KAAOpkF,EAAI,IAAMC,EACjBrE,MAAQ,GACZ5Q,KAAKk4F,UAAUkB,MAAQxoF,MACvB,IAAI82B,MAAQ1nC,KAAKspE,SAAS5hC,MAW1B,OADA1nC,KAAKo4F,KAAK7uD,QAAQv0B,EAAGC,EAAGyyB,MATxB,SAAY1yB,EAAGC,EAAGiP,EAAGm1E,KACjB,IACIF,WAAaE,KAAO,EAAIn1E,EAAIwjB,OACd,GAAdyxD,aAGJvoF,MALWoE,EAAI,IAAMC,GAKPkkF,aAGgBhsF,KAAKnN,OAChC4Q,S,6aC5LA,MAAM+J,oBAAoBmO,6CAGrCrQ,YAAY7Z,MACRse,MAAMte,MADQ,mCAFT,O,4UAIL,CAAAoB,KAAA,OAAcpB,KAAKC,IAAIkqB,YAAY,CAC/BlpB,IAAK,CAACspB,qDACNF,KAAM,CAACC,8DAIfxM,OAAOD,K,iOACH,CAAAzc,KAAA,QAAYsiB,MAAM/O,SAASkW,SACvBA,OAAOM,UAAU,SAEbN,OAAOO,SACPhqB,KAAKpB,KAAKqb,QAAQ8/C,UAAUxvC,oEAE5Bd,OAAO0J,IAAIjK,iE,+/BClBZ,MAAM/N,uBAAuB2N,6CAIxCrQ,YAAY7Z,MACRse,MAAMte,MADQ,2CAHD,OAGC,0CAFF,OAIZ,sBAAAoB,KAAA,cAAqBpB,KAAKC,IAAIkqB,YAAY,CACtClpB,IAAK,CAACw0C,iEAEV,sBAAAr0C,KAAA,eAAsBpB,KAAKC,IAAIkqB,YAAY,CACvClpB,IAAK,CAACg0C,0DAIdS,eAAet/B,EAAGC,EAAG2Y,WAAa,IACpB5tB,KAAKpB,KAAKC,IAAI83B,eAEtBxD,IAAI0gB,sDAAU,IACTjmB,WACH5Y,EACAC,IAIR4uC,cAAc7uC,EAAGC,EAAGqkF,YAAc,GAAI9kD,aAAe,IACvCx0C,KAAKpB,KAAKC,IAAI83B,eAEtBxD,IAAIkhB,6DAAiB,CACnBr/B,EACAC,KACGqkF,YACH9kD,aAAc,CACVhX,UAAW,CACPxoB,EAAG,EACHC,EAAG,GAEPwoB,OAAQ,CAAC,IAAK,IAAK,IAAK,KACxBC,KAAM,CAAC,OAAQ,QACfC,MAAO,IACPC,SAAU,OACP4W,gBAKf93B,OAAOD,IACH,sBAAAzc,KAAA,eAAmBsiB,MAAM/O,SAASkW,SAC9B,MAAM8vE,QAAU9vE,OAAO+vE,gBAIvB,GAFAD,QAAQzlD,KAAOr3B,GAEX88E,QAAQE,UACRhwE,OAAO0E,cACJ,CACH,MAAMy5C,MAAS2xB,QAAQnxF,KAAO,IAAQmxF,QAAQjtF,SACxCotF,YAAcvtF,KAAKyT,MAAM25E,QAAQvlD,QAAU4zB,OAEjD,IAAK,IAAIhmE,EAAI23F,QAAQ9kD,MAAO7yC,EAAI83F,YAAa93F,IACzC23F,QAAQjlD,qBAKpB,sBAAAt0C,KAAA,gBAAoBsiB,MAAM/O,SAASkW,SAC/B,MAAM8qB,SAAW9qB,OAAO8qB,SAIxB,GAFAA,SAAST,KAAOr3B,GAEZ83B,SAASklD,UAET,YADAhwE,OAAO0E,UAOX,GAHAomB,SAASv/B,GAAKu/B,SAAS/W,UAAUxoB,EAAIu/B,SAAS5W,MAC9C4W,SAASt/B,GAAKs/B,SAAS/W,UAAUvoB,EAAIs/B,SAAS5W,OAEzC39B,KAAKpB,KAAK6a,OAAOivC,SAASnU,SAASv/B,EAAGu/B,SAASt/B,GAChD,OAGJ,MAAMy3B,OAAS1sC,KAAKpB,KAAK6a,OAAOilD,cAC5BnqB,SAASv/B,EACTu/B,SAASt/B,GAGbjV,KAAKpB,KAAKqa,SAAS+E,KACf7R,KAAKyD,MAAM88B,OAAO13B,GAClB7I,KAAKyD,MAAM88B,OAAOz3B,GAClBs/B,SAASnxB,MACTmxB,SAASr2B,IACTq2B,SAASp2B,IACTo2B,SAASn2B,U,gZCnFV,MAAMxE,uBAAuBmD,8CAGxC,eACI,OAAO7L,OAAO2T,OAAOlL,uDAGzBlB,YAAY7Z,M,kBACRse,MAAMte,M,MAPE,I,IAMM,e,IAAA,M,gGAGdoB,KAAK25F,YAAYzmD,4DAAgBE,6DAAiB,KAClDpzC,KAAK25F,YAAYzmD,4DAAgBC,8DAAkB,KACnDnzC,KAAK25F,YAAYzmD,4DAAgBI,8DAAkB,KACnDtzC,KAAK25F,YAAYzmD,4DAAgBG,2DAAe,KAChDrzC,KAAK25F,YAAYrmD,6DAAiBH,+DAAmB,KACrDnzC,KAAK25F,YAAYrmD,6DAAiBF,4DAAgB,KAClDpzC,KAAK25F,YAAYrmD,6DAAiBD,0DAAc,KAChDrzC,KAAK25F,YAAYvmD,4DAAgBD,+DAAmB,KACpDnzC,KAAK25F,YAAYtmD,0DAAcF,+DAAmB,KAGtDymD,eAAejuF,IACX,OAAO3L,KAAK2Z,SAASqrB,MAAMoyD,GAAMA,EAAEzrF,KAAOA,KAG9CsnC,iBAAiB51B,MACb,OAAO41B,iEAAiB51B,MAG5Bw8E,UAAUC,SAAUC,UAChB,OAAOD,WAAaC,SAGxBC,aAAaC,IAAKC,KACd,MAAO,CAACD,IAAKC,KAAK5wE,OAAO/D,KAAK,KAGlCo0E,YAAYM,IAAKC,IAAKj4E,OAClB,MAAMzO,IAAMxT,KAAKg6F,aAAaC,IAAKC,KAEnCl6F,KAAKm6F,UAAU3mF,KAAOyO,MAG1Bm4E,YAAYH,IAAKC,KACb,MAAM1mF,IAAMxT,KAAKg6F,aAAaC,IAAKC,KAMnC,OAJKl6F,KAAKm6F,UAAUp2E,eAAevQ,OAC/BxT,KAAKm6F,UAAU3mF,KAAO,GAGnBxT,KAAKm6F,UAAU3mF,KAG1B41C,kBAAkBixC,QAASC,SACvB,MAAMC,QAAUF,QAAQ/3E,IAAI0wB,4DACtBwnD,QAAUF,QAAQh4E,IAAI0wB,4DAE5B,GAAIunD,SAAWC,QAAS,CACpB,MAAMV,SAAWS,QAAQ57B,QACnBo7B,SAAWS,QAAQ77B,QAEzB,OAAO3+D,KAAKo6F,YAAYN,SAASnuF,GAAIouF,SAASpuF,IAGlD,OAAO,EAGXmvD,mBAAmBu/B,QAASC,SAGxB,OAFiBt6F,KAAKopD,kBAAkBixC,QAASC,UAE9B,IAGvB17B,WAAW38C,OACP,OAAIA,QAAU,IACH,aAGPA,QAAU,IACH,aAGPA,OAAS,IACF,QAGPA,OAAS,IACF,WAGPA,OAAS,IACF,WAGJ,UAGXonC,iBAAiBpnC,OACb,OAAIA,QAAU,IACH,CACHhE,KAAM,IACNC,IAAK,UACLC,IAAK,WAIT8D,OAAS,IACF,CACHhE,KAAM,IACNC,IAAK,UACLC,IAAK,WAIN,CACHF,KAAM,IACNC,IAAK,UACLC,IAAK,c,kaC/HF,MAAMzE,sBAAsBqD,8CAWvCtE,YAAY7Z,MACRse,MAAMte,MADQ,6BAVV,IAUU,8BATT,IASS,4BARX,GAQW,+BAPR,GAOQ,8BANT,IAMS,8BALT,IAKS,+BAHR,GAGQ,+BAFR,GAIND,OAAOW,iBAAiB,SAAUU,KAAKy6F,eAAettF,KAAKnN,OAC3DA,KAAKy6F,iBAGT,wBACI,OAAOz6F,KAAK8d,KAAO9d,KAAKpB,KAAKqa,SAASwE,UAG1C,yBACI,OAAOzd,KAAK8d,KAAO9d,KAAKpB,KAAKqa,SAASyE,WAG1C,WACI,OAAO1d,KAAK06F,cAGhB,YACI,OAAO16F,KAAK06F,cAAgB16F,KAAKud,MAGrC,UACI,OAAOvd,KAAK26F,cAGhB,aACI,OAAO36F,KAAK26F,cAAgB36F,KAAKwd,OAGrC0sD,cACIlqE,KAAKud,MAAQpR,KAAKC,IACdpM,KAAK46F,OACLzuF,KAAK41B,MAAMpjC,OAAOk8F,WAAa76F,KAAK86F,oBAExC96F,KAAKwd,OAASrR,KAAKC,IACfpM,KAAK+6F,OACL5uF,KAAK41B,MAAMpjC,OAAOq8F,YAAch7F,KAAKi7F,qBAEzCj7F,KAAK06F,cAAgBvuF,KAAK41B,MACtB51B,KAAK2C,IACD3C,KAAKC,KAAKpM,KAAKk7F,QAASl7F,KAAKm7F,QAAUn7F,KAAKud,MAAQ,GACpDpR,KAAKC,KACApM,KAAKud,MAAQvd,KAAKpB,KAAKkB,IAAIyd,QAAU,EACtCvd,KAAKk7F,QAAUl7F,KAAKpB,KAAKkB,IAAIyd,MAAQvd,KAAKud,SAItDvd,KAAK26F,cAAgBxuF,KAAK41B,MACtB51B,KAAK2C,IACD3C,KAAKC,KAAKpM,KAAKk7F,QAASl7F,KAAKo7F,QAAUp7F,KAAKwd,OAAS,GACrDrR,KAAKC,KACApM,KAAKwd,OAASxd,KAAKpB,KAAKkB,IAAI0d,SAAW,EACxCxd,KAAKk7F,QAAUl7F,KAAKpB,KAAKkB,IAAI0d,OAASxd,KAAKwd,UAM3Di9E,iBACIz6F,KAAKkqE,cACLlqE,KAAKpB,KAAKqa,SAAS4E,cAAc7d,KAAKud,MAAOvd,KAAKwd,OAAQxd,KAAK8d,MAGnEu9E,QAAQv9E,MACJ9d,KAAK8d,KAAOA,KACZ9d,KAAKkqE,cACLlqE,KAAKy6F,iBAGThgC,SAASzlD,EAAGC,GACRjV,KAAKm7F,QAAUnmF,EACfhV,KAAKo7F,QAAUnmF,EACfjV,KAAKkqE,cAGToxB,WAAWr5E,OACPjiB,KAAKk7F,QAAUj5E,MACfjiB,KAAKkqE,cAGTxL,cAAc1pD,EAAGC,GACb,MAAO,CACHD,EAAGA,EAAIhV,KAAK06F,cACZzlF,EAAGA,EAAIjV,KAAK26F,eAIpBlyC,cAAczzC,EAAGC,GACb,MAAO,CACHD,EAAGA,EAAIhV,KAAK06F,cACZzlF,EAAGA,EAAIjV,KAAK26F,eAIpBY,gBACI,MAAO,CACHvmF,EAAGhV,KAAK06F,cACRzlF,EAAGjV,KAAK26F,cACRp9E,MAAOvd,KAAKud,MACZC,OAAQxd,KAAKwd,QAIrBkrC,SAASR,OAAQC,QACb,MAAMzb,OAAS1sC,KAAK0+D,cAAcxW,OAAQC,QAE1C,OACIzb,OAAO13B,EAAIhV,KAAKud,OAChBmvB,OAAOz3B,EAAIjV,KAAKwd,QAChBkvB,OAAO13B,GAAK,GACZ03B,OAAOz3B,GAAK,K,yaC1HxB,MAAMumF,WAAa77F,SAAS87F,uBAAuB,OAAO,GAE3C,MAAMpgF,4BAA4ByN,6CAI7CrQ,YAAY7Z,MACRse,MAAMte,MADQ,8BAHT,IAGS,kCAFL,IAIToB,KAAK07F,OAAS,GAEd,IAAK,IAAI95F,EAAI,EAAGA,EAAI5B,KAAK27F,WAAY/5F,IACjC5B,KAAK07F,OAAO95F,GAAK,EAIzB8a,OAAOD,IACHzc,KAAK07F,OAAO/0F,KAAK,IAAO8V,IACxBzc,KAAK07F,OAAOnqF,QAEZ,MAAM8mB,IAAMr4B,KAAK07F,OAAO3xD,QAAO,CAAC9jB,EAAGwG,IAAMxG,EAAIwG,GAAG,GAC1CrR,IAAMjP,KAAKyT,MAAMyY,IAAMr4B,KAAK27F,YAElCH,WAAWI,UAAYxgF,O,6nCCnBxB,MAAM/B,qBAAqB0D,8CAK9B,aACI,6BAAO/c,KAAP,SAGJ,WACI,OAAO,sBAAAA,KAAA,OAAW67F,QAAX,sBAAmB77F,KAAnB,UAGX,YACI,6BAAOA,KAAP,QAGJyY,YAAY7Z,MACRse,MAAMte,MADQ,oIAGd,sBAAAoB,KAAA,MAAa,IAAI87F,sDAGrBr6B,eACI,MAAO,CACHvC,OAAQ,sBAAAl/D,KAAA,OAAW+7F,kBAAkBpwF,GACrCqwF,gBAAiB,IAIzBl8E,kBAEI,MAAMhN,KAAOrT,MAAMC,KAAKM,KAAKpB,KAAKC,IAAIuqB,SAASvpB,KAAKuhB,QAC/Cne,IAAOA,EAAE+vB,IAAI6d,yDAEZ6wB,WAAa1hE,KAAKpB,KAAKC,IAAIsjB,UAAUrP,MAM3C,OAJAtM,QAAQ+2B,IAAI,sBAAuBmkC,YAEnC1hE,KAAKpB,KAAKiE,MAAM4gE,mBAAmBzjE,KAAKqkE,KAAK14D,GAAI+1D,YAE1C,CACHxC,OAAQl/D,KAAKqkE,KAAK14D,GAClBqwF,gBAAiB,IAIzBr6B,MAAM7uD,OASN+uD,WAEI,sBAAA7hE,KAAA,QAAe,MAGnBq/D,aAAagF,KAAMlF,OACf,sBAAAn/D,KAAA,QAAeqkE,KAAK14D,IAEpB,MAAMmH,KAAO9S,KAAKpB,KAAKiE,MAAM6gE,mBAAmBW,KAAK14D,IAEjDmH,KACA9S,KAAKpB,KAAKC,IAAIwjB,YAAYvP,MAE1BuxD,KAAK8c,SAASnhF,KAAKpB,MAI3BqmE,UAAUZ,KAAMlF,OACZn/D,KAAKpB,KAAKqb,QAAQ8/C,UAAUpvC,kEAAkB,CAC1Co0C,YAAa/+D,KAAKqkE,KAClBrF,SAAUqF,KACVlF,W,8kBC/EG,MAAM28B,UAGjB,YACI,OAAOhpF,+CAGX,aACI,OAAOA,gDAGX+O,IAAI7M,EAAGC,GACH,OAAOA,EAAIjV,KAAKud,MAAQvI,EAG5B8M,MAAMD,KACF,MAAO,CACH7M,EAAG7I,KAAKyT,MAAMiC,IAAM7hB,KAAKud,OACzBtI,EAAG9I,KAAKyT,MAAMiC,IAAM7hB,KAAKud,QAIjC9E,cAAc,mCArBL,K,4UAsBL,CAAAzY,KAAA,OAAc,IAEd,IAAK,IAAIgV,EAAI,EAAGA,EAAIlC,+CAAYkC,IAC5B,IAAK,IAAIC,EAAI,EAAGA,EAAInC,gDAAamC,IAAK,CAClC,MAAMovD,KAAO43B,kDAAej8F,KAAM8S,+CAAWmC,GAAGD,GAAIA,EAAGC,GAEvD,sBAAAjV,KAAA,QAAYqkE,KAAK14D,IAAM04D,MAKnCniD,cAAclN,EAAGC,GACb,OAAOD,EAAI,GAAKC,EAAI,GAAKD,GAAKhV,KAAKud,OAAStI,GAAKjV,KAAKwd,OAG1Du+E,kBACI,OAAO/7F,KAAK67F,QAAQ,IAGxBK,eAAelnF,EAAGC,GACd,OAAOjV,KAAK67F,QAAQ77F,KAAK6hB,IAAI7M,EAAGC,IAGpC4mF,QAAQh6E,KACJ,MAAM,KAAW7hB,KAAK8hB,MAAMD,KAE5B,OAAI7hB,KAAKkiB,cAAclN,EAAGC,GACf,IAAIgnF,wCAAKj8F,KAAMgV,EAAGC,GAGtB,sBAAAjV,KAAA,QAAY6hB,Q,inCCrDpB,MAAMo6E,KAQT,QACI,6BAAOj8F,KAAP,IAGJ,QACI,6BAAOA,KAAP,IAGJ,SACI,OAAOA,KAAKoZ,MAAMyI,IAAI7hB,KAAKgV,EAAGhV,KAAKiV,GAGvC,gBACI,OAAOjV,KAAKoZ,MAAM8iF,eAAX,sBAA0Bl8F,KAA1B,IAAmC,sBAAAA,KAAA,IAAU,GAGxD,gBACI,OAAOA,KAAKoZ,MAAM8iF,eAAX,sBAA0Bl8F,KAA1B,IAAmC,sBAAAA,KAAA,IAAU,GAGxD,eACI,OAAOA,KAAKoZ,MAAM8iF,eAAe,sBAAAl8F,KAAA,IAAU,EAApC,sBAAuCA,KAAvC,KAGX,eACI,OAAOA,KAAKoZ,MAAM8iF,eAAe,sBAAAl8F,KAAA,IAAU,EAApC,sBAAuCA,KAAvC,KAGXyY,YAAYW,MAAOpE,EAAGC,GAAG,+BAnCpB,IAmCoB,+BAlCpB,IAkCoB,wCAjCN,IAiCM,uCAhCP,IAgCO,iCA/Bb,IA+Ba,6BA9BjB,MA+BJjV,KAAKoZ,MAAQA,MACb,sBAAApZ,KAAA,GAAUgV,GACV,sBAAAhV,KAAA,GAAUiV,GAGdknF,WACI,MAAMC,MAAQ,GAkCd,OA/BAA,MAAMz1F,QACC3G,KAAKq8F,iBAAiBv8F,KAAKuhB,IAAD,CACzBrM,EAAG,GACHC,EAAG,OAKXmnF,MAAMz1F,QACC3G,KAAKs8F,gBAAgBx8F,KAAKuhB,IAAD,CACxBrM,EAAG,EACHC,EAAG,QAKXmnF,MAAMz1F,QACC3G,KAAKolE,SAASk3B,gBAAgBx8F,KAAKuhB,IAAD,CACjCrM,EAAGpW,uDAAiB,EACpBqW,EAAG,QAKXmnF,MAAMz1F,QACC3G,KAAKmlE,UAAUk3B,iBAAiBv8F,KAAKuhB,IAAD,CACnCrM,EAAG,GACHC,EAAGrW,wDAAkB,OAItBw9F,MAGXjb,SAASviF,MACL,MAAMw9F,MAAQp8F,KAAKm8F,WACbI,WAAYC,0EAAax8F,KAAKu8F,UAAUlkF,MAExC2nB,SAAW,CACbziB,MAAO3e,KAAKkB,IAAIyd,MAChBC,OAAQ5e,KAAKkB,IAAI0d,OACjB4+E,OAGE/9E,MAAQk+E,UAAUpb,SAASnhD,UAEjCu8D,UAAUE,SAASz8D,SAAU3hB,OAE7Bre,KAAKqe,MAAQA,MAGjB,iBAAiBjF,MAAOtG,KAAMkC,EAAGC,GAC7B,MAAMovD,KAAO,IAAI43B,KAAK7iF,MAAOpE,EAAGC,GAQhC,OANAovD,KAAKg4B,iBAAmBvpF,KAAKupF,iBAC7Bh4B,KAAKi4B,gBAAkBxpF,KAAKwpF,gBAC5Bj4B,KAAKk4B,UAAYzpF,KAAKypF,UACtBl4B,KAAK1rD,MAAQ7F,KAAK6F,MAClB0rD,KAAKvoD,YAAchJ,KAAKgJ,YAEjBuoD,Q,yoBCrGHq4B,8DACWC,kFACJC,0EACFC,sEACLC,8DACAC,8DANZ,MASaP,aAAgBn/E,MAClB0/E,+D,gkBCXJ,MAAMH,8BAA8BI,oDACvC,gBAAgBh9D,UACZ,MAAM3hB,MAAQ4+E,2EAAuB,CACjC1/E,MAAOyiB,SAASziB,MAChBC,OAAQwiB,SAASxiB,SAGrBa,MAAMwrE,MAAMt2E,SAAS41E,MAAUA,KAAK+T,MAAQC,mEAE5C,MAAMC,YAAc/+E,MAAMwrE,MAAMzoE,QAC3B8C,GAAMA,EAAE3G,OAAS,GAAK2G,EAAE1G,QAAU,IAEjC2rE,MAAOtnD,uDAAWu7D,aAEpBjU,OACAA,KAAK+T,MAAQG,gEACblU,KAAKmU,cAAe,GAGxB,MAAMC,eAAiBH,YAAYh8E,QAAQ8C,GAAMA,IAAMilE,OACjDQ,OAAQ9nD,uDAAW07D,gBAErB5T,QACAA,MAAMuT,MAAQG,gEACd1T,MAAM2T,cAAe,GAWzB,OARkBj/E,MAAMm/E,qBAEdjqF,SAAS26D,OACfA,KAAKgvB,MAAQC,qEAGjBM,2DAASp/E,MAAO2hB,SAASo8D,OAElB/9E,S,uaCrCf,MAqBaq/E,QAAU,CAACr/E,MAAOs/E,QAC3B,MAAMn4F,OAtBa,EAAC6Y,MAAO4O,UAC3B,IAAI2wE,QAAU,KACVC,gBAAkB,KAgBtB,OAdAx/E,MAAMvL,KAAKS,SAAS26D,OAChB,IAAKA,KAAK4vB,OAAOC,wDACb,OAGJ,MAAMj4C,UAAW5lB,2EAAkBguC,KAAMjhD,QAEzC,OAAI64B,SAAW+3C,iBAA+B,OAAZD,SAC9BA,QAAU1vB,UACV2vB,gBAAkB/3C,gBAFtB,KAOG83C,SAIQI,CAAe3/E,MAAOs/E,MAErC,GAAIn4F,OAAOwP,IAAM2oF,KAAK3oF,GAAKxP,OAAOyP,IAAM0oF,KAAK1oF,EAEzC,YADAoJ,MAAM4/E,YAAYN,KAAK3oF,EAAG2oF,KAAK1oF,EAAG8oF,wDAItC1/E,MAAM4/E,YAAYz4F,OAAOwP,EAAGxP,OAAOyP,EAAGipF,uDACtC7/E,MAAM4/E,YAAYN,KAAK3oF,EAAG2oF,KAAK1oF,EAAGipF,uDAElC,MAAMh/D,QAASC,0DAAa,CACxBb,KAAM,CACFtpB,EAAGxP,OAAOwP,EACVC,EAAGzP,OAAOyP,GAEdnW,MAAO,CACHkW,EAAG2oF,KAAK3oF,EACRC,EAAG0oF,KAAK1oF,GAEZ4qB,gBAAgB,EAChBT,KAAM,CAAC/a,EAAGD,IACF/F,MAAM8/E,SAAS/5E,EAAEpP,EAAGoP,EAAEnP,GACf/H,IAGPmR,MAAM+/E,gBAAgBh6E,EAAEpP,EAAGoP,EAAEnP,EAAGipF,wDACzBh+D,2EAAkB7b,EAAGD,GAGzBlX,MAQf,GAJAgyB,OAAOM,KAAKjsB,SAASksB,UACjBphB,MAAM4/E,YAAYx+D,QAAQzqB,EAAGyqB,QAAQxqB,EAAG8oF,2DAGxC7+D,OAAOlrB,QAAS,CAChB,MAAM67B,KAAO3Q,OAAOM,KAAKN,OAAOM,KAAK39B,OAAS,GACxCsnF,KAAO9qE,MAAMggF,eAAexuD,KAAK76B,EAAG66B,KAAK56B,GAE3Ck0E,MACAA,KAAKmV,QAAQzuD,KAAK76B,EAAG66B,KAAK56B,KAKzBwoF,SAAW,CAACp/E,MAAO+9E,SAC5BA,MAAM7oF,SAASoqF,MAASD,QAAQr/E,MAAOs/E,U,qkBCxEpC,MAAMI,gBAAkB,EAClBG,eAAiB,EACjBK,wBAA0B,EAEhC,MAAMC,SAMT/lF,YAAYzD,EAAGC,GAAG,0BALb,GAKa,0BAJb,GAIa,4BAHXspF,yBAGW,6BAFVE,kEAGJz+F,KAAKgV,EAAIA,EACThV,KAAKiV,EAAIA,EAGb6oF,OAAOzlF,MACH,OAAOrY,KAAKqY,OAASA,MAItB,MAAMqmF,eAAiB,CAAC1pF,EAAGC,IAAM,IAAIupF,SAASxpF,EAAGC,I,yuBChBjD,MAAMkoF,kBAAoB,EACpBsB,kBAAoB,EACpBpB,iBAAmB,EACnBsB,kBAAoB,EACpBC,kBAAoB,EAE3BlxD,QAAU,CACZ,CAACyvD,mBAAoB0B,kDACrB,CAACJ,mBAAoBK,kDACrB,CAACzB,kBAAmB0B,iDACpB,CAACJ,mBAAoBK,kDACrB,CAACJ,mBAAoBK,mDAGZC,kBAAqBhC,OACvBxvD,QAAQwvD,Q,yhBCVJ,MAAM4B,oBAAoBK,yDACrC,oBAAoBjxB,OAChBj2C,oDAAM+C,gEAAmBkzC,KAAKl5D,EAAGk5D,KAAKj5D,GAEA,IAAlCjV,KAAKo/F,YAAYlxB,MAAMrsE,QACnBqsE,KAAK4vB,OAAOI,yDACZjmE,oDAAM8B,8DAAiBm0C,KAAKl5D,EAAGk5D,KAAKj5D,GAKhD,oBAAoBk0E,MAChBA,KAAKiT,MAAM7oF,SAASoqF,OACsB,IAAlC39F,KAAKo/F,YAAYzB,MAAM97F,SACvBo2B,oDAAM4B,6DAAgB8jE,KAAK3oF,EAAG2oF,KAAK1oF,MAI3Ck0E,KAAK9qE,MAAM9K,SAAS26D,MAASluE,KAAKq/F,aAAanxB,QAE/C,IAAK,IAAItsE,EAAI,EAAGA,GAAIqgC,sDAAU,EAAG,GAAIrgC,IACjC5B,KAAKs/F,SAASnW,MAAOjb,QACjBj2C,oDAAMkB,yDAAY+0C,KAAKl5D,EAAGk5D,KAAKj5D,S,4UC9BhC,MAAMkqF,mBACjB,oBAAoBjxB,OAEpB,oBAAoBib,MAChBA,KAAK9qE,MAAM9K,SAAS26D,OAChBluE,KAAKq/F,aAAanxB,SAI1B,gBAAgB7vD,OACZA,MAAMvL,KAAKS,SAAS26D,OAChBluE,KAAKq/F,aAAanxB,SAI1B,mBAAmBA,MACf,OAAOtvE,+DAAuBsvE,KAAKl5D,EAAGk5D,KAAKj5D,GAAGmM,QAAQne,IAAOA,EAAEs8F,SAGnE,iBAAiBrxB,MACbkxB,YAAYlxB,MAAM36D,SAAStQ,IACvBA,EAAEkrB,aAIV,0BAA0BqxE,QAASC,SAAW,KAC1C,IAAK,IAAI79F,EAAI,EAAGA,EAAI69F,SAAU79F,IAAK,CAC/B,MAAMssE,MAAOrsC,uDAAW29D,SAExB,GAAIx/F,KAAKo/F,YAAYlxB,OAAS,EAC1B,OAAOA,KAIf1nE,QAAQC,KAAR,+BAC4Bg5F,SAD5B,mBAEID,SAIR,gBAAgBrW,KAAMvzD,IAClB,MAAMs4C,KAAOluE,KAAK0/F,mBAAmBvW,KAAKwW,eAEtCzxB,MACAt4C,GAAGs4C,S,yhBC7BA,MAAM2wB,oBAAoBM,yDACrC,oBAAoBjxB,OAChBj2C,oDAAM6C,gEAAmBozC,KAAKl5D,EAAGk5D,KAAKj5D,GAElCi5D,KAAK4vB,OAAOI,yDACZjmE,oDAAMyB,6DAAgBw0C,KAAKl5D,EAAGk5D,KAAKj5D,GAI3C,oBAAoBk0E,MAChBA,KAAK9qE,MAAM9K,SAAS26D,OAChBluE,KAAKq/F,aAAanxB,MAEd/hE,KAAK61B,SAAW,KAIhBksC,KAAK4vB,OAAOC,yDAAoB5xF,KAAK61B,SAAW,IAChD/J,oDAAMmB,wDAAW80C,KAAKl5D,EAAGk5D,KAAKj5D,IAE9BgjB,oDAAMkB,yDAAY+0C,KAAKl5D,EAAGk5D,KAAKj5D,OAIvC,IAAK,IAAIrT,EAAI,EAAGA,GAAIqgC,sDAAU,EAAG,GAAIrgC,IACjC5B,KAAKs/F,SAASnW,MAAOjb,QACjBj2C,oDAAMqB,gEAAmB40C,KAAKl5D,EAAGk5D,KAAKj5D,MAI9C,IAAK,IAAIrT,EAAI,EAAGA,GAAIqgC,sDAAU,EAAG,GAAIrgC,IACjC5B,KAAKs/F,SAASnW,MAAOjb,QACjBj2C,oDAAMsB,kEAAqB20C,KAAKl5D,EAAGk5D,KAAKj5D,MAIhD,IAAK,IAAIrT,EAAI,EAAGA,GAAIqgC,sDAAU,EAAG,GAAIrgC,IACjC5B,KAAKs/F,SAASnW,MAAOjb,QACjBj2C,oDAAMuB,oEAAuB00C,KAAKl5D,EAAGk5D,KAAKj5D,MAIlD,IAAK,IAAIrT,EAAI,EAAGA,GAAIqgC,sDAAU,EAAG,GAAIrgC,IACjC5B,KAAKs/F,SAASnW,MAAOjb,QACjBj2C,oDAAMsD,wDAAW2yC,KAAKl5D,EAAGk5D,KAAKj5D,MAItC,IAAK,IAAIrT,EAAI,EAAGA,GAAIqgC,sDAAU,EAAG,GAAIrgC,IAAK,CACtC,GAAIuK,KAAK61B,SAAW,IAChB,OAGJhiC,KAAKs/F,SAASnW,MAAOjb,QACjBj2C,oDAAMgB,8DAAiBi1C,KAAKl5D,EAAGk5D,KAAKj5D,MAI5C,IAAK,IAAIrT,EAAI,EAAGA,GAAIqgC,sDAAU,EAAG,GAAIrgC,IAAK,CACtC,GAAIuK,KAAK61B,SAAW,IAChB,OAGJhiC,KAAKs/F,SAASnW,MAAOjb,QACjBj2C,oDAAMiB,8DAAiBg1C,KAAKl5D,EAAGk5D,KAAKj5D,MAI5C,IAAK,IAAIrT,EAAI,EAAGA,GAAIqgC,sDAAU,EAAG,GAAIrgC,IAAK,CACtC,GAAIuK,KAAK61B,SAAW,IAChB,OAGJhiC,KAAKs/F,SAASnW,MAAOjb,QACjBj2C,oDAAMe,8DAAiBk1C,KAAKl5D,EAAGk5D,KAAKj5D,U,yhBC/ErC,MAAM+pF,oBAAoBG,yDACrC,oBAAoBjxB,OAChBj2C,oDAAM8C,qEAAwBmzC,KAAKl5D,EAAGk5D,KAAKj5D,GAEvCi5D,KAAK4vB,OAAOI,yDACZjmE,oDAAM0B,yDAAYu0C,KAAKl5D,EAAGk5D,KAAKj5D,GAIvC,oBAAoBk0E,MAChBA,KAAK9qE,MAAM9K,SAAS26D,OAChBluE,KAAKq/F,aAAanxB,MAEd/hE,KAAK61B,SAAW,KAIhBksC,KAAK4vB,OAAOC,0DACZ9lE,oDAAMkB,yDAAY+0C,KAAKl5D,EAAGk5D,KAAKj5D,MAIvC,IAAK,IAAIrT,EAAI,EAAGA,GAAIqgC,sDAAU,EAAG,GAAIrgC,IACjC5B,KAAKs/F,SAASnW,MAAOjb,QACjBj2C,oDAAMqD,yDAAY4yC,KAAKl5D,EAAGk5D,KAAKj5D,MAIvC,IAAK,IAAIrT,EAAI,EAAGA,GAAIqgC,sDAAU,EAAG,GAAIrgC,IACjC5B,KAAKs/F,SAASnW,MAAOjb,QACjBj2C,oDAAMqB,gEAAmB40C,KAAKl5D,EAAGk5D,KAAKj5D,MAI9C,IAAK,IAAIrT,EAAI,EAAGA,GAAIqgC,sDAAU,EAAG,GAAIrgC,IAAK,CACtC,GAAIuK,KAAK61B,SAAW,IAChB,OAGJhiC,KAAKs/F,SAASnW,MAAOjb,QACjBj2C,oDAAMgB,8DAAiBi1C,KAAKl5D,EAAGk5D,KAAKj5D,U,whBCzBrC,MAAM8pF,mBAAmBI,yDACpC,oBAAoBjxB,OAChBj2C,oDAAM+C,gEAAmBkzC,KAAKl5D,EAAGk5D,KAAKj5D,GAEA,IAAlCjV,KAAKo/F,YAAYlxB,MAAMrsE,QACnBqsE,KAAK4vB,OAAOI,yDACZjmE,oDAAM2B,6DAAgBs0C,KAAKl5D,EAAGk5D,KAAKj5D,GAK/C,oBAAoBk0E,MAChBA,KAAK9qE,MAAM9K,SAAS26D,MAASluE,KAAKq/F,aAAanxB,QAE/Cib,KAAKiT,MAAM7oF,SAASoqF,OACsB,IAAlC39F,KAAKo/F,YAAYzB,MAAM97F,SACvBo2B,oDAAM4B,6DAAgB8jE,KAAK3oF,EAAG2oF,KAAK1oF,MAI3CjV,KAAKs/F,SAASnW,MAAOjb,OACjB,MAAM0xB,OAAQ3nE,oDAAM6B,8DAAiBo0C,KAAKl5D,EAAGk5D,KAAKj5D,GAElD2qF,MAAMx7D,UAAUE,SAAQrM,oDAAMmB,0DAC9BwmE,MAAMx7D,UAAUE,SAAQrM,oDAAMe,gEAC9B4mE,MAAMx7D,UAAUE,SAAQrM,oDAAMkB,2DAC9BymE,MAAMx7D,UAAUE,SAAQrM,oDAAMmC,4DAC9BwlE,MAAMx7D,UAAUE,SAAQrM,oDAAMoC,iEAC9BulE,MAAMx7D,UAAUE,SAAQrM,oDAAMqC,mEAC9BslE,MAAMx7D,UAAUE,SAAQrM,oDAAMsC,gEAC9BqlE,MAAMx7D,UAAUE,SAAQrM,oDAAMuC,gEAC9BolE,MAAMx7D,UAAUE,SAAQrM,oDAAMwC,gEAC9BmlE,MAAMx7D,UAAUE,SAAQrM,oDAAMyC,6DAC9BklE,MAAMx7D,UAAUE,SAAQrM,oDAAM0C,0DAC9BilE,MAAMx7D,UAAUE,SAAQrM,oDAAMgD,uEAC9B2kE,MAAMx7D,UAAUE,SAAQrM,oDAAMiD,mEAC9B0kE,MAAMx7D,UAAUE,SAAQrM,oDAAMkD,gEAC9BykE,MAAMx7D,UAAUE,SAAQrM,oDAAMmD,gEAC9BwkE,MAAMx7D,UAAUE,SAAQrM,oDAAMoD,6DAGlC,IAAK,IAAIz5B,EAAI,EAAGA,GAAIqgC,sDAAU,EAAG,GAAIrgC,IACjC5B,KAAKs/F,SAASnW,MAAOjb,QACjBj2C,oDAAMwB,kEAAqBy0C,KAAKl5D,EAAGk5D,KAAKj5D,S,yhBCjDzC,MAAMgqF,oBAAoBE,yDACrC,oBAAoBjxB,OAChBj2C,oDAAM4C,+DAAkBqzC,KAAKl5D,EAAGk5D,KAAKj5D,GAEjCi5D,KAAK4vB,OAAOI,yDACZjmE,oDAAM0B,yDAAYu0C,KAAKl5D,EAAGk5D,KAAKj5D,GAIvC,oBAAoBk0E,MAChBA,KAAK9qE,MAAM9K,SAAS26D,OAChBluE,KAAKq/F,aAAanxB,MAEdA,KAAK4vB,OAAOC,2DACR57D,+DAAmB,OACnBlK,oDAAMuD,+DAAkB0yC,KAAKl5D,EAAGk5D,KAAKj5D,IAGrCktB,+DAAmB,OACnBlK,oDAAMqD,yDAAY4yC,KAAKl5D,EAAGk5D,KAAKj5D,OAK3C,IAAK,IAAIrT,EAAI,EAAGA,GAAIqgC,sDAAU,EAAG,GAAIrgC,IAAK,CACtC,GAAIuK,KAAK61B,SAAW,IAChB,OAGJhiC,KAAKs/F,SAASnW,MAAOjb,QACjBj2C,oDAAMgB,8DAAiBi1C,KAAKl5D,EAAGk5D,KAAKj5D,U,yhBC9C7C,MAAMgoF,sBAAsB4C,iDAC/B,gBAAgB7/D,UACZ,MAAMziB,MAAQyiB,SAASziB,MACjBC,OAASwiB,SAASxiB,OAClB4+E,MAAQp8D,SAASo8D,OAAS,GAC1B/9E,MAAQ,IAAIyhF,oDAAcviF,MAAOC,QAEjC++E,UAAY,IAAIwD,gDAAqBxiF,MAAOC,OAAQ,CACtD6qE,UAAW,IACXH,UAAWloD,SAASkoD,WAAa,CAAC,EAAG,GACrCC,WAAYnoD,SAASmoD,YAAc,CAAC,EAAG,GACvCC,kBAAmBpoD,SAASggE,eAAiB,KA2BjD,OAxBAzD,UAAUnqF,QAAO,CAAC4C,EAAGC,EAAGwX,KACV,IAANA,GACApO,MAAM4/E,YAAYjpF,EAAGC,EAAG8oF,wDAGlB,IAANtxE,GACApO,MAAM4/E,YAAYjpF,EAAGC,EAAGipF,0DAIhC3B,UAAUjR,WAAW/3E,SAAS2Q,IAC1B,MAAMilE,KAAO9qE,MAAM4hF,WACf/7E,EAAEomE,UACFpmE,EAAEsmE,SACFtmE,EAAEqmE,WAAarmE,EAAEomE,UAAY,EAC7BpmE,EAAEumE,YAAcvmE,EAAEsmE,SAAW,GAEjCtmE,EAAE8nE,UAAS,CAACh3E,EAAGC,KACXk0E,KAAKmV,QAAQtpF,EAAGC,UAIxBwoF,2DAASp/E,MAAO+9E,OAET/9E,S,6iCCxCA,MAAMyhF,cAKjB,YACI,OAAO,sBAAA9/F,KAAA,OAAWud,MAGtB,aACI,OAAO,sBAAAvd,KAAA,OAAWwd,OAGtB,WACI,OAAOxd,KAAKud,MAAQvd,KAAKwd,OAG7B,WACI,OAAO,sBAAAxd,KAAA,OAAW8S,KAGtB,YACI,OAAO5B,OAAO2T,OAAP,sBAAc7kB,KAAd,SAGXyY,YAAY8E,MAAOC,OAAQ0iF,YAAcnC,wDAAiB,yCAxB3CA,yDAwB2C,kCAvBlD,KAuBkD,mCAtBjD,KAuBL,sBAAA/9F,KAAA,MAAa,IAAIggB,iDAAKzC,MAAOC,OAAQkhF,wDACrC,sBAAA1+F,KAAA,aAAoBkgG,aACpBlgG,KAAKuf,QAGT4gF,QAAQnrF,EAAGC,GACP,OAAO,sBAAAjV,KAAA,OAAWsiB,IAAItN,EAAGC,GAG7BgpF,YAAYjpF,EAAGC,EAAGoD,MACd,sBAAArY,KAAA,OAAWsiB,IAAItN,EAAGC,GAAGoD,KAAOA,KAGhC+nF,aAAaprF,EAAGC,EAAGioF,OACf,sBAAAl9F,KAAA,OAAWsiB,IAAItN,EAAGC,GAAGioF,MAAQA,MAGjCmD,YAAYrrF,EAAGC,GACX,OAAOjV,KAAKmgG,QAAQnrF,EAAGC,GAAGoD,KAG9BioF,QAAQnX,MACJ,sBAAAnpF,KAAA,QAAYmpF,KAAKx9E,IAAMw9E,KAG3B8W,WAAWjrF,EAAGC,EAAGsI,MAAOC,QACpB,MAAM2rE,KAAO,IAAIoX,+CAASvrF,EAAGC,EAAGsI,MAAOC,OAAQxd,MAI/C,OAFAA,KAAKsgG,QAAQnX,MAENA,KAGX5pE,QACIvf,KAAK+sE,KAAK,EAAG,EAAG/sE,KAAKud,MAAOvd,KAAKwd,OAAjC,sBAAyCxd,KAAzC,eAGJ+sE,KAAK/3D,EAAGC,EAAGsI,MAAOC,OAAQnF,MACtB,IAAK,IAAIzW,EAAIoT,EAAGpT,EAAIoT,EAAIuI,MAAO3b,IAC3B,IAAK,IAAIK,EAAIgT,EAAGhT,EAAIgT,EAAIuI,OAAQvb,IAC5BjC,KAAKi+F,YAAYr8F,EAAGK,EAAGoW,MAKnC+lF,gBAAgBppF,EAAGC,EAAGoD,MAClB,OAAOrY,KAAKmgG,QAAQnrF,EAAGC,GAAG6oF,OAAOzlF,MAGrCmoF,aAAav/E,QAASoH,QAAShK,OAC3BA,MAAMwrE,MAAMt2E,SAAS41E,OACjBA,KAAKsX,QAAQtX,KAAKn0E,EAAIiM,QAASkoE,KAAKl0E,EAAIoT,QAASroB,SAErDqe,MAAMvL,KAAKS,SAAS26D,OAChBluE,KAAKi+F,YAAY/vB,KAAKl5D,EAAIiM,QAASitD,KAAKj5D,EAAIoT,QAAS6lD,KAAK71D,MAC1DrY,KAAKogG,aAAalyB,KAAKl5D,EAAIiM,QAASitD,KAAKj5D,EAAIoT,QAAS6lD,KAAKgvB,UAInEiB,SAASnpF,EAAGC,GACR,OACU,IAAND,GAAiB,IAANC,GAAWD,IAAMhV,KAAKud,MAAQ,GAAKtI,IAAMjV,KAAKwd,OAAS,EAI1EkjF,SAASxD,OACLl9F,KAAK8S,KAAKS,SAAS26D,MAASluE,KAAKogG,aAAalyB,KAAKl5D,EAAGk5D,KAAKj5D,EAAGioF,SAC9Dl9F,KAAK6pF,MAAMt2E,SAAS41E,MAAUA,KAAK+T,MAAQA,QAG/CmB,eAAerpF,EAAGC,GACd,MAAMi5D,KAAOluE,KAAKmgG,QAAQnrF,EAAGC,GAE7B,OAAOjV,KAAK6pF,MAAM7kD,MAAMmkD,MACbA,KAAK9qE,MAAMq4B,SAASw3B,QAInCsvB,qBACI,OAAOx9F,KAAK8S,KAAKsO,QAAQ8sD,OACbluE,KAAKq+F,eAAenwB,KAAKl5D,EAAGk5D,KAAKj5D,KAIjDsN,aAAavN,EAAGC,GACZ,OAAO,sBAAAjV,KAAA,OAAWuiB,aAAavN,EAAGC,M,80BC/G3B,MAAMsrF,SAWjB,oBACI,6BAAOvgG,KAAP,aAGJ,YACI,OAAOA,KAAK2gG,cAAc7gG,KAAK69F,OAAD,CAC1B3oF,EAAG2oF,KAAK3oF,EAAIhV,KAAKgV,EACjBC,EAAG0oF,KAAK1oF,EAAIjV,KAAKiV,MAIzB,WACI,OAAOjV,KAAKs9F,aAAet9F,KAAKgV,EAAI,EAAIhV,KAAKgV,EAGjD,YACI,OAAOhV,KAAKs9F,aACNt9F,KAAKgV,EAAIhV,KAAKud,MAAQ,EACtBvd,KAAKgV,EAAIhV,KAAKud,MAGxB,UACI,OAAOvd,KAAKs9F,aAAet9F,KAAKiV,EAAI,EAAIjV,KAAKiV,EAGjD,aACI,OAAOjV,KAAKs9F,aACNt9F,KAAKiV,EAAIjV,KAAKwd,OAAS,EACvBxd,KAAKiV,EAAIjV,KAAKwd,OAGxB,kBACI,MAAM1e,MAAQkB,KAAKs9F,cAAgB,EAAI,EACjCsD,SAAW5gG,KAAKs9F,aAAet9F,KAAKud,MAAQ,EAAIvd,KAAKud,MACrDsjF,UAAY7gG,KAAKs9F,aAAet9F,KAAKwd,OAAS,EAAIxd,KAAKwd,OACvDsjF,QAAU,GAGhB,IAAK,IAAIl/F,EAAI9C,MAAO8C,EAAIg/F,SAAUh/F,IAC9B,IAAK,IAAIK,EAAInD,MAAOmD,EAAI4+F,UAAW5+F,IAE3BL,IAAM9C,OACN8C,IAAMg/F,SAAW,GACjB3+F,IAAMnD,OACNmD,IAAM4+F,UAAY,GAElBC,QAAQn6F,KACJ,sBAAA3G,KAAA,YAAgBmgG,QAAQv+F,EAAI5B,KAAKgV,EAAG/S,EAAIjC,KAAKiV,IAM7D,OAAO6rF,QAGX,oBACI,MAAMC,SAAW,GAEjB,IAAK,IAAIn/F,EAAI,EAAGA,EAAI5B,KAAKud,MAAO3b,IAC5B,IAAK,IAAIK,EAAI,EAAGA,EAAIjC,KAAKwd,OAAQvb,IAC7B8+F,SAASp6F,KAAK,sBAAA3G,KAAA,YAAgBmgG,QAAQv+F,EAAI5B,KAAKgV,EAAG/S,EAAIjC,KAAKiV,IAInE,OAAO8rF,SAGX,YACI,MAAMjiG,MAAQkB,KAAKs9F,cAAgB,EAAI,EACjCsD,SAAW5gG,KAAKs9F,aAAet9F,KAAKud,MAAQ,EAAIvd,KAAKud,MACrDsjF,UAAY7gG,KAAKs9F,aAAet9F,KAAKwd,OAAS,EAAIxd,KAAKwd,OACvDa,MAAQ,GAEd,IAAK,IAAIzc,EAAI9C,MAAO8C,EAAIg/F,SAAUh/F,IAC9B,IAAK,IAAIK,EAAInD,MAAOmD,EAAI4+F,UAAW5+F,IAC/Boc,MAAM1X,KAAK,sBAAA3G,KAAA,YAAgBmgG,QAAQv+F,EAAI5B,KAAKgV,EAAG/S,EAAIjC,KAAKiV,IAIhE,OAAOoJ,MAGX5F,YAAYzD,EAAGC,EAAGsI,MAAOC,OAAQ4J,WAAW,0BA7FvC,GA6FuC,yBA5FxC,GA4FwC,yBA3FxC,GA2FwC,6BA1FpC,GA0FoC,8BAzFnC,GAyFmC,6BAxFpC+1E,kEAwFoC,qCAvF7B,GAuF6B,uCAtF/B,OAsF+B,wCArF9B,KAsFVn9F,KAAK2L,IAAK8qB,gDACVz2B,KAAKgV,EAAIA,EACThV,KAAKiV,EAAIA,EACTjV,KAAKud,MAAQA,MACbvd,KAAKwd,OAASA,O,4UACd,CAAAxd,KAAA,WAAkBonB,WAGtB45E,gBAAgBhsF,EAAGC,GACf,sBAAAjV,KAAA,YAAgBi+F,YAAYj+F,KAAKgV,EAAIA,EAAGhV,KAAKiV,EAAIA,EAAG8oF,wDACpD,sBAAA/9F,KAAA,aAAiB2G,KAAK,CAAEqO,EAAGC,IAG/BqpF,QAAQtpF,EAAGC,GACPjV,KAAKghG,gBAAgBhsF,EAAIhV,KAAKgV,EAAGC,EAAIjV,KAAKiV,GAG9CwrF,QAAQzrF,EAAGC,EAAGmS,WACV,MAAM+hE,KAAO,IAAIoX,SAASvrF,EAAGC,EAAGjV,KAAKud,MAAOvd,KAAKwd,OAAQ4J,WAWzD,OATA+hE,KAAK+T,MAAQl9F,KAAKk9F,MAClB/T,KAAKmU,aAAet9F,KAAKs9F,aAEzBt9F,KAAK2gG,cAAcptF,SAASoqF,OACxBxU,KAAK6X,gBAAgBrD,KAAK3oF,EAAG2oF,KAAK1oF,MAGtCmS,UAAUk5E,QAAQnX,MAEXA,KAGX8X,cAAcjsF,EAAGC,GACb,OACID,GAAKhV,KAAK+e,OACV/J,GAAKhV,KAAK8e,MACV7J,GAAKjV,KAAKkhE,QACVjsD,GAAKjV,KAAKm+D,IAIlB+iC,WAAWpiF,KAAMq/C,IAAKp/C,MAAOmiD,QACzB,MAAMigC,GAAKriF,KAAO9e,KAAK+e,MACjBqiF,GAAKriF,MAAQ/e,KAAK8e,KAClBuiF,GAAKljC,IAAMn+D,KAAKkhE,OAChBogC,GAAKpgC,OAASlhE,KAAKm+D,IAEzB,OAAOgjC,IAAMC,IAAMC,IAAMC,M,0bChHjC,IAAIt/D,OAASu/D,OAASC,OAAOC,gBAAgB,IAAIxuF,WAAWsuF,QAExDG,aAAe,CAACC,SAAU5/E,KAAM6/E,aAMlC,IAAIx7C,MAAQ,GAAMj6C,KAAKoxB,IAAIokE,SAAS9/F,OAAS,GAAKsK,KAAK01F,KAAQ,EAgB3DC,QAAW,IAAM17C,KAAOrkC,KAAQ4/E,SAAS9/F,QAE7C,MAAO,KACL,IAAI8J,GAAK,GACT,OAAa,CACX,IAAI41F,MAAQK,UAAUE,MAElB7/F,EAAI6/F,KACR,KAAO7/F,KAIL,GAFA0J,IAAMg2F,SAASJ,MAAMt/F,GAAKmkD,OAAS,GAE/Bz6C,GAAG9J,UAAYkgB,KAAM,OAAOpW,MAMpCo2F,eAAiB,CAACJ,SAAU5/E,OAAS2/E,aAAaC,SAAU5/E,KAAMigB,QAElEvL,OAAS,CAAC1U,KAAO,MACnB,IAAIpW,GAAK,GACL41F,MAAQC,OAAOC,gBAAgB,IAAIxuF,WAAW8O,OAGlD,KAAOA,QAAQ,CAMb,IAAIigF,KAAqB,GAAdT,MAAMx/E,MAGfpW,IAFEq2F,KAAO,GAEHA,KAAKztB,SAAS,IACXytB,KAAO,IAETA,KAAO,IAAIztB,SAAS,IAAIp2B,cACtB6jD,KAAO,GACV,IAEA,IAGV,OAAOr2F,K,iNCpGT,IAAIs2F,YACF,oE,gMCHa,MAAMpC,WACjB,mBAEA,sB,qSCAW,MAAM7C,cACjB,gBAAgBh9D,UACZ,OAAO,IAAI8/D,oDAAc9/D,SAASziB,MAAOyiB,SAASxiB,QAGtD,gBAAgBwiB,SAAU3hB,W,mfCHvB,MAAMq+E,wBAAwBM,oDACjC,gBAAgBh9D,UACZ,MAAM3hB,MAAQ4+E,2EAAuB,CACjC1/E,MAAOyiB,SAASziB,MAChBC,OAAQwiB,SAASxiB,OACjB4+E,MAAOp8D,SAASo8D,QAOpB,OAJA/9E,MAAMqiF,SAASvD,mEAEfM,2DAASp/E,MAAO2hB,SAASo8D,OAElB/9E,S,6pBCVR,MAAMs+E,kCAAkCK,oDAC3C,gBAAgBh9D,UACZ,MAAM3hB,MAAQ,IAAIyhF,oDAAc9/D,SAASziB,MAAOyiB,SAASxiB,QAEnD0kF,WAAa/1F,KAAKwG,KAAKuoF,KAAe,EAEtC/8B,IAAM8+B,2EAAuB,CAC/B1/E,MAAOyiB,SAASziB,MAJJ,EAKZC,OALY,EAMZ4+E,MAAO,CACH,CAAEpnF,EAAGktF,WAAYjtF,EAAGimF,GACpB,CAAElmF,EAAGgrB,SAASziB,MARN,EAQwB,EAAGtI,EAAGitF,WAAa,GACnD,CAAEltF,EAAGkmF,GAAcjmF,EAAGimF,MAIxBp8E,KAAOm+E,2EAAuB,CAChC1/E,MAdY,EAeZC,OAAQwiB,SAASxiB,OAfL,EAgBZ4+E,MAAO,CACH,CAAEpnF,EAAGktF,WAAYjtF,EAAG,GACpB,CACID,EAAGkmF,EACHjmF,EAAG+qB,SAASxiB,OApBR,EAoB2B0kF,WAAa,MAKlDhhC,OAAS+7B,2EAAuB,CAClC1/E,MAAOyiB,SAASziB,MA1BJ,EA2BZC,OA3BY,EA4BZ4+E,MAAO,CACH,CAAEpnF,EAAG,EAAGC,EAAGitF,YACX,CAAEltF,EAAGgrB,SAASziB,MA9BN,EA8BwB2kF,WAAa,EAAGjtF,EAAG,MAIrD8J,MAAQk+E,2EAAuB,CACjC1/E,MAnCY,EAoCZC,OAAQwiB,SAASxiB,OApCL,EAqCZ4+E,MAAO,CACH,CAAEpnF,EAAG,EAAGC,EAAGitF,WAAa,GACxB,CAAEltF,EAAGktF,WAAYjtF,EAAG+qB,SAASxiB,OAvCrB,EAuCwC,MAIlD2kF,OAASC,mFAA2B,CACtC7kF,MAAOyiB,SAASziB,MAAQ29E,GAAc,EACtC19E,OAAQwiB,SAASxiB,OAAS09E,GAAc,EACxCkB,MAAO,CAAC,CAAEpnF,EAAG,GAAIC,EAAG,MAiBxB,OAdAkpD,IAAIuiC,SAASvD,kEACbr+E,KAAK4hF,SAASvD,kEACdj8B,OAAOw/B,SAASvD,kEAChBp+E,MAAM2hF,SAASvD,kEACfgF,OAAOzB,SAASjC,kEAEhBpgF,MAAMmiF,aAAa,EAAG,EAAGriC,KACzB9/C,MAAMmiF,aAAa,EAxDH,EAwDe1hF,MAC/BT,MAAMmiF,aAzDU,EAyDYxgE,SAASxiB,OAzDrB,EAyDuC0jD,QACvD7iD,MAAMmiF,aAAaxgE,SAASziB,MA1DZ,EA0D6B,EAAGwB,OAChDV,MAAMmiF,aAAatF,EAAaA,EAAaiH,SAE7C1E,2DAASp/E,MAAO2hB,SAASo8D,OAElB/9E,S,orBC9Df,IAAIgkF,MAAQ,EACZ,MAAMC,aAAe,IAAMD,QAErBE,kBAAoB,CAAC31F,KAAM41F,OAC7B,MAAMC,OAASH,eACTI,QAAUJ,eAqBhB,MAAO,CApBM,CACT32F,GAAI82F,OACJE,QAAQ,EACRC,SAAUh2F,KAAKjB,GACfk3F,UAAWH,QACXzhF,QAASrU,KAAKqU,QACdoH,QAASzb,KAAKyb,QACd9K,MAAOilF,IACPhlF,OAAQ5Q,KAAK4Q,QAEH,CACV7R,GAAI+2F,QACJC,QAAQ,EACRC,SAAUh2F,KAAKjB,GACfk3F,UAAWJ,OACXxhF,QAASrU,KAAKqU,QAAUuhF,IACxBn6E,QAASzb,KAAKyb,QACd9K,MAAO3Q,KAAK2Q,MAAQilF,IACpBhlF,OAAQ5Q,KAAK4Q,UAKfslF,oBAAsB,CAACl2F,KAAM41F,OAC/B,MAAMO,MAAQT,eACRU,SAAWV,eAsBjB,MAAO,CArBK,CACR32F,GAAIo3F,MACJJ,QAAQ,EACRC,SAAUh2F,KAAKjB,GACfk3F,UAAWG,SACX/hF,QAASrU,KAAKqU,QACdoH,QAASzb,KAAKyb,QACd9K,MAAO3Q,KAAK2Q,MACZC,OAAQglF,KAEG,CACX72F,GAAIq3F,SACJL,QAAQ,EACRC,SAAUh2F,KAAKjB,GACfk3F,UAAWE,MACX9hF,QAASrU,KAAKqU,QACdoH,QAASzb,KAAKyb,QAAUm6E,IACxBjlF,MAAO3Q,KAAK2Q,MACZC,OAAQ5Q,KAAK4Q,OAASglF,OAMvB,MAAMJ,0BAA0BvC,iDACnC,gBAAgB7/D,UACZ,MAAMziB,MAAQyiB,SAASziB,MACjBC,OAASwiB,SAASxiB,OAClB4+E,MAAQp8D,SAASo8D,OAAS,GAE1B6G,aAAejjE,SAASijE,cAAgB,EACxCC,cAAgBljE,SAASkjE,eAAiB,EAE1CC,aAAenjE,SAASmjE,cAAgB,GACxCC,cAAgBpjE,SAASojE,eAAiB,GAE1CC,kBAAoBrjE,SAASqjE,mBAAqB,GAElDC,UAAYtjE,SAASsjE,WAAa,GAElCjlF,MAAQ,IAAIyhF,oDAAcviF,MAAOC,QAEvC,IAAK,IAAI5b,EAAI,EAAGA,EAAI2b,MAAO3b,IACvB,IAAK,IAAIK,EAAI,EAAGA,EAAIub,OAAQvb,IACd,IAANL,GAAWA,IAAM2b,MAAQ,GAAW,IAANtb,GAAWA,IAAMub,OAAS,EACxDa,MAAM4/E,YAAYr8F,EAAGK,EAAGi8F,uDAExB7/E,MAAM4/E,YAAYr8F,EAAGK,EAAG87F,wDAKpC,MAAMwF,MAAQ,CACV,CACIZ,QAAQ,EACRC,SAAU,KACVC,UAAW,KACXl3F,GAAI22F,eACJrhF,QAAS,EACToH,QAAS,EACT7K,OAAQA,OAAS,EACjBD,MAAOA,MAAQ,IAIjBimF,MAAQ,GAEd,KAAOD,MAAM1hG,OAAS,GAAG,CACrB,MAAM+K,KAAO22F,MAAMn9F,MAGnB,GAFAo9F,MAAM78F,KAAKiG,MAEPA,KAAK2Q,MAAQ4lF,cAAgBv2F,KAAK4Q,OAAS4lF,cAAe,CAG1D,GAFoBj3F,KAAK61B,SAAWqhE,kBAGhC,SAIR,MAAMpyD,WAAa,GAUnB,GARIrkC,KAAK2Q,MAAQ0lF,aAAe,EAAIA,cAChChyD,WAAWtqC,KArHV,GAwHDiG,KAAK4Q,OAAS0lF,cAAgB,EAAIA,eAClCjyD,WAAWtqC,KAxHR,GA2HHsqC,WAAWpvC,QAAU,EACrB,SAKJ,GAlIK,KAgIaggC,uDAAWoP,YAED,CACxB,MAAMuxD,KAAMvgE,sDACRghE,aAAe,EACfr2F,KAAK2Q,MAAQ0lF,aAAe,GAGhCM,MAAM58F,QAAQ47F,kBAAkB31F,KAAM41F,UACnC,CACH,MAAMA,KAAMvgE,sDACRihE,cAAgB,EAChBt2F,KAAK4Q,OAAS0lF,cAAgB,GAGlCK,MAAM58F,QAAQm8F,oBAAoBl2F,KAAM41F,MAG5C51F,KAAK+1F,QAAS,EAGlBa,MAAMjwF,SAAS3G,OACX,GAAsB,OAAlBA,KAAKg2F,SAIT,GAAIh2F,KAAK+1F,OAAT,CACiBtkF,MAAM4hF,WACfrzF,KAAKqU,QAAU,EACfrU,KAAKyb,QAAU,EACfzb,KAAK2Q,MAAQ,EACb3Q,KAAK4Q,OAAS,GAGb8/E,cAAe,EAEpB,IAAK,IAAI17F,EAAI,EAAGA,EAAIgL,KAAK2Q,MAAO3b,IAC5Byc,MAAM4/E,YACFrxF,KAAKqU,QAAUrf,EACfgL,KAAKyb,QACL61E,uDAIR,IAAK,IAAIj8F,EAAI,EAAGA,EAAI2K,KAAK4Q,OAAQvb,IAC7Boc,MAAM4/E,YACFrxF,KAAKqU,QACLrU,KAAKyb,QAAUpmB,EACfi8F,gEAOhBsF,MAAMjwF,SAAS3G,OACX,GAAsB,OAAlBA,KAAKg2F,SACL,OAGJ,MAAMa,QAAUD,MAAMx+D,MAAMiZ,GAAMA,EAAEtyC,KAAOiB,KAAKi2F,YAEhD,IAAIa,eAAiB,GACjBC,QAAS,EAEb,GAAIF,QAAQxiF,QAAUrU,KAAKqU,QAAS,CAChC0iF,QAAS,EACT,IAAK,IAAI/hG,EAAI,EAAGA,EAAIgL,KAAK4Q,OAAQ5b,IAAK,CAClC,MAAMoT,EAAIpI,KAAKqU,QACThM,EAAIrI,KAAKyb,QAAUzmB,EACnBssE,KAAO7vD,MAAM8hF,QAAQnrF,EAAGC,GAG1BoJ,MAAM+/E,gBAAgBppF,EAAI,EAAGC,EAAG8oF,yDAChC1/E,MAAM+/E,gBAAgBppF,EAAI,EAAGC,EAAG8oF,yDAEhC2F,eAAe/8F,KAAKunE,YAGzB,GAAIu1B,QAAQp7E,QAAUzb,KAAKyb,QAAS,CACvCs7E,QAAS,EACT,IAAK,IAAI/hG,EAAI,EAAGA,EAAIgL,KAAK2Q,MAAO3b,IAAK,CACjC,MAAMoT,EAAIpI,KAAKqU,QAAUrf,EACnBqT,EAAIrI,KAAKyb,QACT6lD,KAAO7vD,MAAM8hF,QAAQnrF,EAAGC,GAG1BoJ,MAAM+/E,gBAAgBppF,EAAGC,EAAI,EAAG8oF,yDAChC1/E,MAAM+/E,gBAAgBppF,EAAGC,EAAI,EAAG8oF,yDAEhC2F,eAAe/8F,KAAKunE,OAKhC,MAAMr+B,MAAOhO,uDAAW6hE,gBAWxB,GATIC,SAAW9zD,MACXrpC,QAAQC,KACJ,qBACAmG,KACAA,KAAK2Q,MACL3Q,KAAK4Q,QAITqyB,KAAM,CACN,MAAMs5C,KAAO9qE,MAAMggF,eAAexuD,KAAK76B,EAAG66B,KAAK56B,GAE3Ck0E,MACAA,KAAKmV,QAAQzuD,KAAK76B,EAAG66B,KAAK56B,GAG9BoJ,MAAM4/E,YAAYpuD,KAAK76B,EAAG66B,KAAK56B,EAAG8oF,4DAI1C,MAAM3+D,KAAO,CAAC/a,EAAGD,IACT/F,MAAM+/E,gBAAgBh6E,EAAEpP,EAAGoP,EAAEnP,EAAG8oF,yDACzB1+D,yEAAiBhb,EAAGD,GAGxBlX,IAGL02F,WAAa,CAACv/E,EAAGD,KACnB,GAAIC,EAAEy5E,OAAOC,yDAAoB35E,EAAE05E,OAAOC,wDAAkB,CACxD,MAAMj/F,MAAQ,CACVkW,EAAGoP,EAAEpP,EACLC,EAAGmP,EAAEnP,GAEHqpB,KAAO,CACTtpB,EAAGqP,EAAErP,EACLC,EAAGoP,EAAEpP,GAEHuqB,MAAOL,0DAAa,CACtBrgC,MACAw/B,KACAc,OAGJ,GAAII,KAAKxrB,SAAWwrB,KAAKJ,MAAQkkE,UAC7B,OAAO,EAIf,OAAO,GAuCX,OApCAjlF,MAAMvL,KACDsO,QAAQ8sD,MAASA,KAAK4vB,OAAOI,yDAC7B3qF,SAAS26D,OACN,MAAM21B,MAAQxlF,MAAM8hF,QAAQjyB,KAAKl5D,EAAGk5D,KAAKj5D,EAAI,GACvC6uF,MAAQzlF,MAAM8hF,QAAQjyB,KAAKl5D,EAAGk5D,KAAKj5D,EAAI,GAE7C,GAAI2uF,WAAWC,MAAOC,OAAQ,CAC1BzlF,MAAM4/E,YAAY/vB,KAAKl5D,EAAGk5D,KAAKj5D,EAAG8oF,wDAElC,MAAM5U,KAAO9qE,MAAMggF,eAAenwB,KAAKl5D,EAAGk5D,KAAKj5D,GAM/C,YAJIk0E,MACAA,KAAKmV,QAAQpwB,KAAKl5D,EAAGk5D,KAAKj5D,IAMlC,MAAM8uF,KAAO1lF,MAAM8hF,QAAQjyB,KAAKl5D,EAAI,EAAGk5D,KAAKj5D,GACtC+uF,KAAO3lF,MAAM8hF,QAAQjyB,KAAKl5D,EAAI,EAAGk5D,KAAKj5D,GAE5C,GAAI2uF,WAAWG,KAAMC,MAArB,CACI3lF,MAAM4/E,YAAY/vB,KAAKl5D,EAAGk5D,KAAKj5D,EAAG8oF,wDAElC,MAAM5U,KAAO9qE,MAAMggF,eAAenwB,KAAKl5D,EAAGk5D,KAAKj5D,GAE3Ck0E,MACAA,KAAKmV,QAAQpwB,KAAKl5D,EAAGk5D,KAAKj5D,aAO1CwoF,2DAASp/E,MAAO+9E,OAET/9E,S,yjCCvSR,MAAMw+E,4BAA4BG,qDACrC,gBAAgBh9D,UACZ,MAAM3hB,MAAQ4lF,+EAAyB,CACnC1mF,MAAOyiB,SAASziB,MAChBC,OAAQwiB,SAASxiB,OACjB4+E,MAAOp8D,SAASo8D,MAChB8H,SAAU,IAGd7lF,MAAMqiF,SAASrD,iEA8Bf,OAVAh/E,MAAMwrE,MAAMt2E,SAlBK41E,OACb,MAAMgb,MAAQhb,KAAKib,YAAYhjF,QAC1BtE,KArBO,EAACA,EAAGqsE,OAASrsE,EAAE9H,IAAMm0E,KAAKrqE,MAAQhC,EAAE7H,IAAMk0E,KAAKhrB,IAuB/CkmC,CAAgBvnF,EAAGqsE,OAtBhB,EAACrsE,EAAGqsE,OAC3BrsE,EAAE9H,IAAMm0E,KAAKrqE,MAAQhC,EAAE7H,IAAMk0E,KAAKjoB,OAAS,EAsBvBojC,CAAmBxnF,EAAGqsE,OArBlB,EAACrsE,EAAGqsE,OAC5BrsE,EAAE9H,IAAMm0E,KAAKpqE,MAAQ,GAAKjC,EAAE7H,IAAMk0E,KAAKjoB,OAAS,EAqB5BqjC,CAAoBznF,EAAGqsE,OApBtB,EAACrsE,EAAGqsE,OACzBrsE,EAAE9H,IAAMm0E,KAAKpqE,MAAQ,GAAKjC,EAAE7H,IAAMk0E,KAAKhrB,IAoBnBqmC,CAAiB1nF,EAAGqsE,SAI1Bt5C,MAAOhO,uDAAWsiE,OAEpBt0D,MACAs5C,KAAKmV,QAAQzuD,KAAK76B,EAAG66B,KAAK56B,MAMlCoJ,MAAMm/E,qBAAqBjqF,SAAS26D,OAChCA,KAAKgvB,MAAQC,qEAGjBsH,2DAAUpmF,QAEVo/E,2DAASp/E,MAAO2hB,SAASo8D,OAElB/9E,MAGX,gBAAgB2hB,SAAU3hB,OACtBA,MAAMwrE,MAAMt2E,SAAS41E,QACH+V,oEAAkB/V,KAAK+T,OAE/BwH,aAAavb,SAGvB,MAAMwb,MAAQtmF,MAAMwrE,MAAM/pF,KAAKqpF,MAASA,KAAKiT,QAAO3gD,OAC9CmpD,SAAW,IAAIrwE,IAoBfswE,aAAe,CAAC/lG,MAAOiQ,OACzB,MAAMywB,MAAOL,0DAAa,CACtBU,gBAAgB,EAChB/gC,MAAO,CACHkW,EAAGlW,MAAMkW,EACTC,EAAGnW,MAAMmW,GAEbqpB,KAAM,CACFtpB,EAAGjG,IAAIiG,EACPC,EAAGlG,IAAIkG,GAEXmqB,KAAM,CAAC/a,EAAGD,KACN,GAAI/F,MAAM+/E,gBAAgBh6E,EAAEpP,EAAGoP,EAAEnP,EAAGipF,wDAChC,OAAOhxF,IAGX,MACMikF,MADY9yE,MAAMkE,aAAa6B,EAAEpP,EAAGoP,EAAEnP,GACpBmM,QAAQ68B,GAC5BA,EAAE6/C,OAAOI,0DAGb,OAAI/M,MAAMtvF,OAAS,EACO,EAAfsvF,MAAMtvF,OAGb+iG,SAAS5xE,IAAT,UAAgB5O,EAAEpP,EAAlB,YAAuBoP,EAAEnP,IAClB,GAGsB,GAA1BirB,2EAAkB7b,EAAGD,MA/ClB8a,mBAmDLM,MAlDDxrB,SAIZkrB,OAAOM,KAAKjsB,SAASksB,UACA7gC,+DAAuB6gC,QAAQzqB,EAAGyqB,QAAQxqB,GAE9CpT,OAAS,KAItBo2B,oDAAM+B,6DAAgByF,QAAQzqB,EAAGyqB,QAAQxqB,GAEzC2vF,SAASzxE,IAAT,UAAgBsM,QAAQzqB,EAAxB,YAA6ByqB,QAAQxqB,SAwC7C0vF,MAAMpxF,SAASuxF,QACX9kE,SAASo8D,MAAM7oF,SAASoqF,OACpBkH,aAAaC,MAAOnH,SAExBgH,MAAMpxF,SAASwxF,QACPD,QAAUC,OAIdF,aAAaC,MAAOC,aAI5B1mF,MAAMm/E,qBAAqBjqF,SAAS26D,QAClBgxB,oEAAkBhxB,KAAKgvB,OAE/BmC,aAAanxB,Y,iiBC9IxB,MAAM+1B,wBAAwBpE,iDACjC,gBAAgB7/D,UACZ,MAAMglE,QAAUhlE,SAASglE,SAAW,EAC9BC,YAAcjlE,SAASilE,aAAe,IACtC1nF,MAAQyiB,SAASziB,MACjBC,OAASwiB,SAASxiB,OAClB09E,QAAUl7D,SAASk7D,SAAW,EAC9BgK,YAAcllE,SAASklE,aAAe,EACtChB,SAAWlkE,SAASkkE,UAAY,EAChCiB,SAAWnlE,SAASmlE,UAAY,EAChCC,SAAWplE,SAASolE,UAAY,EAChCz6B,SAAW3qC,SAAS2qC,UAAY,EAChC06B,UAAYrlE,SAASqlE,WAAa,EAClCC,UAAYtlE,SAASslE,WAAa,EAClClJ,MAAQp8D,SAASo8D,OAAS,GAC1B/9E,MAAQ,IAAIyhF,oDAAcviF,MAAOC,QAEvC,GAAIwnF,QAAUC,YAKV,OAJAz+F,QAAQC,KAAR,gDAC6Cw+F,YAD7C,cAIO5mF,MAGX,MAAMknF,UAAY,KACd,MAAMhoF,OAAQ0kB,sDAAUmjE,SAAUz6B,UAC5BntD,QAASykB,sDAAUojE,UAAWC,WAEpC,MAAO,CACHtwF,GAAGitB,sDAAUi5D,QAASl7D,SAASziB,MAAQ29E,QAAU39E,OACjDtI,GAAGgtB,sDAAUi5D,QAASl7D,SAASxiB,OAAS09E,QAAU19E,QAClDD,MACAC,OACA,UACI,OAAOxd,KAAKiV,EAAIiwF,aAEpB,aACI,OAAOllG,KAAKiV,EAAIjV,KAAKwd,OAAS0nF,aAElC,WACI,OAAOllG,KAAKgV,EAAIkwF,aAEpB,YACI,OAAOllG,KAAKgV,EAAIhV,KAAKud,MAAQ2nF,eAKnCM,SAAYC,KACPpnF,MAAMwrE,MAAMz0D,MAAM+zD,MACdA,KAAK+X,WACRuE,IAAI3mF,KACJ2mF,IAAItnC,IACJsnC,IAAI1mF,MACJ0mF,IAAIvkC,UAKhB,IAAK,IAAIt/D,EAAI,EAAGA,EAAI,IAAKA,IAAK,CAC1B,MAAM6jG,IAAMF,YAEZ,IAAIC,SAASC,KAAb,CAIA,IAAK,IAAI7jG,EAAI,EAAGA,EAAI6jG,IAAIloF,MAAO3b,IAC3B,IAAK,IAAIK,EAAI,EAAGA,EAAIwjG,IAAIjoF,OAAQvb,IAAK,CACjC,MAAM8sF,MAAQ,CACV/5E,EAAGywF,IAAIzwF,EAAIpT,EACXqT,EAAGwwF,IAAIxwF,EAAIhT,GAIL,IAANL,GACAA,IAAM6jG,IAAIloF,MAAQ,GACZ,IAANtb,GACAA,IAAMwjG,IAAIjoF,OAAS,EAEnBa,MAAM4/E,YAAYlP,MAAM/5E,EAAG+5E,MAAM95E,EAAGipF,uDAEpC7/E,MAAM4/E,YAAYlP,MAAM/5E,EAAG+5E,MAAM95E,EAAG8oF,wDAOhD,GAFA1/E,MAAM4hF,WAAWwF,IAAIzwF,EAAGywF,IAAIxwF,EAAGwwF,IAAIloF,MAAOkoF,IAAIjoF,QAE1Ca,MAAMwrE,MAAMhoF,QAAUsjG,SACtB,OAIR,OAAI9mF,MAAMwrE,MAAMhoF,OAASqiG,SACdlkG,KAAKmhF,SAAS,IACdnhD,SACHglE,QAASA,QAAU,MAI3BvH,2DAASp/E,MAAO+9E,OAET/9E,U,qQC3GR,MAAMomF,UAAapmF,QACtB,IAAK,IAAIzc,EAAI,EAAGA,EAAIyc,MAAMd,MAAO3b,IAC7Byc,MAAM4/E,YAAYr8F,EAAG,EAAGs8F,uDACxB7/E,MAAM4/E,YAAYr8F,EAAGyc,MAAMb,OAAS,EAAG0gF,uDAG3C,IAAK,IAAIj8F,EAAI,EAAGA,EAAIoc,MAAMb,OAAS,EAAGvb,IAClCoc,MAAM4/E,YAAY,EAAGh8F,EAAGi8F,uDACxB7/E,MAAM4/E,YAAY5/E,MAAMd,MAAQ,EAAGtb,EAAGi8F,yD,mfCLvC,MAAMpB,wBAAwBE,oDACjC,gBAAgBh9D,UACZ,MAAM3hB,MAAQ4+E,2EAAuB,CACjC1/E,MAAOyiB,SAASziB,MAChBC,OAAQwiB,SAASxiB,OACjB4+E,MAAOp8D,SAASo8D,QAOpB,OAJA/9E,MAAMqiF,SAAS/B,mEAEflB,2DAASp/E,MAAO2hB,SAASo8D,OAElB/9E,S,saCXR,MAAM0+E,wBAAwBC,oDACjC,gBAAgBh9D,UAaZ,OANc,IAAI8/D,oDAAc9/D,SAASziB,MAAOyiB,SAASxiB,W,2eCT1D,MAAMkoF,qBAAqB7F,iDAC9B,gBAAgB7/D,UACZ,MAAMziB,MAAQyiB,SAASziB,MACjBC,OAASwiB,SAASxiB,OAClB4+E,MAAQp8D,SAASo8D,OAAS,GAE1B/9E,MAAQ,IAAIyhF,oDAAcviF,MAAOC,SAEvCinF,qEAAUpmF,OAQV,OANaA,MAAM4hF,WAAW,EAAG,EAAGjgE,SAASziB,MAAOyiB,SAASxiB,QAExD8/E,cAAe,GAEpBG,2DAASp/E,MAAO+9E,OAET/9E,S,86LClBA,MAAMhE,uBAAuB0C,8CAAQ,oEACrC,IADqC,8BAEvC,IAFuC,qCAGhC,GAEhB8kD,WACI7hE,KAAK2lG,SAAW,GAChB3lG,KAAK8Q,OAAS,GAGlB/F,MAAMsN,KAAMvF,MACR9S,KAAK8Q,OAAOnK,KAAK,CAAE0R,KAAMvF,OAG7ByqB,IAAI7e,MACA1e,KAAK2lG,SAASh/F,KAAK,CAAE+X,OAGzB7B,OAAOJ,IACHzc,KAAK8Q,OAAOyC,SAAQ,EAAG8E,KAAMvF,UACrB+6B,kEAAax1B,KAAMvF,OACnB9S,KAAK2lG,SAASh/F,KAAK,CACf+X,MAAM2vB,gEAAWh2B,KAAMvF,WAInC9S,KAAK8Q,OAAS,GAEd,MAAM80F,KAAO5lG,KAAK2lG,SAASp6F,MACvBY,KAAKC,IAAIpM,KAAK2lG,SAAS9jG,OAAS7B,KAAK6lG,cAAe,IAElDroF,OAASrR,KAAK2C,IAAI82F,KAAK/jG,OAAQ7B,KAAK6lG,eAE1CD,KAAKryF,SAAQ,CAACo6B,QAAS/rC,KACnB5B,KAAKpB,KAAKqa,SAAS4F,SACf,EACA7e,KAAKpB,KAAK6a,OAAO+D,QAAUA,OAAS5b,GACpC+rC,QAAQjvB,Y,iWCrCT,MAAMnD,sBAAsBuN,6CAGvCrQ,YAAY7Z,MACRse,MAAMte,MADQ,4C,4UAGd,CAAAoB,KAAA,OAAcpB,KAAKC,IAAIkqB,YAAY,CAC/BlpB,IAAK,CAACqpB,8DAIdxM,OAAOD,K,iOACH,CAAAzc,KAAA,QAAYsiB,MAAM/O,SAASkW,SACvB,GAAIA,OAAOoO,aAAaX,KAAO,EAAG,CAE9B,GAAIzN,OAAO+O,SAAU,CACjB,MAAMqE,QAAUpT,OAAO+O,SAASqE,QAEhC78B,KAAKpB,KAAK0a,OAAOwsF,aAAar8E,OAAO9d,GAAIkxB,SAG7CpT,OAAO0E,eAEP1E,OAAOoO,aAAaX,a,miBCtBpC,MAAM6uE,MAKFttF,YAAY+mB,KAAM1sB,MAAM,kCAJZ,GAIY,gCAHd,GAGc,4BAFjB,MAGH9S,KAAKqd,KAAOvK,KAAKuK,KACjBrd,KAAK8H,KAAO,IAAIV,yCAAK,CACjBU,MAAM,EACNR,IAAK,CAAC,GAAD,OAAIk4B,MAAJ,OAAW1sB,KAAKhL,SAGrBgL,KAAKkzF,QACLhmG,KAAKgmG,MAAQ,IAAI5+F,yCAAK,CAClBU,MAAM,EACNR,IAAK,CAAC,GAAD,OAAIk4B,MAAJ,OAAW1sB,KAAKkzF,UAGzBhmG,KAAKgmG,MAAMn1F,GAAG,OAAO,KACb7Q,KAAKimG,WACLjmG,KAAKiS,KAAOjS,KAAK8H,KACjB9H,KAAK8H,KAAKoE,KAAK,GACflM,KAAK8H,KAAKzG,OAAO,GACjBrB,KAAK8H,KAAKxB,SAEVtG,KAAKgmG,MAAMzjG,OACXvC,KAAK8H,KAAKvF,YAM1B+D,OACQtG,KAAKimG,YAILjmG,KAAKgmG,OACLhmG,KAAKiS,KAAOjS,KAAKgmG,MACjBhmG,KAAKgmG,MAAM95F,KAAK,GAChBlM,KAAKgmG,MAAM1/F,OACXtG,KAAKgmG,MAAMr3F,KAAK,EAAG,EAAG,KACtB3O,KAAK8H,KAAKvF,SAGVvC,KAAKiS,KAAOjS,KAAK8H,KACjB9H,KAAK8H,KAAKoE,KAAK,GACflM,KAAK8H,KAAKxB,OACVtG,KAAK8H,KAAK6G,KAAK,EAAG,EAAG,MAIzB3O,KAAKimG,WAAY,GAGrB1jG,OACQvC,KAAKiS,MACLjS,KAAKiS,KAAKtD,KAAK,EAAG,EAAG,KAEzB3O,KAAKimG,WAAY,GAIV,MAAMrtF,qBAAqBmE,8CAItCtE,YAAY7Z,MACRse,MAAMte,MADQ,8BAHT,IAGS,oCAFH,MAIX,MAAM4gC,KAAO,GAAH,OAAM7gC,OAAO0M,SAASC,SAAtB,aAAmC3M,OAAO0M,SAAS66F,MAAnD,OAA0DvnG,OAAO0M,SAAS86F,UAA1E,OAAqFxtF,oDAE/FA,8DAAsB7F,OAClB,MAAMszF,MAAQ,IAAIL,MAAMvmE,KAAM1sB,MAE9B9S,KAAKqmG,OAAOvzF,KAAKU,KAAO4yF,SAIhC9/F,KAAKkN,KACGA,MAAQxT,KAAKsmG,eAIbtmG,KAAKsmG,cACLtmG,KAAKqmG,OAAOrmG,KAAKsmG,cAAc/jG,OAGnCvC,KAAKqmG,OAAO7yF,KAAKlN,OACjBtG,KAAKsmG,aAAe9yF,KAGxBjR,OACQvC,KAAKsmG,cACLtmG,KAAKqmG,OAAOrmG,KAAKsmG,cAAc/jG,OAIvC88D,aAAagF,MACTrkE,KAAKsG,KAAK+9D,KAAK1rD,U,0uBClGR,MAAMkC,qBAAqBiO,6CACtCrQ,YAAY7Z,MACRse,MAAMte,MAENoB,KAAKo2B,MAAQp2B,KAAKpB,KAAKC,IAAIkqB,YAAY,CACnClpB,IAAK,CAACu8C,uDAId1/B,OAAOD,IACH,IAAKzc,KAAKpB,KAAKma,MAAM8Q,UACjB,OAGJ,MAAM6V,MAAQ1/B,KAAKpB,KAAKma,MAAM8Q,UAE9B7pB,KAAKo2B,MAAM9T,MAAM/O,SAASkW,SACtBA,OAAO/V,OAAOH,SAASG,UACAyoC,yDAAUzoC,OAAOF,KAEzBkJ,OAAOgjB,MAAOjW,OAAQ/V,QAE7BA,OAAOqpC,eACPrpC,OAAOya,mB,yUCnBZ,MAAM1S,qBAAqBqN,6CACtCrQ,YAAY7Z,MACRse,MAAMte,MAENoB,KAAKo2B,MAAQp2B,KAAKpB,KAAKC,IAAIkqB,YAAY,CACnClpB,IAAK,CAACs3B,6DAAiB6Y,uDACvB/mB,KAAM,CAACsb,2DAAerb,6DAI9BxM,OAAOD,IACH,IAAKzc,KAAKpB,KAAKma,MAAM8Q,UACjB,OAGUpqB,MAAMC,KAAKM,KAAKo2B,MAAM9T,OAE9BynB,QAAO,CAACw8D,GAAIv+F,QACd,MAAMof,UAAYpf,KAAKi1B,gBAEvB,IAAK7V,UAAU2R,cACX,OAAOwtE,GAGX,MAAMxxF,IAAM/M,KAAKwwB,SAASC,SACpBhB,OAASrQ,UAAUkQ,QACnB9jB,IAAM,GAAH,OAAMuB,IAAIC,EAAV,YAAeD,IAAIE,EAAnB,YAAwBwiB,QAQjC,OANI8uE,GAAG/yF,KACH+yF,GAAG/yF,KAAK2kB,YAAY/Q,WAEpBm/E,GAAG/yF,KAAO4T,UAGPm/E,KACR,O,sdCjCI,MAAM5qF,mBAAmBmN,6CACpCrQ,YAAY7Z,MACRse,MAAMte,MAENoB,KAAKwmG,eAAiBxmG,KAAKpB,KAAKC,IAAIkqB,YAAY,CAC5ClpB,IAAK,CAAC4/C,uDAAWzP,uDACjB/mB,KAAM,CAACsb,2DAAerb,6DAI9BxM,OAAOD,IACEzc,KAAKpB,KAAKma,MAAM0tF,WAIrBzmG,KAAKwmG,eAAelkF,MAAM/O,SAASmzF,aAC/B,MAAM3xF,IAAM2xF,WAAWluE,SAASC,SACfz4B,KAAKpB,KAAKkB,IAAI6oD,cAAc5zC,IAAIC,EAAGD,IAAIE,GAE/C1B,SAASkW,SACd,GAAIA,OAAO9d,KAAO+6F,WAAW/6F,IAGzB8d,OAAOwhB,MAAO,CACAy7D,WAAWnnE,UAAUvtB,KAAKyX,WAGpCmyB,yDAAUE,4DAAiBryB,QAC3BzpB,KAAKpB,KAAK4H,QAAQuE,MAAMqiC,2EAA0B,CAC9CgB,KAAMs4D,WACNj9E,oB,2cC7Bb,MAAM5N,mBAAmBiN,6CACpCrQ,YAAY7Z,MACRse,MAAMte,MAENoB,KAAKo2B,MAAQp2B,KAAKpB,KAAKC,IAAIkqB,YAAY,CACnClpB,IAAK,CAAC2gD,kDAAMX,yDAAa7P,uDACzB/mB,KAAM,CAACsb,2DAAerb,6DAI9BxM,OAAOD,IACEzc,KAAKpB,KAAKma,MAAM0tF,WAIrBzmG,KAAKo2B,MAAM9T,MAAM/O,SAASkW,SACtB,MAAM1U,IAAM0U,OAAO+O,SAASC,SACtBkuE,YAAcl9E,OAAOk9E,YAC3B,IAAI7qF,YAAc9b,KAAKpB,KAAKkd,YAAYkkC,eACpCjrC,IAAIC,EACJD,IAAIE,GAGR0xF,YAAY5mD,MAAQ4mD,YAAY/lD,SAChC9kC,aAAe6qF,YAAY/lD,SAE3B5gD,KAAKpB,KAAKkd,YAAYmkC,eAAelrC,IAAIC,EAAGD,IAAIE,EAAG6G,aAEnD,MAAM8qF,YAAcD,YAAYxmD,iBAC1B0mD,UAAYF,YAAYzmD,kBAE9BlgD,KAAKpB,KAAKkB,IACLglE,oBAAoB/vD,IAAIC,EAAGD,IAAIE,GAC/BwmC,OACAr6B,QAAQne,GAAMA,EAAE0jG,cAChBpzF,SAASqjF,YACQz0D,+DAAmBykE,cAG7BhQ,SAAS7sE,UAAU,QAAS,CACxBs2B,UAAW52B,OAAOq2B,KAAKO,UAAY,OAK/CsmD,YAAYG,aACZr9E,OAAO0J,IAAIjK,2DAEPy9E,YAAYhmD,mBACZ1oB,oDAAM0uE,YAAYhmD,iBAAkB5rC,IAAIC,EAAGD,IAAIE,KAE5CktB,+DAAmB0kE,YAC1Bp9E,OAAOq2B,KAAKe,aAEZ7gD,KAAKpB,KAAKsc,UAAUo5B,eAAev/B,IAAIC,EAAGD,IAAIE,EAAG,CAC7C2oB,SAAU,IACVF,KAAM,CAAC,SAAU,OACjBD,OAAQ,CAAC,IAAK,IAAK,QAGvBz9B,KAAKpB,KAAKsc,UAAUo5B,eAAev/B,IAAIC,EAAGD,IAAIE,EAAG,CAC7C2oB,SAAU,IACVF,KAAM,CAAC,SAAU,OACjBD,OAAQ,CAAC,IAAK,IAAK,a,mYCrExB,MAAM1hB,0BAA0B+M,6CAG3C,YACI,OAAO9oB,KAAKpB,KAAKkB,IAAIyd,MAGzB,aACI,OAAOvd,KAAKpB,KAAKkB,IAAI0d,OAGzB/E,YAAY7Z,M,kBACRse,MAAMte,M,WADQ,G,IAAA,U,IAAA,M,gGAGdoB,KAAK+mG,KAAO,IAAIC,uDAAWhnG,KAAKud,MAAOvd,KAAKwd,QAGhDqkD,WACI7hE,KAAK+mG,KAAKxnF,QAGd0nF,wBACI,OAAOjnG,KAAKpB,KAAKwa,MAAMirD,KAAKvoD,YAAYorF,QAG5CC,qBACI,OAAOnnG,KAAKpB,KAAKwa,MAAMirD,KAAKvoD,YAAYsrF,SAG5CtnF,kBACI,MAAMhN,KAAO9S,KAAK+mG,KAAK5kF,YAEvBniB,KAAKpB,KAAKiE,MAAM0gE,wBACZvjE,KAAKpB,KAAKwa,MAAM8lD,OAChBpsD,MAIRusD,aAAagF,MACT,MAAMvxD,KAAO9S,KAAKpB,KAAKiE,MAAM+gE,wBAAwBS,KAAK14D,IAEtDmH,KACA9S,KAAK+mG,KAAK1kF,YAAYvP,OAEtB9S,KAAK+mG,KAAKnlF,sBAAwB,IAAMyiD,KAAKvoD,YAAYorF,QACzDlnG,KAAK+mG,KAAK/lE,SAASpf,sBAAwB,IACvCyiD,KAAKvoD,YAAYorF,QACrBlnG,KAAK+mG,KAAK/kF,OAAOqiD,KAAKvoD,YAAYorF,UAI1CjnD,eAAejrC,EAAGC,EAAGgN,OACjBjiB,KAAK+mG,KAAKnmF,IAAI5L,EAAGC,EAAGgN,OAGxB+9B,eAAehrC,EAAGC,GACd,OAAOjV,KAAK+mG,KAAKzkF,IAAItN,EAAGC,GAG5BoyF,YAAYryF,EAAGC,GACX,IAAIqyF,QAAS,EACTC,SAAU,EAEd,MAAMH,SAAWpnG,KAAKpB,KAAKkB,IAAI6oD,cAAc3zC,EAAGC,GAAG80B,QAAO,CAACy9D,IAAKvkG,IACxDA,EAAE68C,MACFynD,SAAU,EACH,GAEPtkG,EAAEwkG,iBACFH,QAAS,EAEFE,IAAMvkG,EAAEwkG,gBAAgBxlF,OAG5BulF,KACR,GAEH,OAAID,QACO,EAGPD,OACOF,SAGJpnG,KAAKmnG,qBAGhBzqF,OAAOD,Q,qNC7FJ,MAAMirF,SAAW,CAAC5lE,IAAM,KAAOA,IAAIiI,QAAO,CAAC1R,IAAKnI,MAAQmI,IAAMnI,KAAK,GAC7Dy3E,SAAW,CAAC7lE,IAAM,KAAO4lE,SAAS5lE,KAAOA,IAAIjgC,Q,uMCDnD,MAAMmlB,KAAO,CAAC4gF,GAAIC,GAAI/qF,KAAO,EAAIA,GAAK8qF,GAAK9qF,EAAI+qF,GACzCC,MAAQ,CAAC/iB,GAAIlxD,GAAI/W,KACnB,CACH9H,EAAGgS,KAAK+9D,GAAG/vE,EAAG6e,GAAG7e,EAAG8H,GACpB7H,EAAG+R,KAAK6M,GAAG5e,EAAG4e,GAAG7e,EAAG8H,KAI5Bne,OAAOqoB,KAAOA,M,8PCNC,MAAMggF,mBAAmBhnF,2CACpC,YACI,OAAOhgB,KAAK0hB,OAGhB,aACI,OAAO1hB,KAAK2hB,QAGhBlJ,YAAY8E,MAAOC,OAAQoE,sBAAwB,KAAM,OACrD1E,MAAMK,MAAOC,OAAQoE,uBACrB5hB,KAAKghC,SAAW,IAAIhhB,2CAAKzC,MAAOC,OAAQoE,uBAG5CmmF,iBACI/nG,KAAKghC,SAAStf,OAAS1hB,KAAK0hB,OAC5B1hB,KAAKghC,SAASrf,QAAU3hB,KAAK2hB,QAC7B3hB,KAAKghC,SAASluB,KAAO,IAAI9S,KAAK8S,S,8ZCfvB,MAAMmJ,sBAAsB6M,6CACvCrQ,YAAY7Z,MACRse,MAAMte,MAENoB,KAAKo2B,MAAQp2B,KAAKpB,KAAKC,IAAIkqB,YAAY,CACnClpB,IAAK,CAACshD,0EACNl4B,KAAM,CAACC,6DAIfxM,OAAOD,IACH,MAAMijB,MAAQ1/B,KAAKpB,KAAKma,MAAM8Q,UAEzB6V,OAIL1/B,KAAKo2B,MAAM9T,MAAM/O,SAASkW,SACtBvY,OAAO2T,OAAO4E,OAAOs5B,eAAexvC,SAASG,SACzCA,OAAOiuC,QAAQjlC,OAAOgjB,MAAOhsB,iB,8UCf9B,MAAM2I,0BAA0ByM,6CAC3CrQ,YAAY7Z,MACRse,MAAMte,MAENoB,KAAKgoG,OAAShoG,KAAKpB,KAAKC,IAAIkqB,YAAY,CACpClpB,IAAK,CAACsnD,yDAAanX,uDACnB/mB,KAAM,CAACsb,2DAAerb,6DAI9BxM,OAAOD,IACEzc,KAAKpB,KAAKma,MAAM8Q,WAIrB7pB,KAAKgoG,OAAO1lF,MAAM/O,SAAS00F,cACvB,MAAMC,MAAQD,YAAYpgD,YACpB9yC,IAAMkzF,YAAYzvE,SAASC,SAChBz4B,KAAKpB,KAAKkB,IAAI6oD,cAAc5zC,IAAIC,EAAGD,IAAIE,GAE/C1B,SAASkW,SACTA,OAAO0+E,sBAIZ1+E,OAAOM,UAAU,OAAQ,CACrB9H,MAAOimF,MAAME,YAGjBpoG,KAAKpB,KAAKsc,UAAU2oC,cAChB9uC,IAAIC,EACJD,IAAIE,EACJ,CACI7M,KAAM,EACNkE,SAAU,KAEd,CACImxB,OAAQ,CAAC,IAAK,KACdC,KAAM,CAAC,OACPC,MAAO,IACPC,SAAU,MAIlBqqE,YAAY90E,IAAIjK,qE,8UC5CjB,MAAM/M,0BAA0B2M,6CAC3CrQ,YAAY7Z,MACRse,MAAMte,MAENoB,KAAKqoG,cAAgBroG,KAAKpB,KAAKC,IAAIkqB,YAAY,CAC3ClpB,IAAK,CAACinD,0DAAc9W,uDACpB/mB,KAAM,CAACsb,2DAAerb,6DAI9BxM,OAAOD,IACEzc,KAAKpB,KAAKma,MAAM8Q,WAIrB7pB,KAAKqoG,cAAc/lF,MAAM/O,SAAS+0F,qBAC9B,MAAMC,aAAeD,mBAAmBC,aAClCxzF,IAAMuzF,mBAAmB9vE,SAASC,SACvBz4B,KAAKpB,KAAKkB,IAAI6oD,cAAc5zC,IAAIC,EAAGD,IAAIE,GAE/C1B,SAASkW,SACVA,OAAO9d,KAAO28F,mBAAmB38F,IAGhC8d,OAAO++E,OAGR/+E,OAAO++E,KAAKvmF,MAAQsmF,aAAavhD,kBAIrCshD,mBAAmBllF,MAAMmf,GAAKgmE,aAAaxhD,aAC3CwhD,aAAathD,cAAe,EAE5BqhD,mBAAmBv+E,UAAU,aAAc,CACvCwO,WAAY9O,oB,+YCjCjB,MAAMlP,uBAAuBwC,8CACxCtE,YAAY7Z,MACRse,MAAMte,MACNoB,KAAKo2B,MAAQx3B,KAAKC,IAAIkqB,YAAY,CAC9BlpB,IAAK,CAACmmD,0DAAchW,sDAAUoC,uDAC9BnpB,KAAM,CAACsb,2DAAerb,6DAG1BlpB,KAAKo2B,MAAMX,iBAAiBhM,UACpBA,OAAOoO,cAAgBpO,OAAO8a,gBAC9BvkC,KAAKimE,wBAAwBx8C,WAKzCg/E,iBAAiBzzF,EAAGC,EAAGzB,KAGnB,OAFkBxT,KAAKpB,KAAKkB,IAAIglE,oBAAoB9vD,EAAGC,GAEtCnV,KAAK40B,MACXA,KAAKtT,QACPne,GACGA,EAAEglD,UACFhlD,EAAE+iE,cACF/iE,EAAE+iE,aAAaxyD,MAAQA,MACtBvQ,EAAE40B,iBAKnBouC,wBAAwBx8C,QACpB,MAAMjW,IAAMiW,OAAOu8C,aAAaxyD,IAC1BuB,IAAM0U,OAAO+O,SAASC,SAE5Bz4B,KAAK0oG,YAAYj/E,QAECzpB,KAAKyoG,iBAAiB1zF,IAAIC,EAAGD,IAAIE,EAAGzB,KAE5CioC,OAAOloC,SAASqjF,WACtB52F,KAAK0oG,YAAY9R,aAIzB8R,YAAYj/E,QACR,MAAMjW,IAAMiW,OAAOu8C,aAAaxyD,IAC1BuB,IAAM0U,OAAO+O,SAASC,SACtBqH,UAAY9/B,KAAKyoG,iBAAiB1zF,IAAIC,EAAGD,IAAIE,EAAGzB,KAChD4yC,KAAOpmD,KAAK2oG,QAAQ7oE,WAEtBrW,OAAOu8C,aAAa9f,cACpBz8B,OAAOrG,MAAMmf,IAAK4jB,4DAAa3yC,IAAK4yC,OAI5CuiD,QAAQ7oE,WACJ,OAAOA,UAAUiK,QAAO,CAAC1R,IAAK/W,KAAMO,MACzBP,KAAKzf,OAASw2B,IAAM,GAAKxW,IAAMwW,KACvC,GAGPuwE,aACI5oG,KAAKo2B,MAAM9T,MAAM/O,SAASkW,SACtBzpB,KAAK0oG,YAAYj/E,c,miBCnEd,MAAMlQ,qBAAqBwD,8CAOtCtE,YAAY7Z,MACRse,MAAMte,MADQ,kCANL,IAMK,mCALJ,IAKI,mCAHJ,IAGI,mCAFJ,IAIVoB,KAAKsZ,OAAS,IAAI0G,iDAAKhgB,KAAKgkE,YAAahkE,KAAKkkE,aAE9C,IAAK,IAAIlvD,EAAI,EAAGA,EAAIhV,KAAKgkE,YAAahvD,IAClC,IAAK,IAAIC,EAAI,EAAGA,EAAIjV,KAAKkkE,YAAajvD,IAAK,CACvC,MAAMtJ,GAAK3L,KAAKsZ,OAAOuI,IAAI7M,EAAGC,GACxB2nB,MAAQ,IAAIisE,iDAAMl9F,GAAIqJ,EAAGC,EAAGjV,KAAKikE,WAAYjkE,KAAKmkE,aAExDnkE,KAAKsZ,OAAOsH,IAAI5L,EAAGC,EAAG2nB,QAKlCstB,gBAAgBhC,OAAQC,QACpB,MAAO,CACHnzC,EAAG7I,KAAK41B,MAAMmmB,OAASloD,KAAKikE,YAC5BhvD,EAAG9I,KAAK41B,MAAMomB,OAASnoD,KAAKmkE,cAIpC2kC,gBAAgB5gD,OAAQC,QACpB,MAAO,CACHnzC,EAAGkzC,OAASloD,KAAKikE,WACjBhvD,EAAGkzC,OAASnoD,KAAKmkE,aAIzBG,YAAYhwC,SAAUuI,SAClB,MAAMD,MAAQ58B,KAAK+oG,aAAalsE,SAC1B0xD,MAAQ3xD,MAAM0nC,YAAYhwC,UAEhC,MAAO,CACHtf,EAAGu5E,MAAMv5E,EAAI4nB,MAAM5nB,EAAIhV,KAAKikE,WAC5BhvD,EAAGs5E,MAAMt5E,EAAI2nB,MAAM3nB,EAAIjV,KAAKmkE,aAIpC5uD,YAAYP,EAAGC,EAAGqf,SAAUuI,SACxB,MAAMmsE,SAAWhpG,KAAKkqD,gBAAgBl1C,EAAGC,GACnCs5E,MAAQvuF,KAAK8oG,gBAAgB9zF,EAAGC,GAChC2nB,MAAQ58B,KAAKipG,SAASD,SAASh0F,EAAGg0F,SAAS/zF,GAEjD,IAAK2nB,MACD,OAGJ,GAAIC,UAAYD,MAAMjxB,GAAI,CACV3L,KAAK+oG,aAAalsE,SAE1BipE,aAAaxxE,UAINt0B,KAAKpB,KAAKC,IAAIiuB,UAAUwH,UAChCkE,SAASqE,QAAUD,MAAMjxB,GAEhCixB,MAAMrnB,YAAYg5E,MAAMv5E,EAAGu5E,MAAMt5E,EAAGqf,UAGxCwxE,aAAaxxE,SAAUuI,SACnBr2B,QAAQ+2B,IAAI,gBAAiBjJ,SAAUuI,SACzB78B,KAAK+oG,aAAalsE,SAE1BipE,aAAaxxE,UAGvBq0B,cAAc3zC,EAAGC,EAAGsvD,eAAgB,GAChC,GAAIvvD,EAAI,GAAKC,EAAI,EACb,MAAO,GAGX,MAAM+zF,SAAWhpG,KAAKkqD,gBAAgBl1C,EAAGC,GACnCs5E,MAAQvuF,KAAK8oG,gBAAgB9zF,EAAGC,GAChC2nB,MAAQ58B,KAAKipG,SAASD,SAASh0F,EAAGg0F,SAAS/zF,GAEjD,OAAK2nB,MAIEA,MAAM+rB,cAAc4lC,MAAMv5E,EAAGu5E,MAAMt5E,EAAGsvD,eAHlC,GAMf9C,eACI,MAAO,GAGXsnC,aAAalsE,SACT,MAAM/a,MAAQ9hB,KAAKsZ,OAAOwI,MAAM+a,SAEhC,OAAO78B,KAAKipG,SAASnnF,MAAM9M,EAAG8M,MAAM7M,GAGxCg0F,SAASC,OAAQC,QACb,MAAMvsE,MAAQ58B,KAAKsZ,OAAOgJ,IAAI4mF,OAAQC,QAMtC,OAJIvsE,QAAUA,MAAMwsE,UAChBxsE,MAAMt3B,OAGHs3B,MAGXlgB,OAAOD,IACHzc,KAAKsZ,OAAOxG,KAAKS,SAASqpB,QACtB,IAAKA,MAAMwsE,SACP,OAGJ,MAAMjI,GAAKviG,KAAK6a,OAAOqF,KAAO8d,MAAM7d,MAC9BqiF,GAAKxiG,KAAK6a,OAAOsF,MAAQ6d,MAAM9d,KAC/BuiF,GAAKziG,KAAK6a,OAAO0kD,IAAMvhC,MAAMskC,OAC7BogC,GAAK1iG,KAAK6a,OAAOynD,OAAStkC,MAAMuhC,IAEnBgjC,IAAMC,IAAMC,IAAMC,IAGjC1kE,MAAMp6B,e,+YC5HP,MAAMqmG,MACjB,aACI,OAAO7oG,KAAKud,MAAQvd,KAAKgV,EAG7B,aACI,OAAOhV,KAAKwd,OAASxd,KAAKiV,EAG9B,WACI,OAAOjV,KAAKud,MAAQvd,KAAKgV,EAG7B,YACI,OAAOhV,KAAKud,MAAQvd,KAAKgV,EAAIhV,KAAKud,MAGtC,UACI,OAAOvd,KAAKwd,OAASxd,KAAKiV,EAG9B,aACI,OAAOjV,KAAKwd,OAASxd,KAAKiV,EAAIjV,KAAKwd,OAGvC/E,YAAY9M,GAAIqJ,EAAGC,EAAGsI,MAAOC,QACzBxd,KAAK2L,GAAKA,GACV3L,KAAKgV,EAAIA,EACThV,KAAKiV,EAAIA,EACTjV,KAAKud,MAAQA,MACbvd,KAAKwd,OAASA,OACdxd,KAAK8S,KAAO,IAAIwyD,oDAAQ/nD,MAAOC,QAC/Bxd,KAAKopG,UAAW,EAGpB9jG,OACI,GAAItF,KAAKopG,SAEL,YADA5iG,QAAQ+2B,IAAI,4BAIhB/2B,QAAQ+2B,IAAR,qBAA0Bv9B,KAAK2L,GAA/B,aAAsC3L,KAAKgV,EAA3C,aAAiDhV,KAAKiV,EAAtD,MAEA,MAAMo0F,MAAQzqG,yEAAiCoB,KAAK2L,IAEpD,GAAK09F,MAEE,CACHrpG,KAAK8S,KAAKuP,YAAYgnF,OAEtB,MAAM10E,WAAa/1B,uEAA+BoB,KAAK2L,IAEvD/M,6DAAqB+1B,iBANrB20E,oEAActpG,MASlBA,KAAKopG,UAAW,EAGpB5mG,SACI,IAAKxC,KAAKopG,SAEN,YADA5iG,QAAQ+2B,IAAI,+BAIhB/2B,QAAQ+2B,IAAR,uBAA4Bv9B,KAAK2L,GAAjC,aAAwC3L,KAAKgV,EAA7C,aAAmDhV,KAAKiV,EAAxD,MAEA,MAEMmU,SAFYppB,KAAK8S,KAAK0yD,YAED1lE,KAAK6L,IACrB/M,2DAAmB+M,MAGxB+1D,WAAa9iE,2DAAmBwqB,UAEtCxqB,yEAAiCoB,KAAK2L,GAAI3L,KAAK8S,KAAKqP,aACpDvjB,uEAA+BoB,KAAK2L,GAAI+1D,YAExCt4C,SAAS7V,SAAStQ,GAAMA,EAAEkrB,YAE1BnuB,KAAKopG,UAAW,EAGpBtD,aAAaxxE,UACTt0B,KAAK8S,KAAKob,OAAOoG,UAGrBgwC,YAAYhwC,UAKR,OAJKt0B,KAAKopG,UACNppG,KAAKsF,OAGFtF,KAAK8S,KAAKwxD,YAAYhwC,UAGjC/e,YAAYP,EAAGC,EAAGqf,UACdt0B,KAAK8S,KAAK8N,IAAI5L,EAAGC,EAAGqf,UAGxBq0B,cAAc3zC,EAAGC,EAAGsvD,eAAgB,GAChC,OAAOvkE,KAAK8S,KAAKwP,IAAItN,EAAGC,GAAG80B,QAAO,CAAC3gB,SAAUzd,MACzC,MAAM1I,EAAIrE,2DAAmB+M,IAM7B,OAJK1I,EAAEghC,gBAAkBsgC,eAAwBthE,EAAEs8F,QAC/Cn2E,SAASziB,KAAK1D,GAGXmmB,WACR,O,+gBC3GX,MAAMmgF,QAAU,IAAIC,qDAAJ,CAAiB,QAEpBF,cAAiB1sE,QAC1Bp2B,QAAQ+2B,IAAR,yBAA8BX,MAAMjxB,KAGpC,IAAK,IAAIqJ,EAAI,EAAGA,EAAI4nB,MAAMrf,MAAOvI,IAC7B,IAAK,IAAIC,EAAI,EAAGA,EAAI2nB,MAAMrf,MAAOtI,IAAK,CAClC,MAAMwX,EAAI88E,QAAQE,SAAS7sE,MAAM5nB,EAAIA,GAAK,IAAK4nB,MAAM3nB,EAAIA,GAAK,IAE1DwX,IAAM,EACNjmB,QAAQ+2B,IAAI,cAAe9Q,GACpBA,GAAK,GACZjmB,QAAQ+2B,IAAI,eAAgB9Q,GAG5BA,EAAI,KACJkQ,4DAAc5B,qEAAwB/lB,EAAGC,EAAG,GAAI2nB,OAC5CnQ,GAAK,KACLkQ,4DAAcnB,+DAAkBxmB,EAAGC,EAAG,GAAI2nB,SAG9CD,4DAAc9B,+DAAkB7lB,EAAGC,EAAG,GAAI2nB,U,uCC1B1D,mCA6BA,WACE,aAEA,IAAI+3D,GAAK,IAAOxoF,KAAKm8C,KAAK,GAAO,GAC7BssC,IAAM,EAAMzoF,KAAKm8C,KAAK,IAAQ,EAE9BohD,GAAK,EAAM,EACXC,IAAMx9F,KAAKm8C,KAAK,GAAO,GAAO,EAC9BshD,IAAM,EAAMz9F,KAAKm8C,KAAK,IAAQ,GAElC,SAASkhD,aAAaK,cACpB,IAAI7nE,OAEFA,OADyB,mBAAhB6nE,aACAA,aAEFA,aA6WX,WAEE,IAAIC,GAAK,EACLC,GAAK,EACLC,GAAK,EACL3oF,EAAI,EAEJ4oF,KAAOC,SACXJ,GAAKG,KAAK,KACVF,GAAKE,KAAK,KACVD,GAAKC,KAAK,KAEV,IAAK,IAAIroG,EAAI,EAAGA,EAAIwM,UAAUvM,OAAQD,KACpCkoG,IAAMG,KAAK77F,UAAUxM,KACZ,IACPkoG,IAAM,IAERC,IAAME,KAAK77F,UAAUxM,KACZ,IACPmoG,IAAM,IAERC,IAAMC,KAAK77F,UAAUxM,KACZ,IACPooG,IAAM,GAIV,OADAC,KAAO,KACA,WACL,IAAIntF,EAAI,QAAUgtF,GAAS,uBAAJzoF,EAGvB,OAFAyoF,GAAKC,GACLA,GAAKC,GACEA,GAAKltF,GAAKuE,EAAQ,EAAJvE,IA3YZqtF,CAAKN,cAEL19F,KAAK61B,OAEhBhiC,KAAKgwE,EAAIo6B,sBAAsBpoE,QAC/BhiC,KAAKqqG,KAAO,IAAIp3F,WAAW,KAC3BjT,KAAKsqG,UAAY,IAAIr3F,WAAW,KAChC,IAAK,IAAIrR,EAAI,EAAGA,EAAI,IAAKA,IACvB5B,KAAKqqG,KAAKzoG,GAAK5B,KAAKgwE,EAAM,IAAJpuE,GACtB5B,KAAKsqG,UAAU1oG,GAAK5B,KAAKqqG,KAAKzoG,GAAK,GAmVvC,SAASwoG,sBAAsBpoE,QAC7B,IAAIpgC,EACAouE,EAAI,IAAI/8D,WAAW,KACvB,IAAKrR,EAAI,EAAGA,EAAI,IAAKA,IACnBouE,EAAEpuE,GAAKA,EAET,IAAKA,EAAI,EAAGA,EAAI,IAAKA,IAAK,CACxB,IAAIsiB,EAAItiB,KAAOogC,UAAY,IAAMpgC,IAC7B2oG,IAAMv6B,EAAEpuE,GACZouE,EAAEpuE,GAAKouE,EAAE9rD,GACT8rD,EAAE9rD,GAAKqmF,IAET,OAAOv6B,EAsCT,SAASk6B,SACP,IAAIjsD,EAAI,WACR,OAAO,SAASnrC,MACdA,KAAOA,KAAKyhE,WACZ,IAAK,IAAI3yE,EAAI,EAAGA,EAAIkR,KAAKjR,OAAQD,IAAK,CAEpC,IAAIkkB,EAAI,oBADRm4B,GAAKnrC,KAAKI,WAAWtR,IAGrBkkB,GADAm4B,EAAIn4B,IAAM,EAGVm4B,GADAn4B,GAAKm4B,KACK,EAEVA,GAAS,YADTn4B,GAAKm4B,GAGP,OAAmB,wBAAXA,IAAM,IA/YlBurD,aAAatpG,UAAY,CACvBsqG,MAAO,IAAI95B,aAAa,CAAC,EAAG,EAAG,GAC5B,EAAG,EAAG,EACP,GAAI,EAAG,GAEN,GAAI,EAAG,EACR,EAAG,EAAG,GACL,EAAG,EAAG,EAEP,EAAG,GAAI,GACN,EAAG,GAAI,EACR,EAAG,EAAG,EAEN,GAAI,EAAG,EACP,EAAG,GAAI,EACP,GAAI,GAAI,IACV+5B,MAAO,IAAI/5B,aAAa,CAAC,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,GAAI,EACxE,GAAI,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,EACrD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,GAAI,GAChD,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,EACrD,EAAG,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,GAChD,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,EAAG,EAAG,GAAI,GAAI,EAAG,GAAI,EACrD,EAAG,EAAG,EAAG,EAAG,EAAG,GAAI,EAAG,EAAG,GAAI,EAAG,EAAG,EAAG,GAAI,GAAI,EAAG,GAChD,EAAG,EAAG,EAAG,GAAI,EAAG,GAAI,EAAG,GAAI,GAAI,EAAG,EAAG,GAAI,GAAI,GAAI,EAAG,IACvD+4B,QAAS,SAAStU,IAAKC,KACrB,IAiBIE,GAAIC,GAjBJ+U,UAAYtqG,KAAKsqG,UACjBD,KAAOrqG,KAAKqqG,KACZG,MAAQxqG,KAAKwqG,MACb9U,GAAK,EACLC,GAAK,EACLC,GAAK,EAEL3vE,GAAKkvE,IAAMC,KAAOT,GAClB/yF,EAAIuK,KAAK41B,MAAMozD,IAAMlvE,GACrBhkB,EAAIkK,KAAK41B,MAAMqzD,IAAMnvE,GACrBnJ,GAAKlb,EAAIK,GAAK2yF,GAGd9oD,GAAKqpD,KAFAvzF,EAAIkb,GAGTivB,GAAKqpD,KAFAnzF,EAAI6a,GAMTgvB,GAAKC,IACPupD,GAAK,EACLC,GAAK,IAGLD,GAAK,EACLC,GAAK,GAKP,IAAIvpD,GAAKF,GAAKwpD,GAAKV,GACf3oD,GAAKF,GAAKwpD,GAAKX,GACfnwB,GAAK34B,GAAK,EAAM,EAAM8oD,GACtBlwB,GAAK34B,GAAK,EAAM,EAAM6oD,GAEtBtB,GAAS,IAAJ1xF,EACL2xF,GAAS,IAAJtxF,EAEL4zF,GAAK,GAAM/pD,GAAKA,GAAKC,GAAKA,GAC9B,GAAI8pD,IAAM,EAAG,CACX,IAAI6U,IAAiC,EAA3BJ,UAAUhX,GAAK+W,KAAK9W,KAE9BmC,IADAG,IAAMA,IACIA,IAAM2U,MAAME,KAAO5+D,GAAK0+D,MAAME,IAAM,GAAK3+D,IAErD,IAAIg9C,GAAK,GAAM/8C,GAAKA,GAAKC,GAAKA,GAC9B,GAAI88C,IAAM,EAAG,CACX,IAAI4hB,IAA2C,EAArCL,UAAUhX,GAAKgC,GAAK+U,KAAK9W,GAAKgC,KAExCI,IADA5M,IAAMA,IACIA,IAAMyhB,MAAMG,KAAO3+D,GAAKw+D,MAAMG,IAAM,GAAK1+D,IAErD,IAAI8pD,GAAK,GAAMtxB,GAAKA,GAAKC,GAAKA,GAC9B,GAAIqxB,IAAM,EAAG,CACX,IAAI6U,IAAyC,EAAnCN,UAAUhX,GAAK,EAAI+W,KAAK9W,GAAK,IAEvCqC,IADAG,IAAMA,IACIA,IAAMyU,MAAMI,KAAOnmC,GAAK+lC,MAAMI,IAAM,GAAKlmC,IAIrD,OAAO,IAAQgxB,GAAKC,GAAKC,KAG3BiV,QAAS,SAAS1V,IAAKC,IAAK0V,KAC1B,IAGIpV,GAAIC,GAAIC,GAAImV,GAeZzV,GAAIC,GAAIyV,GACRC,GAAIC,GAAIt3E,GAnBR02E,UAAYtqG,KAAKsqG,UACjBD,KAAOrqG,KAAKqqG,KACZG,MAAQxqG,KAAKwqG,MAGbvkF,EAnHC,mBAmHIkvE,IAAMC,IAAM0V,KACjBlpG,EAAIuK,KAAK41B,MAAMozD,IAAMlvE,GACrBhkB,EAAIkK,KAAK41B,MAAMqzD,IAAMnvE,GACrByoE,EAAIviF,KAAK41B,MAAM+oE,IAAM7kF,GACrBnJ,GAAKlb,EAAIK,EAAIysF,GAAKgb,GAIlB59D,GAAKqpD,KAHAvzF,EAAIkb,GAITivB,GAAKqpD,KAHAnzF,EAAI6a,GAITquF,GAAKL,KAHApc,EAAI5xE,GAQTgvB,IAAMC,GACJA,IAAMo/D,IACR7V,GAAK,EACLC,GAAK,EACLyV,GAAK,EACLC,GAAK,EACLC,GAAK,EACLt3E,GAAK,GAEEkY,IAAMq/D,IACb7V,GAAK,EACLC,GAAK,EACLyV,GAAK,EACLC,GAAK,EACLC,GAAK,EACLt3E,GAAK,IAGL0hE,GAAK,EACLC,GAAK,EACLyV,GAAK,EACLC,GAAK,EACLC,GAAK,EACLt3E,GAAK,GAIHmY,GAAKo/D,IACP7V,GAAK,EACLC,GAAK,EACLyV,GAAK,EACLC,GAAK,EACLC,GAAK,EACLt3E,GAAK,GAEEkY,GAAKq/D,IACZ7V,GAAK,EACLC,GAAK,EACLyV,GAAK,EACLC,GAAK,EACLC,GAAK,EACLt3E,GAAK,IAGL0hE,GAAK,EACLC,GAAK,EACLyV,GAAK,EACLC,GAAK,EACLC,GAAK,EACLt3E,GAAK,GAOT,IAAIoY,GAAKF,GAAKwpD,GAAKoU,GACfz9D,GAAKF,GAAKwpD,GAAKmU,GACf0B,GAAKD,GAAKH,GAAKtB,GACfjlC,GAAK34B,GAAKm/D,GAAK,EAAMvB,GACrBhlC,GAAK34B,GAAKm/D,GAAK,EAAMxB,GACrB2B,GAAKF,GAAKv3E,GAAK,EAAM81E,GACrB4B,GAAKx/D,GAAK,EAAM,GAChBy/D,GAAKx/D,GAAK,EAAM,GAChBy/D,GAAKL,GAAK,EAAM,GAEhB7X,GAAS,IAAJ1xF,EACL2xF,GAAS,IAAJtxF,EACLwpG,GAAS,IAAJ/c,EAELmH,GAAK,GAAM/pD,GAAKA,GAAKC,GAAKA,GAAKo/D,GAAKA,GACxC,GAAItV,GAAK,EAAGH,GAAK,MACZ,CACH,IAAIgV,IAA4C,EAAtCJ,UAAUhX,GAAK+W,KAAK9W,GAAK8W,KAAKoB,MAExC/V,IADAG,IAAMA,IACIA,IAAM2U,MAAME,KAAO5+D,GAAK0+D,MAAME,IAAM,GAAK3+D,GAAKy+D,MAAME,IAAM,GAAKS,IAE3E,IAAIpiB,GAAK,GAAM/8C,GAAKA,GAAKC,GAAKA,GAAKm/D,GAAKA,GACxC,GAAIriB,GAAK,EAAG4M,GAAK,MACZ,CACH,IAAIgV,IAA2D,EAArDL,UAAUhX,GAAKgC,GAAK+U,KAAK9W,GAAKgC,GAAK8U,KAAKoB,GAAKT,MAEvDrV,IADA5M,IAAMA,IACIA,IAAMyhB,MAAMG,KAAO3+D,GAAKw+D,MAAMG,IAAM,GAAK1+D,GAAKu+D,MAAMG,IAAM,GAAKS,IAE3E,IAAIrV,GAAK,GAAMtxB,GAAKA,GAAKC,GAAKA,GAAK2mC,GAAKA,GACxC,GAAItV,GAAK,EAAGH,GAAK,MACZ,CACH,IAAIgV,IAA2D,EAArDN,UAAUhX,GAAK2X,GAAKZ,KAAK9W,GAAK2X,GAAKb,KAAKoB,GAAK73E,MAEvDgiE,IADAG,IAAMA,IACIA,IAAMyU,MAAMI,KAAOnmC,GAAK+lC,MAAMI,IAAM,GAAKlmC,GAAK8lC,MAAMI,IAAM,GAAKS,IAE3E,IAAIK,GAAK,GAAMJ,GAAKA,GAAKC,GAAKA,GAAKC,GAAKA,GACxC,GAAIE,GAAK,EAAGX,GAAK,MACZ,CACH,IAAIY,IAAwD,EAAlDrB,UAAUhX,GAAK,EAAI+W,KAAK9W,GAAK,EAAI8W,KAAKoB,GAAK,KAErDV,IADAW,IAAMA,IACIA,IAAMlB,MAAMmB,KAAOL,GAAKd,MAAMmB,IAAM,GAAKJ,GAAKf,MAAMmB,IAAM,GAAKH,IAI3E,OAAO,IAAQ9V,GAAKC,GAAKC,GAAKmV,KAGhCa,QAAS,SAAS52F,EAAGC,EAAGC,EAAG6yE,GACzB,IAGI2N,GAAIC,GAAIC,GAAImV,GAAIc,GAqChBvW,GAAIC,GAAIyV,GAAIc,GACZb,GAAIC,GAAIt3E,GAAIm4E,GACZC,GAAIC,GAAIC,GAAIC,GA1CZ9B,KAAOrqG,KAAKqqG,KACZI,MAAQzqG,KAAKyqG,MAIbxkF,GAAKjR,EAAIC,EAAIC,EAAI6yE,GAAK4hB,GACtB/nG,EAAIuK,KAAK41B,MAAM/sB,EAAIiR,GACnBhkB,EAAIkK,KAAK41B,MAAM9sB,EAAIgR,GACnByoE,EAAIviF,KAAK41B,MAAM7sB,EAAI+Q,GACnBG,EAAIja,KAAK41B,MAAMgmD,EAAI9hE,GACnBnJ,GAAKlb,EAAIK,EAAIysF,EAAItoE,GAAKwjF,GAKtB99D,GAAK92B,GAJApT,EAAIkb,GAKTivB,GAAK92B,GAJAhT,EAAI6a,GAKTquF,GAAKj2F,GAJAw5E,EAAI5xE,GAKTsvF,GAAKrkB,GAJA3hE,EAAItJ,GAUTuvF,MAAQ,EACRC,MAAQ,EACRC,MAAQ,EACRC,MAAQ,EACR1gE,GAAKC,GAAIsgE,QACRC,QACDxgE,GAAKq/D,GAAIkB,QACRE,QACDzgE,GAAKsgE,GAAIC,QACRG,QACDzgE,GAAKo/D,GAAImB,QACRC,QACDxgE,GAAKqgE,GAAIE,QACRE,QACDrB,GAAKiB,GAAIG,QACRC,QAwBL,IAAIxgE,GAAKF,IAfTwpD,GAAK+W,OAAS,EAAI,EAAI,GAeHzC,GACf39D,GAAKF,IAfTwpD,GAAK+W,OAAS,EAAI,EAAI,GAeH1C,GACfwB,GAAKD,IAfTH,GAAKuB,OAAS,EAAI,EAAI,GAeH3C,GACf6C,GAAKL,IAfTN,GAAKU,OAAS,EAAI,EAAI,GAeH5C,GACfnlC,GAAK34B,IAdTm/D,GAAKoB,OAAS,EAAI,EAAI,GAcH,EAAMzC,GACrBllC,GAAK34B,IAdTm/D,GAAKoB,OAAS,EAAI,EAAI,GAcH,EAAM1C,GACrByB,GAAKF,IAdTv3E,GAAK24E,OAAS,EAAI,EAAI,GAcH,EAAM3C,GACrB8C,GAAKN,IAdTL,GAAKS,OAAS,EAAI,EAAI,GAcH,EAAM5C,GACrB0B,GAAKx/D,IAbTkgE,GAAKK,OAAS,EAAI,EAAI,GAaH,EAAMzC,GACrB2B,GAAKx/D,IAbTkgE,GAAKK,OAAS,EAAI,EAAI,GAaH,EAAM1C,GACrB4B,GAAKL,IAbTe,GAAKK,OAAS,EAAI,EAAI,GAaH,EAAM3C,GACrB+C,GAAKP,IAbTD,GAAKK,OAAS,EAAI,EAAI,GAaH,EAAM5C,GACrBgD,GAAK9gE,GAAK,EAAM,EAAM89D,GACtBiD,GAAK9gE,GAAK,EAAM,EAAM69D,GACtBkD,GAAK3B,GAAK,EAAM,EAAMvB,GACtBmD,GAAKX,GAAK,EAAM,EAAMxC,GAEtBtW,GAAS,IAAJ1xF,EACL2xF,GAAS,IAAJtxF,EACLwpG,GAAS,IAAJ/c,EACLse,GAAS,IAAJ5mF,EAELyvE,GAAK,GAAM/pD,GAAKA,GAAKC,GAAKA,GAAKo/D,GAAKA,GAAKiB,GAAKA,GAClD,GAAIvW,GAAK,EAAGH,GAAK,MACZ,CACH,IAAIgV,IAAOL,KAAK/W,GAAK+W,KAAK9W,GAAK8W,KAAKoB,GAAKpB,KAAK2C,OAAS,GAAM,EAE7DtX,IADAG,IAAMA,IACIA,IAAM4U,MAAMC,KAAO5+D,GAAK2+D,MAAMC,IAAM,GAAK3+D,GAAK0+D,MAAMC,IAAM,GAAKS,GAAKV,MAAMC,IAAM,GAAK0B,IAEjG,IAAIrjB,GAAK,GAAM/8C,GAAKA,GAAKC,GAAKA,GAAKm/D,GAAKA,GAAKqB,GAAKA,GAClD,GAAI1jB,GAAK,EAAG4M,GAAK,MACZ,CACH,IAAIgV,IAAON,KAAK/W,GAAKgC,GAAK+U,KAAK9W,GAAKgC,GAAK8U,KAAKoB,GAAKT,GAAKX,KAAK2C,GAAKlB,OAAS,GAAM,EAEjFnW,IADA5M,IAAMA,IACIA,IAAM0hB,MAAME,KAAO3+D,GAAKy+D,MAAME,IAAM,GAAK1+D,GAAKw+D,MAAME,IAAM,GAAKS,GAAKX,MAAME,IAAM,GAAK8B,IAEjG,IAAI1W,GAAK,GAAMtxB,GAAKA,GAAKC,GAAKA,GAAK2mC,GAAKA,GAAKqB,GAAKA,GAClD,GAAI3W,GAAK,EAAGH,GAAK,MACZ,CACH,IAAIgV,IAAOP,KAAK/W,GAAK2X,GAAKZ,KAAK9W,GAAK2X,GAAKb,KAAKoB,GAAK73E,GAAKy2E,KAAK2C,GAAKjB,OAAS,GAAM,EAEjFnW,IADAG,IAAMA,IACIA,IAAM0U,MAAMG,KAAOnmC,GAAKgmC,MAAMG,IAAM,GAAKlmC,GAAK+lC,MAAMG,IAAM,GAAKS,GAAKZ,MAAMG,IAAM,GAAK8B,IAEjG,IAAIhB,GAAK,GAAMJ,GAAKA,GAAKC,GAAKA,GAAKC,GAAKA,GAAKmB,GAAKA,GAClD,GAAIjB,GAAK,EAAGX,GAAK,MACZ,CACH,IAAIY,IAAOtB,KAAK/W,GAAK0Y,GAAK3B,KAAK9W,GAAK0Y,GAAK5B,KAAKoB,GAAKS,GAAK7B,KAAK2C,GAAKb,OAAS,GAAM,EAEjFpB,IADAW,IAAMA,IACIA,IAAMjB,MAAMkB,KAAOL,GAAKb,MAAMkB,IAAM,GAAKJ,GAAKd,MAAMkB,IAAM,GAAKH,GAAKf,MAAMkB,IAAM,GAAKgB,IAEjG,IAAIM,GAAK,GAAML,GAAKA,GAAKC,GAAKA,GAAKC,GAAKA,GAAKC,GAAKA,GAClD,GAAIE,GAAK,EAAGpB,GAAK,MACZ,CACH,IAAIqB,IAAO7C,KAAK/W,GAAK,EAAI+W,KAAK9W,GAAK,EAAI8W,KAAKoB,GAAK,EAAIpB,KAAK2C,GAAK,MAAQ,GAAM,EAE7EnB,IADAoB,IAAMA,IACIA,IAAMxC,MAAMyC,KAAON,GAAKnC,MAAMyC,IAAM,GAAKL,GAAKpC,MAAMyC,IAAM,GAAKJ,GAAKrC,MAAMyC,IAAM,GAAKH,IAGjG,OAAO,IAAQrX,GAAKC,GAAKC,GAAKmV,GAAKc,MAkBvCrC,aAAa2D,uBAAyB/C,2BAuDiB,KAANgD,yCAAmB,OAAO5D,cAApB,kGAEnBh1F,QAAQg1F,aAAeA,aAKzD5iF,OAAOpS,QAAUg1F,aAxbrB,KC5BI6D,yBAA2B,GAG/B,SAASC,oBAAoBC,UAE5B,GAAGF,yBAAyBE,UAC3B,OAAOF,yBAAyBE,UAAU/4F,QAG3C,IAAIoS,OAASymF,yBAAyBE,UAAY,CAGjD/4F,QAAS,IAOV,OAHAg5F,oBAAoBD,UAAU3mF,OAAQA,OAAOpS,QAAS84F,qBAG/C1mF,OAAOpS,QCnBf84F,oBAAoBrvD,EAAKr3B,SACxB,IAAI6mF,OAAS7mF,QAAUA,OAAO8mF,WAC7B,IAAM9mF,OAAgB,QACtB,IAAMA,OAEP,OADA0mF,oBAAoBx4E,EAAE24E,OAAQ,CAAEppF,EAAGopF,SAC5BA,QzUNJlvG,SAAW2S,OAAOy8F,eAAkBnvD,KAAQttC,OAAOy8F,eAAenvD,KAAQA,KAAQA,IAAIovD,UAQ1FN,oBAAoBxwF,EAAI,SAASmF,MAAO6mC,MAEvC,GADU,EAAPA,OAAU7mC,MAAQjiB,KAAKiiB,QAChB,EAAP6mC,KAAU,OAAO7mC,MACpB,GAAoB,iBAAVA,OAAsBA,MAAO,CACtC,GAAW,EAAP6mC,MAAa7mC,MAAMyrF,WAAY,OAAOzrF,MAC1C,GAAW,GAAP6mC,MAAoC,mBAAf7mC,MAAMxjB,KAAqB,OAAOwjB,MAE5D,IAAI4rF,GAAK38F,OAAOkB,OAAO,MACvBk7F,oBAAoBppF,EAAE2pF,IACtB,IAAIv7E,IAAM,GACVh0B,eAAiBA,gBAAkB,CAAC,KAAMC,SAAS,IAAKA,SAAS,IAAKA,SAASA,WAC/E,IAAI,IAAIoiC,QAAiB,EAAPmoB,MAAY7mC,MAAyB,iBAAX0e,WAAyBriC,eAAemQ,QAAQkyB,SAAUA,QAAUpiC,SAASoiC,SACxHzvB,OAAO48F,oBAAoBntE,SAASptB,SAAQC,KAAO8e,IAAI9e,KAAO,IAAMyO,MAAMzO,OAI3E,OAFA8e,IAAa,QAAI,IAAMrQ,MACvBqrF,oBAAoBx4E,EAAE+4E,GAAIv7E,KACnBu7E,I0UvBRP,oBAAoBx4E,EAAI,CAACtgB,QAASgb,cACjC,IAAI,IAAIhc,OAAOgc,WACX89E,oBAAoBjmG,EAAEmoB,WAAYhc,OAAS85F,oBAAoBjmG,EAAEmN,QAAShB,MAC5EtC,OAAO68F,eAAev5F,QAAShB,IAAK,CAAEgZ,YAAY,EAAMlK,IAAKkN,WAAWhc,QCJ3E85F,oBAAoBnpF,EAAI,WACvB,GAA0B,iBAAf6pF,WAAyB,OAAOA,WAC3C,IACC,OAAOhuG,MAAQ,IAAIiuG,SAAS,cAAb,GACd,MAAOhrG,GACR,GAAsB,iBAAXtE,OAAqB,OAAOA,QALjB,GCAxB2uG,oBAAoBjmG,EAAI,CAACm3C,IAAKtxB,OAAShc,OAAOhR,UAAU6jB,eAAe1S,KAAKmtC,IAAKtxB,MCCjFogF,oBAAoBppF,EAAK1P,UACH,oBAAXub,QAA0BA,OAAOm+E,aAC1Ch9F,OAAO68F,eAAev5F,QAASub,OAAOm+E,YAAa,CAAEjsF,MAAO,WAE7D/Q,OAAO68F,eAAev5F,QAAS,aAAc,CAAEyN,OAAO,KCHvDqrF,oBAAoB,I","file":"app.19810e6af6fc79f7b84f.js","sourcesContent":["var getProto = Object.getPrototypeOf ? (obj) => Object.getPrototypeOf(obj) : (obj) => obj.__proto__;\nvar leafPrototypes;\n// create a fake namespace object\n// mode & 1: value is a module id, require it\n// mode & 2: merge all properties of value into the ns\n// mode & 4: return value when already ns object\n// mode & 16: return value when it's Promise-like\n// mode & 8|1: behave like require\n__webpack_require__.t = function(value, mode) {\n\tif(mode & 1) value = this(value);\n\tif(mode & 8) return value;\n\tif(typeof value === 'object' && value) {\n\t\tif((mode & 4) && value.__esModule) return value;\n\t\tif((mode & 16) && typeof value.then === 'function') return value;\n\t}\n\tvar ns = Object.create(null);\n\t__webpack_require__.r(ns);\n\tvar def = {};\n\tleafPrototypes = leafPrototypes || [null, getProto({}), getProto([]), getProto(getProto)];\n\tfor(var current = mode & 2 && value; typeof current == 'object' && !~leafPrototypes.indexOf(current); current = getProto(current)) {\n\t\tObject.getOwnPropertyNames(current).forEach(key => def[key] = () => value[key]);\n\t}\n\tdef['default'] = () => value;\n\t__webpack_require__.d(ns, def);\n\treturn ns;\n};","import { loadImages } from './utils/ImageLoader';\r\nimport { Howler } from 'howler';\r\n\r\nloadImages().then(() => {\r\n    const { game } = require('./core/Game');\r\n\r\n    window.game = game;\r\n    window.ecs = game.ecs;\r\n\r\n    game.start();\r\n});\r\n\r\nHowler.volume(0);\r\n","const loadImage = (img) =>\n    new Promise((resolve, reject) => {\n        if (img.complete) {\n            resolve();\n        }\n\n        img.addEventListener('load', () => {\n            resolve();\n        });\n\n        img.addEventListener('error', (error) => {\n            reject(error);\n        });\n    });\n\nexport const loadImages = () => {\n    const imgs = Array.from(document.querySelectorAll('img'));\n\n    return Promise.all(imgs.map(loadImage));\n};\n","/*!\n *  howler.js v2.2.1\n *  howlerjs.com\n *\n *  (c) 2013-2020, James Simpson of GoldFire Studios\n *  goldfirestudios.com\n *\n *  MIT License\n */\n\n(function() {\n\n  'use strict';\n\n  /** Global Methods **/\n  /***************************************************************************/\n\n  /**\n   * Create the global controller. All contained methods and properties apply\n   * to all sounds that are currently playing or will be in the future.\n   */\n  var HowlerGlobal = function() {\n    this.init();\n  };\n  HowlerGlobal.prototype = {\n    /**\n     * Initialize the global Howler object.\n     * @return {Howler}\n     */\n    init: function() {\n      var self = this || Howler;\n\n      // Create a global ID counter.\n      self._counter = 1000;\n\n      // Pool of unlocked HTML5 Audio objects.\n      self._html5AudioPool = [];\n      self.html5PoolSize = 10;\n\n      // Internal properties.\n      self._codecs = {};\n      self._howls = [];\n      self._muted = false;\n      self._volume = 1;\n      self._canPlayEvent = 'canplaythrough';\n      self._navigator = (typeof window !== 'undefined' && window.navigator) ? window.navigator : null;\n\n      // Public properties.\n      self.masterGain = null;\n      self.noAudio = false;\n      self.usingWebAudio = true;\n      self.autoSuspend = true;\n      self.ctx = null;\n\n      // Set to false to disable the auto audio unlocker.\n      self.autoUnlock = true;\n\n      // Setup the various state values for global tracking.\n      self._setup();\n\n      return self;\n    },\n\n    /**\n     * Get/set the global volume for all sounds.\n     * @param  {Float} vol Volume from 0.0 to 1.0.\n     * @return {Howler/Float}     Returns self or current volume.\n     */\n    volume: function(vol) {\n      var self = this || Howler;\n      vol = parseFloat(vol);\n\n      // If we don't have an AudioContext created yet, run the setup.\n      if (!self.ctx) {\n        setupAudioContext();\n      }\n\n      if (typeof vol !== 'undefined' && vol >= 0 && vol <= 1) {\n        self._volume = vol;\n\n        // Don't update any of the nodes if we are muted.\n        if (self._muted) {\n          return self;\n        }\n\n        // When using Web Audio, we just need to adjust the master gain.\n        if (self.usingWebAudio) {\n          self.masterGain.gain.setValueAtTime(vol, Howler.ctx.currentTime);\n        }\n\n        // Loop through and change volume for all HTML5 audio nodes.\n        for (var i=0; i<self._howls.length; i++) {\n          if (!self._howls[i]._webAudio) {\n            // Get all of the sounds in this Howl group.\n            var ids = self._howls[i]._getSoundIds();\n\n            // Loop through all sounds and change the volumes.\n            for (var j=0; j<ids.length; j++) {\n              var sound = self._howls[i]._soundById(ids[j]);\n\n              if (sound && sound._node) {\n                sound._node.volume = sound._volume * vol;\n              }\n            }\n          }\n        }\n\n        return self;\n      }\n\n      return self._volume;\n    },\n\n    /**\n     * Handle muting and unmuting globally.\n     * @param  {Boolean} muted Is muted or not.\n     */\n    mute: function(muted) {\n      var self = this || Howler;\n\n      // If we don't have an AudioContext created yet, run the setup.\n      if (!self.ctx) {\n        setupAudioContext();\n      }\n\n      self._muted = muted;\n\n      // With Web Audio, we just need to mute the master gain.\n      if (self.usingWebAudio) {\n        self.masterGain.gain.setValueAtTime(muted ? 0 : self._volume, Howler.ctx.currentTime);\n      }\n\n      // Loop through and mute all HTML5 Audio nodes.\n      for (var i=0; i<self._howls.length; i++) {\n        if (!self._howls[i]._webAudio) {\n          // Get all of the sounds in this Howl group.\n          var ids = self._howls[i]._getSoundIds();\n\n          // Loop through all sounds and mark the audio node as muted.\n          for (var j=0; j<ids.length; j++) {\n            var sound = self._howls[i]._soundById(ids[j]);\n\n            if (sound && sound._node) {\n              sound._node.muted = (muted) ? true : sound._muted;\n            }\n          }\n        }\n      }\n\n      return self;\n    },\n\n    /**\n     * Handle stopping all sounds globally.\n     */\n    stop: function() {\n      var self = this || Howler;\n\n      // Loop through all Howls and stop them.\n      for (var i=0; i<self._howls.length; i++) {\n        self._howls[i].stop();\n      }\n\n      return self;\n    },\n\n    /**\n     * Unload and destroy all currently loaded Howl objects.\n     * @return {Howler}\n     */\n    unload: function() {\n      var self = this || Howler;\n\n      for (var i=self._howls.length-1; i>=0; i--) {\n        self._howls[i].unload();\n      }\n\n      // Create a new AudioContext to make sure it is fully reset.\n      if (self.usingWebAudio && self.ctx && typeof self.ctx.close !== 'undefined') {\n        self.ctx.close();\n        self.ctx = null;\n        setupAudioContext();\n      }\n\n      return self;\n    },\n\n    /**\n     * Check for codec support of specific extension.\n     * @param  {String} ext Audio file extention.\n     * @return {Boolean}\n     */\n    codecs: function(ext) {\n      return (this || Howler)._codecs[ext.replace(/^x-/, '')];\n    },\n\n    /**\n     * Setup various state values for global tracking.\n     * @return {Howler}\n     */\n    _setup: function() {\n      var self = this || Howler;\n\n      // Keeps track of the suspend/resume state of the AudioContext.\n      self.state = self.ctx ? self.ctx.state || 'suspended' : 'suspended';\n\n      // Automatically begin the 30-second suspend process\n      self._autoSuspend();\n\n      // Check if audio is available.\n      if (!self.usingWebAudio) {\n        // No audio is available on this system if noAudio is set to true.\n        if (typeof Audio !== 'undefined') {\n          try {\n            var test = new Audio();\n\n            // Check if the canplaythrough event is available.\n            if (typeof test.oncanplaythrough === 'undefined') {\n              self._canPlayEvent = 'canplay';\n            }\n          } catch(e) {\n            self.noAudio = true;\n          }\n        } else {\n          self.noAudio = true;\n        }\n      }\n\n      // Test to make sure audio isn't disabled in Internet Explorer.\n      try {\n        var test = new Audio();\n        if (test.muted) {\n          self.noAudio = true;\n        }\n      } catch (e) {}\n\n      // Check for supported codecs.\n      if (!self.noAudio) {\n        self._setupCodecs();\n      }\n\n      return self;\n    },\n\n    /**\n     * Check for browser support for various codecs and cache the results.\n     * @return {Howler}\n     */\n    _setupCodecs: function() {\n      var self = this || Howler;\n      var audioTest = null;\n\n      // Must wrap in a try/catch because IE11 in server mode throws an error.\n      try {\n        audioTest = (typeof Audio !== 'undefined') ? new Audio() : null;\n      } catch (err) {\n        return self;\n      }\n\n      if (!audioTest || typeof audioTest.canPlayType !== 'function') {\n        return self;\n      }\n\n      var mpegTest = audioTest.canPlayType('audio/mpeg;').replace(/^no$/, '');\n\n      // Opera version <33 has mixed MP3 support, so we need to check for and block it.\n      var checkOpera = self._navigator && self._navigator.userAgent.match(/OPR\\/([0-6].)/g);\n      var isOldOpera = (checkOpera && parseInt(checkOpera[0].split('/')[1], 10) < 33);\n\n      self._codecs = {\n        mp3: !!(!isOldOpera && (mpegTest || audioTest.canPlayType('audio/mp3;').replace(/^no$/, ''))),\n        mpeg: !!mpegTest,\n        opus: !!audioTest.canPlayType('audio/ogg; codecs=\"opus\"').replace(/^no$/, ''),\n        ogg: !!audioTest.canPlayType('audio/ogg; codecs=\"vorbis\"').replace(/^no$/, ''),\n        oga: !!audioTest.canPlayType('audio/ogg; codecs=\"vorbis\"').replace(/^no$/, ''),\n        wav: !!(audioTest.canPlayType('audio/wav; codecs=\"1\"') || audioTest.canPlayType('audio/wav')).replace(/^no$/, ''),\n        aac: !!audioTest.canPlayType('audio/aac;').replace(/^no$/, ''),\n        caf: !!audioTest.canPlayType('audio/x-caf;').replace(/^no$/, ''),\n        m4a: !!(audioTest.canPlayType('audio/x-m4a;') || audioTest.canPlayType('audio/m4a;') || audioTest.canPlayType('audio/aac;')).replace(/^no$/, ''),\n        m4b: !!(audioTest.canPlayType('audio/x-m4b;') || audioTest.canPlayType('audio/m4b;') || audioTest.canPlayType('audio/aac;')).replace(/^no$/, ''),\n        mp4: !!(audioTest.canPlayType('audio/x-mp4;') || audioTest.canPlayType('audio/mp4;') || audioTest.canPlayType('audio/aac;')).replace(/^no$/, ''),\n        weba: !!audioTest.canPlayType('audio/webm; codecs=\"vorbis\"').replace(/^no$/, ''),\n        webm: !!audioTest.canPlayType('audio/webm; codecs=\"vorbis\"').replace(/^no$/, ''),\n        dolby: !!audioTest.canPlayType('audio/mp4; codecs=\"ec-3\"').replace(/^no$/, ''),\n        flac: !!(audioTest.canPlayType('audio/x-flac;') || audioTest.canPlayType('audio/flac;')).replace(/^no$/, '')\n      };\n\n      return self;\n    },\n\n    /**\n     * Some browsers/devices will only allow audio to be played after a user interaction.\n     * Attempt to automatically unlock audio on the first user interaction.\n     * Concept from: http://paulbakaus.com/tutorials/html5/web-audio-on-ios/\n     * @return {Howler}\n     */\n    _unlockAudio: function() {\n      var self = this || Howler;\n\n      // Only run this if Web Audio is supported and it hasn't already been unlocked.\n      if (self._audioUnlocked || !self.ctx) {\n        return;\n      }\n\n      self._audioUnlocked = false;\n      self.autoUnlock = false;\n\n      // Some mobile devices/platforms have distortion issues when opening/closing tabs and/or web views.\n      // Bugs in the browser (especially Mobile Safari) can cause the sampleRate to change from 44100 to 48000.\n      // By calling Howler.unload(), we create a new AudioContext with the correct sampleRate.\n      if (!self._mobileUnloaded && self.ctx.sampleRate !== 44100) {\n        self._mobileUnloaded = true;\n        self.unload();\n      }\n\n      // Scratch buffer for enabling iOS to dispose of web audio buffers correctly, as per:\n      // http://stackoverflow.com/questions/24119684\n      self._scratchBuffer = self.ctx.createBuffer(1, 1, 22050);\n\n      // Call this method on touch start to create and play a buffer,\n      // then check if the audio actually played to determine if\n      // audio has now been unlocked on iOS, Android, etc.\n      var unlock = function(e) {\n        // Create a pool of unlocked HTML5 Audio objects that can\n        // be used for playing sounds without user interaction. HTML5\n        // Audio objects must be individually unlocked, as opposed\n        // to the WebAudio API which only needs a single activation.\n        // This must occur before WebAudio setup or the source.onended\n        // event will not fire.\n        while (self._html5AudioPool.length < self.html5PoolSize) {\n          try {\n            var audioNode = new Audio();\n\n            // Mark this Audio object as unlocked to ensure it can get returned\n            // to the unlocked pool when released.\n            audioNode._unlocked = true;\n\n            // Add the audio node to the pool.\n            self._releaseHtml5Audio(audioNode);\n          } catch (e) {\n            self.noAudio = true;\n            break;\n          }\n        }\n\n        // Loop through any assigned audio nodes and unlock them.\n        for (var i=0; i<self._howls.length; i++) {\n          if (!self._howls[i]._webAudio) {\n            // Get all of the sounds in this Howl group.\n            var ids = self._howls[i]._getSoundIds();\n\n            // Loop through all sounds and unlock the audio nodes.\n            for (var j=0; j<ids.length; j++) {\n              var sound = self._howls[i]._soundById(ids[j]);\n\n              if (sound && sound._node && !sound._node._unlocked) {\n                sound._node._unlocked = true;\n                sound._node.load();\n              }\n            }\n          }\n        }\n\n        // Fix Android can not play in suspend state.\n        self._autoResume();\n\n        // Create an empty buffer.\n        var source = self.ctx.createBufferSource();\n        source.buffer = self._scratchBuffer;\n        source.connect(self.ctx.destination);\n\n        // Play the empty buffer.\n        if (typeof source.start === 'undefined') {\n          source.noteOn(0);\n        } else {\n          source.start(0);\n        }\n\n        // Calling resume() on a stack initiated by user gesture is what actually unlocks the audio on Android Chrome >= 55.\n        if (typeof self.ctx.resume === 'function') {\n          self.ctx.resume();\n        }\n\n        // Setup a timeout to check that we are unlocked on the next event loop.\n        source.onended = function() {\n          source.disconnect(0);\n\n          // Update the unlocked state and prevent this check from happening again.\n          self._audioUnlocked = true;\n\n          // Remove the touch start listener.\n          document.removeEventListener('touchstart', unlock, true);\n          document.removeEventListener('touchend', unlock, true);\n          document.removeEventListener('click', unlock, true);\n\n          // Let all sounds know that audio has been unlocked.\n          for (var i=0; i<self._howls.length; i++) {\n            self._howls[i]._emit('unlock');\n          }\n        };\n      };\n\n      // Setup a touch start listener to attempt an unlock in.\n      document.addEventListener('touchstart', unlock, true);\n      document.addEventListener('touchend', unlock, true);\n      document.addEventListener('click', unlock, true);\n\n      return self;\n    },\n\n    /**\n     * Get an unlocked HTML5 Audio object from the pool. If none are left,\n     * return a new Audio object and throw a warning.\n     * @return {Audio} HTML5 Audio object.\n     */\n    _obtainHtml5Audio: function() {\n      var self = this || Howler;\n\n      // Return the next object from the pool if one exists.\n      if (self._html5AudioPool.length) {\n        return self._html5AudioPool.pop();\n      }\n\n      //.Check if the audio is locked and throw a warning.\n      var testPlay = new Audio().play();\n      if (testPlay && typeof Promise !== 'undefined' && (testPlay instanceof Promise || typeof testPlay.then === 'function')) {\n        testPlay.catch(function() {\n          console.warn('HTML5 Audio pool exhausted, returning potentially locked audio object.');\n        });\n      }\n\n      return new Audio();\n    },\n\n    /**\n     * Return an activated HTML5 Audio object to the pool.\n     * @return {Howler}\n     */\n    _releaseHtml5Audio: function(audio) {\n      var self = this || Howler;\n\n      // Don't add audio to the pool if we don't know if it has been unlocked.\n      if (audio._unlocked) {\n        self._html5AudioPool.push(audio);\n      }\n\n      return self;\n    },\n\n    /**\n     * Automatically suspend the Web Audio AudioContext after no sound has played for 30 seconds.\n     * This saves processing/energy and fixes various browser-specific bugs with audio getting stuck.\n     * @return {Howler}\n     */\n    _autoSuspend: function() {\n      var self = this;\n\n      if (!self.autoSuspend || !self.ctx || typeof self.ctx.suspend === 'undefined' || !Howler.usingWebAudio) {\n        return;\n      }\n\n      // Check if any sounds are playing.\n      for (var i=0; i<self._howls.length; i++) {\n        if (self._howls[i]._webAudio) {\n          for (var j=0; j<self._howls[i]._sounds.length; j++) {\n            if (!self._howls[i]._sounds[j]._paused) {\n              return self;\n            }\n          }\n        }\n      }\n\n      if (self._suspendTimer) {\n        clearTimeout(self._suspendTimer);\n      }\n\n      // If no sound has played after 30 seconds, suspend the context.\n      self._suspendTimer = setTimeout(function() {\n        if (!self.autoSuspend) {\n          return;\n        }\n\n        self._suspendTimer = null;\n        self.state = 'suspending';\n\n        // Handle updating the state of the audio context after suspending.\n        var handleSuspension = function() {\n          self.state = 'suspended';\n\n          if (self._resumeAfterSuspend) {\n            delete self._resumeAfterSuspend;\n            self._autoResume();\n          }\n        };\n\n        // Either the state gets suspended or it is interrupted.\n        // Either way, we need to update the state to suspended.\n        self.ctx.suspend().then(handleSuspension, handleSuspension);\n      }, 30000);\n\n      return self;\n    },\n\n    /**\n     * Automatically resume the Web Audio AudioContext when a new sound is played.\n     * @return {Howler}\n     */\n    _autoResume: function() {\n      var self = this;\n\n      if (!self.ctx || typeof self.ctx.resume === 'undefined' || !Howler.usingWebAudio) {\n        return;\n      }\n\n      if (self.state === 'running' && self.ctx.state !== 'interrupted' && self._suspendTimer) {\n        clearTimeout(self._suspendTimer);\n        self._suspendTimer = null;\n      } else if (self.state === 'suspended' || self.state === 'running' && self.ctx.state === 'interrupted') {\n        self.ctx.resume().then(function() {\n          self.state = 'running';\n\n          // Emit to all Howls that the audio has resumed.\n          for (var i=0; i<self._howls.length; i++) {\n            self._howls[i]._emit('resume');\n          }\n        });\n\n        if (self._suspendTimer) {\n          clearTimeout(self._suspendTimer);\n          self._suspendTimer = null;\n        }\n      } else if (self.state === 'suspending') {\n        self._resumeAfterSuspend = true;\n      }\n\n      return self;\n    }\n  };\n\n  // Setup the global audio controller.\n  var Howler = new HowlerGlobal();\n\n  /** Group Methods **/\n  /***************************************************************************/\n\n  /**\n   * Create an audio group controller.\n   * @param {Object} o Passed in properties for this group.\n   */\n  var Howl = function(o) {\n    var self = this;\n\n    // Throw an error if no source is provided.\n    if (!o.src || o.src.length === 0) {\n      console.error('An array of source files must be passed with any new Howl.');\n      return;\n    }\n\n    self.init(o);\n  };\n  Howl.prototype = {\n    /**\n     * Initialize a new Howl group object.\n     * @param  {Object} o Passed in properties for this group.\n     * @return {Howl}\n     */\n    init: function(o) {\n      var self = this;\n\n      // If we don't have an AudioContext created yet, run the setup.\n      if (!Howler.ctx) {\n        setupAudioContext();\n      }\n\n      // Setup user-defined default properties.\n      self._autoplay = o.autoplay || false;\n      self._format = (typeof o.format !== 'string') ? o.format : [o.format];\n      self._html5 = o.html5 || false;\n      self._muted = o.mute || false;\n      self._loop = o.loop || false;\n      self._pool = o.pool || 5;\n      self._preload = (typeof o.preload === 'boolean' || o.preload === 'metadata') ? o.preload : true;\n      self._rate = o.rate || 1;\n      self._sprite = o.sprite || {};\n      self._src = (typeof o.src !== 'string') ? o.src : [o.src];\n      self._volume = o.volume !== undefined ? o.volume : 1;\n      self._xhr = {\n        method: o.xhr && o.xhr.method ? o.xhr.method : 'GET',\n        headers: o.xhr && o.xhr.headers ? o.xhr.headers : null,\n        withCredentials: o.xhr && o.xhr.withCredentials ? o.xhr.withCredentials : false,\n      };\n\n      // Setup all other default properties.\n      self._duration = 0;\n      self._state = 'unloaded';\n      self._sounds = [];\n      self._endTimers = {};\n      self._queue = [];\n      self._playLock = false;\n\n      // Setup event listeners.\n      self._onend = o.onend ? [{fn: o.onend}] : [];\n      self._onfade = o.onfade ? [{fn: o.onfade}] : [];\n      self._onload = o.onload ? [{fn: o.onload}] : [];\n      self._onloaderror = o.onloaderror ? [{fn: o.onloaderror}] : [];\n      self._onplayerror = o.onplayerror ? [{fn: o.onplayerror}] : [];\n      self._onpause = o.onpause ? [{fn: o.onpause}] : [];\n      self._onplay = o.onplay ? [{fn: o.onplay}] : [];\n      self._onstop = o.onstop ? [{fn: o.onstop}] : [];\n      self._onmute = o.onmute ? [{fn: o.onmute}] : [];\n      self._onvolume = o.onvolume ? [{fn: o.onvolume}] : [];\n      self._onrate = o.onrate ? [{fn: o.onrate}] : [];\n      self._onseek = o.onseek ? [{fn: o.onseek}] : [];\n      self._onunlock = o.onunlock ? [{fn: o.onunlock}] : [];\n      self._onresume = [];\n\n      // Web Audio or HTML5 Audio?\n      self._webAudio = Howler.usingWebAudio && !self._html5;\n\n      // Automatically try to enable audio.\n      if (typeof Howler.ctx !== 'undefined' && Howler.ctx && Howler.autoUnlock) {\n        Howler._unlockAudio();\n      }\n\n      // Keep track of this Howl group in the global controller.\n      Howler._howls.push(self);\n\n      // If they selected autoplay, add a play event to the load queue.\n      if (self._autoplay) {\n        self._queue.push({\n          event: 'play',\n          action: function() {\n            self.play();\n          }\n        });\n      }\n\n      // Load the source file unless otherwise specified.\n      if (self._preload && self._preload !== 'none') {\n        self.load();\n      }\n\n      return self;\n    },\n\n    /**\n     * Load the audio file.\n     * @return {Howler}\n     */\n    load: function() {\n      var self = this;\n      var url = null;\n\n      // If no audio is available, quit immediately.\n      if (Howler.noAudio) {\n        self._emit('loaderror', null, 'No audio support.');\n        return;\n      }\n\n      // Make sure our source is in an array.\n      if (typeof self._src === 'string') {\n        self._src = [self._src];\n      }\n\n      // Loop through the sources and pick the first one that is compatible.\n      for (var i=0; i<self._src.length; i++) {\n        var ext, str;\n\n        if (self._format && self._format[i]) {\n          // If an extension was specified, use that instead.\n          ext = self._format[i];\n        } else {\n          // Make sure the source is a string.\n          str = self._src[i];\n          if (typeof str !== 'string') {\n            self._emit('loaderror', null, 'Non-string found in selected audio sources - ignoring.');\n            continue;\n          }\n\n          // Extract the file extension from the URL or base64 data URI.\n          ext = /^data:audio\\/([^;,]+);/i.exec(str);\n          if (!ext) {\n            ext = /\\.([^.]+)$/.exec(str.split('?', 1)[0]);\n          }\n\n          if (ext) {\n            ext = ext[1].toLowerCase();\n          }\n        }\n\n        // Log a warning if no extension was found.\n        if (!ext) {\n          console.warn('No file extension was found. Consider using the \"format\" property or specify an extension.');\n        }\n\n        // Check if this extension is available.\n        if (ext && Howler.codecs(ext)) {\n          url = self._src[i];\n          break;\n        }\n      }\n\n      if (!url) {\n        self._emit('loaderror', null, 'No codec support for selected audio sources.');\n        return;\n      }\n\n      self._src = url;\n      self._state = 'loading';\n\n      // If the hosting page is HTTPS and the source isn't,\n      // drop down to HTML5 Audio to avoid Mixed Content errors.\n      if (window.location.protocol === 'https:' && url.slice(0, 5) === 'http:') {\n        self._html5 = true;\n        self._webAudio = false;\n      }\n\n      // Create a new sound object and add it to the pool.\n      new Sound(self);\n\n      // Load and decode the audio data for playback.\n      if (self._webAudio) {\n        loadBuffer(self);\n      }\n\n      return self;\n    },\n\n    /**\n     * Play a sound or resume previous playback.\n     * @param  {String/Number} sprite   Sprite name for sprite playback or sound id to continue previous.\n     * @param  {Boolean} internal Internal Use: true prevents event firing.\n     * @return {Number}          Sound ID.\n     */\n    play: function(sprite, internal) {\n      var self = this;\n      var id = null;\n\n      // Determine if a sprite, sound id or nothing was passed\n      if (typeof sprite === 'number') {\n        id = sprite;\n        sprite = null;\n      } else if (typeof sprite === 'string' && self._state === 'loaded' && !self._sprite[sprite]) {\n        // If the passed sprite doesn't exist, do nothing.\n        return null;\n      } else if (typeof sprite === 'undefined') {\n        // Use the default sound sprite (plays the full audio length).\n        sprite = '__default';\n\n        // Check if there is a single paused sound that isn't ended.\n        // If there is, play that sound. If not, continue as usual.\n        if (!self._playLock) {\n          var num = 0;\n          for (var i=0; i<self._sounds.length; i++) {\n            if (self._sounds[i]._paused && !self._sounds[i]._ended) {\n              num++;\n              id = self._sounds[i]._id;\n            }\n          }\n\n          if (num === 1) {\n            sprite = null;\n          } else {\n            id = null;\n          }\n        }\n      }\n\n      // Get the selected node, or get one from the pool.\n      var sound = id ? self._soundById(id) : self._inactiveSound();\n\n      // If the sound doesn't exist, do nothing.\n      if (!sound) {\n        return null;\n      }\n\n      // Select the sprite definition.\n      if (id && !sprite) {\n        sprite = sound._sprite || '__default';\n      }\n\n      // If the sound hasn't loaded, we must wait to get the audio's duration.\n      // We also need to wait to make sure we don't run into race conditions with\n      // the order of function calls.\n      if (self._state !== 'loaded') {\n        // Set the sprite value on this sound.\n        sound._sprite = sprite;\n\n        // Mark this sound as not ended in case another sound is played before this one loads.\n        sound._ended = false;\n\n        // Add the sound to the queue to be played on load.\n        var soundId = sound._id;\n        self._queue.push({\n          event: 'play',\n          action: function() {\n            self.play(soundId);\n          }\n        });\n\n        return soundId;\n      }\n\n      // Don't play the sound if an id was passed and it is already playing.\n      if (id && !sound._paused) {\n        // Trigger the play event, in order to keep iterating through queue.\n        if (!internal) {\n          self._loadQueue('play');\n        }\n\n        return sound._id;\n      }\n\n      // Make sure the AudioContext isn't suspended, and resume it if it is.\n      if (self._webAudio) {\n        Howler._autoResume();\n      }\n\n      // Determine how long to play for and where to start playing.\n      var seek = Math.max(0, sound._seek > 0 ? sound._seek : self._sprite[sprite][0] / 1000);\n      var duration = Math.max(0, ((self._sprite[sprite][0] + self._sprite[sprite][1]) / 1000) - seek);\n      var timeout = (duration * 1000) / Math.abs(sound._rate);\n      var start = self._sprite[sprite][0] / 1000;\n      var stop = (self._sprite[sprite][0] + self._sprite[sprite][1]) / 1000;\n      sound._sprite = sprite;\n\n      // Mark the sound as ended instantly so that this async playback\n      // doesn't get grabbed by another call to play while this one waits to start.\n      sound._ended = false;\n\n      // Update the parameters of the sound.\n      var setParams = function() {\n        sound._paused = false;\n        sound._seek = seek;\n        sound._start = start;\n        sound._stop = stop;\n        sound._loop = !!(sound._loop || self._sprite[sprite][2]);\n      };\n\n      // End the sound instantly if seek is at the end.\n      if (seek >= stop) {\n        self._ended(sound);\n        return;\n      }\n\n      // Begin the actual playback.\n      var node = sound._node;\n      if (self._webAudio) {\n        // Fire this when the sound is ready to play to begin Web Audio playback.\n        var playWebAudio = function() {\n          self._playLock = false;\n          setParams();\n          self._refreshBuffer(sound);\n\n          // Setup the playback params.\n          var vol = (sound._muted || self._muted) ? 0 : sound._volume;\n          node.gain.setValueAtTime(vol, Howler.ctx.currentTime);\n          sound._playStart = Howler.ctx.currentTime;\n\n          // Play the sound using the supported method.\n          if (typeof node.bufferSource.start === 'undefined') {\n            sound._loop ? node.bufferSource.noteGrainOn(0, seek, 86400) : node.bufferSource.noteGrainOn(0, seek, duration);\n          } else {\n            sound._loop ? node.bufferSource.start(0, seek, 86400) : node.bufferSource.start(0, seek, duration);\n          }\n\n          // Start a new timer if none is present.\n          if (timeout !== Infinity) {\n            self._endTimers[sound._id] = setTimeout(self._ended.bind(self, sound), timeout);\n          }\n\n          if (!internal) {\n            setTimeout(function() {\n              self._emit('play', sound._id);\n              self._loadQueue();\n            }, 0);\n          }\n        };\n\n        if (Howler.state === 'running' && Howler.ctx.state !== 'interrupted') {\n          playWebAudio();\n        } else {\n          self._playLock = true;\n\n          // Wait for the audio context to resume before playing.\n          self.once('resume', playWebAudio);\n\n          // Cancel the end timer.\n          self._clearTimer(sound._id);\n        }\n      } else {\n        // Fire this when the sound is ready to play to begin HTML5 Audio playback.\n        var playHtml5 = function() {\n          node.currentTime = seek;\n          node.muted = sound._muted || self._muted || Howler._muted || node.muted;\n          node.volume = sound._volume * Howler.volume();\n          node.playbackRate = sound._rate;\n\n          // Some browsers will throw an error if this is called without user interaction.\n          try {\n            var play = node.play();\n\n            // Support older browsers that don't support promises, and thus don't have this issue.\n            if (play && typeof Promise !== 'undefined' && (play instanceof Promise || typeof play.then === 'function')) {\n              // Implements a lock to prevent DOMException: The play() request was interrupted by a call to pause().\n              self._playLock = true;\n\n              // Set param values immediately.\n              setParams();\n\n              // Releases the lock and executes queued actions.\n              play\n                .then(function() {\n                  self._playLock = false;\n                  node._unlocked = true;\n                  if (!internal) {\n                    self._emit('play', sound._id);\n                    self._loadQueue();\n                  }\n                })\n                .catch(function() {\n                  self._playLock = false;\n                  self._emit('playerror', sound._id, 'Playback was unable to start. This is most commonly an issue ' +\n                    'on mobile devices and Chrome where playback was not within a user interaction.');\n\n                  // Reset the ended and paused values.\n                  sound._ended = true;\n                  sound._paused = true;\n                });\n            } else if (!internal) {\n              self._playLock = false;\n              setParams();\n              self._emit('play', sound._id);\n              self._loadQueue();\n            }\n\n            // Setting rate before playing won't work in IE, so we set it again here.\n            node.playbackRate = sound._rate;\n\n            // If the node is still paused, then we can assume there was a playback issue.\n            if (node.paused) {\n              self._emit('playerror', sound._id, 'Playback was unable to start. This is most commonly an issue ' +\n                'on mobile devices and Chrome where playback was not within a user interaction.');\n              return;\n            }\n\n            // Setup the end timer on sprites or listen for the ended event.\n            if (sprite !== '__default' || sound._loop) {\n              self._endTimers[sound._id] = setTimeout(self._ended.bind(self, sound), timeout);\n            } else {\n              self._endTimers[sound._id] = function() {\n                // Fire ended on this audio node.\n                self._ended(sound);\n\n                // Clear this listener.\n                node.removeEventListener('ended', self._endTimers[sound._id], false);\n              };\n              node.addEventListener('ended', self._endTimers[sound._id], false);\n            }\n          } catch (err) {\n            self._emit('playerror', sound._id, err);\n          }\n        };\n\n        // If this is streaming audio, make sure the src is set and load again.\n        if (node.src === 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA') {\n          node.src = self._src;\n          node.load();\n        }\n\n        // Play immediately if ready, or wait for the 'canplaythrough'e vent.\n        var loadedNoReadyState = (window && window.ejecta) || (!node.readyState && Howler._navigator.isCocoonJS);\n        if (node.readyState >= 3 || loadedNoReadyState) {\n          playHtml5();\n        } else {\n          self._playLock = true;\n\n          var listener = function() {\n            // Begin playback.\n            playHtml5();\n\n            // Clear this listener.\n            node.removeEventListener(Howler._canPlayEvent, listener, false);\n          };\n          node.addEventListener(Howler._canPlayEvent, listener, false);\n\n          // Cancel the end timer.\n          self._clearTimer(sound._id);\n        }\n      }\n\n      return sound._id;\n    },\n\n    /**\n     * Pause playback and save current position.\n     * @param  {Number} id The sound ID (empty to pause all in group).\n     * @return {Howl}\n     */\n    pause: function(id) {\n      var self = this;\n\n      // If the sound hasn't loaded or a play() promise is pending, add it to the load queue to pause when capable.\n      if (self._state !== 'loaded' || self._playLock) {\n        self._queue.push({\n          event: 'pause',\n          action: function() {\n            self.pause(id);\n          }\n        });\n\n        return self;\n      }\n\n      // If no id is passed, get all ID's to be paused.\n      var ids = self._getSoundIds(id);\n\n      for (var i=0; i<ids.length; i++) {\n        // Clear the end timer.\n        self._clearTimer(ids[i]);\n\n        // Get the sound.\n        var sound = self._soundById(ids[i]);\n\n        if (sound && !sound._paused) {\n          // Reset the seek position.\n          sound._seek = self.seek(ids[i]);\n          sound._rateSeek = 0;\n          sound._paused = true;\n\n          // Stop currently running fades.\n          self._stopFade(ids[i]);\n\n          if (sound._node) {\n            if (self._webAudio) {\n              // Make sure the sound has been created.\n              if (!sound._node.bufferSource) {\n                continue;\n              }\n\n              if (typeof sound._node.bufferSource.stop === 'undefined') {\n                sound._node.bufferSource.noteOff(0);\n              } else {\n                sound._node.bufferSource.stop(0);\n              }\n\n              // Clean up the buffer source.\n              self._cleanBuffer(sound._node);\n            } else if (!isNaN(sound._node.duration) || sound._node.duration === Infinity) {\n              sound._node.pause();\n            }\n          }\n        }\n\n        // Fire the pause event, unless `true` is passed as the 2nd argument.\n        if (!arguments[1]) {\n          self._emit('pause', sound ? sound._id : null);\n        }\n      }\n\n      return self;\n    },\n\n    /**\n     * Stop playback and reset to start.\n     * @param  {Number} id The sound ID (empty to stop all in group).\n     * @param  {Boolean} internal Internal Use: true prevents event firing.\n     * @return {Howl}\n     */\n    stop: function(id, internal) {\n      var self = this;\n\n      // If the sound hasn't loaded, add it to the load queue to stop when capable.\n      if (self._state !== 'loaded' || self._playLock) {\n        self._queue.push({\n          event: 'stop',\n          action: function() {\n            self.stop(id);\n          }\n        });\n\n        return self;\n      }\n\n      // If no id is passed, get all ID's to be stopped.\n      var ids = self._getSoundIds(id);\n\n      for (var i=0; i<ids.length; i++) {\n        // Clear the end timer.\n        self._clearTimer(ids[i]);\n\n        // Get the sound.\n        var sound = self._soundById(ids[i]);\n\n        if (sound) {\n          // Reset the seek position.\n          sound._seek = sound._start || 0;\n          sound._rateSeek = 0;\n          sound._paused = true;\n          sound._ended = true;\n\n          // Stop currently running fades.\n          self._stopFade(ids[i]);\n\n          if (sound._node) {\n            if (self._webAudio) {\n              // Make sure the sound's AudioBufferSourceNode has been created.\n              if (sound._node.bufferSource) {\n                if (typeof sound._node.bufferSource.stop === 'undefined') {\n                  sound._node.bufferSource.noteOff(0);\n                } else {\n                  sound._node.bufferSource.stop(0);\n                }\n\n                // Clean up the buffer source.\n                self._cleanBuffer(sound._node);\n              }\n            } else if (!isNaN(sound._node.duration) || sound._node.duration === Infinity) {\n              sound._node.currentTime = sound._start || 0;\n              sound._node.pause();\n\n              // If this is a live stream, stop download once the audio is stopped.\n              if (sound._node.duration === Infinity) {\n                self._clearSound(sound._node);\n              }\n            }\n          }\n\n          if (!internal) {\n            self._emit('stop', sound._id);\n          }\n        }\n      }\n\n      return self;\n    },\n\n    /**\n     * Mute/unmute a single sound or all sounds in this Howl group.\n     * @param  {Boolean} muted Set to true to mute and false to unmute.\n     * @param  {Number} id    The sound ID to update (omit to mute/unmute all).\n     * @return {Howl}\n     */\n    mute: function(muted, id) {\n      var self = this;\n\n      // If the sound hasn't loaded, add it to the load queue to mute when capable.\n      if (self._state !== 'loaded'|| self._playLock) {\n        self._queue.push({\n          event: 'mute',\n          action: function() {\n            self.mute(muted, id);\n          }\n        });\n\n        return self;\n      }\n\n      // If applying mute/unmute to all sounds, update the group's value.\n      if (typeof id === 'undefined') {\n        if (typeof muted === 'boolean') {\n          self._muted = muted;\n        } else {\n          return self._muted;\n        }\n      }\n\n      // If no id is passed, get all ID's to be muted.\n      var ids = self._getSoundIds(id);\n\n      for (var i=0; i<ids.length; i++) {\n        // Get the sound.\n        var sound = self._soundById(ids[i]);\n\n        if (sound) {\n          sound._muted = muted;\n\n          // Cancel active fade and set the volume to the end value.\n          if (sound._interval) {\n            self._stopFade(sound._id);\n          }\n\n          if (self._webAudio && sound._node) {\n            sound._node.gain.setValueAtTime(muted ? 0 : sound._volume, Howler.ctx.currentTime);\n          } else if (sound._node) {\n            sound._node.muted = Howler._muted ? true : muted;\n          }\n\n          self._emit('mute', sound._id);\n        }\n      }\n\n      return self;\n    },\n\n    /**\n     * Get/set the volume of this sound or of the Howl group. This method can optionally take 0, 1 or 2 arguments.\n     *   volume() -> Returns the group's volume value.\n     *   volume(id) -> Returns the sound id's current volume.\n     *   volume(vol) -> Sets the volume of all sounds in this Howl group.\n     *   volume(vol, id) -> Sets the volume of passed sound id.\n     * @return {Howl/Number} Returns self or current volume.\n     */\n    volume: function() {\n      var self = this;\n      var args = arguments;\n      var vol, id;\n\n      // Determine the values based on arguments.\n      if (args.length === 0) {\n        // Return the value of the groups' volume.\n        return self._volume;\n      } else if (args.length === 1 || args.length === 2 && typeof args[1] === 'undefined') {\n        // First check if this is an ID, and if not, assume it is a new volume.\n        var ids = self._getSoundIds();\n        var index = ids.indexOf(args[0]);\n        if (index >= 0) {\n          id = parseInt(args[0], 10);\n        } else {\n          vol = parseFloat(args[0]);\n        }\n      } else if (args.length >= 2) {\n        vol = parseFloat(args[0]);\n        id = parseInt(args[1], 10);\n      }\n\n      // Update the volume or return the current volume.\n      var sound;\n      if (typeof vol !== 'undefined' && vol >= 0 && vol <= 1) {\n        // If the sound hasn't loaded, add it to the load queue to change volume when capable.\n        if (self._state !== 'loaded'|| self._playLock) {\n          self._queue.push({\n            event: 'volume',\n            action: function() {\n              self.volume.apply(self, args);\n            }\n          });\n\n          return self;\n        }\n\n        // Set the group volume.\n        if (typeof id === 'undefined') {\n          self._volume = vol;\n        }\n\n        // Update one or all volumes.\n        id = self._getSoundIds(id);\n        for (var i=0; i<id.length; i++) {\n          // Get the sound.\n          sound = self._soundById(id[i]);\n\n          if (sound) {\n            sound._volume = vol;\n\n            // Stop currently running fades.\n            if (!args[2]) {\n              self._stopFade(id[i]);\n            }\n\n            if (self._webAudio && sound._node && !sound._muted) {\n              sound._node.gain.setValueAtTime(vol, Howler.ctx.currentTime);\n            } else if (sound._node && !sound._muted) {\n              sound._node.volume = vol * Howler.volume();\n            }\n\n            self._emit('volume', sound._id);\n          }\n        }\n      } else {\n        sound = id ? self._soundById(id) : self._sounds[0];\n        return sound ? sound._volume : 0;\n      }\n\n      return self;\n    },\n\n    /**\n     * Fade a currently playing sound between two volumes (if no id is passed, all sounds will fade).\n     * @param  {Number} from The value to fade from (0.0 to 1.0).\n     * @param  {Number} to   The volume to fade to (0.0 to 1.0).\n     * @param  {Number} len  Time in milliseconds to fade.\n     * @param  {Number} id   The sound id (omit to fade all sounds).\n     * @return {Howl}\n     */\n    fade: function(from, to, len, id) {\n      var self = this;\n\n      // If the sound hasn't loaded, add it to the load queue to fade when capable.\n      if (self._state !== 'loaded' || self._playLock) {\n        self._queue.push({\n          event: 'fade',\n          action: function() {\n            self.fade(from, to, len, id);\n          }\n        });\n\n        return self;\n      }\n\n      // Make sure the to/from/len values are numbers.\n      from = Math.min(Math.max(0, parseFloat(from)), 1);\n      to = Math.min(Math.max(0, parseFloat(to)), 1);\n      len = parseFloat(len);\n\n      // Set the volume to the start position.\n      self.volume(from, id);\n\n      // Fade the volume of one or all sounds.\n      var ids = self._getSoundIds(id);\n      for (var i=0; i<ids.length; i++) {\n        // Get the sound.\n        var sound = self._soundById(ids[i]);\n\n        // Create a linear fade or fall back to timeouts with HTML5 Audio.\n        if (sound) {\n          // Stop the previous fade if no sprite is being used (otherwise, volume handles this).\n          if (!id) {\n            self._stopFade(ids[i]);\n          }\n\n          // If we are using Web Audio, let the native methods do the actual fade.\n          if (self._webAudio && !sound._muted) {\n            var currentTime = Howler.ctx.currentTime;\n            var end = currentTime + (len / 1000);\n            sound._volume = from;\n            sound._node.gain.setValueAtTime(from, currentTime);\n            sound._node.gain.linearRampToValueAtTime(to, end);\n          }\n\n          self._startFadeInterval(sound, from, to, len, ids[i], typeof id === 'undefined');\n        }\n      }\n\n      return self;\n    },\n\n    /**\n     * Starts the internal interval to fade a sound.\n     * @param  {Object} sound Reference to sound to fade.\n     * @param  {Number} from The value to fade from (0.0 to 1.0).\n     * @param  {Number} to   The volume to fade to (0.0 to 1.0).\n     * @param  {Number} len  Time in milliseconds to fade.\n     * @param  {Number} id   The sound id to fade.\n     * @param  {Boolean} isGroup   If true, set the volume on the group.\n     */\n    _startFadeInterval: function(sound, from, to, len, id, isGroup) {\n      var self = this;\n      var vol = from;\n      var diff = to - from;\n      var steps = Math.abs(diff / 0.01);\n      var stepLen = Math.max(4, (steps > 0) ? len / steps : len);\n      var lastTick = Date.now();\n\n      // Store the value being faded to.\n      sound._fadeTo = to;\n\n      // Update the volume value on each interval tick.\n      sound._interval = setInterval(function() {\n        // Update the volume based on the time since the last tick.\n        var tick = (Date.now() - lastTick) / len;\n        lastTick = Date.now();\n        vol += diff * tick;\n\n        // Round to within 2 decimal points.\n        vol = Math.round(vol * 100) / 100;\n\n        // Make sure the volume is in the right bounds.\n        if (diff < 0) {\n          vol = Math.max(to, vol);\n        } else {\n          vol = Math.min(to, vol);\n        }\n\n        // Change the volume.\n        if (self._webAudio) {\n          sound._volume = vol;\n        } else {\n          self.volume(vol, sound._id, true);\n        }\n\n        // Set the group's volume.\n        if (isGroup) {\n          self._volume = vol;\n        }\n\n        // When the fade is complete, stop it and fire event.\n        if ((to < from && vol <= to) || (to > from && vol >= to)) {\n          clearInterval(sound._interval);\n          sound._interval = null;\n          sound._fadeTo = null;\n          self.volume(to, sound._id);\n          self._emit('fade', sound._id);\n        }\n      }, stepLen);\n    },\n\n    /**\n     * Internal method that stops the currently playing fade when\n     * a new fade starts, volume is changed or the sound is stopped.\n     * @param  {Number} id The sound id.\n     * @return {Howl}\n     */\n    _stopFade: function(id) {\n      var self = this;\n      var sound = self._soundById(id);\n\n      if (sound && sound._interval) {\n        if (self._webAudio) {\n          sound._node.gain.cancelScheduledValues(Howler.ctx.currentTime);\n        }\n\n        clearInterval(sound._interval);\n        sound._interval = null;\n        self.volume(sound._fadeTo, id);\n        sound._fadeTo = null;\n        self._emit('fade', id);\n      }\n\n      return self;\n    },\n\n    /**\n     * Get/set the loop parameter on a sound. This method can optionally take 0, 1 or 2 arguments.\n     *   loop() -> Returns the group's loop value.\n     *   loop(id) -> Returns the sound id's loop value.\n     *   loop(loop) -> Sets the loop value for all sounds in this Howl group.\n     *   loop(loop, id) -> Sets the loop value of passed sound id.\n     * @return {Howl/Boolean} Returns self or current loop value.\n     */\n    loop: function() {\n      var self = this;\n      var args = arguments;\n      var loop, id, sound;\n\n      // Determine the values for loop and id.\n      if (args.length === 0) {\n        // Return the grou's loop value.\n        return self._loop;\n      } else if (args.length === 1) {\n        if (typeof args[0] === 'boolean') {\n          loop = args[0];\n          self._loop = loop;\n        } else {\n          // Return this sound's loop value.\n          sound = self._soundById(parseInt(args[0], 10));\n          return sound ? sound._loop : false;\n        }\n      } else if (args.length === 2) {\n        loop = args[0];\n        id = parseInt(args[1], 10);\n      }\n\n      // If no id is passed, get all ID's to be looped.\n      var ids = self._getSoundIds(id);\n      for (var i=0; i<ids.length; i++) {\n        sound = self._soundById(ids[i]);\n\n        if (sound) {\n          sound._loop = loop;\n          if (self._webAudio && sound._node && sound._node.bufferSource) {\n            sound._node.bufferSource.loop = loop;\n            if (loop) {\n              sound._node.bufferSource.loopStart = sound._start || 0;\n              sound._node.bufferSource.loopEnd = sound._stop;\n            }\n          }\n        }\n      }\n\n      return self;\n    },\n\n    /**\n     * Get/set the playback rate of a sound. This method can optionally take 0, 1 or 2 arguments.\n     *   rate() -> Returns the first sound node's current playback rate.\n     *   rate(id) -> Returns the sound id's current playback rate.\n     *   rate(rate) -> Sets the playback rate of all sounds in this Howl group.\n     *   rate(rate, id) -> Sets the playback rate of passed sound id.\n     * @return {Howl/Number} Returns self or the current playback rate.\n     */\n    rate: function() {\n      var self = this;\n      var args = arguments;\n      var rate, id;\n\n      // Determine the values based on arguments.\n      if (args.length === 0) {\n        // We will simply return the current rate of the first node.\n        id = self._sounds[0]._id;\n      } else if (args.length === 1) {\n        // First check if this is an ID, and if not, assume it is a new rate value.\n        var ids = self._getSoundIds();\n        var index = ids.indexOf(args[0]);\n        if (index >= 0) {\n          id = parseInt(args[0], 10);\n        } else {\n          rate = parseFloat(args[0]);\n        }\n      } else if (args.length === 2) {\n        rate = parseFloat(args[0]);\n        id = parseInt(args[1], 10);\n      }\n\n      // Update the playback rate or return the current value.\n      var sound;\n      if (typeof rate === 'number') {\n        // If the sound hasn't loaded, add it to the load queue to change playback rate when capable.\n        if (self._state !== 'loaded' || self._playLock) {\n          self._queue.push({\n            event: 'rate',\n            action: function() {\n              self.rate.apply(self, args);\n            }\n          });\n\n          return self;\n        }\n\n        // Set the group rate.\n        if (typeof id === 'undefined') {\n          self._rate = rate;\n        }\n\n        // Update one or all volumes.\n        id = self._getSoundIds(id);\n        for (var i=0; i<id.length; i++) {\n          // Get the sound.\n          sound = self._soundById(id[i]);\n\n          if (sound) {\n            // Keep track of our position when the rate changed and update the playback\n            // start position so we can properly adjust the seek position for time elapsed.\n            if (self.playing(id[i])) {\n              sound._rateSeek = self.seek(id[i]);\n              sound._playStart = self._webAudio ? Howler.ctx.currentTime : sound._playStart;\n            }\n            sound._rate = rate;\n\n            // Change the playback rate.\n            if (self._webAudio && sound._node && sound._node.bufferSource) {\n              sound._node.bufferSource.playbackRate.setValueAtTime(rate, Howler.ctx.currentTime);\n            } else if (sound._node) {\n              sound._node.playbackRate = rate;\n            }\n\n            // Reset the timers.\n            var seek = self.seek(id[i]);\n            var duration = ((self._sprite[sound._sprite][0] + self._sprite[sound._sprite][1]) / 1000) - seek;\n            var timeout = (duration * 1000) / Math.abs(sound._rate);\n\n            // Start a new end timer if sound is already playing.\n            if (self._endTimers[id[i]] || !sound._paused) {\n              self._clearTimer(id[i]);\n              self._endTimers[id[i]] = setTimeout(self._ended.bind(self, sound), timeout);\n            }\n\n            self._emit('rate', sound._id);\n          }\n        }\n      } else {\n        sound = self._soundById(id);\n        return sound ? sound._rate : self._rate;\n      }\n\n      return self;\n    },\n\n    /**\n     * Get/set the seek position of a sound. This method can optionally take 0, 1 or 2 arguments.\n     *   seek() -> Returns the first sound node's current seek position.\n     *   seek(id) -> Returns the sound id's current seek position.\n     *   seek(seek) -> Sets the seek position of the first sound node.\n     *   seek(seek, id) -> Sets the seek position of passed sound id.\n     * @return {Howl/Number} Returns self or the current seek position.\n     */\n    seek: function() {\n      var self = this;\n      var args = arguments;\n      var seek, id;\n\n      // Determine the values based on arguments.\n      if (args.length === 0) {\n        // We will simply return the current position of the first node.\n        id = self._sounds[0]._id;\n      } else if (args.length === 1) {\n        // First check if this is an ID, and if not, assume it is a new seek position.\n        var ids = self._getSoundIds();\n        var index = ids.indexOf(args[0]);\n        if (index >= 0) {\n          id = parseInt(args[0], 10);\n        } else if (self._sounds.length) {\n          id = self._sounds[0]._id;\n          seek = parseFloat(args[0]);\n        }\n      } else if (args.length === 2) {\n        seek = parseFloat(args[0]);\n        id = parseInt(args[1], 10);\n      }\n\n      // If there is no ID, bail out.\n      if (typeof id === 'undefined') {\n        return self;\n      }\n\n      // If the sound hasn't loaded, add it to the load queue to seek when capable.\n      if (typeof seek === 'number' && (self._state !== 'loaded' || self._playLock)) {\n        self._queue.push({\n          event: 'seek',\n          action: function() {\n            self.seek.apply(self, args);\n          }\n        });\n\n        return self;\n      }\n\n      // Get the sound.\n      var sound = self._soundById(id);\n\n      if (sound) {\n        if (typeof seek === 'number' && seek >= 0) {\n          // Pause the sound and update position for restarting playback.\n          var playing = self.playing(id);\n          if (playing) {\n            self.pause(id, true);\n          }\n\n          // Move the position of the track and cancel timer.\n          sound._seek = seek;\n          sound._ended = false;\n          self._clearTimer(id);\n\n          // Update the seek position for HTML5 Audio.\n          if (!self._webAudio && sound._node && !isNaN(sound._node.duration)) {\n            sound._node.currentTime = seek;\n          }\n\n          // Seek and emit when ready.\n          var seekAndEmit = function() {\n            self._emit('seek', id);\n\n            // Restart the playback if the sound was playing.\n            if (playing) {\n              self.play(id, true);\n            }\n          };\n\n          // Wait for the play lock to be unset before emitting (HTML5 Audio).\n          if (playing && !self._webAudio) {\n            var emitSeek = function() {\n              if (!self._playLock) {\n                seekAndEmit();\n              } else {\n                setTimeout(emitSeek, 0);\n              }\n            };\n            setTimeout(emitSeek, 0);\n          } else {\n            seekAndEmit();\n          }\n        } else {\n          if (self._webAudio) {\n            var realTime = self.playing(id) ? Howler.ctx.currentTime - sound._playStart : 0;\n            var rateSeek = sound._rateSeek ? sound._rateSeek - sound._seek : 0;\n            return sound._seek + (rateSeek + realTime * Math.abs(sound._rate));\n          } else {\n            return sound._node.currentTime;\n          }\n        }\n      }\n\n      return self;\n    },\n\n    /**\n     * Check if a specific sound is currently playing or not (if id is provided), or check if at least one of the sounds in the group is playing or not.\n     * @param  {Number}  id The sound id to check. If none is passed, the whole sound group is checked.\n     * @return {Boolean} True if playing and false if not.\n     */\n    playing: function(id) {\n      var self = this;\n\n      // Check the passed sound ID (if any).\n      if (typeof id === 'number') {\n        var sound = self._soundById(id);\n        return sound ? !sound._paused : false;\n      }\n\n      // Otherwise, loop through all sounds and check if any are playing.\n      for (var i=0; i<self._sounds.length; i++) {\n        if (!self._sounds[i]._paused) {\n          return true;\n        }\n      }\n\n      return false;\n    },\n\n    /**\n     * Get the duration of this sound. Passing a sound id will return the sprite duration.\n     * @param  {Number} id The sound id to check. If none is passed, return full source duration.\n     * @return {Number} Audio duration in seconds.\n     */\n    duration: function(id) {\n      var self = this;\n      var duration = self._duration;\n\n      // If we pass an ID, get the sound and return the sprite length.\n      var sound = self._soundById(id);\n      if (sound) {\n        duration = self._sprite[sound._sprite][1] / 1000;\n      }\n\n      return duration;\n    },\n\n    /**\n     * Returns the current loaded state of this Howl.\n     * @return {String} 'unloaded', 'loading', 'loaded'\n     */\n    state: function() {\n      return this._state;\n    },\n\n    /**\n     * Unload and destroy the current Howl object.\n     * This will immediately stop all sound instances attached to this group.\n     */\n    unload: function() {\n      var self = this;\n\n      // Stop playing any active sounds.\n      var sounds = self._sounds;\n      for (var i=0; i<sounds.length; i++) {\n        // Stop the sound if it is currently playing.\n        if (!sounds[i]._paused) {\n          self.stop(sounds[i]._id);\n        }\n\n        // Remove the source or disconnect.\n        if (!self._webAudio) {\n          // Set the source to 0-second silence to stop any downloading (except in IE).\n          self._clearSound(sounds[i]._node);\n\n          // Remove any event listeners.\n          sounds[i]._node.removeEventListener('error', sounds[i]._errorFn, false);\n          sounds[i]._node.removeEventListener(Howler._canPlayEvent, sounds[i]._loadFn, false);\n          sounds[i]._node.removeEventListener('ended', sounds[i]._endFn, false);\n\n          // Release the Audio object back to the pool.\n          Howler._releaseHtml5Audio(sounds[i]._node);\n        }\n\n        // Empty out all of the nodes.\n        delete sounds[i]._node;\n\n        // Make sure all timers are cleared out.\n        self._clearTimer(sounds[i]._id);\n      }\n\n      // Remove the references in the global Howler object.\n      var index = Howler._howls.indexOf(self);\n      if (index >= 0) {\n        Howler._howls.splice(index, 1);\n      }\n\n      // Delete this sound from the cache (if no other Howl is using it).\n      var remCache = true;\n      for (i=0; i<Howler._howls.length; i++) {\n        if (Howler._howls[i]._src === self._src || self._src.indexOf(Howler._howls[i]._src) >= 0) {\n          remCache = false;\n          break;\n        }\n      }\n\n      if (cache && remCache) {\n        delete cache[self._src];\n      }\n\n      // Clear global errors.\n      Howler.noAudio = false;\n\n      // Clear out `self`.\n      self._state = 'unloaded';\n      self._sounds = [];\n      self = null;\n\n      return null;\n    },\n\n    /**\n     * Listen to a custom event.\n     * @param  {String}   event Event name.\n     * @param  {Function} fn    Listener to call.\n     * @param  {Number}   id    (optional) Only listen to events for this sound.\n     * @param  {Number}   once  (INTERNAL) Marks event to fire only once.\n     * @return {Howl}\n     */\n    on: function(event, fn, id, once) {\n      var self = this;\n      var events = self['_on' + event];\n\n      if (typeof fn === 'function') {\n        events.push(once ? {id: id, fn: fn, once: once} : {id: id, fn: fn});\n      }\n\n      return self;\n    },\n\n    /**\n     * Remove a custom event. Call without parameters to remove all events.\n     * @param  {String}   event Event name.\n     * @param  {Function} fn    Listener to remove. Leave empty to remove all.\n     * @param  {Number}   id    (optional) Only remove events for this sound.\n     * @return {Howl}\n     */\n    off: function(event, fn, id) {\n      var self = this;\n      var events = self['_on' + event];\n      var i = 0;\n\n      // Allow passing just an event and ID.\n      if (typeof fn === 'number') {\n        id = fn;\n        fn = null;\n      }\n\n      if (fn || id) {\n        // Loop through event store and remove the passed function.\n        for (i=0; i<events.length; i++) {\n          var isId = (id === events[i].id);\n          if (fn === events[i].fn && isId || !fn && isId) {\n            events.splice(i, 1);\n            break;\n          }\n        }\n      } else if (event) {\n        // Clear out all events of this type.\n        self['_on' + event] = [];\n      } else {\n        // Clear out all events of every type.\n        var keys = Object.keys(self);\n        for (i=0; i<keys.length; i++) {\n          if ((keys[i].indexOf('_on') === 0) && Array.isArray(self[keys[i]])) {\n            self[keys[i]] = [];\n          }\n        }\n      }\n\n      return self;\n    },\n\n    /**\n     * Listen to a custom event and remove it once fired.\n     * @param  {String}   event Event name.\n     * @param  {Function} fn    Listener to call.\n     * @param  {Number}   id    (optional) Only listen to events for this sound.\n     * @return {Howl}\n     */\n    once: function(event, fn, id) {\n      var self = this;\n\n      // Setup the event listener.\n      self.on(event, fn, id, 1);\n\n      return self;\n    },\n\n    /**\n     * Emit all events of a specific type and pass the sound id.\n     * @param  {String} event Event name.\n     * @param  {Number} id    Sound ID.\n     * @param  {Number} msg   Message to go with event.\n     * @return {Howl}\n     */\n    _emit: function(event, id, msg) {\n      var self = this;\n      var events = self['_on' + event];\n\n      // Loop through event store and fire all functions.\n      for (var i=events.length-1; i>=0; i--) {\n        // Only fire the listener if the correct ID is used.\n        if (!events[i].id || events[i].id === id || event === 'load') {\n          setTimeout(function(fn) {\n            fn.call(this, id, msg);\n          }.bind(self, events[i].fn), 0);\n\n          // If this event was setup with `once`, remove it.\n          if (events[i].once) {\n            self.off(event, events[i].fn, events[i].id);\n          }\n        }\n      }\n\n      // Pass the event type into load queue so that it can continue stepping.\n      self._loadQueue(event);\n\n      return self;\n    },\n\n    /**\n     * Queue of actions initiated before the sound has loaded.\n     * These will be called in sequence, with the next only firing\n     * after the previous has finished executing (even if async like play).\n     * @return {Howl}\n     */\n    _loadQueue: function(event) {\n      var self = this;\n\n      if (self._queue.length > 0) {\n        var task = self._queue[0];\n\n        // Remove this task if a matching event was passed.\n        if (task.event === event) {\n          self._queue.shift();\n          self._loadQueue();\n        }\n\n        // Run the task if no event type is passed.\n        if (!event) {\n          task.action();\n        }\n      }\n\n      return self;\n    },\n\n    /**\n     * Fired when playback ends at the end of the duration.\n     * @param  {Sound} sound The sound object to work with.\n     * @return {Howl}\n     */\n    _ended: function(sound) {\n      var self = this;\n      var sprite = sound._sprite;\n\n      // If we are using IE and there was network latency we may be clipping\n      // audio before it completes playing. Lets check the node to make sure it\n      // believes it has completed, before ending the playback.\n      if (!self._webAudio && sound._node && !sound._node.paused && !sound._node.ended && sound._node.currentTime < sound._stop) {\n        setTimeout(self._ended.bind(self, sound), 100);\n        return self;\n      }\n\n      // Should this sound loop?\n      var loop = !!(sound._loop || self._sprite[sprite][2]);\n\n      // Fire the ended event.\n      self._emit('end', sound._id);\n\n      // Restart the playback for HTML5 Audio loop.\n      if (!self._webAudio && loop) {\n        self.stop(sound._id, true).play(sound._id);\n      }\n\n      // Restart this timer if on a Web Audio loop.\n      if (self._webAudio && loop) {\n        self._emit('play', sound._id);\n        sound._seek = sound._start || 0;\n        sound._rateSeek = 0;\n        sound._playStart = Howler.ctx.currentTime;\n\n        var timeout = ((sound._stop - sound._start) * 1000) / Math.abs(sound._rate);\n        self._endTimers[sound._id] = setTimeout(self._ended.bind(self, sound), timeout);\n      }\n\n      // Mark the node as paused.\n      if (self._webAudio && !loop) {\n        sound._paused = true;\n        sound._ended = true;\n        sound._seek = sound._start || 0;\n        sound._rateSeek = 0;\n        self._clearTimer(sound._id);\n\n        // Clean up the buffer source.\n        self._cleanBuffer(sound._node);\n\n        // Attempt to auto-suspend AudioContext if no sounds are still playing.\n        Howler._autoSuspend();\n      }\n\n      // When using a sprite, end the track.\n      if (!self._webAudio && !loop) {\n        self.stop(sound._id, true);\n      }\n\n      return self;\n    },\n\n    /**\n     * Clear the end timer for a sound playback.\n     * @param  {Number} id The sound ID.\n     * @return {Howl}\n     */\n    _clearTimer: function(id) {\n      var self = this;\n\n      if (self._endTimers[id]) {\n        // Clear the timeout or remove the ended listener.\n        if (typeof self._endTimers[id] !== 'function') {\n          clearTimeout(self._endTimers[id]);\n        } else {\n          var sound = self._soundById(id);\n          if (sound && sound._node) {\n            sound._node.removeEventListener('ended', self._endTimers[id], false);\n          }\n        }\n\n        delete self._endTimers[id];\n      }\n\n      return self;\n    },\n\n    /**\n     * Return the sound identified by this ID, or return null.\n     * @param  {Number} id Sound ID\n     * @return {Object}    Sound object or null.\n     */\n    _soundById: function(id) {\n      var self = this;\n\n      // Loop through all sounds and find the one with this ID.\n      for (var i=0; i<self._sounds.length; i++) {\n        if (id === self._sounds[i]._id) {\n          return self._sounds[i];\n        }\n      }\n\n      return null;\n    },\n\n    /**\n     * Return an inactive sound from the pool or create a new one.\n     * @return {Sound} Sound playback object.\n     */\n    _inactiveSound: function() {\n      var self = this;\n\n      self._drain();\n\n      // Find the first inactive node to recycle.\n      for (var i=0; i<self._sounds.length; i++) {\n        if (self._sounds[i]._ended) {\n          return self._sounds[i].reset();\n        }\n      }\n\n      // If no inactive node was found, create a new one.\n      return new Sound(self);\n    },\n\n    /**\n     * Drain excess inactive sounds from the pool.\n     */\n    _drain: function() {\n      var self = this;\n      var limit = self._pool;\n      var cnt = 0;\n      var i = 0;\n\n      // If there are less sounds than the max pool size, we are done.\n      if (self._sounds.length < limit) {\n        return;\n      }\n\n      // Count the number of inactive sounds.\n      for (i=0; i<self._sounds.length; i++) {\n        if (self._sounds[i]._ended) {\n          cnt++;\n        }\n      }\n\n      // Remove excess inactive sounds, going in reverse order.\n      for (i=self._sounds.length - 1; i>=0; i--) {\n        if (cnt <= limit) {\n          return;\n        }\n\n        if (self._sounds[i]._ended) {\n          // Disconnect the audio source when using Web Audio.\n          if (self._webAudio && self._sounds[i]._node) {\n            self._sounds[i]._node.disconnect(0);\n          }\n\n          // Remove sounds until we have the pool size.\n          self._sounds.splice(i, 1);\n          cnt--;\n        }\n      }\n    },\n\n    /**\n     * Get all ID's from the sounds pool.\n     * @param  {Number} id Only return one ID if one is passed.\n     * @return {Array}    Array of IDs.\n     */\n    _getSoundIds: function(id) {\n      var self = this;\n\n      if (typeof id === 'undefined') {\n        var ids = [];\n        for (var i=0; i<self._sounds.length; i++) {\n          ids.push(self._sounds[i]._id);\n        }\n\n        return ids;\n      } else {\n        return [id];\n      }\n    },\n\n    /**\n     * Load the sound back into the buffer source.\n     * @param  {Sound} sound The sound object to work with.\n     * @return {Howl}\n     */\n    _refreshBuffer: function(sound) {\n      var self = this;\n\n      // Setup the buffer source for playback.\n      sound._node.bufferSource = Howler.ctx.createBufferSource();\n      sound._node.bufferSource.buffer = cache[self._src];\n\n      // Connect to the correct node.\n      if (sound._panner) {\n        sound._node.bufferSource.connect(sound._panner);\n      } else {\n        sound._node.bufferSource.connect(sound._node);\n      }\n\n      // Setup looping and playback rate.\n      sound._node.bufferSource.loop = sound._loop;\n      if (sound._loop) {\n        sound._node.bufferSource.loopStart = sound._start || 0;\n        sound._node.bufferSource.loopEnd = sound._stop || 0;\n      }\n      sound._node.bufferSource.playbackRate.setValueAtTime(sound._rate, Howler.ctx.currentTime);\n\n      return self;\n    },\n\n    /**\n     * Prevent memory leaks by cleaning up the buffer source after playback.\n     * @param  {Object} node Sound's audio node containing the buffer source.\n     * @return {Howl}\n     */\n    _cleanBuffer: function(node) {\n      var self = this;\n      var isIOS = Howler._navigator && Howler._navigator.vendor.indexOf('Apple') >= 0;\n\n      if (Howler._scratchBuffer && node.bufferSource) {\n        node.bufferSource.onended = null;\n        node.bufferSource.disconnect(0);\n        if (isIOS) {\n          try { node.bufferSource.buffer = Howler._scratchBuffer; } catch(e) {}\n        }\n      }\n      node.bufferSource = null;\n\n      return self;\n    },\n\n    /**\n     * Set the source to a 0-second silence to stop any downloading (except in IE).\n     * @param  {Object} node Audio node to clear.\n     */\n    _clearSound: function(node) {\n      var checkIE = /MSIE |Trident\\//.test(Howler._navigator && Howler._navigator.userAgent);\n      if (!checkIE) {\n        node.src = 'data:audio/wav;base64,UklGRigAAABXQVZFZm10IBIAAAABAAEARKwAAIhYAQACABAAAABkYXRhAgAAAAEA';\n      }\n    }\n  };\n\n  /** Single Sound Methods **/\n  /***************************************************************************/\n\n  /**\n   * Setup the sound object, which each node attached to a Howl group is contained in.\n   * @param {Object} howl The Howl parent group.\n   */\n  var Sound = function(howl) {\n    this._parent = howl;\n    this.init();\n  };\n  Sound.prototype = {\n    /**\n     * Initialize a new Sound object.\n     * @return {Sound}\n     */\n    init: function() {\n      var self = this;\n      var parent = self._parent;\n\n      // Setup the default parameters.\n      self._muted = parent._muted;\n      self._loop = parent._loop;\n      self._volume = parent._volume;\n      self._rate = parent._rate;\n      self._seek = 0;\n      self._paused = true;\n      self._ended = true;\n      self._sprite = '__default';\n\n      // Generate a unique ID for this sound.\n      self._id = ++Howler._counter;\n\n      // Add itself to the parent's pool.\n      parent._sounds.push(self);\n\n      // Create the new node.\n      self.create();\n\n      return self;\n    },\n\n    /**\n     * Create and setup a new sound object, whether HTML5 Audio or Web Audio.\n     * @return {Sound}\n     */\n    create: function() {\n      var self = this;\n      var parent = self._parent;\n      var volume = (Howler._muted || self._muted || self._parent._muted) ? 0 : self._volume;\n\n      if (parent._webAudio) {\n        // Create the gain node for controlling volume (the source will connect to this).\n        self._node = (typeof Howler.ctx.createGain === 'undefined') ? Howler.ctx.createGainNode() : Howler.ctx.createGain();\n        self._node.gain.setValueAtTime(volume, Howler.ctx.currentTime);\n        self._node.paused = true;\n        self._node.connect(Howler.masterGain);\n      } else if (!Howler.noAudio) {\n        // Get an unlocked Audio object from the pool.\n        self._node = Howler._obtainHtml5Audio();\n\n        // Listen for errors (http://dev.w3.org/html5/spec-author-view/spec.html#mediaerror).\n        self._errorFn = self._errorListener.bind(self);\n        self._node.addEventListener('error', self._errorFn, false);\n\n        // Listen for 'canplaythrough' event to let us know the sound is ready.\n        self._loadFn = self._loadListener.bind(self);\n        self._node.addEventListener(Howler._canPlayEvent, self._loadFn, false);\n\n        // Listen for the 'ended' event on the sound to account for edge-case where\n        // a finite sound has a duration of Infinity.\n        self._endFn = self._endListener.bind(self);\n        self._node.addEventListener('ended', self._endFn, false);\n\n        // Setup the new audio node.\n        self._node.src = parent._src;\n        self._node.preload = parent._preload === true ? 'auto' : parent._preload;\n        self._node.volume = volume * Howler.volume();\n\n        // Begin loading the source.\n        self._node.load();\n      }\n\n      return self;\n    },\n\n    /**\n     * Reset the parameters of this sound to the original state (for recycle).\n     * @return {Sound}\n     */\n    reset: function() {\n      var self = this;\n      var parent = self._parent;\n\n      // Reset all of the parameters of this sound.\n      self._muted = parent._muted;\n      self._loop = parent._loop;\n      self._volume = parent._volume;\n      self._rate = parent._rate;\n      self._seek = 0;\n      self._rateSeek = 0;\n      self._paused = true;\n      self._ended = true;\n      self._sprite = '__default';\n\n      // Generate a new ID so that it isn't confused with the previous sound.\n      self._id = ++Howler._counter;\n\n      return self;\n    },\n\n    /**\n     * HTML5 Audio error listener callback.\n     */\n    _errorListener: function() {\n      var self = this;\n\n      // Fire an error event and pass back the code.\n      self._parent._emit('loaderror', self._id, self._node.error ? self._node.error.code : 0);\n\n      // Clear the event listener.\n      self._node.removeEventListener('error', self._errorFn, false);\n    },\n\n    /**\n     * HTML5 Audio canplaythrough listener callback.\n     */\n    _loadListener: function() {\n      var self = this;\n      var parent = self._parent;\n\n      // Round up the duration to account for the lower precision in HTML5 Audio.\n      parent._duration = Math.ceil(self._node.duration * 10) / 10;\n\n      // Setup a sprite if none is defined.\n      if (Object.keys(parent._sprite).length === 0) {\n        parent._sprite = {__default: [0, parent._duration * 1000]};\n      }\n\n      if (parent._state !== 'loaded') {\n        parent._state = 'loaded';\n        parent._emit('load');\n        parent._loadQueue();\n      }\n\n      // Clear the event listener.\n      self._node.removeEventListener(Howler._canPlayEvent, self._loadFn, false);\n    },\n\n    /**\n     * HTML5 Audio ended listener callback.\n     */\n    _endListener: function() {\n      var self = this;\n      var parent = self._parent;\n\n      // Only handle the `ended`` event if the duration is Infinity.\n      if (parent._duration === Infinity) {\n        // Update the parent duration to match the real audio duration.\n        // Round up the duration to account for the lower precision in HTML5 Audio.\n        parent._duration = Math.ceil(self._node.duration * 10) / 10;\n\n        // Update the sprite that corresponds to the real duration.\n        if (parent._sprite.__default[1] === Infinity) {\n          parent._sprite.__default[1] = parent._duration * 1000;\n        }\n\n        // Run the regular ended method.\n        parent._ended(self);\n      }\n\n      // Clear the event listener since the duration is now correct.\n      self._node.removeEventListener('ended', self._endFn, false);\n    }\n  };\n\n  /** Helper Methods **/\n  /***************************************************************************/\n\n  var cache = {};\n\n  /**\n   * Buffer a sound from URL, Data URI or cache and decode to audio source (Web Audio API).\n   * @param  {Howl} self\n   */\n  var loadBuffer = function(self) {\n    var url = self._src;\n\n    // Check if the buffer has already been cached and use it instead.\n    if (cache[url]) {\n      // Set the duration from the cache.\n      self._duration = cache[url].duration;\n\n      // Load the sound into this Howl.\n      loadSound(self);\n\n      return;\n    }\n\n    if (/^data:[^;]+;base64,/.test(url)) {\n      // Decode the base64 data URI without XHR, since some browsers don't support it.\n      var data = atob(url.split(',')[1]);\n      var dataView = new Uint8Array(data.length);\n      for (var i=0; i<data.length; ++i) {\n        dataView[i] = data.charCodeAt(i);\n      }\n\n      decodeAudioData(dataView.buffer, self);\n    } else {\n      // Load the buffer from the URL.\n      var xhr = new XMLHttpRequest();\n      xhr.open(self._xhr.method, url, true);\n      xhr.withCredentials = self._xhr.withCredentials;\n      xhr.responseType = 'arraybuffer';\n\n      // Apply any custom headers to the request.\n      if (self._xhr.headers) {\n        Object.keys(self._xhr.headers).forEach(function(key) {\n          xhr.setRequestHeader(key, self._xhr.headers[key]);\n        });\n      }\n\n      xhr.onload = function() {\n        // Make sure we get a successful response back.\n        var code = (xhr.status + '')[0];\n        if (code !== '0' && code !== '2' && code !== '3') {\n          self._emit('loaderror', null, 'Failed loading audio file with status: ' + xhr.status + '.');\n          return;\n        }\n\n        decodeAudioData(xhr.response, self);\n      };\n      xhr.onerror = function() {\n        // If there is an error, switch to HTML5 Audio.\n        if (self._webAudio) {\n          self._html5 = true;\n          self._webAudio = false;\n          self._sounds = [];\n          delete cache[url];\n          self.load();\n        }\n      };\n      safeXhrSend(xhr);\n    }\n  };\n\n  /**\n   * Send the XHR request wrapped in a try/catch.\n   * @param  {Object} xhr XHR to send.\n   */\n  var safeXhrSend = function(xhr) {\n    try {\n      xhr.send();\n    } catch (e) {\n      xhr.onerror();\n    }\n  };\n\n  /**\n   * Decode audio data from an array buffer.\n   * @param  {ArrayBuffer} arraybuffer The audio data.\n   * @param  {Howl}        self\n   */\n  var decodeAudioData = function(arraybuffer, self) {\n    // Fire a load error if something broke.\n    var error = function() {\n      self._emit('loaderror', null, 'Decoding audio data failed.');\n    };\n\n    // Load the sound on success.\n    var success = function(buffer) {\n      if (buffer && self._sounds.length > 0) {\n        cache[self._src] = buffer;\n        loadSound(self, buffer);\n      } else {\n        error();\n      }\n    };\n\n    // Decode the buffer into an audio source.\n    if (typeof Promise !== 'undefined' && Howler.ctx.decodeAudioData.length === 1) {\n      Howler.ctx.decodeAudioData(arraybuffer).then(success).catch(error);\n    } else {\n      Howler.ctx.decodeAudioData(arraybuffer, success, error);\n    }\n  }\n\n  /**\n   * Sound is now loaded, so finish setting everything up and fire the loaded event.\n   * @param  {Howl} self\n   * @param  {Object} buffer The decoded buffer sound source.\n   */\n  var loadSound = function(self, buffer) {\n    // Set the duration.\n    if (buffer && !self._duration) {\n      self._duration = buffer.duration;\n    }\n\n    // Setup a sprite if none is defined.\n    if (Object.keys(self._sprite).length === 0) {\n      self._sprite = {__default: [0, self._duration * 1000]};\n    }\n\n    // Fire the loaded event.\n    if (self._state !== 'loaded') {\n      self._state = 'loaded';\n      self._emit('load');\n      self._loadQueue();\n    }\n  };\n\n  /**\n   * Setup the audio context when available, or switch to HTML5 Audio mode.\n   */\n  var setupAudioContext = function() {\n    // If we have already detected that Web Audio isn't supported, don't run this step again.\n    if (!Howler.usingWebAudio) {\n      return;\n    }\n\n    // Check if we are using Web Audio and setup the AudioContext if we are.\n    try {\n      if (typeof AudioContext !== 'undefined') {\n        Howler.ctx = new AudioContext();\n      } else if (typeof webkitAudioContext !== 'undefined') {\n        Howler.ctx = new webkitAudioContext();\n      } else {\n        Howler.usingWebAudio = false;\n      }\n    } catch(e) {\n      Howler.usingWebAudio = false;\n    }\n\n    // If the audio context creation still failed, set using web audio to false.\n    if (!Howler.ctx) {\n      Howler.usingWebAudio = false;\n    }\n\n    // Check if a webview is being used on iOS8 or earlier (rather than the browser).\n    // If it is, disable Web Audio as it causes crashing.\n    var iOS = (/iP(hone|od|ad)/.test(Howler._navigator && Howler._navigator.platform));\n    var appVersion = Howler._navigator && Howler._navigator.appVersion.match(/OS (\\d+)_(\\d+)_?(\\d+)?/);\n    var version = appVersion ? parseInt(appVersion[1], 10) : null;\n    if (iOS && version && version < 9) {\n      var safari = /safari/.test(Howler._navigator && Howler._navigator.userAgent.toLowerCase());\n      if (Howler._navigator && !safari) {\n        Howler.usingWebAudio = false;\n      }\n    }\n\n    // Create and expose the master GainNode when using Web Audio (useful for plugins or advanced usage).\n    if (Howler.usingWebAudio) {\n      Howler.masterGain = (typeof Howler.ctx.createGain === 'undefined') ? Howler.ctx.createGainNode() : Howler.ctx.createGain();\n      Howler.masterGain.gain.setValueAtTime(Howler._muted ? 0 : Howler._volume, Howler.ctx.currentTime);\n      Howler.masterGain.connect(Howler.ctx.destination);\n    }\n\n    // Re-run the setup on Howler.\n    Howler._setup();\n  };\n\n  // Add support for AMD (Asynchronous Module Definition) libraries such as require.js.\n  if (typeof define === 'function' && define.amd) {\n    define([], function() {\n      return {\n        Howler: Howler,\n        Howl: Howl\n      };\n    });\n  }\n\n  // Add support for CommonJS libraries such as browserify.\n  if (typeof exports !== 'undefined') {\n    exports.Howler = Howler;\n    exports.Howl = Howl;\n  }\n\n  // Add to global in Node.js (for testing, etc).\n  if (typeof global !== 'undefined') {\n    global.HowlerGlobal = HowlerGlobal;\n    global.Howler = Howler;\n    global.Howl = Howl;\n    global.Sound = Sound;\n  } else if (typeof window !== 'undefined') {  // Define globally in case AMD is not available or unused.\n    window.HowlerGlobal = HowlerGlobal;\n    window.Howler = Howler;\n    window.Howl = Howl;\n    window.Sound = Sound;\n  }\n})();\n\n\n/*!\n *  Spatial Plugin - Adds support for stereo and 3D audio where Web Audio is supported.\n *  \n *  howler.js v2.2.1\n *  howlerjs.com\n *\n *  (c) 2013-2020, James Simpson of GoldFire Studios\n *  goldfirestudios.com\n *\n *  MIT License\n */\n\n(function() {\n\n  'use strict';\n\n  // Setup default properties.\n  HowlerGlobal.prototype._pos = [0, 0, 0];\n  HowlerGlobal.prototype._orientation = [0, 0, -1, 0, 1, 0];\n\n  /** Global Methods **/\n  /***************************************************************************/\n\n  /**\n   * Helper method to update the stereo panning position of all current Howls.\n   * Future Howls will not use this value unless explicitly set.\n   * @param  {Number} pan A value of -1.0 is all the way left and 1.0 is all the way right.\n   * @return {Howler/Number}     Self or current stereo panning value.\n   */\n  HowlerGlobal.prototype.stereo = function(pan) {\n    var self = this;\n\n    // Stop right here if not using Web Audio.\n    if (!self.ctx || !self.ctx.listener) {\n      return self;\n    }\n\n    // Loop through all Howls and update their stereo panning.\n    for (var i=self._howls.length-1; i>=0; i--) {\n      self._howls[i].stereo(pan);\n    }\n\n    return self;\n  };\n\n  /**\n   * Get/set the position of the listener in 3D cartesian space. Sounds using\n   * 3D position will be relative to the listener's position.\n   * @param  {Number} x The x-position of the listener.\n   * @param  {Number} y The y-position of the listener.\n   * @param  {Number} z The z-position of the listener.\n   * @return {Howler/Array}   Self or current listener position.\n   */\n  HowlerGlobal.prototype.pos = function(x, y, z) {\n    var self = this;\n\n    // Stop right here if not using Web Audio.\n    if (!self.ctx || !self.ctx.listener) {\n      return self;\n    }\n\n    // Set the defaults for optional 'y' & 'z'.\n    y = (typeof y !== 'number') ? self._pos[1] : y;\n    z = (typeof z !== 'number') ? self._pos[2] : z;\n\n    if (typeof x === 'number') {\n      self._pos = [x, y, z];\n\n      if (typeof self.ctx.listener.positionX !== 'undefined') {\n        self.ctx.listener.positionX.setTargetAtTime(self._pos[0], Howler.ctx.currentTime, 0.1);\n        self.ctx.listener.positionY.setTargetAtTime(self._pos[1], Howler.ctx.currentTime, 0.1);\n        self.ctx.listener.positionZ.setTargetAtTime(self._pos[2], Howler.ctx.currentTime, 0.1);\n      } else {\n        self.ctx.listener.setPosition(self._pos[0], self._pos[1], self._pos[2]);\n      }\n    } else {\n      return self._pos;\n    }\n\n    return self;\n  };\n\n  /**\n   * Get/set the direction the listener is pointing in the 3D cartesian space.\n   * A front and up vector must be provided. The front is the direction the\n   * face of the listener is pointing, and up is the direction the top of the\n   * listener is pointing. Thus, these values are expected to be at right angles\n   * from each other.\n   * @param  {Number} x   The x-orientation of the listener.\n   * @param  {Number} y   The y-orientation of the listener.\n   * @param  {Number} z   The z-orientation of the listener.\n   * @param  {Number} xUp The x-orientation of the top of the listener.\n   * @param  {Number} yUp The y-orientation of the top of the listener.\n   * @param  {Number} zUp The z-orientation of the top of the listener.\n   * @return {Howler/Array}     Returns self or the current orientation vectors.\n   */\n  HowlerGlobal.prototype.orientation = function(x, y, z, xUp, yUp, zUp) {\n    var self = this;\n\n    // Stop right here if not using Web Audio.\n    if (!self.ctx || !self.ctx.listener) {\n      return self;\n    }\n\n    // Set the defaults for optional 'y' & 'z'.\n    var or = self._orientation;\n    y = (typeof y !== 'number') ? or[1] : y;\n    z = (typeof z !== 'number') ? or[2] : z;\n    xUp = (typeof xUp !== 'number') ? or[3] : xUp;\n    yUp = (typeof yUp !== 'number') ? or[4] : yUp;\n    zUp = (typeof zUp !== 'number') ? or[5] : zUp;\n\n    if (typeof x === 'number') {\n      self._orientation = [x, y, z, xUp, yUp, zUp];\n\n      if (typeof self.ctx.listener.forwardX !== 'undefined') {\n        self.ctx.listener.forwardX.setTargetAtTime(x, Howler.ctx.currentTime, 0.1);\n        self.ctx.listener.forwardY.setTargetAtTime(y, Howler.ctx.currentTime, 0.1);\n        self.ctx.listener.forwardZ.setTargetAtTime(z, Howler.ctx.currentTime, 0.1);\n        self.ctx.listener.upX.setTargetAtTime(xUp, Howler.ctx.currentTime, 0.1);\n        self.ctx.listener.upY.setTargetAtTime(yUp, Howler.ctx.currentTime, 0.1);\n        self.ctx.listener.upZ.setTargetAtTime(zUp, Howler.ctx.currentTime, 0.1);\n      } else {\n        self.ctx.listener.setOrientation(x, y, z, xUp, yUp, zUp);\n      }\n    } else {\n      return or;\n    }\n\n    return self;\n  };\n\n  /** Group Methods **/\n  /***************************************************************************/\n\n  /**\n   * Add new properties to the core init.\n   * @param  {Function} _super Core init method.\n   * @return {Howl}\n   */\n  Howl.prototype.init = (function(_super) {\n    return function(o) {\n      var self = this;\n\n      // Setup user-defined default properties.\n      self._orientation = o.orientation || [1, 0, 0];\n      self._stereo = o.stereo || null;\n      self._pos = o.pos || null;\n      self._pannerAttr = {\n        coneInnerAngle: typeof o.coneInnerAngle !== 'undefined' ? o.coneInnerAngle : 360,\n        coneOuterAngle: typeof o.coneOuterAngle !== 'undefined' ? o.coneOuterAngle : 360,\n        coneOuterGain: typeof o.coneOuterGain !== 'undefined' ? o.coneOuterGain : 0,\n        distanceModel: typeof o.distanceModel !== 'undefined' ? o.distanceModel : 'inverse',\n        maxDistance: typeof o.maxDistance !== 'undefined' ? o.maxDistance : 10000,\n        panningModel: typeof o.panningModel !== 'undefined' ? o.panningModel : 'HRTF',\n        refDistance: typeof o.refDistance !== 'undefined' ? o.refDistance : 1,\n        rolloffFactor: typeof o.rolloffFactor !== 'undefined' ? o.rolloffFactor : 1\n      };\n\n      // Setup event listeners.\n      self._onstereo = o.onstereo ? [{fn: o.onstereo}] : [];\n      self._onpos = o.onpos ? [{fn: o.onpos}] : [];\n      self._onorientation = o.onorientation ? [{fn: o.onorientation}] : [];\n\n      // Complete initilization with howler.js core's init function.\n      return _super.call(this, o);\n    };\n  })(Howl.prototype.init);\n\n  /**\n   * Get/set the stereo panning of the audio source for this sound or all in the group.\n   * @param  {Number} pan  A value of -1.0 is all the way left and 1.0 is all the way right.\n   * @param  {Number} id (optional) The sound ID. If none is passed, all in group will be updated.\n   * @return {Howl/Number}    Returns self or the current stereo panning value.\n   */\n  Howl.prototype.stereo = function(pan, id) {\n    var self = this;\n\n    // Stop right here if not using Web Audio.\n    if (!self._webAudio) {\n      return self;\n    }\n\n    // If the sound hasn't loaded, add it to the load queue to change stereo pan when capable.\n    if (self._state !== 'loaded') {\n      self._queue.push({\n        event: 'stereo',\n        action: function() {\n          self.stereo(pan, id);\n        }\n      });\n\n      return self;\n    }\n\n    // Check for PannerStereoNode support and fallback to PannerNode if it doesn't exist.\n    var pannerType = (typeof Howler.ctx.createStereoPanner === 'undefined') ? 'spatial' : 'stereo';\n\n    // Setup the group's stereo panning if no ID is passed.\n    if (typeof id === 'undefined') {\n      // Return the group's stereo panning if no parameters are passed.\n      if (typeof pan === 'number') {\n        self._stereo = pan;\n        self._pos = [pan, 0, 0];\n      } else {\n        return self._stereo;\n      }\n    }\n\n    // Change the streo panning of one or all sounds in group.\n    var ids = self._getSoundIds(id);\n    for (var i=0; i<ids.length; i++) {\n      // Get the sound.\n      var sound = self._soundById(ids[i]);\n\n      if (sound) {\n        if (typeof pan === 'number') {\n          sound._stereo = pan;\n          sound._pos = [pan, 0, 0];\n\n          if (sound._node) {\n            // If we are falling back, make sure the panningModel is equalpower.\n            sound._pannerAttr.panningModel = 'equalpower';\n\n            // Check if there is a panner setup and create a new one if not.\n            if (!sound._panner || !sound._panner.pan) {\n              setupPanner(sound, pannerType);\n            }\n\n            if (pannerType === 'spatial') {\n              if (typeof sound._panner.positionX !== 'undefined') {\n                sound._panner.positionX.setValueAtTime(pan, Howler.ctx.currentTime);\n                sound._panner.positionY.setValueAtTime(0, Howler.ctx.currentTime);\n                sound._panner.positionZ.setValueAtTime(0, Howler.ctx.currentTime);\n              } else {\n                sound._panner.setPosition(pan, 0, 0);\n              }\n            } else {\n              sound._panner.pan.setValueAtTime(pan, Howler.ctx.currentTime);\n            }\n          }\n\n          self._emit('stereo', sound._id);\n        } else {\n          return sound._stereo;\n        }\n      }\n    }\n\n    return self;\n  };\n\n  /**\n   * Get/set the 3D spatial position of the audio source for this sound or group relative to the global listener.\n   * @param  {Number} x  The x-position of the audio source.\n   * @param  {Number} y  The y-position of the audio source.\n   * @param  {Number} z  The z-position of the audio source.\n   * @param  {Number} id (optional) The sound ID. If none is passed, all in group will be updated.\n   * @return {Howl/Array}    Returns self or the current 3D spatial position: [x, y, z].\n   */\n  Howl.prototype.pos = function(x, y, z, id) {\n    var self = this;\n\n    // Stop right here if not using Web Audio.\n    if (!self._webAudio) {\n      return self;\n    }\n\n    // If the sound hasn't loaded, add it to the load queue to change position when capable.\n    if (self._state !== 'loaded') {\n      self._queue.push({\n        event: 'pos',\n        action: function() {\n          self.pos(x, y, z, id);\n        }\n      });\n\n      return self;\n    }\n\n    // Set the defaults for optional 'y' & 'z'.\n    y = (typeof y !== 'number') ? 0 : y;\n    z = (typeof z !== 'number') ? -0.5 : z;\n\n    // Setup the group's spatial position if no ID is passed.\n    if (typeof id === 'undefined') {\n      // Return the group's spatial position if no parameters are passed.\n      if (typeof x === 'number') {\n        self._pos = [x, y, z];\n      } else {\n        return self._pos;\n      }\n    }\n\n    // Change the spatial position of one or all sounds in group.\n    var ids = self._getSoundIds(id);\n    for (var i=0; i<ids.length; i++) {\n      // Get the sound.\n      var sound = self._soundById(ids[i]);\n\n      if (sound) {\n        if (typeof x === 'number') {\n          sound._pos = [x, y, z];\n\n          if (sound._node) {\n            // Check if there is a panner setup and create a new one if not.\n            if (!sound._panner || sound._panner.pan) {\n              setupPanner(sound, 'spatial');\n            }\n\n            if (typeof sound._panner.positionX !== 'undefined') {\n              sound._panner.positionX.setValueAtTime(x, Howler.ctx.currentTime);\n              sound._panner.positionY.setValueAtTime(y, Howler.ctx.currentTime);\n              sound._panner.positionZ.setValueAtTime(z, Howler.ctx.currentTime);\n            } else {\n              sound._panner.setPosition(x, y, z);\n            }\n          }\n\n          self._emit('pos', sound._id);\n        } else {\n          return sound._pos;\n        }\n      }\n    }\n\n    return self;\n  };\n\n  /**\n   * Get/set the direction the audio source is pointing in the 3D cartesian coordinate\n   * space. Depending on how direction the sound is, based on the `cone` attributes,\n   * a sound pointing away from the listener can be quiet or silent.\n   * @param  {Number} x  The x-orientation of the source.\n   * @param  {Number} y  The y-orientation of the source.\n   * @param  {Number} z  The z-orientation of the source.\n   * @param  {Number} id (optional) The sound ID. If none is passed, all in group will be updated.\n   * @return {Howl/Array}    Returns self or the current 3D spatial orientation: [x, y, z].\n   */\n  Howl.prototype.orientation = function(x, y, z, id) {\n    var self = this;\n\n    // Stop right here if not using Web Audio.\n    if (!self._webAudio) {\n      return self;\n    }\n\n    // If the sound hasn't loaded, add it to the load queue to change orientation when capable.\n    if (self._state !== 'loaded') {\n      self._queue.push({\n        event: 'orientation',\n        action: function() {\n          self.orientation(x, y, z, id);\n        }\n      });\n\n      return self;\n    }\n\n    // Set the defaults for optional 'y' & 'z'.\n    y = (typeof y !== 'number') ? self._orientation[1] : y;\n    z = (typeof z !== 'number') ? self._orientation[2] : z;\n\n    // Setup the group's spatial orientation if no ID is passed.\n    if (typeof id === 'undefined') {\n      // Return the group's spatial orientation if no parameters are passed.\n      if (typeof x === 'number') {\n        self._orientation = [x, y, z];\n      } else {\n        return self._orientation;\n      }\n    }\n\n    // Change the spatial orientation of one or all sounds in group.\n    var ids = self._getSoundIds(id);\n    for (var i=0; i<ids.length; i++) {\n      // Get the sound.\n      var sound = self._soundById(ids[i]);\n\n      if (sound) {\n        if (typeof x === 'number') {\n          sound._orientation = [x, y, z];\n\n          if (sound._node) {\n            // Check if there is a panner setup and create a new one if not.\n            if (!sound._panner) {\n              // Make sure we have a position to setup the node with.\n              if (!sound._pos) {\n                sound._pos = self._pos || [0, 0, -0.5];\n              }\n\n              setupPanner(sound, 'spatial');\n            }\n\n            if (typeof sound._panner.orientationX !== 'undefined') {\n              sound._panner.orientationX.setValueAtTime(x, Howler.ctx.currentTime);\n              sound._panner.orientationY.setValueAtTime(y, Howler.ctx.currentTime);\n              sound._panner.orientationZ.setValueAtTime(z, Howler.ctx.currentTime);\n            } else {\n              sound._panner.setOrientation(x, y, z);\n            }\n          }\n\n          self._emit('orientation', sound._id);\n        } else {\n          return sound._orientation;\n        }\n      }\n    }\n\n    return self;\n  };\n\n  /**\n   * Get/set the panner node's attributes for a sound or group of sounds.\n   * This method can optionall take 0, 1 or 2 arguments.\n   *   pannerAttr() -> Returns the group's values.\n   *   pannerAttr(id) -> Returns the sound id's values.\n   *   pannerAttr(o) -> Set's the values of all sounds in this Howl group.\n   *   pannerAttr(o, id) -> Set's the values of passed sound id.\n   *\n   *   Attributes:\n   *     coneInnerAngle - (360 by default) A parameter for directional audio sources, this is an angle, in degrees,\n   *                      inside of which there will be no volume reduction.\n   *     coneOuterAngle - (360 by default) A parameter for directional audio sources, this is an angle, in degrees,\n   *                      outside of which the volume will be reduced to a constant value of `coneOuterGain`.\n   *     coneOuterGain - (0 by default) A parameter for directional audio sources, this is the gain outside of the\n   *                     `coneOuterAngle`. It is a linear value in the range `[0, 1]`.\n   *     distanceModel - ('inverse' by default) Determines algorithm used to reduce volume as audio moves away from\n   *                     listener. Can be `linear`, `inverse` or `exponential.\n   *     maxDistance - (10000 by default) The maximum distance between source and listener, after which the volume\n   *                   will not be reduced any further.\n   *     refDistance - (1 by default) A reference distance for reducing volume as source moves further from the listener.\n   *                   This is simply a variable of the distance model and has a different effect depending on which model\n   *                   is used and the scale of your coordinates. Generally, volume will be equal to 1 at this distance.\n   *     rolloffFactor - (1 by default) How quickly the volume reduces as source moves from listener. This is simply a\n   *                     variable of the distance model and can be in the range of `[0, 1]` with `linear` and `[0, ]`\n   *                     with `inverse` and `exponential`.\n   *     panningModel - ('HRTF' by default) Determines which spatialization algorithm is used to position audio.\n   *                     Can be `HRTF` or `equalpower`.\n   *\n   * @return {Howl/Object} Returns self or current panner attributes.\n   */\n  Howl.prototype.pannerAttr = function() {\n    var self = this;\n    var args = arguments;\n    var o, id, sound;\n\n    // Stop right here if not using Web Audio.\n    if (!self._webAudio) {\n      return self;\n    }\n\n    // Determine the values based on arguments.\n    if (args.length === 0) {\n      // Return the group's panner attribute values.\n      return self._pannerAttr;\n    } else if (args.length === 1) {\n      if (typeof args[0] === 'object') {\n        o = args[0];\n\n        // Set the grou's panner attribute values.\n        if (typeof id === 'undefined') {\n          if (!o.pannerAttr) {\n            o.pannerAttr = {\n              coneInnerAngle: o.coneInnerAngle,\n              coneOuterAngle: o.coneOuterAngle,\n              coneOuterGain: o.coneOuterGain,\n              distanceModel: o.distanceModel,\n              maxDistance: o.maxDistance,\n              refDistance: o.refDistance,\n              rolloffFactor: o.rolloffFactor,\n              panningModel: o.panningModel\n            };\n          }\n\n          self._pannerAttr = {\n            coneInnerAngle: typeof o.pannerAttr.coneInnerAngle !== 'undefined' ? o.pannerAttr.coneInnerAngle : self._coneInnerAngle,\n            coneOuterAngle: typeof o.pannerAttr.coneOuterAngle !== 'undefined' ? o.pannerAttr.coneOuterAngle : self._coneOuterAngle,\n            coneOuterGain: typeof o.pannerAttr.coneOuterGain !== 'undefined' ? o.pannerAttr.coneOuterGain : self._coneOuterGain,\n            distanceModel: typeof o.pannerAttr.distanceModel !== 'undefined' ? o.pannerAttr.distanceModel : self._distanceModel,\n            maxDistance: typeof o.pannerAttr.maxDistance !== 'undefined' ? o.pannerAttr.maxDistance : self._maxDistance,\n            refDistance: typeof o.pannerAttr.refDistance !== 'undefined' ? o.pannerAttr.refDistance : self._refDistance,\n            rolloffFactor: typeof o.pannerAttr.rolloffFactor !== 'undefined' ? o.pannerAttr.rolloffFactor : self._rolloffFactor,\n            panningModel: typeof o.pannerAttr.panningModel !== 'undefined' ? o.pannerAttr.panningModel : self._panningModel\n          };\n        }\n      } else {\n        // Return this sound's panner attribute values.\n        sound = self._soundById(parseInt(args[0], 10));\n        return sound ? sound._pannerAttr : self._pannerAttr;\n      }\n    } else if (args.length === 2) {\n      o = args[0];\n      id = parseInt(args[1], 10);\n    }\n\n    // Update the values of the specified sounds.\n    var ids = self._getSoundIds(id);\n    for (var i=0; i<ids.length; i++) {\n      sound = self._soundById(ids[i]);\n\n      if (sound) {\n        // Merge the new values into the sound.\n        var pa = sound._pannerAttr;\n        pa = {\n          coneInnerAngle: typeof o.coneInnerAngle !== 'undefined' ? o.coneInnerAngle : pa.coneInnerAngle,\n          coneOuterAngle: typeof o.coneOuterAngle !== 'undefined' ? o.coneOuterAngle : pa.coneOuterAngle,\n          coneOuterGain: typeof o.coneOuterGain !== 'undefined' ? o.coneOuterGain : pa.coneOuterGain,\n          distanceModel: typeof o.distanceModel !== 'undefined' ? o.distanceModel : pa.distanceModel,\n          maxDistance: typeof o.maxDistance !== 'undefined' ? o.maxDistance : pa.maxDistance,\n          refDistance: typeof o.refDistance !== 'undefined' ? o.refDistance : pa.refDistance,\n          rolloffFactor: typeof o.rolloffFactor !== 'undefined' ? o.rolloffFactor : pa.rolloffFactor,\n          panningModel: typeof o.panningModel !== 'undefined' ? o.panningModel : pa.panningModel\n        };\n\n        // Update the panner values or create a new panner if none exists.\n        var panner = sound._panner;\n        if (panner) {\n          panner.coneInnerAngle = pa.coneInnerAngle;\n          panner.coneOuterAngle = pa.coneOuterAngle;\n          panner.coneOuterGain = pa.coneOuterGain;\n          panner.distanceModel = pa.distanceModel;\n          panner.maxDistance = pa.maxDistance;\n          panner.refDistance = pa.refDistance;\n          panner.rolloffFactor = pa.rolloffFactor;\n          panner.panningModel = pa.panningModel;\n        } else {\n          // Make sure we have a position to setup the node with.\n          if (!sound._pos) {\n            sound._pos = self._pos || [0, 0, -0.5];\n          }\n\n          // Create a new panner node.\n          setupPanner(sound, 'spatial');\n        }\n      }\n    }\n\n    return self;\n  };\n\n  /** Single Sound Methods **/\n  /***************************************************************************/\n\n  /**\n   * Add new properties to the core Sound init.\n   * @param  {Function} _super Core Sound init method.\n   * @return {Sound}\n   */\n  Sound.prototype.init = (function(_super) {\n    return function() {\n      var self = this;\n      var parent = self._parent;\n\n      // Setup user-defined default properties.\n      self._orientation = parent._orientation;\n      self._stereo = parent._stereo;\n      self._pos = parent._pos;\n      self._pannerAttr = parent._pannerAttr;\n\n      // Complete initilization with howler.js core Sound's init function.\n      _super.call(this);\n\n      // If a stereo or position was specified, set it up.\n      if (self._stereo) {\n        parent.stereo(self._stereo);\n      } else if (self._pos) {\n        parent.pos(self._pos[0], self._pos[1], self._pos[2], self._id);\n      }\n    };\n  })(Sound.prototype.init);\n\n  /**\n   * Override the Sound.reset method to clean up properties from the spatial plugin.\n   * @param  {Function} _super Sound reset method.\n   * @return {Sound}\n   */\n  Sound.prototype.reset = (function(_super) {\n    return function() {\n      var self = this;\n      var parent = self._parent;\n\n      // Reset all spatial plugin properties on this sound.\n      self._orientation = parent._orientation;\n      self._stereo = parent._stereo;\n      self._pos = parent._pos;\n      self._pannerAttr = parent._pannerAttr;\n\n      // If a stereo or position was specified, set it up.\n      if (self._stereo) {\n        parent.stereo(self._stereo);\n      } else if (self._pos) {\n        parent.pos(self._pos[0], self._pos[1], self._pos[2], self._id);\n      } else if (self._panner) {\n        // Disconnect the panner.\n        self._panner.disconnect(0);\n        self._panner = undefined;\n        parent._refreshBuffer(self);\n      }\n\n      // Complete resetting of the sound.\n      return _super.call(this);\n    };\n  })(Sound.prototype.reset);\n\n  /** Helper Methods **/\n  /***************************************************************************/\n\n  /**\n   * Create a new panner node and save it on the sound.\n   * @param  {Sound} sound Specific sound to setup panning on.\n   * @param {String} type Type of panner to create: 'stereo' or 'spatial'.\n   */\n  var setupPanner = function(sound, type) {\n    type = type || 'spatial';\n\n    // Create the new panner node.\n    if (type === 'spatial') {\n      sound._panner = Howler.ctx.createPanner();\n      sound._panner.coneInnerAngle = sound._pannerAttr.coneInnerAngle;\n      sound._panner.coneOuterAngle = sound._pannerAttr.coneOuterAngle;\n      sound._panner.coneOuterGain = sound._pannerAttr.coneOuterGain;\n      sound._panner.distanceModel = sound._pannerAttr.distanceModel;\n      sound._panner.maxDistance = sound._pannerAttr.maxDistance;\n      sound._panner.refDistance = sound._pannerAttr.refDistance;\n      sound._panner.rolloffFactor = sound._pannerAttr.rolloffFactor;\n      sound._panner.panningModel = sound._pannerAttr.panningModel;\n\n      if (typeof sound._panner.positionX !== 'undefined') {\n        sound._panner.positionX.setValueAtTime(sound._pos[0], Howler.ctx.currentTime);\n        sound._panner.positionY.setValueAtTime(sound._pos[1], Howler.ctx.currentTime);\n        sound._panner.positionZ.setValueAtTime(sound._pos[2], Howler.ctx.currentTime);\n      } else {\n        sound._panner.setPosition(sound._pos[0], sound._pos[1], sound._pos[2]);\n      }\n\n      if (typeof sound._panner.orientationX !== 'undefined') {\n        sound._panner.orientationX.setValueAtTime(sound._orientation[0], Howler.ctx.currentTime);\n        sound._panner.orientationY.setValueAtTime(sound._orientation[1], Howler.ctx.currentTime);\n        sound._panner.orientationZ.setValueAtTime(sound._orientation[2], Howler.ctx.currentTime);\n      } else {\n        sound._panner.setOrientation(sound._orientation[0], sound._orientation[1], sound._orientation[2]);\n      }\n    } else {\n      sound._panner = Howler.ctx.createStereoPanner();\n      sound._panner.pan.setValueAtTime(sound._stereo, Howler.ctx.currentTime);\n    }\n\n    sound._panner.connect(sound._node);\n\n    // Update the connections.\n    if (!sound._paused) {\n      sound._parent.pause(sound._id, true).play(sound._id, true);\n    }\n  };\n})();\n","import Renderer from './rendering/RenderManager';\r\nimport InputController from './input/InputController';\r\nimport ActionSystem from '../systems/ActionSystem';\r\nimport RenderSystem from '../systems/RenderSystem';\r\nimport UISystem from '../systems/UISystem';\r\nimport MouseManager from './input/MouseManager';\r\nimport CommandManager from './input/CommandManager';\r\nimport ScreenManager from './screens/ScreenManager';\r\nimport PlayerManager from './PlayerManager';\r\nimport ECS from '../ecs';\r\nimport GameStateManager from './GameStateManager';\r\nimport ClockManager from './ClockManager';\r\nimport MapManager from './MapManager';\r\nimport FOVSystem from '../systems/FOVSystem';\r\nimport DeathSystem from '../systems/DeathSystem';\r\nimport ParticleSystem from '../systems/ParticleSystem';\r\nimport FactionManager from './FactionManager';\r\nimport CameraManager from './CameraManager';\r\nimport FPSMonitoringSystem from '../systems/FPSMonitoringSystem';\r\nimport { WorldManager } from './WorldManager';\r\nimport ConsoleManager from './ConsoleManager';\r\nimport DestroySystem from '../systems/DestroySystem';\r\nimport MusicManager from './MusicManager';\r\nimport StatusSystem from '../systems/StatusSystem';\r\nimport LiquidSystem from '../systems/LiquidSystem';\r\nimport TrapSystem from '../systems/TrapSystem';\r\nimport FireSystem from '../systems/FireSystem';\r\nimport TemperatureSystem from '../systems/TemperatureSystem';\r\nimport AbilitySystem from '../systems/AbilitySystem';\r\nimport HealthShardSystem from '../systems/HealthShardSystem';\r\nimport CompressionSystem from '../systems/CompressionSystem';\r\nimport BitmaskManager from './BitmaskManager';\r\nimport ChunkManager from './ChunkManager';\r\n\r\nexport default class Game {\r\n    #lastUpdate;\r\n\r\n    get ecs() {\r\n        return this.engine.engine;\r\n    }\r\n\r\n    constructor() {\r\n        this.engine = new ECS(this);\r\n        this.music = new MusicManager(this);\r\n        this.mouse = new MouseManager(this);\r\n        this.clock = new ClockManager(this);\r\n        this.renderer = new Renderer(this);\r\n        this.state = new GameStateManager(this);\r\n        this.world = new WorldManager(this);\r\n        this.chunks = new ChunkManager(this);\r\n        this.map = new MapManager(this);\r\n        this.camera = new CameraManager(this);\r\n        this.factions = new FactionManager(this);\r\n        this.player = new PlayerManager(this);\r\n        this.commands = new CommandManager(this);\r\n        this.screens = new ScreenManager(this);\r\n        this.input = new InputController(this);\r\n        this.console = new ConsoleManager(this);\r\n        this.bitmasks = new BitmaskManager(this);\r\n\r\n        this.actionSystem = new ActionSystem(this);\r\n        this.deathSystem = new DeathSystem(this);\r\n        this.statusSystem = new StatusSystem(this);\r\n        this.FOVSystem = new FOVSystem(this);\r\n        this.renderSystem = new RenderSystem(this);\r\n        this.UISystem = new UISystem(this);\r\n        this.particles = new ParticleSystem(this);\r\n        this.fps = new FPSMonitoringSystem(this);\r\n        this.destroySystem = new DestroySystem(this);\r\n        this.liquidSystem = new LiquidSystem(this);\r\n        this.trapSystem = new TrapSystem(this);\r\n        this.fireSystem = new FireSystem(this);\r\n        this.temperature = new TemperatureSystem(this);\r\n        this.abilities = new AbilitySystem(this);\r\n        this.compression = new CompressionSystem(this);\r\n        this.healthShardSystem = new HealthShardSystem(this);\r\n    }\r\n\r\n    start() {\r\n        this.#lastUpdate = Date.now();\r\n        this.boundLoop = this.loop.bind(this);\r\n        requestAnimationFrame(this.loop.bind(this));\r\n    }\r\n\r\n    updateAdventureSystems(dt) {\r\n        for (let i = 0; i < 20; i++) {\r\n            this.clock.update(dt);\r\n\r\n            const playerTurn = this.actionSystem.update(dt);\r\n\r\n            this.compression.update(dt);\r\n            this.healthShardSystem.update(dt);\r\n            this.liquidSystem.update(dt);\r\n            this.trapSystem.update(dt);\r\n            this.fireSystem.update(dt);\r\n            this.temperature.update(dt);\r\n            this.statusSystem.update(dt);\r\n            this.abilities.update(dt);\r\n            this.deathSystem.update(dt);\r\n            this.destroySystem.update(dt);\r\n            this.chunks.update(dt);\r\n\r\n            if (playerTurn) {\r\n                this.updatePlayerSystems(dt);\r\n                return;\r\n            }\r\n        }\r\n    }\r\n\r\n    updatePlayerSystems(dt) {\r\n        this.FOVSystem.update(dt);\r\n        this.renderSystem.update(dt);\r\n        this.particles.update(dt);\r\n        this.UISystem.update(dt);\r\n        this.map.update(dt);\r\n        this.console.render(dt);\r\n    }\r\n\r\n    loop(t) {\r\n        const now = Date.now();\r\n        const dt = now - this.#lastUpdate;\r\n\r\n        this.screens.update(dt);\r\n        this.fps.update(dt);\r\n        this.renderer.render();\r\n\r\n        this.#lastUpdate = now;\r\n\r\n        requestAnimationFrame(this.boundLoop);\r\n    }\r\n}\r\n\r\nexport const game = new Game();\r\n","import Manager from '../Manager';\r\nimport Display from './Display';\r\nimport spritesheets from './spritesheets';\r\n\r\nexport default class Renderer extends Manager {\r\n    tileWidth = 16;\r\n    tileHeight = 16;\r\n    #spritesheets = {};\r\n    #display = null;\r\n\r\n    get display() {\r\n        return this.#display;\r\n    }\r\n\r\n    get canvas() {\r\n        return this.display.canvas;\r\n    }\r\n\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        spritesheets().forEach((spritesheet) => {\r\n            this.#spritesheets[spritesheet.name] = spritesheet;\r\n        });\r\n\r\n        this.#display = new Display({\r\n            width: 20,\r\n            height: 20,\r\n            tileWidth: this.tileWidth,\r\n            tileHeight: this.tileHeight,\r\n        });\r\n\r\n        document.body.appendChild(this.display.canvas);\r\n    }\r\n\r\n    resizeDisplay(width, height, zoom) {\r\n        this.display.setSize(width, height, zoom);\r\n    }\r\n\r\n    draw(x, y, char, fg1 = '#adb8bc', fg2 = '#333', bg) {\r\n        const sprite = this.#spritesheets.tiles.getSprite(char);\r\n\r\n        this.display.draw(x, y, sprite, fg1, fg2, bg);\r\n    }\r\n\r\n    drawUI(x, y, char, fg1 = '#adb8bc', fg2 = '#333', bg) {\r\n        const sprite = this.#spritesheets.ui.getSprite(char);\r\n\r\n        this.display.draw(x, y, sprite, fg1, fg2, bg);\r\n    }\r\n\r\n    computeTextWidth(text) {\r\n        return text.length * 0.5;\r\n    }\r\n\r\n    computeTextWidthTile(text) {\r\n        return Math.ceil(this.computeTextWidth(text));\r\n    }\r\n\r\n    drawTextWrapping(x, y, width, text, fg1, fg2, bg) {\r\n        if (this.computeTextWidthTile(text) < width) {\r\n            return this.drawText(x, y, text, fg1, fg2, bg);\r\n        }\r\n\r\n        let left;\r\n        let right;\r\n        let lastSpace = -1;\r\n\r\n        for (let i = 0; i < text.length; i++) {\r\n            const nextLeft = text.substr(0, i);\r\n\r\n            if (this.computeTextWidthTile(nextLeft) >= width) {\r\n                break;\r\n            }\r\n\r\n            if (text.charAt(i) === ' ') {\r\n                left = nextLeft;\r\n                right = text.substr(i, text.length - left.length).trimLeft();\r\n                lastSpace = i;\r\n            }\r\n        }\r\n\r\n        if (lastSpace >= 0) {\r\n            this.drawText(x, y, left, fg1, fg2, bg);\r\n            this.drawTextWrapping(x, y + 1, width, right, fg1, fg2, bg);\r\n        }\r\n    }\r\n\r\n    drawText(x, y, text, fg1 = '#adb8bc', fg2 = '#333', bg) {\r\n        for (let i = 0; i < text.length; i++) {\r\n            const sprite = this.#spritesheets.font.getSprite(text.charAt(i));\r\n\r\n            this.display.draw(x + 0.5 * i, y, sprite, fg1, fg2, bg);\r\n        }\r\n    }\r\n\r\n    drawTextCenter(y, text, fg1 = '#adb8bc', fg2 = '#333', bg) {\r\n        const len = this.computeTextWidth(text);\r\n\r\n        this.drawText(\r\n            Math.ceil((this.game.camera.width - len) / 2),\r\n            y,\r\n            text,\r\n            fg1,\r\n            fg2,\r\n            bg\r\n        );\r\n    }\r\n\r\n    clear() {\r\n        this.display.clear();\r\n    }\r\n\r\n    clearArea(x, y, width, height) {\r\n        this.display.clearArea(x, y, width, height);\r\n    }\r\n\r\n    pxToTile(xPx, yPx) {\r\n        const x = Math.trunc(xPx / this.tileWidth);\r\n        const y = Math.trunc(yPx / this.tileHeight);\r\n\r\n        return { x, y };\r\n    }\r\n\r\n    render() {\r\n        this.display.render();\r\n    }\r\n}\r\n","export default class Manager {\n    #game;\n\n    get game() {\n        return this.#game;\n    }\n\n    constructor(game) {\n        this.#game = game;\n    }\n\n    onNewGame() {}\n    getSaveGameData() {}\n}\n","import Grid from '../../utils/Grid';\r\n\r\nexport default class Display {\r\n    ctx;\r\n    canvas;\r\n    width;\r\n    height;\r\n    zoom = 1;\r\n    tileWidth;\r\n    tileHeight;\r\n    cells;\r\n    clearColor = '#1f1e1d';\r\n\r\n    constructor({ width, height, tileWidth, tileHeight }) {\r\n        this.tileWidth = tileWidth;\r\n        this.tileHeight = tileHeight;\r\n\r\n        this.cells = new Grid(width * 2, height, () => null);\r\n        this.cells.suppressOOBWarn = true;\r\n\r\n        this.canvas = document.createElement('canvas');\r\n        this.ctx = this.canvas.getContext('2d', { alpha: false });\r\n        this.ctx.globalCompositeOperation = 'destination-over';\r\n\r\n        this.ctx.font = `${this.tileHeight}px monospace`;\r\n        this.ctx.textBaseline = 'top';\r\n\r\n        this.setSize(width, height);\r\n    }\r\n\r\n    setSize(width, height, zoom) {\r\n        this.width = width;\r\n        this.height = height;\r\n        this.zoom = zoom;\r\n\r\n        const widthPx = this.tileWidth * this.width;\r\n        const heightPx = this.tileHeight * this.height;\r\n\r\n        this.canvas.style.cssText = `width: ${widthPx}px; height: ${heightPx}px; transform: scale(${this.zoom})`;\r\n        this.canvas.width = widthPx;\r\n        this.canvas.height = heightPx;\r\n\r\n        this.cells.clearAndResize(width * 2, height);\r\n    }\r\n\r\n    draw(x, y, sprite, fg1, fg2, bg) {\r\n        this.cells.set(x * 2, y, {\r\n            img: sprite.colorize(fg1, fg2),\r\n            width: sprite.width,\r\n            height: sprite.height,\r\n            bg,\r\n            x,\r\n            y,\r\n        });\r\n    }\r\n\r\n    clear() {\r\n        this.ctx.fillStyle = this.clearColor;\r\n        this.ctx.fillRect(\r\n            0,\r\n            0,\r\n            this.tileWidth * this.width,\r\n            this.tileHeight * this.height\r\n        );\r\n        this.cells.clear();\r\n    }\r\n\r\n    clearArea(x, y, width, height) {\r\n        this.ctx.fillStyle = this.clearColor;\r\n        this.ctx.fillRect(\r\n            x * this.tileWidth,\r\n            y * this.tileHeight,\r\n            this.tileWidth * width,\r\n            this.tileHeight * height\r\n        );\r\n\r\n        const offsetX = x * 2;\r\n\r\n        for (let i = 0; i < width; i++) {\r\n            for (let j = 0; j < height; j++) {\r\n                const cellX = offsetX + i * 2;\r\n                const cellY = y + j;\r\n\r\n                this.cells.set(cellX, cellY, undefined);\r\n                this.cells.set(cellX + 1, cellY, undefined);\r\n            }\r\n        }\r\n    }\r\n\r\n    render() {\r\n        this.cells.data\r\n            .filter((c) => c)\r\n            .forEach((cell) => {\r\n                const pixelX = cell.x * this.tileWidth;\r\n                const pixelY = cell.y * this.tileHeight;\r\n\r\n                if (cell.bg) {\r\n                    this.ctx.fillStyle = cell.bg;\r\n                    this.ctx.fillRect(pixelX, pixelY, cell.width, cell.height);\r\n                }\r\n\r\n                if (cell.img) {\r\n                    this.ctx.drawImage(cell.img, pixelX, pixelY);\r\n                }\r\n            });\r\n    }\r\n}\r\n","export default class Grid {\r\n    _width = 0;\r\n    _height = 0;\r\n    data = [];\r\n    suppressOOBWarn = false;\r\n    defaultValueGenerator = () => null;\r\n\r\n    get width() {\r\n        return this._width;\r\n    }\r\n\r\n    get height() {\r\n        return this._height;\r\n    }\r\n\r\n    get size() {\r\n        return this._width * this._height;\r\n    }\r\n\r\n    constructor(width, height, defaultValueGenerator = () => null) {\r\n        this._width = width;\r\n        this._height = height;\r\n        this.defaultValueGenerator = defaultValueGenerator;\r\n\r\n        this.clear();\r\n    }\r\n\r\n    idx(x, y) {\r\n        return y * this._width + x;\r\n    }\r\n\r\n    coord(idx) {\r\n        return {\r\n            x: Math.trunc(idx % this._width),\r\n            y: Math.trunc(idx / this._width),\r\n        };\r\n    }\r\n\r\n    clear() {\r\n        this.data = [];\r\n\r\n        for (let i = 0; i < this.size; i++) {\r\n            const { x, y } = this.coord(i);\r\n\r\n            this.data[i] = this.defaultValueGenerator(x, y, this.idx(x, y));\r\n        }\r\n    }\r\n\r\n    setAll(value) {\r\n        this.data = [];\r\n\r\n        for (let i = 0; i < this.size; i++) {\r\n            this.data[i] = value;\r\n        }\r\n    }\r\n\r\n    set(x, y, value) {\r\n        if (this.isOutOfBounds(x, y)) {\r\n            if (!this.suppressOOBWarn) {\r\n                console.warn(\r\n                    `Trying to set out-of-bounds coordinates (${x}, ${y}) to value ${value}`\r\n                );\r\n            }\r\n            return;\r\n        }\r\n\r\n        const idx = this.idx(x, y);\r\n\r\n        this.data[idx] = value;\r\n    }\r\n\r\n    serialize() {\r\n        const entries = [...this.data];\r\n\r\n        return {\r\n            width: this.width,\r\n            height: this.height,\r\n            entries,\r\n        };\r\n    }\r\n\r\n    deserialize(data) {\r\n        this._width = data.width;\r\n        this._height = data.height;\r\n        this.data = data.entries;\r\n    }\r\n\r\n    get(x, y) {\r\n        if (this.isOutOfBounds(x, y)) {\r\n            return this.defaultValueGenerator();\r\n        }\r\n\r\n        return this.data[this.idx(x, y)];\r\n    }\r\n\r\n    isOutOfBounds(x, y) {\r\n        return x < 0 || y < 0 || x >= this._width || y >= this.height;\r\n    }\r\n\r\n    getNeighbors(x, y) {\r\n        return [\r\n            this.get(x - 1, y - 1), // TOP LEFT\r\n            this.get(x, y - 1), // TOP\r\n            this.get(x + 1, y - 1), // TOP RIGHT\r\n            this.get(x - 1, y), // LEFT\r\n            this.get(x + 1, y), // RIGHT\r\n            this.get(x - 1, y + 1), // BOTTOM LEFT\r\n            this.get(x, y + 1), // BOTTOM\r\n            this.get(x + 1, y + 1), // BOTTOM RIGHT\r\n        ];\r\n    }\r\n\r\n    clearAndResize(width, height) {\r\n        this._width = width;\r\n        this._height = height;\r\n        this.clear();\r\n    }\r\n}\r\n","import SpriteSheet from './SpriteSheet';\r\n\r\nexport default () => {\r\n    const tileImage = document.getElementById('spritesheet-tiles');\r\n    const fontImage = document.getElementById('spritesheet-font');\r\n    const uiImage = document.getElementById('spritesheet-ui');\r\n\r\n    return [\r\n        new SpriteSheet('tiles', tileImage),\r\n        new SpriteSheet('font', fontImage),\r\n        new SpriteSheet('ui', uiImage),\r\n    ];\r\n};\r\n","import cp437 from './cp437';\nimport Sprite from './Sprite';\n\nexport default class SpriteSheet {\n    #name = null;\n    #defaultGlyph = '?';\n    #sprites = {};\n\n    get name() {\n        return this.#name;\n    }\n\n    get width() {\n        return this.image.width;\n    }\n\n    get height() {\n        return this.image.height;\n    }\n\n    get spriteCountX() {\n        return 16;\n    }\n\n    get spriteCountY() {\n        return 16;\n    }\n\n    constructor(name, image) {\n        this.#name = name;\n        this.image = image;\n\n        this.spriteWidth = this.image.width / this.spriteCountX;\n        this.spriteHeight = this.image.height / this.spriteCountY;\n\n        cp437.forEach((row, i) => {\n            row.forEach((glyph, j) => {\n                this.#sprites[glyph] = new Sprite(glyph, this, j, i);\n            });\n        });\n    }\n\n    getSprite(glyph) {\n        if (this.#sprites[glyph]) {\n            return this.#sprites[glyph];\n        }\n\n        return this.#sprites[this.#defaultGlyph];\n    }\n}\n","// prettier-ignore\nexport default [\n    ['NUL', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n    ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n    [' ', '!', '\"', '#', '$', '%', '&', '\\'', '(', ')', '*', '+', ',', '-', '.', '/'],\n    ['0', '1', '2', '3', '4', '5', '6', '7', '8', '9', ':', ';', '<', '=', '>', '?'],\n    ['@', 'A', 'B', 'C', 'D', 'E', 'F', 'G', 'H', 'I', 'J', 'K', 'L', 'M', 'N', 'O'],\n    ['P', 'Q', 'R', 'S', 'T', 'U', 'V', 'W', 'X', 'Y', 'Z', '[', '\\\\', ']', '^', '_'],\n    ['`', 'a', 'b', 'c', 'd', 'e', 'f', 'g', 'h', 'i', 'j', 'k', 'l', 'm', 'n', 'o'],\n    ['p', 'q', 'r', 's', 't', 'u', 'v', 'w', 'x', 'y', 'z', '{', '|', '}', '~', ''],\n    ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n    ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n    ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n    ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n    ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n    ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n    ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', ''],\n    ['', '', '', '', '', '', '', '', '', '', '', '', '', '', '', 'NBSP'],\n];\n","import { parseColor } from '../../utils/ColorParser';\r\nimport { isBlack, isWhite } from '../../utils/ColorUtil';\r\n\r\nexport default class Sprite {\r\n    #ctx = null;\r\n    #glyph = null;\r\n    #sheet = null;\r\n    #x = null;\r\n    #y = null;\r\n    _cache = {};\r\n\r\n    get glyph() {\r\n        return this.#glyph;\r\n    }\r\n\r\n    get x() {\r\n        return this.#x;\r\n    }\r\n\r\n    get y() {\r\n        return this.#y;\r\n    }\r\n\r\n    get sheet() {\r\n        return this.#sheet;\r\n    }\r\n\r\n    get image() {\r\n        return this.sheet.image;\r\n    }\r\n\r\n    get sourceX() {\r\n        return this.sheet.spriteWidth * this.x;\r\n    }\r\n\r\n    get sourceY() {\r\n        return this.sheet.spriteHeight * this.y;\r\n    }\r\n\r\n    get width() {\r\n        return this.sheet.spriteWidth;\r\n    }\r\n\r\n    get height() {\r\n        return this.sheet.spriteHeight;\r\n    }\r\n\r\n    constructor(glyph, sheet, x, y) {\r\n        this.#glyph = glyph;\r\n        this.#sheet = sheet;\r\n        this.#x = x;\r\n        this.#y = y;\r\n\r\n        const canvas = document.createElement('canvas');\r\n\r\n        canvas.width = this.width;\r\n        canvas.height = this.height;\r\n\r\n        this.#ctx = canvas.getContext('2d');\r\n\r\n        this.#ctx.drawImage(\r\n            this.sheet.image,\r\n            this.sourceX,\r\n            this.sourceY,\r\n            this.width,\r\n            this.height,\r\n            0,\r\n            0,\r\n            this.width,\r\n            this.height\r\n        );\r\n    }\r\n\r\n    colorize(primaryCss, secondaryCss) {\r\n        const primary = parseColor(primaryCss);\r\n        const secondary = parseColor(secondaryCss);\r\n\r\n        const key = `${primary.key}-${secondary.key}`;\r\n\r\n        if (this._cache.hasOwnProperty(key)) {\r\n            return this._cache[key];\r\n        }\r\n\r\n        const pixels = this.#ctx.getImageData(0, 0, this.width, this.height);\r\n\r\n        for (let i = 0; i < pixels.data.length; i += 4) {\r\n            const r = pixels.data[i + 0];\r\n            const g = pixels.data[i + 1];\r\n            const b = pixels.data[i + 2];\r\n            const a = pixels.data[i + 3];\r\n\r\n            if (isBlack(r, g, b)) {\r\n                pixels.data[i] = primary[0];\r\n                pixels.data[i + 1] = primary[1];\r\n                pixels.data[i + 2] = primary[2];\r\n                pixels.data[i + 3] = a;\r\n            } else if (isWhite(r, g, b)) {\r\n                pixels.data[i] = secondary[0];\r\n                pixels.data[i + 1] = secondary[1];\r\n                pixels.data[i + 2] = secondary[2];\r\n                pixels.data[i + 3] = a;\r\n            }\r\n        }\r\n\r\n        const cvs = document.createElement('canvas');\r\n\r\n        cvs.width = this.width;\r\n        cvs.height = this.height;\r\n\r\n        cvs.getContext('2d').putImageData(pixels, 0, 0);\r\n\r\n        this._cache[key] = cvs;\r\n\r\n        return cvs;\r\n    }\r\n}\r\n","import colorParse from 'color-parse';\r\n\r\nconst cache = {};\r\n\r\nexport const parseColor = (colorStr) => {\r\n    if (!cache.hasOwnProperty(colorStr)) {\r\n        const parsed = colorParse(colorStr).values;\r\n        const data = [parsed[0], parsed[1], parsed[2], parsed.alpha];\r\n\r\n        data.key = `${data[0]},${data[1]},${data[2]},${data[3]}`;\r\n\r\n        cache[colorStr] = data;\r\n    }\r\n\r\n    return cache[colorStr];\r\n};\r\n","/**\r\n * @module color-parse\r\n */\r\nimport names from 'color-name'\r\n\r\nexport default parse\r\n\r\n/**\r\n * Base hues\r\n * http://dev.w3.org/csswg/css-color/#typedef-named-hue\r\n */\r\n//FIXME: use external hue detector\r\nvar baseHues = {\r\n\tred: 0,\r\n\torange: 60,\r\n\tyellow: 120,\r\n\tgreen: 180,\r\n\tblue: 240,\r\n\tpurple: 300\r\n}\r\n\r\n/**\r\n * Parse color from the string passed\r\n *\r\n * @return {Object} A space indicator `space`, an array `values` and `alpha`\r\n */\r\nfunction parse (cstr) {\r\n\tvar m, parts = [], alpha = 1, space\r\n\r\n\tif (typeof cstr === 'string') {\r\n\t\t//keyword\r\n\t\tif (names[cstr]) {\r\n\t\t\tparts = names[cstr].slice()\r\n\t\t\tspace = 'rgb'\r\n\t\t}\r\n\r\n\t\t//reserved words\r\n\t\telse if (cstr === 'transparent') {\r\n\t\t\talpha = 0\r\n\t\t\tspace = 'rgb'\r\n\t\t\tparts = [0,0,0]\r\n\t\t}\r\n\r\n\t\t//hex\r\n\t\telse if (/^#[A-Fa-f0-9]+$/.test(cstr)) {\r\n\t\t\tvar base = cstr.slice(1)\r\n\t\t\tvar size = base.length\r\n\t\t\tvar isShort = size <= 4\r\n\t\t\talpha = 1\r\n\r\n\t\t\tif (isShort) {\r\n\t\t\t\tparts = [\r\n\t\t\t\t\tparseInt(base[0] + base[0], 16),\r\n\t\t\t\t\tparseInt(base[1] + base[1], 16),\r\n\t\t\t\t\tparseInt(base[2] + base[2], 16)\r\n\t\t\t\t]\r\n\t\t\t\tif (size === 4) {\r\n\t\t\t\t\talpha = parseInt(base[3] + base[3], 16) / 255\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\telse {\r\n\t\t\t\tparts = [\r\n\t\t\t\t\tparseInt(base[0] + base[1], 16),\r\n\t\t\t\t\tparseInt(base[2] + base[3], 16),\r\n\t\t\t\t\tparseInt(base[4] + base[5], 16)\r\n\t\t\t\t]\r\n\t\t\t\tif (size === 8) {\r\n\t\t\t\t\talpha = parseInt(base[6] + base[7], 16) / 255\r\n\t\t\t\t}\r\n\t\t\t}\r\n\r\n\t\t\tif (!parts[0]) parts[0] = 0\r\n\t\t\tif (!parts[1]) parts[1] = 0\r\n\t\t\tif (!parts[2]) parts[2] = 0\r\n\r\n\t\t\tspace = 'rgb'\r\n\t\t}\r\n\r\n\t\t//color space\r\n\t\telse if (m = /^((?:rgb|hs[lvb]|hwb|cmyk?|xy[zy]|gray|lab|lchu?v?|[ly]uv|lms)a?)\\s*\\(([^\\)]*)\\)/.exec(cstr)) {\r\n\t\t\tvar name = m[1]\r\n\t\t\tvar isRGB = name === 'rgb'\r\n\t\t\tvar base = name.replace(/a$/, '')\r\n\t\t\tspace = base\r\n\t\t\tvar size = base === 'cmyk' ? 4 : base === 'gray' ? 1 : 3\r\n\t\t\tparts = m[2].trim()\r\n\t\t\t\t.split(/\\s*[,\\/]\\s*|\\s+/)\r\n\t\t\t\t.map(function (x, i) {\r\n\t\t\t\t\t//<percentage>\r\n\t\t\t\t\tif (/%$/.test(x)) {\r\n\t\t\t\t\t\t//alpha\r\n\t\t\t\t\t\tif (i === size)\treturn parseFloat(x) / 100\r\n\t\t\t\t\t\t//rgb\r\n\t\t\t\t\t\tif (base === 'rgb') return parseFloat(x) * 255 / 100\r\n\t\t\t\t\t\treturn parseFloat(x)\r\n\t\t\t\t\t}\r\n\t\t\t\t\t//hue\r\n\t\t\t\t\telse if (base[i] === 'h') {\r\n\t\t\t\t\t\t//<deg>\r\n\t\t\t\t\t\tif (/deg$/.test(x)) {\r\n\t\t\t\t\t\t\treturn parseFloat(x)\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t\t//<base-hue>\r\n\t\t\t\t\t\telse if (baseHues[x] !== undefined) {\r\n\t\t\t\t\t\t\treturn baseHues[x]\r\n\t\t\t\t\t\t}\r\n\t\t\t\t\t}\r\n\t\t\t\t\treturn parseFloat(x)\r\n\t\t\t\t})\r\n\r\n\t\t\tif (name === base) parts.push(1)\r\n\t\t\talpha = (isRGB) ? 1 : (parts[size] === undefined) ? 1 : parts[size]\r\n\t\t\tparts = parts.slice(0, size)\r\n\t\t}\r\n\r\n\t\t//named channels case\r\n\t\telse if (cstr.length > 10 && /[0-9](?:\\s|\\/)/.test(cstr)) {\r\n\t\t\tparts = cstr.match(/([0-9]+)/g).map(function (value) {\r\n\t\t\t\treturn parseFloat(value)\r\n\t\t\t})\r\n\r\n\t\t\tspace = cstr.match(/([a-z])/ig).join('').toLowerCase()\r\n\t\t}\r\n\t}\r\n\r\n\t//numeric case\r\n\telse if (!isNaN(cstr)) {\r\n\t\tspace = 'rgb'\r\n\t\tparts = [cstr >>> 16, (cstr & 0x00ff00) >>> 8, cstr & 0x0000ff]\r\n\t}\r\n\r\n\t//array-like\r\n\telse if (Array.isArray(cstr) || cstr.length) {\r\n\t\tparts = [cstr[0], cstr[1], cstr[2]]\r\n\t\tspace = 'rgb'\r\n\t\talpha = cstr.length === 4 ? cstr[3] : 1\r\n\t}\r\n\r\n\t//object case - detects css cases of rgb and hsl\r\n\telse if (cstr instanceof Object) {\r\n\t\tif (cstr.r != null || cstr.red != null || cstr.R != null) {\r\n\t\t\tspace = 'rgb'\r\n\t\t\tparts = [\r\n\t\t\t\tcstr.r || cstr.red || cstr.R || 0,\r\n\t\t\t\tcstr.g || cstr.green || cstr.G || 0,\r\n\t\t\t\tcstr.b || cstr.blue || cstr.B || 0\r\n\t\t\t]\r\n\t\t}\r\n\t\telse {\r\n\t\t\tspace = 'hsl'\r\n\t\t\tparts = [\r\n\t\t\t\tcstr.h || cstr.hue || cstr.H || 0,\r\n\t\t\t\tcstr.s || cstr.saturation || cstr.S || 0,\r\n\t\t\t\tcstr.l || cstr.lightness || cstr.L || cstr.b || cstr.brightness\r\n\t\t\t]\r\n\t\t}\r\n\r\n\t\talpha = cstr.a || cstr.alpha || cstr.opacity || 1\r\n\r\n\t\tif (cstr.opacity != null) alpha /= 100\r\n\t}\r\n\r\n\treturn {\r\n\t\tspace: space,\r\n\t\tvalues: parts,\r\n\t\talpha: alpha\r\n\t}\r\n}\r\n","'use strict'\r\n\r\nmodule.exports = {\r\n\t\"aliceblue\": [240, 248, 255],\r\n\t\"antiquewhite\": [250, 235, 215],\r\n\t\"aqua\": [0, 255, 255],\r\n\t\"aquamarine\": [127, 255, 212],\r\n\t\"azure\": [240, 255, 255],\r\n\t\"beige\": [245, 245, 220],\r\n\t\"bisque\": [255, 228, 196],\r\n\t\"black\": [0, 0, 0],\r\n\t\"blanchedalmond\": [255, 235, 205],\r\n\t\"blue\": [0, 0, 255],\r\n\t\"blueviolet\": [138, 43, 226],\r\n\t\"brown\": [165, 42, 42],\r\n\t\"burlywood\": [222, 184, 135],\r\n\t\"cadetblue\": [95, 158, 160],\r\n\t\"chartreuse\": [127, 255, 0],\r\n\t\"chocolate\": [210, 105, 30],\r\n\t\"coral\": [255, 127, 80],\r\n\t\"cornflowerblue\": [100, 149, 237],\r\n\t\"cornsilk\": [255, 248, 220],\r\n\t\"crimson\": [220, 20, 60],\r\n\t\"cyan\": [0, 255, 255],\r\n\t\"darkblue\": [0, 0, 139],\r\n\t\"darkcyan\": [0, 139, 139],\r\n\t\"darkgoldenrod\": [184, 134, 11],\r\n\t\"darkgray\": [169, 169, 169],\r\n\t\"darkgreen\": [0, 100, 0],\r\n\t\"darkgrey\": [169, 169, 169],\r\n\t\"darkkhaki\": [189, 183, 107],\r\n\t\"darkmagenta\": [139, 0, 139],\r\n\t\"darkolivegreen\": [85, 107, 47],\r\n\t\"darkorange\": [255, 140, 0],\r\n\t\"darkorchid\": [153, 50, 204],\r\n\t\"darkred\": [139, 0, 0],\r\n\t\"darksalmon\": [233, 150, 122],\r\n\t\"darkseagreen\": [143, 188, 143],\r\n\t\"darkslateblue\": [72, 61, 139],\r\n\t\"darkslategray\": [47, 79, 79],\r\n\t\"darkslategrey\": [47, 79, 79],\r\n\t\"darkturquoise\": [0, 206, 209],\r\n\t\"darkviolet\": [148, 0, 211],\r\n\t\"deeppink\": [255, 20, 147],\r\n\t\"deepskyblue\": [0, 191, 255],\r\n\t\"dimgray\": [105, 105, 105],\r\n\t\"dimgrey\": [105, 105, 105],\r\n\t\"dodgerblue\": [30, 144, 255],\r\n\t\"firebrick\": [178, 34, 34],\r\n\t\"floralwhite\": [255, 250, 240],\r\n\t\"forestgreen\": [34, 139, 34],\r\n\t\"fuchsia\": [255, 0, 255],\r\n\t\"gainsboro\": [220, 220, 220],\r\n\t\"ghostwhite\": [248, 248, 255],\r\n\t\"gold\": [255, 215, 0],\r\n\t\"goldenrod\": [218, 165, 32],\r\n\t\"gray\": [128, 128, 128],\r\n\t\"green\": [0, 128, 0],\r\n\t\"greenyellow\": [173, 255, 47],\r\n\t\"grey\": [128, 128, 128],\r\n\t\"honeydew\": [240, 255, 240],\r\n\t\"hotpink\": [255, 105, 180],\r\n\t\"indianred\": [205, 92, 92],\r\n\t\"indigo\": [75, 0, 130],\r\n\t\"ivory\": [255, 255, 240],\r\n\t\"khaki\": [240, 230, 140],\r\n\t\"lavender\": [230, 230, 250],\r\n\t\"lavenderblush\": [255, 240, 245],\r\n\t\"lawngreen\": [124, 252, 0],\r\n\t\"lemonchiffon\": [255, 250, 205],\r\n\t\"lightblue\": [173, 216, 230],\r\n\t\"lightcoral\": [240, 128, 128],\r\n\t\"lightcyan\": [224, 255, 255],\r\n\t\"lightgoldenrodyellow\": [250, 250, 210],\r\n\t\"lightgray\": [211, 211, 211],\r\n\t\"lightgreen\": [144, 238, 144],\r\n\t\"lightgrey\": [211, 211, 211],\r\n\t\"lightpink\": [255, 182, 193],\r\n\t\"lightsalmon\": [255, 160, 122],\r\n\t\"lightseagreen\": [32, 178, 170],\r\n\t\"lightskyblue\": [135, 206, 250],\r\n\t\"lightslategray\": [119, 136, 153],\r\n\t\"lightslategrey\": [119, 136, 153],\r\n\t\"lightsteelblue\": [176, 196, 222],\r\n\t\"lightyellow\": [255, 255, 224],\r\n\t\"lime\": [0, 255, 0],\r\n\t\"limegreen\": [50, 205, 50],\r\n\t\"linen\": [250, 240, 230],\r\n\t\"magenta\": [255, 0, 255],\r\n\t\"maroon\": [128, 0, 0],\r\n\t\"mediumaquamarine\": [102, 205, 170],\r\n\t\"mediumblue\": [0, 0, 205],\r\n\t\"mediumorchid\": [186, 85, 211],\r\n\t\"mediumpurple\": [147, 112, 219],\r\n\t\"mediumseagreen\": [60, 179, 113],\r\n\t\"mediumslateblue\": [123, 104, 238],\r\n\t\"mediumspringgreen\": [0, 250, 154],\r\n\t\"mediumturquoise\": [72, 209, 204],\r\n\t\"mediumvioletred\": [199, 21, 133],\r\n\t\"midnightblue\": [25, 25, 112],\r\n\t\"mintcream\": [245, 255, 250],\r\n\t\"mistyrose\": [255, 228, 225],\r\n\t\"moccasin\": [255, 228, 181],\r\n\t\"navajowhite\": [255, 222, 173],\r\n\t\"navy\": [0, 0, 128],\r\n\t\"oldlace\": [253, 245, 230],\r\n\t\"olive\": [128, 128, 0],\r\n\t\"olivedrab\": [107, 142, 35],\r\n\t\"orange\": [255, 165, 0],\r\n\t\"orangered\": [255, 69, 0],\r\n\t\"orchid\": [218, 112, 214],\r\n\t\"palegoldenrod\": [238, 232, 170],\r\n\t\"palegreen\": [152, 251, 152],\r\n\t\"paleturquoise\": [175, 238, 238],\r\n\t\"palevioletred\": [219, 112, 147],\r\n\t\"papayawhip\": [255, 239, 213],\r\n\t\"peachpuff\": [255, 218, 185],\r\n\t\"peru\": [205, 133, 63],\r\n\t\"pink\": [255, 192, 203],\r\n\t\"plum\": [221, 160, 221],\r\n\t\"powderblue\": [176, 224, 230],\r\n\t\"purple\": [128, 0, 128],\r\n\t\"rebeccapurple\": [102, 51, 153],\r\n\t\"red\": [255, 0, 0],\r\n\t\"rosybrown\": [188, 143, 143],\r\n\t\"royalblue\": [65, 105, 225],\r\n\t\"saddlebrown\": [139, 69, 19],\r\n\t\"salmon\": [250, 128, 114],\r\n\t\"sandybrown\": [244, 164, 96],\r\n\t\"seagreen\": [46, 139, 87],\r\n\t\"seashell\": [255, 245, 238],\r\n\t\"sienna\": [160, 82, 45],\r\n\t\"silver\": [192, 192, 192],\r\n\t\"skyblue\": [135, 206, 235],\r\n\t\"slateblue\": [106, 90, 205],\r\n\t\"slategray\": [112, 128, 144],\r\n\t\"slategrey\": [112, 128, 144],\r\n\t\"snow\": [255, 250, 250],\r\n\t\"springgreen\": [0, 255, 127],\r\n\t\"steelblue\": [70, 130, 180],\r\n\t\"tan\": [210, 180, 140],\r\n\t\"teal\": [0, 128, 128],\r\n\t\"thistle\": [216, 191, 216],\r\n\t\"tomato\": [255, 99, 71],\r\n\t\"turquoise\": [64, 224, 208],\r\n\t\"violet\": [238, 130, 238],\r\n\t\"wheat\": [245, 222, 179],\r\n\t\"white\": [255, 255, 255],\r\n\t\"whitesmoke\": [245, 245, 245],\r\n\t\"yellow\": [255, 255, 0],\r\n\t\"yellowgreen\": [154, 205, 50]\r\n};\r\n","export const HSLToRGB = (h, s, l) => {\r\n    s /= 100;\r\n    l /= 100;\r\n\r\n    let c = (1 - Math.abs(2 * l - 1)) * s;\r\n    let x = c * (1 - Math.abs(((h / 60) % 2) - 1));\r\n    let m = l - c / 2;\r\n    let r = 0;\r\n    let g = 0;\r\n    let b = 0;\r\n\r\n    if (0 <= h && h < 60) {\r\n        r = c;\r\n        g = x;\r\n        b = 0;\r\n    } else if (60 <= h && h < 120) {\r\n        r = x;\r\n        g = c;\r\n        b = 0;\r\n    } else if (120 <= h && h < 180) {\r\n        r = 0;\r\n        g = c;\r\n        b = x;\r\n    } else if (180 <= h && h < 240) {\r\n        r = 0;\r\n        g = x;\r\n        b = c;\r\n    } else if (240 <= h && h < 300) {\r\n        r = x;\r\n        g = 0;\r\n        b = c;\r\n    } else if (300 <= h && h < 360) {\r\n        r = c;\r\n        g = 0;\r\n        b = x;\r\n    }\r\n\r\n    return [\r\n        Math.round((r + m) * 255),\r\n        Math.round((g + m) * 255),\r\n        Math.round((b + m) * 255),\r\n    ];\r\n};\r\n\r\nexport const lerpHSL = (a, b, t) => {\r\n    const deg = Math.trunc(lerp(a[0], b[0], t));\r\n    const sat = Math.trunc(lerp(a[1], b[1], t));\r\n    const light = Math.trunc(lerp(a[2], b[2], t));\r\n\r\n    return HSLToRGB(deg, sat, light);\r\n};\r\n\r\nexport const isWhite = (r, g, b) => r === 255 && g === 255 && b === 255;\r\nexport const isBlack = (r, g, b) => r === 0 && g === 0 && b === 0;\r\n","import InputKeyboardEvent from './events/InputKeyboardEvent';\nimport InputMouseEvent from './events/InputMouseEvent';\nimport Manager from '../Manager';\n\nexport default class InputController extends Manager {\n    constructor(game) {\n        super(game);\n        document.addEventListener('keydown', this.onKeydown.bind(this));\n\n        const container = this.game.renderer.canvas;\n\n        container.addEventListener('click', this.onMouseClick.bind(this));\n        container.addEventListener('mousemove', this.onMouseMove.bind(this));\n        container.addEventListener('mouseenter', this.onMouseEnter.bind(this));\n        container.addEventListener('mouseleave', this.onMouseLeave.bind(this));\n    }\n\n    onKeydown(e) {\n        const evt = new InputKeyboardEvent({\n            key: e.keyCode,\n            shift: e.shiftKey,\n            ctrl: e.ctrlKey,\n            alt: e.altKey,\n            meta: e.metaKey,\n        });\n\n        e.preventDefault();\n\n        this.game.commands.onInputEvent(evt);\n    }\n\n    onMouseClick(e) {\n        const xPx = e.offsetX;\n        const yPx = e.offsetY;\n        const { x, y } = this.game.renderer.pxToTile(xPx, yPx);\n\n        const evt = new InputMouseEvent({\n            key: e.button,\n            x,\n            y,\n            shift: e.shiftKey,\n            ctrl: e.ctrlKey,\n            alt: e.altKey,\n            meta: e.metaKey,\n            xPx,\n            yPx,\n        });\n\n        this.game.commands.onInputEvent(evt);\n    }\n\n    onMouseMove(e) {\n        const xPx = e.offsetX;\n        const yPx = e.offsetY;\n        const { x, y } = this.game.renderer.pxToTile(xPx, yPx);\n\n        this.game.mouse.updatePosition(x, y);\n    }\n\n    onMouseEnter(e) {\n        this.game.mouse.updateMouseEnter();\n    }\n\n    onMouseLeave(e) {\n        this.game.mouse.updateMouseLeave();\n    }\n}\n","import InputEvent from './InputEvent';\n\nexport default class InputKeyboardEvent extends InputEvent {}\n","export default class InputEvent {\n    key = false;\n    shift = false;\n    ctrl = false;\n    alt = false;\n    meta = false;\n\n    constructor(data) {\n        this.key = data.key;\n        this.shift = data.shift;\n        this.ctrl = data.ctrl;\n        this.alt = data.alt;\n        this.meta = data.meta;\n    }\n}\n","import InputEvent from './InputEvent';\n\nexport default class InputMouseEvent extends InputEvent {\n    x = false;\n    y = false;\n    tileX = false;\n    tileY = false;\n\n    constructor(data) {\n        super(data);\n        this.x = data.x;\n        this.y = data.y;\n        this.tileX = data.tileX;\n        this.tileY = data.tileY;\n    }\n}\n","import { SCREEN_WAIT } from '../core/screens/ScreenType';\r\nimport { Actor, IsDead, IsDestroying } from '../ecs/components';\r\nimport System from './System';\r\n\r\nexport default class ActionSystem extends System {\r\n    #query = null;\r\n\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        this.#query = game.ecs.createQuery({\r\n            all: [Actor],\r\n            none: [IsDestroying, IsDead],\r\n        });\r\n    }\r\n\r\n    update(dt) {\r\n        const entities = this.#query.get();\r\n        const sorted = Array.from(entities);\r\n\r\n        sorted.sort((a, b) => (a.actor.energy < b.actor.energy ? 1 : -1));\r\n\r\n        let entity = sorted[0];\r\n\r\n        if (entity && !entity.actor.hasEnergy) {\r\n            this.game.clock.incrementTick(-1 * entity.actor.energy);\r\n\r\n            entities.forEach((e) => {\r\n                e.actor.addEnergy(this.game.clock.tickDelta);\r\n            });\r\n        }\r\n\r\n        while (entity && entity.actor.hasEnergy) {\r\n            if (entity.isIncapacitated) {\r\n                entity.fireEvent('energy-consumed', 100);\r\n                if (entity.isPlayer) {\r\n                    this.game.screens.pushScreen(SCREEN_WAIT, {\r\n                        time: 50,\r\n                    });\r\n                    return true;\r\n                }\r\n                continue;\r\n            }\r\n\r\n            if (entity.isPlayer) {\r\n                const action = this.game.player.getNextAction();\r\n\r\n                if (action) {\r\n                    action();\r\n                }\r\n\r\n                return true;\r\n            }\r\n\r\n            entity.fireEvent('take-action');\r\n            entity = sorted.shift();\r\n        }\r\n\r\n        return false;\r\n    }\r\n}\r\n","export const SCREEN_MAIN_MENU = 0;\r\nexport const SCREEN_ADVENTURE = 1;\r\nexport const SCREEN_DEATH = 2;\r\nexport const SCREEN_INVENTORY = 3;\r\nexport const SCREEN_INTERACT_MODAL = 4;\r\nexport const SCREEN_CURSOR = 5;\r\nexport const SCREEN_LOAD_AREA = 6;\r\nexport const SCREEN_EQUIPMENT = 7;\r\nexport const SCREEN_LIST_SELECT = 8;\r\nexport const SCREEN_CHARACTER = 9;\r\nexport const SCREEN_ABILITIES = 10;\r\nexport const SCREEN_CONFIRM = 11;\r\nexport const SCREEN_WAIT = 12;\r\nexport const SCREEN_CHANNEL = 13;\r\n","import { Component } from 'geotic';\n\nexport class Actor extends Component {\n    static properties = {\n        energy: 0,\n    };\n\n    get hasEnergy() {\n        return this.energy >= 0;\n    }\n\n    onEnergyConsumed(evt) {\n        this.reduceEnergy(evt.data);\n    }\n\n    onTick(evt) {\n        this.addEnergy(1);\n    }\n\n    addEnergy(value) {\n        this.energy += value;\n\n        if (this.energy >= 0) {\n            this.energy = 0;\n        }\n    }\n\n    reduceEnergy(value) {\n        this.addEnergy(value * -1);\n    }\n}\n","'use strict';\n\nconst preserveCamelCase = string => {\n\tlet isLastCharLower = false;\n\tlet isLastCharUpper = false;\n\tlet isLastLastCharUpper = false;\n\n\tfor (let i = 0; i < string.length; i++) {\n\t\tconst character = string[i];\n\n\t\tif (isLastCharLower && /[\\p{Lu}]/u.test(character)) {\n\t\t\tstring = string.slice(0, i) + '-' + string.slice(i);\n\t\t\tisLastCharLower = false;\n\t\t\tisLastLastCharUpper = isLastCharUpper;\n\t\t\tisLastCharUpper = true;\n\t\t\ti++;\n\t\t} else if (isLastCharUpper && isLastLastCharUpper && /[\\p{Ll}]/u.test(character)) {\n\t\t\tstring = string.slice(0, i - 1) + '-' + string.slice(i - 1);\n\t\t\tisLastLastCharUpper = isLastCharUpper;\n\t\t\tisLastCharUpper = false;\n\t\t\tisLastCharLower = true;\n\t\t} else {\n\t\t\tisLastCharLower = character.toLocaleLowerCase() === character && character.toLocaleUpperCase() !== character;\n\t\t\tisLastLastCharUpper = isLastCharUpper;\n\t\t\tisLastCharUpper = character.toLocaleUpperCase() === character && character.toLocaleLowerCase() !== character;\n\t\t}\n\t}\n\n\treturn string;\n};\n\nconst camelCase = (input, options) => {\n\tif (!(typeof input === 'string' || Array.isArray(input))) {\n\t\tthrow new TypeError('Expected the input to be `string | string[]`');\n\t}\n\n\toptions = {\n\t\t...{pascalCase: false},\n\t\t...options\n\t};\n\n\tconst postProcess = x => options.pascalCase ? x.charAt(0).toLocaleUpperCase() + x.slice(1) : x;\n\n\tif (Array.isArray(input)) {\n\t\tinput = input.map(x => x.trim())\n\t\t\t.filter(x => x.length)\n\t\t\t.join('-');\n\t} else {\n\t\tinput = input.trim();\n\t}\n\n\tif (input.length === 0) {\n\t\treturn '';\n\t}\n\n\tif (input.length === 1) {\n\t\treturn options.pascalCase ? input.toLocaleUpperCase() : input.toLocaleLowerCase();\n\t}\n\n\tconst hasUpperCase = input !== input.toLocaleLowerCase();\n\n\tif (hasUpperCase) {\n\t\tinput = preserveCamelCase(input);\n\t}\n\n\tinput = input\n\t\t.replace(/^[_.\\- ]+/, '')\n\t\t.toLocaleLowerCase()\n\t\t.replace(/[_.\\- ]+([\\p{Alpha}\\p{N}_]|$)/gu, (_, p1) => p1.toLocaleUpperCase())\n\t\t.replace(/\\d+([\\p{Alpha}\\p{N}_]|$)/gu, m => m.toLocaleUpperCase());\n\n\treturn postProcess(input);\n};\n\nmodule.exports = camelCase;\n// TODO: Remove this for the next major release\nmodule.exports.default = camelCase;\n","import camelcaseSlow from 'camelcase';\r\n\r\nconst camelCache = {};\r\n\r\nexport const camelString = (value) => {\r\n    if (!camelCache.hasOwnProperty(value)) {\r\n        camelCache[value] = camelcaseSlow(value);\r\n    }\r\n\r\n    return camelCache[value];\r\n};\r\n\r\nconst pascalCache = new Map();\r\n\r\nexport const pascalString = (value) => {\r\n    if (!pascalCache.has(value)) {\r\n        pascalCache.set(value, camelcaseSlow(value, { pascalCase: true }));\r\n    }\r\n\r\n    return pascalCache.get(value);\r\n};\r\n","export default class Property {\r\n    component;\r\n\r\n    constructor(component) {\r\n        this.component = component;\r\n    }\r\n\r\n    get ecs() {\r\n        return this.component.ecs;\r\n    }\r\n\r\n    get descriptor() {\r\n        return {\r\n            enumerable: true,\r\n            get: () => this.get(),\r\n            set: (v) => this.set(v),\r\n        };\r\n    }\r\n\r\n    get() {\r\n        return undefined;\r\n    }\r\n\r\n    set(value) {}\r\n\r\n    serialize() {\r\n        return undefined;\r\n    }\r\n\r\n    onDestroyed() {}\r\n\r\n    cleanupReference(entity) {}\r\n}\r\n","import Property from './Property';\r\n\r\nexport default class SimpleProperty extends Property {\r\n    value = null;\r\n\r\n    set(value) {\r\n        this.value = value;\r\n    }\r\n\r\n    get() {\r\n        return this.value;\r\n    }\r\n\r\n    serialize() {\r\n        return this.value;\r\n    }\r\n}\r\n","import Property from './Property';\r\n\r\nexport default class EntityProperty extends Property {\r\n    id;\r\n\r\n    set(value) {\r\n        if (this.id && (!value || value.id !== this.id || value !== this.id)) {\r\n            this.ecs.entities.removeRef(this.id, this);\r\n        }\r\n\r\n        if (value && value.id) {\r\n            this.ecs.entities.addRef(value.id, this);\r\n            this.id = value.id;\r\n            return;\r\n        }\r\n\r\n        if (typeof value === 'string') {\r\n            this.ecs.entities.addRef(value, this);\r\n            this.id = value;\r\n            return;\r\n        }\r\n\r\n        this.id = undefined;\r\n    }\r\n\r\n    get() {\r\n        return this.id && this.component.ecs.getEntity(this.id);\r\n    }\r\n\r\n    serialize() {\r\n        return this.id;\r\n    }\r\n\r\n    onDestroyed() {\r\n        if (this.id) {\r\n            this.ecs.entities.removeRef(this.id, this);\r\n        }\r\n    }\r\n\r\n    cleanupReference(entity) {\r\n        if (this.id === entity.id) {\r\n            this.id = undefined;\r\n        } else {\r\n            console.warn(\r\n                `Property in unclean state. A reference to an entity \"${entity.id}\" was never cleaned up.`,\r\n                entity\r\n            );\r\n        }\r\n    }\r\n}\r\n","import Property from './Property';\r\n\r\nexport default class EntityArrayProperty extends Property {\r\n    proxy = [];\r\n\r\n    constructor(component) {\r\n        super(component);\r\n        this.proxy = new Proxy([], {\r\n            get: (target, prop, receiver) => {\r\n                return Reflect.get(target, prop, receiver);\r\n            },\r\n            set: (target, prop, value, receiver) => {\r\n                if (isNaN(prop)) {\r\n                    return Reflect.set(target, prop, value, receiver);\r\n                }\r\n\r\n                const old = Reflect.get(target, prop, receiver);\r\n\r\n                if (typeof value === 'string') {\r\n                    value = this.ecs.entities.get(value);\r\n                }\r\n\r\n                if (old && old != value) {\r\n                    this.ecs.entities.removeRef(value, this);\r\n                }\r\n\r\n                if (value && value.id) {\r\n                    this.ecs.entities.addRef(value.id, this);\r\n\r\n                    return Reflect.set(target, prop, value, receiver);\r\n                }\r\n\r\n                return Reflect.set(target, prop, value, receiver);\r\n            },\r\n            deleteProperty: (target, prop) => {\r\n                if (isNaN(prop)) {\r\n                    return Reflect.deleteProperty(target, prop);\r\n                }\r\n\r\n                const value = Reflect.get(target, prop);\r\n                this.ecs.entities.removeRef(value, this);\r\n\r\n                return Reflect.deleteProperty(target, prop);\r\n            },\r\n        });\r\n    }\r\n\r\n    set(values = []) {\r\n        const len = Math.max(values.length, this.proxy.length);\r\n\r\n        for (let i = 0; i < len; i++) {\r\n            if (i in values) {\r\n                this.proxy[i] = values[i];\r\n            } else {\r\n                delete this.proxy[i];\r\n            }\r\n        }\r\n\r\n        this.proxy.length = values.length;\r\n    }\r\n\r\n    get() {\r\n        return this.proxy;\r\n    }\r\n\r\n    serialize() {\r\n        return this.proxy.map((ref) => ref.id);\r\n    }\r\n\r\n    onDestroyed() {\r\n        this.set([]);\r\n    }\r\n\r\n    cleanupReference(entity) {\r\n        this.set(this.proxy.filter((ref) => ref.id !== entity.id));\r\n    }\r\n}\r\n","import Property from './Property';\r\nimport SimpleProperty from './SimpleProperty';\r\nimport EntityProperty from './EntityProperty';\r\nimport EntityArrayProperty from './EntityArrayProperty';\r\n\r\nexport default class PropertyStrategy {\r\n    static create(component, value) {\r\n        switch (value) {\r\n            case '<Entity>':\r\n                return new EntityProperty(component);\r\n            case '<EntityArray>':\r\n                return new EntityArrayProperty(component);\r\n            default:\r\n                return new SimpleProperty(component);\r\n        }\r\n    }\r\n}\r\n","import { camelString } from './util/string-util';\r\nimport PropertyFactory from './Properties/PropertyFactory';\r\n\r\nexport default class Component {\r\n    entity = null;\r\n    ecs = null;\r\n    _props = {};\r\n    _isDestroyed = false;\r\n\r\n    static allowMultiple = false;\r\n    static keyProperty = null;\r\n    static properties = {};\r\n\r\n    static get type() {\r\n        return this.name;\r\n    }\r\n\r\n    get type() {\r\n        return this.constructor.name;\r\n    }\r\n\r\n    get isAttached() {\r\n        return Boolean(this.entity);\r\n    }\r\n\r\n    get isDestroyed() {\r\n        return this._isDestroyed;\r\n    }\r\n\r\n    get allowMultiple() {\r\n        return this.constructor.allowMultiple;\r\n    }\r\n\r\n    get keyProperty() {\r\n        return this.constructor.keyProperty;\r\n    }\r\n\r\n    get properties() {\r\n        const ob = {};\r\n\r\n        for (const [key, value] of Object.entries(this._props)) {\r\n            ob[key] = value.get();\r\n        }\r\n\r\n        return ob;\r\n    }\r\n\r\n    get key() {\r\n        return this[this.keyProperty];\r\n    }\r\n\r\n    constructor(ecs, properties = {}) {\r\n        this.ecs = ecs;\r\n        this._defineProxies(properties);\r\n    }\r\n\r\n    serialize() {\r\n        return Object.entries(this._props).reduce(\r\n            (o, [key, value]) => ({\r\n                ...o,\r\n                [key]: value.serialize(),\r\n            }),\r\n            {}\r\n        );\r\n    }\r\n\r\n    _onAttached(entity) {\r\n        this.entity = entity;\r\n        this.ecs.queries.onComponentAdded(entity, this);\r\n        this.onAttached();\r\n    }\r\n\r\n    _onDetached() {\r\n        if (this.isAttached) {\r\n            this.onDetached();\r\n            this.entity = null;\r\n        }\r\n    }\r\n\r\n    _onDestroyed() {\r\n        this._isDestroyed = true;\r\n        this.onDestroyed();\r\n\r\n        for (const prop of Object.values(this._props)) {\r\n            prop.onDestroyed();\r\n        }\r\n    }\r\n\r\n    onAttached() {}\r\n\r\n    onDetached() {}\r\n\r\n    onDestroyed() {}\r\n\r\n    remove(destroy = true) {\r\n        if (this.isAttached) {\r\n            this.entity.remove(this);\r\n        }\r\n        if (destroy) {\r\n            this._onDestroyed();\r\n        }\r\n    }\r\n\r\n    destroy() {\r\n        this.remove(true);\r\n    }\r\n\r\n    clone() {\r\n        return this.ecs.createComponent(this.type, this.serialize());\r\n    }\r\n\r\n    _onEvent(evt) {\r\n        this.onEvent(evt);\r\n\r\n        const handlerName = camelString(`on ${evt.name}`);\r\n\r\n        if (typeof this[handlerName] === 'function') {\r\n            this[handlerName](evt);\r\n        }\r\n    }\r\n\r\n    onEvent(evt) {}\r\n\r\n    _defaultPropertyValue(propertyName) {\r\n        const value = this.constructor.properties[propertyName];\r\n\r\n        if (value === '<EntityArray>') {\r\n            return [];\r\n        }\r\n\r\n        if (value === '<Entity>') {\r\n            return undefined;\r\n        }\r\n\r\n        return value;\r\n    }\r\n\r\n    _defineProxies(initialProperties) {\r\n        for (const key in this.constructor.properties) {\r\n            const initialValue = initialProperties.hasOwnProperty(key)\r\n                ? initialProperties[key]\r\n                : this._defaultPropertyValue(key);\r\n            const property = PropertyFactory.create(\r\n                this,\r\n                this.constructor.properties[key]\r\n            );\r\n\r\n            this._props[key] = property;\r\n            Object.defineProperty(this, key, property.descriptor);\r\n            property.set(initialValue);\r\n        }\r\n    }\r\n}\r\n","import Component from '../Component';\r\nimport { camelString } from '../util/string-util';\r\n\r\nexport default class ComponentRegistry {\r\n    _definitions = new Map();\r\n    _ecs = null;\r\n\r\n    constructor(ecs) {\r\n        this._ecs = ecs;\r\n    }\r\n\r\n    register(component) {\r\n        this._definitions.set(component.name, component);\r\n        camelString(component.name); // prime camelcase cache\r\n    }\r\n\r\n    getAccessor(type) {\r\n        return camelString(type);\r\n    }\r\n\r\n    get(typeOrClassOrComponent) {\r\n        const type = this._getType(typeOrClassOrComponent);\r\n\r\n        if (!type) {\r\n            console.warn(\r\n                `Cannot get component definition for type or class ${typeOrClassOrComponent} since it is neither a Component class or type (string)`\r\n            );\r\n            return null;\r\n        }\r\n\r\n        return this._definitions.get(type);\r\n    }\r\n\r\n    create(typeOrClass, properties = {}) {\r\n        const definition = this.get(typeOrClass);\r\n\r\n        if (definition) {\r\n            return new definition(this._ecs, properties);\r\n        }\r\n\r\n        console.warn(\r\n            `Could not create component definition for ${typeOrClass} since it is not registered`\r\n        );\r\n    }\r\n\r\n    _getType(typeOrClassOrComponent) {\r\n        if (typeof typeOrClassOrComponent === 'string') {\r\n            return typeOrClassOrComponent;\r\n        }\r\n\r\n        if (typeOrClassOrComponent instanceof Component) {\r\n            return typeOrClassOrComponent.type;\r\n        }\r\n\r\n        if (typeOrClassOrComponent.prototype instanceof Component) {\r\n            return typeOrClassOrComponent.name;\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\r\n","'use strict';\n\nvar isMergeableObject = function isMergeableObject(value) {\n\treturn isNonNullObject(value)\n\t\t&& !isSpecial(value)\n};\n\nfunction isNonNullObject(value) {\n\treturn !!value && typeof value === 'object'\n}\n\nfunction isSpecial(value) {\n\tvar stringValue = Object.prototype.toString.call(value);\n\n\treturn stringValue === '[object RegExp]'\n\t\t|| stringValue === '[object Date]'\n\t\t|| isReactElement(value)\n}\n\n// see https://github.com/facebook/react/blob/b5ac963fb791d1298e7f396236383bc955f916c1/src/isomorphic/classic/element/ReactElement.js#L21-L25\nvar canUseSymbol = typeof Symbol === 'function' && Symbol.for;\nvar REACT_ELEMENT_TYPE = canUseSymbol ? Symbol.for('react.element') : 0xeac7;\n\nfunction isReactElement(value) {\n\treturn value.$$typeof === REACT_ELEMENT_TYPE\n}\n\nfunction emptyTarget(val) {\n\treturn Array.isArray(val) ? [] : {}\n}\n\nfunction cloneUnlessOtherwiseSpecified(value, options) {\n\treturn (options.clone !== false && options.isMergeableObject(value))\n\t\t? deepmerge(emptyTarget(value), value, options)\n\t\t: value\n}\n\nfunction defaultArrayMerge(target, source, options) {\n\treturn target.concat(source).map(function(element) {\n\t\treturn cloneUnlessOtherwiseSpecified(element, options)\n\t})\n}\n\nfunction getMergeFunction(key, options) {\n\tif (!options.customMerge) {\n\t\treturn deepmerge\n\t}\n\tvar customMerge = options.customMerge(key);\n\treturn typeof customMerge === 'function' ? customMerge : deepmerge\n}\n\nfunction getEnumerableOwnPropertySymbols(target) {\n\treturn Object.getOwnPropertySymbols\n\t\t? Object.getOwnPropertySymbols(target).filter(function(symbol) {\n\t\t\treturn target.propertyIsEnumerable(symbol)\n\t\t})\n\t\t: []\n}\n\nfunction getKeys(target) {\n\treturn Object.keys(target).concat(getEnumerableOwnPropertySymbols(target))\n}\n\nfunction propertyIsOnObject(object, property) {\n\ttry {\n\t\treturn property in object\n\t} catch(_) {\n\t\treturn false\n\t}\n}\n\n// Protects from prototype poisoning and unexpected merging up the prototype chain.\nfunction propertyIsUnsafe(target, key) {\n\treturn propertyIsOnObject(target, key) // Properties are safe to merge if they don't exist in the target yet,\n\t\t&& !(Object.hasOwnProperty.call(target, key) // unsafe if they exist up the prototype chain,\n\t\t\t&& Object.propertyIsEnumerable.call(target, key)) // and also unsafe if they're nonenumerable.\n}\n\nfunction mergeObject(target, source, options) {\n\tvar destination = {};\n\tif (options.isMergeableObject(target)) {\n\t\tgetKeys(target).forEach(function(key) {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(target[key], options);\n\t\t});\n\t}\n\tgetKeys(source).forEach(function(key) {\n\t\tif (propertyIsUnsafe(target, key)) {\n\t\t\treturn\n\t\t}\n\n\t\tif (propertyIsOnObject(target, key) && options.isMergeableObject(source[key])) {\n\t\t\tdestination[key] = getMergeFunction(key, options)(target[key], source[key], options);\n\t\t} else {\n\t\t\tdestination[key] = cloneUnlessOtherwiseSpecified(source[key], options);\n\t\t}\n\t});\n\treturn destination\n}\n\nfunction deepmerge(target, source, options) {\n\toptions = options || {};\n\toptions.arrayMerge = options.arrayMerge || defaultArrayMerge;\n\toptions.isMergeableObject = options.isMergeableObject || isMergeableObject;\n\t// cloneUnlessOtherwiseSpecified is added to `options` so that custom arrayMerge()\n\t// implementations can use it. The caller may not replace it.\n\toptions.cloneUnlessOtherwiseSpecified = cloneUnlessOtherwiseSpecified;\n\n\tvar sourceIsArray = Array.isArray(source);\n\tvar targetIsArray = Array.isArray(target);\n\tvar sourceAndTargetTypesMatch = sourceIsArray === targetIsArray;\n\n\tif (!sourceAndTargetTypesMatch) {\n\t\treturn cloneUnlessOtherwiseSpecified(source, options)\n\t} else if (sourceIsArray) {\n\t\treturn options.arrayMerge(target, source, options)\n\t} else {\n\t\treturn mergeObject(target, source, options)\n\t}\n}\n\ndeepmerge.all = function deepmergeAll(array, options) {\n\tif (!Array.isArray(array)) {\n\t\tthrow new Error('first argument should be an array')\n\t}\n\n\treturn array.reduce(function(prev, next) {\n\t\treturn deepmerge(prev, next, options)\n\t}, {})\n};\n\nvar deepmerge_1 = deepmerge;\n\nmodule.exports = deepmerge_1;\n","import merge from 'deepmerge';\r\n\r\nexport default class PrefabComponent {\r\n    get type() {\r\n        return this.componentDef.type;\r\n    }\r\n\r\n    constructor(componentDef, properties = {}, overwrite = true) {\r\n        this.componentDef = componentDef;\r\n        this.properties = properties;\r\n        this.overwrite = overwrite;\r\n    }\r\n\r\n    applyToEntity(entity, initialProps = {}) {\r\n        if (!this.componentDef.allowMultiple && entity.has(this.componentDef)) {\r\n            if (this.overwrite) {\r\n                entity.remove(this.componentDef);\r\n            } else {\r\n                console.log(\r\n                    `Ignoring prefab component \"${this.type}\" since the entity \"${entity.id}\" already has one.`\r\n                );\r\n                return;\r\n            }\r\n        }\r\n\r\n        const props = merge(this.properties, initialProps);\r\n\r\n        entity.add(this.componentDef, props);\r\n    }\r\n}\r\n","export default class Prefab {\r\n    name = '';\r\n    inherit = [];\r\n    components = [];\r\n\r\n    constructor(ecs, name) {\r\n        this.ecs = ecs;\r\n        this.name = name;\r\n    }\r\n\r\n    addComponent(prefabComponent) {\r\n        this.components.push(prefabComponent);\r\n    }\r\n\r\n    applyToEntity(entity, initialProps = {}) {\r\n        this.inherit.forEach((parent) => {\r\n            parent.applyToEntity(entity, initialProps);\r\n        });\r\n\r\n        const arrComps = {};\r\n\r\n        this.components.forEach((component, i) => {\r\n            const definition = component.componentDef;\r\n            const accessor = this.ecs.components.getAccessor(definition.type);\r\n\r\n            let initialCompProps = {};\r\n\r\n            if (definition.allowMultiple) {\r\n                if (definition.keyProperty) {\r\n                    const key = component.properties[definition.keyProperty];\r\n\r\n                    if (initialProps[accessor] && initialProps[accessor][key]) {\r\n                        initialCompProps = initialProps[accessor][key];\r\n                    }\r\n                } else {\r\n                    if (!arrComps[accessor]) {\r\n                        arrComps[accessor] = 0;\r\n                    }\r\n\r\n                    if (\r\n                        initialProps[accessor] &&\r\n                        initialProps[accessor][arrComps[accessor]]\r\n                    ) {\r\n                        initialCompProps =\r\n                            initialProps[accessor][arrComps[accessor]];\r\n                    }\r\n\r\n                    arrComps[accessor]++;\r\n                }\r\n            } else {\r\n                initialCompProps = initialProps[accessor];\r\n            }\r\n\r\n            component.applyToEntity(entity, initialCompProps);\r\n        });\r\n\r\n        return entity;\r\n    }\r\n}\r\n","import Component from '../Component';\r\nimport PrefabComponent from '../PrefabComponent';\r\nimport Prefab from '../Prefab';\r\n\r\nexport default class PrefabRegistry {\r\n    _prefabs = {};\r\n    _ecs = null;\r\n\r\n    constructor(ecs) {\r\n        this._ecs = ecs;\r\n    }\r\n\r\n    deserialize(data) {\r\n        const registered = this.get(data.name);\r\n\r\n        if (registered) {\r\n            return registered;\r\n        }\r\n\r\n        const prefab = new Prefab(this._ecs, data.name);\r\n\r\n        let inherit;\r\n\r\n        if (Array.isArray(data.inherit)) {\r\n            inherit = data.inherit;\r\n        } else if (typeof data.inherit === 'string') {\r\n            inherit = [data.inherit];\r\n        } else {\r\n            inherit = [];\r\n        }\r\n\r\n        prefab.inherit = inherit.map((parent) => {\r\n            const ref = this.get(parent);\r\n\r\n            if (!ref) {\r\n                console.warn(\r\n                    `Prefab \"${data.name}\" cannot inherit from Prefab \"${parent}\" because is not registered yet! Prefabs must be registered in the right order.`\r\n                );\r\n                return parent;\r\n            }\r\n\r\n            return ref;\r\n        });\r\n\r\n        const comps = data.components || [];\r\n\r\n        for (const componentData of comps) {\r\n            if (\r\n                typeof componentData === 'string' ||\r\n                componentData.prototype instanceof Component\r\n            ) {\r\n                const def = this._ecs.components.get(componentData);\r\n                if (def) {\r\n                    prefab.addComponent(new PrefabComponent(def));\r\n                }\r\n            } else if (typeof componentData === 'object') {\r\n                const type = componentData.type;\r\n                const def = this._ecs.components.get(type);\r\n                if (def) {\r\n                    prefab.addComponent(\r\n                        new PrefabComponent(\r\n                            def,\r\n                            componentData.properties,\r\n                            componentData.overwrite\r\n                        )\r\n                    );\r\n                }\r\n            } else {\r\n                console.warn(\r\n                    `Unrecognized component reference \"${componentData}\" in prefab \"${data.name}\". Ensure the component is registered before the prefab.`\r\n                );\r\n            }\r\n        }\r\n\r\n        this.register(prefab);\r\n\r\n        return prefab;\r\n    }\r\n\r\n    register(prefab) {\r\n        this._prefabs[prefab.name] = prefab;\r\n    }\r\n\r\n    get(nameOrClassOrPrefab) {\r\n        const name = PrefabRegistry._getName(nameOrClassOrPrefab);\r\n\r\n        return this._prefabs[name];\r\n    }\r\n\r\n    create(nameOrClass, initialProps = {}) {\r\n        const prefab = this.get(nameOrClass);\r\n\r\n        if (!prefab) {\r\n            console.warn(\r\n                `Could not instantiate prefab for ${nameOrClass} since it is not registered`\r\n            );\r\n\r\n            return;\r\n        }\r\n\r\n        const entity = this._ecs.createEntity();\r\n        prefab.applyToEntity(entity, initialProps);\r\n\r\n        return entity;\r\n    }\r\n\r\n    static _getName(nameOrClassOrPrefab) {\r\n        if (typeof nameOrClassOrPrefab === 'string') {\r\n            return nameOrClassOrPrefab;\r\n        }\r\n\r\n        if (nameOrClassOrPrefab instanceof Prefab) {\r\n            return nameOrClassOrPrefab.name;\r\n        }\r\n\r\n        if (nameOrClassOrPrefab.prototype instanceof Prefab) {\r\n            return nameOrClassOrPrefab.name;\r\n        }\r\n\r\n        return null;\r\n    }\r\n}\r\n","export default class EntityEvent {\r\n    data = {};\r\n    _prevented = false;\r\n    _handled = false;\r\n\r\n    get prevented() {\r\n        return this._prevented;\r\n    }\r\n\r\n    get handled() {\r\n        return this._handled;\r\n    }\r\n\r\n    constructor(name, data = {}) {\r\n        this.name = name;\r\n        this.data = data;\r\n    }\r\n\r\n    is(name) {\r\n        return this.name === name;\r\n    }\r\n\r\n    handle() {\r\n        this._handled = true;\r\n        this._prevented = true;\r\n    }\r\n\r\n    prevent() {\r\n        this._prevented = true;\r\n    }\r\n}\r\n","import Component from './Component';\r\nimport EntityEvent from './EntityEvent';\r\n\r\nexport default class Entity {\r\n    id = null;\r\n    components = {};\r\n    ecs = null;\r\n    _isDestroyed = false;\r\n\r\n    get isDestroyed() {\r\n        return this._isDestroyed;\r\n    }\r\n\r\n    constructor(ecs, id = null) {\r\n        this.ecs = ecs;\r\n        this.id = id || ecs.generateId();\r\n    }\r\n\r\n    has(typeOrClass, key = null) {\r\n        const type = this.ecs.components._getType(typeOrClass);\r\n        const accessor = this.ecs.components.getAccessor(type);\r\n        const hasType = this.hasOwnProperty(accessor);\r\n\r\n        if (hasType && key) {\r\n            return this[accessor].hasOwnProperty(key);\r\n        }\r\n\r\n        return hasType;\r\n    }\r\n\r\n    get(typeOrClass, key = null) {\r\n        const type = this.ecs.components._getType(typeOrClass);\r\n        const accessor = this.ecs.components.getAccessor(type);\r\n        const components = this[accessor];\r\n\r\n        if (components && key) {\r\n            return components[key];\r\n        }\r\n\r\n        return components;\r\n    }\r\n\r\n    destroy() {\r\n        this._isDestroyed = true;\r\n\r\n        for (const component of Object.values(this.components)) {\r\n            if (component instanceof Component) {\r\n                component.destroy();\r\n            } else {\r\n                for (const nestedComponent of Object.values(component)) {\r\n                    nestedComponent.destroy();\r\n                }\r\n            }\r\n        }\r\n\r\n        this.ecs.entities.onEntityDestroyed(this);\r\n    }\r\n\r\n    add(typeOrClass, properties = {}) {\r\n        if (typeOrClass instanceof Component) {\r\n            if (typeOrClass.isAttached) {\r\n                console.warn(\r\n                    `\"${typeOrClass.type}\" component cannot be added, since it is already attached to an entity.`\r\n                );\r\n                return false;\r\n            }\r\n\r\n            return this.attach(typeOrClass);\r\n        }\r\n\r\n        const component = this.ecs.components.create(typeOrClass, properties);\r\n\r\n        if (!component) {\r\n            console.warn(\r\n                `\"${typeOrClass}\" component cannot be added, since it is not registered.`\r\n            );\r\n            return false;\r\n        }\r\n\r\n        return this.attach(component);\r\n    }\r\n\r\n    attach(component) {\r\n        const accessor = this.ecs.components.getAccessor(component.type);\r\n\r\n        if (!component.allowMultiple) {\r\n            if (this.has(component.type)) {\r\n                console.warn(\r\n                    `\"${component.type}\" component has allowMultiple set to ${component.allowMultiple}. Trying to add a \"${component.type}\" component to an entity which already has one.`\r\n                );\r\n                return false;\r\n            }\r\n\r\n            this.components[accessor] = component;\r\n\r\n            Object.defineProperty(this, accessor, {\r\n                enumerable: true,\r\n                configurable: true,\r\n                writable: false,\r\n                value: this.components[accessor],\r\n            });\r\n\r\n            component._onAttached(this);\r\n\r\n            return true;\r\n        }\r\n\r\n        if (!component.keyProperty) {\r\n            if (!this.components[accessor]) {\r\n                this.components[accessor] = [];\r\n                Object.defineProperty(this, accessor, {\r\n                    configurable: true,\r\n                    enumerable: true,\r\n                    writable: false,\r\n                    value: this.components[accessor],\r\n                });\r\n            }\r\n\r\n            this.components[accessor].push(component);\r\n\r\n            component._onAttached(this);\r\n\r\n            return true;\r\n        }\r\n\r\n        if (!component.key) {\r\n            console.warn(\r\n                `\"${component.type}\" component has a falsy key of \"${component.key}\". The keyProperty is set to \"${component.keyProperty}\".`\r\n            );\r\n            return false;\r\n        }\r\n\r\n        if (!this.components[accessor]) {\r\n            this.components[accessor] = {};\r\n            Object.defineProperty(this, accessor, {\r\n                configurable: true,\r\n                enumerable: true,\r\n                writable: false,\r\n                value: this.components[accessor],\r\n            });\r\n        }\r\n\r\n        this.components[accessor][component.key] = component;\r\n\r\n        component._onAttached(this);\r\n\r\n        return true;\r\n    }\r\n\r\n    owns(component) {\r\n        return component.entity === this;\r\n    }\r\n\r\n    remove(typeOrClassOrComponent, key = null) {\r\n        const isComponent = typeOrClassOrComponent instanceof Component;\r\n        key = isComponent ? typeOrClassOrComponent.key : key;\r\n\r\n        const definition = this.ecs.components.get(typeOrClassOrComponent);\r\n\r\n        const accessor = this.ecs.components.getAccessor(definition.type);\r\n\r\n        if (definition.allowMultiple) {\r\n            if (!definition.keyProperty) {\r\n                if (isComponent) {\r\n                    const all = this.components[accessor];\r\n\r\n                    if (!all) {\r\n                        console.warn(\r\n                            `Trying to remove a \"${definition.type}\" component from an entity, but it wasn't found.`\r\n                        );\r\n                        return;\r\n                    }\r\n\r\n                    const index = all.indexOf(typeOrClassOrComponent);\r\n\r\n                    if (index > -1) {\r\n                        all.splice(index, 1);\r\n                        typeOrClassOrComponent._onDetached();\r\n\r\n                        if (all.length === 0) {\r\n                            delete this[accessor];\r\n                            delete this.components[accessor];\r\n                        }\r\n\r\n                        this.ecs.queries.onComponentRemoved(this);\r\n\r\n                        return true;\r\n                    }\r\n                } else {\r\n                    for (const instance of this.components[accessor]) {\r\n                        instance._onDetached();\r\n                    }\r\n\r\n                    delete this[accessor];\r\n                    delete this.components[accessor];\r\n                    this.ecs.queries.onComponentRemoved(this);\r\n\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            if (!key) {\r\n                console.warn(\r\n                    `Trying to remove a \"${definition.type}\" component which allows multiple without specifying an key.`\r\n                );\r\n                return;\r\n            }\r\n\r\n            const all = this.components[accessor];\r\n            const component = all[key];\r\n\r\n            if (component) {\r\n                delete all[key];\r\n                component._onDetached();\r\n                if (Object.keys(all).length <= 0) {\r\n                    delete this[accessor];\r\n                    delete this.components[accessor];\r\n                }\r\n                this.ecs.queries.onComponentRemoved(this);\r\n\r\n                return component;\r\n            } else {\r\n                console.warn(\r\n                    `Trying to remove a \"${definition.type}\" component from an entity at \"${key}\", but it wasn't found.`\r\n                );\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (accessor in this) {\r\n            const component = this.components[accessor];\r\n\r\n            delete this[accessor];\r\n            delete this.components[accessor];\r\n            component._onDetached();\r\n            this.ecs.queries.onComponentRemoved(this);\r\n\r\n            return component;\r\n        }\r\n\r\n        console.warn(\r\n            `Trying to remove a \"${definition.type}\" component from an entity, but it wasn't found.`\r\n        );\r\n    }\r\n\r\n    serialize() {\r\n        return Object.entries(this.components).reduce(\r\n            (o, [key, value]) => {\r\n                if (value instanceof Component) {\r\n                    return {\r\n                        ...o,\r\n                        [key]: value.serialize(),\r\n                    };\r\n                }\r\n\r\n                if (Array.isArray(value)) {\r\n                    return {\r\n                        ...o,\r\n                        [key]: value.map((v) => v.serialize()),\r\n                    };\r\n                }\r\n\r\n                return {\r\n                    ...o,\r\n                    [key]: Object.entries(value).reduce(\r\n                        (o2, [k2, v2]) => ({\r\n                            ...o2,\r\n                            [k2]: v2.serialize(),\r\n                        }),\r\n                        {}\r\n                    ),\r\n                };\r\n            },\r\n            {\r\n                id: this.id,\r\n            }\r\n        );\r\n    }\r\n\r\n    fireEvent(name, data) {\r\n        const evt = new EntityEvent(name, data);\r\n\r\n        for (const component of Object.values(this.components)) {\r\n            if (component instanceof Component) {\r\n                component._onEvent(evt);\r\n\r\n                if (evt.prevented) {\r\n                    return evt;\r\n                }\r\n            } else {\r\n                for (const nestedComponent of Object.values(component)) {\r\n                    nestedComponent._onEvent(evt);\r\n\r\n                    if (evt.prevented) {\r\n                        return evt;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        return evt;\r\n    }\r\n}\r\n","import { pascalString } from '../util/string-util';\r\nimport Entity from '../Entity';\r\n\r\nexport default class EntityRegistry {\r\n    _entities = new Map();\r\n    _ecs = null;\r\n    _refs = new Map();\r\n\r\n    constructor(ecs) {\r\n        this._ecs = ecs;\r\n    }\r\n\r\n    get all() {\r\n        return this._entities.values();\r\n    }\r\n\r\n    register(entity) {\r\n        this._entities.set(entity.id, entity);\r\n\r\n        return entity;\r\n    }\r\n\r\n    get(id) {\r\n        return this._entities.get(id);\r\n    }\r\n\r\n    createOrGetById(id) {\r\n        const entity = this.get(id);\r\n\r\n        if (entity) {\r\n            return entity;\r\n        }\r\n\r\n        return this.create(id);\r\n    }\r\n\r\n    create(id = undefined) {\r\n        const entity = new Entity(this._ecs, id);\r\n\r\n        this.register(entity);\r\n\r\n        this._ecs.queries.onEntityCreated(entity);\r\n\r\n        return entity;\r\n    }\r\n\r\n    destroy(entity) {\r\n        entity.destroy();\r\n    }\r\n\r\n    onEntityDestroyed(entity) {\r\n        this.cleanupRefs(entity);\r\n        this._entities.delete(entity.id);\r\n        this._ecs.queries.onEntityDestroyed(entity);\r\n    }\r\n\r\n    cleanupRefs(entity) {\r\n        const refs = this._refs.get(entity.id);\r\n\r\n        if (!refs) {\r\n            return;\r\n        }\r\n\r\n        for (const ref of refs) {\r\n            ref.cleanupReference(entity);\r\n        }\r\n\r\n        delete this._refs[entity.id];\r\n    }\r\n\r\n    addRef(entityId, property) {\r\n        if (!this._refs.has(entityId)) {\r\n            this._refs.set(entityId, new Set([property]));\r\n            return;\r\n        }\r\n\r\n        this._refs.get(entityId).add(property);\r\n    }\r\n\r\n    removeRef(entityId, property) {\r\n        if (this._refs.has(entityId)) {\r\n            this._refs.get(entityId).delete(property);\r\n        }\r\n    }\r\n\r\n    serialize(entities) {\r\n        const json = [];\r\n        const list = entities ? entities : this._entities;\r\n\r\n        list.forEach((entity) => {\r\n            json.push(entity.serialize());\r\n        });\r\n\r\n        return json;\r\n    }\r\n\r\n    deserialize(data) {\r\n        for (const entityData of data.entities) {\r\n            this.createOrGetById(entityData.id);\r\n        }\r\n\r\n        for (const entityData of data.entities) {\r\n            this.deserializeEntity(entityData);\r\n        }\r\n    }\r\n\r\n    deserializeEntity(data) {\r\n        const { id, ...componentData } = data;\r\n        const entity = this.createOrGetById(id);\r\n\r\n        Object.entries(componentData).forEach(([key, value]) => {\r\n            const type = pascalString(key);\r\n            const definition = this._ecs.components.get(type);\r\n\r\n            if (definition.allowMultiple) {\r\n                Object.values(value).forEach((d) => {\r\n                    entity.add(definition, d);\r\n                });\r\n            } else {\r\n                entity.add(definition, value);\r\n            }\r\n        });\r\n    }\r\n}\r\n","import merge from 'deepmerge';\r\n\r\nexport default class Query {\r\n    _ecs;\r\n    _filter;\r\n    _onEntityAddedCallbacks = [];\r\n    _onEntityRemovedCallbacks = [];\r\n    _cache = new Set();\r\n\r\n    constructor(ecs, filter = {}) {\r\n        this._ecs = ecs;\r\n        this._filter = merge({ any: [], all: [], none: [] }, filter);\r\n        this.bustCache();\r\n    }\r\n\r\n    isMatch(entity) {\r\n        const hasAny = this._filter.any.length\r\n            ? this._filter.any.some((c) => entity.has(c))\r\n            : true;\r\n        const hasAll = this._filter.all.every((c) => entity.has(c));\r\n        const hasNone = !this._filter.none.some((c) => entity.has(c));\r\n\r\n        return hasAny && hasAll && hasNone;\r\n    }\r\n\r\n    onEntityAdded(fn) {\r\n        this._onEntityAddedCallbacks.push(fn);\r\n    }\r\n\r\n    onEntityRemoved(fn) {\r\n        this._onEntityRemovedCallbacks.push(fn);\r\n    }\r\n\r\n    has(entity) {\r\n        return this._cache.has(entity);\r\n    }\r\n\r\n    candidate(entity) {\r\n        const isTracking = this.has(entity);\r\n\r\n        if (this.isMatch(entity)) {\r\n            if (!isTracking) {\r\n                this._cache.add(entity);\r\n                this._onEntityAddedCallbacks.forEach((cb) => cb(entity));\r\n            }\r\n\r\n            return true;\r\n        }\r\n\r\n        if (isTracking) {\r\n            this._cache.delete(entity);\r\n            this._onEntityRemovedCallbacks.forEach((cb) => cb(entity));\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    _onEntityCreated(entity) {\r\n        this.candidate(entity);\r\n    }\r\n\r\n    _onComponentAdded(entity) {\r\n        this.candidate(entity);\r\n    }\r\n\r\n    _onComponentRemoved(entity) {\r\n        this.candidate(entity);\r\n    }\r\n\r\n    _onEntityDestroyed(entity) {\r\n        if (this.has(entity)) {\r\n            this._cache.delete(entity);\r\n            this._onEntityRemovedCallbacks.forEach((cb) => cb(entity));\r\n        }\r\n    }\r\n\r\n    bustCache() {\r\n        this._cache.clear();\r\n\r\n        for (const entity of this._ecs.entities.all) {\r\n            this.candidate(entity);\r\n        }\r\n\r\n        return this._cache;\r\n    }\r\n\r\n    get() {\r\n        return this._cache;\r\n    }\r\n}\r\n","import Query from '../Query';\r\n\r\nexport default class QueryRegistry {\r\n    _ecs;\r\n    _queries = [];\r\n\r\n    constructor(ecs) {\r\n        this._ecs = ecs;\r\n    }\r\n\r\n    create(filters) {\r\n        const query = new Query(this._ecs, filters);\r\n\r\n        this._queries.push(query);\r\n\r\n        return query;\r\n    }\r\n\r\n    onComponentAdded(entity) {\r\n        this._queries.forEach((query) => query._onComponentAdded(entity));\r\n    }\r\n\r\n    onComponentRemoved(entity) {\r\n        this._queries.forEach((query) => query._onComponentRemoved(entity));\r\n    }\r\n\r\n    onEntityCreated(entity) {\r\n        this._queries.forEach((query) => query._onEntityCreated(entity));\r\n    }\r\n\r\n    onEntityDestroyed(entity) {\r\n        this._queries.forEach((query) => query._onEntityDestroyed(entity));\r\n    }\r\n}\r\n","import ComponentRegistry from './registries/ComponentRegistry';\r\nimport PrefabRegistry from './registries/PrefabRegistry';\r\nimport { nanoid } from 'nanoid/non-secure';\r\nimport EntityRegistry from './registries/EntityRegistry';\r\nimport QueryRegistry from './registries/QueryRegistry';\r\n\r\nexport default class Engine {\r\n    constructor() {\r\n        this.idGenerator = () => nanoid();\r\n        this.components = new ComponentRegistry(this);\r\n        this.prefabs = new PrefabRegistry(this);\r\n        this.entities = new EntityRegistry(this);\r\n        this.queries = new QueryRegistry(this);\r\n    }\r\n\r\n    generateId() {\r\n        return this.idGenerator();\r\n    }\r\n\r\n    createEntity(id) {\r\n        return this.entities.create(id);\r\n    }\r\n\r\n    createPrefab(nameOrClass, initialProps = {}) {\r\n        return this.prefabs.create(nameOrClass, initialProps);\r\n    }\r\n\r\n    destroyEntity(entity) {\r\n        return this.entities.destroy(entity);\r\n    }\r\n\r\n    registerPrefab(data) {\r\n        this.prefabs.deserialize(data);\r\n    }\r\n\r\n    registerComponent(component) {\r\n        this.components.register(component);\r\n    }\r\n\r\n    getEntity(id) {\r\n        return this.entities.get(id);\r\n    }\r\n\r\n    createComponent(type, properties) {\r\n        return this.components.create(type, properties);\r\n    }\r\n\r\n    createQuery(filters) {\r\n        return this.queries.create(filters);\r\n    }\r\n\r\n    serialize(entities) {\r\n        return {\r\n            entities: this.entities.serialize(entities),\r\n        };\r\n    }\r\n\r\n    deserialize(data) {\r\n        if (data.id) {\r\n            return this.entities.deserializeEntity(data);\r\n        }\r\n\r\n        return this.entities.deserialize(data);\r\n    }\r\n}\r\n","// This alphabet uses `A-Za-z0-9_-` symbols. The genetic algorithm helped\n// optimize the gzip compression for this alphabet.\nlet urlAlphabet =\n  'ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW'\n\nlet customAlphabet = (alphabet, size) => {\n  return () => {\n    let id = ''\n    // A compact alternative for `for (var i = 0; i < step; i++)`.\n    let i = size\n    while (i--) {\n      // `| 0` is more compact and faster than `Math.floor()`.\n      id += alphabet[Math.random() * alphabet.length | 0]\n    }\n    return id\n  }\n}\n\nlet nanoid = (size = 21) => {\n  let id = ''\n  // A compact alternative for `for (var i = 0; i < step; i++)`.\n  let i = size\n  while (i--) {\n    // `| 0` is more compact and faster than `Math.floor()`.\n    id += urlAlphabet[Math.random() * 64 | 0]\n  }\n  return id\n}\n\nexport { nanoid, customAlphabet }\n","import { Component } from 'geotic';\n\nexport class IsDestroying extends Component {\n    static properties = {\n        pass: 0,\n    };\n}\n","import { Component } from 'geotic';\r\nimport { SPWN_POOL_LIQUID } from '../../data/Spawnables';\r\nimport { spawn } from '../../data/Spawner';\r\nimport { drinkLiquid, liquids, LIQUID_BLOOD } from '../../enums/LiquidTypes';\r\nimport { IsDestroying } from './IsDestroying';\r\n\r\nexport class LiquidContainer extends Component {\r\n    static properties = {\r\n        content: LIQUID_BLOOD,\r\n        volume: 10,\r\n        maxVolume: 10,\r\n        overridePrimary: false,\r\n        overrideSecondary: false,\r\n        isPourable: false,\r\n        destroyOnEmpty: false,\r\n        isFreeFlowing: false,\r\n    };\r\n\r\n    get liquid() {\r\n        return !this.isEmpty && liquids[this.content];\r\n    }\r\n\r\n    get isEmpty() {\r\n        return isNaN(this.content) || this.volume <= 0;\r\n    }\r\n\r\n    get display() {\r\n        if (this.isEmpty) {\r\n            return `[empty] ${this.volume}/${this.maxVolume}`;\r\n        }\r\n\r\n        return `[${liquids[this.content].name}] ${this.volume}/${\r\n            this.maxVolume\r\n        }`;\r\n    }\r\n\r\n    get primaryColorOverride() {\r\n        if (this.overridePrimary && this.liquid) {\r\n            return this.liquid.primary;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    get secondaryColorOverride() {\r\n        if (this.overrideSecondary && this.liquid) {\r\n            return this.liquid.secondary;\r\n        }\r\n\r\n        return null;\r\n    }\r\n\r\n    _checkDestroyOnEmpty() {\r\n        if (this.destroyOnEmpty && this.isEmpty && !this.entity.isDestroying) {\r\n            this.entity.add(IsDestroying);\r\n        }\r\n    }\r\n\r\n    pour(x, y, quantity) {\r\n        if (!this.isPourable) {\r\n            console.warn('The container connot be poured.');\r\n            return false;\r\n        }\r\n\r\n        if (this.volume <= 0) {\r\n            console.warn('The contianer is empty and cannot be poured.');\r\n            return false;\r\n        }\r\n\r\n        if (isNaN(quantity) || quantity >= this.volume) {\r\n            quantity = this.volume;\r\n        }\r\n\r\n        this.volume -= quantity;\r\n\r\n        spawn(SPWN_POOL_LIQUID, x, y, {\r\n            content: this.content,\r\n            volume: quantity,\r\n        });\r\n\r\n        this._checkDestroyOnEmpty();\r\n\r\n        return true;\r\n    }\r\n\r\n    combineFrom(other) {\r\n        if (this.content !== other.content) {\r\n            console.warn('Cannot combine different liquid types');\r\n\r\n            return false;\r\n        }\r\n\r\n        const sum = this.volume + other.volume;\r\n\r\n        if (sum > this.maxVolume) {\r\n            console.warn(\r\n                'Container is not large enought to combine both liquids'\r\n            );\r\n            this.volume = this.maxVolume;\r\n\r\n            other.volume -= sum - this.maxVolume;\r\n        } else {\r\n            this.volume += other.volume;\r\n\r\n            other.volume -= other.volume;\r\n        }\r\n\r\n        other._checkDestroyOnEmpty();\r\n\r\n        return true;\r\n    }\r\n\r\n    onTryPour(evt) {\r\n        if (this.isEmpty) {\r\n            console.warn('The container is empty.');\r\n            return;\r\n        }\r\n\r\n        const pos = evt.data.interactor.position.getPos();\r\n\r\n        this.pour(pos.x, pos.y, evt.data.volume);\r\n\r\n        evt.data.interactor.fireEvent('energy-consumed', 400);\r\n        evt.handle();\r\n    }\r\n\r\n    onTryDrink(evt) {\r\n        if (this.isEmpty) {\r\n            console.warn('The container is empty.');\r\n            return;\r\n        }\r\n\r\n        drinkLiquid(evt.data.interactor, this.content, this.volume);\r\n        this.volume = 0;\r\n        this._checkDestroyOnEmpty();\r\n\r\n        evt.data.interactor.fireEvent('energy-consumed', 700);\r\n        evt.handle();\r\n    }\r\n\r\n    onGetInteractions(evt) {\r\n        if (this.isEmpty) {\r\n            return;\r\n        }\r\n\r\n        evt.data.interactions.push({\r\n            name: 'Drink',\r\n            evt: 'try-drink',\r\n        });\r\n\r\n        if (this.isPourable) {\r\n            evt.data.interactions.push({\r\n                name: 'Pour',\r\n                evt: 'try-pour',\r\n            });\r\n        }\r\n    }\r\n}\r\n","export const SPWN_VIAL_HONEY = 'SPWN_VIAL_HONEY';\r\nexport const SPWN_VIAL_BLOOD = 'SPWN_VIAL_BLOOD';\r\nexport const SPWN_VIAL_WATER = 'SPWN_VIAL_WATER';\r\nexport const SPWN_STONE = 'SPWN_STONE';\r\nexport const SPWN_TWIG = 'SPWN_TWIG';\r\nexport const SPWN_ASH = 'SPWN_ASH';\r\nexport const SPWN_GOBLIN_GRUNT = 'SPWN_GOBLIN_GRUNT';\r\nexport const SPWN_GOBLIN_BRUISER = 'SPWN_GOBLIN_BRUISER';\r\nexport const SPWN_GOBLIN_STARGAZER = 'SPWN_GOBLIN_STARGAZER';\r\nexport const SPWN_HUMAN_WANDERER = 'SPWN_HUMAN_WANDERER';\r\nexport const SPWN_PINE_TREE = 'SPWN_PINE_TREE';\r\nexport const SPWN_CLIFF = 'SPWN_CLIFF';\r\nexport const SPWN_WOOD_WALL = 'SPWN_WOOD_WALL';\r\nexport const SPWN_WOOD_DOOR = 'SPWN_WOOD_DOOR';\r\nexport const SPWN_WOOD_CHEST = 'SPWN_WOOD_CHEST';\r\nexport const SPWN_STONE_WALL = 'SPWN_STONE_WALL';\r\nexport const SPWN_DIRT_PATH = 'SPWN_DIRT_PATH';\r\nexport const SPWN_CORPSE = 'SPWN_CORPSE';\r\nexport const SPWN_POOL_LIQUID = 'SPWN_POOL_LIQUID';\r\nexport const SPWN_GLASS_SHARD = 'SPWN_GLASS_SHARD';\r\nexport const SPWN_HEALTH_SHARD = 'SPWN_HEALTH_SHARD';\r\nexport const SPWN_AMULET = 'SPWN_AMULET';\r\nexport const SPWN_CLOTH_ARMOR = 'SPWN_CLOTH_ARMOR';\r\nexport const SPWN_LEATHER_BOOTS = 'SPWN_LEATHER_BOOTS';\r\nexport const SPWN_SHORTSWORD = 'SPWN_SHORTSWORD';\r\nexport const SPWN_GREATSWORD = 'SPWN_GREATSWORD';\r\nexport const SPWN_BATTLE_AXE = 'SPWN_BATTLE_AXE';\r\nexport const SPWN_HATCHET = 'SPWN_HATCHET';\r\nexport const SPWN_MACE = 'SPWN_MACE';\r\nexport const SPWN_WOOD_CLUB = 'SPWN_WOOD_CLUB';\r\nexport const SPWN_GROUND_SAND = 'SPWN_GROUND_SAND';\r\nexport const SPWN_GROUND_GRASS = 'SPWN_GROUND_GRASS';\r\nexport const SPWN_GROUND_GRASS_DEAD = 'SPWN_GROUND_GRASS_DEAD';\r\nexport const SPWN_GROUND_STONE = 'SPWN_GROUND_STONE';\r\nexport const SPWN_HEAVY_PLATE_ARMOR = 'SPWN_HEAVY_PLATE_ARMOR';\r\nexport const SPWN_LEATHER_ARMOR = 'SPWN_LEATHER_ARMOR';\r\nexport const SPWN_CLOTH_HOOD = 'SPWN_CLOTH_HOOD';\r\nexport const SPWN_WIZARD_CAP = 'SPWN_WIZARD_CAP';\r\nexport const SPWN_HELM = 'SPWN_HELM';\r\nexport const SPWN_SNAKE = 'SPWN_SNAKE';\r\nexport const SPWN_BEAR = 'SPWN_BEAR';\r\nexport const SPWN_DESERT_REED = 'SPWN_DESERT_REED';\r\n","import { game } from '../core/Game';\r\n\r\nimport * as VialHoney from './spawnables/SpawnableVialHoney';\r\nimport * as VialBlood from './spawnables/SpawnableVialBlood';\r\nimport * as VialWater from './spawnables/SpawnableVialWater';\r\nimport * as GoblinGrunt from './spawnables/SpawnableGoblinGrunt';\r\nimport * as GoblinBruiser from './spawnables/SpawnableGoblinBruiser';\r\nimport * as GoblinStargazer from './spawnables/SpawnableGoblinStargazer';\r\nimport * as PineTree from './spawnables/SpawnablePineTree';\r\nimport * as HumanWanderer from './spawnables/SpawnableHumanWanderer';\r\nimport * as PoolLiquid from './spawnables/SpawnablePoolLiquid';\r\nimport * as Grass from './spawnables/SpawnableGrass';\r\nimport * as DeadGrass from './spawnables/SpawnableDeadGrass';\r\nimport * as Sand from './spawnables/SpawnableSand';\r\nimport * as Cliff from './spawnables/SpawnableCliff';\r\nimport * as Snake from './spawnables/SpawnableSnake';\r\nimport * as Bear from './spawnables/SpawnableBear';\r\n\r\nconst simplePrefab = (prefabName) => (data) =>\r\n    game.ecs.createPrefab(prefabName, data);\r\n\r\nconst spawnables = {\r\n    SPWN_VIAL_HONEY: VialHoney.createSpawnable,\r\n    SPWN_VIAL_BLOOD: VialBlood.createSpawnable,\r\n    SPWN_VIAL_WATER: VialWater.createSpawnable,\r\n    SPWN_STONE: simplePrefab('Stone'),\r\n    SPWN_WOOD_WALL: simplePrefab('WoodWall'),\r\n    SPWN_WOOD_DOOR: simplePrefab('Door'),\r\n    SPWN_WOOD_CHEST: simplePrefab('Chest'),\r\n    SPWN_STONE_WALL: simplePrefab('Wall'),\r\n    SPWN_DIRT_PATH: simplePrefab('DirtPathway'),\r\n    SPWN_CORPSE: simplePrefab('Corpse'),\r\n    SPWN_GLASS_SHARD: simplePrefab('GlassShard'),\r\n    SPWN_HEALTH_SHARD: simplePrefab('HealthShard'),\r\n    SPWN_AMULET: simplePrefab('Amulet'),\r\n    SPWN_CLOTH_ARMOR: simplePrefab('ClothArmor'),\r\n    SPWN_HEAVY_PLATE_ARMOR: simplePrefab('PlateArmor'),\r\n    SPWN_LEATHER_ARMOR: simplePrefab('LeatherArmor'),\r\n    SPWN_LEATHER_BOOTS: simplePrefab('Boots'),\r\n    SPWN_SHORTSWORD: simplePrefab('Shortsword'),\r\n    SPWN_GREATSWORD: simplePrefab('Greatsword'),\r\n    SPWN_BATTLE_AXE: simplePrefab('BattleAxe'),\r\n    SPWN_HATCHET: simplePrefab('Hatchet'),\r\n    SPWN_MACE: simplePrefab('Mace'),\r\n    SPWN_WOOD_CLUB: simplePrefab('WoodClub'),\r\n    SPWN_GROUND_GRASS: Grass.createSpawnable,\r\n    SPWN_GROUND_GRASS_DEAD: DeadGrass.createSpawnable,\r\n    SPWN_GROUND_SAND: Sand.createSpawnable,\r\n    SPWN_GROUND_STONE: simplePrefab('StoneGround'),\r\n    SPWN_CLOTH_HOOD: simplePrefab('ClothHood'),\r\n    SPWN_WIZARD_CAP: simplePrefab('WizardCap'),\r\n    SPWN_HELM: simplePrefab('Helm'),\r\n    SPWN_TWIG: simplePrefab('Twig'),\r\n    SPWN_ASH: simplePrefab('Ash'),\r\n    SPWN_GOBLIN_GRUNT: GoblinGrunt.createSpawnable,\r\n    SPWN_GOBLIN_BRUISER: GoblinBruiser.createSpawnable,\r\n    SPWN_GOBLIN_STARGAZER: GoblinStargazer.createSpawnable,\r\n    SPWN_HUMAN_WANDERER: HumanWanderer.createSpawnable,\r\n    SPWN_SNAKE: Snake.createSpawnable,\r\n    SPWN_BEAR: Bear.createSpawnable,\r\n    SPWN_PINE_TREE: PineTree.createSpawnable,\r\n    SPWN_POOL_LIQUID: PoolLiquid.createSpawnable,\r\n    SPWN_CLIFF: Cliff.createSpawnable,\r\n    SPWN_DESERT_REED: simplePrefab('DesertReed'),\r\n};\r\n\r\nexport const spawnForChunk = (key, x, y, data = {}, chunk) => {\r\n    const entity = spawnables[key](data, x, y);\r\n\r\n    if (!isNaN(x) && !isNaN(y) && entity.position) {\r\n        entity.position.chunkId = chunk.id;\r\n        chunk.setPosition(x, y, entity.id);\r\n    }\r\n\r\n    entity.fireEvent('spawned');\r\n\r\n    return entity;\r\n}\r\n\r\nexport const spawn = (key, x, y, data = {}) => {\r\n    const entity = spawnables[key](data, x, y);\r\n\r\n    if (!isNaN(x) && !isNaN(y) && entity.position) {\r\n        entity.position.setPos(x, y);\r\n    }\r\n\r\n    entity.fireEvent('spawned');\r\n\r\n    return entity;\r\n};\r\n","import { game } from '../../core/Game';\r\nimport { LIQUID_HONEY } from '../../enums/LiquidTypes';\r\n\r\nexport const createSpawnable = () => {\r\n    const vial = game.ecs.createPrefab('Vial');\r\n\r\n    vial.liquidContainer.content = LIQUID_HONEY;\r\n\r\n    return vial;\r\n};\r\n","import { game } from '../core/Game';\r\n\r\nexport const LIQUID_WATER = 0;\r\nexport const LIQUID_BLOOD = 1;\r\nexport const LIQUID_HONEY = 3;\r\nexport const LIQUID_OIL = 4;\r\n\r\nexport const liquids = {\r\n    [LIQUID_WATER]: {\r\n        name: 'water',\r\n        colorDesc: 'watery',\r\n        primary: '#66a3dc',\r\n        secondary: '#8bb9d5',\r\n        onDrink: (entity) => {\r\n            console.log('Mmm. earth juice. yummy');\r\n        },\r\n    },\r\n    [LIQUID_BLOOD]: {\r\n        name: 'blood',\r\n        colorDesc: 'bloody',\r\n        primary: '#ce2a36',\r\n        secondary: '#e0c1c2',\r\n        onDrink: (entity, volume) => {\r\n            console.log('blood. this would make a good syrup');\r\n            entity.fireEvent('heal', {\r\n                value: volume * 1,\r\n            });\r\n        },\r\n    },\r\n    [LIQUID_HONEY]: {\r\n        name: 'honey',\r\n        colorDesc: 'gooey golden',\r\n        primary: '#d6aa3a',\r\n        secondary: '#f4d260',\r\n        onDrink: (entity, volume) => {\r\n            const pos = entity.position.getPos();\r\n\r\n            game.particles.createEmitter(\r\n                pos.x,\r\n                pos.y - 1,\r\n                {\r\n                    rate: 2,\r\n                },\r\n                {\r\n                    direction: {\r\n                        x: 0,\r\n                        y: -1,\r\n                    },\r\n                    glyphs: ['.', ''],\r\n                    fg1s: ['#d6aa3a'],\r\n                    speed: 0.02,\r\n                    lifetime: 500,\r\n                }\r\n            );\r\n\r\n            entity.fireEvent('heal', {\r\n                value: volume * 2,\r\n            });\r\n        },\r\n    },\r\n};\r\n\r\nexport const drinkLiquid = (entity, type, volume) => {\r\n    liquids[type].onDrink(entity, volume);\r\n};\r\n","import { game } from '../../core/Game';\r\nimport { LIQUID_BLOOD } from '../../enums/LiquidTypes';\r\n\r\nexport const createSpawnable = () => {\r\n    const vial = game.ecs.createPrefab('Vial');\r\n\r\n    vial.liquidContainer.content = LIQUID_BLOOD;\r\n\r\n    return vial;\r\n};\r\n","import { game } from '../../core/Game';\r\nimport { LIQUID_WATER } from '../../enums/LiquidTypes';\r\n\r\nexport const createSpawnable = () => {\r\n    const vial = game.ecs.createPrefab('Vial');\r\n\r\n    vial.liquidContainer.content = LIQUID_WATER;\r\n\r\n    return vial;\r\n};\r\n","import { BoredGoalType } from '../../ai/GoalTypes';\r\nimport { game } from '../../core/Game';\r\nimport { SPWN_SHORTSWORD } from '../Spawnables';\r\nimport { spawn } from '../Spawner';\r\n\r\nexport const createSpawnable = () => {\r\n    const goblin = game.ecs.createPrefab('Goblin');\r\n\r\n    goblin.brain.pushGoal(BoredGoalType.create());\r\n\r\n    const sword = spawn(SPWN_SHORTSWORD);\r\n\r\n    goblin.equipmentSlot.handRight.equip(sword);\r\n\r\n    return goblin;\r\n};\r\n","import { GoalType } from './GoalType';\r\nimport { SUCCESS } from '../GoalActionResult';\r\nimport { KillSomethingGoalType } from './KillSomethingGoalType';\r\n\r\nexport class BoredGoalType extends GoalType {\r\n    static name = 'Bored';\r\n\r\n    static isFinished = (entity, goal) => {\r\n        return false;\r\n    };\r\n\r\n    static takeAction = (entity, goal) => {\r\n        // do i detect any hostiles?\r\n        const targets = new Set();\r\n\r\n        entity.fireEvent('try-detect-hostiles', {\r\n            targets,\r\n        });\r\n\r\n        if (targets.size > 0) {\r\n            const target = [...targets][0];\r\n\r\n            const killGoal = KillSomethingGoalType.createAsSubGoal(goal, {\r\n                target: target.id,\r\n            });\r\n\r\n            entity.brain.pushGoal(killGoal);\r\n\r\n            entity.fireEvent('take-action');\r\n\r\n            return SUCCESS;\r\n        }\r\n\r\n        // is there anything i want to do since i'm bored?\r\n        const boredomGoal = entity.fireEvent('boredom');\r\n\r\n        if (boredomGoal.data.goal) {\r\n            entity.brain.pushGoal(boredomGoal.data.goal);\r\n            entity.fireEvent('take-action');\r\n\r\n            return SUCCESS;\r\n        }\r\n\r\n        // nothing to do, just idle\r\n        entity.fireEvent('energy-consumed', 1000);\r\n\r\n        return SUCCESS;\r\n    };\r\n}\r\n","import { FAILURE } from '../GoalActionResult';\nimport { game } from '../../core/Game';\n\nexport class GoalType {\n    static name = 'Unknown';\n\n    static isFinished(entity, goal) {\n        return false;\n    }\n\n    static takeAction(entity, goal) {\n        return FAILURE;\n    }\n\n    static createAsSubGoal(originalIntent, properties = {}) {\n        return this.create({\n            ...properties,\n            originalIntent: originalIntent.entity.id,\n        });\n    }\n\n    static create(properties = {}) {\n        return game.ecs.createPrefab('Goal', {\n            goal: {\n                name: this.name,\n                ...properties,\n            },\n        }).goal;\n    }\n}\n","export const SUCCESS = 'SUCCESS';\nexport const FAILURE = 'FAILURE';\nexport const INVALID = 'INVALID';\n","import { GoalType } from './GoalType';\r\nimport { FAILURE, SUCCESS } from '../GoalActionResult';\r\nimport { computeAStar } from '../../utils/AStar';\r\nimport { game } from '../../core/Game';\r\nimport { diagonalDistance } from '../../utils/diagonalDistance';\r\nimport { MoveGoalType } from './MoveGoalType';\r\n\r\nexport class KillSomethingGoalType extends GoalType {\r\n    static name = 'KillSomething';\r\n\r\n    static isFinished = (entity, goal) => {\r\n        return !goal.target || goal.target.isDead || goal.target.isDestroyed;\r\n    };\r\n\r\n    static takeAction = (entity, goal) => {\r\n        // try melee\r\n        let evt = entity.fireEvent('try-melee', {\r\n            target: goal.target,\r\n        });\r\n\r\n        if (evt.data.success) {\r\n            return SUCCESS;\r\n        }\r\n\r\n        const start = entity.position.getPos();\r\n        const targetPos = goal.target.position.getPos();\r\n\r\n        // try pathing to target\r\n        const result = computeAStar({\r\n            start,\r\n            goal: targetPos,\r\n            cost: (a, b) => {\r\n                if (game.map.isOutOfbounds(b.x, b.y)) {\r\n                    return Infinity;\r\n                }\r\n\r\n                if (b.x === targetPos.x && b.y === targetPos.y) {\r\n                    return diagonalDistance(a, b);\r\n                }\r\n\r\n                const entities = game.map.getEntitiesAt(b.x, b.y);\r\n\r\n                if (entities.some((e) => e.blocker)) {\r\n                    return Infinity;\r\n                }\r\n\r\n                if (\r\n                    entities.some(\r\n                        (e) =>\r\n                            e.id !== entity.id && e.body && !e.isIncapacitated\r\n                    )\r\n                ) {\r\n                    return Infinity;\r\n                }\r\n\r\n                if (entities.some((e) => e.sharpTrap)) {\r\n                    return 8;\r\n                }\r\n\r\n                return diagonalDistance(a, b);\r\n            },\r\n        });\r\n\r\n        if (result.success && result.cost < 55 && result.path.length > 0) {\r\n            const segment = result.path[1];\r\n            const delta = {\r\n                x: segment.x - start.x,\r\n                y: segment.y - start.y,\r\n            };\r\n            const moveGoal = MoveGoalType.createAsSubGoal(goal, {\r\n                data: delta,\r\n            });\r\n\r\n            entity.brain.pushGoal(moveGoal);\r\n\r\n            entity.fireEvent('take-action');\r\n\r\n            return SUCCESS;\r\n        }\r\n\r\n        // try defense\r\n        // try ranged\r\n        // try items\r\n        // try movement\r\n        // fail to intent\r\n\r\n        entity.fireEvent('energy-consumed', 1000);\r\n\r\n        return FAILURE;\r\n    };\r\n}\r\n","import { diagonalDistance } from './diagonalDistance';\r\nimport { manhattanDistance } from './ManhattanDistance';\r\nimport PriorityQueue from './PriorityQueue';\r\n\r\nconst getNeighbors = (x, y, allowDiagonals = true) => {\r\n    const neighbors = [\r\n        {\r\n            x: x,\r\n            y: y - 1,\r\n        },\r\n        {\r\n            x: x - 1,\r\n            y: y,\r\n        },\r\n        {\r\n            x: x + 1,\r\n            y: y,\r\n        },\r\n        {\r\n            x: x,\r\n            y: y + 1,\r\n        },\r\n    ];\r\n\r\n    if (allowDiagonals) {\r\n        neighbors.push(\r\n            {\r\n                x: x - 1,\r\n                y: y - 1,\r\n            },\r\n            {\r\n                x: x + 1,\r\n                y: y - 1,\r\n            },\r\n            {\r\n                x: x - 1,\r\n                y: y + 1,\r\n            },\r\n            {\r\n                x: x + 1,\r\n                y: y + 1,\r\n            }\r\n        );\r\n    }\r\n\r\n    return neighbors;\r\n};\r\n\r\nconst key = (pos) => `${pos.x},${pos.y}`;\r\n\r\nconst defaultSettings = {\r\n    start: {},\r\n    goal: {},\r\n    cost: () => {},\r\n    allowDiagonals: true,\r\n};\r\n\r\nexport const computeAStar = (settings = defaultSettings) => {\r\n    const heuristic = settings.allowDiagonals\r\n        ? diagonalDistance\r\n        : manhattanDistance;\r\n    const start = settings.start;\r\n    const goal = settings.goal;\r\n    const cost = settings.cost;\r\n\r\n    const open = new PriorityQueue();\r\n    const cameFrom = {};\r\n    const costSoFar = {};\r\n    const startKey = key(start);\r\n    const goalKey = key(goal);\r\n\r\n    const result = {\r\n        success: false,\r\n        path: [],\r\n        costs: [],\r\n        cost: Infinity,\r\n        start,\r\n        goal,\r\n    };\r\n\r\n    if (cost(start, goal) === Infinity) {\r\n        return result;\r\n    }\r\n\r\n    open.put(\r\n        {\r\n            key: startKey,\r\n            pos: start,\r\n        },\r\n        0\r\n    );\r\n\r\n    costSoFar[startKey] = 0;\r\n\r\n    while (!open.isEmpty()) {\r\n        const { key: currentKey, pos: current } = open.pop();\r\n\r\n        if (currentKey === goalKey) {\r\n            result.success = true;\r\n            break;\r\n        }\r\n\r\n        const neighbors = getNeighbors(\r\n            current.x,\r\n            current.y,\r\n            settings.allowDiagonals\r\n        );\r\n\r\n        for (let next of neighbors) {\r\n            const nextKey = key(next);\r\n            const graphCost = nextKey === goalKey ? 0 : cost(current, next);\r\n\r\n            if (graphCost === Infinity) {\r\n                continue;\r\n            }\r\n\r\n            const newCost = costSoFar[currentKey] + graphCost;\r\n\r\n            if (!(nextKey in costSoFar) || newCost < costSoFar[nextKey]) {\r\n                costSoFar[nextKey] = newCost;\r\n\r\n                const priority = newCost + heuristic(next, goal);\r\n\r\n                open.put(\r\n                    {\r\n                        key: nextKey,\r\n                        pos: next,\r\n                    },\r\n                    priority\r\n                );\r\n\r\n                cameFrom[nextKey] = current;\r\n            }\r\n        }\r\n    }\r\n\r\n    if (!result.success) {\r\n        return result;\r\n    }\r\n\r\n    result.path = [goal];\r\n    result.cost = costSoFar[goalKey];\r\n    result.costs = [costSoFar[goalKey]];\r\n\r\n    let previous = cameFrom[key(goal)];\r\n\r\n    while (previous) {\r\n        const previousKey = key(previous);\r\n\r\n        result.path.unshift(previous);\r\n        result.costs.unshift(costSoFar[previousKey]);\r\n\r\n        previous = cameFrom[previousKey];\r\n    }\r\n\r\n    return result;\r\n};\r\n","export const diagonalDistance = (a, b) => {\r\n    const dx = Math.abs(a.x - b.x);\r\n    const dy = Math.abs(a.y - b.y);\r\n\r\n    return 1 * (dx + dy) + (1.41 - 2 * 1) * Math.min(dx, dy);\r\n};\r\n","export const manhattanDistance = (a, b) => {\n    return Math.abs(a.x - b.x) + Math.abs(a.y - b.y);\n};\n","const createItem = (value, priority) => ({ value, priority });\n\nexport default class PriorityQueue {\n    #items = [];\n\n    isEmpty() {\n        return this.#items.length <= 0;\n    }\n\n    pop() {\n        if (!this.isEmpty()) {\n            return this.#items.shift().value;\n        }\n    }\n\n    peek() {\n        if (!this.isEmpty()) {\n            return this.#items[0].value;\n        }\n    }\n\n    put(value, priority) {\n        const item = createItem(value, priority);\n\n        for (let i = 0; i < this.#items.length; i++) {\n            if (this.#items[i].priority > item.priority) {\n                this.#items.splice(i, 0, item);\n                return;\n            }\n        }\n\n        this.#items.push(item);\n    }\n}\n","import { GoalType } from './GoalType';\nimport { SUCCESS, FAILURE } from '../GoalActionResult';\n\nexport class MoveGoalType extends GoalType {\n    static name = 'Move';\n\n    static isFinished = (entity, goal) => {\n        return goal.complete;\n    };\n\n    static takeAction = (entity, goal) => {\n        const evt = entity.fireEvent('try-move', {\n            x: goal.data.x,\n            y: goal.data.y,\n        });\n\n        if (evt.handled) {\n            goal.complete = true;\n\n            return SUCCESS;\n        }\n\n        return FAILURE;\n    };\n}\n","import { GoalType } from './GoalType';\nimport { SUCCESS, FAILURE } from '../GoalActionResult';\n\nexport class EatFoodGoalType extends GoalType {\n    static name = 'EatFood';\n\n    static isFinished = (entity, goal) => {\n        return goal.complete;\n    };\n\n    static takeAction = (entity, goal) => {\n        const evt = entity.fireEvent('try-eat-food', {\n            food: 10000,\n        });\n\n        if (evt.handled) {\n            goal.complete = true;\n\n            return SUCCESS;\n        }\n\n        return FAILURE;\n    };\n}\n","import { BoredGoalType } from '../../ai/GoalTypes';\r\nimport { game } from '../../core/Game';\r\nimport { SPWN_WOOD_CLUB } from '../Spawnables';\r\nimport { spawn } from '../Spawner';\r\n\r\nexport const createSpawnable = () => {\r\n    const bruiser = game.ecs.createPrefab('GoblinBruiser');\r\n\r\n    bruiser.brain.pushGoal(BoredGoalType.create());\r\n\r\n    const club = spawn(SPWN_WOOD_CLUB);\r\n\r\n    bruiser.equipmentSlot.handRight.equip(club);\r\n\r\n    return bruiser;\r\n};\r\n","import { BoredGoalType } from '../../ai/GoalTypes';\r\nimport { game } from '../../core/Game';\r\nimport { SPWN_WOOD_CLUB } from '../Spawnables';\r\nimport { spawn } from '../Spawner';\r\n\r\nexport const createSpawnable = () => {\r\n    const bruiser = game.ecs.createPrefab('GoblinStargazer');\r\n\r\n    bruiser.brain.pushGoal(BoredGoalType.create());\r\n\r\n    // const club = spawn(SPWN_WOOD_CLUB);\r\n\r\n    // bruiser.equipmentSlot.handRight.equip(club);\r\n\r\n    return bruiser;\r\n};\r\n","import { game } from '../../core/Game';\r\nimport { pickRandom } from '../../utils/rand';\r\n\r\nexport const createSpawnable = () => {\r\n    const type = pickRandom(['PineTree', 'SmallPineTree']);\r\n    const tree = game.ecs.createPrefab(type);\r\n\r\n    return tree;\r\n};\r\n","export const pickRandom = (arr) => {\r\n    return arr[Math.floor(Math.random() * arr.length)];\r\n};\r\n\r\nexport const randomInt = (min, max) => {\r\n    return Math.floor(Math.random() * (max - min + 1) + min);\r\n};\r\n\r\nexport const randomBool = () => {\r\n    return pickRandom([true, false]);\r\n};\r\n\r\nexport const randomWeightedBool = (weight = 0.5) => {\r\n    return Math.random() <= weight;\r\n};\r\n","import { BoredGoalType } from '../../ai/GoalTypes';\r\nimport { game } from '../../core/Game';\r\n\r\nexport const createSpawnable = () => {\r\n    const wanderer = game.ecs.createPrefab('HumanWanderer');\r\n\r\n    wanderer.brain.pushGoal(BoredGoalType.create());\r\n\r\n    return wanderer;\r\n};\r\n","import { game } from '../../core/Game';\r\n\r\nexport const createSpawnable = (data) => {\r\n    return game.ecs.createPrefab('Pool', {\r\n        liquidContainer: {\r\n            content: data.content,\r\n            volume: data.volume,\r\n        },\r\n    });\r\n};\r\n","import { game } from '../../core/Game';\r\nimport { pickRandom } from '../../utils/rand';\r\n\r\nexport const createSpawnable = () => {\r\n    const grass = game.ecs.createPrefab('Grass');\r\n    const ch = pickRandom(['', '', '', '']);\r\n\r\n    grass.glyph.ch = ch;\r\n\r\n    return grass;\r\n};\r\n","import { pickRandom } from '../../utils/rand';\r\nimport * as Grass from './SpawnableGrass';\r\n\r\nexport const createSpawnable = () => {\r\n    const grass = Grass.createSpawnable();\r\n    const color = pickRandom([\r\n        '#65553b',\r\n        '#826b40',\r\n        '#757632',\r\n        '#8c6d32',\r\n        '#718427',\r\n    ]);\r\n\r\n    grass.glyph.fg1 = color;\r\n\r\n    return grass;\r\n};\r\n","import { pickRandom } from '../../utils/rand';\r\n\r\nexport const createSpawnable = () => {\r\n    const sand = game.ecs.createPrefab('Sand');\r\n    const ch = pickRandom(['', '', '', '']);\r\n\r\n    sand.glyph.ch = ch;\r\n\r\n    return sand;\r\n};\r\n","import { game } from '../../core/Game';\r\nimport { pickRandom } from '../../utils/rand';\r\n\r\nexport const createSpawnable = () => {\r\n    const cliff = game.ecs.createPrefab('Cliff');\r\n    const ch = pickRandom(['', '', '', '']);\r\n\r\n    cliff.glyph.ch = ch;\r\n\r\n    return cliff;\r\n};\r\n","import { BoredGoalType } from '../../ai/GoalTypes';\r\nimport { game } from '../../core/Game';\r\n\r\nexport const createSpawnable = () => {\r\n    const snake = game.ecs.createPrefab('Snake');\r\n\r\n    snake.brain.pushGoal(BoredGoalType.create());\r\n\r\n    return snake;\r\n};\r\n","import { BoredGoalType } from '../../ai/GoalTypes';\r\nimport { game } from '../../core/Game';\r\n\r\nexport const createSpawnable = () => {\r\n    const bear = game.ecs.createPrefab('Bear');\r\n\r\n    bear.brain.pushGoal(BoredGoalType.create());\r\n\r\n    return bear;\r\n};\r\n","import { Component } from 'geotic';\r\nimport { Blocker } from './Blocker';\r\nimport { Shadowcaster } from './Shadowcaster';\r\n\r\nexport class Door extends Component {\r\n    static properties = {\r\n        isOpen: false,\r\n        chOpen: \"'\",\r\n        chClosed: '+',\r\n    };\r\n\r\n    get ch() {\r\n        return this.isOpen ? this.chOpen : this.chClosed;\r\n    }\r\n\r\n    get display() {\r\n        return this.isOpen ? '[open]' : '[closed]';\r\n    }\r\n\r\n    openDoor() {\r\n        if (this.isOpen) {\r\n            return false;\r\n        }\r\n\r\n        this.isOpen = true;\r\n\r\n        const glyph = this.entity.glyph;\r\n\r\n        if (glyph) {\r\n            glyph.ch = this.ch;\r\n        }\r\n\r\n        this.entity.blocker.destroy();\r\n        this.entity.shadowcaster.destroy();\r\n\r\n        return true;\r\n    }\r\n\r\n    closeDoor() {\r\n        if (!this.isOpen) {\r\n            return false;\r\n        }\r\n        // todo: check if entity blocking door\r\n\r\n        this.isOpen = false;\r\n\r\n        const glyph = this.entity.glyph;\r\n\r\n        if (glyph) {\r\n            glyph.ch = this.ch;\r\n        }\r\n\r\n        this.entity.add(Blocker);\r\n        this.entity.add(Shadowcaster);\r\n\r\n        return true;\r\n    }\r\n\r\n    onGetInteractions(evt) {\r\n        if (this.isOpen) {\r\n            evt.data.interactions.push({\r\n                name: 'Close door',\r\n                evt: 'try-close-door',\r\n            });\r\n        } else {\r\n            evt.data.interactions.push({\r\n                name: 'Open door',\r\n                evt: 'try-open-door',\r\n            });\r\n        }\r\n    }\r\n\r\n    onTryCloseDoor(evt) {\r\n        if (this.closeDoor()) {\r\n            evt.data.interactor.fireEvent('energy-consumed', 800);\r\n        }\r\n        evt.handle();\r\n    }\r\n\r\n    onTryOpenDoor(evt) {\r\n        if (this.openDoor()) {\r\n            evt.data.interactor.fireEvent('energy-consumed', 800);\r\n        }\r\n        evt.handle();\r\n    }\r\n\r\n    onProjectileHit(evt) {\r\n        if (!this.isOpen) {\r\n            evt.data.stopProjectile = true;\r\n            evt.data.deflectProjectile = false;\r\n        }\r\n\r\n        this.openDoor();\r\n    }\r\n}\r\n","import { Component } from 'geotic';\n\nexport class Blocker extends Component {\n    onProjectileHit(evt) {\n        // https://github.com/ddmills/geotic/issues/22\n        if (!this.isAttached) {\n            return;\n        }\n\n        evt.data.stopProjectile = true;\n        evt.data.deflectProjectile = true;\n    }\n}\n","import { Component } from 'geotic';\r\n\r\nexport class Shadowcaster extends Component {\r\n    static properties = {\r\n        removeOnCompression: false\r\n    };\r\n\r\n    onCompressed() {\r\n        if (this.removeOnCompression) {\r\n            this.destroy();\r\n        }\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport { Inventory } from './Inventory';\r\nimport { IsInventoried } from './IsInventoried';\r\n\r\nexport class Loot extends Component {\r\n    take(newOwner) {\r\n        if (this.entity.isInventoried) {\r\n            if (this.entity.isInventoried.isOwnedBy(newOwner)) {\r\n                return true;\r\n            }\r\n\r\n            const owner = this.entity.isInventoried.owner;\r\n\r\n            owner.inventory.removeLoot(this.entity);\r\n        }\r\n\r\n        newOwner.inventory.addLoot(this.entity);\r\n\r\n        return true;\r\n    }\r\n\r\n    onGetInteractions(evt) {\r\n        const interactor = evt.data.interactor;\r\n        const isInventoried = this.entity.has(IsInventoried);\r\n\r\n        if (!interactor.has(Inventory)) {\r\n            return;\r\n        }\r\n\r\n        if (isInventoried) {\r\n            if (interactor.inventory.hasLoot(this.entity)) {\r\n                evt.data.interactions.push({\r\n                    name: 'Drop',\r\n                    evt: 'try-drop',\r\n                });\r\n            } else {\r\n                evt.data.interactions.push({\r\n                    name: 'Take',\r\n                    evt: 'try-take',\r\n                });\r\n            }\r\n        } else {\r\n            evt.data.interactions.push({\r\n                name: 'Pickup',\r\n                evt: 'try-pick-up',\r\n            });\r\n        }\r\n    }\r\n\r\n    onEquipped(evt) {\r\n        if (!evt.data.interactor.has(Inventory)) {\r\n            return;\r\n        }\r\n\r\n        if (evt.data.interactor.inventory.hasLoot(this.entity)) {\r\n            return;\r\n        }\r\n\r\n        evt.data.interactor.inventory.addLoot(this.entity);\r\n    }\r\n\r\n    onTryPickUp(evt) {\r\n        this.take(evt.data.interactor);\r\n\r\n        evt.data.interactor.fireEvent('energy-consumed', 100);\r\n        evt.handle();\r\n    }\r\n\r\n    onTryTake(evt) {\r\n        this.take(evt.data.interactor);\r\n\r\n        evt.data.interactor.fireEvent('energy-consumed', 100);\r\n        evt.handle();\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport { game } from '../../core/Game';\r\nimport { SCREEN_INVENTORY } from '../../core/screens/ScreenType';\r\nimport { IsInventoried } from './IsInventoried';\r\nimport { Stackable } from './Stackable';\r\n\r\nexport class Inventory extends Component {\r\n    static properties = {\r\n        content: '<EntityArray>',\r\n        isOpenable: true,\r\n    };\r\n\r\n    onDestroyed() {\r\n        this.content.forEach((entity) => entity.destroy());\r\n    }\r\n\r\n    onQueryOwnership(evt) {\r\n        this.content.forEach((entity) => {\r\n            evt.data.result.add(entity);\r\n            entity.fireEvent('query-ownership', { result: evt.data.result });\r\n        });\r\n    }\r\n\r\n    getStackable(stackableIdentifier) {\r\n        return this.content.find((entity) => {\r\n            return (\r\n                entity.has(Stackable) &&\r\n                entity.stackable.identifier === stackableIdentifier\r\n            );\r\n        });\r\n    }\r\n\r\n    addLoot(loot) {\r\n        if (loot.has(Stackable)) {\r\n            const existing = this.getStackable(loot.stackable.identifier);\r\n\r\n            if (existing) {\r\n                existing.stackable.addOther(loot);\r\n\r\n                return;\r\n            }\r\n        }\r\n\r\n        loot.add(IsInventoried, {\r\n            owner: this.entity,\r\n        });\r\n\r\n        this.content.push(loot);\r\n    }\r\n\r\n    hasLoot(loot) {\r\n        const idx = this.content.indexOf(loot);\r\n\r\n        return idx >= 0;\r\n    }\r\n\r\n    removeLoot(loot, quantity) {\r\n        const isStackable = loot.has(Stackable);\r\n\r\n        if (isStackable && !isNaN(quantity)) {\r\n            loot.stackable.split(quantity);\r\n\r\n            return this.removeLoot(loot);\r\n        }\r\n\r\n        const idx = this.content.indexOf(loot);\r\n\r\n        if (idx >= 0) {\r\n            this.content.splice(idx, 1);\r\n            loot.isInventoried.destroy();\r\n        }\r\n\r\n        return loot;\r\n    }\r\n\r\n    dropLoot(loot, quantity) {\r\n        const ob = this.removeLoot(loot, quantity);\r\n        const pos = this.entity.position.getPos();\r\n\r\n        ob.position.setPos(pos.x, pos.y);\r\n\r\n        ob.fireEvent('dropped', {\r\n            dropper: this.entity,\r\n        });\r\n\r\n        return ob;\r\n    }\r\n\r\n    onTryOpen(evt) {\r\n        game.screens.replaceScreen(SCREEN_INVENTORY, {\r\n            accessible: this.entity,\r\n            accessor: evt.data.interactor,\r\n        });\r\n        evt.handle();\r\n    }\r\n\r\n    onGetInteractions(evt) {\r\n        if (this.isOpenable) {\r\n            evt.data.interactions.push({\r\n                name: 'Open',\r\n                evt: 'try-open',\r\n            });\r\n        }\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport { Stackable } from './Stackable';\r\n\r\nexport class IsInventoried extends Component {\r\n    static properties = {\r\n        owner: '<Entity>',\r\n    };\r\n\r\n    isOwnedBy(entity) {\r\n        return this.owner && this.owner.id === entity.id;\r\n    }\r\n\r\n    onQueryOwnership(evt) {\r\n        evt.data.result.add(this.entity);\r\n    }\r\n\r\n    onTryDrop(evt) {\r\n        this.owner.inventory.dropLoot(this.entity);\r\n\r\n        evt.data.interactor.fireEvent('energy-consumed', 200);\r\n\r\n        evt.handle();\r\n    }\r\n\r\n    onThrown(evt) {\r\n        const isStackable = this.entity.has(Stackable);\r\n        const quantity = isStackable ? 1 : null;\r\n\r\n        this.owner.inventory.removeLoot(this.entity, quantity);\r\n    }\r\n}\r\n","import { Component } from 'geotic';\nimport { game } from '../../core/Game';\nimport { STACKABLE_DEFAULT } from '../../enums/Stackables';\nimport { IsDestroying } from './IsDestroying';\nimport { IsInventoried } from './IsInventoried';\n\nexport class Stackable extends Component {\n    static properties = {\n        identifier: STACKABLE_DEFAULT,\n        quantity: 1,\n    };\n\n    get display() {\n        return `x ${this.quantity}`;\n    }\n\n    increment(amount) {\n        this.quantity += amount;\n    }\n\n    addOther(other) {\n        this.increment(other.stackable.quantity);\n        other.stackable.quantity = 0;\n        other.add(IsDestroying);\n    }\n\n    split(quantity) {\n        if (quantity >= this.quantity) {\n            quantity = this.quantity;\n            return this.entity;\n        }\n\n        const clone = game.engine.cloneEntity(this.entity);\n        clone.stackable.quantity -= quantity;\n\n        this.quantity = quantity;\n\n        if (clone.has(IsInventoried)) {\n            // make sure inventory contents are still \"correct\"\n            clone.isInventoried.owner.inventory.content.push(clone);\n        }\n\n        return clone;\n    }\n}\n","export const STACKABLE_DEFAULT = 'STACKABLE_DEFAULT';\r\nexport const STACKABLE_STONE = 'STACKABLE_STONE';\r\nexport const STACKABLE_ASH = 'STACKABLE_ASH';\r\nexport const STACKABLE_GLASS_SHARD = 'STACKABLE_GLASS_SHARD';\r\n","import { Component } from 'geotic';\r\nimport { game } from '../../core/Game';\r\nimport { SCREEN_ADVENTURE, SCREEN_CURSOR } from '../../core/screens/ScreenType';\r\nimport { SKILL_THROWING, getSkillValue } from '../../data/Skills';\r\nimport Attack from '../../data/Attack';\r\nimport { DMG_TYPE_BLUDGEONING } from '../../data/DamageTypes';\r\nimport { getStat, STAT_STRENGTH } from '../../data/Stats';\r\nimport { bresenhamLine } from '../../utils/BresenhamLine';\r\nimport { randomInt } from '../../utils/rand';\r\nimport { Inventory } from './Inventory';\r\nimport { simpleLineRenderer } from '../../utils/cursor/SimpleLineRenderer';\r\n\r\nexport class Throwable extends Component {\r\n    static properties = {\r\n        die: 4,\r\n        modifier: 0,\r\n        cost: 500,\r\n        damageType: DMG_TYPE_BLUDGEONING,\r\n    };\r\n\r\n    onGetInteractions(evt) {\r\n        if (!evt.data.interactor.has(Inventory)) {\r\n            return;\r\n        }\r\n\r\n        if (!evt.data.interactor.inventory.hasLoot(this.entity)) {\r\n            return;\r\n        }\r\n\r\n        evt.data.interactions.push({\r\n            name: 'Throw',\r\n            evt: 'try-throw',\r\n        });\r\n    }\r\n\r\n    throw(trajectory, initiator) {\r\n        this.entity.fireEvent('thrown', {\r\n            initiator,\r\n            trajectory,\r\n        });\r\n\r\n        for (let i = 0; i < trajectory.length; i++) {\r\n            if (i == 0) {\r\n                continue;\r\n            }\r\n\r\n            const position = trajectory[i];\r\n            const entities = position.entities;\r\n\r\n            let stopped = false;\r\n            let deflected = false;\r\n\r\n            const hit = entities.find((entity) => {\r\n                const evt = entity.fireEvent('projectile-hit', {\r\n                    initiator,\r\n                    trajectory,\r\n                    projectile: this.entity,\r\n                });\r\n\r\n                stopped = evt.data.stopProjectile;\r\n                deflected = evt.data.deflectProjectile;\r\n\r\n                return stopped || deflected;\r\n            });\r\n\r\n            if (hit) {\r\n                if (deflected) {\r\n                    const prev = trajectory[i - 1];\r\n\r\n                    this.entity.position.setPos(prev.x, prev.y);\r\n                    this.entity.fireEvent('collide-ground', {\r\n                        initiator,\r\n                        x: prev.x,\r\n                        y: prev.y,\r\n                    });\r\n                } else {\r\n                    this.entity.position.setPos(position.x, position.y);\r\n                    this.entity.fireEvent('collide', {\r\n                        initiator,\r\n                        hit,\r\n                        x: position.x,\r\n                        y: position.y,\r\n                    });\r\n\r\n                    const str = getStat(STAT_STRENGTH, initiator);\r\n                    const die = randomInt(1, this.die);\r\n                    const damage = die + str + this.modifier;\r\n                    const attack = new Attack({\r\n                        attacker: initiator,\r\n                        defender: hit,\r\n                        weaponName: this.entity.moniker.display,\r\n                        damage,\r\n                        damageType: this.damageType,\r\n                        ignoreDodge: true,\r\n                    });\r\n\r\n                    hit.fireEvent('attacked', { attack });\r\n                }\r\n\r\n                break;\r\n            } else if (i === trajectory.length - 1) {\r\n                this.entity.position.setPos(position.x, position.y);\r\n                this.entity.fireEvent('collide-ground', {\r\n                    initiator,\r\n                    x: position.x,\r\n                    y: position.y,\r\n                });\r\n            }\r\n        }\r\n    }\r\n\r\n    onTryThrow(evt) {\r\n        const range = getSkillValue(SKILL_THROWING, evt.data.interactor) + 3;\r\n\r\n        game.screens.pushScreen(SCREEN_CURSOR, {\r\n            renderer: simpleLineRenderer(),\r\n            start: evt.data.interactor.position.getPos(),\r\n            onResult: (cursor) => {\r\n                game.screens.setScreen(SCREEN_ADVENTURE);\r\n\r\n                this.entity.position.setPos(cursor.start.x, cursor.start.y);\r\n\r\n                const line = bresenhamLine(\r\n                    cursor.start.x,\r\n                    cursor.start.y,\r\n                    cursor.position.x,\r\n                    cursor.position.y\r\n                );\r\n                const trajectory = line.slice(0, range + 1).map((pos) => ({\r\n                    x: pos.x,\r\n                    y: pos.y,\r\n                    entities: game.map.getEntitiesAt(pos.x, pos.y),\r\n                }));\r\n\r\n                evt.data.interactor.fireEvent('energy-consumed', this.cost);\r\n\r\n                this.throw(trajectory, evt.data.interactor);\r\n            },\r\n            onCancel: () => {\r\n                game.screens.popScreen();\r\n            },\r\n        });\r\n    }\r\n}\r\n","import ArmorSkill from './skills/ArmorSkill';\r\nimport SpeedSkill from './skills/SpeedSkill';\r\nimport ThrowingSkill from './skills/ThrowingSkill';\r\nimport DodgeSkill from './skills/DodgeSkill';\r\nimport BrawlingSkill from './skills/BrawlingSkill';\r\nimport AxeSkill from './skills/AxeSkill';\r\nimport BladeSkill from './skills/BladeSkill';\r\nimport CudgelSkill from './skills/CudgelSkill';\r\nimport HealthSkill from './skills/HealthSkill';\r\n\r\nexport const SKILL_SPEED = 'SKILL_SPEED';\r\nexport const SKILL_HEALTH = 'SKILL_HEALTH';\r\nexport const SKILL_THROWING = 'SKILL_THROWING';\r\nexport const SKILL_ARMOR = 'SKILL_ARMOR';\r\nexport const SKILL_DODGE = 'SKILL_DODGE';\r\nexport const SKILL_BRAWLING = 'SKILL_BRAWLING';\r\nexport const SKILL_AXE = 'SKILL_AXE';\r\nexport const SKILL_BLADE = 'SKILL_BLADE';\r\nexport const SKILL_CUDGEL = 'SKILL_CUDGEL';\r\n\r\nconst lookup = {\r\n    SKILL_ARMOR: new ArmorSkill(),\r\n    SKILL_HEALTH: new HealthSkill(),\r\n    SKILL_SPEED: new SpeedSkill(),\r\n    SKILL_THROWING: new ThrowingSkill(),\r\n    SKILL_DODGE: new DodgeSkill(),\r\n    SKILL_BRAWLING: new BrawlingSkill(),\r\n    SKILL_AXE: new AxeSkill(),\r\n    SKILL_BLADE: new BladeSkill(),\r\n    SKILL_CUDGEL: new CudgelSkill(),\r\n};\r\n\r\nexport const getSkill = (key) => lookup[key];\r\nexport const getSkillName = (key) => lookup[key].name;\r\nexport const getSkillValue = (key, entity) => lookup[key].compute(entity);\r\nexport const getSkillsByStat = (stat) =>\r\n    Object.values(lookup).filter((s) => s.baseStat === stat);\r\nexport const getSkillEquippedMod = (key, entity) => {\r\n    const modifiers = [];\r\n\r\n    entity.fireEvent(`query-skill-mod-equipped`, {\r\n        skill: key,\r\n        modifiers,\r\n    });\r\n\r\n    return modifiers;\r\n};\r\nexport const getAllSkillEquippedMods = (entity) => {\r\n    return Object.keys(lookup).reduce(\r\n        (mods, skill) => ({\r\n            ...mods,\r\n            [skill]: getSkillEquippedMod(skill, entity),\r\n        }),\r\n        {}\r\n    );\r\n};\r\nexport const getAllSkillEquippedModSums = (entity) => {\r\n    const mods = getAllSkillEquippedMods(entity);\r\n\r\n    return Object.keys(mods).reduce(\r\n        (all, skill) => ({\r\n            ...all,\r\n            [skill]: mods[skill].reduce((sum, mod) => sum + mod.mod, 0),\r\n        }),\r\n        {}\r\n    );\r\n};\r\n","import { SKILL_ARMOR } from '../Skills';\r\nimport Skill from './Skill';\r\n\r\nexport const getArmorBlockPercent = (skill = 0) => {\r\n    const base = 10;\r\n\r\n    return 1 - base / (skill + base);\r\n};\r\n\r\nexport const getArmorBlockPercentDisplay = (skill = 0) => {\r\n    const prcnt = getArmorBlockPercent(skill);\r\n\r\n    return Math.floor(prcnt * 100);\r\n};\r\n\r\nexport default class ArmorSkill extends Skill {\r\n    constructor() {\r\n        super(SKILL_ARMOR, 'armor');\r\n    }\r\n}\r\n","import { getStat } from '../Stats';\r\n\r\nexport default class Skill {\r\n    key = -1;\r\n    name = 'skill';\r\n    baseStat = null;\r\n\r\n    constructor(key, name, baseStat) {\r\n        this.key = key;\r\n        this.name = name;\r\n        this.baseStat = baseStat;\r\n    }\r\n\r\n    getModifiers(entity) {\r\n        const evt = entity.fireEvent(`query-skill-mod`, {\r\n            name: this.name,\r\n            skill: this.key,\r\n            modifiers: [],\r\n        });\r\n\r\n        return evt.data.modifiers;\r\n    }\r\n\r\n    getModifierSum(entity) {\r\n        const modifiers = this.getModifiers(entity);\r\n\r\n        return modifiers.reduce((sum, cur) => sum + cur.mod, 0);\r\n    }\r\n\r\n    compute(entity) {\r\n        const stat = this.baseStat ? getStat(this.baseStat, entity) : 0;\r\n        const modifier = this.getModifierSum(entity);\r\n\r\n        return stat + modifier;\r\n    }\r\n}\r\n","import { randomInt } from '../utils/rand';\r\n\r\nexport const STAT_STRENGTH = 'STAT_STRENGTH';\r\nexport const STAT_FINESSE = 'STAT_FINESSE';\r\nexport const STAT_ATHLETICISM = 'STAT_ATHLETICISM';\r\nexport const STAT_TRICKERY = 'STAT_TRICKERY';\r\nexport const STAT_FAITH = 'STAT_FAITH';\r\n\r\nconst lookup = {\r\n    [STAT_STRENGTH]: {\r\n        name: 'strength',\r\n        abbreviation: 'STR',\r\n    },\r\n    [STAT_FINESSE]: {\r\n        name: 'finesse',\r\n        abbreviation: 'FIN',\r\n    },\r\n    [STAT_ATHLETICISM]: {\r\n        name: 'athleticism',\r\n        abbreviation: 'ATH',\r\n    },\r\n    [STAT_TRICKERY]: {\r\n        name: 'trickery',\r\n        abbreviation: 'TRK',\r\n    },\r\n    [STAT_FAITH]: {\r\n        name: 'faith',\r\n        abbreviation: 'FTH',\r\n    },\r\n};\r\n\r\nexport const getStatName = (stat) => lookup[stat].name;\r\nexport const getStatAbbreviation = (stat) => lookup[stat].abbreviation;\r\nexport const getStat = (stat, entity) => {\r\n    const name = lookup[stat].name;\r\n\r\n    return entity.stats[name]();\r\n};\r\nexport const rollStat = (stat, entity) => {\r\n    return randomInt(1, 20) + getStat(stat, entity);\r\n};\r\nexport const statCheck = (stat, entity, target) => {\r\n    return rollStat(stat, entity) >= target;\r\n};\r\n","import { SKILL_SPEED } from '../Skills';\r\nimport { STAT_ATHLETICISM } from '../Stats';\r\nimport Skill from './Skill';\r\n\r\nexport const getSpeedPercent = (skill = 0) => {\r\n    const base = 5;\r\n    const cost = base / (base + skill);\r\n\r\n    return cost;\r\n};\r\n\r\nexport const getSpeedPercentDisplay = (skill = 0) => {\r\n    const prcnt = getSpeedPercent(skill);\r\n\r\n    return Math.floor(prcnt * 100);\r\n};\r\n\r\nexport default class SpeedSkill extends Skill {\r\n    constructor() {\r\n        super(SKILL_SPEED, 'speed', STAT_ATHLETICISM);\r\n    }\r\n}\r\n","import { SKILL_THROWING } from '../Skills';\r\nimport { getStat, STAT_ATHLETICISM } from '../Stats';\r\nimport Skill from './Skill';\r\n\r\nexport default class ThrowingSkill extends Skill {\r\n    constructor() {\r\n        super(SKILL_THROWING, 'throwing', STAT_ATHLETICISM);\r\n    }\r\n\r\n    compute(entity) {\r\n        const base = getStat(STAT_ATHLETICISM, entity);\r\n        const modifier = this.getModifierSum(entity);\r\n\r\n        return Math.max(0, base + modifier);\r\n    }\r\n}\r\n","import { SKILL_DODGE } from '../Skills';\r\nimport { STAT_FINESSE } from '../Stats';\r\nimport Skill from './Skill';\r\n\r\nexport const getDodgePercent = (skill = 0) => {\r\n    const base = 5;\r\n    const unscaled = 1 - base / (skill + base);\r\n\r\n    return Math.floor(unscaled * 100);\r\n};\r\n\r\nexport default class DodgeSkill extends Skill {\r\n    constructor() {\r\n        super(SKILL_DODGE, 'dodge', STAT_FINESSE);\r\n    }\r\n}\r\n","import { SKILL_BRAWLING } from '../Skills';\r\nimport { STAT_STRENGTH } from '../Stats';\r\nimport Skill from './Skill';\r\n\r\nexport default class BrawlingSkill extends Skill {\r\n    constructor() {\r\n        super(SKILL_BRAWLING, 'brawling', STAT_STRENGTH);\r\n    }\r\n}\r\n","import { SKILL_AXE } from '../Skills';\r\nimport { STAT_STRENGTH } from '../Stats';\r\nimport Skill from './Skill';\r\n\r\nexport default class AxeSkill extends Skill {\r\n    constructor() {\r\n        super(SKILL_AXE, 'axes', STAT_STRENGTH);\r\n    }\r\n}\r\n","import { SKILL_BLADE } from '../Skills';\r\nimport { STAT_STRENGTH } from '../Stats';\r\nimport Skill from './Skill';\r\n\r\nexport default class BladeSkill extends Skill {\r\n    constructor() {\r\n        super(SKILL_BLADE, 'blades', STAT_STRENGTH);\r\n    }\r\n}\r\n","import { SKILL_CUDGEL } from '../Skills';\r\nimport { STAT_STRENGTH } from '../Stats';\r\nimport Skill from './Skill';\r\n\r\nexport default class CudgelSkill extends Skill {\r\n    constructor() {\r\n        super(SKILL_CUDGEL, 'cudgels', STAT_STRENGTH);\r\n    }\r\n}\r\n","import { SKILL_HEALTH } from '../Skills';\r\nimport { STAT_ATHLETICISM } from '../Stats';\r\nimport Skill from './Skill';\r\n\r\nexport default class HealthSkill extends Skill {\r\n    constructor() {\r\n        super(SKILL_HEALTH, 'health', STAT_ATHLETICISM);\r\n    }\r\n}\r\n","export default class Attack {\r\n    constructor(data) {\r\n        this.attacker = data.attacker;\r\n        this.defender = data.defender;\r\n        this.weaponName = data.weaponName;\r\n        this.damage = data.damage;\r\n        this.damageType = data.damageType;\r\n        this.ignoreDodge = data.ignoreDodge;\r\n    }\r\n}\r\n","export const DMG_TYPE_BLUDGEONING = 'DMG_TYPE_BLUDGEONING';\r\nexport const DMG_TYPE_PIERCING = 'DMG_TYPE_PIERCING';\r\nexport const DMG_TYPE_SLASHING = 'DMG_TYPE_SLASHING';\r\nexport const DMG_TYPE_NECROTIC = 'DMG_TYPE_NECROTIC';\r\n\r\nconst lookup = {\r\n    [DMG_TYPE_BLUDGEONING]: {\r\n        name: 'Bludgeoning',\r\n        verb: 'bludgeons',\r\n    },\r\n    [DMG_TYPE_PIERCING]: {\r\n        name: 'Piercing',\r\n        verb: 'pierces',\r\n    },\r\n    [DMG_TYPE_SLASHING]: {\r\n        name: 'Slashing',\r\n        verb: 'slashes',\r\n    },\r\n    [DMG_TYPE_NECROTIC]: {\r\n        name: 'Necrotic',\r\n        verb: 'saps',\r\n    },\r\n};\r\n\r\nexport const getDmgTypeName = (type) => lookup[type].name;\r\nexport const getDmgTypeVerb = (type) => lookup[type].verb;\r\n","export const bresenhamLine = (x0, y0, x1, y1) => {\n    const dx = Math.abs(x1 - x0);\n    const dy = Math.abs(y1 - y0);\n    const sx = x0 < x1 ? 1 : -1;\n    const sy = y0 < y1 ? 1 : -1;\n    const result = [];\n\n    let err = dx - dy;\n\n    while (true) {\n        result.push({\n            x: x0,\n            y: y0,\n        });\n\n        if (x0 === x1 && y0 === y1) {\n            break;\n        }\n\n        const e2 = 2 * err;\n\n        if (e2 > -dy) {\n            err -= dy;\n            x0 += sx;\n        }\n        if (e2 < dx) {\n            err += dx;\n            y0 += sy;\n        }\n    }\n\n    return result;\n};\n\nexport const bresenhamLineExclusive = (x0, y0, x1, y1) => {\n    const line = bresenhamLine(x0, y0, x1, y1);\n\n    line.shift();\n    line.pop();\n\n    return line;\n};\n","import { game } from '../../core/Game';\r\n\r\nconst truthy = () => true;\r\n\r\nexport const simpleLineRenderer = (options = {}) => {\r\n    const isValid = options.isValid || truthy;\r\n\r\n    return {\r\n        isValid,\r\n        render: (opts) => {\r\n            opts.line.forEach(({ x, y }, idx) => {\r\n                if (idx === 0) {\r\n                    return;\r\n                }\r\n\r\n                const color = isValid(\r\n                    {\r\n                        ...opts,\r\n                        x,\r\n                        y,\r\n                    },\r\n                    idx\r\n                )\r\n                    ? 'blue'\r\n                    : 'red';\r\n                const screen = game.camera.worldToScreen(x, y);\r\n\r\n                game.renderer.draw(screen.x, screen.y, '', color);\r\n            });\r\n        },\r\n    };\r\n};\r\n","import { Component } from 'geotic';\r\nimport { game } from '../../core/Game';\r\nimport { SPWN_GLASS_SHARD } from '../../data/Spawnables';\r\nimport { spawn } from '../../data/Spawner';\r\nimport { CONSOLE_EVENT_SHATTER } from '../../enums/ConsoleEvents';\r\nimport { IsDestroying } from './IsDestroying';\r\nimport { LiquidContainer } from './LiquidContainer';\r\n\r\nexport class FragileGlass extends Component {\r\n    shatter(x, y) {\r\n        spawn(SPWN_GLASS_SHARD, x, y, {\r\n            stackable: {\r\n                quantity: 3,\r\n            },\r\n        });\r\n\r\n        if (this.entity.has(LiquidContainer)) {\r\n            if (this.entity.liquidContainer.pour(x, y)) {\r\n                game.console.event(CONSOLE_EVENT_SHATTER, {\r\n                    target: this.entity,\r\n                    liquid: this.entity.liquidContainer.content,\r\n                });\r\n            }\r\n        } else {\r\n            game.console.event(CONSOLE_EVENT_SHATTER, {\r\n                target: this.entity,\r\n            });\r\n        }\r\n\r\n        this.entity.add(IsDestroying);\r\n    }\r\n\r\n    onCollideGround(evt) {\r\n        this.shatter(evt.data.x, evt.data.y);\r\n    }\r\n\r\n    onCollide(evt) {\r\n        this.shatter(evt.data.x, evt.data.y);\r\n    }\r\n}\r\n","import { getDmgTypeVerb } from '../data/DamageTypes';\r\nimport { IsPlayer, Moniker, IsVisible } from '../ecs/components';\r\nimport { liquids } from './LiquidTypes';\r\n\r\nexport const CONSOLE_EVENT_DAMAGE = 0;\r\nexport const CONSOLE_EVENT_DEAD = 1;\r\nexport const CONSOLE_EVENT_SHATTER = 2;\r\nexport const CONSOLE_EVENT_MISS = 3;\r\nexport const CONSOLE_EVENT_BLOCK = 4;\r\nexport const CONSOLE_EVENT_TRAP_SHARP = 5;\r\nexport const CONSOLE_EVENT_LEVEL = 6;\r\n\r\nconst getMonikerSubject = (entity) => {\r\n    if (entity.has(Moniker)) {\r\n        return `The ${entity.moniker.simpleDisplay.toLowerCase()}`;\r\n    }\r\n\r\n    return `The thing`;\r\n};\r\n\r\nconst getMonikerIndirectObject = (entity) => {\r\n    if (entity.isPlayer) {\r\n        return 'you';\r\n    }\r\n\r\n    if (entity.has(Moniker)) {\r\n        return `the ${entity.moniker.simpleDisplay.toLowerCase()}`;\r\n    }\r\n};\r\n\r\nconst mapping = {\r\n    [CONSOLE_EVENT_LEVEL]: {\r\n        message(data) {\r\n            const entity = getMonikerSubject(data.entity);\r\n\r\n            return `${entity} gained a level (${data.level})!`;\r\n        },\r\n        shouldAppear(data) {\r\n            return data.entity.isPlayer || data.entity.isVisible;\r\n        },\r\n    },\r\n    [CONSOLE_EVENT_MISS]: {\r\n        message(data) {\r\n            const attacker = getMonikerIndirectObject(data.attacker);\r\n            const defender = getMonikerSubject(data.defender);\r\n\r\n            return `${defender} dodged an attack from ${attacker} (${data.dodgePrcnt}%)`;\r\n        },\r\n        shouldAppear(data) {\r\n            return data.defender.isPlayer || data.attacker.isVisible;\r\n        },\r\n    },\r\n    [CONSOLE_EVENT_DAMAGE]: {\r\n        message(data) {\r\n            const source = getMonikerSubject(data.source);\r\n            const target = getMonikerIndirectObject(data.target);\r\n            const dmgVerb = getDmgTypeVerb(data.damageType);\r\n            const dmg = data.damage;\r\n            const blocked = data.blocked;\r\n\r\n            const blockText =\r\n                blocked > 0 ? `. (${blocked} damage was blocked)` : '';\r\n\r\n            return `${source} ${dmgVerb} ${target} for ${dmg} hp${blockText}`;\r\n        },\r\n        shouldAppear(data) {\r\n            return data.target.isPlayer || data.target.isVisible;\r\n        },\r\n    },\r\n    [CONSOLE_EVENT_DEAD]: {\r\n        message(data) {\r\n            const source = getMonikerSubject(data.source);\r\n            const target = getMonikerIndirectObject(data.target);\r\n            const dmgVerb = getDmgTypeVerb(data.damageType);\r\n\r\n            return `${source} ${dmgVerb} ${target} to death`;\r\n        },\r\n        shouldAppear(data) {\r\n            return data.target.isPlayer || data.target.isVisible;\r\n        },\r\n    },\r\n    [CONSOLE_EVENT_SHATTER]: {\r\n        message(data) {\r\n            if (isNaN(data.liquid)) {\r\n                return `${getMonikerSubject(data.target)} shatters!`;\r\n            } else {\r\n                return `${getMonikerSubject(\r\n                    data.target\r\n                )} shatters and spills its ${\r\n                    liquids[data.liquid].colorDesc\r\n                } content!`;\r\n            }\r\n        },\r\n        shouldAppear(data) {\r\n            return data.target.isVisible;\r\n        },\r\n    },\r\n    [CONSOLE_EVENT_TRAP_SHARP]: {\r\n        message(data) {\r\n            return `${getMonikerSubject(\r\n                data.entity\r\n            )} cuts themselves on ${getMonikerIndirectObject(\r\n                data.trap\r\n            )} and begins bleeding`;\r\n        },\r\n        shouldAppear(data) {\r\n            return data.trap.isVisible;\r\n        },\r\n    },\r\n};\r\n\r\nexport const getMessage = (evt, data) => {\r\n    return mapping[evt].message(data);\r\n};\r\n\r\nexport const shouldAppear = (evt, data) => {\r\n    return mapping[evt].shouldAppear(data);\r\n};\r\n","import { Component } from 'geotic';\nimport { INVALID, FAILURE } from '../../ai/GoalActionResult';\n\nexport class Brain extends Component {\n    static properties = {\n        goals: '<EntityArray>',\n    };\n\n    onDestroyed() {\n        this.goals.forEach((entity) => {\n            entity.destroy();\n        });\n    }\n\n    onTakeAction(evt) {\n        while (this.peekGoal() && this.peekGoal().isFinished()) {\n            this.popGoal().entity.destroy();\n        }\n\n        const currentGoal = this.peekGoal();\n        const result = currentGoal.takeAction();\n\n        if (result === FAILURE) {\n            this.removeGoal(currentGoal);\n        } else if (result === INVALID) {\n            this.removeGoal(currentGoal);\n            this.entity.fireEvent('take-action');\n        }\n\n        evt.handle();\n    }\n\n    removeGoal(goal) {\n        const goalsToDestroy = [];\n\n        this.goals = this.goals.filter((g) => {\n            const isSelf = Boolean(g.id === goal.entity.id);\n            const isSiblingGoal = Boolean(\n                g.goal.originalIntent &&\n                    g.goal.originalIntent.id === goal.originalIntent.id\n            );\n\n            if (isSelf || isSiblingGoal) {\n                goalsToDestroy.push(g.goal);\n                return false;\n            }\n\n            return true;\n        });\n\n        goalsToDestroy.forEach((g) => g.entity.destroy());\n    }\n\n    pushGoal(goal) {\n        if (!(goal instanceof Component)) {\n            throw new Error('Pushing non-component goal!', goal);\n        }\n\n        goal.parent = this.entity;\n\n        return this.goals.push(goal.entity);\n    }\n\n    popGoal() {\n        return this.goals.pop().goal;\n    }\n\n    peekGoal() {\n        return this.goals[this.goals.length - 1].goal;\n    }\n}\n","import { Component } from 'geotic';\r\nimport { SPWN_CORPSE } from '../../data/Spawnables';\r\nimport { spawn } from '../../data/Spawner';\r\n\r\nexport class Body extends Component {\r\n    static properties = {\r\n        corpseSpawnable: SPWN_CORPSE,\r\n    };\r\n\r\n    onDeath(evt) {\r\n        if (!this.entity.has('Position')) {\r\n            return;\r\n        }\r\n\r\n        const pos = this.entity.position.getPos();\r\n        const corpse = spawn(this.corpseSpawnable, pos.x, pos.y);\r\n\r\n        if (this.entity.has('Moniker')) {\r\n            corpse.moniker.name = `${this.entity.moniker.name} corpse`;\r\n        }\r\n    }\r\n\r\n    onProjectileHit(evt) {\r\n        evt.data.stopProjectile = true;\r\n    }\r\n}\r\n","import { Component } from 'geotic';\nimport * as GoalEvaluator from '../../ai/GoalEvaluator';\n\nexport class Goal extends Component {\n    static properties = {\n        name: 'Bored',\n        originalIntent: '<Entity>',\n        parent: '<Entity>',\n        target: '<Entity>',\n        complete: false,\n        data: {},\n    };\n\n    isFinished() {\n        return GoalEvaluator.isFinished(this.parent, this);\n    }\n\n    takeAction() {\n        return GoalEvaluator.takeAction(this.parent, this);\n    }\n}\n","import * as GoalTypes from './GoalTypes';\n\nconst goalTypeMap = {};\n\nObject.values(GoalTypes).forEach((goalType) => {\n    goalTypeMap[goalType.name] = goalType;\n});\n\nconst getGoalType = (name) => {\n    const type = goalTypeMap[name];\n\n    if (!type) {\n        console.warn(`GoalType (${name}) not found!`);\n    }\n\n    return type;\n};\n\nexport const isFinished = (entity, goal) => {\n    const type = getGoalType(goal.name);\n\n    return type.isFinished(entity, goal);\n};\n\nexport const takeAction = (entity, goal) => {\n    const type = getGoalType(goal.name);\n\n    return type.takeAction(entity, goal);\n};\n","import { Component } from 'geotic';\nimport { Door } from './Door';\nimport { LiquidContainer } from './LiquidContainer';\nimport { Stackable } from './Stackable';\n\nexport class Moniker extends Component {\n    static properties = {\n        name: 'Unknown',\n    };\n\n    get simpleDisplay() {\n        return this.name;\n    }\n\n    get display() {\n        const hasLiquid = this.entity.has(LiquidContainer);\n\n        if (hasLiquid) {\n            const disp = this.entity.liquidContainer.display;\n\n            return `${this.name} ${disp}`;\n        }\n\n        const hasStackable = this.entity.has(Stackable);\n\n        if (hasStackable) {\n            const disp = this.entity.stackable.display;\n\n            return `${this.name} ${disp}`;\n        }\n\n        const hasDoor = this.entity.has(Door);\n\n        if (hasDoor) {\n            const disp = this.entity.door.display;\n\n            return `${this.name} ${disp}`;\n        }\n\n        return this.name;\n    }\n}\n","import { Component } from 'geotic';\nimport { Moniker } from './Moniker';\n\nexport class Logger extends Component {\n    get moniker() {\n        return this.entity.has(Moniker)\n            ? this.entity.moniker.display\n            : 'Unknown';\n    }\n\n    onLog(evt) {\n        console.log(`[${this.moniker}]`, evt.data);\n        evt.handle();\n    }\n}\n","import { Component } from 'geotic';\r\nimport { game } from '../../core/Game';\r\n\r\nexport class Position extends Component {\r\n    static properties = {\r\n        chunkId: 0,\r\n    };\r\n\r\n    getPos() {\r\n        return game.map.getPosition(this.entity.id, this.chunkId);\r\n    }\r\n\r\n    setPos(x, y) {\r\n        return game.map.setPosition(x, y, this.entity.id, this.chunkId);\r\n    }\r\n\r\n    equals(x, y) {\r\n        const pos = this.getPos();\r\n\r\n        return pos.x === x && pos.y === y;\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport { LiquidContainer } from './LiquidContainer';\r\n\r\nexport class Glyph extends Component {\r\n    static properties = {\r\n        fg1: '#ddd',\r\n        fg2: '#666',\r\n        bg: null,\r\n        ch: '?',\r\n        z: 1000,\r\n    };\r\n\r\n    get primary() {\r\n        if (this.entity.has(LiquidContainer)) {\r\n            const col = this.entity.liquidContainer.primaryColorOverride;\r\n\r\n            if (col) {\r\n                return col;\r\n            }\r\n        }\r\n\r\n        return this.fg1;\r\n    }\r\n\r\n    get secondary() {\r\n        if (this.entity.has(LiquidContainer)) {\r\n            const col = this.entity.liquidContainer.secondaryColorOverride;\r\n\r\n            if (col) {\r\n                return col;\r\n            }\r\n        }\r\n\r\n        return this.fg2;\r\n    }\r\n\r\n    get background() {\r\n        return this.bg;\r\n    }\r\n\r\n    get char() {\r\n        return this.ch;\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport { game } from '../../core/Game';\r\nimport { SKILL_SPEED, getSkillValue } from '../../data/Skills';\r\nimport { Blocker } from './Blocker';\r\n\r\nexport class Motor extends Component {\r\n    onTryMove(evt) {\r\n        const position = this.entity.position.getPos();\r\n        const targetX = position.x + evt.data.x;\r\n        const targetY = position.y + evt.data.y;\r\n\r\n        const targetTileEntities = game.map.getEntitiesAt(targetX, targetY);\r\n\r\n        if (targetTileEntities.some((entity) => entity.has(Blocker))) {\r\n            return;\r\n        }\r\n\r\n        const nonHostile = targetTileEntities.find((entity) => {\r\n            return (\r\n                entity.factionMember &&\r\n                !game.factions.areEntitiesHostile(entity, this.entity)\r\n            );\r\n        });\r\n\r\n        // swap locations\r\n        if (nonHostile) {\r\n            nonHostile.position.setPos(position.x, position.y);\r\n        }\r\n\r\n        const speed = getSkillValue(SKILL_SPEED, this.entity);\r\n        const cost = (20 / (20 + speed)) * 1000;\r\n\r\n        this.entity.fireEvent('energy-consumed', cost);\r\n        this.entity.position.setPos(targetX, targetY);\r\n\r\n        evt.handle();\r\n    }\r\n}\r\n","import { Component } from 'geotic';\n\nexport class IsPlayer extends Component {}\n","import { Component } from 'geotic';\r\nimport { MoveGoalType } from '../../ai/GoalTypes';\r\nimport { directionDelta } from '../../enums/Directions';\r\n\r\nexport class Wandering extends Component {\r\n    onBoredom(evt) {\r\n        if (Math.random() > 0.5) {\r\n            return;\r\n        }\r\n\r\n        const direction = Math.floor(Math.random() * 9);\r\n        const delta = directionDelta(direction);\r\n\r\n        evt.data.goal = MoveGoalType.create({\r\n            data: delta,\r\n        });\r\n        evt.handle();\r\n    }\r\n}\r\n","const directions = [\r\n    {\r\n        key: 0,\r\n        shortName: 'NW',\r\n        fullName: 'Northwest',\r\n        delta: {\r\n            x: -1,\r\n            y: -1,\r\n        },\r\n    },\r\n    {\r\n        key: 1,\r\n        shortName: 'N',\r\n        fullName: 'North',\r\n        delta: {\r\n            x: 0,\r\n            y: -1,\r\n        },\r\n    },\r\n    {\r\n        key: 2,\r\n        shortName: 'NE',\r\n        fullName: 'Northeast',\r\n        delta: {\r\n            x: 1,\r\n            y: -1,\r\n        },\r\n    },\r\n    {\r\n        key: 3,\r\n        shortName: 'W',\r\n        fullName: 'West',\r\n        delta: {\r\n            x: -1,\r\n            y: 0,\r\n        },\r\n    },\r\n    {\r\n        key: 4,\r\n        shortName: 'Z',\r\n        fullName: 'Here',\r\n        delta: {\r\n            x: 0,\r\n            y: 0,\r\n        },\r\n        adjacent: [],\r\n    },\r\n    {\r\n        key: 5,\r\n        shortName: 'E',\r\n        fullName: 'East',\r\n        delta: {\r\n            x: 1,\r\n            y: 0,\r\n        },\r\n    },\r\n    {\r\n        key: 6,\r\n        shortName: 'SW',\r\n        fullName: 'Southwest',\r\n        delta: {\r\n            x: -1,\r\n            y: 1,\r\n        },\r\n    },\r\n    {\r\n        key: 7,\r\n        shortName: 'S',\r\n        fullName: 'South',\r\n        delta: {\r\n            x: 0,\r\n            y: 1,\r\n        },\r\n    },\r\n    {\r\n        key: 8,\r\n        shortName: 'SE',\r\n        fullName: 'Southeast',\r\n        delta: {\r\n            x: 1,\r\n            y: 1,\r\n        },\r\n    },\r\n];\r\n\r\nexport const DIR_NW = 0;\r\nexport const DIR_N = 1;\r\nexport const DIR_NE = 2;\r\nexport const DIR_W = 3;\r\nexport const DIR_Z = 4;\r\nexport const DIR_E = 5;\r\nexport const DIR_SW = 6;\r\nexport const DIR_S = 7;\r\nexport const DIR_SE = 8;\r\n\r\ndirections[DIR_NW].adjacent = [DIR_N, DIR_W];\r\ndirections[DIR_N].adjacent = [DIR_NW, DIR_NE];\r\ndirections[DIR_NE].adjacent = [DIR_N, DIR_E];\r\ndirections[DIR_W].adjacent = [DIR_NW, DIR_SW];\r\ndirections[DIR_E].adjacent = [DIR_NE, DIR_SE];\r\ndirections[DIR_SW].adjacent = [DIR_W, DIR_S];\r\ndirections[DIR_S].adjacent = [DIR_SW, DIR_SE];\r\ndirections[DIR_SE].adjacent = [DIR_S, DIR_E];\r\n\r\nexport const allDirections = () => [\r\n    DIR_NW,\r\n    DIR_N,\r\n    DIR_NE,\r\n    DIR_W,\r\n    DIR_E,\r\n    DIR_SW,\r\n    DIR_S,\r\n    DIR_SE,\r\n];\r\n\r\nexport const shortName = (direction) => directions[direction].shortName;\r\n\r\nexport const fullName = (direction) => directions[direction].fullName;\r\n\r\nexport const directionDelta = (direction) => directions[direction].delta;\r\n\r\nexport const adjacent = (direction) => directions[direction].adjacent;\r\n\r\nexport const getAdjacentDeltas = (direction) =>\r\n    adjacent(direction).map(directionDelta);\r\n\r\nexport const directionFromDelta = (x, y) => {\r\n    return Object.values(directions).find((dir) => {\r\n        return dir.delta.x === x && dir.delta.y === y;\r\n    });\r\n};\r\n","import { Component } from 'geotic';\n\nexport class IsVisible extends Component {\n    static properties = {\n        amount: 0,\n        range: 0,\n    };\n}\n","import { Component } from 'geotic';\n\nexport class Explorable extends Component {}\n","import { Component } from 'geotic';\n\nexport class Explored extends Component {}\n","import { Component } from 'geotic';\r\nimport { game } from '../../core/Game';\r\nimport {\r\n    SKILL_ARMOR,\r\n    SKILL_DODGE,\r\n    getSkillValue,\r\n    SKILL_HEALTH,\r\n} from '../../data/Skills';\r\nimport { getArmorBlockPercent } from '../../data/skills/ArmorSkill';\r\nimport { getDodgePercent } from '../../data/skills/DodgeSkill';\r\nimport {\r\n    CONSOLE_EVENT_DAMAGE,\r\n    CONSOLE_EVENT_DEAD,\r\n    CONSOLE_EVENT_MISS,\r\n} from '../../enums/ConsoleEvents';\r\nimport { randomInt } from '../../utils/rand';\r\nimport { IsDead } from './IsDead';\r\n\r\nexport class Health extends Component {\r\n    static properties = {\r\n        value: 20,\r\n    };\r\n\r\n    get max() {\r\n        const level = this.entity.level.level;\r\n        const skill = getSkillValue(SKILL_HEALTH, this.entity);\r\n\r\n        return 32 + level * 8 + skill * 4;\r\n    }\r\n\r\n    onSpawned() {\r\n        this.value = this.max;\r\n    }\r\n\r\n    applyDamage(damage) {\r\n        this.value -= damage;\r\n\r\n        if (this.value <= 0) {\r\n            this.value = 0;\r\n            this.entity.add(IsDead);\r\n\r\n            return true;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    onAttacked(evt) {\r\n        const attack = evt.data.attack;\r\n        const attacker = attack.attacker;\r\n        const defender = attack.defender;\r\n        const dodge = getSkillValue(SKILL_DODGE, defender);\r\n        const dodgePrcnt = getDodgePercent(dodge);\r\n\r\n        if (!attack.ignoreDodge && randomInt(1, 100) <= dodgePrcnt) {\r\n            game.console.event(CONSOLE_EVENT_MISS, {\r\n                defender,\r\n                attacker,\r\n                dodgePrcnt,\r\n            });\r\n\r\n            evt.data.damage = 0;\r\n            evt.data.isDodged = true;\r\n            evt.data.isKilled = false;\r\n            evt.handle();\r\n\r\n            return;\r\n        }\r\n\r\n        evt.data.isDodged = false;\r\n\r\n        const armor = getSkillValue(SKILL_ARMOR, defender);\r\n        const armorPrcnt = getArmorBlockPercent(armor);\r\n        const blocked = Math.floor(attack.damage * armorPrcnt);\r\n        const damage = Math.max(0, attack.damage - blocked);\r\n        evt.data.damage = damage;\r\n\r\n        const isKilled = this.applyDamage(damage);\r\n        evt.data.isKilled = isKilled;\r\n\r\n        if (isKilled) {\r\n            game.console.event(CONSOLE_EVENT_DEAD, {\r\n                target: defender,\r\n                source: attacker,\r\n                damage,\r\n                damageType: attack.damageType,\r\n            });\r\n\r\n            attacker.fireEvent('enemy-killed', {\r\n                enemy: defender,\r\n            });\r\n\r\n            evt.handle();\r\n\r\n            return;\r\n        }\r\n\r\n        game.console.event(CONSOLE_EVENT_DAMAGE, {\r\n            target: defender,\r\n            source: attacker,\r\n            damage,\r\n            damageType: attack.damageType,\r\n            blocked,\r\n        });\r\n\r\n        const pos = this.entity.position.getPos();\r\n\r\n        game.particles.createParticle(pos.x, pos.y, {\r\n            lifetime: 140,\r\n            fg1s: ['#8d4c4f', '#730d14'],\r\n            glyphs: ['*'],\r\n        });\r\n\r\n        evt.handle();\r\n    }\r\n\r\n    onHeal(evt) {\r\n        this.value += evt.data.value;\r\n\r\n        if (this.value > this.max) {\r\n            this.value = this.max;\r\n        }\r\n\r\n        evt.handle();\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\n\r\nexport class IsDead extends Component {}\r\n","import { Component } from 'geotic';\r\nimport { getFactionByName } from '../../enums/Factions';\r\n\r\nexport class FactionMember extends Component {\r\n    static properties = {\r\n        name: 'Neutral',\r\n    };\r\n\r\n    get faction() {\r\n        return getFactionByName(this.name);\r\n    }\r\n}\r\n","import Faction from '../data/Faction';\r\n\r\nexport const FACTION_PLAYER = 0;\r\nexport const FACTION_VILLAGER = 1;\r\nexport const FACTION_GOBLIN = 2;\r\nexport const FACTION_BEAR = 3;\r\nexport const FACTION_SERPENT = 4;\r\n\r\nexport const factions = {\r\n    player: new Faction({\r\n        id: FACTION_PLAYER,\r\n        name: 'player',\r\n        display: 'Player',\r\n    }),\r\n    villager: new Faction({\r\n        id: FACTION_VILLAGER,\r\n        name: 'villager',\r\n        display: 'Villager',\r\n    }),\r\n    goblin: new Faction({\r\n        id: FACTION_GOBLIN,\r\n        name: 'goblin',\r\n        display: 'Goblin',\r\n    }),\r\n    serpent: new Faction({\r\n        id: FACTION_SERPENT,\r\n        name: 'serpent',\r\n        display: 'Serpent',\r\n    }),\r\n    bear: new Faction({\r\n        id: FACTION_BEAR,\r\n        name: 'bear',\r\n        display: 'Bear',\r\n    }),\r\n};\r\n\r\nexport const getFactionByName = (name) => factions[name];\r\n","export default class Faction {\r\n    id = 0;\r\n    name = 'faction';\r\n    display = 'Faction';\r\n\r\n    constructor(properties) {\r\n        this.id = properties.id;\r\n        this.name = properties.name;\r\n        this.display = properties.display;\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport { game } from '../../core/Game';\r\nimport { bresenhamLine } from '../../utils/BresenhamLine';\r\nimport { Shadowcaster } from './Shadowcaster';\r\n\r\nexport class Eyes extends Component {\r\n    static properties = {\r\n        range: 5,\r\n    };\r\n\r\n    canSee(entity) {\r\n        const start = this.entity.position.getPos();\r\n        const end = entity.position.getPos();\r\n\r\n        const line = bresenhamLine(start.x, start.y, end.x, end.y);\r\n\r\n        if (line.length > this.range) {\r\n            return false;\r\n        }\r\n\r\n        return !line.some((segment) => {\r\n            return game.map\r\n                .getEntitiesAt(segment.x, segment.y)\r\n                .some((entity) => entity.has(Shadowcaster));\r\n        });\r\n    }\r\n\r\n    onTryDetectHostiles(evt) {\r\n        const position = game.map.getPosition(this.entity.id);\r\n\r\n        if (!position) {\r\n            return;\r\n        }\r\n\r\n        // get within square area\r\n        const targets = game.map\r\n            .getEntitiesInRange(position.x, position.y, this.range)\r\n            .filter((e) => {\r\n                if (!e.actor) {\r\n                    return false;\r\n                }\r\n                if (e.isDead) {\r\n                    return false;\r\n                }\r\n                if (!game.factions.areEntitiesHostile(this.entity, e)) {\r\n                    return false;\r\n                }\r\n\r\n                return this.canSee(e);\r\n            });\r\n\r\n        if (targets.length > 0) {\r\n            targets.forEach((e) => {\r\n                evt.data.targets.add(e);\r\n            });\r\n            evt.handle();\r\n        }\r\n    }\r\n}\r\n","import { Component } from 'geotic';\n\nexport class Particle extends Component {\n    static properties = {\n        lifetime: 200,\n        fg1s: ['#8d4c4f', '#730d14'],\n        fg2s: [],\n        bgs: [],\n        glyphs: [''],\n        speed: 0.05,\n        age: 0,\n        x: 0,\n        y: 0,\n        startX: 0,\n        startY: 0,\n        direction: {\n            x: 0,\n            y: 0,\n        },\n    };\n\n    get isExpired() {\n        return this.age >= this.lifetime;\n    }\n\n    get percent() {\n        return this.age / this.lifetime;\n    }\n\n    frame(arr = []) {\n        const len = arr.length;\n        const chunks = 1 / len;\n\n        return Math.trunc(this.percent / chunks);\n    }\n\n    get glyph() {\n        const frame = this.frame(this.glyphs);\n\n        return this.glyphs[frame];\n    }\n\n    get fg1() {\n        const frame = this.frame(this.fg1s);\n\n        return this.fg1s[frame];\n    }\n\n    get fg2() {\n        const frame = this.frame(this.fg2s);\n\n        return this.fg2s[frame];\n    }\n\n    get bg() {\n        const frame = this.frame(this.bgs);\n\n        return this.bgs[frame];\n    }\n}\n","import { Component } from 'geotic';\r\nimport { Particle } from './Particle';\r\n\r\nexport class ParticleEmitter extends Component {\r\n    static properties = {\r\n        particleData: {},\r\n        duration: 800,\r\n        rate: 2,\r\n        age: 0,\r\n        x: 0,\r\n        y: 0,\r\n        count: 0,\r\n    };\r\n\r\n    get isExpired() {\r\n        return this.age >= this.duration;\r\n    }\r\n\r\n    get percent() {\r\n        return this.age / this.duration;\r\n    }\r\n\r\n    createParticle() {\r\n        const particle = this.ecs.createEntity();\r\n\r\n        particle.add(Particle, {\r\n            ...this.particleData,\r\n            x: this.x,\r\n            y: this.y,\r\n        });\r\n\r\n        this.count += 1;\r\n\r\n        return particle;\r\n    }\r\n\r\n    frame(arr = []) {\r\n        const len = arr.length;\r\n        const chunks = 1 / len;\r\n\r\n        return Math.trunc(this.percent / chunks);\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport { spawnLoot } from '../../data/tables/LootSpawn';\r\n\r\nexport class LootDropper extends Component {\r\n    static properties = {\r\n        tables: [],\r\n    };\r\n\r\n    onDeath(evt) {\r\n        const pos = this.entity.position.getPos();\r\n\r\n        spawnLoot(this.tables, pos.x, pos.y);\r\n    }\r\n}\r\n","import WeightedTable from '../../utils/WeightedTable';\r\nimport { spawn } from '../Spawner';\r\nimport LootTableGoblin from './loot/LootTableGoblin';\r\nimport LootTableForest from './loot/LootTableForest';\r\nimport LootTableBruiser from './loot/LootTableBruiser';\r\n\r\nconst tables = {\r\n    TBL_LOOT_GOBLIN: LootTableGoblin,\r\n    TBL_LOOT_FOREST: LootTableForest,\r\n    TBL_LOOT_BRUISER: LootTableBruiser,\r\n};\r\n\r\nexport const getTable = (tableKey) => tables[tableKey];\r\n\r\nexport const pickLoot = (tableKeys = []) => {\r\n    const tables = tableKeys.map(getTable);\r\n    const table = WeightedTable.combine(tables);\r\n\r\n    return table.pick();\r\n};\r\n\r\nexport const spawnLoot = (tableKeys = [], x, y) => {\r\n    const spawnable = pickLoot(tableKeys);\r\n\r\n    return spawn(spawnable, x, y);\r\n};\r\n","import { randomInt } from './rand';\r\n\r\nexport default class WeightedTable {\r\n    rows = [];\r\n\r\n    get sum() {\r\n        return this.rows.reduce((sum, cur) => sum + cur.weight, 0);\r\n    }\r\n\r\n    pick() {\r\n        const r = randomInt(0, this.sum);\r\n\r\n        let currentW = 0;\r\n        const row = this.rows.find((row) => {\r\n            currentW += row.weight;\r\n\r\n            return currentW >= r;\r\n        });\r\n\r\n        if (row) {\r\n            return row.value;\r\n        }\r\n    }\r\n\r\n    chance(value) {\r\n        const row = this.get(value);\r\n\r\n        if (!row) {\r\n            return 0;\r\n        }\r\n\r\n        return row.weight / this.sum;\r\n    }\r\n\r\n    get(value) {\r\n        return this.rows.find((row) => row.value === value);\r\n    }\r\n\r\n    add(weight, value) {\r\n        const existing = this.get(value);\r\n\r\n        if (!existing) {\r\n            this.rows.push({\r\n                weight,\r\n                value,\r\n            });\r\n        } else {\r\n            // take maximum weight\r\n            const maxWeight = Math.max(existing.weight, weight);\r\n\r\n            existing.weight = maxWeight;\r\n        }\r\n\r\n        this.rows.sort((a, b) => a.weight - b.weight);\r\n    }\r\n\r\n    static combine(tables = []) {\r\n        const table = new WeightedTable();\r\n\r\n        tables.forEach((other) => {\r\n            other.rows.forEach((row) => table.add(row.weight, row.value));\r\n        });\r\n\r\n        return table;\r\n    }\r\n}\r\n","import WeightedTable from '../../../utils/WeightedTable';\r\nimport {\r\n    SPWN_AMULET,\r\n    SPWN_CLOTH_ARMOR,\r\n    SPWN_SHORTSWORD,\r\n    SPWN_STONE,\r\n    SPWN_VIAL_HONEY,\r\n} from '../../Spawnables';\r\n\r\nconst goblins = new WeightedTable();\r\n\r\ngoblins.add(3, SPWN_STONE);\r\ngoblins.add(2, SPWN_VIAL_HONEY);\r\ngoblins.add(5, SPWN_AMULET);\r\ngoblins.add(4, SPWN_CLOTH_ARMOR);\r\ngoblins.add(6, SPWN_SHORTSWORD);\r\n\r\nexport default goblins;\r\n","import WeightedTable from '../../../utils/WeightedTable';\r\nimport { SPWN_STONE, SPWN_VIAL_HONEY } from '../../Spawnables';\r\n\r\nconst forest = new WeightedTable();\r\n\r\nforest.add(3, SPWN_STONE);\r\nforest.add(2, SPWN_VIAL_HONEY);\r\n\r\nexport default forest;\r\n","import WeightedTable from '../../../utils/WeightedTable';\r\nimport { SPWN_VIAL_HONEY, SPWN_WOOD_CLUB } from '../../Spawnables';\r\n\r\nconst bruiser = new WeightedTable();\r\n\r\nbruiser.add(10, SPWN_WOOD_CLUB);\r\nbruiser.add(5, SPWN_VIAL_HONEY);\r\n\r\nexport default bruiser;\r\n","import { Component } from 'geotic';\r\n\r\nexport class IsEquipped extends Component {\r\n    static properties = {\r\n        slotKey: '',\r\n        owner: '<Entity>',\r\n    };\r\n\r\n    get slot() {\r\n        return this.owner.equipmentSlot[this.slotKey];\r\n    }\r\n\r\n    onDropped(evt) {\r\n        this.slot.unequip();\r\n    }\r\n\r\n    onThrown(evt) {\r\n        this.slot.unequip();\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport { game } from '../../core/Game';\r\nimport { SCREEN_LIST_SELECT } from '../../core/screens/ScreenType';\r\nimport { EQ_SLOT_BODY } from '../../data/EquipmentSlotType';\r\nimport { IsEquipped } from './IsEquipped';\r\n\r\nexport class Equipment extends Component {\r\n    static properties = {\r\n        slotTypes: [EQ_SLOT_BODY],\r\n    };\r\n\r\n    onTryEquip(evt) {\r\n        const slots = Object.values(evt.data.interactor.equipmentSlot).filter(\r\n            (slot) => {\r\n                return this.slotTypes.includes(slot.slotType);\r\n            }\r\n        );\r\n\r\n        game.screens.pushScreen(SCREEN_LIST_SELECT, {\r\n            header: this.entity.moniker.display,\r\n            icon: this.entity.glyph,\r\n            leadText: 'Select a slot',\r\n            list: slots,\r\n            onRenderRow: (slot, x, y, isSelected) => {\r\n                let text = slot.name;\r\n\r\n                if (!slot.isEmpty) {\r\n                    text += ` [${slot.content.moniker.display}]`;\r\n                }\r\n\r\n                if (isSelected) {\r\n                    game.renderer.drawText(x, y, ` ${text}`, 'yellow');\r\n                } else {\r\n                    game.renderer.drawText(x, y, `- ${text}`);\r\n                }\r\n            },\r\n            onSelect: (slot) => {\r\n                slot.unequip();\r\n                slot.equip(this.entity);\r\n                evt.data.interactor.fireEvent('energy-consumed', 200);\r\n                evt.handle();\r\n                game.screens.popScreen();\r\n            },\r\n        });\r\n    }\r\n\r\n    onTryUnequip(evt) {\r\n        const slotKey = this.entity.isEquipped.slotKey;\r\n        const slot = evt.data.interactor.equipmentSlot[slotKey];\r\n\r\n        if (slot) {\r\n            slot.content = null;\r\n        }\r\n\r\n        evt.data.interactor.fireEvent('energy-consumed', 200);\r\n\r\n        this.entity.isEquipped.destroy();\r\n        evt.handle();\r\n    }\r\n\r\n    onGetInteractions(evt) {\r\n        if (this.entity.has(IsEquipped)) {\r\n            evt.data.interactions.push({\r\n                name: `Unequip [${this.entity.isEquipped.slot.name}]`,\r\n                evt: 'try-unequip',\r\n            });\r\n        } else {\r\n            evt.data.interactions.push({\r\n                name: 'Equip',\r\n                evt: 'try-equip',\r\n            });\r\n        }\r\n    }\r\n}\r\n","export const EQ_SLOT_HEAD = 'EQ_SLOT_HEAD';\r\nexport const EQ_SLOT_FACE = 'EQ_SLOT_FACE';\r\nexport const EQ_SLOT_NECK = 'EQ_SLOT_NECK';\r\nexport const EQ_SLOT_BODY = 'EQ_SLOT_BODY';\r\nexport const EQ_SLOT_FEET = 'EQ_SLOT_FEET';\r\nexport const EQ_SLOT_ARM = 'EQ_SLOT_ARM';\r\nexport const EQ_SLOT_HAND = 'EQ_SLOT_HAND';\r\nexport const EQ_SLOT_TAIL = 'EQ_SLOT_TAIL';\r\n","import { Component } from 'geotic';\r\nimport { game } from '../../core/Game';\r\nimport { EQ_SLOT_BODY } from '../../data/EquipmentSlotType';\r\nimport { getWeaponType } from '../../data/WeaponTypes';\r\nimport { IsEquipped } from './IsEquipped';\r\n\r\nexport class EquipmentSlot extends Component {\r\n    static allowMultiple = true;\r\n    static keyProperty = 'key';\r\n    static properties = {\r\n        name: 'Body',\r\n        key: 'body',\r\n        slotType: EQ_SLOT_BODY,\r\n        content: '<Entity>',\r\n        isPrimary: false,\r\n        defaultWpnType: null,\r\n    };\r\n\r\n    get isEmpty() {\r\n        return !this.content;\r\n    }\r\n\r\n    onDestroyed() {\r\n        if (!this.isEmpty) {\r\n            this.content.destroy();\r\n        }\r\n    }\r\n\r\n    unequip() {\r\n        if (this.isEmpty) {\r\n            return false;\r\n        }\r\n\r\n        const content = this.content;\r\n\r\n        this.content = null;\r\n\r\n        content.isEquipped.destroy();\r\n        content.fireEvent('unequipped', {\r\n            interactor: this.entity,\r\n        });\r\n    }\r\n\r\n    equip(equipment) {\r\n        equipment.loot.take(this.entity);\r\n\r\n        equipment.add(IsEquipped, {\r\n            slotKey: this.key,\r\n            owner: this.entity,\r\n        });\r\n\r\n        this.content = equipment;\r\n\r\n        equipment.fireEvent('equipped', {\r\n            interactor: this.entity,\r\n        });\r\n    }\r\n\r\n    doMeleeAttack(target) {\r\n        if (this.isEmpty) {\r\n            if (this.defaultWpnType) {\r\n                const weaponType = getWeaponType(this.defaultWpnType);\r\n\r\n                weaponType.attack(this.entity, target);\r\n\r\n                this.entity.fireEvent('energy-consumed', 600);\r\n\r\n                return true;\r\n            }\r\n        } else {\r\n            const itemMelee = this.content.fireEvent('try-use-melee', {\r\n                interactor: this.entity,\r\n                target,\r\n            });\r\n\r\n            return itemMelee.data.success;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    doOffhandAttack(target) {\r\n        if (this.isEmpty) {\r\n            if (this.defaultWpnType) {\r\n                const weaponType = getWeaponType(this.defaultWpnType);\r\n\r\n                weaponType.offhandAttack(this.entity, target);\r\n\r\n                return true;\r\n            }\r\n        } else {\r\n            const itemMelee = this.content.fireEvent('try-use-melee-offhand', {\r\n                interactor: this.entity,\r\n                target,\r\n            });\r\n\r\n            return itemMelee.data.success;\r\n        }\r\n\r\n        return false;\r\n    }\r\n\r\n    onTryMelee(evt) {\r\n        const targetPos = evt.data.target.position.getPos();\r\n        const selfPos = this.entity.position.getPos();\r\n        const isAdjacent = game.map.isAdjacent(\r\n            selfPos.x,\r\n            selfPos.y,\r\n            targetPos.x,\r\n            targetPos.y\r\n        );\r\n\r\n        if (!isAdjacent) {\r\n            return;\r\n        }\r\n\r\n        if (this.isPrimary) {\r\n            if (this.doMeleeAttack(evt.data.target)) {\r\n                evt.data.success = true;\r\n            }\r\n        } else {\r\n            this.doOffhandAttack(evt.data.target);\r\n        }\r\n    }\r\n\r\n    onQuerySkillMod(evt) {\r\n        if (this.isEmpty) {\r\n            return;\r\n        }\r\n\r\n        this.content.fireEvent(`query-skill-mod-equipped`, {\r\n            skill: evt.data.skill,\r\n            modifiers: evt.data.modifiers,\r\n        });\r\n    }\r\n}\r\n","import {\r\n    DMG_TYPE_BLUDGEONING,\r\n    DMG_TYPE_PIERCING,\r\n    DMG_TYPE_SLASHING,\r\n} from './DamageTypes';\r\nimport {\r\n    WPN_FAMILY_AXE,\r\n    WPN_FAMILY_BLADE,\r\n    WPN_FAMILY_HAMMER,\r\n    WPN_FAMILY_POLEARM,\r\n} from './WeaponFamilies';\r\nimport WpnTypeBattleAxe from './weapons/WpnTypeBattleAxe';\r\nimport WpnTypeFangs from './weapons/WpnTypeFangs';\r\nimport WpnTypeClaw from './weapons/WpnTypeClaw';\r\nimport WpnTypeGreatsword from './weapons/WpnTypeGreatsword';\r\nimport WpnTypeMace from './weapons/WpnTypeMace';\r\nimport WpnTypeShortsword from './weapons/WpnTypeShortsword';\r\nimport WpnTypeUnarmed from './weapons/WpnTypeUnarmed';\r\n\r\n// hammer family\r\nexport const WPN_TYPE_WAR_HAMMER = 'WPN_TYPE_WAR_HAMMER';\r\nexport const WPN_TYPE_SLEDGE_HAMMER = 'WPN_TYPE_SLEDGE_HAMMER';\r\n// cudgel family\r\nexport const WPN_TYPE_CLUB = 'WPN_TYPE_CLUB';\r\nexport const WPN_TYPE_MACE = 'WPN_TYPE_MACE';\r\n// axe family\r\nexport const WPN_TYPE_HEAVY_AXE = 'WPN_TYPE_HEAVY_AXE';\r\nexport const WPN_TYPE_BATTLE_AXE = 'WPN_TYPE_BATTLE_AXE';\r\n// blade family\r\nexport const WPN_TYPE_GREATSWORD = 'WPN_TYPE_GREATSWORD';\r\nexport const WPN_TYPE_SHORTSWORD = 'WPN_TYPE_SHORTSWORD';\r\nexport const WPN_TYPE_DAGGER = 'WPN_TYPE_DAGGER';\r\n// polearm family\r\nexport const WPN_TYPE_STAFF = 'WPN_TYPE_STAFF';\r\nexport const WPN_TYPE_HALBERD = 'WPN_TYPE_HALBERD';\r\nexport const WPN_TYPE_JAVELIN = 'WPN_TYPE_JAVELIN';\r\n// unarmed family\r\nexport const WPN_TYPE_UNARMED = 'WPN_TYPE_UNARMED';\r\nexport const WPN_TYPE_FANGS = 'WPN_TYPE_FANGS';\r\nexport const WPN_TYPE_CLAW = 'WPN_TYPE_CLAW';\r\n\r\nconst lookup = {\r\n    [WPN_TYPE_UNARMED]: new WpnTypeUnarmed(),\r\n    [WPN_TYPE_FANGS]: new WpnTypeFangs(),\r\n    [WPN_TYPE_CLAW]: new WpnTypeClaw(),\r\n    [WPN_TYPE_WAR_HAMMER]: {\r\n        name: 'War hammer',\r\n        family: WPN_FAMILY_HAMMER,\r\n        key: WPN_TYPE_WAR_HAMMER,\r\n        damageType: DMG_TYPE_BLUDGEONING,\r\n    },\r\n    [WPN_TYPE_SLEDGE_HAMMER]: {\r\n        name: 'Sledge hammer',\r\n        family: WPN_FAMILY_HAMMER,\r\n        key: WPN_TYPE_SLEDGE_HAMMER,\r\n        damageType: DMG_TYPE_BLUDGEONING,\r\n    },\r\n    [WPN_TYPE_CLUB]: {\r\n        name: 'Club',\r\n        family: WPN_FAMILY_HAMMER,\r\n        key: WPN_TYPE_CLUB,\r\n        damageType: DMG_TYPE_BLUDGEONING,\r\n    },\r\n    [WPN_TYPE_MACE]: {\r\n        name: 'Mace',\r\n        family: WPN_FAMILY_HAMMER,\r\n        key: WPN_TYPE_MACE,\r\n        damageType: DMG_TYPE_BLUDGEONING,\r\n    },\r\n    [WPN_TYPE_HEAVY_AXE]: {\r\n        name: 'Heavy axe',\r\n        family: WPN_FAMILY_AXE,\r\n        key: WPN_TYPE_HEAVY_AXE,\r\n        damageType: DMG_TYPE_SLASHING,\r\n    },\r\n    [WPN_TYPE_BATTLE_AXE]: new WpnTypeBattleAxe(),\r\n    [WPN_TYPE_GREATSWORD]: new WpnTypeGreatsword(),\r\n    [WPN_TYPE_SHORTSWORD]: new WpnTypeShortsword(),\r\n    [WPN_TYPE_MACE]: new WpnTypeMace(),\r\n    [WPN_TYPE_DAGGER]: {\r\n        name: 'Dagger',\r\n        family: WPN_FAMILY_BLADE,\r\n        key: WPN_TYPE_DAGGER,\r\n        damageType: DMG_TYPE_SLASHING,\r\n    },\r\n    [WPN_TYPE_STAFF]: {\r\n        name: 'Staff',\r\n        family: WPN_FAMILY_POLEARM,\r\n        key: WPN_TYPE_STAFF,\r\n        damageType: DMG_TYPE_BLUDGEONING,\r\n    },\r\n    [WPN_TYPE_HALBERD]: {\r\n        name: 'Halberd',\r\n        family: WPN_FAMILY_POLEARM,\r\n        key: WPN_TYPE_HALBERD,\r\n        damageType: DMG_TYPE_PIERCING,\r\n    },\r\n    [WPN_TYPE_JAVELIN]: {\r\n        name: 'Javelin',\r\n        family: WPN_FAMILY_POLEARM,\r\n        key: WPN_TYPE_JAVELIN,\r\n        damageType: DMG_TYPE_PIERCING,\r\n    },\r\n};\r\n\r\nexport const getWeaponType = (type) => lookup[type];\r\nexport const getWeaponTypeName = (type) => lookup[type].name;\r\nexport const getWeaponTypeFamily = (type) => lookup[type].family;\r\nexport const getWeaponTypeDmgType = (type) => lookup[type].damageType;\r\n","export const WPN_FAMILY_HAMMER = 'WPN_FAMILY_HAMMER';\r\nexport const WPN_FAMILY_AXE = 'WPN_FAMILY_AXE';\r\nexport const WPN_FAMILY_BLADE = 'WPN_FAMILY_BLADE';\r\nexport const WPN_FAMILY_ARCHERY = 'WPN_FAMILY_ARCHERY';\r\nexport const WPN_FAMILY_POLEARM = 'WPN_FAMILY_POLEARM';\r\nexport const WPN_FAMILY_UNARMED = 'WPN_FAMILY_UNARMED';\r\nexport const WPN_FAMILY_CUDGEL = 'WPN_FAMILY_CUDGEL';\r\n\r\nconst lookup = {\r\n    [WPN_FAMILY_HAMMER]: {\r\n        name: 'Hammer',\r\n    },\r\n    [WPN_FAMILY_AXE]: {\r\n        name: 'Axe',\r\n    },\r\n    [WPN_FAMILY_BLADE]: {\r\n        name: 'Blade',\r\n    },\r\n    [WPN_FAMILY_ARCHERY]: {\r\n        name: 'Archery',\r\n    },\r\n    [WPN_FAMILY_POLEARM]: {\r\n        name: 'Polearm',\r\n    },\r\n    [WPN_FAMILY_UNARMED]: {\r\n        name: 'Unarmed',\r\n    },\r\n    [WPN_FAMILY_CUDGEL]: {\r\n        name: 'Cudgel',\r\n    },\r\n};\r\n\r\nexport const getWeaponFamilyName = (family) => lookup[family].name;\r\n","import { randomBool } from '../../utils/rand';\r\nimport Attack from '../Attack';\r\nimport { DMG_TYPE_SLASHING } from '../DamageTypes';\r\nimport { getSkillValue, SKILL_AXE } from '../Skills';\r\nimport { WPN_FAMILY_AXE } from '../WeaponFamilies';\r\nimport { WPN_TYPE_BATTLE_AXE } from '../WeaponTypes';\r\nimport WeaponType from './WeaponType';\r\n\r\nexport default class WpnTypeBattleAxe extends WeaponType {\r\n    constructor() {\r\n        super({\r\n            key: WPN_TYPE_BATTLE_AXE,\r\n            name: 'Battle axe',\r\n            family: WPN_FAMILY_AXE,\r\n            damageType: DMG_TYPE_SLASHING,\r\n            skill: SKILL_AXE,\r\n        });\r\n    }\r\n\r\n    _createAttack(attacker, defender, weapon) {\r\n        const str = getSkillValue(this.skill, attacker);\r\n        const die = weapon.roll();\r\n        const damage = die + str;\r\n\r\n        return new Attack({\r\n            attacker,\r\n            defender,\r\n            weaponName: weapon.name,\r\n            damage,\r\n            damageType: this.damageType,\r\n        });\r\n    }\r\n\r\n    attack(attacker, defender, weapon) {\r\n        const attack = this._createAttack(attacker, defender, weapon);\r\n        const result = defender.fireEvent('attacked', { attack });\r\n        const attacks = [attack];\r\n\r\n        if (!result.data.isDodged && !result.data.isKilled && randomBool()) {\r\n            const secondAttack = this._createAttack(attacker, defender, weapon);\r\n\r\n            attacks.push(secondAttack);\r\n\r\n            defender.fireEvent('attacked', { attack });\r\n        }\r\n\r\n        return attacks;\r\n    }\r\n}\r\n","import { randomWeightedBool } from '../../utils/rand';\r\nimport { getSkillValue } from '../Skills';\r\nimport { getWeaponFamilyName } from '../WeaponFamilies';\r\n\r\nexport default class WeaponType {\r\n    constructor(data) {\r\n        this.name = data.name;\r\n        this.family = data.family;\r\n        this.key = data.key;\r\n        this.damageType = data.damageType;\r\n        this.skill = data.skill;\r\n    }\r\n\r\n    weaponDamageText(user, weapon) {\r\n        let text = `1d${weapon.die}`;\r\n        const skill = getSkillValue(this.skill, user);\r\n        const mod = weapon.modifier + skill;\r\n\r\n        if (mod) {\r\n            if (mod > 0) {\r\n                text += ` + ${mod}`;\r\n            } else {\r\n                text += ` - ${Math.abs(mod)}`;\r\n            }\r\n        }\r\n\r\n        return text;\r\n    }\r\n\r\n    getShortDescription(user, weapon) {\r\n        const fam = getWeaponFamilyName(this.family);\r\n\r\n        return `${fam}, ${this.weaponDamageText(user, weapon)}`;\r\n    }\r\n\r\n    getAttacks(attacker, defender, weapon) {\r\n        return [];\r\n    }\r\n\r\n    attack(attacker, defender, weapon) {\r\n        const attacks = this.getAttacks(attacker, defender, weapon);\r\n\r\n        return attacks.map((attack) => {\r\n            attack.defender.fireEvent('attacked', { attack });\r\n        });\r\n    }\r\n\r\n    offhandAttack(attacker, defender, weapon) {\r\n        if (randomWeightedBool(.2)) {\r\n            this.attack(attacker, defender, weapon);\r\n        }\r\n    }\r\n}\r\n","import { pickRandom, randomInt } from '../../utils/rand';\r\nimport Attack from '../Attack';\r\nimport { DMG_TYPE_PIERCING } from '../DamageTypes';\r\nimport { getSkillValue, SKILL_BRAWLING } from '../Skills';\r\nimport { WPN_FAMILY_UNARMED } from '../WeaponFamilies';\r\nimport { WPN_TYPE_FANGS } from '../WeaponTypes';\r\nimport WeaponType from './WeaponType';\r\n\r\nexport default class WpnTypeFangs extends WeaponType {\r\n    constructor() {\r\n        super({\r\n            key: WPN_TYPE_FANGS,\r\n            name: 'Fangs',\r\n            family: WPN_FAMILY_UNARMED,\r\n            damageType: DMG_TYPE_PIERCING,\r\n            skill: SKILL_BRAWLING,\r\n        });\r\n    }\r\n\r\n    getAttacks(attacker, defender, weapon) {\r\n        const skill = getSkillValue(this.skill, attacker);\r\n        const die = randomInt(1, 8);\r\n        const damage = die + skill;\r\n\r\n        return [\r\n            new Attack({\r\n                attacker,\r\n                defender,\r\n                weaponName: pickRandom(['gnaw', 'bite']),\r\n                damage,\r\n                damageType: this.damageType,\r\n            }),\r\n        ];\r\n    }\r\n}\r\n","import { pickRandom, randomInt } from '../../utils/rand';\r\nimport Attack from '../Attack';\r\nimport { DMG_TYPE_SLASHING } from '../DamageTypes';\r\nimport { getSkillValue, SKILL_BRAWLING } from '../Skills';\r\nimport { WPN_FAMILY_UNARMED } from '../WeaponFamilies';\r\nimport { WPN_TYPE_CLAW } from '../WeaponTypes';\r\nimport WeaponType from './WeaponType';\r\n\r\nexport default class WpnTypeClaw extends WeaponType {\r\n    constructor() {\r\n        super({\r\n            key: WPN_TYPE_CLAW,\r\n            name: 'Claws',\r\n            family: WPN_FAMILY_UNARMED,\r\n            damageType: DMG_TYPE_SLASHING,\r\n            skill: SKILL_BRAWLING,\r\n        });\r\n    }\r\n\r\n    getAttacks(attacker, defender, weapon) {\r\n        const skill = getSkillValue(this.skill, attacker);\r\n        const die = randomInt(1, 8);\r\n        const damage = die + skill;\r\n\r\n        return [\r\n            new Attack({\r\n                attacker,\r\n                defender,\r\n                weaponName: pickRandom(['claw']),\r\n                damage,\r\n                damageType: this.damageType,\r\n            }),\r\n        ];\r\n    }\r\n}\r\n","import { game } from '../../core/Game';\r\nimport { getAdjacentDeltas, directionFromDelta } from '../../enums/Directions';\r\nimport Attack from '../Attack';\r\nimport { DMG_TYPE_SLASHING } from '../DamageTypes';\r\nimport { getSkillValue, SKILL_BLADE } from '../Skills';\r\nimport { WPN_FAMILY_BLADE } from '../WeaponFamilies';\r\nimport { WPN_TYPE_GREATSWORD } from '../WeaponTypes';\r\nimport WeaponType from './WeaponType';\r\n\r\nexport default class WpnTypeGreatsword extends WeaponType {\r\n    constructor() {\r\n        super({\r\n            key: WPN_TYPE_GREATSWORD,\r\n            name: 'Greatsword',\r\n            family: WPN_FAMILY_BLADE,\r\n            damageType: DMG_TYPE_SLASHING,\r\n            skill: SKILL_BLADE,\r\n        });\r\n    }\r\n\r\n    _getNeighborAttacks(attacker, defender, weapon, damage) {\r\n        const attackerPos = attacker.position.getPos();\r\n        const defenderPos = defender.position.getPos();\r\n        const deltaX = defenderPos.x - attackerPos.x;\r\n        const deltaY = defenderPos.y - attackerPos.y;\r\n        const direction = directionFromDelta(deltaX, deltaY);\r\n        const adjacentDeltas = getAdjacentDeltas(direction.key);\r\n\r\n        return adjacentDeltas\r\n            .map((delta) =>\r\n                game.map.getEntitiesAt(\r\n                    attackerPos.x + delta.x,\r\n                    attackerPos.y + delta.y\r\n                )\r\n            )\r\n            .flat()\r\n            .filter((e) => game.factions.areEntitiesHostile(e, attacker))\r\n            .map((hostile) => {\r\n                return new Attack({\r\n                    attacker,\r\n                    ignoreDodge: true,\r\n                    defender: hostile,\r\n                    weaponName: weapon.name,\r\n                    damage: Math.floor(damage / 2),\r\n                    damageType: this.damageType,\r\n                });\r\n            });\r\n    }\r\n\r\n    _tryAttackDefender(attacker, defender, weapon, damage) {\r\n        const attack = new Attack({\r\n            attacker,\r\n            defender,\r\n            weaponName: weapon.name,\r\n            damage,\r\n            damageType: this.damageType,\r\n        });\r\n\r\n        return defender.fireEvent('attacked', { attack });\r\n    }\r\n\r\n    attack(attacker, defender, weapon) {\r\n        const str = getSkillValue(this.skill, attacker);\r\n        const die = weapon.roll();\r\n        const damage = die + str;\r\n        const result = this._tryAttackDefender(\r\n            attacker,\r\n            defender,\r\n            weapon,\r\n            damage\r\n        );\r\n\r\n        const attacks = [result];\r\n\r\n        if (!result.data.isDodged) {\r\n            const neighborAttacks = this._getNeighborAttacks(\r\n                attacker,\r\n                defender,\r\n                weapon,\r\n                damage\r\n            );\r\n\r\n            neighborAttacks.forEach((attack) => {\r\n                attacks.push(attack);\r\n                attack.defender.fireEvent('attacked', { attack });\r\n            });\r\n        }\r\n\r\n        return attacks;\r\n    }\r\n}\r\n","import { randomWeightedBool } from '../../utils/rand';\r\nimport Attack from '../Attack';\r\nimport { DMG_TYPE_BLUDGEONING } from '../DamageTypes';\r\nimport { getSkillValue, SKILL_CUDGEL } from '../Skills';\r\nimport { addStatus, STATUS_STUNNED } from '../Statuses';\r\nimport { WPN_FAMILY_CUDGEL } from '../WeaponFamilies';\r\nimport { WPN_TYPE_MACE } from '../WeaponTypes';\r\nimport WeaponType from './WeaponType';\r\n\r\nexport default class WpnTypeMace extends WeaponType {\r\n    constructor() {\r\n        super({\r\n            key: WPN_TYPE_MACE,\r\n            name: 'Mace',\r\n            family: WPN_FAMILY_CUDGEL,\r\n            damageType: DMG_TYPE_BLUDGEONING,\r\n            skill: SKILL_CUDGEL,\r\n        });\r\n    }\r\n\r\n    _createAttack(attacker, defender, weapon) {\r\n        const str = getSkillValue(this.skill, attacker);\r\n        const die = weapon.roll();\r\n        const damage = die + str;\r\n\r\n        return new Attack({\r\n            attacker,\r\n            defender,\r\n            weaponName: weapon.name,\r\n            damage,\r\n            damageType: this.damageType,\r\n        });\r\n    }\r\n\r\n    attack(attacker, defender, weapon) {\r\n        const attack = this._createAttack(attacker, defender, weapon);\r\n        const result = defender.fireEvent('attacked', { attack });\r\n        const attacks = [attack];\r\n\r\n        if (\r\n            !result.data.isDodged &&\r\n            !result.data.isKilled &&\r\n            randomWeightedBool(0.2)\r\n        ) {\r\n            addStatus(STATUS_STUNNED, defender, {\r\n                duration: 1000,\r\n            });\r\n        }\r\n\r\n        return attacks;\r\n    }\r\n}\r\n","import { Status } from '../ecs/components';\r\nimport StatusBleeding from './statuses/StatusBleeding';\r\nimport StatusRegeneration from './statuses/StatusRegeneration';\r\nimport StatusStunned from './statuses/StatusStunned';\r\n\r\nexport const STATUS_BLEEDING = 'STATUS_BLEEDING';\r\nexport const STATUS_STUNNED = 'STATUS_STUNNED';\r\nexport const STATUS_REGENERATION = 'STATUS_REGENERATION';\r\n\r\nconst lookup = {\r\n    STATUS_BLEEDING: new StatusBleeding(),\r\n    STATUS_STUNNED: new StatusStunned(),\r\n    STATUS_REGENERATION: new StatusRegeneration(),\r\n};\r\n\r\nexport const getStatus = (key) => lookup[key];\r\nexport const addStatus = (key, entity, properties = {}) => {\r\n    return entity.add(Status, {\r\n        ...properties,\r\n        key,\r\n    });\r\n};\r\n","import { LIQUID_BLOOD } from '../../enums/LiquidTypes';\r\nimport { STATUS_TYPE_CONDITION } from '../../enums/StatusTypes';\r\nimport { SPWN_POOL_LIQUID } from '../Spawnables';\r\nimport { spawn } from '../Spawner';\r\nimport { STATUS_BLEEDING } from '../Statuses';\r\nimport Status from './Status';\r\n\r\nexport default class StatusBleeding extends Status {\r\n    constructor() {\r\n        const glyph = {\r\n            fg1: '#f42323',\r\n            fg2: '#411010',\r\n            bg: null,\r\n            ch: 's',\r\n        };\r\n        super(STATUS_BLEEDING, 'Bleeding', STATUS_TYPE_CONDITION, glyph);\r\n        this.isDot = true;\r\n    }\r\n\r\n    getDmgPerTurn(potency) {\r\n        return 3 * potency + 0.5;\r\n    }\r\n\r\n    getPipCount(potency) {\r\n        return Math.round(2 * potency);\r\n    }\r\n\r\n    update(ticks, entity, status) {\r\n        const tick = Math.min(ticks, status.remainingLifetime());\r\n        const dmgPerTurn = this.getDmgPerTurn(status.potency);\r\n        const damage = dmgPerTurn * (tick / 1000);\r\n\r\n        entity.health.applyDamage(damage);\r\n\r\n        const position = entity.position.getPos();\r\n\r\n        spawn(SPWN_POOL_LIQUID, position.x, position.y, {\r\n            content: LIQUID_BLOOD,\r\n            volume: Math.ceil(damage * 6),\r\n        });\r\n\r\n        status.lifetime += tick;\r\n    }\r\n}\r\n","export const STATUS_TYPE_CONDITION = 'STATUS_TYPE_CONDITION';\r\nexport const STATUS_TYPE_BOON = 'STATUS_TYPE_BOON';\r\n","export default class Status {\r\n    isDot = false;\r\n\r\n    getPipCount(potency) {\r\n        return 0;\r\n    }\r\n\r\n    constructor(key, name, type, glyph) {\r\n        this.key = key;\r\n        this.name = name;\r\n        this.type = type;\r\n        this.glyph = glyph;\r\n    }\r\n}\r\n","import { STATUS_TYPE_BOON } from '../../enums/StatusTypes';\r\nimport { STATUS_REGENERATION } from '../Statuses';\r\nimport Status from './Status';\r\n\r\nexport default class StatusRegeneration extends Status {\r\n    constructor() {\r\n        const glyph = {\r\n            fg1: '#6baf70',\r\n            fg2: '#9c9432',\r\n            bg: null,\r\n            ch: '}',\r\n        };\r\n        super(STATUS_REGENERATION, 'Regeneration', STATUS_TYPE_BOON, glyph);\r\n        this.isDot = true;\r\n    }\r\n\r\n    update(ticks, entity, status) {\r\n        const tick = Math.min(ticks, status.remainingLifetime());\r\n        const hpPerTurn = 5;\r\n        const value = Math.floor(hpPerTurn * (tick / 1000));\r\n\r\n        entity.fireEvent('heal', {\r\n            value,\r\n        });\r\n\r\n        status.lifetime += tick;\r\n    }\r\n}\r\n","import { game } from '../../core/Game';\r\nimport { IsIncapacitated } from '../../ecs/components';\r\nimport { STATUS_TYPE_CONDITION } from '../../enums/StatusTypes';\r\nimport { STATUS_STUNNED } from '../Statuses';\r\nimport Status from './Status';\r\n\r\nexport default class StatusStunned extends Status {\r\n    constructor() {\r\n        const glyph = {\r\n            fg1: '#daa53a',\r\n            fg2: '#f2da97',\r\n            bg: null,\r\n            ch: '|',\r\n        };\r\n        super(STATUS_STUNNED, 'Stunned', STATUS_TYPE_CONDITION, glyph);\r\n    }\r\n\r\n    update(ticks, entity, status) {\r\n        status.lifetime += ticks;\r\n\r\n        if (!entity.isIncapacitated) {\r\n            entity.add(IsIncapacitated);\r\n\r\n            const pos = entity.position.getPos();\r\n\r\n            game.particles.createParticle(pos.x, pos.y, {\r\n                lifetime: 140,\r\n                fg1s: ['yellow'],\r\n                glyphs: ['*'],\r\n            });\r\n        }\r\n\r\n        if (status.isCompleted()) {\r\n            entity.isIncapacitated.destroy();\r\n        }\r\n    }\r\n}\r\n","import Attack from '../Attack';\r\nimport { DMG_TYPE_SLASHING } from '../DamageTypes';\r\nimport { getSkillValue, SKILL_BLADE } from '../Skills';\r\nimport { WPN_FAMILY_BLADE } from '../WeaponFamilies';\r\nimport { WPN_TYPE_SHORTSWORD } from '../WeaponTypes';\r\nimport WeaponType from './WeaponType';\r\n\r\nexport default class WpnTypeShortsword extends WeaponType {\r\n    constructor() {\r\n        super({\r\n            key: WPN_TYPE_SHORTSWORD,\r\n            name: 'Shortsword',\r\n            family: WPN_FAMILY_BLADE,\r\n            damageType: DMG_TYPE_SLASHING,\r\n            skill: SKILL_BLADE,\r\n        });\r\n    }\r\n\r\n    getAttacks(attacker, defender, weapon) {\r\n        const str = getSkillValue(this.skill, attacker);\r\n        const die = weapon.roll();\r\n        const damage = die + str;\r\n\r\n        return [\r\n            new Attack({\r\n                attacker,\r\n                defender,\r\n                weaponName: weapon.name,\r\n                damage,\r\n                damageType: this.damageType,\r\n            }),\r\n        ];\r\n    }\r\n}\r\n","import { pickRandom, randomInt } from '../../utils/rand';\r\nimport Attack from '../Attack';\r\nimport { DMG_TYPE_BLUDGEONING } from '../DamageTypes';\r\nimport { getSkillValue, SKILL_BRAWLING } from '../Skills';\r\nimport { WPN_FAMILY_UNARMED } from '../WeaponFamilies';\r\nimport { WPN_TYPE_UNARMED } from '../WeaponTypes';\r\nimport WeaponType from './WeaponType';\r\n\r\nexport default class WpnTypeUnarmed extends WeaponType {\r\n    constructor() {\r\n        super({\r\n            key: WPN_TYPE_UNARMED,\r\n            name: 'Unarmed',\r\n            family: WPN_FAMILY_UNARMED,\r\n            damageType: DMG_TYPE_BLUDGEONING,\r\n            skill: SKILL_BRAWLING,\r\n        });\r\n    }\r\n\r\n    getAttacks(attacker, defender, weapon) {\r\n        const brawling = getSkillValue(this.skill, attacker);\r\n        const die = randomInt(1, 4);\r\n        const damage = die + brawling;\r\n\r\n        return [\r\n            new Attack({\r\n                attacker,\r\n                defender,\r\n                weaponName: pickRandom(['punch', 'kick']),\r\n                damage,\r\n                damageType: this.damageType,\r\n            }),\r\n        ];\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport { capitalize } from 'rot-js/lib/util';\r\nimport {\r\n    getStatName,\r\n    STAT_ATHLETICISM,\r\n    STAT_FINESSE,\r\n    STAT_STRENGTH,\r\n    STAT_TRICKERY,\r\n    STAT_FAITH,\r\n    getStatAbbreviation,\r\n} from '../../data/Stats';\r\n\r\nexport class Stats extends Component {\r\n    static properties = {\r\n        baseStrength: 0,\r\n        baseFinesse: 0,\r\n        baseAthleticism: 0,\r\n        baseTrickery: 0,\r\n        baseFaith: 0,\r\n    };\r\n\r\n    _sumMods(modifiers) {\r\n        return modifiers.reduce((sum, cur) => sum + cur.mod, 0);\r\n    }\r\n\r\n    getStatModifiers(stat) {\r\n        const evt = this.entity.fireEvent(`query-stat-mod`, {\r\n            name: getStatName(stat),\r\n            stat,\r\n            modifiers: [],\r\n        });\r\n\r\n        return evt.data.modifiers;\r\n    }\r\n\r\n    getStatModifierSum(stat) {\r\n        const mods = this.getStatModifiers(stat);\r\n\r\n        return this._sumMods(mods);\r\n    }\r\n\r\n    data(stat) {\r\n        const name = getStatName(stat);\r\n        const abbreviation = getStatAbbreviation(stat);\r\n        const modifiers = this.getStatModifiers(stat);\r\n        const base = this[`base${capitalize(name)}`];\r\n        const modSum = this._sumMods(modifiers);\r\n        const sum = base + modSum;\r\n\r\n        return {\r\n            stat,\r\n            abbreviation,\r\n            name,\r\n            modifiers,\r\n            base,\r\n            sum,\r\n            modSum,\r\n        };\r\n    }\r\n\r\n    all() {\r\n        return {\r\n            strength: this.data(STAT_STRENGTH),\r\n            finesse: this.data(STAT_FINESSE),\r\n            athleticism: this.data(STAT_ATHLETICISM),\r\n            trickery: this.data(STAT_TRICKERY),\r\n            faith: this.data(STAT_FAITH),\r\n        };\r\n    }\r\n\r\n    strength() {\r\n        const mod = this.getStatModifierSum(STAT_STRENGTH);\r\n\r\n        return this.baseStrength + mod;\r\n    }\r\n\r\n    finesse() {\r\n        const mod = this.getStatModifierSum(STAT_FINESSE);\r\n\r\n        return this.baseFinesse + mod;\r\n    }\r\n\r\n    athleticism() {\r\n        const mod = this.getStatModifierSum(STAT_ATHLETICISM);\r\n\r\n        return this.baseAthleticism + mod;\r\n    }\r\n\r\n    trickery() {\r\n        const mod = this.getStatModifierSum(STAT_TRICKERY);\r\n\r\n        return this.baseTrickery + mod;\r\n    }\r\n\r\n    faith() {\r\n        const mod = this.getStatModifierSum(STAT_FAITH);\r\n\r\n        return this.baseFaith + mod;\r\n    }\r\n}\r\n","/**\n * Always positive modulus\n * @param x Operand\n * @param n Modulus\n * @returns x modulo n\n */\nexport function mod(x, n) {\n    return (x % n + n) % n;\n}\nexport function clamp(val, min = 0, max = 1) {\n    if (val < min)\n        return min;\n    if (val > max)\n        return max;\n    return val;\n}\nexport function capitalize(string) {\n    return string.charAt(0).toUpperCase() + string.substring(1);\n}\n/**\n * Format a string in a flexible way. Scans for %s strings and replaces them with arguments. List of patterns is modifiable via String.format.map.\n * @param {string} template\n * @param {any} [argv]\n */\nexport function format(template, ...args) {\n    let map = format.map;\n    let replacer = function (match, group1, group2, index) {\n        if (template.charAt(index - 1) == \"%\") {\n            return match.substring(1);\n        }\n        if (!args.length) {\n            return match;\n        }\n        let obj = args[0];\n        let group = group1 || group2;\n        let parts = group.split(\",\");\n        let name = parts.shift() || \"\";\n        let method = map[name.toLowerCase()];\n        if (!method) {\n            return match;\n        }\n        obj = args.shift();\n        let replaced = obj[method].apply(obj, parts);\n        let first = name.charAt(0);\n        if (first != first.toLowerCase()) {\n            replaced = capitalize(replaced);\n        }\n        return replaced;\n    };\n    return template.replace(/%(?:([a-z]+)|(?:{([^}]+)}))/gi, replacer);\n}\nformat.map = {\n    \"s\": \"toString\"\n};\n","import { Component } from 'geotic';\r\nimport { SKILL_SPEED } from '../../data/Skills';\r\nimport { getRaceData, RACE_HUMAN } from '../../data/Races';\r\n\r\nexport class Race extends Component {\r\n    static properties = {\r\n        key: RACE_HUMAN,\r\n    };\r\n\r\n    data() {\r\n        return getRaceData(this.key);\r\n    }\r\n\r\n    get name() {\r\n        return this.data().name;\r\n    }\r\n\r\n    get speed() {\r\n        return this.data().speed;\r\n    }\r\n\r\n    getModifier(stat) {\r\n        return this.data()[stat];\r\n    }\r\n\r\n    onQueryStatMod(evt) {\r\n        const mod = this.getModifier(evt.data.stat);\r\n\r\n        if (mod !== 0) {\r\n            evt.data.modifiers.push({\r\n                source: this.name,\r\n                mod,\r\n            });\r\n        }\r\n    }\r\n\r\n    onQuerySkillMod(evt) {\r\n        if (evt.data.skill === SKILL_SPEED) {\r\n            const mod = this.speed;\r\n\r\n            evt.data.modifiers.push({\r\n                source: this.name,\r\n                mod,\r\n            });\r\n        }\r\n    }\r\n}\r\n","import RaceData from './RaceData';\r\n\r\nexport const RACE_HUMAN = 'RACE_HUMAN';\r\nexport const RACE_GOBLIN = 'RACE_GOBLIN';\r\nexport const RACE_SNAKE = 'RACE_SNAKE';\r\nexport const RACE_BEAR = 'RACE_BEAR';\r\n\r\nconst lookup = {\r\n    [RACE_HUMAN]: new RaceData({\r\n        name: 'Human',\r\n        key: RACE_HUMAN,\r\n        speed: 1,\r\n        STAT_STRENGTH: 1,\r\n        STAT_FINESSE: 1,\r\n        STAT_ATHLETICISM: 1,\r\n        STAT_TRICKERY: 1,\r\n        STAT_FAITH: 0,\r\n    }),\r\n    [RACE_GOBLIN]: new RaceData({\r\n        name: 'Goblin',\r\n        key: RACE_GOBLIN,\r\n        speed: 2,\r\n        STAT_STRENGTH: -1,\r\n        STAT_FINESSE: 2,\r\n        STAT_ATHLETICISM: 1,\r\n        STAT_TRICKERY: 2,\r\n        STAT_FAITH: 0,\r\n    }),\r\n    [RACE_SNAKE]: new RaceData({\r\n        name: 'Snake',\r\n        key: RACE_SNAKE,\r\n        speed: 2,\r\n        STAT_STRENGTH: -2,\r\n        STAT_FINESSE: 3,\r\n        STAT_ATHLETICISM: -1,\r\n        STAT_TRICKERY: 3,\r\n        STAT_FAITH: 0,\r\n    }),\r\n    [RACE_BEAR]: new RaceData({\r\n        name: 'Bear',\r\n        key: RACE_BEAR,\r\n        speed: 2,\r\n        STAT_STRENGTH: 5,\r\n        STAT_FINESSE: -1,\r\n        STAT_ATHLETICISM: 5,\r\n        STAT_TRICKERY: -2,\r\n        STAT_FAITH: -2,\r\n    }),\r\n};\r\n\r\nexport const getRaceData = (name) => lookup[name];\r\n","export default class RaceData {\r\n    name = '';\r\n    speed = 1;\r\n    key = 1;\r\n    STAT_STRENGTH = 0;\r\n    STAT_FINESSE = 0;\r\n    STAT_ATHLETICISM = 0;\r\n    STAT_TRICKERY = 0;\r\n    STAT_FAITH = 0;\r\n\r\n    constructor(data) {\r\n        this.name = data.name || '';\r\n        this.speed = data.speed || 1;\r\n        this.key = data.key;\r\n\r\n        this.STAT_STRENGTH = data.STAT_STRENGTH || 0;\r\n        this.STAT_FINESSE = data.STAT_FINESSE || 0;\r\n        this.STAT_ATHLETICISM = data.STAT_ATHLETICISM || 0;\r\n        this.STAT_TRICKERY = data.STAT_TRICKERY || 0;\r\n        this.STAT_FAITH = data.STAT_FAITH || 0;\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport {\r\n    getWeaponType,\r\n    getWeaponTypeDmgType,\r\n    getWeaponTypeFamily,\r\n    getWeaponTypeName,\r\n} from '../../data/WeaponTypes';\r\nimport { randomInt } from '../../utils/rand';\r\n\r\nexport class Weapon extends Component {\r\n    static properties = {\r\n        weaponType: 'WPN_TYPE_DAGGER',\r\n        die: 6,\r\n        modifier: 0,\r\n        cost: 600,\r\n    };\r\n\r\n    get name() {\r\n        return getWeaponTypeName(this.weaponType);\r\n    }\r\n\r\n    get family() {\r\n        return getWeaponTypeFamily(this.weaponType);\r\n    }\r\n\r\n    get damageType() {\r\n        return getWeaponTypeDmgType(this.weaponType);\r\n    }\r\n\r\n    getShortDescription(user) {\r\n        return getWeaponType(this.weaponType).getShortDescription(user, this);\r\n    }\r\n\r\n    roll() {\r\n        const r = randomInt(1, this.die);\r\n\r\n        return r + this.modifier;\r\n    }\r\n\r\n    onTryUseMelee(evt) {\r\n        const weaponType = getWeaponType(this.weaponType);\r\n\r\n        weaponType.attack(evt.data.interactor, evt.data.target, this);\r\n\r\n        evt.data.interactor.fireEvent('energy-consumed', this.cost);\r\n\r\n        evt.data.success = true;\r\n    }\r\n\r\n    onTryUseMeleeOffhand(evt) {\r\n        const weaponType = getWeaponType(this.weaponType);\r\n\r\n        weaponType.offhandAttack(evt.data.interactor, evt.data.target, this);\r\n\r\n        evt.data.success = true;\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport { STATUS_BLEEDING } from '../../data/Statuses';\r\n\r\nexport class Status extends Component {\r\n    static allowMultiple = true;\r\n    static properties = {\r\n        key: STATUS_BLEEDING,\r\n        duration: 4000,\r\n        lifetime: 0,\r\n        potency: 0.5,\r\n    };\r\n\r\n    remainingLifetime() {\r\n        return this.duration - this.lifetime;\r\n    }\r\n\r\n    isCompleted() {\r\n        return this.lifetime >= this.duration;\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\n\r\nexport class Ground extends Component {}\r\n","import { Component } from 'geotic';\r\n\r\nexport class IsIncapacitated extends Component {}\r\n","import { Component } from 'geotic';\r\nimport { statCheck, STAT_FINESSE } from '../../data/Stats';\r\n\r\nexport class SharpTrap extends Component {\r\n    static properties = {\r\n        challenge: 15,\r\n    };\r\n\r\n    test(entity) {\r\n        return statCheck(STAT_FINESSE, entity, this.challenge);\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\n\r\nexport class EquippedSkillMod extends Component {\r\n    static allowMultiple = true;\r\n    static properties = {\r\n        SKILL_ARMOR: 0,\r\n        SKILL_HEALTH: 0,\r\n        SKILL_SPEED: 0,\r\n        SKILL_THROWING: 0,\r\n        SKILL_DODGE: 0,\r\n        SKILL_BRAWLING: 0,\r\n        SKILL_AXE: 0,\r\n        SKILL_BLADE: 0,\r\n        SKILL_CUDGEL: 0,\r\n    };\r\n\r\n    onQuerySkillModEquipped(evt) {\r\n        const mod = this[evt.data.skill];\r\n\r\n        if (mod) {\r\n            evt.data.modifiers.push({\r\n                source: this.entity.moniker.name,\r\n                mod,\r\n            });\r\n        }\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport { game } from '../../core/Game';\r\nimport { randomWeightedBool } from '../../utils/rand';\r\nimport { Fire } from './Fire';\r\n\r\nexport class Combustible extends Component {\r\n    static properties = {\r\n        fuel: 200,\r\n        flashPoint: 200,\r\n        spawnableRemains: null,\r\n        burnRate: 5,\r\n    };\r\n\r\n    get isOnFire() {\r\n        return !!this.entity.fire;\r\n    }\r\n\r\n    get isOutOfFuel() {\r\n        return this.fuel <= 0;\r\n    }\r\n\r\n    getTemperature() {\r\n        const pos = this.entity.position.getPos();\r\n\r\n        return game.temperature.getTemperature(pos.x, pos.y);\r\n    }\r\n\r\n    setTemperature(value) {\r\n        const pos = this.entity.position.getPos();\r\n\r\n        return game.temperature.setTemperature(pos.x, pos.y, value);\r\n    }\r\n\r\n    getDieOutChance() {\r\n        return 0.01;\r\n    }\r\n\r\n    getSparkChance() {\r\n        return this.getTemperature() / 1000;\r\n    }\r\n\r\n    getCatchChance(intensity) {\r\n        if (this.fuel <= 0) {\r\n            return 0;\r\n        }\r\n\r\n        const temperature = this.getTemperature();\r\n\r\n        return (temperature * intensity) / 1000;\r\n    }\r\n\r\n    onSpark(evt) {\r\n        if (this.isOnFire) {\r\n            return;\r\n        }\r\n\r\n        const intensity = evt.data.intensity;\r\n\r\n        if (randomWeightedBool(this.getCatchChance(intensity))) {\r\n            this.entity.add(Fire, {\r\n                intensity,\r\n            });\r\n            this.setTemperature(this.flashPoint);\r\n        }\r\n    }\r\n\r\n    onTryIgnite(evt) {\r\n        this.entity.add(Fire, {\r\n            intensity: 3,\r\n        });\r\n        this.setTemperature(this.flashPoint);\r\n    }\r\n\r\n    onGetInteractions(evt) {\r\n        if (!this.isOnFire && !this.entity.isInventoried) {\r\n            evt.data.interactions.push({\r\n                name: 'Ignite',\r\n                evt: 'try-ignite',\r\n                intensity: 3,\r\n            });\r\n        }\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\n\r\nexport class Fire extends Component {\r\n    static properties = {\r\n        intensity: 3,\r\n    };\r\n\r\n    extinguish() {\r\n        this.destroy();\r\n    }\r\n\r\n    onTryExtinguish(evt) {\r\n        this.extinguish();\r\n    }\r\n\r\n    onGetInteractions(evt) {\r\n        evt.data.interactions.push({\r\n            name: 'Extinguish',\r\n            evt: 'try-extinguish',\r\n        });\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\n\r\nexport class ThermalCapacity extends Component {\r\n    static properties = {\r\n        value: 0.5,\r\n    };\r\n}\r\n","import { Component } from 'geotic';\r\n\r\nexport class Abilities extends Component {\r\n    static properties = {\r\n        known: [],\r\n        state: {},\r\n    };\r\n\r\n    onQueryAbilities(evt) {\r\n        evt.data.abilities.push(...this.known);\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport { getAbility } from '../../data/Abilities';\r\n\r\nexport class AbilityStatus extends Component {\r\n    static allowMultiple = true;\r\n    static keyProperty = 'key';\r\n    static properties = {\r\n        key: 'ABILITY_SPRINT',\r\n        isCoolingDown: false,\r\n        isToggledOn: true,\r\n        cooldownDuration: 50000,\r\n        currentCooldownDuration: 0,\r\n        duration: 10000,\r\n        currentDuration: 0,\r\n        channelDuration: 0,\r\n        currentChannelDuration: 0,\r\n        statMods: {},\r\n        skillMods: {},\r\n    };\r\n\r\n    get ability() {\r\n        return getAbility(this.key);\r\n    }\r\n\r\n    get remainingCooldownDuration() {\r\n        if (!this.isCoolingDown) {\r\n            return Infinity;\r\n        }\r\n\r\n        return this.cooldownDuration - this.currentCooldownDuration;\r\n    }\r\n\r\n    get remainingDuration() {\r\n        if (this.isCoolingDown) {\r\n            return 0;\r\n        }\r\n\r\n        return this.duration - this.currentDuration;\r\n    }\r\n\r\n    get isChanneling() {\r\n        return (\r\n            !this.isCoolingDown &&\r\n            this.currentChannelDuration < this.channelDuration\r\n        );\r\n    }\r\n\r\n    get isComplete() {\r\n        return (\r\n            this.currentDuration >= this.duration ||\r\n            (this.ability.isToggleable && !this.isToggledOn)\r\n        );\r\n    }\r\n\r\n    get isCooldownComplete() {\r\n        return (\r\n            this.isCoolingDown &&\r\n            this.currentCooldownDuration >= this.cooldownDuration\r\n        );\r\n    }\r\n\r\n    startCooldown() {\r\n        this.isCoolingDown = true;\r\n        this.isToggledOn = false;\r\n    }\r\n\r\n    onQuerySkillMod(evt) {\r\n        if (this.isComplete) {\r\n            return;\r\n        }\r\n\r\n        const mod = this.skillMods[evt.data.skill];\r\n\r\n        if (mod) {\r\n            evt.data.modifiers.push({\r\n                source: this.ability.name,\r\n                mod,\r\n            });\r\n        }\r\n    }\r\n\r\n    onQueryStatMod(evt) {\r\n        if (this.isCoolingDown) {\r\n            return;\r\n        }\r\n\r\n        const mod = this.statMods[evt.data.stat];\r\n\r\n        if (mod) {\r\n            evt.data.modifiers.push({\r\n                source: this.ability.name,\r\n                mod,\r\n            });\r\n        }\r\n    }\r\n}\r\n","import PrayerOfProtectionAbility from './abilities/prayers/PrayerOfProtectionAbility';\r\nimport BlinkAbility from './abilities/spells/BlinkAbility';\r\nimport CrimsonWellAbility from './abilities/spells/CrimsonWellAbility';\r\nimport RageAbility from './abilities/stances/RageAbility';\r\nimport SprintAbility from './abilities/stances/SprintAbility';\r\nimport JumpAbility from './abilities/stunts/JumpAbility';\r\n\r\nexport const ABILITY_SPRINT = 'ABILITY_SPRINT';\r\nexport const ABILITY_RAGE = 'ABILITY_RAGE';\r\nexport const ABILITY_CRIMSON_WELL = 'ABILITY_CRIMSON_WELL';\r\nexport const ABILITY_BLINK = 'ABILITY_BLINK';\r\nexport const ABILITY_JUMP = 'ABILITY_JUMP';\r\nexport const ABILITY_PRAYER_PROTECTION = 'ABILITY_PRAYER_PROTECTION';\r\n\r\nconst lookup = {\r\n    ABILITY_SPRINT: new SprintAbility(),\r\n    ABILITY_RAGE: new RageAbility(),\r\n    ABILITY_CRIMSON_WELL: new CrimsonWellAbility(),\r\n    ABILITY_BLINK: new BlinkAbility(),\r\n    ABILITY_JUMP: new JumpAbility(),\r\n    ABILITY_PRAYER_PROTECTION: new PrayerOfProtectionAbility(),\r\n};\r\n\r\nexport const getAbility = (key) => lookup[key];\r\nexport const getAbilityStatus = (key, entity) => {\r\n    if (entity.abilityStatus) {\r\n        return entity.abilityStatus[key];\r\n    }\r\n};\r\nexport const getStance = (entity) => {\r\n    if (!entity.abilityStatus) {\r\n        return;\r\n    }\r\n\r\n    return Object.values(entity.abilityStatus).find((status) => {\r\n        return (\r\n            status.ability.isStance &&\r\n            !status.isCoolingDown &&\r\n            !status.isComplete\r\n        );\r\n    });\r\n};\r\nexport const getChanneling = (entity) => {\r\n    if (!entity.abilityStatus) {\r\n        return;\r\n    }\r\n\r\n    return Object.values(entity.abilityStatus).find((status) => {\r\n        return status.ability.isChanneled && status.isChanneling;\r\n    });\r\n};\r\n","import { ABILITY_TYPE_PRAYER } from '../../../enums/AbilityTypes';\r\nimport { allDirections, directionDelta } from '../../../enums/Directions';\r\nimport { ABILITY_PRAYER_PROTECTION } from '../../Abilities';\r\nimport { getStat, STAT_FAITH } from '../../Stats';\r\nimport SimpleChannelAbility from '../SimpleChannelAbility';\r\n\r\nexport default class PrayerOfProtectionAbility extends SimpleChannelAbility {\r\n    key = ABILITY_PRAYER_PROTECTION;\r\n    type = ABILITY_TYPE_PRAYER;\r\n    name = 'Prayer of Protection';\r\n\r\n    getCooldownDuration(entity) {\r\n        return 20000;\r\n    }\r\n\r\n    getChannelDuration(entity) {\r\n        return 5000;\r\n    }\r\n\r\n    getArmorModifier(entity) {\r\n        return Math.max(2, getStat(STAT_FAITH, entity));\r\n    }\r\n\r\n    getDescription(entity) {\r\n        const armor = this.getArmorModifier(entity);\r\n\r\n        return `Grant +${armor} bonus armor. [FTH]`;\r\n    }\r\n\r\n    getSkillMods(entity) {\r\n        return {\r\n            SKILL_ARMOR: this.getArmorModifier(entity),\r\n        };\r\n    }\r\n\r\n    onChannelComplete(status) {\r\n        const pos = status.entity.position.getPos();\r\n\r\n        allDirections().forEach((dir) => {\r\n            game.particles.createEmitter(\r\n                pos.x,\r\n                pos.y,\r\n                {\r\n                    rate: 3,\r\n                },\r\n                {\r\n                    glyphs: ['', 'o', 'O'],\r\n                    fg1s: ['yellow'],\r\n                    speed: 0.05,\r\n                    direction: directionDelta(dir),\r\n                    lifetime: 3000,\r\n                }\r\n            );\r\n        });\r\n    }\r\n}\r\n","export const ABILITY_TYPE_STANCE = 0;\r\nexport const ABILITY_TYPE_SHOUT = 1;\r\nexport const ABILITY_TYPE_STUNT = 2;\r\nexport const ABILITY_TYPE_SPELL = 3;\r\nexport const ABILITY_TYPE_PRAYER = 4;\r\n\r\nconst lookup = {\r\n    [ABILITY_TYPE_STANCE]: {\r\n        name: 'Stance',\r\n    },\r\n    [ABILITY_TYPE_SHOUT]: {\r\n        name: 'Shout',\r\n    },\r\n    [ABILITY_TYPE_STUNT]: {\r\n        name: 'Stunt',\r\n    },\r\n    [ABILITY_TYPE_SPELL]: {\r\n        name: 'Spell',\r\n    },\r\n    [ABILITY_TYPE_PRAYER]: {\r\n        name: 'Prayer',\r\n    },\r\n};\r\n\r\nexport const getAbilityTypeName = (key) => lookup[key].name;\r\n","import { game } from '../../core/Game';\r\nimport { AbilityStatus } from '../../ecs/components';\r\nimport Ability from './Ability';\r\n\r\nexport default class SimpleChannelAbility extends Ability {\r\n    isToggleable = false;\r\n    isChanneled = true;\r\n\r\n    getDuration(entity) {\r\n        return 5000;\r\n    }\r\n\r\n    getCooldownDuration(entity) {\r\n        return 50000;\r\n    }\r\n\r\n    getChannelDuration(entity) {\r\n        return 10000;\r\n    }\r\n\r\n    execute(entity, data) {\r\n        entity.add(AbilityStatus, {\r\n            key: this.key,\r\n            isCoolingDown: false,\r\n            channelDuration: this.getChannelDuration(entity),\r\n            currentChannelDuration: 0,\r\n            cooldownDuration: this.getCooldownDuration(entity),\r\n            statMods: this.getStatMods(entity),\r\n            skillMods: this.getSkillMods(entity),\r\n        });\r\n    }\r\n}\r\n","import { game } from '../../core/Game';\r\nimport { SCREEN_WAIT } from '../../core/screens/ScreenType';\r\nimport { AbilityStatus } from '../../ecs/components';\r\nimport { ABILITY_TYPE_STANCE } from '../../enums/AbilityTypes';\r\nimport { getAbilityStatus } from '../Abilities';\r\n\r\nexport default class Ability {\r\n    key = '';\r\n    type = 0;\r\n    name = '';\r\n    isToggleable = false;\r\n    isChanneled = false;\r\n\r\n    get isStance() {\r\n        return this.type === ABILITY_TYPE_STANCE;\r\n    }\r\n\r\n    getDescription(entity) {\r\n        return '';\r\n    }\r\n\r\n    getCooldownDuration(entity) {\r\n        return 5000;\r\n    }\r\n\r\n    getChannelDuration(entity) {\r\n        return 0;\r\n    }\r\n\r\n    constructor(key, type, name) {\r\n        this.key = key;\r\n        this.type = type;\r\n        this.name = name;\r\n    }\r\n\r\n    onChannelComplete(status) {}\r\n\r\n    initiate(entity, options) {\r\n        options.onConfirm();\r\n    }\r\n\r\n    execute(entity, data) {\r\n        entity.add(AbilityStatus, {\r\n            key: this.key,\r\n            isCoolingDown: true,\r\n            cooldownDuration: this.getCooldownDuration(entity),\r\n        });\r\n    }\r\n\r\n    getStatMods(entity) {\r\n        return {};\r\n    }\r\n\r\n    getSkillMods(entity) {\r\n        return {};\r\n    }\r\n\r\n    toggleOn(entity) {\r\n        entity.add(AbilityStatus, {\r\n            key: this.key,\r\n            isToggledOn: true,\r\n            isCoolingDown: false,\r\n            duration: this.getDuration(entity),\r\n            cooldownDuration: this.getCooldownDuration(entity),\r\n            statMods: this.getStatMods(entity),\r\n            skillMods: this.getSkillMods(entity),\r\n        });\r\n\r\n        return true;\r\n    }\r\n\r\n    toggleOff(entity, status) {\r\n        status.startCooldown();\r\n    }\r\n\r\n    channel(energy, status) {\r\n        status.currentChannelDuration += energy;\r\n\r\n        if (status.currentChannelDuration >= status.channelDuration) {\r\n            energy =\r\n                status.channelDuration -\r\n                (status.currentChannelDuration - energy);\r\n            status.currentChannelDuration = status.channelDuration;\r\n            status.startCooldown();\r\n            this.onChannelComplete(status);\r\n        }\r\n\r\n        const entity = status.entity;\r\n\r\n        entity.fireEvent('energy-consumed', energy);\r\n\r\n        return energy;\r\n    }\r\n\r\n    cancelChannel(status) {\r\n        status.currentDuration = status.duration;\r\n        status.startCooldown();\r\n    }\r\n\r\n    update(dt, status) {\r\n        if (status.isCoolingDown) {\r\n            status.currentCooldownDuration += dt;\r\n\r\n            if (status.currentCooldownDuration > status.cooldownDuration) {\r\n                status.currentCooldownDuration = status.cooldownDuration;\r\n            }\r\n        } else if (status.isComplete) {\r\n            status.startCooldown();\r\n        }\r\n\r\n        if (status.isChanneling) {\r\n            return;\r\n        }\r\n\r\n        if (!status.isComplete) {\r\n            status.currentDuration += dt;\r\n        }\r\n\r\n        if (status.isCooldownComplete) {\r\n            status.destroy();\r\n        }\r\n    }\r\n\r\n    getDisplayText(entity) {\r\n        const status = getAbilityStatus(this.key, entity);\r\n\r\n        if (status && status.isCoolingDown) {\r\n            const cd = (status.remainingCooldownDuration / 1000).toFixed(1);\r\n\r\n            return {\r\n                text: `${this.name} [${cd}]`,\r\n                isEnabled: false,\r\n            };\r\n        }\r\n\r\n        if (this.isToggleable) {\r\n            if (status && status.isToggledOn) {\r\n                return {\r\n                    text: `${this.name} [toggle OFF]`,\r\n                    isEnabled: true,\r\n                };\r\n            } else {\r\n                return {\r\n                    text: `${this.name} [toggle ON]`,\r\n                    isEnabled: true,\r\n                };\r\n            }\r\n        }\r\n\r\n        return {\r\n            text: this.name,\r\n            isEnabled: true,\r\n        };\r\n    }\r\n}\r\n","import { game } from '../../../core/Game';\r\nimport { SCREEN_CURSOR } from '../../../core/screens/ScreenType';\r\nimport { ABILITY_TYPE_SPELL } from '../../../enums/AbilityTypes';\r\nimport { simpleCursorRenderer } from '../../../utils/cursor/SimpleCursorRenderer';\r\nimport { ABILITY_BLINK } from '../../Abilities';\r\nimport Ability from '../Ability';\r\n\r\nexport default class BlinkAbility extends Ability {\r\n    key = ABILITY_BLINK;\r\n    type = ABILITY_TYPE_SPELL;\r\n    name = 'Blink';\r\n\r\n    getCooldownDuration(entity) {\r\n        return 20000;\r\n    }\r\n\r\n    getDescription(entity) {\r\n        return `Teleport to a visible location.`;\r\n    }\r\n\r\n    initiate(entity, options) {\r\n        game.screens.pushScreen(SCREEN_CURSOR, {\r\n            renderer: simpleCursorRenderer({\r\n                isValid: ({ x, y }) => {\r\n                    // must be visible\r\n                    const visible = game.map\r\n                        .getEntitiesAt(x, y, true)\r\n                        .filter((e) => e.isVisible);\r\n\r\n                    // must be at least one entity visible\r\n                    if (visible.length <= 0) {\r\n                        return false;\r\n                    }\r\n\r\n                    // must not be any blocker or beings\r\n                    return !visible.some((e) => e.blocker || e.body);\r\n                },\r\n            }),\r\n            onResult: (result) => {\r\n                game.screens.popScreen();\r\n                options.onConfirm(result);\r\n            },\r\n            onCancel: () => {\r\n                game.screens.popScreen();\r\n                options.onCancel();\r\n            },\r\n        });\r\n    }\r\n\r\n    execute(entity, data) {\r\n        super.execute(entity, data);\r\n\r\n        const prevPos = entity.position.getPos();\r\n        const nextPos = data.position;\r\n\r\n        game.particles.createEmitter(\r\n            prevPos.x,\r\n            prevPos.y,\r\n            {\r\n                rate: 2,\r\n            },\r\n            {\r\n                glyphs: ['O', 'o', ''],\r\n                fg1s: ['purple'],\r\n                speed: 1,\r\n                lifetime: 300,\r\n            }\r\n        );\r\n\r\n        entity.position.setPos(data.position.x, data.position.y);\r\n\r\n        game.particles.createEmitter(\r\n            nextPos.x,\r\n            nextPos.y,\r\n            {\r\n                rate: 2,\r\n            },\r\n            {\r\n                glyphs: ['', 'o', 'O'],\r\n                fg1s: ['purple'],\r\n                speed: 1,\r\n                lifetime: 300,\r\n            }\r\n        );\r\n    }\r\n}\r\n","import { game } from '../../core/Game';\r\n\r\nconst truthy = () => true;\r\n\r\nexport const simpleCursorRenderer = (options = {}) => {\r\n    const isValid = options.isValid || truthy;\r\n\r\n    return {\r\n        isValid,\r\n        render: (opts) => {\r\n            const color = isValid(opts) ? 'blue' : 'red';\r\n            const screen = game.camera.worldToScreen(opts.x, opts.y);\r\n\r\n            game.renderer.draw(screen.x, screen.y, 'X', color);\r\n        },\r\n    };\r\n};\r\n","import { game } from '../../../core/Game';\r\nimport { ABILITY_TYPE_SPELL } from '../../../enums/AbilityTypes';\r\nimport { ABILITY_CRIMSON_WELL, getAbilityStatus } from '../../Abilities';\r\nimport Attack from '../../Attack';\r\nimport { DMG_TYPE_NECROTIC } from '../../DamageTypes';\r\nimport { addStatus, STATUS_BLEEDING } from '../../Statuses';\r\nimport SimpleDurationAbility from '../SimpleDurationAbility';\r\n\r\nexport default class CrimsonWellAbility extends SimpleDurationAbility {\r\n    key = ABILITY_CRIMSON_WELL;\r\n    type = ABILITY_TYPE_SPELL;\r\n    name = 'Crimson Well';\r\n\r\n    getDuration(entity) {\r\n        return 8000;\r\n    }\r\n\r\n    getCooldownDuration(entity) {\r\n        return 50000;\r\n    }\r\n\r\n    getDescription(entity) {\r\n        return `Siphon the blood of nearby enemies. Lifesteal +${4} HP from adjacent enemies per turn. You gain bleeding for the duration.`;\r\n    }\r\n\r\n    execute(entity, data) {\r\n        super.execute(entity, data);\r\n        addStatus(STATUS_BLEEDING, entity, {\r\n            duration: this.getDuration(entity),\r\n            potency: 0.5,\r\n        });\r\n\r\n        const status = getAbilityStatus(this.key, entity);\r\n\r\n        this.performLifeteal(status);\r\n    }\r\n\r\n    performLifeteal(status) {\r\n        const entity = status.entity;\r\n        const pos = status.entity.position.getPos();\r\n        game.map\r\n            .getNeighborEntities(pos.x, pos.y)\r\n            .flat()\r\n            .filter((e) => game.factions.areEntitiesHostile(e, entity))\r\n            .map((hostile) => {\r\n                const attack = new Attack({\r\n                    attacker: entity,\r\n                    ignoreDodge: true,\r\n                    defender: hostile,\r\n                    weaponName: this.name,\r\n                    damage: 3,\r\n                    damageType: DMG_TYPE_NECROTIC,\r\n                });\r\n\r\n                const evt = hostile.fireEvent('attacked', { attack });\r\n\r\n                if (evt.data.damage > 0) {\r\n                    entity.fireEvent('heal', {\r\n                        value: evt.data.damage,\r\n                    });\r\n\r\n                    const enemyPos = hostile.position.getPos();\r\n                    game.particles.createEmitter(\r\n                        enemyPos.x,\r\n                        enemyPos.y,\r\n                        {\r\n                            rate: 2,\r\n                        },\r\n                        {\r\n                            glyphs: ['', 'x'],\r\n                            fg1s: ['red'],\r\n                            speed: 0.01,\r\n                            lifetime: 120,\r\n                        }\r\n                    );\r\n                }\r\n            });\r\n\r\n        game.particles.createEmitter(\r\n            pos.x,\r\n            pos.y,\r\n            {\r\n                rate: 2,\r\n            },\r\n            {\r\n                glyphs: ['x', ''],\r\n                fg1s: ['red'],\r\n                speed: 0.01,\r\n                lifetime: 120,\r\n            }\r\n        );\r\n    }\r\n\r\n    update(dt, status) {\r\n        super.update(dt, status);\r\n\r\n        if (game.clock.turnDelta <= 0 || status.isComplete) {\r\n            return;\r\n        }\r\n\r\n        this.performLifeteal(status);\r\n    }\r\n}\r\n","import { AbilityStatus } from '../../ecs/components/AbilityStatus';\r\nimport { getAbilityStatus } from '../Abilities';\r\nimport Ability from './Ability';\r\n\r\nexport default class SimpleDurationAbility extends Ability {\r\n    getDuration(entity) {\r\n        return 20000;\r\n    }\r\n\r\n    getCooldownDuration(entity) {\r\n        return 50000;\r\n    }\r\n\r\n    execute(entity, data) {\r\n        const status = getAbilityStatus(this.key, entity);\r\n\r\n        if (status) {\r\n            return false;\r\n        }\r\n\r\n        entity.add(AbilityStatus, {\r\n            key: this.key,\r\n            isToggledOn: true,\r\n            isCoolingDown: true,\r\n            duration: this.getDuration(entity),\r\n            cooldownDuration: this.getCooldownDuration(entity),\r\n            statMods: this.getStatMods(entity),\r\n            skillMods: this.getSkillMods(entity),\r\n        });\r\n\r\n        return true;\r\n    }\r\n}\r\n","import { ABILITY_TYPE_STANCE } from '../../../enums/AbilityTypes';\r\nimport { ABILITY_RAGE } from '../../Abilities';\r\nimport { getStat, STAT_STRENGTH } from '../../Stats';\r\nimport SimpleToggledAbility from '../SimpleToggledAbility';\r\n\r\nexport default class RageAbility extends SimpleToggledAbility {\r\n    key = ABILITY_RAGE;\r\n    type = ABILITY_TYPE_STANCE;\r\n    name = 'Rage';\r\n\r\n    computeStrengthMod(entity) {\r\n        return getStat(STAT_STRENGTH, entity) * 3;\r\n    }\r\n\r\n    getDuration(entity) {\r\n        return 20000;\r\n    }\r\n\r\n    getCooldownDuration(entity) {\r\n        return 50000;\r\n    }\r\n\r\n    getDescription(entity) {\r\n        const str = this.computeStrengthMod(entity);\r\n\r\n        return `Enter a fit of rage. Gain +${str} STR and ${-2} dodge. [STR]`;\r\n    }\r\n\r\n    getSkillMods(entity) {\r\n        return {\r\n            SKILL_DODGE: -2,\r\n        };\r\n    }\r\n\r\n    getStatMods(entity) {\r\n        return {\r\n            STAT_STRENGTH: this.computeStrengthMod(entity),\r\n        };\r\n    }\r\n}\r\n","import { getAbilityStatus } from '../Abilities';\r\nimport Ability from './Ability';\r\n\r\nexport default class SimpleToggledAbility extends Ability {\r\n    isToggleable = true;\r\n\r\n    getDuration(entity) {\r\n        return 10000;\r\n    }\r\n\r\n    getCooldownDuration(entity) {\r\n        return 50000;\r\n    }\r\n\r\n    execute(entity, data) {\r\n        // const status = getAbilityStatus(this.key, entity);\r\n        // if (status) {\r\n        //     this.toggleOff(entity, status);\r\n        // } else {\r\n        //     this.toggleOn(entity);\r\n        // }\r\n    }\r\n}\r\n","import { ABILITY_TYPE_STANCE } from '../../../enums/AbilityTypes';\r\nimport { ABILITY_SPRINT } from '../../Abilities';\r\nimport { getStat, STAT_ATHLETICISM } from '../../Stats';\r\nimport SimpleToggledAbility from '../SimpleToggledAbility';\r\n\r\nexport default class SprintAbility extends SimpleToggledAbility {\r\n    key = ABILITY_SPRINT;\r\n    type = ABILITY_TYPE_STANCE;\r\n    name = 'Sprint';\r\n\r\n    computeSpeedMod(entity) {\r\n        return 5 + 2 * getStat(STAT_ATHLETICISM, entity);\r\n    }\r\n\r\n    getDuration(entity) {\r\n        return 20000;\r\n    }\r\n\r\n    getCooldownDuration(entity) {\r\n        return 50000;\r\n    }\r\n\r\n    getDescription(entity) {\r\n        const speed = this.computeSpeedMod(entity);\r\n\r\n        return `Gain +${speed} move speed. [ATH]`;\r\n    }\r\n\r\n    getSkillMods(entity) {\r\n        return {\r\n            SKILL_SPEED: this.computeSpeedMod(entity),\r\n        };\r\n    }\r\n}\r\n","import { game } from '../../../core/Game';\r\nimport { SCREEN_CURSOR } from '../../../core/screens/ScreenType';\r\nimport { ABILITY_TYPE_STUNT } from '../../../enums/AbilityTypes';\r\nimport { simpleLineRenderer } from '../../../utils/cursor/SimpleLineRenderer';\r\nimport { ABILITY_JUMP } from '../../Abilities';\r\nimport { getStat, STAT_ATHLETICISM } from '../../Stats';\r\nimport Ability from '../Ability';\r\n\r\nexport default class JumpAbility extends Ability {\r\n    key = ABILITY_JUMP;\r\n    type = ABILITY_TYPE_STUNT;\r\n    name = 'Jump';\r\n\r\n    getCooldownDuration(entity) {\r\n        return 20000;\r\n    }\r\n\r\n    getJumpDistance(entity) {\r\n        return Math.floor(Math.max(3, getStat(STAT_ATHLETICISM, entity)) / 3);\r\n    }\r\n\r\n    getDescription(entity) {\r\n        const distance = this.getJumpDistance(entity);\r\n        const word = distance > 1 ? 'tiles' : 'tile';\r\n\r\n        return `Jump up to ${distance} ${word} away. You cannot jump over other creatures. [ATH]`;\r\n    }\r\n\r\n    initiate(entity, options) {\r\n        const distance = this.getJumpDistance(entity);\r\n\r\n        game.screens.pushScreen(SCREEN_CURSOR, {\r\n            maxDistance: distance + 1,\r\n            renderer: simpleLineRenderer({\r\n                isValid: ({ x, y }, idx) => {\r\n                    // must be within range\r\n                    if (idx - 1 > distance) {\r\n                        return false;\r\n                    }\r\n\r\n                    // must be visible\r\n                    const visible = game.map\r\n                        .getEntitiesAt(x, y, true)\r\n                        .filter((e) => e.isVisible);\r\n\r\n                    // must be at least one entity visible\r\n                    if (visible.length <= 0) {\r\n                        return false;\r\n                    }\r\n\r\n                    // must not be any blocker or beings\r\n                    return !visible.some((e) => e.blocker || e.body);\r\n                },\r\n            }),\r\n            onResult: (result) => {\r\n                game.screens.popScreen();\r\n                options.onConfirm(result);\r\n            },\r\n            onCancel: () => {\r\n                game.screens.popScreen();\r\n                options.onCancel();\r\n            },\r\n        });\r\n    }\r\n\r\n    execute(entity, data) {\r\n        super.execute(entity, data);\r\n\r\n        entity.position.setPos(data.position.x, data.position.y);\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport { BITMASK_WALL } from '../../data/bitmasks';\r\n\r\nexport class BitmaskGlyph extends Component {\r\n    static properties = {\r\n        key: BITMASK_WALL,\r\n        updateGlyph: true,\r\n        value: 0,\r\n    };\r\n}\r\n","export const BITMASK_WALL = 'BITMASK_WALL';\r\n// 1  2  4\r\n// 8     16\r\n// 32 64 128\r\n\r\nconst map = {\r\n    BITMASK_WALL: (value) => {\r\n        switch (value) {\r\n            case 0:\r\n            case 2:\r\n            case 3:\r\n            case 6:\r\n            case 7:\r\n            case 17:\r\n            case 48:\r\n                return '';\r\n            case 8:\r\n            case 9:\r\n            case 12:\r\n            case 40:\r\n            case 41:\r\n            case 136:\r\n                return '';\r\n            case 16:\r\n            case 20:\r\n            case 144:\r\n            case 148:\r\n                return '';\r\n            case 1:\r\n            case 34:\r\n            case 64:\r\n            case 66:\r\n            case 67:\r\n            case 68:\r\n            case 70:\r\n            case 71:\r\n            case 96:\r\n            case 98:\r\n            case 99:\r\n            case 102:\r\n            case 130:\r\n            case 192:\r\n            case 194:\r\n            case 195:\r\n            case 198:\r\n            case 226:\r\n                return '';\r\n            case 10:\r\n            case 14:\r\n                return '';\r\n            case 18:\r\n            case 19:\r\n            case 147:\r\n                return '';\r\n            case 72:\r\n            case 200:\r\n                return '';\r\n            case 80:\r\n            case 84:\r\n                return '';\r\n            case 26:\r\n            case 58:\r\n            case 154:\r\n                return '';\r\n            case 82:\r\n            case 83:\r\n            case 114:\r\n                return '';\r\n            case 74:\r\n            case 78:\r\n            case 202:\r\n                return '';\r\n            case 88:\r\n            case 92:\r\n                return '';\r\n            case 90:\r\n                return '';\r\n            default:\r\n                return '';\r\n        }\r\n    },\r\n};\r\n\r\nexport const getMaskGlyph = (key, mask) => map[key](mask);\r\n","import { Component } from 'geotic';\r\nimport { game } from '../../core/Game';\r\nimport { addStatus, STATUS_REGENERATION } from '../../data/Statuses';\r\nimport { CONSOLE_EVENT_LEVEL } from '../../enums/ConsoleEvents';\r\n\r\nconst LEVEL_XP_CAP = 5000;\r\nconst LEVEL_INTENSITY = 16;\r\nconst LEVEL_DIFFERENCE_FACTOR = 20;\r\nconst SKILL_POINTS_PER_LEVEL = 1;\r\n\r\nexport class Level extends Component {\r\n    static properties = {\r\n        xp: 0,\r\n        level: 1,\r\n        skillPoints: 2,\r\n    };\r\n\r\n    get nextLevelReq() {\r\n        return Math.floor(\r\n            (this.level * LEVEL_XP_CAP) / (this.level + LEVEL_INTENSITY)\r\n        );\r\n    }\r\n\r\n    levelUp() {\r\n        this.level++;\r\n        this.skillPoints += SKILL_POINTS_PER_LEVEL;\r\n\r\n        game.console.event(CONSOLE_EVENT_LEVEL, {\r\n            entity: this.entity,\r\n            level: this.level,\r\n        });\r\n\r\n        addStatus(STATUS_REGENERATION, this.entity, {\r\n            duration: 20000,\r\n        });\r\n\r\n        const pos = this.entity.position.getPos();\r\n\r\n        game.particles.createEmitter(\r\n            pos.x,\r\n            pos.y,\r\n            {\r\n                rate: 5,\r\n                duration: 1200,\r\n            },\r\n            {\r\n                glyphs: [''],\r\n                fg1s: ['yellow'],\r\n                speed: 0.015,\r\n                direction: {\r\n                    x: -1,\r\n                    y: -5,\r\n                },\r\n                lifetime: 3000,\r\n            }\r\n        );\r\n        game.particles.createEmitter(\r\n            pos.x,\r\n            pos.y,\r\n            {\r\n                rate: 5,\r\n                duration: 1200,\r\n            },\r\n            {\r\n                glyphs: [''],\r\n                fg1s: ['yellow'],\r\n                speed: 0.015,\r\n                direction: {\r\n                    x: 0,\r\n                    y: -5,\r\n                },\r\n                lifetime: 3000,\r\n            }\r\n        );\r\n        game.particles.createEmitter(\r\n            pos.x,\r\n            pos.y,\r\n            {\r\n                rate: 5,\r\n                duration: 1200,\r\n            },\r\n            {\r\n                glyphs: [''],\r\n                fg1s: ['yellow'],\r\n                speed: 0.015,\r\n                direction: {\r\n                    x: 1,\r\n                    y: -5,\r\n                },\r\n                lifetime: 3000,\r\n            }\r\n        );\r\n    }\r\n\r\n    addXP(xp) {\r\n        this.xp += xp;\r\n\r\n        if (this.xp >= this.nextLevelReq) {\r\n            this.xp -= this.nextLevelReq;\r\n\r\n            this.levelUp();\r\n        }\r\n    }\r\n\r\n    onEnemyKilled(evt) {\r\n        if (!evt.data.enemy.level) {\r\n            return;\r\n        }\r\n\r\n        const levelFactor = 5 + (evt.data.enemy.level.level - this.level);\r\n\r\n        if (levelFactor < 0) {\r\n            return;\r\n        }\r\n\r\n        this.addXP(levelFactor * LEVEL_DIFFERENCE_FACTOR);\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\n\r\nexport class Skills extends Component {\r\n    static properties = {\r\n        SKILL_ARMOR: 0,\r\n        SKILL_HEALTH: 0,\r\n        SKILL_SPEED: 0,\r\n        SKILL_THROWING: 0,\r\n        SKILL_DODGE: 0,\r\n        SKILL_BRAWLING: 0,\r\n        SKILL_AXE: 0,\r\n        SKILL_BLADE: 0,\r\n        SKILL_CUDGEL: 0,\r\n    };\r\n\r\n    onQuerySkillMod(evt) {\r\n        const mod = this[evt.data.skill];\r\n\r\n        if (mod) {\r\n            evt.data.modifiers.push({\r\n                source: this.entity.moniker.name,\r\n                mod,\r\n            });\r\n        }\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\n\r\nexport class Compressable extends Component {\r\n    static properties = {\r\n        compressedCh: 'h',\r\n        massRequirement: 60,\r\n        isCompressed: false,\r\n    };\r\n}\r\n","import { Component } from 'geotic';\r\n\r\nexport class Mass extends Component {\r\n    static properties = {\r\n        value: 20,\r\n    };\r\n}\r\n","import { Component } from 'geotic';\r\nimport { SHARD_VAL_LARGE, SHARD_VAL_MEDIUM } from './HealthShardDropper';\r\n\r\nexport class HealthShard extends Component {\r\n    static properties = {\r\n        value: 1,\r\n    };\r\n\r\n    get healValue() {\r\n        return this.value;\r\n    }\r\n\r\n    onSpawned() {\r\n        const name = this.entity.moniker.name;\r\n\r\n        if (this.value >= SHARD_VAL_LARGE) {\r\n            this.entity.glyph.ch = '';\r\n            this.entity.moniker.name = `Large ${name}`;\r\n        } else if (this.value >= SHARD_VAL_MEDIUM) {\r\n            this.entity.glyph.ch = '';\r\n            this.entity.moniker.name = `Medium ${name}`;\r\n        } else {\r\n            this.entity.glyph.ch = '';\r\n            this.entity.moniker.name = `Small ${name}`;\r\n        }\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\nimport { game } from '../../core/Game';\r\nimport { SPWN_HEALTH_SHARD } from '../../data/Spawnables';\r\nimport { spawn } from '../../data/Spawner';\r\nimport { allDirections, directionDelta } from '../../enums/Directions';\r\nimport { randomWeightedBool } from '../../utils/rand';\r\n\r\nexport const SHARD_VAL_SMALL = 1;\r\nexport const SHARD_VAL_MEDIUM = 3;\r\nexport const SHARD_VAL_LARGE = 6;\r\n\r\nexport class HealthShardDropper extends Component {\r\n    onDeath(evt) {\r\n        const lvl = this.entity.level.level;\r\n        const playerLvl = game.player.entity.level.level;\r\n        const lvlDiff = 5 + (lvl - playerLvl);\r\n\r\n        if (lvlDiff < 0) {\r\n            return;\r\n        }\r\n\r\n        const pos = this.entity.position.getPos();\r\n        const emptyCells = [];\r\n\r\n        allDirections().forEach((dir) => {\r\n            const delta = directionDelta(dir);\r\n            const adjacent = {\r\n                x: pos.x + delta.x,\r\n                y: pos.y + delta.y\r\n            };\r\n            const entities = game.map.getEntitiesAt(adjacent.x, adjacent.y);\r\n\r\n            if (entities.length <= 0) {\r\n                emptyCells.push(adjacent);\r\n            }\r\n        });\r\n\r\n        if (emptyCells.length <= 3) {\r\n            emptyCells.push(pos);\r\n        }\r\n\r\n        let shardCount = lvlDiff;\r\n        let i = 0;\r\n\r\n        while (shardCount > 0) {\r\n            const shardPos = emptyCells[i % emptyCells.length];\r\n            let shardValue = SHARD_VAL_SMALL;\r\n\r\n            if (shardCount >= SHARD_VAL_LARGE && randomWeightedBool(.8)) {\r\n                shardValue = SHARD_VAL_LARGE;\r\n            } else if (shardCount >= SHARD_VAL_MEDIUM && randomWeightedBool(.8)) {\r\n                shardValue = SHARD_VAL_MEDIUM;\r\n            }\r\n\r\n            shardCount -= shardValue;\r\n\r\n            spawn(SPWN_HEALTH_SHARD, shardPos.x, shardPos.y, {\r\n                healthShard: {\r\n                    value: shardValue\r\n                }\r\n            });\r\n\r\n            i++;\r\n        }\r\n    }\r\n}\r\n","import { Component } from 'geotic';\r\n\r\nexport class HealthShardConsumer extends Component {}\r\n","export default class System {\n    #game = null;\n\n    get game() {\n        return this.#game;\n    }\n\n    constructor(game) {\n        this.#game = game;\n    }\n\n    update(dt) {}\n}\n","import { game } from '../core/Game';\r\nimport { lerpHSL } from '../utils/ColorUtil';\r\nimport System from './System';\r\n\r\nconst RENDER_MODE_DEFAULT = 0;\r\nconst RENDER_MODE_TEMPERATURE = 1;\r\n\r\nconst temperatureGradient = (v) => {\r\n    const blue = [216, 40, 50];\r\n    const red = [0, 80, 50];\r\n    const rgb = lerpHSL(blue, red, Math.sqrt(v));\r\n\r\n    return `rgb(${rgb[0]},${rgb[1]},${rgb[2]})`;\r\n};\r\n\r\nconst modeLookup = {\r\n    [RENDER_MODE_DEFAULT]: (x, y, e) => {\r\n        if (e.isVisible) {\r\n            game.renderer.draw(\r\n                x,\r\n                y,\r\n                e.glyph.char,\r\n                e.glyph.primary,\r\n                e.glyph.secondary,\r\n                e.glyph.background\r\n            );\r\n        } else if (e.explored) {\r\n            game.renderer.draw(x, y, e.glyph.char, '#2c3538', '#2c3538');\r\n        }\r\n    },\r\n    [RENDER_MODE_TEMPERATURE]: (x, y, e, worldX, worldY) => {\r\n        const temp = game.temperature.getTemperature(worldX, worldY) / 200;\r\n        const bg = temperatureGradient(Math.min(1, temp));\r\n\r\n        if (e.isVisible) {\r\n            game.renderer.draw(\r\n                x,\r\n                y,\r\n                e.glyph.char,\r\n                e.glyph.primary,\r\n                e.glyph.secondary,\r\n                bg\r\n            );\r\n        } else {\r\n            game.renderer.draw(x, y, e.glyph.char, '#2c3538', '#2c3538', bg);\r\n        }\r\n    },\r\n};\r\n\r\nexport default class RenderSystem extends System {\r\n    mode = RENDER_MODE_DEFAULT;\r\n\r\n    renderTile(x, y) {\r\n        const world = this.game.camera.screenToWorld(x, y);\r\n\r\n        if (!this.game.camera.isInView(world.x, world.y)) {\r\n            return;\r\n        }\r\n\r\n        const entities = this.game.map\r\n            .getEntitiesAt(world.x, world.y, true)\r\n            .filter((e) => e.glyph && !e.isInventoried && !e.isDestroying);\r\n\r\n        if (entities.length <= 0) {\r\n            return;\r\n        }\r\n\r\n        let renderableZ = -1;\r\n        let renderable = null;\r\n\r\n        entities.forEach((e) => {\r\n            if (e.glyph.z >= renderableZ) {\r\n                renderable = e;\r\n                renderableZ = e.glyph.z;\r\n            }\r\n        });\r\n\r\n        modeLookup[this.mode](x, y, renderable, world.x, world.y);\r\n    }\r\n\r\n    render(dt) {\r\n        this.game.renderer.clear();\r\n\r\n        for (let x = 0; x < this.game.camera.width; x++) {\r\n            for (let y = 0; y < this.game.camera.height; y++) {\r\n                this.renderTile(x, y);\r\n            }\r\n        }\r\n    }\r\n\r\n    update(dt) {\r\n        this.render();\r\n    }\r\n}\r\n","import { getStatus } from '../data/Statuses';\r\nimport { Moniker, Actor, IsInventoried, IsVisible } from '../ecs/components';\r\nimport System from './System';\r\n\r\nexport default class UISystem extends System {\r\n    showTicks = false;\r\n    beingsQuery = null;\r\n\r\n    constructor(game) {\r\n        super(game);\r\n        this.beingsQuery = this.game.ecs.createQuery({\r\n            all: [Moniker, Actor, IsVisible],\r\n            none: [IsInventoried],\r\n        });\r\n    }\r\n\r\n    renderNearbyCreatures() {\r\n        const beings = this.beingsQuery.get();\r\n\r\n        const offsetX = 1;\r\n        let offsetY = 1;\r\n\r\n        beings.forEach((entity) => {\r\n            let moniker = entity.moniker.display;\r\n            let glyphOffset = offsetX;\r\n\r\n            if (entity.factionMember) {\r\n                const relation = this.game.factions.getEntityRelation(\r\n                    game.player.entity,\r\n                    entity\r\n                );\r\n                const glyph = this.game.factions.getAttitudeGlyph(relation);\r\n\r\n                this.game.renderer.drawUI(\r\n                    offsetX,\r\n                    offsetY,\r\n                    glyph.char,\r\n                    glyph.fg1,\r\n                    glyph.fg2\r\n                );\r\n\r\n                glyphOffset += 1.5;\r\n            }\r\n\r\n            this.game.renderer.drawText(glyphOffset, offsetY, moniker);\r\n\r\n            let statusOffset =\r\n                this.game.renderer.computeTextWidth(moniker) +\r\n                glyphOffset +\r\n                0.5;\r\n\r\n            let dotLevel = 0;\r\n\r\n            if (entity.status) {\r\n                entity.status.forEach((status) => {\r\n                    const statusType = getStatus(status.key);\r\n\r\n                    dotLevel += statusType.getPipCount(status.potency);\r\n\r\n                    this.game.renderer.drawUI(\r\n                        statusOffset,\r\n                        offsetY,\r\n                        statusType.glyph.ch,\r\n                        statusType.glyph.fg1,\r\n                        statusType.glyph.fg2\r\n                    );\r\n                    statusOffset++;\r\n                });\r\n            }\r\n\r\n            dotLevel = Math.min(3, dotLevel);\r\n\r\n            if (entity.health) {\r\n                offsetY++;\r\n\r\n                const health = entity.health;\r\n                const barWidth = 8;\r\n\r\n                const prcnt = health.value / health.max;\r\n                const healthWidth = Math.ceil(prcnt * barWidth * 2) / 2;\r\n                const middle = Math.floor(barWidth / 2) - 1;\r\n\r\n                const primaryHP = '#803636';\r\n                const secondaryHp = '#352323';\r\n\r\n                for (let i = 0; i < barWidth; i++) {\r\n                    const diff = healthWidth - i;\r\n                    if (dotLevel && i === middle) {\r\n                        if (diff === 0.5) {\r\n                            if (dotLevel === 1) {\r\n                                this.game.renderer.drawUI(\r\n                                    i + offsetX,\r\n                                    offsetY,\r\n                                    '#',\r\n                                    primaryHP,\r\n                                    secondaryHp\r\n                                );\r\n                            } else if (dotLevel === 2) {\r\n                                this.game.renderer.drawUI(\r\n                                    i + offsetX,\r\n                                    offsetY,\r\n                                    '\"',\r\n                                    primaryHP,\r\n                                    secondaryHp\r\n                                );\r\n                            } else if (dotLevel === 3) {\r\n                                this.game.renderer.drawUI(\r\n                                    i + offsetX,\r\n                                    offsetY,\r\n                                    '!',\r\n                                    primaryHP,\r\n                                    secondaryHp\r\n                                );\r\n                            }\r\n                        } else if (diff > 0) {\r\n                            if (dotLevel === 1) {\r\n                                this.game.renderer.drawUI(\r\n                                    i + offsetX,\r\n                                    offsetY,\r\n                                    '',\r\n                                    primaryHP,\r\n                                    secondaryHp\r\n                                );\r\n                            } else if (dotLevel === 2) {\r\n                                this.game.renderer.drawUI(\r\n                                    i + offsetX,\r\n                                    offsetY,\r\n                                    '',\r\n                                    primaryHP,\r\n                                    secondaryHp\r\n                                );\r\n                            } else if (dotLevel === 3) {\r\n                                this.game.renderer.drawUI(\r\n                                    i + offsetX,\r\n                                    offsetY,\r\n                                    '',\r\n                                    primaryHP,\r\n                                    secondaryHp\r\n                                );\r\n                            }\r\n                        } else {\r\n                            if (dotLevel === 1) {\r\n                                this.game.renderer.drawUI(\r\n                                    i + offsetX,\r\n                                    offsetY,\r\n                                    '',\r\n                                    secondaryHp,\r\n                                    primaryHP\r\n                                );\r\n                            } else if (dotLevel === 2) {\r\n                                this.game.renderer.drawUI(\r\n                                    i + offsetX,\r\n                                    offsetY,\r\n                                    '',\r\n                                    secondaryHp,\r\n                                    primaryHP\r\n                                );\r\n                            } else if (dotLevel === 3) {\r\n                                this.game.renderer.drawUI(\r\n                                    i + offsetX,\r\n                                    offsetY,\r\n                                    '',\r\n                                    secondaryHp,\r\n                                    primaryHP\r\n                                );\r\n                            }\r\n                        }\r\n                    } else if (diff === 0.5) {\r\n                        this.game.renderer.drawUI(\r\n                            i + offsetX,\r\n                            offsetY,\r\n                            ' ',\r\n                            primaryHP,\r\n                            secondaryHp\r\n                        );\r\n                    } else if (diff > 0) {\r\n                        this.game.renderer.drawUI(\r\n                            i + offsetX,\r\n                            offsetY,\r\n                            '',\r\n                            primaryHP,\r\n                            secondaryHp\r\n                        );\r\n                    } else {\r\n                        this.game.renderer.drawUI(\r\n                            i + offsetX,\r\n                            offsetY,\r\n                            '',\r\n                            secondaryHp\r\n                        );\r\n                    }\r\n                }\r\n            }\r\n\r\n            offsetY++;\r\n        });\r\n    }\r\n\r\n    update(dt) {\r\n        if (this.showTicks) {\r\n            const turn = this.game.clock.turn;\r\n            const subTurn = `${this.game.clock.subTurn.toFixed(0)}`.padEnd(\r\n                3,\r\n                '0'\r\n            );\r\n\r\n            const str = `${turn}.${subTurn}`;\r\n            const len = Math.ceil(this.game.renderer.computeTextWidth(str));\r\n            this.game.renderer.drawText(\r\n                this.game.camera.width - 1 - len,\r\n                1,\r\n                str\r\n            );\r\n        }\r\n\r\n        const world = this.game.player.position;\r\n        const chunk = this.game.chunks.chunkCoordinate(world.x, world.y);\r\n\r\n        this.game.renderer.drawText(this.game.camera.width - 8, 1, `world (${world.x}, ${world.y})`);\r\n        this.game.renderer.drawText(this.game.camera.width - 8, 2, `chunk (${chunk.x}, ${chunk.y})`);\r\n\r\n        this.renderNearbyCreatures();\r\n    }\r\n}\r\n","import Manager from '../Manager';\n\nexport default class MouseManager extends Manager {\n    #x = 0;\n    #y = 0;\n    #hasMouse = false;\n\n    get x() {\n        return this.#x;\n    }\n\n    get y() {\n        return this.#y;\n    }\n\n    get hasMouse() {\n        return this.#hasMouse;\n    }\n\n    updatePosition(x, y) {\n        this.#x = Math.max(0, x);\n        this.#y = Math.max(0, y);\n    }\n\n    updateMouseEnter() {\n        this.#hasMouse = true;\n    }\n\n    updateMouseLeave() {\n        this.#hasMouse = false;\n    }\n}\n","import { INPUT_DOMAIN_DEFAULT } from './InputDomainType';\r\nimport commands from './commands';\r\nimport Manager from '../Manager';\r\n\r\nexport default class CommandManager extends Manager {\r\n    _commands = {};\r\n    _domainStack = [INPUT_DOMAIN_DEFAULT];\r\n    _inputStack = [];\r\n\r\n    constructor(game) {\r\n        super(game);\r\n        commands.forEach((cmd) => this.registerCommand(cmd));\r\n    }\r\n\r\n    onInputEvent(evt) {\r\n        this._inputStack.push(evt);\r\n    }\r\n\r\n    getNextCommand() {\r\n        const evt = this._inputStack.shift();\r\n\r\n        if (evt) {\r\n            return this.getCommandForInputEvent(evt);\r\n        }\r\n    }\r\n\r\n    pushDomain(domain) {\r\n        this._domainStack.push(domain);\r\n    }\r\n\r\n    popDomain(domain) {\r\n        const index = this._domainStack.lastIndexOf(domain);\r\n\r\n        if (index > -1) {\r\n            this._domainStack.splice(index, 1);\r\n        }\r\n    }\r\n\r\n    getDomainCommands(domain) {\r\n        return this._commands[domain] || [];\r\n    }\r\n\r\n    getCommandForInputEvent(evt) {\r\n        for (let i = this._domainStack.length - 1; i >= 0; i--) {\r\n            const domain = this._domainStack[i];\r\n            const cmds = this.getDomainCommands(domain);\r\n            const cmd = cmds.find((cmd) => cmd.matches(evt));\r\n\r\n            if (cmd) {\r\n                return cmd;\r\n            }\r\n        }\r\n    }\r\n\r\n    registerCommand(command) {\r\n        if (!this._commands[command.domain]) {\r\n            this._commands[command.domain] = [];\r\n        }\r\n\r\n        this._commands[command.domain].push(command);\r\n    }\r\n}\r\n","export const INPUT_DOMAIN_DEFAULT = 0;\nexport const INPUT_DOMAIN_MAIN_MENU = 1;\nexport const INPUT_DOMAIN_ADVENTURE = 2;\nexport const INPUT_DOMAIN_LOOK = 3;\nexport const INPUT_DOMAIN_LIST = 4;\n","import {\r\n    INPUT_DOMAIN_MAIN_MENU,\r\n    INPUT_DOMAIN_DEFAULT,\r\n    INPUT_DOMAIN_ADVENTURE,\r\n} from './InputDomainType';\r\nimport InputCommand from './InputCommand';\r\nimport {\r\n    INPUT_CMD_WAIT,\r\n    INPUT_CMD_MOVE_NW,\r\n    INPUT_CMD_MOVE_N,\r\n    INPUT_CMD_MOVE_NE,\r\n    INPUT_CMD_MOVE_W,\r\n    INPUT_CMD_MOVE_E,\r\n    INPUT_CMD_MOVE_SW,\r\n    INPUT_CMD_MOVE_S,\r\n    INPUT_CMD_MOVE_SE,\r\n    INPUT_CMD_CONFIRM,\r\n    INPUT_CMD_CANCEL,\r\n    INPUT_CMD_SAVE,\r\n    INPUT_CMD_LOAD,\r\n    INPUT_CMD_LOOK,\r\n    INPUT_CMD_INTERACT,\r\n    INPUT_CMD_PICK_UP,\r\n    INPUT_CMD_INVENTORY,\r\n    INPUT_CMD_EQUIPMENT,\r\n    INPUT_CMD_CHARACTER,\r\n    INPUT_CMD_SELECT_NW,\r\n    INPUT_CMD_SELECT_N,\r\n    INPUT_CMD_SELECT_NE,\r\n    INPUT_CMD_SELECT_W,\r\n    INPUT_CMD_SELECT_E,\r\n    INPUT_CMD_SELECT_SW,\r\n    INPUT_CMD_SELECT_S,\r\n    INPUT_CMD_SELECT_SE,\r\n    INPUT_CMD_NEW_GAME,\r\n    INPUT_CMD_ABILITIES,\r\n} from './InputCommandType';\r\nimport {\r\n    KEY_S,\r\n    KEY_Q,\r\n    KEY_W,\r\n    KEY_E,\r\n    KEY_A,\r\n    KEY_D,\r\n    KEY_Z,\r\n    KEY_X,\r\n    KEY_C,\r\n    KEY_ENTER,\r\n    KEY_ESCAPE,\r\n    KEY_UP,\r\n    KEY_LEFT,\r\n    KEY_RIGHT,\r\n    KEY_DOWN,\r\n    KEY_SPACE,\r\n    KEY_L,\r\n    KEY_I,\r\n    KEY_G,\r\n    KEY_J,\r\n    KEY_N,\r\n    KEY_P,\r\n    KEY_Y,\r\n    KEY_T,\r\n    KEY_O,\r\n} from './KeyCodes';\r\n\r\nconst cmd = (domain, type, name, isKeyboard, key, shift, ctrl, alt, meta) =>\r\n    new InputCommand({\r\n        domain,\r\n        type,\r\n        name,\r\n        isKeyboard,\r\n        key,\r\n        shift,\r\n        ctrl,\r\n        alt,\r\n        meta,\r\n    });\r\n\r\n// prettier-ignore\r\nexport default [\r\n    // DOMAIN                   CMD                             NAME                      KB    KEY           SHIFT  CTRL   ALT    META\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_CONFIRM,              'confirm',                true, KEY_ENTER,    false, false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_CONFIRM,              'confirm2',               true, KEY_SPACE,    false, true,  false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_CANCEL,               'cancel',                 true, KEY_ESCAPE,   false, false, false, false),\r\n    cmd(INPUT_DOMAIN_MAIN_MENU, INPUT_CMD_SAVE,                 'save',                   true, KEY_S,        false, true,  false, false),\r\n    cmd(INPUT_DOMAIN_MAIN_MENU, INPUT_CMD_LOAD,                 'load',                   true, KEY_L,        false, true,  false, false),\r\n    cmd(INPUT_DOMAIN_MAIN_MENU, INPUT_CMD_NEW_GAME,             'new game',               true, KEY_N,        false, false, false, false),\r\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_WAIT,                 'wait',                   true, KEY_S,        false, false, false, false),\r\n\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_MOVE_NW,              'move nw',                true, KEY_Q,        false, false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_MOVE_N,               'move n',                 true, KEY_W,        false, false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_MOVE_N,               'move n2',                true, KEY_UP,       false, false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_MOVE_NE,              'move ne',                true, KEY_E,        false, false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_MOVE_W,               'move w',                 true, KEY_A,        false, false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_MOVE_W,               'move w2',                true, KEY_LEFT,     false, false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_MOVE_E,               'move e',                 true, KEY_D,        false, false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_MOVE_E,               'move e2',                true, KEY_RIGHT,    false, false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_MOVE_SW,              'move sw',                true, KEY_Z,        false, false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_MOVE_S,               'move s',                 true, KEY_X,        false, false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_MOVE_S,               'move s2',                true, KEY_DOWN,     false, false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_MOVE_SE,              'move se',                true, KEY_C,        false, false, false, false),\r\n\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_SELECT_NW,            'select nw',              true, KEY_Q,        true,  false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_SELECT_N,             'select n',               true, KEY_W,        true,  false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_SELECT_N,             'select n2',              true, KEY_UP,       true,  false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_SELECT_NE,            'select ne',              true, KEY_E,        true,  false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_SELECT_W,             'select w',               true, KEY_A,        true,  false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_SELECT_W,             'select w2',              true, KEY_LEFT,     true,  false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_SELECT_E,             'select e',               true, KEY_D,        true,  false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_SELECT_E,             'select e2',              true, KEY_RIGHT,    true,  false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_SELECT_SW,            'select sw',              true, KEY_Z,        true,  false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_SELECT_S,             'select s',               true, KEY_X,        true,  false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_SELECT_S,             'select s2',              true, KEY_DOWN,     true,  false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_SELECT_SE,            'select se',              true, KEY_C,        true,  false, false, false),\r\n    cmd(INPUT_DOMAIN_DEFAULT,   INPUT_CMD_INTERACT,             'select',                 true, KEY_S,        true,  false, false, false),\r\n\r\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_LOOK,                 'look',                   true, KEY_L,        false, false, false, false),\r\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_PICK_UP,              'pick up',                true, KEY_G,        false, false, false, false),\r\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_INTERACT,             'interact',               true, KEY_J,        false, false, false, false),\r\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_INVENTORY,            'inventory',              true, KEY_I,        false, false, false, false),\r\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_EQUIPMENT,            'equipment',              true, KEY_O,        false, false, false, false),\r\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_CHARACTER,            'character',              true, KEY_P,        false, false, false, false),\r\n    cmd(INPUT_DOMAIN_ADVENTURE, INPUT_CMD_ABILITIES,            'abilities',              true, KEY_T,        false, false, false, false),\r\n];\r\n","import InputKeyboardEvent from './events/InputEvent';\n\nexport default class InputCommand {\n    constructor(data) {\n        this.domain = data.domain;\n        this.type = data.type;\n        this.name = data.name;\n        this.isKeyboard = data.isKeyboard;\n        this.key = data.key;\n        this.shift = data.shift;\n        this.ctrl = data.ctrl;\n        this.alt = data.alt;\n        this.meta = data.meta;\n    }\n\n    matches(inputEvent) {\n        const isKeyboard = inputEvent instanceof InputKeyboardEvent;\n\n        return (\n            this.isKeyboard == isKeyboard &&\n            this.key == inputEvent.key &&\n            this.shift == inputEvent.shift &&\n            this.ctrl == inputEvent.ctrl &&\n            this.alt == inputEvent.alt &&\n            this.meta == inputEvent.meta\n        );\n    }\n}\n","export const INPUT_CMD_MOVE_NW = 0;\r\nexport const INPUT_CMD_MOVE_N = 1;\r\nexport const INPUT_CMD_MOVE_NE = 2;\r\nexport const INPUT_CMD_MOVE_W = 3;\r\nexport const INPUT_CMD_MOVE_E = 4;\r\nexport const INPUT_CMD_MOVE_SW = 5;\r\nexport const INPUT_CMD_MOVE_S = 6;\r\nexport const INPUT_CMD_MOVE_SE = 7;\r\n\r\nexport const INPUT_CMD_WAIT = 8;\r\nexport const INPUT_CMD_CONFIRM = 9;\r\nexport const INPUT_CMD_CANCEL = 10;\r\nexport const INPUT_CMD_SAVE = 11;\r\nexport const INPUT_CMD_LOAD = 12;\r\nexport const INPUT_CMD_LOOK = 13;\r\n\r\nexport const INPUT_CMD_PICK_UP = 16;\r\nexport const INPUT_CMD_INTERACT = 17;\r\nexport const INPUT_CMD_INVENTORY = 19;\r\n\r\nexport const INPUT_CMD_SELECT_NW = 20;\r\nexport const INPUT_CMD_SELECT_N = 21;\r\nexport const INPUT_CMD_SELECT_NE = 22;\r\nexport const INPUT_CMD_SELECT_W = 23;\r\nexport const INPUT_CMD_SELECT_E = 24;\r\nexport const INPUT_CMD_SELECT_SW = 25;\r\nexport const INPUT_CMD_SELECT_S = 26;\r\nexport const INPUT_CMD_SELECT_SE = 27;\r\nexport const INPUT_CMD_NEW_GAME = 28;\r\n\r\nexport const INPUT_CMD_EQUIPMENT = 29;\r\nexport const INPUT_CMD_CHARACTER = 30;\r\nexport const INPUT_CMD_ABILITIES = 31;\r\n","export const KEY_CANCEL = 3;\nexport const KEY_HELP = 6;\nexport const KEY_BACK_SPACE = 8;\nexport const KEY_TAB = 9;\nexport const KEY_CLEAR = 12;\nexport const KEY_ENTER = 13;\nexport const KEY_ENTER_SPECIAL = 14;\nexport const KEY_SHIFT = 16;\nexport const KEY_CONTROL = 17;\nexport const KEY_ALT = 18;\nexport const KEY_PAUSE = 19;\nexport const KEY_CAPS_LOCK = 20;\nexport const KEY_KANA = 21;\nexport const KEY_EISU = 22;\nexport const KEY_JUNJA = 23;\nexport const KEY_FINAL = 24;\nexport const KEY_HANJA = 25;\nexport const KEY_ESCAPE = 27;\nexport const KEY_CONVERT = 28;\nexport const KEY_NONCONVERT = 29;\nexport const KEY_ACCEPT = 30;\nexport const KEY_MODECHANGE = 31;\nexport const KEY_SPACE = 32;\nexport const KEY_PAGE_UP = 33;\nexport const KEY_PAGE_DOWN = 34;\nexport const KEY_END = 35;\nexport const KEY_HOME = 36;\nexport const KEY_LEFT = 37;\nexport const KEY_UP = 38;\nexport const KEY_RIGHT = 39;\nexport const KEY_DOWN = 40;\nexport const KEY_SELECT = 41;\nexport const KEY_PRINT = 42;\nexport const KEY_EXECUTE = 43;\nexport const KEY_PRINTSCREEN = 44;\nexport const KEY_INSERT = 45;\nexport const KEY_DELETE = 46;\nexport const KEY_NUM_0 = 48;\nexport const KEY_NUM_1 = 49;\nexport const KEY_NUM_2 = 50;\nexport const KEY_NUM_3 = 51;\nexport const KEY_NUM_4 = 52;\nexport const KEY_NUM_5 = 53;\nexport const KEY_NUM_6 = 54;\nexport const KEY_NUM_7 = 55;\nexport const KEY_NUM_8 = 56;\nexport const KEY_NUM_9 = 57;\nexport const KEY_COLON = 58;\nexport const KEY_SEMICOLON = 59;\nexport const KEY_LESS_THAN = 60;\nexport const KEY_EQUALS = 61;\nexport const KEY_GREATER_THAN = 62;\nexport const KEY_QUESTION_MARK = 63;\nexport const KEY_AT = 64;\nexport const KEY_A = 65;\nexport const KEY_B = 66;\nexport const KEY_C = 67;\nexport const KEY_D = 68;\nexport const KEY_E = 69;\nexport const KEY_F = 70;\nexport const KEY_G = 71;\nexport const KEY_H = 72;\nexport const KEY_I = 73;\nexport const KEY_J = 74;\nexport const KEY_K = 75;\nexport const KEY_L = 76;\nexport const KEY_M = 77;\nexport const KEY_N = 78;\nexport const KEY_O = 79;\nexport const KEY_P = 80;\nexport const KEY_Q = 81;\nexport const KEY_R = 82;\nexport const KEY_S = 83;\nexport const KEY_T = 84;\nexport const KEY_U = 85;\nexport const KEY_V = 86;\nexport const KEY_W = 87;\nexport const KEY_X = 88;\nexport const KEY_Y = 89;\nexport const KEY_Z = 90;\nexport const KEY_META = 91; // windows key (windows) or command key (mac)\nexport const KEY_CONTEXT_MENU = 93;\nexport const KEY_SLEEP = 95;\nexport const KEY_NUMPAD_0 = 96;\nexport const KEY_NUMPAD_1 = 97;\nexport const KEY_NUMPAD_2 = 98;\nexport const KEY_NUMPAD_3 = 99;\nexport const KEY_NUMPAD_4 = 100;\nexport const KEY_NUMPAD_5 = 101;\nexport const KEY_NUMPAD_6 = 102;\nexport const KEY_NUMPAD_7 = 103;\nexport const KEY_NUMPAD_8 = 104;\nexport const KEY_NUMPAD_9 = 105;\nexport const KEY_MULTIPLY = 106;\nexport const KEY_ADD = 107;\nexport const KEY_SEPARATOR = 108;\nexport const KEY_SUBTRACT = 109;\nexport const KEY_DECIMAL = 110;\nexport const KEY_DIVIDE = 111;\nexport const KEY_F1 = 112;\nexport const KEY_F2 = 113;\nexport const KEY_F3 = 114;\nexport const KEY_F4 = 115;\nexport const KEY_F5 = 116;\nexport const KEY_F6 = 117;\nexport const KEY_F7 = 118;\nexport const KEY_F8 = 119;\nexport const KEY_F9 = 120;\nexport const KEY_F10 = 121;\nexport const KEY_F11 = 122;\nexport const KEY_F12 = 123;\nexport const KEY_F13 = 124;\nexport const KEY_F14 = 125;\nexport const KEY_F15 = 126;\nexport const KEY_F16 = 127;\nexport const KEY_F17 = 128;\nexport const KEY_F18 = 129;\nexport const KEY_F19 = 130;\nexport const KEY_F20 = 131;\nexport const KEY_F21 = 132;\nexport const KEY_F22 = 133;\nexport const KEY_F23 = 134;\nexport const KEY_F24 = 135;\nexport const KEY_NUM_LOCK = 144;\nexport const KEY_SCROLL_LOCK = 145;\nexport const KEY_WIN_OEM_FJ_JISHO = 146;\nexport const KEY_WIN_OEM_FJ_MASSHOU = 147;\nexport const KEY_WIN_OEM_FJ_TOUROKU = 148;\nexport const KEY_WIN_OEM_FJ_LOYA = 149;\nexport const KEY_WIN_OEM_FJ_ROYA = 150;\nexport const KEY_CIRCUMFLEX = 160;\nexport const KEY_EXCLAMATION = 161;\nexport const KEY_DOUBLE_QUOTE = 162;\nexport const KEY_HASH = 163;\nexport const KEY_DOLLAR = 164;\nexport const KEY_PERCENT = 165;\nexport const KEY_AMPERSAND = 166;\nexport const KEY_UNDERSCORE = 167;\nexport const KEY_OPEN_PAREN = 168;\nexport const KEY_CLOSE_PAREN = 169;\nexport const KEY_ASTERISK = 170;\nexport const KEY_PLUS = 171;\nexport const KEY_PIPE = 172;\nexport const KEY_HYPHEN_MINUS = 173;\nexport const KEY_OPEN_CURLY_BRACKET = 174;\nexport const KEY_CLOSE_CURLY_BRACKET = 175;\nexport const KEY_TILDE = 176;\nexport const KEY_VOLUME_MUTE = 181;\nexport const KEY_VOLUME_DOWN = 182;\nexport const KEY_VOLUME_UP = 183;\nexport const KEY_SEMICOLON_2 = 186;\nexport const KEY_EQUALS_2 = 187;\nexport const KEY_COMMA = 188;\nexport const KEY_MINUS = 189;\nexport const KEY_PERIOD = 190;\nexport const KEY_SLASH = 191;\nexport const KEY_BACK_QUOTE = 192;\nexport const KEY_OPEN_BRACKET = 219;\nexport const KEY_BACK_SLASH = 220;\nexport const KEY_CLOSE_BRACKET = 221;\nexport const KEY_QUOTE = 222;\nexport const KEY_META_2 = 224;\nexport const KEY_ALTGR = 225;\nexport const KEY_WIN_ICO_HELP = 227;\nexport const KEY_WIN_ICO_00 = 228;\nexport const KEY_WIN_ICO_CLEAR = 230;\nexport const KEY_WIN_OEM_RESET = 233;\nexport const KEY_WIN_OEM_JUMP = 234;\nexport const KEY_WIN_OEM_PA1 = 235;\nexport const KEY_WIN_OEM_PA2 = 236;\nexport const KEY_WIN_OEM_PA3 = 237;\nexport const KEY_WIN_OEM_WSCTRL = 238;\nexport const KEY_WIN_OEM_CUSEL = 239;\nexport const KEY_WIN_OEM_ATTN = 240;\nexport const KEY_WIN_OEM_FINISH = 241;\nexport const KEY_WIN_OEM_COPY = 242;\nexport const KEY_WIN_OEM_AUTO = 243;\nexport const KEY_WIN_OEM_ENLW = 244;\nexport const KEY_WIN_OEM_BACKTAB = 245;\nexport const KEY_ATTN = 246;\nexport const KEY_CRSEL = 247;\nexport const KEY_EXSEL = 248;\nexport const KEY_EREOF = 249;\nexport const KEY_PLAY = 250;\nexport const KEY_ZOOM = 251;\nexport const KEY_PA1 = 253;\nexport const KEY_WIN_OEM_CLEAR = 254;\n","import {\r\n    SCREEN_MAIN_MENU,\r\n    SCREEN_ADVENTURE,\r\n    SCREEN_DEATH,\r\n    SCREEN_INVENTORY,\r\n    SCREEN_INTERACT_MODAL,\r\n    SCREEN_CURSOR,\r\n    SCREEN_LOAD_AREA,\r\n    SCREEN_EQUIPMENT,\r\n    SCREEN_LIST_SELECT,\r\n    SCREEN_CHARACTER,\r\n    SCREEN_ABILITIES,\r\n    SCREEN_CONFIRM,\r\n    SCREEN_WAIT,\r\n    SCREEN_CHANNEL,\r\n} from './ScreenType';\r\nimport AdventureScreen from './screens/AdventureScreen';\r\nimport MainMenuScreen from './screens/MainMenuScreen';\r\nimport DeathScreen from './screens/DeathScreen';\r\nimport Manager from '../Manager';\r\nimport InventoryScreen from './screens/InventoryScreen';\r\nimport InteractModalScreen from './screens/InteractModalScreen';\r\nimport CursorScreen from './screens/CursorScreen';\r\nimport LoadAreaScreen from './screens/LoadAreaScreen';\r\nimport EquipmentScreen from './screens/EquipmentScreen';\r\nimport ListSelectionScreen from './screens/ListSelectionScreen';\r\nimport CharacterScreen from './screens/CharacterScreen';\r\nimport AbilityScreen from './screens/AbilityScreen';\r\nimport ConfirmationScreen from './screens/ConfirmationScreen';\r\nimport WaitScreen from './screens/WaitScreen';\r\nimport ChannelScreen from './screens/ChannelScreen';\r\n\r\nexport default class ScreenManager extends Manager {\r\n    #screens = {};\r\n    #screenStack = [];\r\n\r\n    constructor(game) {\r\n        super(game);\r\n        this.#screens = {\r\n            [SCREEN_MAIN_MENU]: new MainMenuScreen(game),\r\n            [SCREEN_ADVENTURE]: new AdventureScreen(game),\r\n            [SCREEN_DEATH]: new DeathScreen(game),\r\n            [SCREEN_INVENTORY]: new InventoryScreen(game),\r\n            [SCREEN_INTERACT_MODAL]: new InteractModalScreen(game),\r\n            [SCREEN_CURSOR]: new CursorScreen(game),\r\n            [SCREEN_LOAD_AREA]: new LoadAreaScreen(game),\r\n            [SCREEN_EQUIPMENT]: new EquipmentScreen(game),\r\n            [SCREEN_LIST_SELECT]: new ListSelectionScreen(game),\r\n            [SCREEN_CHARACTER]: new CharacterScreen(game),\r\n            [SCREEN_ABILITIES]: new AbilityScreen(game),\r\n            [SCREEN_CONFIRM]: new ConfirmationScreen(game),\r\n            [SCREEN_WAIT]: new WaitScreen(game),\r\n            [SCREEN_CHANNEL]: new ChannelScreen(game),\r\n        };\r\n        this.setScreen(SCREEN_MAIN_MENU);\r\n    }\r\n\r\n    get screenType() {\r\n        return this.#screenStack[this.#screenStack.length - 1].type;\r\n    }\r\n\r\n    get screenCtx() {\r\n        return this.#screenStack[this.#screenStack.length - 1].ctx;\r\n    }\r\n\r\n    get screen() {\r\n        return this.#screens[this.screenType];\r\n    }\r\n\r\n    setScreen(screenType, ctx = {}) {\r\n        while (this.#screenStack.length > 0) {\r\n            this.screen.onLeave(ctx);\r\n            this.#screenStack.pop();\r\n        }\r\n\r\n        this.#screenStack.push({\r\n            type: screenType,\r\n            ctx,\r\n        });\r\n        this.screen.onEnter(this.screenCtx);\r\n    }\r\n\r\n    replaceScreen(screenType, ctx = {}) {\r\n        this.screen.onLeave(ctx);\r\n        this.#screenStack.pop();\r\n        this.#screenStack.push({\r\n            type: screenType,\r\n            ctx,\r\n        });\r\n        this.screen.onEnter(this.screenCtx);\r\n    }\r\n\r\n    pushScreen(screenType, ctx = {}) {\r\n        this.screen.onLeave(ctx);\r\n        this.#screenStack.push({\r\n            type: screenType,\r\n            ctx,\r\n        });\r\n        this.screen.onEnter(this.screenCtx);\r\n    }\r\n\r\n    popScreen(ctx = {}) {\r\n        this.screen.onLeave(ctx);\r\n        this.#screenStack.pop();\r\n        this.screen.onEnter(this.screenCtx);\r\n    }\r\n\r\n    update(dt) {\r\n        this.screen.onUpdate(dt);\r\n    }\r\n}\r\n","import Screen from './Screen';\r\nimport {\r\n    INPUT_CMD_MOVE_N,\r\n    INPUT_CMD_MOVE_NE,\r\n    INPUT_CMD_MOVE_W,\r\n    INPUT_CMD_WAIT,\r\n    INPUT_CMD_MOVE_E,\r\n    INPUT_CMD_MOVE_SW,\r\n    INPUT_CMD_MOVE_S,\r\n    INPUT_CMD_MOVE_SE,\r\n    INPUT_CMD_MOVE_NW,\r\n    INPUT_CMD_CANCEL,\r\n    INPUT_CMD_SAVE,\r\n    INPUT_CMD_LOAD,\r\n    INPUT_CMD_LOOK,\r\n    INPUT_CMD_INTERACT,\r\n    INPUT_CMD_PICK_UP,\r\n    INPUT_CMD_INVENTORY,\r\n    INPUT_CMD_SELECT_NW,\r\n    INPUT_CMD_SELECT_N,\r\n    INPUT_CMD_SELECT_NE,\r\n    INPUT_CMD_SELECT_W,\r\n    INPUT_CMD_SELECT_E,\r\n    INPUT_CMD_SELECT_SW,\r\n    INPUT_CMD_SELECT_S,\r\n    INPUT_CMD_SELECT_SE,\r\n    INPUT_CMD_EQUIPMENT,\r\n    INPUT_CMD_CHARACTER,\r\n    INPUT_CMD_ABILITIES,\r\n} from '../../input/InputCommandType';\r\nimport { INPUT_DOMAIN_ADVENTURE } from '../../input/InputDomainType';\r\nimport {\r\n    DIR_N,\r\n    DIR_W,\r\n    DIR_E,\r\n    DIR_S,\r\n    DIR_NW,\r\n    DIR_SW,\r\n    DIR_SE,\r\n    DIR_NE,\r\n    directionDelta,\r\n} from '../../../enums/Directions';\r\nimport {\r\n    SCREEN_CURSOR,\r\n    SCREEN_EQUIPMENT,\r\n    SCREEN_INTERACT_MODAL,\r\n    SCREEN_INVENTORY,\r\n    SCREEN_CHARACTER,\r\n    SCREEN_LIST_SELECT,\r\n    SCREEN_MAIN_MENU,\r\n    SCREEN_ABILITIES,\r\n} from '../ScreenType';\r\nimport { Door, Loot } from '../../../ecs/components';\r\nimport { simpleCursorRenderer } from '../../../utils/cursor/SimpleCursorRenderer';\r\n\r\nexport default class AdventureScreen extends Screen {\r\n    onEnter() {\r\n        this.game.commands.pushDomain(INPUT_DOMAIN_ADVENTURE);\r\n        this.game.FOVSystem.computeFOV();\r\n\r\n        const position = this.game.player.position;\r\n\r\n        this.game.camera.setFocus(position.x, position.y);\r\n    }\r\n\r\n    onLeave() {\r\n        this.game.commands.popDomain(INPUT_DOMAIN_ADVENTURE);\r\n    }\r\n\r\n    onDirectionInput(dir) {\r\n        const delta = directionDelta(dir);\r\n        const playerPosition = this.game.player.position;\r\n        const targetPosition = {\r\n            x: playerPosition.x + delta.x,\r\n            y: playerPosition.y + delta.y,\r\n        };\r\n        const entities = this.game.map.getEntitiesAt(\r\n            targetPosition.x,\r\n            targetPosition.y\r\n        );\r\n\r\n        const hostileEntities = entities.filter((e) =>\r\n            this.game.factions.areEntitiesHostile(e, this.game.player.entity)\r\n        );\r\n\r\n        if (hostileEntities.length > 0) {\r\n            this.game.player.melee(hostileEntities[0]);\r\n        } else {\r\n            const doorEntity = entities.find((e) => e.has(Door));\r\n\r\n            if (doorEntity && !doorEntity.door.isOpen) {\r\n                doorEntity.fireEvent('try-open-door', {\r\n                    interactor: this.game.player.entity,\r\n                });\r\n            } else {\r\n                this.game.player.move(dir);\r\n            }\r\n        }\r\n    }\r\n\r\n    onPickUpCommand() {\r\n        const position = this.game.player.position;\r\n        const entities = this.game.map.getEntitiesAt(position.x, position.y);\r\n\r\n        const lootable = entities.find((entity) => entity.has(Loot));\r\n\r\n        if (lootable) {\r\n            lootable.fireEvent('try-pick-up', {\r\n                interactor: this.game.player.entity,\r\n            });\r\n        } else {\r\n            console.log('there is nothing here to pick up.');\r\n        }\r\n    }\r\n\r\n    onInteract(x, y) {\r\n        const entities = this.game.map\r\n            .getEntitiesAt(x, y)\r\n            .filter((e) => !e.isPlayer);\r\n\r\n        const items = entities.filter((entity) => {\r\n            const evt = entity.fireEvent('get-interactions', {\r\n                interactor: this.game.player.entity,\r\n                interactions: [],\r\n            });\r\n\r\n            return evt.data.interactions.length > 0;\r\n        });\r\n\r\n        if (items.length <= 0) {\r\n            return;\r\n        }\r\n\r\n        if (items.length == 1) {\r\n            this.game.screens.pushScreen(SCREEN_INTERACT_MODAL, {\r\n                interactor: this.game.player.entity,\r\n                interactable: items[0],\r\n            });\r\n            return;\r\n        }\r\n\r\n        items.sort((a, b) => (a.glyph.z < b.glyph.z ? 1 : -1));\r\n\r\n        game.screens.pushScreen(SCREEN_LIST_SELECT, {\r\n            header: `Ground`,\r\n            leadText: 'Select an item to interact',\r\n            list: items,\r\n            onRenderRow: (item, x, y, isSelected) => {\r\n                const text = ` ${item.moniker.display}`;\r\n\r\n                this.game.renderer.draw(\r\n                    x + 1,\r\n                    y,\r\n                    item.glyph.char,\r\n                    item.glyph.primary,\r\n                    item.glyph.secondary,\r\n                    item.glyph.background\r\n                );\r\n\r\n                if (isSelected) {\r\n                    this.game.renderer.drawText(x, y, '', 'yellow');\r\n                    this.game.renderer.drawText(x + 2, y, text, 'yellow');\r\n                } else {\r\n                    this.game.renderer.drawText(x, y, '-');\r\n                    this.game.renderer.drawText(x + 2, y, text);\r\n                }\r\n            },\r\n            onSelect: (item) => {\r\n                this.game.screens.replaceScreen(SCREEN_INTERACT_MODAL, {\r\n                    interactor: this.game.player.entity,\r\n                    interactable: item,\r\n                });\r\n            },\r\n        });\r\n    }\r\n\r\n    onInteractDirection(dir) {\r\n        const delta = directionDelta(dir);\r\n        const playerPosition = this.game.player.position;\r\n        const targetPosition = {\r\n            x: playerPosition.x + delta.x,\r\n            y: playerPosition.y + delta.y,\r\n        };\r\n\r\n        this.onInteract(targetPosition.x, targetPosition.y);\r\n    }\r\n\r\n    handleInput() {\r\n        const cmd = this.game.commands.getNextCommand();\r\n\r\n        if (!cmd) {\r\n            return;\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_SAVE) {\r\n            this.game.state.saveGame();\r\n        }\r\n        if (cmd.type === INPUT_CMD_LOAD) {\r\n            this.game.state.loadGame();\r\n        }\r\n        if (cmd.type === INPUT_CMD_LOOK) {\r\n            game.screens.pushScreen(SCREEN_CURSOR, {\r\n                drawTags: true,\r\n                drawFaction: true,\r\n                drawTemperature: true,\r\n                renderer: simpleCursorRenderer(),\r\n                onResult: () => game.screens.popScreen(),\r\n                onCancel: () => game.screens.popScreen(),\r\n            });\r\n        }\r\n        if (cmd.type === INPUT_CMD_PICK_UP) {\r\n            this.onPickUpCommand();\r\n        }\r\n        if (cmd.type === INPUT_CMD_INTERACT) {\r\n            const pos = this.game.player.position;\r\n\r\n            this.onInteract(pos.x, pos.y);\r\n        }\r\n        if (cmd.type === INPUT_CMD_INVENTORY) {\r\n            this.game.screens.pushScreen(SCREEN_INVENTORY, {\r\n                accessible: this.game.player.entity,\r\n                accessor: this.game.player.entity,\r\n            });\r\n        }\r\n        if (cmd.type === INPUT_CMD_ABILITIES) {\r\n            this.game.screens.pushScreen(SCREEN_ABILITIES, {\r\n                character: this.game.player.entity,\r\n            });\r\n        }\r\n        if (cmd.type === INPUT_CMD_EQUIPMENT) {\r\n            this.game.screens.pushScreen(SCREEN_EQUIPMENT, {\r\n                accessor: this.game.player.entity,\r\n            });\r\n        }\r\n        if (cmd.type === INPUT_CMD_CHARACTER) {\r\n            this.game.screens.pushScreen(SCREEN_CHARACTER, {\r\n                character: this.game.player.entity,\r\n            });\r\n        }\r\n        if (cmd.type === INPUT_CMD_CANCEL) {\r\n            this.game.screens.setScreen(SCREEN_MAIN_MENU);\r\n        }\r\n        if (cmd.type === INPUT_CMD_WAIT) {\r\n            this.game.player.wait();\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_NW) {\r\n            this.onDirectionInput(DIR_NW);\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_N) {\r\n            this.onDirectionInput(DIR_N);\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_NE) {\r\n            this.onDirectionInput(DIR_NE);\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_W) {\r\n            this.onDirectionInput(DIR_W);\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_E) {\r\n            this.onDirectionInput(DIR_E);\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_SW) {\r\n            this.onDirectionInput(DIR_SW);\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_S) {\r\n            this.onDirectionInput(DIR_S);\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_SE) {\r\n            this.onDirectionInput(DIR_SE);\r\n        }\r\n        if (cmd.type === INPUT_CMD_SELECT_NW) {\r\n            this.onInteractDirection(DIR_NW);\r\n        }\r\n        if (cmd.type === INPUT_CMD_SELECT_N) {\r\n            this.onInteractDirection(DIR_N);\r\n        }\r\n        if (cmd.type === INPUT_CMD_SELECT_NE) {\r\n            this.onInteractDirection(DIR_NE);\r\n        }\r\n        if (cmd.type === INPUT_CMD_SELECT_W) {\r\n            this.onInteractDirection(DIR_W);\r\n        }\r\n        if (cmd.type === INPUT_CMD_SELECT_E) {\r\n            this.onInteractDirection(DIR_E);\r\n        }\r\n        if (cmd.type === INPUT_CMD_SELECT_SW) {\r\n            this.onInteractDirection(DIR_SW);\r\n        }\r\n        if (cmd.type === INPUT_CMD_SELECT_S) {\r\n            this.onInteractDirection(DIR_S);\r\n        }\r\n        if (cmd.type === INPUT_CMD_SELECT_SE) {\r\n            this.onInteractDirection(DIR_SE);\r\n        }\r\n    }\r\n\r\n    onUpdate(dt) {\r\n        this.handleInput();\r\n        this.game.updateAdventureSystems(dt);\r\n    }\r\n}\r\n","export default class Screen {\r\n    #game;\r\n\r\n    get game() {\r\n        return this.#game;\r\n    }\r\n\r\n    constructor(game) {\r\n        this.#game = game;\r\n    }\r\n\r\n    onEnter() {}\r\n\r\n    onLeave() {}\r\n\r\n    onUpdate(dt) {}\r\n}\r\n","import Screen from './Screen';\r\nimport {\r\n    INPUT_CMD_CONFIRM,\r\n    INPUT_CMD_SAVE,\r\n    INPUT_CMD_LOAD,\r\n    INPUT_CMD_NEW_GAME,\r\n} from '../../input/InputCommandType';\r\nimport { INPUT_DOMAIN_MAIN_MENU } from '../../input/InputDomainType';\r\nimport { SCREEN_ADVENTURE } from '../ScreenType';\r\nimport {\r\n    UI_GLYPH_BORDER_T,\r\n    UI_GLYPH_BORDER_TERM_L,\r\n    UI_GLYPH_BORDER_TERM_R,\r\n} from '../../../enums/UIGlyphs';\r\nimport { UI_BORDER_FG1, UI_BORDER_FG2 } from '../../../utils/UIWindowUtil';\r\n\r\nexport default class MainMenuScreen extends Screen {\r\n    onEnter() {\r\n        this.game.commands.pushDomain(INPUT_DOMAIN_MAIN_MENU);\r\n\r\n        if (!this.game.state.isStarted) {\r\n            this.game.music.play('BARDS_TALE');\r\n        }\r\n    }\r\n\r\n    onLeave() {\r\n        this.game.commands.popDomain(INPUT_DOMAIN_MAIN_MENU);\r\n    }\r\n\r\n    onConfirm() {\r\n        if (this.game.state.isStarted) {\r\n            this.game.screens.setScreen(SCREEN_ADVENTURE);\r\n        } else {\r\n            this.game.state.newGame();\r\n        }\r\n    }\r\n\r\n    inputCommand() {\r\n        const cmd = this.game.commands.getNextCommand();\r\n\r\n        if (!cmd) {\r\n            return;\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CONFIRM) {\r\n            this.onConfirm();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_SAVE) {\r\n            this.game.state.saveGame();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_LOAD) {\r\n            this.game.state.loadGame();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_NEW_GAME) {\r\n            this.game.state.newGame();\r\n        }\r\n    }\r\n\r\n    onUpdate(dt) {\r\n        this.inputCommand();\r\n        this.game.renderer.clear();\r\n        this.game.renderer.draw(2, 1, '@', '#adb8bc', '#66a3dc');\r\n        this.game.renderer.drawText(3, 1, ` Sleepy Crawler`, '#66a3dc');\r\n\r\n        for (let i = 1; i < this.game.camera.width - 1; i++) {\r\n            if (i === 1) {\r\n                this.game.renderer.drawUI(\r\n                    i,\r\n                    2,\r\n                    UI_GLYPH_BORDER_TERM_L,\r\n                    UI_BORDER_FG1,\r\n                    UI_BORDER_FG2\r\n                );\r\n            } else if (i === this.game.camera.width - 2) {\r\n                this.game.renderer.drawUI(\r\n                    i,\r\n                    2,\r\n                    UI_GLYPH_BORDER_TERM_R,\r\n                    UI_BORDER_FG1,\r\n                    UI_BORDER_FG2\r\n                );\r\n            } else {\r\n                this.game.renderer.drawUI(\r\n                    i,\r\n                    2,\r\n                    UI_GLYPH_BORDER_T,\r\n                    UI_BORDER_FG1,\r\n                    UI_BORDER_FG2\r\n                );\r\n            }\r\n        }\r\n\r\n        this.game.renderer.drawText(2, 4, ` Movement`);\r\n        this.game.renderer.drawText(3, 6, `Q  W  E`);\r\n        this.game.renderer.drawText(3, 7, `A      D`);\r\n        this.game.renderer.drawText(3, 8, `Z  X  C`);\r\n        this.game.renderer.drawText(\r\n            3,\r\n            10,\r\n            `hold [SHIFT] and a direction to interact`\r\n        );\r\n\r\n        this.game.renderer.drawText(2, 12, ` Look [L]`);\r\n        this.game.renderer.drawText(2, 13, ` Inventory [I]`);\r\n        this.game.renderer.drawText(2, 14, ` Player Character [P]`);\r\n        this.game.renderer.drawText(2, 15, ` Equipment [O]`);\r\n        this.game.renderer.drawText(2, 16, ` Abilities [T]`);\r\n        this.game.renderer.drawText(2, 17, ` Confirm [ENTER]`);\r\n        this.game.renderer.drawText(2, 18, ` Cancel [ESC]`);\r\n\r\n        this.game.renderer.drawTextCenter(20, `set out into the forest...`);\r\n        this.game.renderer.drawTextCenter(22, `press [ENTER]`, '#213942');\r\n    }\r\n}\r\n","export const UI_GLYPH_BORDER_TL = '';\r\nexport const UI_GLYPH_BORDER_T = '';\r\nexport const UI_GLYPH_BORDER_TR = '';\r\nexport const UI_GLYPH_BORDER_L = '';\r\nexport const UI_GLYPH_BORDER_R = '';\r\nexport const UI_GLYPH_BORDER_BL = '';\r\nexport const UI_GLYPH_BORDER_B = '';\r\nexport const UI_GLYPH_BORDER_BR = '';\r\nexport const UI_GLYPH_BORDER_TERM_R = '';\r\nexport const UI_GLYPH_BORDER_TERM_L = '';\r\n","import { game } from '../core/Game';\r\nimport {\r\n    UI_GLYPH_BORDER_T,\r\n    UI_GLYPH_BORDER_B,\r\n    UI_GLYPH_BORDER_L,\r\n    UI_GLYPH_BORDER_R,\r\n    UI_GLYPH_BORDER_TL,\r\n    UI_GLYPH_BORDER_TR,\r\n    UI_GLYPH_BORDER_BL,\r\n    UI_GLYPH_BORDER_BR,\r\n    UI_GLYPH_BORDER_TERM_R,\r\n    UI_GLYPH_BORDER_TERM_L,\r\n} from '../enums/UIGlyphs';\r\n\r\nexport const UI_BORDER_FG1 = '#405362';\r\nexport const UI_BORDER_FG2 = '#979545';\r\n\r\nexport const drawUIBox = (x, y, width, height) => {\r\n    game.renderer.clearArea(x, y, width + 1, height + 1);\r\n\r\n    for (let i = x; i < x + width; i++) {\r\n        game.renderer.drawUI(\r\n            i,\r\n            y,\r\n            UI_GLYPH_BORDER_T,\r\n            UI_BORDER_FG1,\r\n            UI_BORDER_FG2\r\n        );\r\n        game.renderer.drawUI(\r\n            i,\r\n            y + height,\r\n            UI_GLYPH_BORDER_B,\r\n            UI_BORDER_FG1,\r\n            UI_BORDER_FG2\r\n        );\r\n    }\r\n\r\n    for (let i = y; i < y + height; i++) {\r\n        game.renderer.drawUI(\r\n            x,\r\n            i,\r\n            UI_GLYPH_BORDER_L,\r\n            UI_BORDER_FG1,\r\n            UI_BORDER_FG2\r\n        );\r\n        game.renderer.drawUI(\r\n            x + width,\r\n            i,\r\n            UI_GLYPH_BORDER_R,\r\n            UI_BORDER_FG1,\r\n            UI_BORDER_FG2\r\n        );\r\n    }\r\n\r\n    game.renderer.drawUI(\r\n        x,\r\n        y,\r\n        UI_GLYPH_BORDER_TL,\r\n        UI_BORDER_FG1,\r\n        UI_BORDER_FG2\r\n    );\r\n    game.renderer.drawUI(\r\n        x + width,\r\n        y,\r\n        UI_GLYPH_BORDER_TR,\r\n        UI_BORDER_FG1,\r\n        UI_BORDER_FG2\r\n    );\r\n    game.renderer.drawUI(\r\n        x,\r\n        y + height,\r\n        UI_GLYPH_BORDER_BL,\r\n        UI_BORDER_FG1,\r\n        UI_BORDER_FG2\r\n    );\r\n    game.renderer.drawUI(\r\n        x + width,\r\n        y + height,\r\n        UI_GLYPH_BORDER_BR,\r\n        UI_BORDER_FG1,\r\n        UI_BORDER_FG2\r\n    );\r\n};\r\n\r\nexport const drawUIWindow = (x, y, width, height, title, icon) => {\r\n    drawUIBox(x, y, width, height);\r\n\r\n    const titleText = icon ? ` ${title}` : title;\r\n    const titleWidth = Math.ceil(game.renderer.computeTextWidth(titleText));\r\n\r\n    const titleOffset = x + 2;\r\n    const iconWidth = icon ? 1 : 0;\r\n\r\n    game.renderer.drawUI(\r\n        titleOffset - 1,\r\n        y,\r\n        UI_GLYPH_BORDER_TERM_R,\r\n        UI_BORDER_FG1,\r\n        UI_BORDER_FG2\r\n    );\r\n    game.renderer.drawUI(\r\n        titleOffset + iconWidth + titleWidth,\r\n        y,\r\n        UI_GLYPH_BORDER_TERM_L,\r\n        UI_BORDER_FG1,\r\n        UI_BORDER_FG2\r\n    );\r\n\r\n    if (icon) {\r\n        game.renderer.draw(\r\n            titleOffset,\r\n            y,\r\n            icon.char,\r\n            icon.primary,\r\n            icon.secondary,\r\n            icon.background\r\n        );\r\n    }\r\n\r\n    game.renderer.drawText(titleOffset + iconWidth, y, titleText);\r\n};\r\n","import Screen from './Screen';\r\nimport { INPUT_CMD_CONFIRM } from '../../input/InputCommandType';\r\nimport { INPUT_DOMAIN_MAIN_MENU } from '../../input/InputDomainType';\r\nimport { SCREEN_MAIN_MENU } from '../ScreenType';\r\n\r\nexport default class DeathScreen extends Screen {\r\n    onEnter() {\r\n        this.game.state.gameOver();\r\n        this.game.commands.pushDomain(INPUT_DOMAIN_MAIN_MENU);\r\n    }\r\n\r\n    onLeave() {\r\n        this.game.commands.popDomain(INPUT_DOMAIN_MAIN_MENU);\r\n    }\r\n\r\n    handleInput() {\r\n        const cmd = this.game.commands.getNextCommand();\r\n\r\n        if (!cmd) {\r\n            return;\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CONFIRM) {\r\n            this.game.screens.setScreen(SCREEN_MAIN_MENU);\r\n        }\r\n    }\r\n\r\n    onUpdate(dt) {\r\n        this.handleInput();\r\n        this.game.renderSystem.update(dt);\r\n\r\n        const text = 'you have succumbed to the forest';\r\n\r\n        this.game.renderer.drawTextCenter(10, text, '#ce5454', '#ce5454');\r\n    }\r\n}\r\n","import Screen from './Screen';\r\nimport {\r\n    INPUT_CMD_CONFIRM,\r\n    INPUT_CMD_CANCEL,\r\n    INPUT_CMD_MOVE_N,\r\n    INPUT_CMD_MOVE_S,\r\n} from '../../input/InputCommandType';\r\nimport { INPUT_DOMAIN_MAIN_MENU } from '../../input/InputDomainType';\r\nimport { SCREEN_INTERACT_MODAL } from '../ScreenType';\r\nimport SelectableList from '../../../utils/SelectableList';\r\n\r\nexport default class InventoryScreen extends Screen {\r\n    #accessible;\r\n    #accessor;\r\n    list = new SelectableList();\r\n\r\n    onEnter(ctx) {\r\n        this.game.commands.pushDomain(INPUT_DOMAIN_MAIN_MENU);\r\n        this.#accessible = ctx.accessible;\r\n        this.#accessor = ctx.accessor;\r\n        this.list.setItems(this.#accessible.inventory.content);\r\n    }\r\n\r\n    onLeave() {\r\n        this.game.commands.popDomain(INPUT_DOMAIN_MAIN_MENU);\r\n    }\r\n\r\n    selectItem() {\r\n        const interactable = this.list.selected;\r\n\r\n        if (interactable) {\r\n            this.game.screens.pushScreen(SCREEN_INTERACT_MODAL, {\r\n                interactable,\r\n                interactor: this.#accessor,\r\n            });\r\n        }\r\n    }\r\n\r\n    handleInput() {\r\n        const cmd = this.game.commands.getNextCommand();\r\n\r\n        if (!cmd) {\r\n            return;\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CANCEL) {\r\n            this.game.screens.popScreen();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_MOVE_N) {\r\n            this.list.up();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_MOVE_S) {\r\n            this.list.down();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CONFIRM) {\r\n            this.selectItem();\r\n        }\r\n    }\r\n\r\n    onUpdate(dt) {\r\n        this.handleInput();\r\n        this.game.renderer.clear();\r\n        this.game.renderer.drawTextCenter(\r\n            3,\r\n            `~ ${this.#accessible.moniker.display} Inventory ~`,\r\n            'yellow'\r\n        );\r\n\r\n        if (this.list.items.length === 0) {\r\n            this.game.renderer.drawTextCenter(6, 'There is nothing here.');\r\n        }\r\n\r\n        this.list.data.forEach(({ item, idx, isSelected }) => {\r\n            const ypos = idx + 5;\r\n\r\n            if (isSelected) {\r\n                this.game.renderer.drawText(1, ypos, '', 'yellow');\r\n            } else {\r\n                this.game.renderer.drawText(1, ypos, '-');\r\n            }\r\n\r\n            this.game.renderer.draw(\r\n                2,\r\n                ypos,\r\n                item.glyph.char,\r\n                item.glyph.primary,\r\n                item.glyph.secondary,\r\n                item.glyph.background\r\n            );\r\n\r\n            const textLen = this.game.renderer.computeTextWidth(\r\n                item.moniker.display\r\n            );\r\n\r\n            this.game.renderer.drawText(4, ypos, item.moniker.display);\r\n\r\n            if (item.isEquipped) {\r\n                const slot = item.isEquipped.slot.name;\r\n\r\n                this.game.renderer.drawText(\r\n                    4 + textLen + 0.5,\r\n                    ypos,\r\n                    `[${slot}]`,\r\n                    '#2c3538'\r\n                );\r\n            }\r\n        });\r\n\r\n        this.game.renderer.drawText(1, 1, ' back [esc]');\r\n    }\r\n}\r\n","export default class SelectableList {\r\n    _items = [];\r\n    _idx = 0;\r\n\r\n    get selected() {\r\n        return this._items[this._idx];\r\n    }\r\n\r\n    get items() {\r\n        return this._items;\r\n    }\r\n\r\n    get data() {\r\n        return this._items.map((item, idx) => ({\r\n            item,\r\n            idx,\r\n            isSelected: idx === this._idx,\r\n        }));\r\n    }\r\n\r\n    get isEmpty() {\r\n        return this._items.length <= 0;\r\n    }\r\n\r\n    get length() {\r\n        return this._items.length;\r\n    }\r\n\r\n    constructor(items = [], idx = 0) {\r\n        this._idx = idx;\r\n        this.setItems(items);\r\n    }\r\n\r\n    setItems(items = []) {\r\n        this._items = items;\r\n        this._idx = Math.min(Math.max(this._idx, 0), this._items.length - 1);\r\n    }\r\n\r\n    up() {\r\n        this._idx--;\r\n\r\n        if (this._idx < 0) {\r\n            this._idx = this._items.length - 1;\r\n        }\r\n    }\r\n\r\n    down() {\r\n        this._idx++;\r\n\r\n        if (this._idx >= this._items.length) {\r\n            this._idx = 0;\r\n        }\r\n    }\r\n}\r\n","import Screen from './Screen';\r\nimport {\r\n    INPUT_CMD_CONFIRM,\r\n    INPUT_CMD_CANCEL,\r\n    INPUT_CMD_MOVE_N,\r\n    INPUT_CMD_MOVE_S,\r\n} from '../../input/InputCommandType';\r\nimport { INPUT_DOMAIN_MAIN_MENU } from '../../input/InputDomainType';\r\nimport SelectableList from '../../../utils/SelectableList';\r\nimport { getSkillName, getAllSkillEquippedModSums } from '../../../data/Skills';\r\nimport { drawUIWindow } from '../../../utils/UIWindowUtil';\r\n\r\nexport default class InteractModalScreen extends Screen {\r\n    #width = 18;\r\n    #height = 10;\r\n    #interactable;\r\n    #interactor;\r\n    list = new SelectableList();\r\n\r\n    get left() {\r\n        return Math.floor((this.game.camera.width - this.#width) / 2);\r\n    }\r\n\r\n    get top() {\r\n        return Math.floor((this.game.camera.height - this.#height) / 2);\r\n    }\r\n\r\n    onEnter(ctx) {\r\n        this.game.commands.pushDomain(INPUT_DOMAIN_MAIN_MENU);\r\n        this.#interactable = ctx.interactable;\r\n        this.#interactor = ctx.interactor;\r\n\r\n        this.refreshList();\r\n    }\r\n\r\n    refreshList() {\r\n        const evt = this.#interactable.fireEvent('get-interactions', {\r\n            interactor: this.#interactor,\r\n            interactions: [],\r\n        });\r\n\r\n        this.list.setItems([\r\n            ...evt.data.interactions,\r\n            {\r\n                name: 'Back',\r\n                isBack: true,\r\n            },\r\n        ]);\r\n    }\r\n\r\n    onLeave() {\r\n        this.game.commands.popDomain(INPUT_DOMAIN_MAIN_MENU);\r\n    }\r\n\r\n    selectItem() {\r\n        const interaction = this.list.selected;\r\n\r\n        if (interaction.isBack) {\r\n            this.game.screens.popScreen();\r\n            return;\r\n        }\r\n\r\n        this.#interactable.fireEvent(interaction.evt, {\r\n            interactor: this.#interactor,\r\n        });\r\n\r\n        if (this.#interactable.isDestroyed) {\r\n            this.game.screens.popScreen();\r\n\r\n            return;\r\n        }\r\n\r\n        this.refreshList();\r\n    }\r\n\r\n    handleInput() {\r\n        const cmd = this.game.commands.getNextCommand();\r\n\r\n        if (!cmd) {\r\n            return;\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CANCEL) {\r\n            this.game.screens.popScreen();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_MOVE_N) {\r\n            this.list.up();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_MOVE_S) {\r\n            this.list.down();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CONFIRM) {\r\n            this.selectItem();\r\n        }\r\n    }\r\n\r\n    onUpdate(dt) {\r\n        this.handleInput();\r\n\r\n        drawUIWindow(\r\n            this.left,\r\n            this.top,\r\n            this.#width,\r\n            this.#height,\r\n            this.#interactable.moniker.display,\r\n            this.#interactable.glyph\r\n        );\r\n\r\n        let listPadding = 2;\r\n        const xpos = this.left + 2;\r\n\r\n        if (this.#interactable.weapon) {\r\n            const weaponDmg = this.#interactable.weapon.getShortDescription(\r\n                this.#interactor\r\n            );\r\n\r\n            this.game.renderer.drawText(\r\n                xpos,\r\n                this.top + listPadding,\r\n                weaponDmg\r\n            );\r\n\r\n            listPadding += 2;\r\n        }\r\n\r\n        const modifiers = getAllSkillEquippedModSums(this.#interactable);\r\n        let hasMod = false;\r\n\r\n        Object.keys(modifiers).forEach((skill) => {\r\n            const modifier = modifiers[skill];\r\n\r\n            if (modifier === 0) {\r\n                return;\r\n            }\r\n\r\n            hasMod = true;\r\n\r\n            const name = getSkillName(skill);\r\n            const ypos = this.top + listPadding;\r\n\r\n            this.game.renderer.drawText(xpos, ypos, name);\r\n            const len = this.game.renderer.computeTextWidth(name);\r\n\r\n            if (modifier > 0) {\r\n                this.game.renderer.drawText(\r\n                    xpos + len,\r\n                    ypos,\r\n                    ` +${modifier}`,\r\n                    'green'\r\n                );\r\n            } else {\r\n                this.game.renderer.drawText(\r\n                    xpos + len,\r\n                    ypos,\r\n                    ` -${modifier}`,\r\n                    'red'\r\n                );\r\n            }\r\n\r\n            listPadding++;\r\n        });\r\n\r\n        if (hasMod) {\r\n            listPadding++;\r\n        }\r\n\r\n        this.list.data.forEach(({ item, idx, isSelected }) => {\r\n            const ypos = idx + this.top + listPadding;\r\n\r\n            if (isSelected) {\r\n                this.game.renderer.drawText(\r\n                    xpos,\r\n                    ypos,\r\n                    ` ${item.name}`,\r\n                    'yellow'\r\n                );\r\n            } else {\r\n                this.game.renderer.drawText(xpos, ypos, `- ${item.name}`);\r\n            }\r\n        });\r\n    }\r\n}\r\n","import Screen from './Screen';\r\nimport {\r\n    INPUT_CMD_MOVE_N,\r\n    INPUT_CMD_MOVE_NE,\r\n    INPUT_CMD_MOVE_W,\r\n    INPUT_CMD_MOVE_E,\r\n    INPUT_CMD_MOVE_SW,\r\n    INPUT_CMD_MOVE_S,\r\n    INPUT_CMD_MOVE_SE,\r\n    INPUT_CMD_MOVE_NW,\r\n    INPUT_CMD_CANCEL,\r\n    INPUT_CMD_CONFIRM,\r\n} from '../../input/InputCommandType';\r\nimport {\r\n    DIR_N,\r\n    DIR_W,\r\n    DIR_E,\r\n    DIR_S,\r\n    DIR_NW,\r\n    DIR_SW,\r\n    DIR_SE,\r\n    DIR_NE,\r\n    directionDelta,\r\n} from '../../../enums/Directions';\r\nimport { bresenhamLine } from '../../../utils/BresenhamLine';\r\nimport { FactionMember } from '../../../ecs/components';\r\nimport { drawTags } from '../../../utils/UITags';\r\nimport { simpleCursorRenderer } from '../../../utils/cursor/SimpleCursorRenderer';\r\n\r\nconst NOOP = () => {};\r\n\r\nexport default class CursorScreen extends Screen {\r\n    x = 0;\r\n    y = 0;\r\n    maxDistance = Infinity;\r\n    start = {};\r\n    drawTags = false;\r\n    drawFaction = false;\r\n    drawTemperature = false;\r\n    onResult = NOOP;\r\n    onCancel = NOOP;\r\n\r\n    onEnter(ctx) {\r\n        this.game.renderer.clear();\r\n        this.game.FOVSystem.computeFOV();\r\n\r\n        this.start = ctx.start || this.game.player.position;\r\n        this.drawTags = ctx.drawTags || false;\r\n        this.drawFaction = ctx.drawFaction || false;\r\n        this.drawTemperature = ctx.drawTemperature || false;\r\n        this.onResult = ctx.onResult || NOOP;\r\n        this.onCancel = ctx.onCancel || NOOP;\r\n        this.renderer = ctx.renderer || simpleCursorRenderer();\r\n        this.maxDistance = ctx.maxDistance || Infinity;\r\n\r\n        this.x = this.start.x;\r\n        this.y = this.start.y;\r\n    }\r\n\r\n    onDirectionInput(direction) {\r\n        const delta = directionDelta(direction);\r\n\r\n        if (Math.abs(this.start.x - (this.x + delta.x)) <= this.maxDistance) {\r\n            this.x += delta.x;\r\n        }\r\n        if (Math.abs(this.start.y - (this.y + delta.y)) <= this.maxDistance) {\r\n            this.y += delta.y;\r\n        }\r\n    }\r\n\r\n    onConfirm() {\r\n        const opts = this.getOpts();\r\n\r\n        if (this.renderer.isValid(opts)) {\r\n            this.onResult(opts);\r\n        }\r\n    }\r\n\r\n    onCancel() {\r\n        this.onCancel();\r\n    }\r\n\r\n    handleInput() {\r\n        const cmd = this.game.commands.getNextCommand();\r\n\r\n        if (!cmd) {\r\n            return;\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CONFIRM) {\r\n            this.onConfirm();\r\n        }\r\n        if (cmd.type === INPUT_CMD_CANCEL) {\r\n            this.onCancel();\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_NW) {\r\n            this.onDirectionInput(DIR_NW);\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_N) {\r\n            this.onDirectionInput(DIR_N);\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_NE) {\r\n            this.onDirectionInput(DIR_NE);\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_W) {\r\n            this.onDirectionInput(DIR_W);\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_E) {\r\n            this.onDirectionInput(DIR_E);\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_SW) {\r\n            this.onDirectionInput(DIR_SW);\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_S) {\r\n            this.onDirectionInput(DIR_S);\r\n        }\r\n        if (cmd.type === INPUT_CMD_MOVE_SE) {\r\n            this.onDirectionInput(DIR_SE);\r\n        }\r\n    }\r\n\r\n    getOpts() {\r\n        return {\r\n            start: {\r\n                x: this.start.x,\r\n                y: this.start.y,\r\n            },\r\n            position: {\r\n                x: this.x,\r\n                y: this.y,\r\n            },\r\n            x: this.x,\r\n            y: this.y,\r\n            screen: this.game.camera.worldToScreen(this.x, this.y),\r\n            line: bresenhamLine(this.start.x, this.start.y, this.x, this.y),\r\n        };\r\n    }\r\n\r\n    onUpdate(dt) {\r\n        this.handleInput();\r\n        this.game.updateAdventureSystems(dt);\r\n\r\n        this.renderer.render(this.getOpts());\r\n\r\n        if (this.drawTags) {\r\n            drawTags(this.x, this.y);\r\n        }\r\n\r\n        if (this.drawFaction) {\r\n            const target = this.game.map\r\n                .getEntitiesAt(this.x, this.y)\r\n                .filter((e) => e.isVisible && e.factionMember)\r\n                .pop();\r\n\r\n            const player = this.game.player.entity;\r\n\r\n            if (target) {\r\n                const faction = target.factionMember.faction;\r\n                const relation = this.game.factions.getEntityRelation(\r\n                    player,\r\n                    target\r\n                );\r\n\r\n                let disp = this.game.factions.getDisplay(relation);\r\n\r\n                this.game.renderer.drawTextCenter(\r\n                    1,\r\n                    `${faction.display} Faction [${disp}]`\r\n                );\r\n            }\r\n        }\r\n\r\n        if (this.drawTemperature) {\r\n            const tmpC = this.game.temperature.getTemperature(this.x, this.y);\r\n            const tmpF = (tmpC * 9) / 5 + 32;\r\n\r\n            this.game.renderer.drawText(\r\n                this.game.camera.width - 12,\r\n                this.game.camera.height - 1,\r\n                `${Math.round(tmpF)}F (${Math.round(tmpC)}C)`\r\n            );\r\n        }\r\n    }\r\n}\r\n","import { game } from '../core/Game';\r\n\r\nexport const drawTags = (x, y) => {\r\n    const entities = game.map\r\n        .getEntitiesAt(x, y)\r\n        .filter((e) => e.moniker && e.isVisible);\r\n    const screen = game.camera.worldToScreen(x, y);\r\n\r\n    if (screen.x < game.camera.width / 2) {\r\n        entities.forEach((entity, i) => {\r\n            const c = i === 0 ? '' : ' ';\r\n            game.renderer.drawText(screen.x + 1, screen.y + i, `${c}`, '#ddd');\r\n            game.renderer.drawText(\r\n                screen.x + 2,\r\n                screen.y + i,\r\n                entity.moniker.display + ' ',\r\n                '#111133',\r\n                'white',\r\n                '#ddd'\r\n            );\r\n        });\r\n    } else {\r\n        entities.forEach((entity, i) => {\r\n            const c = i === 0 ? '' : ' ';\r\n            game.renderer.drawText(screen.x - 1, screen.y + i, `${c}`, '#ddd');\r\n            const len = game.renderer.computeTextWidth(entity.moniker.display);\r\n            game.renderer.drawText(\r\n                screen.x - len - 1.5,\r\n                screen.y + i,\r\n                ' ' + entity.moniker.display,\r\n                '#111133',\r\n                'white',\r\n                '#ddd'\r\n            );\r\n        });\r\n    }\r\n};\r\n","import { SCREEN_ADVENTURE } from '../ScreenType';\r\nimport Screen from './Screen';\r\n\r\nexport default class LoadAreaScreen extends Screen {\r\n    #prevousArea;\r\n    #nextArea;\r\n\r\n    onEnter(ctx) {\r\n        this.#prevousArea = ctx.prevousArea;\r\n        this.#nextArea = ctx.nextArea;\r\n\r\n        this.renderLoadingText();\r\n\r\n        if (ctx.prevousArea) {\r\n            const data = this.game.state.saveGame();\r\n\r\n            data.world.areaId = ctx.nextArea.id;\r\n            data.map.playerPosition = ctx.entry;\r\n\r\n            this.game.state.loadGameData(data);\r\n\r\n            return;\r\n        }\r\n\r\n        this.game.world.onAreaLoaded(ctx.nextArea, ctx.entry);\r\n        this.game.map.onAreaLoaded(ctx.nextArea, ctx.entry);\r\n        this.game.music.onAreaLoaded(ctx.nextArea, ctx.entry);\r\n        this.game.temperature.onAreaLoaded(ctx.nextArea, ctx.entry);\r\n\r\n        this.game.screens.setScreen(SCREEN_ADVENTURE);\r\n    }\r\n\r\n    renderLoadingText() {\r\n        this.game.renderer.clear();\r\n        if (this.#prevousArea) {\r\n            const prevText = `You are leaving area ${this.#prevousArea.id}`;\r\n            this.game.renderer.drawTextCenter(11, prevText, '#ce5454');\r\n        } else {\r\n            const nextText = `You are entering area ${this.#nextArea.id}`;\r\n            this.game.renderer.drawTextCenter(11, nextText, '#ce5454');\r\n        }\r\n    }\r\n\r\n    onUpdate(dt) {\r\n        this.renderLoadingText();\r\n    }\r\n}\r\n","import Screen from './Screen';\r\nimport {\r\n    INPUT_CMD_CONFIRM,\r\n    INPUT_CMD_CANCEL,\r\n    INPUT_CMD_MOVE_N,\r\n    INPUT_CMD_MOVE_S,\r\n} from '../../input/InputCommandType';\r\nimport { INPUT_DOMAIN_MAIN_MENU } from '../../input/InputDomainType';\r\nimport { SCREEN_INTERACT_MODAL } from '../ScreenType';\r\nimport SelectableList from '../../../utils/SelectableList';\r\n\r\nexport default class EquipmentScreen extends Screen {\r\n    #accessor;\r\n    list = new SelectableList();\r\n\r\n    onEnter(ctx) {\r\n        this.game.commands.pushDomain(INPUT_DOMAIN_MAIN_MENU);\r\n        this.#accessor = ctx.accessor;\r\n        this.list.setItems(Object.values(this.#accessor.equipmentSlot));\r\n    }\r\n\r\n    onLeave() {\r\n        this.game.commands.popDomain(INPUT_DOMAIN_MAIN_MENU);\r\n    }\r\n\r\n    selectSlot() {\r\n        const interactable = this.list.selected.content;\r\n\r\n        if (interactable) {\r\n            this.game.screens.pushScreen(SCREEN_INTERACT_MODAL, {\r\n                interactable,\r\n                interactor: this.#accessor,\r\n            });\r\n        }\r\n    }\r\n\r\n    handleInput() {\r\n        const cmd = this.game.commands.getNextCommand();\r\n\r\n        if (!cmd) {\r\n            return;\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CANCEL) {\r\n            this.game.screens.popScreen();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_MOVE_N) {\r\n            this.list.up();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_MOVE_S) {\r\n            this.list.down();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CONFIRM) {\r\n            this.selectSlot();\r\n        }\r\n    }\r\n\r\n    onUpdate(dt) {\r\n        this.handleInput();\r\n        this.game.renderer.clear();\r\n        this.game.renderer.drawTextCenter(\r\n            3,\r\n            `~ ${this.#accessor.moniker.display} Equipment ~`,\r\n            'purple'\r\n        );\r\n\r\n        if (this.list.isEmpty) {\r\n            this.game.renderer.drawTextCenter(6, 'There is nothing here.');\r\n        }\r\n\r\n        this.list.data.forEach(({ item, idx, isSelected }) => {\r\n            const slot = item;\r\n            const ypos = idx + 5;\r\n            const selectedColor = 'yellow';\r\n\r\n            if (isSelected) {\r\n                this.game.renderer.drawText(\r\n                    1,\r\n                    ypos,\r\n                    ` ${slot.name}`,\r\n                    selectedColor\r\n                );\r\n                this.game.renderer.drawText(14, ypos, '', selectedColor);\r\n            } else {\r\n                this.game.renderer.drawText(1, ypos, `- ${slot.name}`);\r\n                this.game.renderer.drawText(14, ypos, '-', '#2c3538');\r\n            }\r\n\r\n            if (slot.isEmpty) {\r\n                this.game.renderer.drawText(15, ypos, '[empty]', '#2c3538');\r\n            } else {\r\n                const content = slot.content;\r\n                this.game.renderer.draw(\r\n                    15,\r\n                    ypos,\r\n                    content.glyph.char,\r\n                    content.glyph.primary,\r\n                    content.glyph.secondary,\r\n                    content.glyph.background\r\n                );\r\n                this.game.renderer.drawText(\r\n                    16,\r\n                    ypos,\r\n                    ` ${content.moniker.display}`\r\n                );\r\n            }\r\n        });\r\n\r\n        this.game.renderer.drawText(1, 1, ' back [esc]');\r\n    }\r\n}\r\n","import Screen from './Screen';\r\nimport {\r\n    INPUT_CMD_CONFIRM,\r\n    INPUT_CMD_CANCEL,\r\n    INPUT_CMD_MOVE_N,\r\n    INPUT_CMD_MOVE_S,\r\n} from '../../input/InputCommandType';\r\nimport { INPUT_DOMAIN_MAIN_MENU } from '../../input/InputDomainType';\r\nimport SelectableList from '../../../utils/SelectableList';\r\nimport { drawUIWindow } from '../../../utils/UIWindowUtil';\r\n\r\nconst NOOP = () => {};\r\n\r\nexport default class ListSelectionScreen extends Screen {\r\n    width = 18;\r\n    height = 10;\r\n    list = new SelectableList();\r\n    header = '';\r\n    icon = null;\r\n    leadText = null;\r\n\r\n    get left() {\r\n        return Math.floor((this.game.camera.width - this.width) / 2);\r\n    }\r\n\r\n    get top() {\r\n        return Math.floor((this.game.camera.height - this.height) / 2);\r\n    }\r\n\r\n    onEnter(ctx) {\r\n        this.game.commands.pushDomain(INPUT_DOMAIN_MAIN_MENU);\r\n        this.list.setItems(ctx.list || []);\r\n        this.header = ctx.header || 'Select';\r\n        this.icon = ctx.icon || null;\r\n        this.leadText = ctx.leadText || null;\r\n        this.onSelect = ctx.onSelect || NOOP;\r\n        this.onCancel = ctx.onCancel || NOOP;\r\n        this.onGetRowName = ctx.onGetRowName || NOOP;\r\n        this.onRenderRow = ctx.onRenderRow || this.defaultRowRender.bind(this);\r\n    }\r\n\r\n    onLeave() {\r\n        this.game.commands.popDomain(INPUT_DOMAIN_MAIN_MENU);\r\n    }\r\n\r\n    selectItem() {\r\n        this.onSelect(this.list.selected);\r\n    }\r\n\r\n    cancel() {\r\n        this.onCancel();\r\n        this.game.screens.popScreen();\r\n    }\r\n\r\n    handleInput() {\r\n        const cmd = this.game.commands.getNextCommand();\r\n\r\n        if (!cmd) {\r\n            return;\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CANCEL) {\r\n            this.cancel();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_MOVE_N) {\r\n            this.list.up();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_MOVE_S) {\r\n            this.list.down();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CONFIRM) {\r\n            this.selectItem();\r\n        }\r\n    }\r\n\r\n    defaultRowRender(row, x, y, isSelected) {\r\n        const text = this.onGetRowName(row, x, y, isSelected);\r\n\r\n        if (isSelected) {\r\n            this.game.renderer.drawText(x, y, ` ${text}`, 'yellow');\r\n        } else {\r\n            this.game.renderer.drawText(x, y, `- ${text}`);\r\n        }\r\n    }\r\n\r\n    onUpdate(dt) {\r\n        this.handleInput();\r\n\r\n        drawUIWindow(\r\n            this.left,\r\n            this.top,\r\n            this.width,\r\n            this.height,\r\n            this.header,\r\n            this.icon\r\n        );\r\n\r\n        let yOffset = this.top + 2;\r\n\r\n        const xpos = this.left + 2;\r\n\r\n        if (this.leadText) {\r\n            this.game.renderer.drawText(xpos, yOffset, this.leadText);\r\n\r\n            yOffset += 2;\r\n        }\r\n\r\n        this.list.data.forEach(({ item, idx, isSelected }) => {\r\n            const ypos = yOffset + idx;\r\n\r\n            this.onRenderRow(item, xpos, ypos, isSelected, idx);\r\n        });\r\n    }\r\n}\r\n","import Screen from './Screen';\r\nimport {\r\n    INPUT_CMD_CANCEL,\r\n    INPUT_CMD_CONFIRM,\r\n    INPUT_CMD_MOVE_N,\r\n    INPUT_CMD_MOVE_S,\r\n} from '../../input/InputCommandType';\r\nimport { INPUT_DOMAIN_MAIN_MENU } from '../../input/InputDomainType';\r\nimport SelectableList from '../../../utils/SelectableList';\r\nimport {\r\n    SKILL_ARMOR,\r\n    getSkillValue,\r\n    getSkillsByStat,\r\n} from '../../../data/Skills';\r\nimport { getArmorBlockPercentDisplay } from '../../../data/skills/ArmorSkill';\r\nimport { capitalize } from '../../../utils/StringUtil';\r\n\r\nconst MODE_STAT = 0;\r\nconst MODE_SKILL = 1;\r\n\r\nexport default class CharacterScreen extends Screen {\r\n    character;\r\n    mode = MODE_STAT;\r\n\r\n    onEnter(ctx) {\r\n        this.game.commands.pushDomain(INPUT_DOMAIN_MAIN_MENU);\r\n        this.character = ctx.character;\r\n\r\n        const stats = this.character.stats.all();\r\n\r\n        this.stats = new SelectableList(Object.values(stats));\r\n        this.skills = new SelectableList();\r\n    }\r\n\r\n    onLeave() {\r\n        this.game.commands.popDomain(INPUT_DOMAIN_MAIN_MENU);\r\n    }\r\n\r\n    selectItem() {\r\n        if (this.mode === MODE_STAT) {\r\n            this.mode = MODE_SKILL;\r\n        } else {\r\n            const skillPoints = this.character.level.skillPoints;\r\n\r\n            if (skillPoints > 0) {\r\n                const skill = this.skills.selected;\r\n\r\n                this.character.skills[skill.key]++;\r\n                this.character.level.skillPoints--;\r\n            }\r\n        }\r\n    }\r\n\r\n    up() {\r\n        if (this.mode === MODE_STAT) {\r\n            this.stats.up();\r\n        } else {\r\n            this.skills.up();\r\n        }\r\n    }\r\n\r\n    back() {\r\n        if (this.mode === MODE_STAT) {\r\n            this.game.screens.popScreen();\r\n        } else {\r\n            this.mode = MODE_STAT;\r\n        }\r\n    }\r\n\r\n    down() {\r\n        if (this.mode === MODE_STAT) {\r\n            this.stats.down();\r\n        } else {\r\n            this.skills.down();\r\n        }\r\n    }\r\n\r\n    handleInput() {\r\n        const cmd = this.game.commands.getNextCommand();\r\n\r\n        if (!cmd) {\r\n            return;\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CANCEL) {\r\n            this.back();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_MOVE_N) {\r\n            this.up();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_MOVE_S) {\r\n            this.down();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CONFIRM) {\r\n            this.selectItem();\r\n        }\r\n    }\r\n\r\n    renderSkills(stat, offsetY) {\r\n        this.skills.setItems(getSkillsByStat(stat.stat));\r\n\r\n        this.game.renderer.drawText(\r\n            14,\r\n            offsetY,\r\n            `${capitalize(stat.name)} skills`,\r\n            'orange'\r\n        );\r\n\r\n        this.skills.data.forEach(({ item, idx, isSelected }) => {\r\n            const skill = item;\r\n            const posY = 2 + idx + offsetY;\r\n            const value = getSkillValue(skill.key, this.character);\r\n\r\n            if (isSelected) {\r\n                const color = this.mode === MODE_SKILL ? 'yellow' : '#c1c172';\r\n\r\n                this.game.renderer.drawText(14, posY, ` ${skill.name}`, color);\r\n                this.game.renderer.drawText(22, posY, `+${value}`, color);\r\n            } else {\r\n                const selector = this.mode === MODE_SKILL ? '-' : ' ';\r\n\r\n                this.game.renderer.drawText(\r\n                    14,\r\n                    posY,\r\n                    `${selector} ${skill.name}`\r\n                );\r\n                this.game.renderer.drawText(22, posY, `+${value}`);\r\n            }\r\n        });\r\n    }\r\n\r\n    onUpdate(dt) {\r\n        this.handleInput();\r\n\r\n        this.game.renderer.clear();\r\n        this.game.renderer.drawTextCenter(\r\n            3,\r\n            `~ ${this.character.moniker.display} Character ~`,\r\n            'orange'\r\n        );\r\n\r\n        const level = this.character.level.level;\r\n        const xp = this.character.level.xp;\r\n        const nextLevelReqXp = this.character.level.nextLevelReq;\r\n\r\n        let offsetY = 5;\r\n\r\n        this.game.renderer.drawText(1, offsetY, 'level');\r\n        this.game.renderer.drawText(\r\n            8,\r\n            offsetY,\r\n            `${level} (${xp}/${nextLevelReqXp} xp)`\r\n        );\r\n\r\n        offsetY++;\r\n\r\n        const health = Math.ceil(this.character.health.value);\r\n        const healthMax = this.character.health.max;\r\n\r\n        this.game.renderer.drawText(1, offsetY, 'health');\r\n        this.game.renderer.drawText(8, offsetY, `${health}/${healthMax}`);\r\n\r\n        offsetY++;\r\n\r\n        const armor = getSkillValue(SKILL_ARMOR, this.character);\r\n        const armorPrcnt = getArmorBlockPercentDisplay(armor);\r\n\r\n        this.game.renderer.drawText(1, offsetY, 'armor');\r\n        this.game.renderer.drawText(8, offsetY, `${armor} (${armorPrcnt}%)`);\r\n\r\n        offsetY++;\r\n\r\n        const skillPoints = this.character.level.skillPoints;\r\n        const skillPointColor = skillPoints > 0 ? 'green' : undefined;\r\n\r\n        this.game.renderer.drawText(1, offsetY, 'skill points');\r\n        this.game.renderer.drawText(\r\n            8,\r\n            offsetY,\r\n            `${skillPoints}`,\r\n            skillPointColor\r\n        );\r\n\r\n        offsetY++;\r\n        offsetY++;\r\n\r\n        this.game.renderer.drawText(1, offsetY, 'Stats', 'orange');\r\n\r\n        this.stats.data.forEach(({ item, idx, isSelected }) => {\r\n            const stat = item;\r\n            const ypos = offsetY + idx + 2;\r\n            const modDir = stat.modSum >= 0 ? '+' : '-';\r\n\r\n            if (isSelected) {\r\n                const color = this.mode === MODE_STAT ? 'yellow' : '#c1c172';\r\n\r\n                this.game.renderer.drawText(\r\n                    1,\r\n                    ypos,\r\n                    ` ${stat.abbreviation} ${stat.name}`,\r\n                    color\r\n                );\r\n                this.game.renderer.drawText(\r\n                    11,\r\n                    ypos,\r\n                    `${modDir}${stat.sum}`,\r\n                    color\r\n                );\r\n            } else {\r\n                const selector = this.mode === MODE_STAT ? '-' : ' ';\r\n\r\n                this.game.renderer.drawText(\r\n                    1,\r\n                    ypos,\r\n                    `${selector} ${stat.abbreviation} ${stat.name}`\r\n                );\r\n                this.game.renderer.drawText(11, ypos, `${modDir}${stat.sum}`);\r\n            }\r\n        });\r\n\r\n        this.renderSkills(this.stats.selected, offsetY);\r\n\r\n        this.game.renderer.drawText(1, 1, ' back [esc]');\r\n    }\r\n}\r\n","export const capitalize = (str) => {\r\n    return str.charAt(0).toUpperCase() + str.slice(1);\r\n};\r\n","import Screen from './Screen';\r\nimport {\r\n    INPUT_CMD_CONFIRM,\r\n    INPUT_CMD_CANCEL,\r\n    INPUT_CMD_MOVE_N,\r\n    INPUT_CMD_MOVE_S,\r\n} from '../../input/InputCommandType';\r\nimport { INPUT_DOMAIN_MAIN_MENU } from '../../input/InputDomainType';\r\nimport SelectableList from '../../../utils/SelectableList';\r\nimport { drawUIWindow } from '../../../utils/UIWindowUtil';\r\nimport {\r\n    getAbility,\r\n    getAbilityStatus,\r\n    getStance,\r\n} from '../../../data/Abilities';\r\nimport { getAbilityTypeName } from '../../../enums/AbilityTypes';\r\nimport { SCREEN_CHANNEL, SCREEN_CONFIRM } from '../ScreenType';\r\n\r\nexport default class AbilityScreen extends Screen {\r\n    width = 18;\r\n    PADDING_RIGHT = 1;\r\n    PADDING_HEIGHT = 4;\r\n    character;\r\n    list = new SelectableList();\r\n\r\n    get left() {\r\n        return Math.floor(\r\n            this.game.camera.width - this.width - this.PADDING_RIGHT\r\n        );\r\n    }\r\n\r\n    get top() {\r\n        return this.PADDING_HEIGHT;\r\n    }\r\n\r\n    get height() {\r\n        return Math.floor(this.game.camera.height - this.PADDING_HEIGHT * 2);\r\n    }\r\n\r\n    onEnter(ctx) {\r\n        this.game.commands.pushDomain(INPUT_DOMAIN_MAIN_MENU);\r\n        this.character = ctx.character;\r\n\r\n        this.refreshList();\r\n    }\r\n\r\n    refreshList() {\r\n        const evt = this.character.fireEvent('query-abilities', {\r\n            abilities: [],\r\n        });\r\n\r\n        this.list.setItems([\r\n            ...evt.data.abilities.map((type) => getAbility(type)),\r\n            {\r\n                name: 'Back',\r\n                isBack: true,\r\n            },\r\n        ]);\r\n    }\r\n\r\n    onLeave() {\r\n        this.game.commands.popDomain(INPUT_DOMAIN_MAIN_MENU);\r\n    }\r\n\r\n    selectItem() {\r\n        const ability = this.list.selected;\r\n\r\n        if (ability.isBack) {\r\n            this.game.screens.popScreen();\r\n            return;\r\n        }\r\n\r\n        const status = getAbilityStatus(ability.key, this.character);\r\n\r\n        // is the ability on cooldown? IGNORE IT\r\n        if (status && status.isCoolingDown) {\r\n            return;\r\n        }\r\n\r\n        // is the ability toggled on?\r\n        if (status && status.isToggledOn) {\r\n            ability.toggleOff(this.character, status);\r\n            this.game.screens.popScreen();\r\n            return;\r\n        }\r\n\r\n        // is the ability a stance?\r\n        if (ability.isStance) {\r\n            const stance = getStance(this.character);\r\n\r\n            if (stance) {\r\n                this.game.screens.pushScreen(SCREEN_CONFIRM, {\r\n                    header: 'Switch stance?',\r\n                    leadText: `Only one stance can be active at a time. Do you want to switch from ${stance.ability.name} to ${ability.name}?`,\r\n                    onConfirm: () => {\r\n                        stance.ability.toggleOff(this.character, stance);\r\n                        ability.toggleOn(this.character);\r\n                        this.game.screens.popScreen();\r\n                    },\r\n                });\r\n                return;\r\n            }\r\n        }\r\n\r\n        if (!status && ability.isToggleable) {\r\n            ability.toggleOn(this.character);\r\n            this.game.screens.popScreen();\r\n            return;\r\n        }\r\n\r\n        ability.initiate(this.character, {\r\n            onConfirm: (data) => {\r\n                ability.execute(this.character, data);\r\n\r\n                this.game.screens.popScreen();\r\n\r\n                if (ability.isChanneled && this.character.isPlayer) {\r\n                    this.game.screens.pushScreen(SCREEN_CHANNEL, {\r\n                        entity: this.character,\r\n                    });\r\n                }\r\n            },\r\n            onCancel: () => {},\r\n        });\r\n    }\r\n\r\n    handleInput() {\r\n        const cmd = this.game.commands.getNextCommand();\r\n\r\n        if (!cmd) {\r\n            return;\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CANCEL) {\r\n            this.game.screens.popScreen();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_MOVE_N) {\r\n            this.list.up();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_MOVE_S) {\r\n            this.list.down();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CONFIRM) {\r\n            this.selectItem();\r\n        }\r\n    }\r\n\r\n    onUpdate(dt) {\r\n        this.game.updateAdventureSystems(dt);\r\n        this.handleInput();\r\n\r\n        drawUIWindow(\r\n            this.left,\r\n            this.top,\r\n            this.width,\r\n            this.height,\r\n            'Abilities',\r\n            this.character.glyph\r\n        );\r\n\r\n        let yOffset = this.top + 2;\r\n        let xOffset = this.left + 2;\r\n\r\n        this.list.data.forEach(({ item: ability, idx, isSelected }) => {\r\n            if (ability.isBack) {\r\n                if (isSelected) {\r\n                    this.game.renderer.drawText(\r\n                        xOffset,\r\n                        yOffset + idx,\r\n                        ' Back',\r\n                        'yellow'\r\n                    );\r\n                } else {\r\n                    this.game.renderer.drawText(\r\n                        xOffset,\r\n                        yOffset + idx,\r\n                        '- Back'\r\n                    );\r\n                }\r\n                return;\r\n            }\r\n\r\n            const display = ability.getDisplayText(this.character);\r\n\r\n            if (isSelected) {\r\n                if (display.isEnabled) {\r\n                    this.game.renderer.drawText(\r\n                        xOffset,\r\n                        yOffset + idx,\r\n                        ` ${display.text}`,\r\n                        'yellow'\r\n                    );\r\n                } else {\r\n                    this.game.renderer.drawText(\r\n                        xOffset,\r\n                        yOffset + idx,\r\n                        ` ${display.text}`,\r\n                        'gray'\r\n                    );\r\n                }\r\n            } else {\r\n                if (display.isEnabled) {\r\n                    this.game.renderer.drawText(\r\n                        xOffset,\r\n                        yOffset + idx,\r\n                        `- ${display.text}`\r\n                    );\r\n                } else {\r\n                    this.game.renderer.drawText(\r\n                        xOffset,\r\n                        yOffset + idx,\r\n                        `- ${display.text}`,\r\n                        'gray'\r\n                    );\r\n                }\r\n            }\r\n        });\r\n\r\n        const ability = this.list.selected;\r\n\r\n        if (ability.isBack) {\r\n            return;\r\n        }\r\n\r\n        const description = `${getAbilityTypeName(\r\n            ability.type\r\n        )}. ${ability.getDescription(this.character)}`;\r\n\r\n        this.game.renderer.drawTextWrapping(\r\n            xOffset,\r\n            yOffset + this.list.length + 1,\r\n            this.width - 2,\r\n            description\r\n        );\r\n    }\r\n}\r\n","import Screen from './Screen';\r\nimport {\r\n    INPUT_CMD_CONFIRM,\r\n    INPUT_CMD_CANCEL,\r\n    INPUT_CMD_MOVE_N,\r\n    INPUT_CMD_MOVE_S,\r\n    INPUT_CMD_MOVE_E,\r\n    INPUT_CMD_MOVE_W,\r\n} from '../../input/InputCommandType';\r\nimport { INPUT_DOMAIN_MAIN_MENU } from '../../input/InputDomainType';\r\nimport { drawUIWindow } from '../../../utils/UIWindowUtil';\r\n\r\nconst NOOP = () => {};\r\n\r\nconst OPT_YES = 1;\r\nconst OPT_NO = 0;\r\n\r\nexport default class ConfirmationScreen extends Screen {\r\n    width = 18;\r\n    option = 0;\r\n\r\n    get height() {\r\n        if (!this.leadText) {\r\n            return 4;\r\n        }\r\n\r\n        const textW = this.game.renderer.computeTextWidthTile(this.leadText);\r\n\r\n        return Math.ceil(textW / (this.width - 2) + 6);\r\n    }\r\n\r\n    get left() {\r\n        return Math.floor((this.game.camera.width - this.width) / 2);\r\n    }\r\n\r\n    get top() {\r\n        return Math.floor((this.game.camera.height - this.height) / 2);\r\n    }\r\n\r\n    get bottom() {\r\n        return this.top + this.height;\r\n    }\r\n\r\n    get right() {\r\n        return this.left + this.width;\r\n    }\r\n\r\n    onEnter(ctx) {\r\n        this.game.commands.pushDomain(INPUT_DOMAIN_MAIN_MENU);\r\n\r\n        this.header = ctx.header || 'Are you sure?';\r\n        this.onConfirm = ctx.onConfirm || NOOP;\r\n        this.onCancel = ctx.onCancel || NOOP;\r\n        this.onResult = ctx.onResult || NOOP;\r\n        this.confirmText = ctx.confirmText || 'confirm';\r\n        this.cancelText = ctx.cancelText || 'cancel';\r\n        this.leadText = ctx.leadText || '';\r\n    }\r\n\r\n    onLeave() {\r\n        this.game.commands.popDomain(INPUT_DOMAIN_MAIN_MENU);\r\n    }\r\n\r\n    onSelection(result) {\r\n        this.game.screens.popScreen();\r\n\r\n        if (result) {\r\n            this.onConfirm();\r\n        } else {\r\n            this.onCancel();\r\n        }\r\n\r\n        this.onResult(result);\r\n    }\r\n\r\n    toggleSelection() {\r\n        this.option = this.option ? OPT_NO : OPT_YES;\r\n    }\r\n\r\n    handleInput() {\r\n        const cmd = this.game.commands.getNextCommand();\r\n\r\n        if (!cmd) {\r\n            return;\r\n        }\r\n\r\n        if (\r\n            [\r\n                INPUT_CMD_MOVE_N,\r\n                INPUT_CMD_MOVE_E,\r\n                INPUT_CMD_MOVE_S,\r\n                INPUT_CMD_MOVE_W,\r\n            ].includes(cmd.type)\r\n        ) {\r\n            this.toggleSelection();\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CANCEL) {\r\n            this.onSelection(OPT_NO);\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CONFIRM) {\r\n            this.onSelection(this.option);\r\n        }\r\n    }\r\n\r\n    onUpdate(dt) {\r\n        this.handleInput();\r\n\r\n        drawUIWindow(this.left, this.top, this.width, this.height, this.header);\r\n\r\n        if (this.leadText) {\r\n            this.game.renderer.drawTextWrapping(\r\n                this.left + 2,\r\n                this.top + 2,\r\n                this.width - 2,\r\n                this.leadText\r\n            );\r\n        }\r\n\r\n        const cancel = this.option\r\n            ? `- ${this.cancelText}`\r\n            : ` ${this.cancelText}`;\r\n        const confirm = this.option\r\n            ? ` ${this.confirmText}`\r\n            : `- ${this.confirmText}`;\r\n\r\n        this.game.renderer.drawText(\r\n            this.left + 3,\r\n            this.bottom - 2,\r\n            cancel,\r\n            this.option ? undefined : 'yellow'\r\n        );\r\n\r\n        const textWidth = this.game.renderer.computeTextWidth(confirm);\r\n\r\n        this.game.renderer.drawText(\r\n            this.right - 2 - textWidth,\r\n            this.bottom - 2,\r\n            confirm,\r\n            this.option ? 'yellow' : undefined\r\n        );\r\n    }\r\n}\r\n","import Screen from './Screen';\r\nimport { INPUT_DOMAIN_ADVENTURE } from '../../input/InputDomainType';\r\n\r\nexport default class WaitScreen extends Screen {\r\n    time = 1000;\r\n    curTime = 0;\r\n\r\n    onEnter(ctx) {\r\n        this.time = ctx.time || 1000;\r\n        this.curTime = 0;\r\n        this.game.commands.pushDomain(INPUT_DOMAIN_ADVENTURE);\r\n    }\r\n\r\n    onLeave() {\r\n        this.game.commands.popDomain(INPUT_DOMAIN_ADVENTURE);\r\n    }\r\n\r\n    handleInput() {\r\n        const cmd = this.game.commands.getNextCommand();\r\n\r\n        if (!cmd) {\r\n            return;\r\n        }\r\n    }\r\n\r\n    onUpdate(dt) {\r\n        this.curTime += dt;\r\n\r\n        if (this.curTime >= this.time) {\r\n            this.game.screens.popScreen();\r\n            return;\r\n        }\r\n\r\n        this.handleInput();\r\n    }\r\n}\r\n","import Screen from './Screen';\r\nimport { INPUT_DOMAIN_ADVENTURE } from '../../input/InputDomainType';\r\nimport { INPUT_CMD_CANCEL, INPUT_CMD_WAIT } from '../../input/InputCommandType';\r\nimport { getChanneling } from '../../../data/Abilities';\r\n\r\nexport default class ChannelScreen extends Screen {\r\n    onEnter(ctx) {\r\n        this.entity = ctx.entity;\r\n        this.channel = getChanneling(this.entity);\r\n        this.game.commands.pushDomain(INPUT_DOMAIN_ADVENTURE);\r\n    }\r\n\r\n    onLeave() {\r\n        this.game.commands.popDomain(INPUT_DOMAIN_ADVENTURE);\r\n    }\r\n\r\n    handleInput() {\r\n        const cmd = this.game.commands.getNextCommand();\r\n\r\n        if (!cmd) {\r\n            return;\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_WAIT) {\r\n            this.channel.ability.channel(200, this.channel);\r\n        }\r\n\r\n        if (cmd.type === INPUT_CMD_CANCEL) {\r\n            this.channel.ability.cancelChannel(this.channel);\r\n        }\r\n    }\r\n\r\n    renderChanneling() {\r\n        const percent =\r\n            this.channel.currentChannelDuration / this.channel.channelDuration;\r\n        const maxLength = 16;\r\n        const length = Math.ceil(percent * maxLength * 2) / 2;\r\n        const center = Math.floor(this.game.camera.width / 2) - maxLength / 2;\r\n        const bottom = this.game.camera.height - 6;\r\n\r\n        const fract = `(${(\r\n            Math.floor(this.channel.currentChannelDuration / 100) / 10\r\n        ).toFixed(1)}/${Math.ceil(this.channel.channelDuration / 100) / 10})`;\r\n        this.game.renderer.drawTextCenter(\r\n            bottom,\r\n            `Channeling ${this.channel.ability.name} ${fract}`\r\n        );\r\n        this.game.renderer.drawTextCenter(\r\n            bottom + 2,\r\n            'press [S] to channel or [ESC] to cancel',\r\n            '#53575b'\r\n        );\r\n\r\n        for (let i = 0; i < maxLength; i++) {\r\n            const diff = length - i;\r\n\r\n            if (diff == 0.5) {\r\n                this.game.renderer.drawUI(\r\n                    center + i,\r\n                    bottom - 1,\r\n                    ' ',\r\n                    '#4685bc',\r\n                    '#2f3438'\r\n                );\r\n            } else if (diff > 0) {\r\n                this.game.renderer.drawUI(\r\n                    center + i,\r\n                    bottom - 1,\r\n                    '',\r\n                    '#4685bc'\r\n                );\r\n            } else {\r\n                this.game.renderer.drawUI(\r\n                    center + i,\r\n                    bottom - 1,\r\n                    '',\r\n                    '#2f3438'\r\n                );\r\n            }\r\n        }\r\n    }\r\n\r\n    onUpdate(dt) {\r\n        this.handleInput();\r\n\r\n        this.game.updateAdventureSystems(dt);\r\n        this.renderChanneling();\r\n\r\n        if (!this.channel.isChanneling) {\r\n            this.game.screens.popScreen();\r\n        }\r\n    }\r\n}\r\n","import Manager from './Manager';\r\nimport { directionDelta } from '../enums/Directions';\r\n\r\nexport default class PlayerManager extends Manager {\r\n    #entityId = null;\r\n    actionQueue = [];\r\n\r\n    get entity() {\r\n        return this.game.ecs.getEntity(this.#entityId);\r\n    }\r\n\r\n    get id() {\r\n        return this.#entityId;\r\n    }\r\n\r\n    get isTurn() {\r\n        return this.entity.actor.hasEnergy;\r\n    }\r\n\r\n    get position() {\r\n        return this.entity.position.getPos();\r\n    }\r\n\r\n    spawn() {\r\n        const entity = this.game.ecs.createPrefab('Player');\r\n\r\n        this.#entityId = entity.id;\r\n\r\n        return this.entity;\r\n    }\r\n\r\n    getSetupData() {\r\n        // TODO\r\n        // player.fireEvent('query-owned-entities', { ids });\r\n        // player.fireEvent('dereference-unowned-entities');\r\n        // serialize all \"owned\"\r\n        const entity = this.game.ecs.createPrefab('Player');\r\n        const entityId = entity.id;\r\n        const serialized = entity.serialize();\r\n\r\n        entity.destroy();\r\n\r\n        return {\r\n            entityId,\r\n            entity: serialized, // TODO inventory\r\n        };\r\n    }\r\n\r\n    setup(data) {\r\n        this.#entityId = data.entityId;\r\n        this.game.ecs.deserialize(data.entity);\r\n    }\r\n\r\n    getSaveGameData() {\r\n        const entityId = this.entity.id;\r\n\r\n        // gather all entities for player\r\n        const evt = this.entity.fireEvent('query-ownership', {\r\n            result: new Set([this.entity]),\r\n        });\r\n        const owned = Array.from(evt.data.result);\r\n        const serialized = this.game.ecs.serialize(owned);\r\n\r\n        owned.forEach((e) => e.destroy());\r\n\r\n        return {\r\n            entityId,\r\n            entity: serialized, // TODO inventory\r\n        };\r\n    }\r\n\r\n    teardown() {\r\n        if (this.entity) {\r\n            this.entity.destroy();\r\n        }\r\n        this.#entityId = null; // TODO does this need to destroy()?\r\n    }\r\n\r\n    getNextAction() {\r\n        return this.actionQueue.shift();\r\n    }\r\n\r\n    move(direction) {\r\n        this.actionQueue.push(() => {\r\n            const delta = directionDelta(direction);\r\n\r\n            this.entity.fireEvent('try-move', delta);\r\n        });\r\n    }\r\n\r\n    melee(target) {\r\n        this.actionQueue.push(() => {\r\n            if (target.isDestroyed || target.isDead) {\r\n                console.warn(`Melee action on destroyed target ${target}`);\r\n\r\n                return;\r\n            }\r\n\r\n            this.entity.fireEvent('try-melee', {\r\n                target,\r\n            });\r\n        });\r\n    }\r\n\r\n    wait(turns = 1) {\r\n        this.actionQueue.push(() => {\r\n            this.entity.fireEvent('energy-consumed', turns * 1000);\r\n        });\r\n    }\r\n}\r\n","import { Engine } from 'geotic';\r\n\r\nimport * as components from './components';\r\nimport * as prefabs from './prefabs';\r\nimport Manager from '../core/Manager';\r\n\r\nexport default class ECS extends Manager {\r\n    #engine;\r\n    #id = 1;\r\n\r\n    get engine() {\r\n        return this.#engine;\r\n    }\r\n\r\n    constructor(game) {\r\n        super(game);\r\n        this.#engine = new Engine();\r\n        this.#engine.idGenerator = () => `e${this.#id++}`;\r\n\r\n        Object.values(components).forEach((component) => {\r\n            this.#engine.registerComponent(component);\r\n        });\r\n\r\n        Object.values(prefabs).forEach((prefab) => {\r\n            this.#engine.registerPrefab(prefab);\r\n        });\r\n    }\r\n\r\n    teardown() {\r\n        this.destroyEntities();\r\n    }\r\n\r\n    destroyEntities() {\r\n        for (let entity of this.#engine.entities.all) {\r\n            entity.destroy();\r\n        }\r\n    }\r\n\r\n    cloneEntity(entity) {\r\n        const data = entity.serialize();\r\n\r\n        data.id = this.engine.generateId();\r\n\r\n        this.engine.deserialize(data);\r\n\r\n        return this.engine.getEntity(data.id);\r\n    }\r\n}\r\n","import Manager from './Manager';\r\nimport { SCREEN_ADVENTURE } from './screens/ScreenType';\r\n\r\nconst stringify = JSON.stringify;\r\nconst parse = JSON.parse;\r\n\r\nexport default class GameStateManager extends Manager {\r\n    #isStarted = false;\r\n    #filename = 'test';\r\n\r\n    get filename() {\r\n        return this.#filename;\r\n    }\r\n\r\n    get isStarted() {\r\n        return this.#isStarted;\r\n    }\r\n\r\n    gameOver() {\r\n        this.#isStarted = false;\r\n    }\r\n\r\n    initiateTeardown() {\r\n        this.#isStarted = false;\r\n\r\n        this.game.player.teardown();\r\n        this.game.map.teardown();\r\n        this.game.engine.teardown();\r\n        this.game.world.teardown();\r\n        this.game.temperature.teardown();\r\n        this.game.console.teardown();\r\n    }\r\n\r\n    initiateSetup(data) {\r\n        this.#isStarted = true;\r\n\r\n        this.game.clock.setup(data.clock);\r\n        this.game.player.setup(data.player);\r\n        this.game.world.setup(data.world);\r\n        this.game.map.setup(data.map);\r\n    }\r\n\r\n    newGame() {\r\n        this.#filename = prompt('Enter save name', 'hello');\r\n\r\n        if (!this.filename) {\r\n            return;\r\n        }\r\n\r\n        this.deleteFile(this.filename);\r\n\r\n        // spawn player\r\n        const player = this.game.player.spawn();\r\n        player.position.setPos(8, 8);\r\n\r\n        this.game.screens.setScreen(SCREEN_ADVENTURE);\r\n\r\n        // set screen to adventure\r\n\r\n\r\n        // const playerData = this.game.player.getSetupData();\r\n        // this.initiateTeardown();\r\n\r\n        // const data = {\r\n        //     filename: this.filename,\r\n        //     clock: this.game.clock.getSetupData(),\r\n        //     player: this.game.player.getSetupData(),\r\n        //     world: this.game.world.getSetupData(),\r\n        //     map: this.game.map.getSetupData(),\r\n        // };\r\n\r\n        // this.initiateSetup(data);\r\n    }\r\n\r\n    saveGame() {\r\n        if (!this.isStarted) {\r\n            console.warn(\"cannot save game since it's not started\");\r\n            return;\r\n        }\r\n\r\n        const data = {\r\n            filename: this.filename,\r\n            clock: this.game.clock.getSaveGameData(),\r\n            map: this.game.map.getSaveGameData(),\r\n            player: this.game.player.getSaveGameData(),\r\n            world: this.game.world.getSaveGameData(),\r\n            temperature: this.game.temperature.getSaveGameData(),\r\n        };\r\n\r\n        console.log('save data', data);\r\n\r\n        localStorage.setItem(this.filename, stringify(data));\r\n\r\n        return data;\r\n    }\r\n\r\n    deleteFile(filename) {\r\n        const files = Object.keys(localStorage);\r\n\r\n        files.forEach((file) => {\r\n            if (file.startsWith(`${filename}-`)) {\r\n                localStorage.removeItem(file);\r\n            }\r\n        });\r\n    }\r\n\r\n    saveChunkPositionData(chunkId, data) {\r\n        localStorage.setItem(\r\n            `${this.filename}-chunk-${chunkId}-positions`,\r\n            stringify(data)\r\n        );\r\n    };\r\n\r\n    loadChunkPositionData(chunkId) {\r\n        const json = localStorage.getItem(\r\n            `${this.filename}-chunk-${chunkId}-positions`\r\n        );\r\n\r\n        return json && parse(json);\r\n    }\r\n\r\n    saveChunkEntityData(chunkId, entityData) {\r\n        localStorage.setItem(\r\n            `${this.filename}-chunk-${chunkId}-entities`,\r\n            stringify(entityData)\r\n        );\r\n    }\r\n\r\n    loadChunkEntityData(chunkId) {\r\n        const json = localStorage.getItem(\r\n            `${this.filename}-chunk-${chunkId}-entities`\r\n        );\r\n\r\n        return json && parse(json);\r\n    }\r\n\r\n    saveAreaPositionData(areaId, positionData) {\r\n        localStorage.setItem(\r\n            `${this.filename}-${areaId}-positions`,\r\n            stringify(positionData)\r\n        );\r\n    }\r\n\r\n    saveAreaTemperatureData(areaId, temperatureData) {\r\n        localStorage.setItem(\r\n            `${this.filename}-${areaId}-temperatures`,\r\n            stringify(temperatureData)\r\n        );\r\n    }\r\n\r\n    saveAreaEntityData(areaId, entityData) {\r\n        localStorage.setItem(\r\n            `${this.filename}-${areaId}-entities`,\r\n            stringify(entityData)\r\n        );\r\n    }\r\n\r\n    loadAreaEntityData(areaId) {\r\n        const json = localStorage.getItem(\r\n            `${this.filename}-${areaId}-entities`\r\n        );\r\n\r\n        return json && parse(json);\r\n    }\r\n\r\n    loadAreaPositionData(areaId) {\r\n        const json = localStorage.getItem(\r\n            `${this.filename}-${areaId}-positions`\r\n        );\r\n\r\n        return json && parse(json);\r\n    }\r\n\r\n    loadAreaTemperatureData(areaId) {\r\n        const json = localStorage.getItem(\r\n            `${this.filename}-${areaId}-temperatures`\r\n        );\r\n\r\n        return json && parse(json);\r\n    }\r\n\r\n    loadSavefileData(filename) {\r\n        const json = localStorage.getItem(filename);\r\n\r\n        return json && parse(json);\r\n    }\r\n\r\n    loadGame() {\r\n        const filename = prompt('Enter save filename to load', 'test');\r\n\r\n        const data = this.loadSavefileData(filename);\r\n\r\n        if (!data) {\r\n            console.warn(`save file ${filename} not found`);\r\n        }\r\n\r\n        this.#filename = filename;\r\n\r\n        console.log('Loading game', data);\r\n\r\n        this.initiateTeardown();\r\n        this.initiateSetup(data);\r\n    }\r\n\r\n    loadGameData(data) {\r\n        this.initiateTeardown();\r\n        this.initiateSetup(data);\r\n    }\r\n}\r\n","import Manager from './Manager';\r\n\r\nexport default class ClockManager extends Manager {\r\n    #tick = 0;\r\n    #tickDelta = 0;\r\n    #turnDelta = 0;\r\n\r\n    get tick() {\r\n        return this.#tick;\r\n    }\r\n\r\n    get tickDelta() {\r\n        return this.#tickDelta;\r\n    }\r\n\r\n    get turnDelta() {\r\n        return this.#turnDelta;\r\n    }\r\n\r\n    get turn() {\r\n        return Math.floor(this.#tick / 1000);\r\n    }\r\n\r\n    get subTurn() {\r\n        return this.#tick - this.turn * 1000;\r\n    }\r\n\r\n    getSetupData() {\r\n        return {\r\n            tick: 0,\r\n            tickDelta: 0,\r\n        };\r\n    }\r\n\r\n    getSaveGameData() {\r\n        return {\r\n            tick: this.tick,\r\n            tickDelta: this.tickDelta,\r\n        };\r\n    }\r\n\r\n    setup(data) {\r\n        this.#tick = data.tick;\r\n        this.#tickDelta = data.tickDelta;\r\n    }\r\n\r\n    incrementTick(delta) {\r\n        const prevTurn = this.turn;\r\n\r\n        this.#tickDelta = delta;\r\n        this.#tick += delta;\r\n\r\n        const curTurn = this.turn;\r\n\r\n        this.#turnDelta = curTurn - prevTurn;\r\n    }\r\n\r\n    update(dt) {\r\n        this.#tickDelta = 0;\r\n        this.#turnDelta = 0;\r\n    }\r\n}\r\n","import Manager from './Manager';\r\nimport FastMap from '../utils/FastMap';\r\nimport { IsInventoried, Position } from '../ecs/components';\r\n\r\nexport default class MapManager extends Manager {\r\n    #playerOutOfBounds = null;\r\n    positions;\r\n    #width = 64;\r\n    #height = 64;\r\n\r\n    get width() {\r\n        return this.game.chunks.chunkCountX * this.game.chunks.chunkWidth;\r\n    }\r\n\r\n    get height() {\r\n        return this.game.chunks.chunkCountY * this.game.chunks.chunkHeight;\r\n    }\r\n\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        // this.query = this.game.ecs.createQuery({\r\n        //     all: [Position],\r\n        //     none: [IsInventoried],\r\n        // });\r\n\r\n        // this.positions = new FastMap(this.width, this.height);\r\n\r\n        // this.query.onEntityAdded((e) => {\r\n        //     this.positions.set(0, 0, e.id);\r\n        // });\r\n\r\n        // this.query.onEntityRemoved((e) => {\r\n        //     this.positions.remove(e.id);\r\n        // });\r\n    }\r\n\r\n    getSetupData() {\r\n        return {};\r\n    }\r\n\r\n    teardown() {\r\n        this.#playerOutOfBounds = false;\r\n        // this.positions.clear();\r\n    }\r\n\r\n    setup(data) {\r\n        if (data.playerPosition) {\r\n            this.game.player.entity.position.setPos(\r\n                data.playerPosition.x,\r\n                data.playerPosition.y\r\n            );\r\n        } else {\r\n            const position = this.getRandomEmptyPosition();\r\n            this.game.player.entity.position.setPos(position.x, position.y);\r\n        }\r\n\r\n        this.game.FOVSystem.computeFOV();\r\n    }\r\n\r\n    getSaveGameData() {\r\n        // const data = this.positions.serialize();\r\n\r\n        // this.game.state.saveAreaPositionData(this.game.world.areaId, data);\r\n\r\n        return {\r\n            playerPosition: this.game.player.position,\r\n        };\r\n    }\r\n\r\n    onAreaLoaded(area) {\r\n        // this.#playerOutOfBounds = false;\r\n\r\n        // const data = this.game.state.loadAreaPositionData(area.id);\r\n\r\n        // if (data) {\r\n        //     this.positions.deserialize(data);\r\n        // }\r\n    }\r\n\r\n    getPosition(entityId, chunkId) {\r\n        return this.game.chunks.getPosition(entityId, chunkId);\r\n    }\r\n\r\n    setPosition(x, y, entityId, chunkId) {\r\n        this.game.chunks.setPosition(x, y, entityId, chunkId);\r\n\r\n        if (entityId === this.game.player.id) {\r\n            this.game.camera.setFocus(x, y);\r\n        }\r\n    }\r\n\r\n    getEntitiesAt(x, y, includeGround = false) {\r\n        return this.game.chunks.getEntitiesAt(x, y, includeGround);\r\n        // return this.positions.get(x, y).reduce((entities, id) => {\r\n        //     const e = this.game.ecs.getEntity(id);\r\n\r\n        //     if (!e.isInventoried && (includeGround ? true : !e.ground)) {\r\n        //         entities.push(e);\r\n        //     }\r\n\r\n        //     return entities;\r\n        // }, []);\r\n    }\r\n\r\n    isAdjacent(x1, y1, x2, y2) {\r\n        return Math.abs(x1 - x2) <= 1 && Math.abs(y1 - y2) <= 1;\r\n    }\r\n\r\n    getEntitiesInRect(x, y, width, height) {\r\n        const entities = [];\r\n\r\n        for (let i = x; i < x + width + 1; i++) {\r\n            for (let j = y; j < y + height + 1; j++) {\r\n                entities.push(...this.getEntitiesAt(i, j));\r\n            }\r\n        }\r\n\r\n        return entities;\r\n    }\r\n\r\n    getEntitiesInRange(x, y, range) {\r\n        const diameter = range * 2;\r\n\r\n        return this.getEntitiesInRect(x - range, y - range, diameter, diameter);\r\n    }\r\n\r\n    getNeighborEntities(x, y) {\r\n        return [\r\n            this.getEntitiesAt(x - 1, y - 1), // TOP LEFT\r\n            this.getEntitiesAt(x, y - 1), // TOP\r\n            this.getEntitiesAt(x + 1, y - 1), // TOP RIGHT\r\n            this.getEntitiesAt(x - 1, y), // LEFT\r\n            this.getEntitiesAt(x + 1, y), // RIGHT\r\n            this.getEntitiesAt(x - 1, y + 1), // BOTTOM LEFT\r\n            this.getEntitiesAt(x, y + 1), // BOTTOM\r\n            this.getEntitiesAt(x + 1, y + 1), // BOTTOM RIGHT\r\n        ];\r\n    }\r\n\r\n    getRandomEmptyPosition() {\r\n        let x, y;\r\n        do {\r\n            x = Math.trunc(Math.random() * this.width);\r\n            y = Math.trunc(Math.random() * this.height);\r\n        } while (this.getEntitiesAt(x, y, false).length > 0);\r\n\r\n        return { x, y };\r\n    }\r\n\r\n    isOutOfbounds(x, y) {\r\n        return x < 0 || y < 0 || x >= this.width || y >= this.height;\r\n    }\r\n\r\n    onPlayerOutOfBounds(x, y) {\r\n        if (y < 0) {\r\n            this.game.world.enterArea(this.game.world.area.northArea, {\r\n                x,\r\n                y: this.height - 1,\r\n            });\r\n        }\r\n        if (y >= this.height) {\r\n            this.game.world.enterArea(this.game.world.area.southArea, {\r\n                x,\r\n                y: 0,\r\n            });\r\n        }\r\n        if (x >= this.width) {\r\n            this.game.world.enterArea(this.game.world.area.eastArea, {\r\n                x: 0,\r\n                y,\r\n            });\r\n        }\r\n        if (x < 0) {\r\n            this.game.world.enterArea(this.game.world.area.westArea, {\r\n                x: this.width - 1,\r\n                y,\r\n            });\r\n        }\r\n    }\r\n\r\n    update(dt) {\r\n        // if (this.#playerOutOfBounds) {\r\n        //     this.onPlayerOutOfBounds(\r\n        //         this.#playerOutOfBounds.x,\r\n        //         this.#playerOutOfBounds.y\r\n        //     );\r\n        // }\r\n    }\r\n}\r\n","export default class FastMap {\r\n    _width = 0;\r\n    _height = 0;\r\n    _data = [];\r\n    _idHash = new Map();\r\n\r\n    get width() {\r\n        return this._width;\r\n    }\r\n\r\n    get height() {\r\n        return this._height;\r\n    }\r\n\r\n    get size() {\r\n        return this._width * this._height;\r\n    }\r\n\r\n    constructor(width, height) {\r\n        this._width = width;\r\n        this._height = height;\r\n\r\n        for (let i = 0; i < this.size; i++) {\r\n            this._data[i] = new Set();\r\n        }\r\n    }\r\n\r\n    idx(x, y) {\r\n        return y * this.width + x;\r\n    }\r\n\r\n    coord(idx) {\r\n        return {\r\n            x: Math.trunc(idx % this.width),\r\n            y: Math.trunc(idx / this.width),\r\n        };\r\n    }\r\n\r\n    getValues() {\r\n        return Array.from(this._idHash.keys());\r\n    }\r\n\r\n    clear() {\r\n        this._idHash.clear();\r\n\r\n        for (let i = 0; i < this.size; i++) {\r\n            this._data[i].clear();\r\n        }\r\n    }\r\n\r\n    serialize() {\r\n        const entries = this._data.map((d) => Array.from(d));\r\n\r\n        return {\r\n            width: this.width,\r\n            height: this.height,\r\n            entries,\r\n        };\r\n    }\r\n\r\n    deserialize(data) {\r\n        this._width = data.width;\r\n        this._height = data.height;\r\n        this._idHash = new Map();\r\n\r\n        for (let i = 0; i < data.entries.length; i++) {\r\n            const coord = this.coord(i);\r\n            this._data[i] = new Set(data.entries[i]);\r\n\r\n            data.entries[i].forEach((id) => {\r\n                this._idHash.set(id, coord);\r\n            });\r\n        }\r\n    }\r\n\r\n    set(x, y, id) {\r\n        if (this.isOutOfBounds(x, y)) {\r\n            console.warn(\r\n                `Trying to set an entity ${id} position out-of-bounds ${x}, ${y}`\r\n            );\r\n            return;\r\n        }\r\n\r\n        const idx = this.idx(x, y);\r\n\r\n        this.remove(id);\r\n\r\n        this._idHash.set(id, { x, y });\r\n        this._data[idx].add(id);\r\n    }\r\n\r\n    get(x, y) {\r\n        if (this.isOutOfBounds(x, y)) {\r\n            return [];\r\n        }\r\n\r\n        return Array.from(this._data[this.idx(x, y)]);\r\n    }\r\n\r\n    has(id) {\r\n        return this._idHash.has(id);\r\n    }\r\n\r\n    getPosition(id) {\r\n        const pos = this._idHash.get(id);\r\n\r\n        if (!pos) {\r\n            console.warn('Cannot get position', id);\r\n        }\r\n\r\n        return pos;\r\n    }\r\n\r\n    remove(id) {\r\n        if (!this.has(id)) {\r\n            return;\r\n        }\r\n\r\n        const pos = this.getPosition(id);\r\n        const idx = this.idx(pos.x, pos.y);\r\n\r\n        this._idHash.delete(id);\r\n        this._data[idx].delete(id);\r\n    }\r\n\r\n    isOutOfBounds(x, y) {\r\n        return x < 0 || y < 0 || x >= this.width || y >= this.height;\r\n    }\r\n}\r\n","import { FOV } from 'rot-js';\r\nimport {\r\n    Explorable,\r\n    Explored,\r\n    Shadowcaster,\r\n    IsVisible,\r\n} from '../ecs/components';\r\nimport System from './System';\r\n\r\nexport default class FOVSystem extends System {\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        this.fov = new FOV.PreciseShadowcasting((x, y) =>\r\n            this.isSquareVisible(x, y)\r\n        );\r\n\r\n        this.query = this.game.ecs.createQuery({\r\n            all: [IsVisible],\r\n        });\r\n    }\r\n\r\n    isSquareVisible(x, y) {\r\n        return !this.game.map\r\n            .getEntitiesAt(x, y)\r\n            .some((e) => e.has(Shadowcaster));\r\n    }\r\n\r\n    setVisible(x, y, amount, range) {\r\n        this.game.map.getEntitiesAt(x, y, true).forEach((e) => {\r\n            e.add(IsVisible, {\r\n                range,\r\n                amount,\r\n            });\r\n            if (e.explorable && !e.explored) {\r\n                e.add(Explored);\r\n                if (e.bitmaskGlyph) {\r\n                    this.game.bitmasks.refreshMaskAndNeighbors(e);\r\n                }\r\n            }\r\n        });\r\n    }\r\n\r\n    computeFOV() {\r\n        this.query.get().forEach((e) => e.isVisible.destroy());\r\n\r\n        const pos = this.game.player.position;\r\n\r\n        this.fov.compute(pos.x, pos.y, 8, (x, y, r, visibility) => {\r\n            this.setVisible(x, y, visibility, r);\r\n        });\r\n    }\r\n\r\n    update(dt) {\r\n        if (this.game.clock.tickDelta) {\r\n            this.computeFOV();\r\n        }\r\n    }\r\n}\r\n","export { default as RNG } from \"./rng.js\";\nexport { default as Display } from \"./display/display.js\";\nexport { default as StringGenerator } from \"./stringgenerator.js\";\nexport { default as EventQueue } from \"./eventqueue.js\";\nexport { default as Scheduler } from \"./scheduler/index.js\";\nexport { default as FOV } from \"./fov/index.js\";\nexport { default as Map } from \"./map/index.js\";\nexport { default as Noise } from \"./noise/index.js\";\nexport { default as Path } from \"./path/index.js\";\nexport { default as Engine } from \"./engine.js\";\nexport { default as Lighting } from \"./lighting.js\";\nexport { DEFAULT_WIDTH, DEFAULT_HEIGHT, DIRS, KEYS } from \"./constants.js\";\nimport * as util from \"./util.js\";\nexport const Util = util;\nimport * as color from \"./color.js\";\nexport const Color = color;\nimport * as text from \"./text.js\";\nexport const Text = text;\n","/**\n * This code is an implementation of Alea algorithm; (C) 2010 Johannes Baage.\n * Alea is licensed according to the http://en.wikipedia.org/wiki/MIT_License.\n */\nconst FRAC = 2.3283064365386963e-10; /* 2^-32 */\nclass RNG {\n    constructor() {\n        this._seed = 0;\n        this._s0 = 0;\n        this._s1 = 0;\n        this._s2 = 0;\n        this._c = 0;\n    }\n    getSeed() { return this._seed; }\n    /**\n     * Seed the number generator\n     */\n    setSeed(seed) {\n        seed = (seed < 1 ? 1 / seed : seed);\n        this._seed = seed;\n        this._s0 = (seed >>> 0) * FRAC;\n        seed = (seed * 69069 + 1) >>> 0;\n        this._s1 = seed * FRAC;\n        seed = (seed * 69069 + 1) >>> 0;\n        this._s2 = seed * FRAC;\n        this._c = 1;\n        return this;\n    }\n    /**\n     * @returns Pseudorandom value [0,1), uniformly distributed\n     */\n    getUniform() {\n        let t = 2091639 * this._s0 + this._c * FRAC;\n        this._s0 = this._s1;\n        this._s1 = this._s2;\n        this._c = t | 0;\n        this._s2 = t - this._c;\n        return this._s2;\n    }\n    /**\n     * @param lowerBound The lower end of the range to return a value from, inclusive\n     * @param upperBound The upper end of the range to return a value from, inclusive\n     * @returns Pseudorandom value [lowerBound, upperBound], using ROT.RNG.getUniform() to distribute the value\n     */\n    getUniformInt(lowerBound, upperBound) {\n        let max = Math.max(lowerBound, upperBound);\n        let min = Math.min(lowerBound, upperBound);\n        return Math.floor(this.getUniform() * (max - min + 1)) + min;\n    }\n    /**\n     * @param mean Mean value\n     * @param stddev Standard deviation. ~95% of the absolute values will be lower than 2*stddev.\n     * @returns A normally distributed pseudorandom value\n     */\n    getNormal(mean = 0, stddev = 1) {\n        let u, v, r;\n        do {\n            u = 2 * this.getUniform() - 1;\n            v = 2 * this.getUniform() - 1;\n            r = u * u + v * v;\n        } while (r > 1 || r == 0);\n        let gauss = u * Math.sqrt(-2 * Math.log(r) / r);\n        return mean + gauss * stddev;\n    }\n    /**\n     * @returns Pseudorandom value [1,100] inclusive, uniformly distributed\n     */\n    getPercentage() {\n        return 1 + Math.floor(this.getUniform() * 100);\n    }\n    /**\n     * @returns Randomly picked item, null when length=0\n     */\n    getItem(array) {\n        if (!array.length) {\n            return null;\n        }\n        return array[Math.floor(this.getUniform() * array.length)];\n    }\n    /**\n     * @returns New array with randomized items\n     */\n    shuffle(array) {\n        let result = [];\n        let clone = array.slice();\n        while (clone.length) {\n            let index = clone.indexOf(this.getItem(clone));\n            result.push(clone.splice(index, 1)[0]);\n        }\n        return result;\n    }\n    /**\n     * @param data key=whatever, value=weight (relative probability)\n     * @returns whatever\n     */\n    getWeightedValue(data) {\n        let total = 0;\n        for (let id in data) {\n            total += data[id];\n        }\n        let random = this.getUniform() * total;\n        let id, part = 0;\n        for (id in data) {\n            part += data[id];\n            if (random < part) {\n                return id;\n            }\n        }\n        // If by some floating-point annoyance we have\n        // random >= total, just return the last id.\n        return id;\n    }\n    /**\n     * Get RNG state. Useful for storing the state and re-setting it via setState.\n     * @returns Internal state\n     */\n    getState() { return [this._s0, this._s1, this._s2, this._c]; }\n    /**\n     * Set a previously retrieved state.\n     */\n    setState(state) {\n        this._s0 = state[0];\n        this._s1 = state[1];\n        this._s2 = state[2];\n        this._c = state[3];\n        return this;\n    }\n    /**\n     * Returns a cloned RNG\n     */\n    clone() {\n        let clone = new RNG();\n        return clone.setState(this.getState());\n    }\n}\nexport default new RNG().setSeed(Date.now());\n","import Hex from \"./hex.js\";\nimport Rect from \"./rect.js\";\nimport Tile from \"./tile.js\";\nimport TileGL from \"./tile-gl.js\";\nimport Term from \"./term.js\";\nimport * as Text from \"../text.js\";\nimport { DEFAULT_WIDTH, DEFAULT_HEIGHT } from \"../constants.js\";\nconst BACKENDS = {\n    \"hex\": Hex,\n    \"rect\": Rect,\n    \"tile\": Tile,\n    \"tile-gl\": TileGL,\n    \"term\": Term\n};\nconst DEFAULT_OPTIONS = {\n    width: DEFAULT_WIDTH,\n    height: DEFAULT_HEIGHT,\n    transpose: false,\n    layout: \"rect\",\n    fontSize: 15,\n    spacing: 1,\n    border: 0,\n    forceSquareRatio: false,\n    fontFamily: \"monospace\",\n    fontStyle: \"\",\n    fg: \"#ccc\",\n    bg: \"#000\",\n    tileWidth: 32,\n    tileHeight: 32,\n    tileMap: {},\n    tileSet: null,\n    tileColorize: false\n};\n/**\n * @class Visual map display\n */\nlet Display = /** @class */ (() => {\n    class Display {\n        constructor(options = {}) {\n            this._data = {};\n            this._dirty = false; // false = nothing, true = all, object = dirty cells\n            this._options = {};\n            options = Object.assign({}, DEFAULT_OPTIONS, options);\n            this.setOptions(options);\n            this.DEBUG = this.DEBUG.bind(this);\n            this._tick = this._tick.bind(this);\n            this._backend.schedule(this._tick);\n        }\n        /**\n         * Debug helper, ideal as a map generator callback. Always bound to this.\n         * @param {int} x\n         * @param {int} y\n         * @param {int} what\n         */\n        DEBUG(x, y, what) {\n            let colors = [this._options.bg, this._options.fg];\n            this.draw(x, y, null, null, colors[what % colors.length]);\n        }\n        /**\n         * Clear the whole display (cover it with background color)\n         */\n        clear() {\n            this._data = {};\n            this._dirty = true;\n        }\n        /**\n         * @see ROT.Display\n         */\n        setOptions(options) {\n            Object.assign(this._options, options);\n            if (options.width || options.height || options.fontSize || options.fontFamily || options.spacing || options.layout) {\n                if (options.layout) {\n                    let ctor = BACKENDS[options.layout];\n                    this._backend = new ctor();\n                }\n                this._backend.setOptions(this._options);\n                this._dirty = true;\n            }\n            return this;\n        }\n        /**\n         * Returns currently set options\n         */\n        getOptions() { return this._options; }\n        /**\n         * Returns the DOM node of this display\n         */\n        getContainer() { return this._backend.getContainer(); }\n        /**\n         * Compute the maximum width/height to fit into a set of given constraints\n         * @param {int} availWidth Maximum allowed pixel width\n         * @param {int} availHeight Maximum allowed pixel height\n         * @returns {int[2]} cellWidth,cellHeight\n         */\n        computeSize(availWidth, availHeight) {\n            return this._backend.computeSize(availWidth, availHeight);\n        }\n        /**\n         * Compute the maximum font size to fit into a set of given constraints\n         * @param {int} availWidth Maximum allowed pixel width\n         * @param {int} availHeight Maximum allowed pixel height\n         * @returns {int} fontSize\n         */\n        computeFontSize(availWidth, availHeight) {\n            return this._backend.computeFontSize(availWidth, availHeight);\n        }\n        computeTileSize(availWidth, availHeight) {\n            let width = Math.floor(availWidth / this._options.width);\n            let height = Math.floor(availHeight / this._options.height);\n            return [width, height];\n        }\n        /**\n         * Convert a DOM event (mouse or touch) to map coordinates. Uses first touch for multi-touch.\n         * @param {Event} e event\n         * @returns {int[2]} -1 for values outside of the canvas\n         */\n        eventToPosition(e) {\n            let x, y;\n            if (\"touches\" in e) {\n                x = e.touches[0].clientX;\n                y = e.touches[0].clientY;\n            }\n            else {\n                x = e.clientX;\n                y = e.clientY;\n            }\n            return this._backend.eventToPosition(x, y);\n        }\n        /**\n         * @param {int} x\n         * @param {int} y\n         * @param {string || string[]} ch One or more chars (will be overlapping themselves)\n         * @param {string} [fg] foreground color\n         * @param {string} [bg] background color\n         */\n        draw(x, y, ch, fg, bg) {\n            if (!fg) {\n                fg = this._options.fg;\n            }\n            if (!bg) {\n                bg = this._options.bg;\n            }\n            let key = `${x},${y}`;\n            this._data[key] = [x, y, ch, fg, bg];\n            if (this._dirty === true) {\n                return;\n            } // will already redraw everything \n            if (!this._dirty) {\n                this._dirty = {};\n            } // first!\n            this._dirty[key] = true;\n        }\n        /**\n         * Draws a text at given position. Optionally wraps at a maximum length. Currently does not work with hex layout.\n         * @param {int} x\n         * @param {int} y\n         * @param {string} text May contain color/background format specifiers, %c{name}/%b{name}, both optional. %c{}/%b{} resets to default.\n         * @param {int} [maxWidth] wrap at what width?\n         * @returns {int} lines drawn\n         */\n        drawText(x, y, text, maxWidth) {\n            let fg = null;\n            let bg = null;\n            let cx = x;\n            let cy = y;\n            let lines = 1;\n            if (!maxWidth) {\n                maxWidth = this._options.width - x;\n            }\n            let tokens = Text.tokenize(text, maxWidth);\n            while (tokens.length) { // interpret tokenized opcode stream\n                let token = tokens.shift();\n                switch (token.type) {\n                    case Text.TYPE_TEXT:\n                        let isSpace = false, isPrevSpace = false, isFullWidth = false, isPrevFullWidth = false;\n                        for (let i = 0; i < token.value.length; i++) {\n                            let cc = token.value.charCodeAt(i);\n                            let c = token.value.charAt(i);\n                            if (this._options.layout === \"term\") {\n                                let cch = cc >> 8;\n                                let isCJK = cch === 0x11 || (cch >= 0x2e && cch <= 0x9f) || (cch >= 0xac && cch <= 0xd7) || (cc >= 0xA960 && cc <= 0xA97F);\n                                if (isCJK) {\n                                    this.draw(cx + 0, cy, c, fg, bg);\n                                    this.draw(cx + 1, cy, \"\\t\", fg, bg);\n                                    cx += 2;\n                                    continue;\n                                }\n                            }\n                            // Assign to `true` when the current char is full-width.\n                            isFullWidth = (cc > 0xff00 && cc < 0xff61) || (cc > 0xffdc && cc < 0xffe8) || cc > 0xffee;\n                            // Current char is space, whatever full-width or half-width both are OK.\n                            isSpace = (c.charCodeAt(0) == 0x20 || c.charCodeAt(0) == 0x3000);\n                            // The previous char is full-width and\n                            // current char is nether half-width nor a space.\n                            if (isPrevFullWidth && !isFullWidth && !isSpace) {\n                                cx++;\n                            } // add an extra position\n                            // The current char is full-width and\n                            // the previous char is not a space.\n                            if (isFullWidth && !isPrevSpace) {\n                                cx++;\n                            } // add an extra position\n                            this.draw(cx++, cy, c, fg, bg);\n                            isPrevSpace = isSpace;\n                            isPrevFullWidth = isFullWidth;\n                        }\n                        break;\n                    case Text.TYPE_FG:\n                        fg = token.value || null;\n                        break;\n                    case Text.TYPE_BG:\n                        bg = token.value || null;\n                        break;\n                    case Text.TYPE_NEWLINE:\n                        cx = x;\n                        cy++;\n                        lines++;\n                        break;\n                }\n            }\n            return lines;\n        }\n        /**\n         * Timer tick: update dirty parts\n         */\n        _tick() {\n            this._backend.schedule(this._tick);\n            if (!this._dirty) {\n                return;\n            }\n            if (this._dirty === true) { // draw all\n                this._backend.clear();\n                for (let id in this._data) {\n                    this._draw(id, false);\n                } // redraw cached data \n            }\n            else { // draw only dirty \n                for (let key in this._dirty) {\n                    this._draw(key, true);\n                }\n            }\n            this._dirty = false;\n        }\n        /**\n         * @param {string} key What to draw\n         * @param {bool} clearBefore Is it necessary to clean before?\n         */\n        _draw(key, clearBefore) {\n            let data = this._data[key];\n            if (data[4] != this._options.bg) {\n                clearBefore = true;\n            }\n            this._backend.draw(data, clearBefore);\n        }\n    }\n    Display.Rect = Rect;\n    Display.Hex = Hex;\n    Display.Tile = Tile;\n    Display.TileGL = TileGL;\n    Display.Term = Term;\n    return Display;\n})();\nexport default Display;\n","import Canvas from \"./canvas.js\";\nimport { mod } from \"../util.js\";\n/**\n * @class Hexagonal backend\n * @private\n */\nexport default class Hex extends Canvas {\n    constructor() {\n        super();\n        this._spacingX = 0;\n        this._spacingY = 0;\n        this._hexSize = 0;\n    }\n    draw(data, clearBefore) {\n        let [x, y, ch, fg, bg] = data;\n        let px = [\n            (x + 1) * this._spacingX,\n            y * this._spacingY + this._hexSize\n        ];\n        if (this._options.transpose) {\n            px.reverse();\n        }\n        if (clearBefore) {\n            this._ctx.fillStyle = bg;\n            this._fill(px[0], px[1]);\n        }\n        if (!ch) {\n            return;\n        }\n        this._ctx.fillStyle = fg;\n        let chars = [].concat(ch);\n        for (let i = 0; i < chars.length; i++) {\n            this._ctx.fillText(chars[i], px[0], Math.ceil(px[1]));\n        }\n    }\n    computeSize(availWidth, availHeight) {\n        if (this._options.transpose) {\n            availWidth += availHeight;\n            availHeight = availWidth - availHeight;\n            availWidth -= availHeight;\n        }\n        let width = Math.floor(availWidth / this._spacingX) - 1;\n        let height = Math.floor((availHeight - 2 * this._hexSize) / this._spacingY + 1);\n        return [width, height];\n    }\n    computeFontSize(availWidth, availHeight) {\n        if (this._options.transpose) {\n            availWidth += availHeight;\n            availHeight = availWidth - availHeight;\n            availWidth -= availHeight;\n        }\n        let hexSizeWidth = 2 * availWidth / ((this._options.width + 1) * Math.sqrt(3)) - 1;\n        let hexSizeHeight = availHeight / (2 + 1.5 * (this._options.height - 1));\n        let hexSize = Math.min(hexSizeWidth, hexSizeHeight);\n        // compute char ratio\n        let oldFont = this._ctx.font;\n        this._ctx.font = \"100px \" + this._options.fontFamily;\n        let width = Math.ceil(this._ctx.measureText(\"W\").width);\n        this._ctx.font = oldFont;\n        let ratio = width / 100;\n        hexSize = Math.floor(hexSize) + 1; // closest larger hexSize\n        // FIXME char size computation does not respect transposed hexes\n        let fontSize = 2 * hexSize / (this._options.spacing * (1 + ratio / Math.sqrt(3)));\n        // closest smaller fontSize\n        return Math.ceil(fontSize) - 1;\n    }\n    _normalizedEventToPosition(x, y) {\n        let nodeSize;\n        if (this._options.transpose) {\n            x += y;\n            y = x - y;\n            x -= y;\n            nodeSize = this._ctx.canvas.width;\n        }\n        else {\n            nodeSize = this._ctx.canvas.height;\n        }\n        let size = nodeSize / this._options.height;\n        y = Math.floor(y / size);\n        if (mod(y, 2)) { /* odd row */\n            x -= this._spacingX;\n            x = 1 + 2 * Math.floor(x / (2 * this._spacingX));\n        }\n        else {\n            x = 2 * Math.floor(x / (2 * this._spacingX));\n        }\n        return [x, y];\n    }\n    /**\n     * Arguments are pixel values. If \"transposed\" mode is enabled, then these two are already swapped.\n     */\n    _fill(cx, cy) {\n        let a = this._hexSize;\n        let b = this._options.border;\n        const ctx = this._ctx;\n        ctx.beginPath();\n        if (this._options.transpose) {\n            ctx.moveTo(cx - a + b, cy);\n            ctx.lineTo(cx - a / 2 + b, cy + this._spacingX - b);\n            ctx.lineTo(cx + a / 2 - b, cy + this._spacingX - b);\n            ctx.lineTo(cx + a - b, cy);\n            ctx.lineTo(cx + a / 2 - b, cy - this._spacingX + b);\n            ctx.lineTo(cx - a / 2 + b, cy - this._spacingX + b);\n            ctx.lineTo(cx - a + b, cy);\n        }\n        else {\n            ctx.moveTo(cx, cy - a + b);\n            ctx.lineTo(cx + this._spacingX - b, cy - a / 2 + b);\n            ctx.lineTo(cx + this._spacingX - b, cy + a / 2 - b);\n            ctx.lineTo(cx, cy + a - b);\n            ctx.lineTo(cx - this._spacingX + b, cy + a / 2 - b);\n            ctx.lineTo(cx - this._spacingX + b, cy - a / 2 + b);\n            ctx.lineTo(cx, cy - a + b);\n        }\n        ctx.fill();\n    }\n    _updateSize() {\n        const opts = this._options;\n        const charWidth = Math.ceil(this._ctx.measureText(\"W\").width);\n        this._hexSize = Math.floor(opts.spacing * (opts.fontSize + charWidth / Math.sqrt(3)) / 2);\n        this._spacingX = this._hexSize * Math.sqrt(3) / 2;\n        this._spacingY = this._hexSize * 1.5;\n        let xprop;\n        let yprop;\n        if (opts.transpose) {\n            xprop = \"height\";\n            yprop = \"width\";\n        }\n        else {\n            xprop = \"width\";\n            yprop = \"height\";\n        }\n        this._ctx.canvas[xprop] = Math.ceil((opts.width + 1) * this._spacingX);\n        this._ctx.canvas[yprop] = Math.ceil((opts.height - 1) * this._spacingY + 2 * this._hexSize);\n    }\n}\n","import Backend from \"./backend.js\";\nexport default class Canvas extends Backend {\n    constructor() {\n        super();\n        this._ctx = document.createElement(\"canvas\").getContext(\"2d\");\n    }\n    schedule(cb) { requestAnimationFrame(cb); }\n    getContainer() { return this._ctx.canvas; }\n    setOptions(opts) {\n        super.setOptions(opts);\n        const style = (opts.fontStyle ? `${opts.fontStyle} ` : ``);\n        const font = `${style} ${opts.fontSize}px ${opts.fontFamily}`;\n        this._ctx.font = font;\n        this._updateSize();\n        this._ctx.font = font;\n        this._ctx.textAlign = \"center\";\n        this._ctx.textBaseline = \"middle\";\n    }\n    clear() {\n        this._ctx.fillStyle = this._options.bg;\n        this._ctx.fillRect(0, 0, this._ctx.canvas.width, this._ctx.canvas.height);\n    }\n    eventToPosition(x, y) {\n        let canvas = this._ctx.canvas;\n        let rect = canvas.getBoundingClientRect();\n        x -= rect.left;\n        y -= rect.top;\n        x *= canvas.width / rect.width;\n        y *= canvas.height / rect.height;\n        if (x < 0 || y < 0 || x >= canvas.width || y >= canvas.height) {\n            return [-1, -1];\n        }\n        return this._normalizedEventToPosition(x, y);\n    }\n}\n","/**\n * @class Abstract display backend module\n * @private\n */\nexport default class Backend {\n    getContainer() { return null; }\n    setOptions(options) { this._options = options; }\n}\n","import Canvas from \"./canvas.js\";\n/**\n * @class Rectangular backend\n * @private\n */\nlet Rect = /** @class */ (() => {\n    class Rect extends Canvas {\n        constructor() {\n            super();\n            this._spacingX = 0;\n            this._spacingY = 0;\n            this._canvasCache = {};\n        }\n        setOptions(options) {\n            super.setOptions(options);\n            this._canvasCache = {};\n        }\n        draw(data, clearBefore) {\n            if (Rect.cache) {\n                this._drawWithCache(data);\n            }\n            else {\n                this._drawNoCache(data, clearBefore);\n            }\n        }\n        _drawWithCache(data) {\n            let [x, y, ch, fg, bg] = data;\n            let hash = \"\" + ch + fg + bg;\n            let canvas;\n            if (hash in this._canvasCache) {\n                canvas = this._canvasCache[hash];\n            }\n            else {\n                let b = this._options.border;\n                canvas = document.createElement(\"canvas\");\n                let ctx = canvas.getContext(\"2d\");\n                canvas.width = this._spacingX;\n                canvas.height = this._spacingY;\n                ctx.fillStyle = bg;\n                ctx.fillRect(b, b, canvas.width - b, canvas.height - b);\n                if (ch) {\n                    ctx.fillStyle = fg;\n                    ctx.font = this._ctx.font;\n                    ctx.textAlign = \"center\";\n                    ctx.textBaseline = \"middle\";\n                    let chars = [].concat(ch);\n                    for (let i = 0; i < chars.length; i++) {\n                        ctx.fillText(chars[i], this._spacingX / 2, Math.ceil(this._spacingY / 2));\n                    }\n                }\n                this._canvasCache[hash] = canvas;\n            }\n            this._ctx.drawImage(canvas, x * this._spacingX, y * this._spacingY);\n        }\n        _drawNoCache(data, clearBefore) {\n            let [x, y, ch, fg, bg] = data;\n            if (clearBefore) {\n                let b = this._options.border;\n                this._ctx.fillStyle = bg;\n                this._ctx.fillRect(x * this._spacingX + b, y * this._spacingY + b, this._spacingX - b, this._spacingY - b);\n            }\n            if (!ch) {\n                return;\n            }\n            this._ctx.fillStyle = fg;\n            let chars = [].concat(ch);\n            for (let i = 0; i < chars.length; i++) {\n                this._ctx.fillText(chars[i], (x + 0.5) * this._spacingX, Math.ceil((y + 0.5) * this._spacingY));\n            }\n        }\n        computeSize(availWidth, availHeight) {\n            let width = Math.floor(availWidth / this._spacingX);\n            let height = Math.floor(availHeight / this._spacingY);\n            return [width, height];\n        }\n        computeFontSize(availWidth, availHeight) {\n            let boxWidth = Math.floor(availWidth / this._options.width);\n            let boxHeight = Math.floor(availHeight / this._options.height);\n            /* compute char ratio */\n            let oldFont = this._ctx.font;\n            this._ctx.font = \"100px \" + this._options.fontFamily;\n            let width = Math.ceil(this._ctx.measureText(\"W\").width);\n            this._ctx.font = oldFont;\n            let ratio = width / 100;\n            let widthFraction = ratio * boxHeight / boxWidth;\n            if (widthFraction > 1) { /* too wide with current aspect ratio */\n                boxHeight = Math.floor(boxHeight / widthFraction);\n            }\n            return Math.floor(boxHeight / this._options.spacing);\n        }\n        _normalizedEventToPosition(x, y) {\n            return [Math.floor(x / this._spacingX), Math.floor(y / this._spacingY)];\n        }\n        _updateSize() {\n            const opts = this._options;\n            const charWidth = Math.ceil(this._ctx.measureText(\"W\").width);\n            this._spacingX = Math.ceil(opts.spacing * charWidth);\n            this._spacingY = Math.ceil(opts.spacing * opts.fontSize);\n            if (opts.forceSquareRatio) {\n                this._spacingX = this._spacingY = Math.max(this._spacingX, this._spacingY);\n            }\n            this._ctx.canvas.width = opts.width * this._spacingX;\n            this._ctx.canvas.height = opts.height * this._spacingY;\n        }\n    }\n    Rect.cache = false;\n    return Rect;\n})();\nexport default Rect;\n","import Canvas from \"./canvas.js\";\n/**\n * @class Tile backend\n * @private\n */\nexport default class Tile extends Canvas {\n    constructor() {\n        super();\n        this._colorCanvas = document.createElement(\"canvas\");\n    }\n    draw(data, clearBefore) {\n        let [x, y, ch, fg, bg] = data;\n        let tileWidth = this._options.tileWidth;\n        let tileHeight = this._options.tileHeight;\n        if (clearBefore) {\n            if (this._options.tileColorize) {\n                this._ctx.clearRect(x * tileWidth, y * tileHeight, tileWidth, tileHeight);\n            }\n            else {\n                this._ctx.fillStyle = bg;\n                this._ctx.fillRect(x * tileWidth, y * tileHeight, tileWidth, tileHeight);\n            }\n        }\n        if (!ch) {\n            return;\n        }\n        let chars = [].concat(ch);\n        let fgs = [].concat(fg);\n        let bgs = [].concat(bg);\n        for (let i = 0; i < chars.length; i++) {\n            let tile = this._options.tileMap[chars[i]];\n            if (!tile) {\n                throw new Error(`Char \"${chars[i]}\" not found in tileMap`);\n            }\n            if (this._options.tileColorize) { // apply colorization\n                let canvas = this._colorCanvas;\n                let context = canvas.getContext(\"2d\");\n                context.globalCompositeOperation = \"source-over\";\n                context.clearRect(0, 0, tileWidth, tileHeight);\n                let fg = fgs[i];\n                let bg = bgs[i];\n                context.drawImage(this._options.tileSet, tile[0], tile[1], tileWidth, tileHeight, 0, 0, tileWidth, tileHeight);\n                if (fg != \"transparent\") {\n                    context.fillStyle = fg;\n                    context.globalCompositeOperation = \"source-atop\";\n                    context.fillRect(0, 0, tileWidth, tileHeight);\n                }\n                if (bg != \"transparent\") {\n                    context.fillStyle = bg;\n                    context.globalCompositeOperation = \"destination-over\";\n                    context.fillRect(0, 0, tileWidth, tileHeight);\n                }\n                this._ctx.drawImage(canvas, x * tileWidth, y * tileHeight, tileWidth, tileHeight);\n            }\n            else { // no colorizing, easy\n                this._ctx.drawImage(this._options.tileSet, tile[0], tile[1], tileWidth, tileHeight, x * tileWidth, y * tileHeight, tileWidth, tileHeight);\n            }\n        }\n    }\n    computeSize(availWidth, availHeight) {\n        let width = Math.floor(availWidth / this._options.tileWidth);\n        let height = Math.floor(availHeight / this._options.tileHeight);\n        return [width, height];\n    }\n    computeFontSize() {\n        throw new Error(\"Tile backend does not understand font size\");\n    }\n    _normalizedEventToPosition(x, y) {\n        return [Math.floor(x / this._options.tileWidth), Math.floor(y / this._options.tileHeight)];\n    }\n    _updateSize() {\n        const opts = this._options;\n        this._ctx.canvas.width = opts.width * opts.tileWidth;\n        this._ctx.canvas.height = opts.height * opts.tileHeight;\n        this._colorCanvas.width = opts.tileWidth;\n        this._colorCanvas.height = opts.tileHeight;\n    }\n}\n","import Backend from \"./backend.js\";\nimport * as Color from \"../color.js\";\n/**\n * @class Tile backend\n * @private\n */\nexport default class TileGL extends Backend {\n    constructor() {\n        super();\n        this._uniforms = {};\n        try {\n            this._gl = this._initWebGL();\n        }\n        catch (e) {\n            alert(e.message);\n        }\n    }\n    static isSupported() {\n        return !!document.createElement(\"canvas\").getContext(\"webgl2\", { preserveDrawingBuffer: true });\n    }\n    schedule(cb) { requestAnimationFrame(cb); }\n    getContainer() { return this._gl.canvas; }\n    setOptions(opts) {\n        super.setOptions(opts);\n        this._updateSize();\n        let tileSet = this._options.tileSet;\n        if (tileSet && \"complete\" in tileSet && !tileSet.complete) {\n            tileSet.addEventListener(\"load\", () => this._updateTexture(tileSet));\n        }\n        else {\n            this._updateTexture(tileSet);\n        }\n    }\n    draw(data, clearBefore) {\n        const gl = this._gl;\n        const opts = this._options;\n        let [x, y, ch, fg, bg] = data;\n        let scissorY = gl.canvas.height - (y + 1) * opts.tileHeight;\n        gl.scissor(x * opts.tileWidth, scissorY, opts.tileWidth, opts.tileHeight);\n        if (clearBefore) {\n            if (opts.tileColorize) {\n                gl.clearColor(0, 0, 0, 0);\n            }\n            else {\n                gl.clearColor(...parseColor(bg));\n            }\n            gl.clear(gl.COLOR_BUFFER_BIT);\n        }\n        if (!ch) {\n            return;\n        }\n        let chars = [].concat(ch);\n        let bgs = [].concat(bg);\n        let fgs = [].concat(fg);\n        gl.uniform2fv(this._uniforms[\"targetPosRel\"], [x, y]);\n        for (let i = 0; i < chars.length; i++) {\n            let tile = this._options.tileMap[chars[i]];\n            if (!tile) {\n                throw new Error(`Char \"${chars[i]}\" not found in tileMap`);\n            }\n            gl.uniform1f(this._uniforms[\"colorize\"], opts.tileColorize ? 1 : 0);\n            gl.uniform2fv(this._uniforms[\"tilesetPosAbs\"], tile);\n            if (opts.tileColorize) {\n                gl.uniform4fv(this._uniforms[\"tint\"], parseColor(fgs[i]));\n                gl.uniform4fv(this._uniforms[\"bg\"], parseColor(bgs[i]));\n            }\n            gl.drawArrays(gl.TRIANGLE_STRIP, 0, 4);\n        }\n        /*\n        \n        \n                for (let i=0;i<chars.length;i++) {\n        \n                    if (this._options.tileColorize) { // apply colorization\n                        let canvas = this._colorCanvas;\n                        let context = canvas.getContext(\"2d\") as CanvasRenderingContext2D;\n                        context.globalCompositeOperation = \"source-over\";\n                        context.clearRect(0, 0, tileWidth, tileHeight);\n        \n                        let fg = fgs[i];\n                        let bg = bgs[i];\n        \n                        context.drawImage(\n                            this._options.tileSet!,\n                            tile[0], tile[1], tileWidth, tileHeight,\n                            0, 0, tileWidth, tileHeight\n                        );\n        \n                        if (fg != \"transparent\") {\n                            context.fillStyle = fg;\n                            context.globalCompositeOperation = \"source-atop\";\n                            context.fillRect(0, 0, tileWidth, tileHeight);\n                        }\n        \n                        if (bg != \"transparent\") {\n                            context.fillStyle = bg;\n                            context.globalCompositeOperation = \"destination-over\";\n                            context.fillRect(0, 0, tileWidth, tileHeight);\n                        }\n        \n                        this._ctx.drawImage(canvas, x*tileWidth, y*tileHeight, tileWidth, tileHeight);\n                    } else { // no colorizing, easy\n                        this._ctx.drawImage(\n                            this._options.tileSet!,\n                            tile[0], tile[1], tileWidth, tileHeight,\n                            x*tileWidth, y*tileHeight, tileWidth, tileHeight\n                        );\n                    }\n                }\n        \n        */\n    }\n    clear() {\n        const gl = this._gl;\n        gl.clearColor(...parseColor(this._options.bg));\n        gl.scissor(0, 0, gl.canvas.width, gl.canvas.height);\n        gl.clear(gl.COLOR_BUFFER_BIT);\n    }\n    computeSize(availWidth, availHeight) {\n        let width = Math.floor(availWidth / this._options.tileWidth);\n        let height = Math.floor(availHeight / this._options.tileHeight);\n        return [width, height];\n    }\n    computeFontSize() {\n        throw new Error(\"Tile backend does not understand font size\");\n    }\n    eventToPosition(x, y) {\n        let canvas = this._gl.canvas;\n        let rect = canvas.getBoundingClientRect();\n        x -= rect.left;\n        y -= rect.top;\n        x *= canvas.width / rect.width;\n        y *= canvas.height / rect.height;\n        if (x < 0 || y < 0 || x >= canvas.width || y >= canvas.height) {\n            return [-1, -1];\n        }\n        return this._normalizedEventToPosition(x, y);\n    }\n    _initWebGL() {\n        let gl = document.createElement(\"canvas\").getContext(\"webgl2\", { preserveDrawingBuffer: true });\n        window.gl = gl;\n        let program = createProgram(gl, VS, FS);\n        gl.useProgram(program);\n        createQuad(gl);\n        UNIFORMS.forEach(name => this._uniforms[name] = gl.getUniformLocation(program, name));\n        this._program = program;\n        gl.enable(gl.BLEND);\n        gl.blendFuncSeparate(gl.SRC_ALPHA, gl.ONE_MINUS_SRC_ALPHA, gl.ONE, gl.ONE_MINUS_SRC_ALPHA);\n        gl.enable(gl.SCISSOR_TEST);\n        return gl;\n    }\n    _normalizedEventToPosition(x, y) {\n        return [Math.floor(x / this._options.tileWidth), Math.floor(y / this._options.tileHeight)];\n    }\n    _updateSize() {\n        const gl = this._gl;\n        const opts = this._options;\n        const canvasSize = [opts.width * opts.tileWidth, opts.height * opts.tileHeight];\n        gl.canvas.width = canvasSize[0];\n        gl.canvas.height = canvasSize[1];\n        gl.viewport(0, 0, canvasSize[0], canvasSize[1]);\n        gl.uniform2fv(this._uniforms[\"tileSize\"], [opts.tileWidth, opts.tileHeight]);\n        gl.uniform2fv(this._uniforms[\"targetSize\"], canvasSize);\n    }\n    _updateTexture(tileSet) {\n        createTexture(this._gl, tileSet);\n    }\n}\nconst UNIFORMS = [\"targetPosRel\", \"tilesetPosAbs\", \"tileSize\", \"targetSize\", \"colorize\", \"bg\", \"tint\"];\nconst VS = `\n#version 300 es\n\nin vec2 tilePosRel;\nout vec2 tilesetPosPx;\n\nuniform vec2 tilesetPosAbs;\nuniform vec2 tileSize;\nuniform vec2 targetSize;\nuniform vec2 targetPosRel;\n\nvoid main() {\n\tvec2 targetPosPx = (targetPosRel + tilePosRel) * tileSize;\n\tvec2 targetPosNdc = ((targetPosPx / targetSize)-0.5)*2.0;\n\ttargetPosNdc.y *= -1.0;\n\n\tgl_Position = vec4(targetPosNdc, 0.0, 1.0);\n\ttilesetPosPx = tilesetPosAbs + tilePosRel * tileSize;\n}`.trim();\nconst FS = `\n#version 300 es\nprecision highp float;\n\nin vec2 tilesetPosPx;\nout vec4 fragColor;\nuniform sampler2D image;\nuniform bool colorize;\nuniform vec4 bg;\nuniform vec4 tint;\n\nvoid main() {\n\tfragColor = vec4(0, 0, 0, 1);\n\n\tvec4 texel = texelFetch(image, ivec2(tilesetPosPx), 0);\n\n\tif (colorize) {\n\t\ttexel.rgb = tint.a * tint.rgb + (1.0-tint.a) * texel.rgb;\n\t\tfragColor.rgb = texel.a*texel.rgb + (1.0-texel.a)*bg.rgb;\n\t\tfragColor.a = texel.a + (1.0-texel.a)*bg.a;\n\t} else {\n\t\tfragColor = texel;\n\t}\n}`.trim();\nfunction createProgram(gl, vss, fss) {\n    const vs = gl.createShader(gl.VERTEX_SHADER);\n    gl.shaderSource(vs, vss);\n    gl.compileShader(vs);\n    if (!gl.getShaderParameter(vs, gl.COMPILE_STATUS)) {\n        throw new Error(gl.getShaderInfoLog(vs) || \"\");\n    }\n    const fs = gl.createShader(gl.FRAGMENT_SHADER);\n    gl.shaderSource(fs, fss);\n    gl.compileShader(fs);\n    if (!gl.getShaderParameter(fs, gl.COMPILE_STATUS)) {\n        throw new Error(gl.getShaderInfoLog(fs) || \"\");\n    }\n    const p = gl.createProgram();\n    gl.attachShader(p, vs);\n    gl.attachShader(p, fs);\n    gl.linkProgram(p);\n    if (!gl.getProgramParameter(p, gl.LINK_STATUS)) {\n        throw new Error(gl.getProgramInfoLog(p) || \"\");\n    }\n    return p;\n}\nfunction createQuad(gl) {\n    const pos = new Float32Array([0, 0, 1, 0, 0, 1, 1, 1]);\n    const buf = gl.createBuffer();\n    gl.bindBuffer(gl.ARRAY_BUFFER, buf);\n    gl.bufferData(gl.ARRAY_BUFFER, pos, gl.STATIC_DRAW);\n    gl.enableVertexAttribArray(0);\n    gl.vertexAttribPointer(0, 2, gl.FLOAT, false, 0, 0);\n}\nfunction createTexture(gl, data) {\n    let t = gl.createTexture();\n    gl.bindTexture(gl.TEXTURE_2D, t);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MAG_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_MIN_FILTER, gl.NEAREST);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_S, gl.REPEAT);\n    gl.texParameteri(gl.TEXTURE_2D, gl.TEXTURE_WRAP_T, gl.REPEAT);\n    gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL, 0);\n    gl.texImage2D(gl.TEXTURE_2D, 0, gl.RGBA, gl.RGBA, gl.UNSIGNED_BYTE, data);\n    return t;\n}\nlet colorCache = {};\nfunction parseColor(color) {\n    if (!(color in colorCache)) {\n        let parsed;\n        if (color == \"transparent\") {\n            parsed = [0, 0, 0, 0];\n        }\n        else if (color.indexOf(\"rgba\") > -1) {\n            parsed = (color.match(/[\\d.]+/g) || []).map(Number);\n            for (let i = 0; i < 3; i++) {\n                parsed[i] = parsed[i] / 255;\n            }\n        }\n        else {\n            parsed = Color.fromString(color).map($ => $ / 255);\n            parsed.push(1);\n        }\n        colorCache[color] = parsed;\n    }\n    return colorCache[color];\n}\n","import { clamp } from \"./util.js\";\nimport RNG from \"./rng.js\";\nexport function fromString(str) {\n    let cached, r;\n    if (str in CACHE) {\n        cached = CACHE[str];\n    }\n    else {\n        if (str.charAt(0) == \"#\") { // hex rgb\n            let matched = str.match(/[0-9a-f]/gi) || [];\n            let values = matched.map((x) => parseInt(x, 16));\n            if (values.length == 3) {\n                cached = values.map((x) => x * 17);\n            }\n            else {\n                for (let i = 0; i < 3; i++) {\n                    values[i + 1] += 16 * values[i];\n                    values.splice(i, 1);\n                }\n                cached = values;\n            }\n        }\n        else if ((r = str.match(/rgb\\(([0-9, ]+)\\)/i))) { // decimal rgb\n            cached = r[1].split(/\\s*,\\s*/).map((x) => parseInt(x));\n        }\n        else { // html name\n            cached = [0, 0, 0];\n        }\n        CACHE[str] = cached;\n    }\n    return cached.slice();\n}\n/**\n * Add two or more colors\n */\nexport function add(color1, ...colors) {\n    let result = color1.slice();\n    for (let i = 0; i < 3; i++) {\n        for (let j = 0; j < colors.length; j++) {\n            result[i] += colors[j][i];\n        }\n    }\n    return result;\n}\n/**\n * Add two or more colors, MODIFIES FIRST ARGUMENT\n */\nexport function add_(color1, ...colors) {\n    for (let i = 0; i < 3; i++) {\n        for (let j = 0; j < colors.length; j++) {\n            color1[i] += colors[j][i];\n        }\n    }\n    return color1;\n}\n/**\n * Multiply (mix) two or more colors\n */\nexport function multiply(color1, ...colors) {\n    let result = color1.slice();\n    for (let i = 0; i < 3; i++) {\n        for (let j = 0; j < colors.length; j++) {\n            result[i] *= colors[j][i] / 255;\n        }\n        result[i] = Math.round(result[i]);\n    }\n    return result;\n}\n/**\n * Multiply (mix) two or more colors, MODIFIES FIRST ARGUMENT\n */\nexport function multiply_(color1, ...colors) {\n    for (let i = 0; i < 3; i++) {\n        for (let j = 0; j < colors.length; j++) {\n            color1[i] *= colors[j][i] / 255;\n        }\n        color1[i] = Math.round(color1[i]);\n    }\n    return color1;\n}\n/**\n * Interpolate (blend) two colors with a given factor\n */\nexport function interpolate(color1, color2, factor = 0.5) {\n    let result = color1.slice();\n    for (let i = 0; i < 3; i++) {\n        result[i] = Math.round(result[i] + factor * (color2[i] - color1[i]));\n    }\n    return result;\n}\nexport const lerp = interpolate;\n/**\n * Interpolate (blend) two colors with a given factor in HSL mode\n */\nexport function interpolateHSL(color1, color2, factor = 0.5) {\n    let hsl1 = rgb2hsl(color1);\n    let hsl2 = rgb2hsl(color2);\n    for (let i = 0; i < 3; i++) {\n        hsl1[i] += factor * (hsl2[i] - hsl1[i]);\n    }\n    return hsl2rgb(hsl1);\n}\nexport const lerpHSL = interpolateHSL;\n/**\n * Create a new random color based on this one\n * @param color\n * @param diff Set of standard deviations\n */\nexport function randomize(color, diff) {\n    if (!(diff instanceof Array)) {\n        diff = Math.round(RNG.getNormal(0, diff));\n    }\n    let result = color.slice();\n    for (let i = 0; i < 3; i++) {\n        result[i] += (diff instanceof Array ? Math.round(RNG.getNormal(0, diff[i])) : diff);\n    }\n    return result;\n}\n/**\n * Converts an RGB color value to HSL. Expects 0..255 inputs, produces 0..1 outputs.\n */\nexport function rgb2hsl(color) {\n    let r = color[0] / 255;\n    let g = color[1] / 255;\n    let b = color[2] / 255;\n    let max = Math.max(r, g, b), min = Math.min(r, g, b);\n    let h = 0, s, l = (max + min) / 2;\n    if (max == min) {\n        s = 0; // achromatic\n    }\n    else {\n        let d = max - min;\n        s = (l > 0.5 ? d / (2 - max - min) : d / (max + min));\n        switch (max) {\n            case r:\n                h = (g - b) / d + (g < b ? 6 : 0);\n                break;\n            case g:\n                h = (b - r) / d + 2;\n                break;\n            case b:\n                h = (r - g) / d + 4;\n                break;\n        }\n        h /= 6;\n    }\n    return [h, s, l];\n}\nfunction hue2rgb(p, q, t) {\n    if (t < 0)\n        t += 1;\n    if (t > 1)\n        t -= 1;\n    if (t < 1 / 6)\n        return p + (q - p) * 6 * t;\n    if (t < 1 / 2)\n        return q;\n    if (t < 2 / 3)\n        return p + (q - p) * (2 / 3 - t) * 6;\n    return p;\n}\n/**\n * Converts an HSL color value to RGB. Expects 0..1 inputs, produces 0..255 outputs.\n */\nexport function hsl2rgb(color) {\n    let l = color[2];\n    if (color[1] == 0) {\n        l = Math.round(l * 255);\n        return [l, l, l];\n    }\n    else {\n        let s = color[1];\n        let q = (l < 0.5 ? l * (1 + s) : l + s - l * s);\n        let p = 2 * l - q;\n        let r = hue2rgb(p, q, color[0] + 1 / 3);\n        let g = hue2rgb(p, q, color[0]);\n        let b = hue2rgb(p, q, color[0] - 1 / 3);\n        return [Math.round(r * 255), Math.round(g * 255), Math.round(b * 255)];\n    }\n}\nexport function toRGB(color) {\n    let clamped = color.map(x => clamp(x, 0, 255));\n    return `rgb(${clamped.join(\",\")})`;\n}\nexport function toHex(color) {\n    let clamped = color.map(x => clamp(x, 0, 255).toString(16).padStart(2, \"0\"));\n    return `#${clamped.join(\"\")}`;\n}\nconst CACHE = {\n    \"black\": [0, 0, 0],\n    \"navy\": [0, 0, 128],\n    \"darkblue\": [0, 0, 139],\n    \"mediumblue\": [0, 0, 205],\n    \"blue\": [0, 0, 255],\n    \"darkgreen\": [0, 100, 0],\n    \"green\": [0, 128, 0],\n    \"teal\": [0, 128, 128],\n    \"darkcyan\": [0, 139, 139],\n    \"deepskyblue\": [0, 191, 255],\n    \"darkturquoise\": [0, 206, 209],\n    \"mediumspringgreen\": [0, 250, 154],\n    \"lime\": [0, 255, 0],\n    \"springgreen\": [0, 255, 127],\n    \"aqua\": [0, 255, 255],\n    \"cyan\": [0, 255, 255],\n    \"midnightblue\": [25, 25, 112],\n    \"dodgerblue\": [30, 144, 255],\n    \"forestgreen\": [34, 139, 34],\n    \"seagreen\": [46, 139, 87],\n    \"darkslategray\": [47, 79, 79],\n    \"darkslategrey\": [47, 79, 79],\n    \"limegreen\": [50, 205, 50],\n    \"mediumseagreen\": [60, 179, 113],\n    \"turquoise\": [64, 224, 208],\n    \"royalblue\": [65, 105, 225],\n    \"steelblue\": [70, 130, 180],\n    \"darkslateblue\": [72, 61, 139],\n    \"mediumturquoise\": [72, 209, 204],\n    \"indigo\": [75, 0, 130],\n    \"darkolivegreen\": [85, 107, 47],\n    \"cadetblue\": [95, 158, 160],\n    \"cornflowerblue\": [100, 149, 237],\n    \"mediumaquamarine\": [102, 205, 170],\n    \"dimgray\": [105, 105, 105],\n    \"dimgrey\": [105, 105, 105],\n    \"slateblue\": [106, 90, 205],\n    \"olivedrab\": [107, 142, 35],\n    \"slategray\": [112, 128, 144],\n    \"slategrey\": [112, 128, 144],\n    \"lightslategray\": [119, 136, 153],\n    \"lightslategrey\": [119, 136, 153],\n    \"mediumslateblue\": [123, 104, 238],\n    \"lawngreen\": [124, 252, 0],\n    \"chartreuse\": [127, 255, 0],\n    \"aquamarine\": [127, 255, 212],\n    \"maroon\": [128, 0, 0],\n    \"purple\": [128, 0, 128],\n    \"olive\": [128, 128, 0],\n    \"gray\": [128, 128, 128],\n    \"grey\": [128, 128, 128],\n    \"skyblue\": [135, 206, 235],\n    \"lightskyblue\": [135, 206, 250],\n    \"blueviolet\": [138, 43, 226],\n    \"darkred\": [139, 0, 0],\n    \"darkmagenta\": [139, 0, 139],\n    \"saddlebrown\": [139, 69, 19],\n    \"darkseagreen\": [143, 188, 143],\n    \"lightgreen\": [144, 238, 144],\n    \"mediumpurple\": [147, 112, 216],\n    \"darkviolet\": [148, 0, 211],\n    \"palegreen\": [152, 251, 152],\n    \"darkorchid\": [153, 50, 204],\n    \"yellowgreen\": [154, 205, 50],\n    \"sienna\": [160, 82, 45],\n    \"brown\": [165, 42, 42],\n    \"darkgray\": [169, 169, 169],\n    \"darkgrey\": [169, 169, 169],\n    \"lightblue\": [173, 216, 230],\n    \"greenyellow\": [173, 255, 47],\n    \"paleturquoise\": [175, 238, 238],\n    \"lightsteelblue\": [176, 196, 222],\n    \"powderblue\": [176, 224, 230],\n    \"firebrick\": [178, 34, 34],\n    \"darkgoldenrod\": [184, 134, 11],\n    \"mediumorchid\": [186, 85, 211],\n    \"rosybrown\": [188, 143, 143],\n    \"darkkhaki\": [189, 183, 107],\n    \"silver\": [192, 192, 192],\n    \"mediumvioletred\": [199, 21, 133],\n    \"indianred\": [205, 92, 92],\n    \"peru\": [205, 133, 63],\n    \"chocolate\": [210, 105, 30],\n    \"tan\": [210, 180, 140],\n    \"lightgray\": [211, 211, 211],\n    \"lightgrey\": [211, 211, 211],\n    \"palevioletred\": [216, 112, 147],\n    \"thistle\": [216, 191, 216],\n    \"orchid\": [218, 112, 214],\n    \"goldenrod\": [218, 165, 32],\n    \"crimson\": [220, 20, 60],\n    \"gainsboro\": [220, 220, 220],\n    \"plum\": [221, 160, 221],\n    \"burlywood\": [222, 184, 135],\n    \"lightcyan\": [224, 255, 255],\n    \"lavender\": [230, 230, 250],\n    \"darksalmon\": [233, 150, 122],\n    \"violet\": [238, 130, 238],\n    \"palegoldenrod\": [238, 232, 170],\n    \"lightcoral\": [240, 128, 128],\n    \"khaki\": [240, 230, 140],\n    \"aliceblue\": [240, 248, 255],\n    \"honeydew\": [240, 255, 240],\n    \"azure\": [240, 255, 255],\n    \"sandybrown\": [244, 164, 96],\n    \"wheat\": [245, 222, 179],\n    \"beige\": [245, 245, 220],\n    \"whitesmoke\": [245, 245, 245],\n    \"mintcream\": [245, 255, 250],\n    \"ghostwhite\": [248, 248, 255],\n    \"salmon\": [250, 128, 114],\n    \"antiquewhite\": [250, 235, 215],\n    \"linen\": [250, 240, 230],\n    \"lightgoldenrodyellow\": [250, 250, 210],\n    \"oldlace\": [253, 245, 230],\n    \"red\": [255, 0, 0],\n    \"fuchsia\": [255, 0, 255],\n    \"magenta\": [255, 0, 255],\n    \"deeppink\": [255, 20, 147],\n    \"orangered\": [255, 69, 0],\n    \"tomato\": [255, 99, 71],\n    \"hotpink\": [255, 105, 180],\n    \"coral\": [255, 127, 80],\n    \"darkorange\": [255, 140, 0],\n    \"lightsalmon\": [255, 160, 122],\n    \"orange\": [255, 165, 0],\n    \"lightpink\": [255, 182, 193],\n    \"pink\": [255, 192, 203],\n    \"gold\": [255, 215, 0],\n    \"peachpuff\": [255, 218, 185],\n    \"navajowhite\": [255, 222, 173],\n    \"moccasin\": [255, 228, 181],\n    \"bisque\": [255, 228, 196],\n    \"mistyrose\": [255, 228, 225],\n    \"blanchedalmond\": [255, 235, 205],\n    \"papayawhip\": [255, 239, 213],\n    \"lavenderblush\": [255, 240, 245],\n    \"seashell\": [255, 245, 238],\n    \"cornsilk\": [255, 248, 220],\n    \"lemonchiffon\": [255, 250, 205],\n    \"floralwhite\": [255, 250, 240],\n    \"snow\": [255, 250, 250],\n    \"yellow\": [255, 255, 0],\n    \"lightyellow\": [255, 255, 224],\n    \"ivory\": [255, 255, 240],\n    \"white\": [255, 255, 255]\n};\n","import Backend from \"./backend.js\";\nimport * as Color from \"../color.js\";\nfunction clearToAnsi(bg) {\n    return `\\x1b[0;48;5;${termcolor(bg)}m\\x1b[2J`;\n}\nfunction colorToAnsi(fg, bg) {\n    return `\\x1b[0;38;5;${termcolor(fg)};48;5;${termcolor(bg)}m`;\n}\nfunction positionToAnsi(x, y) {\n    return `\\x1b[${y + 1};${x + 1}H`;\n}\nfunction termcolor(color) {\n    const SRC_COLORS = 256.0;\n    const DST_COLORS = 6.0;\n    const COLOR_RATIO = DST_COLORS / SRC_COLORS;\n    let rgb = Color.fromString(color);\n    let r = Math.floor(rgb[0] * COLOR_RATIO);\n    let g = Math.floor(rgb[1] * COLOR_RATIO);\n    let b = Math.floor(rgb[2] * COLOR_RATIO);\n    return r * 36 + g * 6 + b * 1 + 16;\n}\nexport default class Term extends Backend {\n    constructor() {\n        super();\n        this._offset = [0, 0];\n        this._cursor = [-1, -1];\n        this._lastColor = \"\";\n    }\n    schedule(cb) { setTimeout(cb, 1000 / 60); }\n    setOptions(options) {\n        super.setOptions(options);\n        let size = [options.width, options.height];\n        let avail = this.computeSize();\n        this._offset = avail.map((val, index) => Math.floor((val - size[index]) / 2));\n    }\n    clear() {\n        process.stdout.write(clearToAnsi(this._options.bg));\n    }\n    draw(data, clearBefore) {\n        // determine where to draw what with what colors\n        let [x, y, ch, fg, bg] = data;\n        // determine if we need to move the terminal cursor\n        let dx = this._offset[0] + x;\n        let dy = this._offset[1] + y;\n        let size = this.computeSize();\n        if (dx < 0 || dx >= size[0]) {\n            return;\n        }\n        if (dy < 0 || dy >= size[1]) {\n            return;\n        }\n        if (dx !== this._cursor[0] || dy !== this._cursor[1]) {\n            process.stdout.write(positionToAnsi(dx, dy));\n            this._cursor[0] = dx;\n            this._cursor[1] = dy;\n        }\n        // terminals automatically clear, but if we're clearing when we're\n        // not otherwise provided with a character, just use a space instead\n        if (clearBefore) {\n            if (!ch) {\n                ch = \" \";\n            }\n        }\n        // if we're not clearing and not provided with a character, do nothing\n        if (!ch) {\n            return;\n        }\n        // determine if we need to change colors\n        let newColor = colorToAnsi(fg, bg);\n        if (newColor !== this._lastColor) {\n            process.stdout.write(newColor);\n            this._lastColor = newColor;\n        }\n        if (ch != '\\t') {\n            // write the provided symbol to the display\n            let chars = [].concat(ch);\n            process.stdout.write(chars[0]);\n        }\n        // update our position, given that we wrote a character\n        this._cursor[0]++;\n        if (this._cursor[0] >= size[0]) {\n            this._cursor[0] = 0;\n            this._cursor[1]++;\n        }\n    }\n    computeFontSize() { throw new Error(\"Terminal backend has no notion of font size\"); }\n    eventToPosition(x, y) { return [x, y]; }\n    computeSize() { return [process.stdout.columns, process.stdout.rows]; }\n}\n","/**\n * @namespace\n * Contains text tokenization and breaking routines\n */\nconst RE_COLORS = /%([bc]){([^}]*)}/g;\n// token types\nexport const TYPE_TEXT = 0;\nexport const TYPE_NEWLINE = 1;\nexport const TYPE_FG = 2;\nexport const TYPE_BG = 3;\n/**\n * Measure size of a resulting text block\n */\nexport function measure(str, maxWidth) {\n    let result = { width: 0, height: 1 };\n    let tokens = tokenize(str, maxWidth);\n    let lineWidth = 0;\n    for (let i = 0; i < tokens.length; i++) {\n        let token = tokens[i];\n        switch (token.type) {\n            case TYPE_TEXT:\n                lineWidth += token.value.length;\n                break;\n            case TYPE_NEWLINE:\n                result.height++;\n                result.width = Math.max(result.width, lineWidth);\n                lineWidth = 0;\n                break;\n        }\n    }\n    result.width = Math.max(result.width, lineWidth);\n    return result;\n}\n/**\n * Convert string to a series of a formatting commands\n */\nexport function tokenize(str, maxWidth) {\n    let result = [];\n    /* first tokenization pass - split texts and color formatting commands */\n    let offset = 0;\n    str.replace(RE_COLORS, function (match, type, name, index) {\n        /* string before */\n        let part = str.substring(offset, index);\n        if (part.length) {\n            result.push({\n                type: TYPE_TEXT,\n                value: part\n            });\n        }\n        /* color command */\n        result.push({\n            type: (type == \"c\" ? TYPE_FG : TYPE_BG),\n            value: name.trim()\n        });\n        offset = index + match.length;\n        return \"\";\n    });\n    /* last remaining part */\n    let part = str.substring(offset);\n    if (part.length) {\n        result.push({\n            type: TYPE_TEXT,\n            value: part\n        });\n    }\n    return breakLines(result, maxWidth);\n}\n/* insert line breaks into first-pass tokenized data */\nfunction breakLines(tokens, maxWidth) {\n    if (!maxWidth) {\n        maxWidth = Infinity;\n    }\n    let i = 0;\n    let lineLength = 0;\n    let lastTokenWithSpace = -1;\n    while (i < tokens.length) { /* take all text tokens, remove space, apply linebreaks */\n        let token = tokens[i];\n        if (token.type == TYPE_NEWLINE) { /* reset */\n            lineLength = 0;\n            lastTokenWithSpace = -1;\n        }\n        if (token.type != TYPE_TEXT) { /* skip non-text tokens */\n            i++;\n            continue;\n        }\n        /* remove spaces at the beginning of line */\n        while (lineLength == 0 && token.value.charAt(0) == \" \") {\n            token.value = token.value.substring(1);\n        }\n        /* forced newline? insert two new tokens after this one */\n        let index = token.value.indexOf(\"\\n\");\n        if (index != -1) {\n            token.value = breakInsideToken(tokens, i, index, true);\n            /* if there are spaces at the end, we must remove them (we do not want the line too long) */\n            let arr = token.value.split(\"\");\n            while (arr.length && arr[arr.length - 1] == \" \") {\n                arr.pop();\n            }\n            token.value = arr.join(\"\");\n        }\n        /* token degenerated? */\n        if (!token.value.length) {\n            tokens.splice(i, 1);\n            continue;\n        }\n        if (lineLength + token.value.length > maxWidth) { /* line too long, find a suitable breaking spot */\n            /* is it possible to break within this token? */\n            let index = -1;\n            while (1) {\n                let nextIndex = token.value.indexOf(\" \", index + 1);\n                if (nextIndex == -1) {\n                    break;\n                }\n                if (lineLength + nextIndex > maxWidth) {\n                    break;\n                }\n                index = nextIndex;\n            }\n            if (index != -1) { /* break at space within this one */\n                token.value = breakInsideToken(tokens, i, index, true);\n            }\n            else if (lastTokenWithSpace != -1) { /* is there a previous token where a break can occur? */\n                let token = tokens[lastTokenWithSpace];\n                let breakIndex = token.value.lastIndexOf(\" \");\n                token.value = breakInsideToken(tokens, lastTokenWithSpace, breakIndex, true);\n                i = lastTokenWithSpace;\n            }\n            else { /* force break in this token */\n                token.value = breakInsideToken(tokens, i, maxWidth - lineLength, false);\n            }\n        }\n        else { /* line not long, continue */\n            lineLength += token.value.length;\n            if (token.value.indexOf(\" \") != -1) {\n                lastTokenWithSpace = i;\n            }\n        }\n        i++; /* advance to next token */\n    }\n    tokens.push({ type: TYPE_NEWLINE }); /* insert fake newline to fix the last text line */\n    /* remove trailing space from text tokens before newlines */\n    let lastTextToken = null;\n    for (let i = 0; i < tokens.length; i++) {\n        let token = tokens[i];\n        switch (token.type) {\n            case TYPE_TEXT:\n                lastTextToken = token;\n                break;\n            case TYPE_NEWLINE:\n                if (lastTextToken) { /* remove trailing space */\n                    let arr = lastTextToken.value.split(\"\");\n                    while (arr.length && arr[arr.length - 1] == \" \") {\n                        arr.pop();\n                    }\n                    lastTextToken.value = arr.join(\"\");\n                }\n                lastTextToken = null;\n                break;\n        }\n    }\n    tokens.pop(); /* remove fake token */\n    return tokens;\n}\n/**\n * Create new tokens and insert them into the stream\n * @param {object[]} tokens\n * @param {int} tokenIndex Token being processed\n * @param {int} breakIndex Index within current token's value\n * @param {bool} removeBreakChar Do we want to remove the breaking character?\n * @returns {string} remaining unbroken token value\n */\nfunction breakInsideToken(tokens, tokenIndex, breakIndex, removeBreakChar) {\n    let newBreakToken = {\n        type: TYPE_NEWLINE\n    };\n    let newTextToken = {\n        type: TYPE_TEXT,\n        value: tokens[tokenIndex].value.substring(breakIndex + (removeBreakChar ? 1 : 0))\n    };\n    tokens.splice(tokenIndex + 1, 0, newBreakToken, newTextToken);\n    return tokens[tokenIndex].value.substring(0, breakIndex);\n}\n","/** Default with for display and map generators */\nexport let DEFAULT_WIDTH = 80;\n/** Default height for display and map generators */\nexport let DEFAULT_HEIGHT = 25;\nexport const DIRS = {\n    4: [[0, -1], [1, 0], [0, 1], [-1, 0]],\n    8: [[0, -1], [1, -1], [1, 0], [1, 1], [0, 1], [-1, 1], [-1, 0], [-1, -1]],\n    6: [[-1, -1], [1, -1], [2, 0], [1, 1], [-1, 1], [-2, 0]]\n};\nexport const KEYS = {\n    /** Cancel key. */\n    VK_CANCEL: 3,\n    /** Help key. */\n    VK_HELP: 6,\n    /** Backspace key. */\n    VK_BACK_SPACE: 8,\n    /** Tab key. */\n    VK_TAB: 9,\n    /** 5 key on Numpad when NumLock is unlocked. Or on Mac, clear key which is positioned at NumLock key. */\n    VK_CLEAR: 12,\n    /** Return/enter key on the main keyboard. */\n    VK_RETURN: 13,\n    /** Reserved, but not used. */\n    VK_ENTER: 14,\n    /** Shift key. */\n    VK_SHIFT: 16,\n    /** Control key. */\n    VK_CONTROL: 17,\n    /** Alt (Option on Mac) key. */\n    VK_ALT: 18,\n    /** Pause key. */\n    VK_PAUSE: 19,\n    /** Caps lock. */\n    VK_CAPS_LOCK: 20,\n    /** Escape key. */\n    VK_ESCAPE: 27,\n    /** Space bar. */\n    VK_SPACE: 32,\n    /** Page Up key. */\n    VK_PAGE_UP: 33,\n    /** Page Down key. */\n    VK_PAGE_DOWN: 34,\n    /** End key. */\n    VK_END: 35,\n    /** Home key. */\n    VK_HOME: 36,\n    /** Left arrow. */\n    VK_LEFT: 37,\n    /** Up arrow. */\n    VK_UP: 38,\n    /** Right arrow. */\n    VK_RIGHT: 39,\n    /** Down arrow. */\n    VK_DOWN: 40,\n    /** Print Screen key. */\n    VK_PRINTSCREEN: 44,\n    /** Ins(ert) key. */\n    VK_INSERT: 45,\n    /** Del(ete) key. */\n    VK_DELETE: 46,\n    /***/\n    VK_0: 48,\n    /***/\n    VK_1: 49,\n    /***/\n    VK_2: 50,\n    /***/\n    VK_3: 51,\n    /***/\n    VK_4: 52,\n    /***/\n    VK_5: 53,\n    /***/\n    VK_6: 54,\n    /***/\n    VK_7: 55,\n    /***/\n    VK_8: 56,\n    /***/\n    VK_9: 57,\n    /** Colon (:) key. Requires Gecko 15.0 */\n    VK_COLON: 58,\n    /** Semicolon (;) key. */\n    VK_SEMICOLON: 59,\n    /** Less-than (<) key. Requires Gecko 15.0 */\n    VK_LESS_THAN: 60,\n    /** Equals (=) key. */\n    VK_EQUALS: 61,\n    /** Greater-than (>) key. Requires Gecko 15.0 */\n    VK_GREATER_THAN: 62,\n    /** Question mark (?) key. Requires Gecko 15.0 */\n    VK_QUESTION_MARK: 63,\n    /** Atmark (@) key. Requires Gecko 15.0 */\n    VK_AT: 64,\n    /***/\n    VK_A: 65,\n    /***/\n    VK_B: 66,\n    /***/\n    VK_C: 67,\n    /***/\n    VK_D: 68,\n    /***/\n    VK_E: 69,\n    /***/\n    VK_F: 70,\n    /***/\n    VK_G: 71,\n    /***/\n    VK_H: 72,\n    /***/\n    VK_I: 73,\n    /***/\n    VK_J: 74,\n    /***/\n    VK_K: 75,\n    /***/\n    VK_L: 76,\n    /***/\n    VK_M: 77,\n    /***/\n    VK_N: 78,\n    /***/\n    VK_O: 79,\n    /***/\n    VK_P: 80,\n    /***/\n    VK_Q: 81,\n    /***/\n    VK_R: 82,\n    /***/\n    VK_S: 83,\n    /***/\n    VK_T: 84,\n    /***/\n    VK_U: 85,\n    /***/\n    VK_V: 86,\n    /***/\n    VK_W: 87,\n    /***/\n    VK_X: 88,\n    /***/\n    VK_Y: 89,\n    /***/\n    VK_Z: 90,\n    /***/\n    VK_CONTEXT_MENU: 93,\n    /** 0 on the numeric keypad. */\n    VK_NUMPAD0: 96,\n    /** 1 on the numeric keypad. */\n    VK_NUMPAD1: 97,\n    /** 2 on the numeric keypad. */\n    VK_NUMPAD2: 98,\n    /** 3 on the numeric keypad. */\n    VK_NUMPAD3: 99,\n    /** 4 on the numeric keypad. */\n    VK_NUMPAD4: 100,\n    /** 5 on the numeric keypad. */\n    VK_NUMPAD5: 101,\n    /** 6 on the numeric keypad. */\n    VK_NUMPAD6: 102,\n    /** 7 on the numeric keypad. */\n    VK_NUMPAD7: 103,\n    /** 8 on the numeric keypad. */\n    VK_NUMPAD8: 104,\n    /** 9 on the numeric keypad. */\n    VK_NUMPAD9: 105,\n    /** * on the numeric keypad. */\n    VK_MULTIPLY: 106,\n    /** + on the numeric keypad. */\n    VK_ADD: 107,\n    /***/\n    VK_SEPARATOR: 108,\n    /** - on the numeric keypad. */\n    VK_SUBTRACT: 109,\n    /** Decimal point on the numeric keypad. */\n    VK_DECIMAL: 110,\n    /** / on the numeric keypad. */\n    VK_DIVIDE: 111,\n    /** F1 key. */\n    VK_F1: 112,\n    /** F2 key. */\n    VK_F2: 113,\n    /** F3 key. */\n    VK_F3: 114,\n    /** F4 key. */\n    VK_F4: 115,\n    /** F5 key. */\n    VK_F5: 116,\n    /** F6 key. */\n    VK_F6: 117,\n    /** F7 key. */\n    VK_F7: 118,\n    /** F8 key. */\n    VK_F8: 119,\n    /** F9 key. */\n    VK_F9: 120,\n    /** F10 key. */\n    VK_F10: 121,\n    /** F11 key. */\n    VK_F11: 122,\n    /** F12 key. */\n    VK_F12: 123,\n    /** F13 key. */\n    VK_F13: 124,\n    /** F14 key. */\n    VK_F14: 125,\n    /** F15 key. */\n    VK_F15: 126,\n    /** F16 key. */\n    VK_F16: 127,\n    /** F17 key. */\n    VK_F17: 128,\n    /** F18 key. */\n    VK_F18: 129,\n    /** F19 key. */\n    VK_F19: 130,\n    /** F20 key. */\n    VK_F20: 131,\n    /** F21 key. */\n    VK_F21: 132,\n    /** F22 key. */\n    VK_F22: 133,\n    /** F23 key. */\n    VK_F23: 134,\n    /** F24 key. */\n    VK_F24: 135,\n    /** Num Lock key. */\n    VK_NUM_LOCK: 144,\n    /** Scroll Lock key. */\n    VK_SCROLL_LOCK: 145,\n    /** Circumflex (^) key. Requires Gecko 15.0 */\n    VK_CIRCUMFLEX: 160,\n    /** Exclamation (!) key. Requires Gecko 15.0 */\n    VK_EXCLAMATION: 161,\n    /** Double quote () key. Requires Gecko 15.0 */\n    VK_DOUBLE_QUOTE: 162,\n    /** Hash (#) key. Requires Gecko 15.0 */\n    VK_HASH: 163,\n    /** Dollar sign ($) key. Requires Gecko 15.0 */\n    VK_DOLLAR: 164,\n    /** Percent (%) key. Requires Gecko 15.0 */\n    VK_PERCENT: 165,\n    /** Ampersand (&) key. Requires Gecko 15.0 */\n    VK_AMPERSAND: 166,\n    /** Underscore (_) key. Requires Gecko 15.0 */\n    VK_UNDERSCORE: 167,\n    /** Open parenthesis (() key. Requires Gecko 15.0 */\n    VK_OPEN_PAREN: 168,\n    /** Close parenthesis ()) key. Requires Gecko 15.0 */\n    VK_CLOSE_PAREN: 169,\n    /* Asterisk (*) key. Requires Gecko 15.0 */\n    VK_ASTERISK: 170,\n    /** Plus (+) key. Requires Gecko 15.0 */\n    VK_PLUS: 171,\n    /** Pipe (|) key. Requires Gecko 15.0 */\n    VK_PIPE: 172,\n    /** Hyphen-US/docs/Minus (-) key. Requires Gecko 15.0 */\n    VK_HYPHEN_MINUS: 173,\n    /** Open curly bracket ({) key. Requires Gecko 15.0 */\n    VK_OPEN_CURLY_BRACKET: 174,\n    /** Close curly bracket (}) key. Requires Gecko 15.0 */\n    VK_CLOSE_CURLY_BRACKET: 175,\n    /** Tilde (~) key. Requires Gecko 15.0 */\n    VK_TILDE: 176,\n    /** Comma (,) key. */\n    VK_COMMA: 188,\n    /** Period (.) key. */\n    VK_PERIOD: 190,\n    /** Slash (/) key. */\n    VK_SLASH: 191,\n    /** Back tick (`) key. */\n    VK_BACK_QUOTE: 192,\n    /** Open square bracket ([) key. */\n    VK_OPEN_BRACKET: 219,\n    /** Back slash (\\) key. */\n    VK_BACK_SLASH: 220,\n    /** Close square bracket (]) key. */\n    VK_CLOSE_BRACKET: 221,\n    /** Quote (''') key. */\n    VK_QUOTE: 222,\n    /** Meta key on Linux, Command key on Mac. */\n    VK_META: 224,\n    /** AltGr key on Linux. Requires Gecko 15.0 */\n    VK_ALTGR: 225,\n    /** Windows logo key on Windows. Or Super or Hyper key on Linux. Requires Gecko 15.0 */\n    VK_WIN: 91,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_KANA: 21,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_HANGUL: 21,\n    /**  key on Japanese Mac keyboard. Requires Gecko 15.0 */\n    VK_EISU: 22,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_JUNJA: 23,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_FINAL: 24,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_HANJA: 25,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_KANJI: 25,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_CONVERT: 28,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_NONCONVERT: 29,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_ACCEPT: 30,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_MODECHANGE: 31,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_SELECT: 41,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_PRINT: 42,\n    /** Linux support for this keycode was added in Gecko 4.0. */\n    VK_EXECUTE: 43,\n    /** Linux support for this keycode was added in Gecko 4.0.\t */\n    VK_SLEEP: 95\n};\n","import RNG from \"./rng.js\";\n/**\n * @class (Markov process)-based string generator.\n * Copied from a <a href=\"http://www.roguebasin.roguelikedevelopment.org/index.php?title=Names_from_a_high_order_Markov_Process_and_a_simplified_Katz_back-off_scheme\">RogueBasin article</a>.\n * Offers configurable order and prior.\n */\nexport default class StringGenerator {\n    constructor(options) {\n        this._options = {\n            words: false,\n            order: 3,\n            prior: 0.001\n        };\n        Object.assign(this._options, options);\n        this._boundary = String.fromCharCode(0);\n        this._suffix = this._boundary;\n        this._prefix = [];\n        for (let i = 0; i < this._options.order; i++) {\n            this._prefix.push(this._boundary);\n        }\n        this._priorValues = {};\n        this._priorValues[this._boundary] = this._options.prior;\n        this._data = {};\n    }\n    /**\n     * Remove all learning data\n     */\n    clear() {\n        this._data = {};\n        this._priorValues = {};\n    }\n    /**\n     * @returns {string} Generated string\n     */\n    generate() {\n        let result = [this._sample(this._prefix)];\n        while (result[result.length - 1] != this._boundary) {\n            result.push(this._sample(result));\n        }\n        return this._join(result.slice(0, -1));\n    }\n    /**\n     * Observe (learn) a string from a training set\n     */\n    observe(string) {\n        let tokens = this._split(string);\n        for (let i = 0; i < tokens.length; i++) {\n            this._priorValues[tokens[i]] = this._options.prior;\n        }\n        tokens = this._prefix.concat(tokens).concat(this._suffix); /* add boundary symbols */\n        for (let i = this._options.order; i < tokens.length; i++) {\n            let context = tokens.slice(i - this._options.order, i);\n            let event = tokens[i];\n            for (let j = 0; j < context.length; j++) {\n                let subcontext = context.slice(j);\n                this._observeEvent(subcontext, event);\n            }\n        }\n    }\n    getStats() {\n        let parts = [];\n        let priorCount = Object.keys(this._priorValues).length;\n        priorCount--; // boundary\n        parts.push(\"distinct samples: \" + priorCount);\n        let dataCount = Object.keys(this._data).length;\n        let eventCount = 0;\n        for (let p in this._data) {\n            eventCount += Object.keys(this._data[p]).length;\n        }\n        parts.push(\"dictionary size (contexts): \" + dataCount);\n        parts.push(\"dictionary size (events): \" + eventCount);\n        return parts.join(\", \");\n    }\n    /**\n     * @param {string}\n     * @returns {string[]}\n     */\n    _split(str) {\n        return str.split(this._options.words ? /\\s+/ : \"\");\n    }\n    /**\n     * @param {string[]}\n     * @returns {string}\n     */\n    _join(arr) {\n        return arr.join(this._options.words ? \" \" : \"\");\n    }\n    /**\n     * @param {string[]} context\n     * @param {string} event\n     */\n    _observeEvent(context, event) {\n        let key = this._join(context);\n        if (!(key in this._data)) {\n            this._data[key] = {};\n        }\n        let data = this._data[key];\n        if (!(event in data)) {\n            data[event] = 0;\n        }\n        data[event]++;\n    }\n    /**\n     * @param {string[]}\n     * @returns {string}\n     */\n    _sample(context) {\n        context = this._backoff(context);\n        let key = this._join(context);\n        let data = this._data[key];\n        let available = {};\n        if (this._options.prior) {\n            for (let event in this._priorValues) {\n                available[event] = this._priorValues[event];\n            }\n            for (let event in data) {\n                available[event] += data[event];\n            }\n        }\n        else {\n            available = data;\n        }\n        return RNG.getWeightedValue(available);\n    }\n    /**\n     * @param {string[]}\n     * @returns {string[]}\n     */\n    _backoff(context) {\n        if (context.length > this._options.order) {\n            context = context.slice(-this._options.order);\n        }\n        else if (context.length < this._options.order) {\n            context = this._prefix.slice(0, this._options.order - context.length).concat(context);\n        }\n        while (!(this._join(context) in this._data) && context.length > 0) {\n            context = context.slice(1);\n        }\n        return context;\n    }\n}\n","import { MinHeap } from \"./MinHeap\";\nexport default class EventQueue {\n    /**\n     * @class Generic event queue: stores events and retrieves them based on their time\n     */\n    constructor() {\n        this._time = 0;\n        this._events = new MinHeap();\n    }\n    /**\n     * @returns {number} Elapsed time\n     */\n    getTime() { return this._time; }\n    /**\n     * Clear all scheduled events\n     */\n    clear() {\n        this._events = new MinHeap();\n        return this;\n    }\n    /**\n     * @param {?} event\n     * @param {number} time\n     */\n    add(event, time) {\n        this._events.push(event, time);\n    }\n    /**\n     * Locates the nearest event, advances time if necessary. Returns that event and removes it from the queue.\n     * @returns {? || null} The event previously added by addEvent, null if no event available\n     */\n    get() {\n        if (!this._events.len()) {\n            return null;\n        }\n        let { key: time, value: event } = this._events.pop();\n        if (time > 0) { /* advance */\n            this._time += time;\n            this._events.shift(-time);\n        }\n        return event;\n    }\n    /**\n     * Get the time associated with the given event\n     * @param {?} event\n     * @returns {number} time\n     */\n    getEventTime(event) {\n        const r = this._events.find(event);\n        if (r) {\n            const { key } = r;\n            return key;\n        }\n        return undefined;\n    }\n    /**\n     * Remove an event from the queue\n     * @param {?} event\n     * @returns {bool} success?\n     */\n    remove(event) {\n        return this._events.remove(event);\n    }\n    ;\n}\n","export class MinHeap {\n    constructor() {\n        this.heap = [];\n        this.timestamp = 0;\n    }\n    lessThan(a, b) {\n        return a.key == b.key ? a.timestamp < b.timestamp : a.key < b.key;\n    }\n    shift(v) {\n        this.heap = this.heap.map(({ key, value, timestamp }) => ({ key: key + v, value, timestamp }));\n    }\n    len() {\n        return this.heap.length;\n    }\n    push(value, key) {\n        this.timestamp += 1;\n        const loc = this.len();\n        this.heap.push({ value, timestamp: this.timestamp, key });\n        this.updateUp(loc);\n    }\n    pop() {\n        if (this.len() == 0) {\n            throw new Error(\"no element to pop\");\n        }\n        const top = this.heap[0];\n        if (this.len() > 1) {\n            this.heap[0] = this.heap.pop();\n            this.updateDown(0);\n        }\n        else {\n            this.heap.pop();\n        }\n        return top;\n    }\n    find(v) {\n        for (let i = 0; i < this.len(); i++) {\n            if (v == this.heap[i].value) {\n                return this.heap[i];\n            }\n        }\n        return null;\n    }\n    remove(v) {\n        let index = null;\n        for (let i = 0; i < this.len(); i++) {\n            if (v == this.heap[i].value) {\n                index = i;\n            }\n        }\n        if (index === null) {\n            return false;\n        }\n        if (this.len() > 1) {\n            let last = this.heap.pop();\n            if (last.value != v) { // if the last one is being removed, do nothing\n                this.heap[index] = last;\n                this.updateDown(index);\n            }\n            return true;\n        }\n        else {\n            this.heap.pop();\n        }\n        return true;\n    }\n    parentNode(x) {\n        return Math.floor((x - 1) / 2);\n    }\n    leftChildNode(x) {\n        return 2 * x + 1;\n    }\n    rightChildNode(x) {\n        return 2 * x + 2;\n    }\n    existNode(x) {\n        return x >= 0 && x < this.heap.length;\n    }\n    swap(x, y) {\n        const t = this.heap[x];\n        this.heap[x] = this.heap[y];\n        this.heap[y] = t;\n    }\n    minNode(numbers) {\n        const validnumbers = numbers.filter(this.existNode.bind(this));\n        let minimal = validnumbers[0];\n        for (const i of validnumbers) {\n            if (this.lessThan(this.heap[i], this.heap[minimal])) {\n                minimal = i;\n            }\n        }\n        return minimal;\n    }\n    updateUp(x) {\n        if (x == 0) {\n            return;\n        }\n        const parent = this.parentNode(x);\n        if (this.existNode(parent) && this.lessThan(this.heap[x], this.heap[parent])) {\n            this.swap(x, parent);\n            this.updateUp(parent);\n        }\n    }\n    updateDown(x) {\n        const leftChild = this.leftChildNode(x);\n        const rightChild = this.rightChildNode(x);\n        if (!this.existNode(leftChild)) {\n            return;\n        }\n        const m = this.minNode([x, leftChild, rightChild]);\n        if (m != x) {\n            this.swap(x, m);\n            this.updateDown(m);\n        }\n    }\n    debugPrint() {\n        console.log(this.heap);\n    }\n}\n","import Simple from \"./simple.js\";\nimport Speed from \"./speed.js\";\nimport Action from \"./action.js\";\nexport default { Simple, Speed, Action };\n","import Scheduler from \"./scheduler.js\";\n/**\n * @class Simple fair scheduler (round-robin style)\n */\nexport default class Simple extends Scheduler {\n    add(item, repeat) {\n        this._queue.add(item, 0);\n        return super.add(item, repeat);\n    }\n    next() {\n        if (this._current !== null && this._repeat.indexOf(this._current) != -1) {\n            this._queue.add(this._current, 0);\n        }\n        return super.next();\n    }\n}\n","import EventQueue from \"../eventqueue.js\";\nexport default class Scheduler {\n    /**\n     * @class Abstract scheduler\n     */\n    constructor() {\n        this._queue = new EventQueue();\n        this._repeat = [];\n        this._current = null;\n    }\n    /**\n     * @see ROT.EventQueue#getTime\n     */\n    getTime() { return this._queue.getTime(); }\n    /**\n     * @param {?} item\n     * @param {bool} repeat\n     */\n    add(item, repeat) {\n        if (repeat) {\n            this._repeat.push(item);\n        }\n        return this;\n    }\n    /**\n     * Get the time the given item is scheduled for\n     * @param {?} item\n     * @returns {number} time\n     */\n    getTimeOf(item) {\n        return this._queue.getEventTime(item);\n    }\n    /**\n     * Clear all items\n     */\n    clear() {\n        this._queue.clear();\n        this._repeat = [];\n        this._current = null;\n        return this;\n    }\n    /**\n     * Remove a previously added item\n     * @param {?} item\n     * @returns {bool} successful?\n     */\n    remove(item) {\n        let result = this._queue.remove(item);\n        let index = this._repeat.indexOf(item);\n        if (index != -1) {\n            this._repeat.splice(index, 1);\n        }\n        if (this._current == item) {\n            this._current = null;\n        }\n        return result;\n    }\n    /**\n     * Schedule next item\n     * @returns {?}\n     */\n    next() {\n        this._current = this._queue.get();\n        return this._current;\n    }\n}\n","import Scheduler from \"./scheduler.js\";\n/**\n * @class Speed-based scheduler\n */\nexport default class Speed extends Scheduler {\n    /**\n     * @param {object} item anything with \"getSpeed\" method\n     * @param {bool} repeat\n     * @param {number} [time=1/item.getSpeed()]\n     * @see ROT.Scheduler#add\n     */\n    add(item, repeat, time) {\n        this._queue.add(item, time !== undefined ? time : 1 / item.getSpeed());\n        return super.add(item, repeat);\n    }\n    /**\n     * @see ROT.Scheduler#next\n     */\n    next() {\n        if (this._current && this._repeat.indexOf(this._current) != -1) {\n            this._queue.add(this._current, 1 / this._current.getSpeed());\n        }\n        return super.next();\n    }\n}\n","import Scheduler from \"./scheduler.js\";\n/**\n * @class Action-based scheduler\n * @augments ROT.Scheduler\n */\nexport default class Action extends Scheduler {\n    constructor() {\n        super();\n        this._defaultDuration = 1; /* for newly added */\n        this._duration = this._defaultDuration; /* for this._current */\n    }\n    /**\n     * @param {object} item\n     * @param {bool} repeat\n     * @param {number} [time=1]\n     * @see ROT.Scheduler#add\n     */\n    add(item, repeat, time) {\n        this._queue.add(item, time || this._defaultDuration);\n        return super.add(item, repeat);\n    }\n    clear() {\n        this._duration = this._defaultDuration;\n        return super.clear();\n    }\n    remove(item) {\n        if (item == this._current) {\n            this._duration = this._defaultDuration;\n        }\n        return super.remove(item);\n    }\n    /**\n     * @see ROT.Scheduler#next\n     */\n    next() {\n        if (this._current !== null && this._repeat.indexOf(this._current) != -1) {\n            this._queue.add(this._current, this._duration || this._defaultDuration);\n            this._duration = this._defaultDuration;\n        }\n        return super.next();\n    }\n    /**\n     * Set duration for the active item\n     */\n    setDuration(time) {\n        if (this._current) {\n            this._duration = time;\n        }\n        return this;\n    }\n}\n","import DiscreteShadowcasting from \"./discrete-shadowcasting.js\";\nimport PreciseShadowcasting from \"./precise-shadowcasting.js\";\nimport RecursiveShadowcasting from \"./recursive-shadowcasting.js\";\nexport default { DiscreteShadowcasting, PreciseShadowcasting, RecursiveShadowcasting };\n","import FOV from \"./fov.js\";\n/**\n * @class Discrete shadowcasting algorithm. Obsoleted by Precise shadowcasting.\n * @augments ROT.FOV\n */\nexport default class DiscreteShadowcasting extends FOV {\n    compute(x, y, R, callback) {\n        /* this place is always visible */\n        callback(x, y, 0, 1);\n        /* standing in a dark place. FIXME is this a good idea?  */\n        if (!this._lightPasses(x, y)) {\n            return;\n        }\n        /* start and end angles */\n        let DATA = [];\n        let A, B, cx, cy, blocks;\n        /* analyze surrounding cells in concentric rings, starting from the center */\n        for (let r = 1; r <= R; r++) {\n            let neighbors = this._getCircle(x, y, r);\n            let angle = 360 / neighbors.length;\n            for (let i = 0; i < neighbors.length; i++) {\n                cx = neighbors[i][0];\n                cy = neighbors[i][1];\n                A = angle * (i - 0.5);\n                B = A + angle;\n                blocks = !this._lightPasses(cx, cy);\n                if (this._visibleCoords(Math.floor(A), Math.ceil(B), blocks, DATA)) {\n                    callback(cx, cy, r, 1);\n                }\n                if (DATA.length == 2 && DATA[0] == 0 && DATA[1] == 360) {\n                    return;\n                } /* cutoff? */\n            } /* for all cells in this ring */\n        } /* for all rings */\n    }\n    /**\n     * @param {int} A start angle\n     * @param {int} B end angle\n     * @param {bool} blocks Does current cell block visibility?\n     * @param {int[][]} DATA shadowed angle pairs\n     */\n    _visibleCoords(A, B, blocks, DATA) {\n        if (A < 0) {\n            let v1 = this._visibleCoords(0, B, blocks, DATA);\n            let v2 = this._visibleCoords(360 + A, 360, blocks, DATA);\n            return v1 || v2;\n        }\n        let index = 0;\n        while (index < DATA.length && DATA[index] < A) {\n            index++;\n        }\n        if (index == DATA.length) { /* completely new shadow */\n            if (blocks) {\n                DATA.push(A, B);\n            }\n            return true;\n        }\n        let count = 0;\n        if (index % 2) { /* this shadow starts in an existing shadow, or within its ending boundary */\n            while (index < DATA.length && DATA[index] < B) {\n                index++;\n                count++;\n            }\n            if (count == 0) {\n                return false;\n            }\n            if (blocks) {\n                if (count % 2) {\n                    DATA.splice(index - count, count, B);\n                }\n                else {\n                    DATA.splice(index - count, count);\n                }\n            }\n            return true;\n        }\n        else { /* this shadow starts outside an existing shadow, or within a starting boundary */\n            while (index < DATA.length && DATA[index] < B) {\n                index++;\n                count++;\n            }\n            /* visible when outside an existing shadow, or when overlapping */\n            if (A == DATA[index - count] && count == 1) {\n                return false;\n            }\n            if (blocks) {\n                if (count % 2) {\n                    DATA.splice(index - count, count, A);\n                }\n                else {\n                    DATA.splice(index - count, count, A, B);\n                }\n            }\n            return true;\n        }\n    }\n}\n","import { DIRS } from \"../constants.js\";\n;\n;\nexport default class FOV {\n    /**\n     * @class Abstract FOV algorithm\n     * @param {function} lightPassesCallback Does the light pass through x,y?\n     * @param {object} [options]\n     * @param {int} [options.topology=8] 4/6/8\n     */\n    constructor(lightPassesCallback, options = {}) {\n        this._lightPasses = lightPassesCallback;\n        this._options = Object.assign({ topology: 8 }, options);\n    }\n    /**\n     * Return all neighbors in a concentric ring\n     * @param {int} cx center-x\n     * @param {int} cy center-y\n     * @param {int} r range\n     */\n    _getCircle(cx, cy, r) {\n        let result = [];\n        let dirs, countFactor, startOffset;\n        switch (this._options.topology) {\n            case 4:\n                countFactor = 1;\n                startOffset = [0, 1];\n                dirs = [\n                    DIRS[8][7],\n                    DIRS[8][1],\n                    DIRS[8][3],\n                    DIRS[8][5]\n                ];\n                break;\n            case 6:\n                dirs = DIRS[6];\n                countFactor = 1;\n                startOffset = [-1, 1];\n                break;\n            case 8:\n                dirs = DIRS[4];\n                countFactor = 2;\n                startOffset = [-1, 1];\n                break;\n            default:\n                throw new Error(\"Incorrect topology for FOV computation\");\n                break;\n        }\n        /* starting neighbor */\n        let x = cx + startOffset[0] * r;\n        let y = cy + startOffset[1] * r;\n        /* circle */\n        for (let i = 0; i < dirs.length; i++) {\n            for (let j = 0; j < r * countFactor; j++) {\n                result.push([x, y]);\n                x += dirs[i][0];\n                y += dirs[i][1];\n            }\n        }\n        return result;\n    }\n}\n","import FOV from \"./fov.js\";\n/**\n * @class Precise shadowcasting algorithm\n * @augments ROT.FOV\n */\nexport default class PreciseShadowcasting extends FOV {\n    compute(x, y, R, callback) {\n        /* this place is always visible */\n        callback(x, y, 0, 1);\n        /* standing in a dark place. FIXME is this a good idea?  */\n        if (!this._lightPasses(x, y)) {\n            return;\n        }\n        /* list of all shadows */\n        let SHADOWS = [];\n        let cx, cy, blocks, A1, A2, visibility;\n        /* analyze surrounding cells in concentric rings, starting from the center */\n        for (let r = 1; r <= R; r++) {\n            let neighbors = this._getCircle(x, y, r);\n            let neighborCount = neighbors.length;\n            for (let i = 0; i < neighborCount; i++) {\n                cx = neighbors[i][0];\n                cy = neighbors[i][1];\n                /* shift half-an-angle backwards to maintain consistency of 0-th cells */\n                A1 = [i ? 2 * i - 1 : 2 * neighborCount - 1, 2 * neighborCount];\n                A2 = [2 * i + 1, 2 * neighborCount];\n                blocks = !this._lightPasses(cx, cy);\n                visibility = this._checkVisibility(A1, A2, blocks, SHADOWS);\n                if (visibility) {\n                    callback(cx, cy, r, visibility);\n                }\n                if (SHADOWS.length == 2 && SHADOWS[0][0] == 0 && SHADOWS[1][0] == SHADOWS[1][1]) {\n                    return;\n                } /* cutoff? */\n            } /* for all cells in this ring */\n        } /* for all rings */\n    }\n    /**\n     * @param {int[2]} A1 arc start\n     * @param {int[2]} A2 arc end\n     * @param {bool} blocks Does current arc block visibility?\n     * @param {int[][]} SHADOWS list of active shadows\n     */\n    _checkVisibility(A1, A2, blocks, SHADOWS) {\n        if (A1[0] > A2[0]) { /* split into two sub-arcs */\n            let v1 = this._checkVisibility(A1, [A1[1], A1[1]], blocks, SHADOWS);\n            let v2 = this._checkVisibility([0, 1], A2, blocks, SHADOWS);\n            return (v1 + v2) / 2;\n        }\n        /* index1: first shadow >= A1 */\n        let index1 = 0, edge1 = false;\n        while (index1 < SHADOWS.length) {\n            let old = SHADOWS[index1];\n            let diff = old[0] * A1[1] - A1[0] * old[1];\n            if (diff >= 0) { /* old >= A1 */\n                if (diff == 0 && !(index1 % 2)) {\n                    edge1 = true;\n                }\n                break;\n            }\n            index1++;\n        }\n        /* index2: last shadow <= A2 */\n        let index2 = SHADOWS.length, edge2 = false;\n        while (index2--) {\n            let old = SHADOWS[index2];\n            let diff = A2[0] * old[1] - old[0] * A2[1];\n            if (diff >= 0) { /* old <= A2 */\n                if (diff == 0 && (index2 % 2)) {\n                    edge2 = true;\n                }\n                break;\n            }\n        }\n        let visible = true;\n        if (index1 == index2 && (edge1 || edge2)) { /* subset of existing shadow, one of the edges match */\n            visible = false;\n        }\n        else if (edge1 && edge2 && index1 + 1 == index2 && (index2 % 2)) { /* completely equivalent with existing shadow */\n            visible = false;\n        }\n        else if (index1 > index2 && (index1 % 2)) { /* subset of existing shadow, not touching */\n            visible = false;\n        }\n        if (!visible) {\n            return 0;\n        } /* fast case: not visible */\n        let visibleLength;\n        /* compute the length of visible arc, adjust list of shadows (if blocking) */\n        let remove = index2 - index1 + 1;\n        if (remove % 2) {\n            if (index1 % 2) { /* first edge within existing shadow, second outside */\n                let P = SHADOWS[index1];\n                visibleLength = (A2[0] * P[1] - P[0] * A2[1]) / (P[1] * A2[1]);\n                if (blocks) {\n                    SHADOWS.splice(index1, remove, A2);\n                }\n            }\n            else { /* second edge within existing shadow, first outside */\n                let P = SHADOWS[index2];\n                visibleLength = (P[0] * A1[1] - A1[0] * P[1]) / (A1[1] * P[1]);\n                if (blocks) {\n                    SHADOWS.splice(index1, remove, A1);\n                }\n            }\n        }\n        else {\n            if (index1 % 2) { /* both edges within existing shadows */\n                let P1 = SHADOWS[index1];\n                let P2 = SHADOWS[index2];\n                visibleLength = (P2[0] * P1[1] - P1[0] * P2[1]) / (P1[1] * P2[1]);\n                if (blocks) {\n                    SHADOWS.splice(index1, remove);\n                }\n            }\n            else { /* both edges outside existing shadows */\n                if (blocks) {\n                    SHADOWS.splice(index1, remove, A1, A2);\n                }\n                return 1; /* whole arc visible! */\n            }\n        }\n        let arcLength = (A2[0] * A1[1] - A1[0] * A2[1]) / (A1[1] * A2[1]);\n        return visibleLength / arcLength;\n    }\n}\n","import FOV from \"./fov.js\";\n/** Octants used for translating recursive shadowcasting offsets */\nconst OCTANTS = [\n    [-1, 0, 0, 1],\n    [0, -1, 1, 0],\n    [0, -1, -1, 0],\n    [-1, 0, 0, -1],\n    [1, 0, 0, -1],\n    [0, 1, -1, 0],\n    [0, 1, 1, 0],\n    [1, 0, 0, 1]\n];\n/**\n * @class Recursive shadowcasting algorithm\n * Currently only supports 4/8 topologies, not hexagonal.\n * Based on Peter Harkins' implementation of Bjrn Bergstrm's algorithm described here: http://www.roguebasin.com/index.php?title=FOV_using_recursive_shadowcasting\n * @augments ROT.FOV\n */\nexport default class RecursiveShadowcasting extends FOV {\n    /**\n     * Compute visibility for a 360-degree circle\n     * @param {int} x\n     * @param {int} y\n     * @param {int} R Maximum visibility radius\n     * @param {function} callback\n     */\n    compute(x, y, R, callback) {\n        //You can always see your own tile\n        callback(x, y, 0, 1);\n        for (let i = 0; i < OCTANTS.length; i++) {\n            this._renderOctant(x, y, OCTANTS[i], R, callback);\n        }\n    }\n    /**\n     * Compute visibility for a 180-degree arc\n     * @param {int} x\n     * @param {int} y\n     * @param {int} R Maximum visibility radius\n     * @param {int} dir Direction to look in (expressed in a ROT.DIRS value);\n     * @param {function} callback\n     */\n    compute180(x, y, R, dir, callback) {\n        //You can always see your own tile\n        callback(x, y, 0, 1);\n        let previousOctant = (dir - 1 + 8) % 8; //Need to retrieve the previous octant to render a full 180 degrees\n        let nextPreviousOctant = (dir - 2 + 8) % 8; //Need to retrieve the previous two octants to render a full 180 degrees\n        let nextOctant = (dir + 1 + 8) % 8; //Need to grab to next octant to render a full 180 degrees\n        this._renderOctant(x, y, OCTANTS[nextPreviousOctant], R, callback);\n        this._renderOctant(x, y, OCTANTS[previousOctant], R, callback);\n        this._renderOctant(x, y, OCTANTS[dir], R, callback);\n        this._renderOctant(x, y, OCTANTS[nextOctant], R, callback);\n    }\n    ;\n    /**\n     * Compute visibility for a 90-degree arc\n     * @param {int} x\n     * @param {int} y\n     * @param {int} R Maximum visibility radius\n     * @param {int} dir Direction to look in (expressed in a ROT.DIRS value);\n     * @param {function} callback\n     */\n    compute90(x, y, R, dir, callback) {\n        //You can always see your own tile\n        callback(x, y, 0, 1);\n        let previousOctant = (dir - 1 + 8) % 8; //Need to retrieve the previous octant to render a full 90 degrees\n        this._renderOctant(x, y, OCTANTS[dir], R, callback);\n        this._renderOctant(x, y, OCTANTS[previousOctant], R, callback);\n    }\n    /**\n     * Render one octant (45-degree arc) of the viewshed\n     * @param {int} x\n     * @param {int} y\n     * @param {int} octant Octant to be rendered\n     * @param {int} R Maximum visibility radius\n     * @param {function} callback\n     */\n    _renderOctant(x, y, octant, R, callback) {\n        //Radius incremented by 1 to provide same coverage area as other shadowcasting radiuses\n        this._castVisibility(x, y, 1, 1.0, 0.0, R + 1, octant[0], octant[1], octant[2], octant[3], callback);\n    }\n    /**\n     * Actually calculates the visibility\n     * @param {int} startX The starting X coordinate\n     * @param {int} startY The starting Y coordinate\n     * @param {int} row The row to render\n     * @param {float} visSlopeStart The slope to start at\n     * @param {float} visSlopeEnd The slope to end at\n     * @param {int} radius The radius to reach out to\n     * @param {int} xx\n     * @param {int} xy\n     * @param {int} yx\n     * @param {int} yy\n     * @param {function} callback The callback to use when we hit a block that is visible\n     */\n    _castVisibility(startX, startY, row, visSlopeStart, visSlopeEnd, radius, xx, xy, yx, yy, callback) {\n        if (visSlopeStart < visSlopeEnd) {\n            return;\n        }\n        for (let i = row; i <= radius; i++) {\n            let dx = -i - 1;\n            let dy = -i;\n            let blocked = false;\n            let newStart = 0;\n            //'Row' could be column, names here assume octant 0 and would be flipped for half the octants\n            while (dx <= 0) {\n                dx += 1;\n                //Translate from relative coordinates to map coordinates\n                let mapX = startX + dx * xx + dy * xy;\n                let mapY = startY + dx * yx + dy * yy;\n                //Range of the row\n                let slopeStart = (dx - 0.5) / (dy + 0.5);\n                let slopeEnd = (dx + 0.5) / (dy - 0.5);\n                //Ignore if not yet at left edge of Octant\n                if (slopeEnd > visSlopeStart) {\n                    continue;\n                }\n                //Done if past right edge\n                if (slopeStart < visSlopeEnd) {\n                    break;\n                }\n                //If it's in range, it's visible\n                if ((dx * dx + dy * dy) < (radius * radius)) {\n                    callback(mapX, mapY, i, 1);\n                }\n                if (!blocked) {\n                    //If tile is a blocking tile, cast around it\n                    if (!this._lightPasses(mapX, mapY) && i < radius) {\n                        blocked = true;\n                        this._castVisibility(startX, startY, i + 1, visSlopeStart, slopeStart, radius, xx, xy, yx, yy, callback);\n                        newStart = slopeEnd;\n                    }\n                }\n                else {\n                    //Keep narrowing if scanning across a block\n                    if (!this._lightPasses(mapX, mapY)) {\n                        newStart = slopeEnd;\n                        continue;\n                    }\n                    //Block has ended\n                    blocked = false;\n                    visSlopeStart = newStart;\n                }\n            }\n            if (blocked) {\n                break;\n            }\n        }\n    }\n}\n","import Arena from \"./arena.js\";\nimport Uniform from \"./uniform.js\";\nimport Cellular from \"./cellular.js\";\nimport Digger from \"./digger.js\";\nimport EllerMaze from \"./ellermaze.js\";\nimport DividedMaze from \"./dividedmaze.js\";\nimport IceyMaze from \"./iceymaze.js\";\nimport Rogue from \"./rogue.js\";\nexport default { Arena, Uniform, Cellular, Digger, EllerMaze, DividedMaze, IceyMaze, Rogue };\n","import Map from \"./map.js\";\n/**\n * @class Simple empty rectangular room\n * @augments ROT.Map\n */\nexport default class Arena extends Map {\n    create(callback) {\n        let w = this._width - 1;\n        let h = this._height - 1;\n        for (let i = 0; i <= w; i++) {\n            for (let j = 0; j <= h; j++) {\n                let empty = (i && j && i < w && j < h);\n                callback(i, j, empty ? 0 : 1);\n            }\n        }\n        return this;\n    }\n}\n","import { DEFAULT_WIDTH, DEFAULT_HEIGHT } from \"../constants.js\";\n;\nexport default class Map {\n    /**\n     * @class Base map generator\n     * @param {int} [width=ROT.DEFAULT_WIDTH]\n     * @param {int} [height=ROT.DEFAULT_HEIGHT]\n     */\n    constructor(width = DEFAULT_WIDTH, height = DEFAULT_HEIGHT) {\n        this._width = width;\n        this._height = height;\n    }\n    ;\n    _fillMap(value) {\n        let map = [];\n        for (let i = 0; i < this._width; i++) {\n            map.push([]);\n            for (let j = 0; j < this._height; j++) {\n                map[i].push(value);\n            }\n        }\n        return map;\n    }\n}\n","import Dungeon from \"./dungeon.js\";\nimport { Room, Corridor } from \"./features.js\";\nimport RNG from \"../rng.js\";\n;\n/**\n * @class Dungeon generator which tries to fill the space evenly. Generates independent rooms and tries to connect them.\n * @augments ROT.Map.Dungeon\n */\nexport default class Uniform extends Dungeon {\n    constructor(width, height, options) {\n        super(width, height);\n        this._options = {\n            roomWidth: [3, 9],\n            roomHeight: [3, 5],\n            roomDugPercentage: 0.1,\n            timeLimit: 1000 /* we stop after this much time has passed (msec) */\n        };\n        Object.assign(this._options, options);\n        this._map = [];\n        this._dug = 0;\n        this._roomAttempts = 20; /* new room is created N-times until is considered as impossible to generate */\n        this._corridorAttempts = 20; /* corridors are tried N-times until the level is considered as impossible to connect */\n        this._connected = []; /* list of already connected rooms */\n        this._unconnected = []; /* list of remaining unconnected rooms */\n        this._digCallback = this._digCallback.bind(this);\n        this._canBeDugCallback = this._canBeDugCallback.bind(this);\n        this._isWallCallback = this._isWallCallback.bind(this);\n    }\n    /**\n     * Create a map. If the time limit has been hit, returns null.\n     * @see ROT.Map#create\n     */\n    create(callback) {\n        let t1 = Date.now();\n        while (1) {\n            let t2 = Date.now();\n            if (t2 - t1 > this._options.timeLimit) {\n                return null;\n            } /* time limit! */\n            this._map = this._fillMap(1);\n            this._dug = 0;\n            this._rooms = [];\n            this._unconnected = [];\n            this._generateRooms();\n            if (this._rooms.length < 2) {\n                continue;\n            }\n            if (this._generateCorridors()) {\n                break;\n            }\n        }\n        if (callback) {\n            for (let i = 0; i < this._width; i++) {\n                for (let j = 0; j < this._height; j++) {\n                    callback(i, j, this._map[i][j]);\n                }\n            }\n        }\n        return this;\n    }\n    /**\n     * Generates a suitable amount of rooms\n     */\n    _generateRooms() {\n        let w = this._width - 2;\n        let h = this._height - 2;\n        let room;\n        do {\n            room = this._generateRoom();\n            if (this._dug / (w * h) > this._options.roomDugPercentage) {\n                break;\n            } /* achieved requested amount of free space */\n        } while (room);\n        /* either enough rooms, or not able to generate more of them :) */\n    }\n    /**\n     * Try to generate one room\n     */\n    _generateRoom() {\n        let count = 0;\n        while (count < this._roomAttempts) {\n            count++;\n            let room = Room.createRandom(this._width, this._height, this._options);\n            if (!room.isValid(this._isWallCallback, this._canBeDugCallback)) {\n                continue;\n            }\n            room.create(this._digCallback);\n            this._rooms.push(room);\n            return room;\n        }\n        /* no room was generated in a given number of attempts */\n        return null;\n    }\n    /**\n     * Generates connectors beween rooms\n     * @returns {bool} success Was this attempt successfull?\n     */\n    _generateCorridors() {\n        let cnt = 0;\n        while (cnt < this._corridorAttempts) {\n            cnt++;\n            this._corridors = [];\n            /* dig rooms into a clear map */\n            this._map = this._fillMap(1);\n            for (let i = 0; i < this._rooms.length; i++) {\n                let room = this._rooms[i];\n                room.clearDoors();\n                room.create(this._digCallback);\n            }\n            this._unconnected = RNG.shuffle(this._rooms.slice());\n            this._connected = [];\n            if (this._unconnected.length) {\n                this._connected.push(this._unconnected.pop());\n            } /* first one is always connected */\n            while (1) {\n                /* 1. pick random connected room */\n                let connected = RNG.getItem(this._connected);\n                if (!connected) {\n                    break;\n                }\n                /* 2. find closest unconnected */\n                let room1 = this._closestRoom(this._unconnected, connected);\n                if (!room1) {\n                    break;\n                }\n                /* 3. connect it to closest connected */\n                let room2 = this._closestRoom(this._connected, room1);\n                if (!room2) {\n                    break;\n                }\n                let ok = this._connectRooms(room1, room2);\n                if (!ok) {\n                    break;\n                } /* stop connecting, re-shuffle */\n                if (!this._unconnected.length) {\n                    return true;\n                } /* done; no rooms remain */\n            }\n        }\n        return false;\n    }\n    ;\n    /**\n     * For a given room, find the closest one from the list\n     */\n    _closestRoom(rooms, room) {\n        let dist = Infinity;\n        let center = room.getCenter();\n        let result = null;\n        for (let i = 0; i < rooms.length; i++) {\n            let r = rooms[i];\n            let c = r.getCenter();\n            let dx = c[0] - center[0];\n            let dy = c[1] - center[1];\n            let d = dx * dx + dy * dy;\n            if (d < dist) {\n                dist = d;\n                result = r;\n            }\n        }\n        return result;\n    }\n    _connectRooms(room1, room2) {\n        /*\n            room1.debug();\n            room2.debug();\n        */\n        let center1 = room1.getCenter();\n        let center2 = room2.getCenter();\n        let diffX = center2[0] - center1[0];\n        let diffY = center2[1] - center1[1];\n        let start;\n        let end;\n        let dirIndex1, dirIndex2, min, max, index;\n        if (Math.abs(diffX) < Math.abs(diffY)) { /* first try connecting north-south walls */\n            dirIndex1 = (diffY > 0 ? 2 : 0);\n            dirIndex2 = (dirIndex1 + 2) % 4;\n            min = room2.getLeft();\n            max = room2.getRight();\n            index = 0;\n        }\n        else { /* first try connecting east-west walls */\n            dirIndex1 = (diffX > 0 ? 1 : 3);\n            dirIndex2 = (dirIndex1 + 2) % 4;\n            min = room2.getTop();\n            max = room2.getBottom();\n            index = 1;\n        }\n        start = this._placeInWall(room1, dirIndex1); /* corridor will start here */\n        if (!start) {\n            return false;\n        }\n        if (start[index] >= min && start[index] <= max) { /* possible to connect with straight line (I-like) */\n            end = start.slice();\n            let value = 0;\n            switch (dirIndex2) {\n                case 0:\n                    value = room2.getTop() - 1;\n                    break;\n                case 1:\n                    value = room2.getRight() + 1;\n                    break;\n                case 2:\n                    value = room2.getBottom() + 1;\n                    break;\n                case 3:\n                    value = room2.getLeft() - 1;\n                    break;\n            }\n            end[(index + 1) % 2] = value;\n            this._digLine([start, end]);\n        }\n        else if (start[index] < min - 1 || start[index] > max + 1) { /* need to switch target wall (L-like) */\n            let diff = start[index] - center2[index];\n            let rotation = 0;\n            switch (dirIndex2) {\n                case 0:\n                case 1:\n                    rotation = (diff < 0 ? 3 : 1);\n                    break;\n                case 2:\n                case 3:\n                    rotation = (diff < 0 ? 1 : 3);\n                    break;\n            }\n            dirIndex2 = (dirIndex2 + rotation) % 4;\n            end = this._placeInWall(room2, dirIndex2);\n            if (!end) {\n                return false;\n            }\n            let mid = [0, 0];\n            mid[index] = start[index];\n            let index2 = (index + 1) % 2;\n            mid[index2] = end[index2];\n            this._digLine([start, mid, end]);\n        }\n        else { /* use current wall pair, but adjust the line in the middle (S-like) */\n            let index2 = (index + 1) % 2;\n            end = this._placeInWall(room2, dirIndex2);\n            if (!end) {\n                return false;\n            }\n            let mid = Math.round((end[index2] + start[index2]) / 2);\n            let mid1 = [0, 0];\n            let mid2 = [0, 0];\n            mid1[index] = start[index];\n            mid1[index2] = mid;\n            mid2[index] = end[index];\n            mid2[index2] = mid;\n            this._digLine([start, mid1, mid2, end]);\n        }\n        room1.addDoor(start[0], start[1]);\n        room2.addDoor(end[0], end[1]);\n        index = this._unconnected.indexOf(room1);\n        if (index != -1) {\n            this._unconnected.splice(index, 1);\n            this._connected.push(room1);\n        }\n        index = this._unconnected.indexOf(room2);\n        if (index != -1) {\n            this._unconnected.splice(index, 1);\n            this._connected.push(room2);\n        }\n        return true;\n    }\n    _placeInWall(room, dirIndex) {\n        let start = [0, 0];\n        let dir = [0, 0];\n        let length = 0;\n        switch (dirIndex) {\n            case 0:\n                dir = [1, 0];\n                start = [room.getLeft(), room.getTop() - 1];\n                length = room.getRight() - room.getLeft() + 1;\n                break;\n            case 1:\n                dir = [0, 1];\n                start = [room.getRight() + 1, room.getTop()];\n                length = room.getBottom() - room.getTop() + 1;\n                break;\n            case 2:\n                dir = [1, 0];\n                start = [room.getLeft(), room.getBottom() + 1];\n                length = room.getRight() - room.getLeft() + 1;\n                break;\n            case 3:\n                dir = [0, 1];\n                start = [room.getLeft() - 1, room.getTop()];\n                length = room.getBottom() - room.getTop() + 1;\n                break;\n        }\n        let avail = [];\n        let lastBadIndex = -2;\n        for (let i = 0; i < length; i++) {\n            let x = start[0] + i * dir[0];\n            let y = start[1] + i * dir[1];\n            avail.push(null);\n            let isWall = (this._map[x][y] == 1);\n            if (isWall) {\n                if (lastBadIndex != i - 1) {\n                    avail[i] = [x, y];\n                }\n            }\n            else {\n                lastBadIndex = i;\n                if (i) {\n                    avail[i - 1] = null;\n                }\n            }\n        }\n        for (let i = avail.length - 1; i >= 0; i--) {\n            if (!avail[i]) {\n                avail.splice(i, 1);\n            }\n        }\n        return (avail.length ? RNG.getItem(avail) : null);\n    }\n    /**\n     * Dig a polyline.\n     */\n    _digLine(points) {\n        for (let i = 1; i < points.length; i++) {\n            let start = points[i - 1];\n            let end = points[i];\n            let corridor = new Corridor(start[0], start[1], end[0], end[1]);\n            corridor.create(this._digCallback);\n            this._corridors.push(corridor);\n        }\n    }\n    _digCallback(x, y, value) {\n        this._map[x][y] = value;\n        if (value == 0) {\n            this._dug++;\n        }\n    }\n    _isWallCallback(x, y) {\n        if (x < 0 || y < 0 || x >= this._width || y >= this._height) {\n            return false;\n        }\n        return (this._map[x][y] == 1);\n    }\n    _canBeDugCallback(x, y) {\n        if (x < 1 || y < 1 || x + 1 >= this._width || y + 1 >= this._height) {\n            return false;\n        }\n        return (this._map[x][y] == 1);\n    }\n}\n","import Map from \"./map.js\";\n/**\n * @class Dungeon map: has rooms and corridors\n * @augments ROT.Map\n */\nexport default class Dungeon extends Map {\n    constructor(width, height) {\n        super(width, height);\n        this._rooms = [];\n        this._corridors = [];\n    }\n    /**\n     * Get all generated rooms\n     * @returns {ROT.Map.Feature.Room[]}\n     */\n    getRooms() { return this._rooms; }\n    /**\n     * Get all generated corridors\n     * @returns {ROT.Map.Feature.Corridor[]}\n     */\n    getCorridors() { return this._corridors; }\n}\n","import RNG from \"../rng.js\";\n;\n/**\n * @class Dungeon feature; has own .create() method\n */\nclass Feature {\n}\n/**\n * @class Room\n * @augments ROT.Map.Feature\n * @param {int} x1\n * @param {int} y1\n * @param {int} x2\n * @param {int} y2\n * @param {int} [doorX]\n * @param {int} [doorY]\n */\nexport class Room extends Feature {\n    constructor(x1, y1, x2, y2, doorX, doorY) {\n        super();\n        this._x1 = x1;\n        this._y1 = y1;\n        this._x2 = x2;\n        this._y2 = y2;\n        this._doors = {};\n        if (doorX !== undefined && doorY !== undefined) {\n            this.addDoor(doorX, doorY);\n        }\n    }\n    ;\n    /**\n     * Room of random size, with a given doors and direction\n     */\n    static createRandomAt(x, y, dx, dy, options) {\n        let min = options.roomWidth[0];\n        let max = options.roomWidth[1];\n        let width = RNG.getUniformInt(min, max);\n        min = options.roomHeight[0];\n        max = options.roomHeight[1];\n        let height = RNG.getUniformInt(min, max);\n        if (dx == 1) { /* to the right */\n            let y2 = y - Math.floor(RNG.getUniform() * height);\n            return new this(x + 1, y2, x + width, y2 + height - 1, x, y);\n        }\n        if (dx == -1) { /* to the left */\n            let y2 = y - Math.floor(RNG.getUniform() * height);\n            return new this(x - width, y2, x - 1, y2 + height - 1, x, y);\n        }\n        if (dy == 1) { /* to the bottom */\n            let x2 = x - Math.floor(RNG.getUniform() * width);\n            return new this(x2, y + 1, x2 + width - 1, y + height, x, y);\n        }\n        if (dy == -1) { /* to the top */\n            let x2 = x - Math.floor(RNG.getUniform() * width);\n            return new this(x2, y - height, x2 + width - 1, y - 1, x, y);\n        }\n        throw new Error(\"dx or dy must be 1 or -1\");\n    }\n    /**\n     * Room of random size, positioned around center coords\n     */\n    static createRandomCenter(cx, cy, options) {\n        let min = options.roomWidth[0];\n        let max = options.roomWidth[1];\n        let width = RNG.getUniformInt(min, max);\n        min = options.roomHeight[0];\n        max = options.roomHeight[1];\n        let height = RNG.getUniformInt(min, max);\n        let x1 = cx - Math.floor(RNG.getUniform() * width);\n        let y1 = cy - Math.floor(RNG.getUniform() * height);\n        let x2 = x1 + width - 1;\n        let y2 = y1 + height - 1;\n        return new this(x1, y1, x2, y2);\n    }\n    /**\n     * Room of random size within a given dimensions\n     */\n    static createRandom(availWidth, availHeight, options) {\n        let min = options.roomWidth[0];\n        let max = options.roomWidth[1];\n        let width = RNG.getUniformInt(min, max);\n        min = options.roomHeight[0];\n        max = options.roomHeight[1];\n        let height = RNG.getUniformInt(min, max);\n        let left = availWidth - width - 1;\n        let top = availHeight - height - 1;\n        let x1 = 1 + Math.floor(RNG.getUniform() * left);\n        let y1 = 1 + Math.floor(RNG.getUniform() * top);\n        let x2 = x1 + width - 1;\n        let y2 = y1 + height - 1;\n        return new this(x1, y1, x2, y2);\n    }\n    addDoor(x, y) {\n        this._doors[x + \",\" + y] = 1;\n        return this;\n    }\n    /**\n     * @param {function}\n     */\n    getDoors(cb) {\n        for (let key in this._doors) {\n            let parts = key.split(\",\");\n            cb(parseInt(parts[0]), parseInt(parts[1]));\n        }\n        return this;\n    }\n    clearDoors() {\n        this._doors = {};\n        return this;\n    }\n    addDoors(isWallCallback) {\n        let left = this._x1 - 1;\n        let right = this._x2 + 1;\n        let top = this._y1 - 1;\n        let bottom = this._y2 + 1;\n        for (let x = left; x <= right; x++) {\n            for (let y = top; y <= bottom; y++) {\n                if (x != left && x != right && y != top && y != bottom) {\n                    continue;\n                }\n                if (isWallCallback(x, y)) {\n                    continue;\n                }\n                this.addDoor(x, y);\n            }\n        }\n        return this;\n    }\n    debug() {\n        console.log(\"room\", this._x1, this._y1, this._x2, this._y2);\n    }\n    isValid(isWallCallback, canBeDugCallback) {\n        let left = this._x1 - 1;\n        let right = this._x2 + 1;\n        let top = this._y1 - 1;\n        let bottom = this._y2 + 1;\n        for (let x = left; x <= right; x++) {\n            for (let y = top; y <= bottom; y++) {\n                if (x == left || x == right || y == top || y == bottom) {\n                    if (!isWallCallback(x, y)) {\n                        return false;\n                    }\n                }\n                else {\n                    if (!canBeDugCallback(x, y)) {\n                        return false;\n                    }\n                }\n            }\n        }\n        return true;\n    }\n    /**\n     * @param {function} digCallback Dig callback with a signature (x, y, value). Values: 0 = empty, 1 = wall, 2 = door. Multiple doors are allowed.\n     */\n    create(digCallback) {\n        let left = this._x1 - 1;\n        let right = this._x2 + 1;\n        let top = this._y1 - 1;\n        let bottom = this._y2 + 1;\n        let value = 0;\n        for (let x = left; x <= right; x++) {\n            for (let y = top; y <= bottom; y++) {\n                if (x + \",\" + y in this._doors) {\n                    value = 2;\n                }\n                else if (x == left || x == right || y == top || y == bottom) {\n                    value = 1;\n                }\n                else {\n                    value = 0;\n                }\n                digCallback(x, y, value);\n            }\n        }\n    }\n    getCenter() {\n        return [Math.round((this._x1 + this._x2) / 2), Math.round((this._y1 + this._y2) / 2)];\n    }\n    getLeft() { return this._x1; }\n    getRight() { return this._x2; }\n    getTop() { return this._y1; }\n    getBottom() { return this._y2; }\n}\n/**\n * @class Corridor\n * @augments ROT.Map.Feature\n * @param {int} startX\n * @param {int} startY\n * @param {int} endX\n * @param {int} endY\n */\nexport class Corridor extends Feature {\n    constructor(startX, startY, endX, endY) {\n        super();\n        this._startX = startX;\n        this._startY = startY;\n        this._endX = endX;\n        this._endY = endY;\n        this._endsWithAWall = true;\n    }\n    static createRandomAt(x, y, dx, dy, options) {\n        let min = options.corridorLength[0];\n        let max = options.corridorLength[1];\n        let length = RNG.getUniformInt(min, max);\n        return new this(x, y, x + dx * length, y + dy * length);\n    }\n    debug() {\n        console.log(\"corridor\", this._startX, this._startY, this._endX, this._endY);\n    }\n    isValid(isWallCallback, canBeDugCallback) {\n        let sx = this._startX;\n        let sy = this._startY;\n        let dx = this._endX - sx;\n        let dy = this._endY - sy;\n        let length = 1 + Math.max(Math.abs(dx), Math.abs(dy));\n        if (dx) {\n            dx = dx / Math.abs(dx);\n        }\n        if (dy) {\n            dy = dy / Math.abs(dy);\n        }\n        let nx = dy;\n        let ny = -dx;\n        let ok = true;\n        for (let i = 0; i < length; i++) {\n            let x = sx + i * dx;\n            let y = sy + i * dy;\n            if (!canBeDugCallback(x, y)) {\n                ok = false;\n            }\n            if (!isWallCallback(x + nx, y + ny)) {\n                ok = false;\n            }\n            if (!isWallCallback(x - nx, y - ny)) {\n                ok = false;\n            }\n            if (!ok) {\n                length = i;\n                this._endX = x - dx;\n                this._endY = y - dy;\n                break;\n            }\n        }\n        /**\n         * If the length degenerated, this corridor might be invalid\n         */\n        /* not supported */\n        if (length == 0) {\n            return false;\n        }\n        /* length 1 allowed only if the next space is empty */\n        if (length == 1 && isWallCallback(this._endX + dx, this._endY + dy)) {\n            return false;\n        }\n        /**\n         * We do not want the corridor to crash into a corner of a room;\n         * if any of the ending corners is empty, the N+1th cell of this corridor must be empty too.\n         *\n         * Situation:\n         * #######1\n         * .......?\n         * #######2\n         *\n         * The corridor was dug from left to right.\n         * 1, 2 - problematic corners, ? = N+1th cell (not dug)\n         */\n        let firstCornerBad = !isWallCallback(this._endX + dx + nx, this._endY + dy + ny);\n        let secondCornerBad = !isWallCallback(this._endX + dx - nx, this._endY + dy - ny);\n        this._endsWithAWall = isWallCallback(this._endX + dx, this._endY + dy);\n        if ((firstCornerBad || secondCornerBad) && this._endsWithAWall) {\n            return false;\n        }\n        return true;\n    }\n    /**\n     * @param {function} digCallback Dig callback with a signature (x, y, value). Values: 0 = empty.\n     */\n    create(digCallback) {\n        let sx = this._startX;\n        let sy = this._startY;\n        let dx = this._endX - sx;\n        let dy = this._endY - sy;\n        let length = 1 + Math.max(Math.abs(dx), Math.abs(dy));\n        if (dx) {\n            dx = dx / Math.abs(dx);\n        }\n        if (dy) {\n            dy = dy / Math.abs(dy);\n        }\n        for (let i = 0; i < length; i++) {\n            let x = sx + i * dx;\n            let y = sy + i * dy;\n            digCallback(x, y, 0);\n        }\n        return true;\n    }\n    createPriorityWalls(priorityWallCallback) {\n        if (!this._endsWithAWall) {\n            return;\n        }\n        let sx = this._startX;\n        let sy = this._startY;\n        let dx = this._endX - sx;\n        let dy = this._endY - sy;\n        if (dx) {\n            dx = dx / Math.abs(dx);\n        }\n        if (dy) {\n            dy = dy / Math.abs(dy);\n        }\n        let nx = dy;\n        let ny = -dx;\n        priorityWallCallback(this._endX + dx, this._endY + dy);\n        priorityWallCallback(this._endX + nx, this._endY + ny);\n        priorityWallCallback(this._endX - nx, this._endY - ny);\n    }\n}\n","import Map from \"./map.js\";\nimport { DIRS } from \"../constants.js\";\nimport RNG from \"../rng.js\";\n;\n/**\n * @class Cellular automaton map generator\n * @augments ROT.Map\n * @param {int} [width=ROT.DEFAULT_WIDTH]\n * @param {int} [height=ROT.DEFAULT_HEIGHT]\n * @param {object} [options] Options\n * @param {int[]} [options.born] List of neighbor counts for a new cell to be born in empty space\n * @param {int[]} [options.survive] List of neighbor counts for an existing  cell to survive\n * @param {int} [options.topology] Topology 4 or 6 or 8\n */\nexport default class Cellular extends Map {\n    constructor(width, height, options = {}) {\n        super(width, height);\n        this._options = {\n            born: [5, 6, 7, 8],\n            survive: [4, 5, 6, 7, 8],\n            topology: 8\n        };\n        this.setOptions(options);\n        this._dirs = DIRS[this._options.topology];\n        this._map = this._fillMap(0);\n    }\n    /**\n     * Fill the map with random values\n     * @param {float} probability Probability for a cell to become alive; 0 = all empty, 1 = all full\n     */\n    randomize(probability) {\n        for (let i = 0; i < this._width; i++) {\n            for (let j = 0; j < this._height; j++) {\n                this._map[i][j] = (RNG.getUniform() < probability ? 1 : 0);\n            }\n        }\n        return this;\n    }\n    /**\n     * Change options.\n     * @see ROT.Map.Cellular\n     */\n    setOptions(options) { Object.assign(this._options, options); }\n    set(x, y, value) { this._map[x][y] = value; }\n    create(callback) {\n        let newMap = this._fillMap(0);\n        let born = this._options.born;\n        let survive = this._options.survive;\n        for (let j = 0; j < this._height; j++) {\n            let widthStep = 1;\n            let widthStart = 0;\n            if (this._options.topology == 6) {\n                widthStep = 2;\n                widthStart = j % 2;\n            }\n            for (let i = widthStart; i < this._width; i += widthStep) {\n                let cur = this._map[i][j];\n                let ncount = this._getNeighbors(i, j);\n                if (cur && survive.indexOf(ncount) != -1) { /* survive */\n                    newMap[i][j] = 1;\n                }\n                else if (!cur && born.indexOf(ncount) != -1) { /* born */\n                    newMap[i][j] = 1;\n                }\n            }\n        }\n        this._map = newMap;\n        callback && this._serviceCallback(callback);\n    }\n    _serviceCallback(callback) {\n        for (let j = 0; j < this._height; j++) {\n            let widthStep = 1;\n            let widthStart = 0;\n            if (this._options.topology == 6) {\n                widthStep = 2;\n                widthStart = j % 2;\n            }\n            for (let i = widthStart; i < this._width; i += widthStep) {\n                callback(i, j, this._map[i][j]);\n            }\n        }\n    }\n    /**\n     * Get neighbor count at [i,j] in this._map\n     */\n    _getNeighbors(cx, cy) {\n        let result = 0;\n        for (let i = 0; i < this._dirs.length; i++) {\n            let dir = this._dirs[i];\n            let x = cx + dir[0];\n            let y = cy + dir[1];\n            if (x < 0 || x >= this._width || y < 0 || y >= this._height) {\n                continue;\n            }\n            result += (this._map[x][y] == 1 ? 1 : 0);\n        }\n        return result;\n    }\n    /**\n     * Make sure every non-wall space is accessible.\n     * @param {function} callback to call to display map when do\n     * @param {int} value to consider empty space - defaults to 0\n     * @param {function} callback to call when a new connection is made\n     */\n    connect(callback, value, connectionCallback) {\n        if (!value)\n            value = 0;\n        let allFreeSpace = [];\n        let notConnected = {};\n        // find all free space\n        let widthStep = 1;\n        let widthStarts = [0, 0];\n        if (this._options.topology == 6) {\n            widthStep = 2;\n            widthStarts = [0, 1];\n        }\n        for (let y = 0; y < this._height; y++) {\n            for (let x = widthStarts[y % 2]; x < this._width; x += widthStep) {\n                if (this._freeSpace(x, y, value)) {\n                    let p = [x, y];\n                    notConnected[this._pointKey(p)] = p;\n                    allFreeSpace.push([x, y]);\n                }\n            }\n        }\n        let start = allFreeSpace[RNG.getUniformInt(0, allFreeSpace.length - 1)];\n        let key = this._pointKey(start);\n        let connected = {};\n        connected[key] = start;\n        delete notConnected[key];\n        // find what's connected to the starting point\n        this._findConnected(connected, notConnected, [start], false, value);\n        while (Object.keys(notConnected).length > 0) {\n            // find two points from notConnected to connected\n            let p = this._getFromTo(connected, notConnected);\n            let from = p[0]; // notConnected\n            let to = p[1]; // connected\n            // find everything connected to the starting point\n            let local = {};\n            local[this._pointKey(from)] = from;\n            this._findConnected(local, notConnected, [from], true, value);\n            // connect to a connected cell\n            let tunnelFn = (this._options.topology == 6 ? this._tunnelToConnected6 : this._tunnelToConnected);\n            tunnelFn.call(this, to, from, connected, notConnected, value, connectionCallback);\n            // now all of local is connected\n            for (let k in local) {\n                let pp = local[k];\n                this._map[pp[0]][pp[1]] = value;\n                connected[k] = pp;\n                delete notConnected[k];\n            }\n        }\n        callback && this._serviceCallback(callback);\n    }\n    /**\n     * Find random points to connect. Search for the closest point in the larger space.\n     * This is to minimize the length of the passage while maintaining good performance.\n     */\n    _getFromTo(connected, notConnected) {\n        let from = [0, 0], to = [0, 0], d;\n        let connectedKeys = Object.keys(connected);\n        let notConnectedKeys = Object.keys(notConnected);\n        for (let i = 0; i < 5; i++) {\n            if (connectedKeys.length < notConnectedKeys.length) {\n                let keys = connectedKeys;\n                to = connected[keys[RNG.getUniformInt(0, keys.length - 1)]];\n                from = this._getClosest(to, notConnected);\n            }\n            else {\n                let keys = notConnectedKeys;\n                from = notConnected[keys[RNG.getUniformInt(0, keys.length - 1)]];\n                to = this._getClosest(from, connected);\n            }\n            d = (from[0] - to[0]) * (from[0] - to[0]) + (from[1] - to[1]) * (from[1] - to[1]);\n            if (d < 64) {\n                break;\n            }\n        }\n        // console.log(\">>> connected=\" + to + \" notConnected=\" + from + \" dist=\" + d);\n        return [from, to];\n    }\n    _getClosest(point, space) {\n        let minPoint = null;\n        let minDist = null;\n        for (let k in space) {\n            let p = space[k];\n            let d = (p[0] - point[0]) * (p[0] - point[0]) + (p[1] - point[1]) * (p[1] - point[1]);\n            if (minDist == null || d < minDist) {\n                minDist = d;\n                minPoint = p;\n            }\n        }\n        return minPoint;\n    }\n    _findConnected(connected, notConnected, stack, keepNotConnected, value) {\n        while (stack.length > 0) {\n            let p = stack.splice(0, 1)[0];\n            let tests;\n            if (this._options.topology == 6) {\n                tests = [\n                    [p[0] + 2, p[1]],\n                    [p[0] + 1, p[1] - 1],\n                    [p[0] - 1, p[1] - 1],\n                    [p[0] - 2, p[1]],\n                    [p[0] - 1, p[1] + 1],\n                    [p[0] + 1, p[1] + 1],\n                ];\n            }\n            else {\n                tests = [\n                    [p[0] + 1, p[1]],\n                    [p[0] - 1, p[1]],\n                    [p[0], p[1] + 1],\n                    [p[0], p[1] - 1]\n                ];\n            }\n            for (let i = 0; i < tests.length; i++) {\n                let key = this._pointKey(tests[i]);\n                if (connected[key] == null && this._freeSpace(tests[i][0], tests[i][1], value)) {\n                    connected[key] = tests[i];\n                    if (!keepNotConnected) {\n                        delete notConnected[key];\n                    }\n                    stack.push(tests[i]);\n                }\n            }\n        }\n    }\n    _tunnelToConnected(to, from, connected, notConnected, value, connectionCallback) {\n        let a, b;\n        if (from[0] < to[0]) {\n            a = from;\n            b = to;\n        }\n        else {\n            a = to;\n            b = from;\n        }\n        for (let xx = a[0]; xx <= b[0]; xx++) {\n            this._map[xx][a[1]] = value;\n            let p = [xx, a[1]];\n            let pkey = this._pointKey(p);\n            connected[pkey] = p;\n            delete notConnected[pkey];\n        }\n        if (connectionCallback && a[0] < b[0]) {\n            connectionCallback(a, [b[0], a[1]]);\n        }\n        // x is now fixed\n        let x = b[0];\n        if (from[1] < to[1]) {\n            a = from;\n            b = to;\n        }\n        else {\n            a = to;\n            b = from;\n        }\n        for (let yy = a[1]; yy < b[1]; yy++) {\n            this._map[x][yy] = value;\n            let p = [x, yy];\n            let pkey = this._pointKey(p);\n            connected[pkey] = p;\n            delete notConnected[pkey];\n        }\n        if (connectionCallback && a[1] < b[1]) {\n            connectionCallback([b[0], a[1]], [b[0], b[1]]);\n        }\n    }\n    _tunnelToConnected6(to, from, connected, notConnected, value, connectionCallback) {\n        let a, b;\n        if (from[0] < to[0]) {\n            a = from;\n            b = to;\n        }\n        else {\n            a = to;\n            b = from;\n        }\n        // tunnel diagonally until horizontally level\n        let xx = a[0];\n        let yy = a[1];\n        while (!(xx == b[0] && yy == b[1])) {\n            let stepWidth = 2;\n            if (yy < b[1]) {\n                yy++;\n                stepWidth = 1;\n            }\n            else if (yy > b[1]) {\n                yy--;\n                stepWidth = 1;\n            }\n            if (xx < b[0]) {\n                xx += stepWidth;\n            }\n            else if (xx > b[0]) {\n                xx -= stepWidth;\n            }\n            else if (b[1] % 2) {\n                // Won't step outside map if destination on is map's right edge\n                xx -= stepWidth;\n            }\n            else {\n                // ditto for left edge\n                xx += stepWidth;\n            }\n            this._map[xx][yy] = value;\n            let p = [xx, yy];\n            let pkey = this._pointKey(p);\n            connected[pkey] = p;\n            delete notConnected[pkey];\n        }\n        if (connectionCallback) {\n            connectionCallback(from, to);\n        }\n    }\n    _freeSpace(x, y, value) {\n        return x >= 0 && x < this._width && y >= 0 && y < this._height && this._map[x][y] == value;\n    }\n    _pointKey(p) { return p[0] + \".\" + p[1]; }\n}\n","import Dungeon from \"./dungeon.js\";\nimport { Room, Corridor } from \"./features.js\";\nimport RNG from \"../rng.js\";\nimport { DIRS } from \"../constants.js\";\nconst FEATURES = {\n    \"room\": Room,\n    \"corridor\": Corridor\n};\n/**\n * Random dungeon generator using human-like digging patterns.\n * Heavily based on Mike Anderson's ideas from the \"Tyrant\" algo, mentioned at\n * http://www.roguebasin.roguelikedevelopment.org/index.php?title=Dungeon-Building_Algorithm.\n */\nexport default class Digger extends Dungeon {\n    constructor(width, height, options = {}) {\n        super(width, height);\n        this._options = Object.assign({\n            roomWidth: [3, 9],\n            roomHeight: [3, 5],\n            corridorLength: [3, 10],\n            dugPercentage: 0.2,\n            timeLimit: 1000 /* we stop after this much time has passed (msec) */\n        }, options);\n        this._features = {\n            \"room\": 4,\n            \"corridor\": 4\n        };\n        this._map = [];\n        this._featureAttempts = 20; /* how many times do we try to create a feature on a suitable wall */\n        this._walls = {}; /* these are available for digging */\n        this._dug = 0;\n        this._digCallback = this._digCallback.bind(this);\n        this._canBeDugCallback = this._canBeDugCallback.bind(this);\n        this._isWallCallback = this._isWallCallback.bind(this);\n        this._priorityWallCallback = this._priorityWallCallback.bind(this);\n    }\n    create(callback) {\n        this._rooms = [];\n        this._corridors = [];\n        this._map = this._fillMap(1);\n        this._walls = {};\n        this._dug = 0;\n        let area = (this._width - 2) * (this._height - 2);\n        this._firstRoom();\n        let t1 = Date.now();\n        let priorityWalls;\n        do {\n            priorityWalls = 0;\n            let t2 = Date.now();\n            if (t2 - t1 > this._options.timeLimit) {\n                break;\n            }\n            /* find a good wall */\n            let wall = this._findWall();\n            if (!wall) {\n                break;\n            } /* no more walls */\n            let parts = wall.split(\",\");\n            let x = parseInt(parts[0]);\n            let y = parseInt(parts[1]);\n            let dir = this._getDiggingDirection(x, y);\n            if (!dir) {\n                continue;\n            } /* this wall is not suitable */\n            //\t\tconsole.log(\"wall\", x, y);\n            /* try adding a feature */\n            let featureAttempts = 0;\n            do {\n                featureAttempts++;\n                if (this._tryFeature(x, y, dir[0], dir[1])) { /* feature added */\n                    //if (this._rooms.length + this._corridors.length == 2) { this._rooms[0].addDoor(x, y); } /* first room oficially has doors */\n                    this._removeSurroundingWalls(x, y);\n                    this._removeSurroundingWalls(x - dir[0], y - dir[1]);\n                    break;\n                }\n            } while (featureAttempts < this._featureAttempts);\n            for (let id in this._walls) {\n                if (this._walls[id] > 1) {\n                    priorityWalls++;\n                }\n            }\n        } while (this._dug / area < this._options.dugPercentage || priorityWalls); /* fixme number of priority walls */\n        this._addDoors();\n        if (callback) {\n            for (let i = 0; i < this._width; i++) {\n                for (let j = 0; j < this._height; j++) {\n                    callback(i, j, this._map[i][j]);\n                }\n            }\n        }\n        this._walls = {};\n        this._map = [];\n        return this;\n    }\n    _digCallback(x, y, value) {\n        if (value == 0 || value == 2) { /* empty */\n            this._map[x][y] = 0;\n            this._dug++;\n        }\n        else { /* wall */\n            this._walls[x + \",\" + y] = 1;\n        }\n    }\n    _isWallCallback(x, y) {\n        if (x < 0 || y < 0 || x >= this._width || y >= this._height) {\n            return false;\n        }\n        return (this._map[x][y] == 1);\n    }\n    _canBeDugCallback(x, y) {\n        if (x < 1 || y < 1 || x + 1 >= this._width || y + 1 >= this._height) {\n            return false;\n        }\n        return (this._map[x][y] == 1);\n    }\n    _priorityWallCallback(x, y) { this._walls[x + \",\" + y] = 2; }\n    ;\n    _firstRoom() {\n        let cx = Math.floor(this._width / 2);\n        let cy = Math.floor(this._height / 2);\n        let room = Room.createRandomCenter(cx, cy, this._options);\n        this._rooms.push(room);\n        room.create(this._digCallback);\n    }\n    /**\n     * Get a suitable wall\n     */\n    _findWall() {\n        let prio1 = [];\n        let prio2 = [];\n        for (let id in this._walls) {\n            let prio = this._walls[id];\n            if (prio == 2) {\n                prio2.push(id);\n            }\n            else {\n                prio1.push(id);\n            }\n        }\n        let arr = (prio2.length ? prio2 : prio1);\n        if (!arr.length) {\n            return null;\n        } /* no walls :/ */\n        let id = RNG.getItem(arr.sort()); // sort to make the order deterministic\n        delete this._walls[id];\n        return id;\n    }\n    /**\n     * Tries adding a feature\n     * @returns {bool} was this a successful try?\n     */\n    _tryFeature(x, y, dx, dy) {\n        let featureName = RNG.getWeightedValue(this._features);\n        let ctor = FEATURES[featureName];\n        let feature = ctor.createRandomAt(x, y, dx, dy, this._options);\n        if (!feature.isValid(this._isWallCallback, this._canBeDugCallback)) {\n            //\t\tconsole.log(\"not valid\");\n            //\t\tfeature.debug();\n            return false;\n        }\n        feature.create(this._digCallback);\n        //\tfeature.debug();\n        if (feature instanceof Room) {\n            this._rooms.push(feature);\n        }\n        if (feature instanceof Corridor) {\n            feature.createPriorityWalls(this._priorityWallCallback);\n            this._corridors.push(feature);\n        }\n        return true;\n    }\n    _removeSurroundingWalls(cx, cy) {\n        let deltas = DIRS[4];\n        for (let i = 0; i < deltas.length; i++) {\n            let delta = deltas[i];\n            let x = cx + delta[0];\n            let y = cy + delta[1];\n            delete this._walls[x + \",\" + y];\n            x = cx + 2 * delta[0];\n            y = cy + 2 * delta[1];\n            delete this._walls[x + \",\" + y];\n        }\n    }\n    /**\n     * Returns vector in \"digging\" direction, or false, if this does not exist (or is not unique)\n     */\n    _getDiggingDirection(cx, cy) {\n        if (cx <= 0 || cy <= 0 || cx >= this._width - 1 || cy >= this._height - 1) {\n            return null;\n        }\n        let result = null;\n        let deltas = DIRS[4];\n        for (let i = 0; i < deltas.length; i++) {\n            let delta = deltas[i];\n            let x = cx + delta[0];\n            let y = cy + delta[1];\n            if (!this._map[x][y]) { /* there already is another empty neighbor! */\n                if (result) {\n                    return null;\n                }\n                result = delta;\n            }\n        }\n        /* no empty neighbor */\n        if (!result) {\n            return null;\n        }\n        return [-result[0], -result[1]];\n    }\n    /**\n     * Find empty spaces surrounding rooms, and apply doors.\n     */\n    _addDoors() {\n        let data = this._map;\n        function isWallCallback(x, y) {\n            return (data[x][y] == 1);\n        }\n        ;\n        for (let i = 0; i < this._rooms.length; i++) {\n            let room = this._rooms[i];\n            room.clearDoors();\n            room.addDoors(isWallCallback);\n        }\n    }\n}\n","import Map from \"./map.js\";\nimport RNG from \"../rng.js\";\n/**\n * Join lists with \"i\" and \"i+1\"\n */\nfunction addToList(i, L, R) {\n    R[L[i + 1]] = R[i];\n    L[R[i]] = L[i + 1];\n    R[i] = i + 1;\n    L[i + 1] = i;\n}\n/**\n * Remove \"i\" from its list\n */\nfunction removeFromList(i, L, R) {\n    R[L[i]] = R[i];\n    L[R[i]] = L[i];\n    R[i] = i;\n    L[i] = i;\n}\n/**\n * Maze generator - Eller's algorithm\n * See http://homepages.cwi.nl/~tromp/maze.html for explanation\n */\nexport default class EllerMaze extends Map {\n    create(callback) {\n        let map = this._fillMap(1);\n        let w = Math.ceil((this._width - 2) / 2);\n        let rand = 9 / 24;\n        let L = [];\n        let R = [];\n        for (let i = 0; i < w; i++) {\n            L.push(i);\n            R.push(i);\n        }\n        L.push(w - 1); /* fake stop-block at the right side */\n        let j;\n        for (j = 1; j + 3 < this._height; j += 2) {\n            /* one row */\n            for (let i = 0; i < w; i++) {\n                /* cell coords (will be always empty) */\n                let x = 2 * i + 1;\n                let y = j;\n                map[x][y] = 0;\n                /* right connection */\n                if (i != L[i + 1] && RNG.getUniform() > rand) {\n                    addToList(i, L, R);\n                    map[x + 1][y] = 0;\n                }\n                /* bottom connection */\n                if (i != L[i] && RNG.getUniform() > rand) {\n                    /* remove connection */\n                    removeFromList(i, L, R);\n                }\n                else {\n                    /* create connection */\n                    map[x][y + 1] = 0;\n                }\n            }\n        }\n        /* last row */\n        for (let i = 0; i < w; i++) {\n            /* cell coords (will be always empty) */\n            let x = 2 * i + 1;\n            let y = j;\n            map[x][y] = 0;\n            /* right connection */\n            if (i != L[i + 1] && (i == L[i] || RNG.getUniform() > rand)) {\n                /* dig right also if the cell is separated, so it gets connected to the rest of maze */\n                addToList(i, L, R);\n                map[x + 1][y] = 0;\n            }\n            removeFromList(i, L, R);\n        }\n        for (let i = 0; i < this._width; i++) {\n            for (let j = 0; j < this._height; j++) {\n                callback(i, j, map[i][j]);\n            }\n        }\n        return this;\n    }\n}\n","import Map from \"./map.js\";\nimport RNG from \"../rng.js\";\n/**\n * @class Recursively divided maze, http://en.wikipedia.org/wiki/Maze_generation_algorithm#Recursive_division_method\n * @augments ROT.Map\n */\nexport default class DividedMaze extends Map {\n    constructor() {\n        super(...arguments);\n        this._stack = [];\n        this._map = [];\n    }\n    create(callback) {\n        let w = this._width;\n        let h = this._height;\n        this._map = [];\n        for (let i = 0; i < w; i++) {\n            this._map.push([]);\n            for (let j = 0; j < h; j++) {\n                let border = (i == 0 || j == 0 || i + 1 == w || j + 1 == h);\n                this._map[i].push(border ? 1 : 0);\n            }\n        }\n        this._stack = [\n            [1, 1, w - 2, h - 2]\n        ];\n        this._process();\n        for (let i = 0; i < w; i++) {\n            for (let j = 0; j < h; j++) {\n                callback(i, j, this._map[i][j]);\n            }\n        }\n        this._map = [];\n        return this;\n    }\n    _process() {\n        while (this._stack.length) {\n            let room = this._stack.shift(); /* [left, top, right, bottom] */\n            this._partitionRoom(room);\n        }\n    }\n    _partitionRoom(room) {\n        let availX = [];\n        let availY = [];\n        for (let i = room[0] + 1; i < room[2]; i++) {\n            let top = this._map[i][room[1] - 1];\n            let bottom = this._map[i][room[3] + 1];\n            if (top && bottom && !(i % 2)) {\n                availX.push(i);\n            }\n        }\n        for (let j = room[1] + 1; j < room[3]; j++) {\n            let left = this._map[room[0] - 1][j];\n            let right = this._map[room[2] + 1][j];\n            if (left && right && !(j % 2)) {\n                availY.push(j);\n            }\n        }\n        if (!availX.length || !availY.length) {\n            return;\n        }\n        let x = RNG.getItem(availX);\n        let y = RNG.getItem(availY);\n        this._map[x][y] = 1;\n        let walls = [];\n        let w = [];\n        walls.push(w); /* left part */\n        for (let i = room[0]; i < x; i++) {\n            this._map[i][y] = 1;\n            if (i % 2)\n                w.push([i, y]);\n        }\n        w = [];\n        walls.push(w); /* right part */\n        for (let i = x + 1; i <= room[2]; i++) {\n            this._map[i][y] = 1;\n            if (i % 2)\n                w.push([i, y]);\n        }\n        w = [];\n        walls.push(w); /* top part */\n        for (let j = room[1]; j < y; j++) {\n            this._map[x][j] = 1;\n            if (j % 2)\n                w.push([x, j]);\n        }\n        w = [];\n        walls.push(w); /* bottom part */\n        for (let j = y + 1; j <= room[3]; j++) {\n            this._map[x][j] = 1;\n            if (j % 2)\n                w.push([x, j]);\n        }\n        let solid = RNG.getItem(walls);\n        for (let i = 0; i < walls.length; i++) {\n            let w = walls[i];\n            if (w == solid) {\n                continue;\n            }\n            let hole = RNG.getItem(w);\n            this._map[hole[0]][hole[1]] = 0;\n        }\n        this._stack.push([room[0], room[1], x - 1, y - 1]); /* left top */\n        this._stack.push([x + 1, room[1], room[2], y - 1]); /* right top */\n        this._stack.push([room[0], y + 1, x - 1, room[3]]); /* left bottom */\n        this._stack.push([x + 1, y + 1, room[2], room[3]]); /* right bottom */\n    }\n}\n","import Map from \"./map.js\";\nimport RNG from \"../rng.js\";\n/**\n * Icey's Maze generator\n * See http://www.roguebasin.roguelikedevelopment.org/index.php?title=Simple_maze for explanation\n */\nexport default class IceyMaze extends Map {\n    constructor(width, height, regularity = 0) {\n        super(width, height);\n        this._regularity = regularity;\n        this._map = [];\n    }\n    create(callback) {\n        let width = this._width;\n        let height = this._height;\n        let map = this._fillMap(1);\n        width -= (width % 2 ? 1 : 2);\n        height -= (height % 2 ? 1 : 2);\n        let cx = 0;\n        let cy = 0;\n        let nx = 0;\n        let ny = 0;\n        let done = 0;\n        let blocked = false;\n        let dirs = [\n            [0, 0],\n            [0, 0],\n            [0, 0],\n            [0, 0]\n        ];\n        do {\n            cx = 1 + 2 * Math.floor(RNG.getUniform() * (width - 1) / 2);\n            cy = 1 + 2 * Math.floor(RNG.getUniform() * (height - 1) / 2);\n            if (!done) {\n                map[cx][cy] = 0;\n            }\n            if (!map[cx][cy]) {\n                this._randomize(dirs);\n                do {\n                    if (Math.floor(RNG.getUniform() * (this._regularity + 1)) == 0) {\n                        this._randomize(dirs);\n                    }\n                    blocked = true;\n                    for (let i = 0; i < 4; i++) {\n                        nx = cx + dirs[i][0] * 2;\n                        ny = cy + dirs[i][1] * 2;\n                        if (this._isFree(map, nx, ny, width, height)) {\n                            map[nx][ny] = 0;\n                            map[cx + dirs[i][0]][cy + dirs[i][1]] = 0;\n                            cx = nx;\n                            cy = ny;\n                            blocked = false;\n                            done++;\n                            break;\n                        }\n                    }\n                } while (!blocked);\n            }\n        } while (done + 1 < width * height / 4);\n        for (let i = 0; i < this._width; i++) {\n            for (let j = 0; j < this._height; j++) {\n                callback(i, j, map[i][j]);\n            }\n        }\n        this._map = [];\n        return this;\n    }\n    _randomize(dirs) {\n        for (let i = 0; i < 4; i++) {\n            dirs[i][0] = 0;\n            dirs[i][1] = 0;\n        }\n        switch (Math.floor(RNG.getUniform() * 4)) {\n            case 0:\n                dirs[0][0] = -1;\n                dirs[1][0] = 1;\n                dirs[2][1] = -1;\n                dirs[3][1] = 1;\n                break;\n            case 1:\n                dirs[3][0] = -1;\n                dirs[2][0] = 1;\n                dirs[1][1] = -1;\n                dirs[0][1] = 1;\n                break;\n            case 2:\n                dirs[2][0] = -1;\n                dirs[3][0] = 1;\n                dirs[0][1] = -1;\n                dirs[1][1] = 1;\n                break;\n            case 3:\n                dirs[1][0] = -1;\n                dirs[0][0] = 1;\n                dirs[3][1] = -1;\n                dirs[2][1] = 1;\n                break;\n        }\n    }\n    _isFree(map, x, y, width, height) {\n        if (x < 1 || y < 1 || x >= width || y >= height) {\n            return false;\n        }\n        return map[x][y];\n    }\n}\n","import Map from \"./map.js\";\nimport RNG from \"../rng.js\";\nimport { DIRS } from \"../constants.js\";\n/**\n * Dungeon generator which uses the \"orginal\" Rogue dungeon generation algorithm. See http://kuoi.com/~kamikaze/GameDesign/art07_rogue_dungeon.php\n * @author hyakugei\n */\nexport default class Rogue extends Map {\n    constructor(width, height, options) {\n        super(width, height);\n        this.map = [];\n        this.rooms = [];\n        this.connectedCells = [];\n        options = Object.assign({\n            cellWidth: 3,\n            cellHeight: 3 //     ie. as an array with min-max values for each direction....\n        }, options);\n        /*\n        Set the room sizes according to the over-all width of the map,\n        and the cell sizes.\n        */\n        if (!options.hasOwnProperty(\"roomWidth\")) {\n            options[\"roomWidth\"] = this._calculateRoomSize(this._width, options[\"cellWidth\"]);\n        }\n        if (!options.hasOwnProperty(\"roomHeight\")) {\n            options[\"roomHeight\"] = this._calculateRoomSize(this._height, options[\"cellHeight\"]);\n        }\n        this._options = options;\n    }\n    create(callback) {\n        this.map = this._fillMap(1);\n        this.rooms = [];\n        this.connectedCells = [];\n        this._initRooms();\n        this._connectRooms();\n        this._connectUnconnectedRooms();\n        this._createRandomRoomConnections();\n        this._createRooms();\n        this._createCorridors();\n        if (callback) {\n            for (let i = 0; i < this._width; i++) {\n                for (let j = 0; j < this._height; j++) {\n                    callback(i, j, this.map[i][j]);\n                }\n            }\n        }\n        return this;\n    }\n    _calculateRoomSize(size, cell) {\n        let max = Math.floor((size / cell) * 0.8);\n        let min = Math.floor((size / cell) * 0.25);\n        if (min < 2) {\n            min = 2;\n        }\n        if (max < 2) {\n            max = 2;\n        }\n        return [min, max];\n    }\n    _initRooms() {\n        // create rooms array. This is the \"grid\" list from the algo.\n        for (let i = 0; i < this._options.cellWidth; i++) {\n            this.rooms.push([]);\n            for (let j = 0; j < this._options.cellHeight; j++) {\n                this.rooms[i].push({ \"x\": 0, \"y\": 0, \"width\": 0, \"height\": 0, \"connections\": [], \"cellx\": i, \"celly\": j });\n            }\n        }\n    }\n    _connectRooms() {\n        //pick random starting grid\n        let cgx = RNG.getUniformInt(0, this._options.cellWidth - 1);\n        let cgy = RNG.getUniformInt(0, this._options.cellHeight - 1);\n        let idx;\n        let ncgx;\n        let ncgy;\n        let found = false;\n        let room;\n        let otherRoom;\n        let dirToCheck;\n        // find  unconnected neighbour cells\n        do {\n            //dirToCheck = [0, 1, 2, 3, 4, 5, 6, 7];\n            dirToCheck = [0, 2, 4, 6];\n            dirToCheck = RNG.shuffle(dirToCheck);\n            do {\n                found = false;\n                idx = dirToCheck.pop();\n                ncgx = cgx + DIRS[8][idx][0];\n                ncgy = cgy + DIRS[8][idx][1];\n                if (ncgx < 0 || ncgx >= this._options.cellWidth) {\n                    continue;\n                }\n                if (ncgy < 0 || ncgy >= this._options.cellHeight) {\n                    continue;\n                }\n                room = this.rooms[cgx][cgy];\n                if (room[\"connections\"].length > 0) {\n                    // as long as this room doesn't already coonect to me, we are ok with it.\n                    if (room[\"connections\"][0][0] == ncgx && room[\"connections\"][0][1] == ncgy) {\n                        break;\n                    }\n                }\n                otherRoom = this.rooms[ncgx][ncgy];\n                if (otherRoom[\"connections\"].length == 0) {\n                    otherRoom[\"connections\"].push([cgx, cgy]);\n                    this.connectedCells.push([ncgx, ncgy]);\n                    cgx = ncgx;\n                    cgy = ncgy;\n                    found = true;\n                }\n            } while (dirToCheck.length > 0 && found == false);\n        } while (dirToCheck.length > 0);\n    }\n    _connectUnconnectedRooms() {\n        //While there are unconnected rooms, try to connect them to a random connected neighbor\n        //(if a room has no connected neighbors yet, just keep cycling, you'll fill out to it eventually).\n        let cw = this._options.cellWidth;\n        let ch = this._options.cellHeight;\n        this.connectedCells = RNG.shuffle(this.connectedCells);\n        let room;\n        let otherRoom;\n        let validRoom;\n        for (let i = 0; i < this._options.cellWidth; i++) {\n            for (let j = 0; j < this._options.cellHeight; j++) {\n                room = this.rooms[i][j];\n                if (room[\"connections\"].length == 0) {\n                    let directions = [0, 2, 4, 6];\n                    directions = RNG.shuffle(directions);\n                    validRoom = false;\n                    do {\n                        let dirIdx = directions.pop();\n                        let newI = i + DIRS[8][dirIdx][0];\n                        let newJ = j + DIRS[8][dirIdx][1];\n                        if (newI < 0 || newI >= cw || newJ < 0 || newJ >= ch) {\n                            continue;\n                        }\n                        otherRoom = this.rooms[newI][newJ];\n                        validRoom = true;\n                        if (otherRoom[\"connections\"].length == 0) {\n                            break;\n                        }\n                        for (let k = 0; k < otherRoom[\"connections\"].length; k++) {\n                            if (otherRoom[\"connections\"][k][0] == i && otherRoom[\"connections\"][k][1] == j) {\n                                validRoom = false;\n                                break;\n                            }\n                        }\n                        if (validRoom) {\n                            break;\n                        }\n                    } while (directions.length);\n                    if (validRoom) {\n                        room[\"connections\"].push([otherRoom[\"cellx\"], otherRoom[\"celly\"]]);\n                    }\n                    else {\n                        console.log(\"-- Unable to connect room.\");\n                    }\n                }\n            }\n        }\n    }\n    _createRandomRoomConnections() {\n        // Empty for now.\n    }\n    _createRooms() {\n        let w = this._width;\n        let h = this._height;\n        let cw = this._options.cellWidth;\n        let ch = this._options.cellHeight;\n        let cwp = Math.floor(this._width / cw);\n        let chp = Math.floor(this._height / ch);\n        let roomw;\n        let roomh;\n        let roomWidth = this._options[\"roomWidth\"];\n        let roomHeight = this._options[\"roomHeight\"];\n        let sx;\n        let sy;\n        let otherRoom;\n        for (let i = 0; i < cw; i++) {\n            for (let j = 0; j < ch; j++) {\n                sx = cwp * i;\n                sy = chp * j;\n                if (sx == 0) {\n                    sx = 1;\n                }\n                if (sy == 0) {\n                    sy = 1;\n                }\n                roomw = RNG.getUniformInt(roomWidth[0], roomWidth[1]);\n                roomh = RNG.getUniformInt(roomHeight[0], roomHeight[1]);\n                if (j > 0) {\n                    otherRoom = this.rooms[i][j - 1];\n                    while (sy - (otherRoom[\"y\"] + otherRoom[\"height\"]) < 3) {\n                        sy++;\n                    }\n                }\n                if (i > 0) {\n                    otherRoom = this.rooms[i - 1][j];\n                    while (sx - (otherRoom[\"x\"] + otherRoom[\"width\"]) < 3) {\n                        sx++;\n                    }\n                }\n                let sxOffset = Math.round(RNG.getUniformInt(0, cwp - roomw) / 2);\n                let syOffset = Math.round(RNG.getUniformInt(0, chp - roomh) / 2);\n                while (sx + sxOffset + roomw >= w) {\n                    if (sxOffset) {\n                        sxOffset--;\n                    }\n                    else {\n                        roomw--;\n                    }\n                }\n                while (sy + syOffset + roomh >= h) {\n                    if (syOffset) {\n                        syOffset--;\n                    }\n                    else {\n                        roomh--;\n                    }\n                }\n                sx = sx + sxOffset;\n                sy = sy + syOffset;\n                this.rooms[i][j][\"x\"] = sx;\n                this.rooms[i][j][\"y\"] = sy;\n                this.rooms[i][j][\"width\"] = roomw;\n                this.rooms[i][j][\"height\"] = roomh;\n                for (let ii = sx; ii < sx + roomw; ii++) {\n                    for (let jj = sy; jj < sy + roomh; jj++) {\n                        this.map[ii][jj] = 0;\n                    }\n                }\n            }\n        }\n    }\n    _getWallPosition(aRoom, aDirection) {\n        let rx;\n        let ry;\n        let door;\n        if (aDirection == 1 || aDirection == 3) {\n            rx = RNG.getUniformInt(aRoom[\"x\"] + 1, aRoom[\"x\"] + aRoom[\"width\"] - 2);\n            if (aDirection == 1) {\n                ry = aRoom[\"y\"] - 2;\n                door = ry + 1;\n            }\n            else {\n                ry = aRoom[\"y\"] + aRoom[\"height\"] + 1;\n                door = ry - 1;\n            }\n            this.map[rx][door] = 0; // i'm not setting a specific 'door' tile value right now, just empty space.\n        }\n        else {\n            ry = RNG.getUniformInt(aRoom[\"y\"] + 1, aRoom[\"y\"] + aRoom[\"height\"] - 2);\n            if (aDirection == 2) {\n                rx = aRoom[\"x\"] + aRoom[\"width\"] + 1;\n                door = rx - 1;\n            }\n            else {\n                rx = aRoom[\"x\"] - 2;\n                door = rx + 1;\n            }\n            this.map[door][ry] = 0; // i'm not setting a specific 'door' tile value right now, just empty space.\n        }\n        return [rx, ry];\n    }\n    _drawCorridor(startPosition, endPosition) {\n        let xOffset = endPosition[0] - startPosition[0];\n        let yOffset = endPosition[1] - startPosition[1];\n        let xpos = startPosition[0];\n        let ypos = startPosition[1];\n        let tempDist;\n        let xDir;\n        let yDir;\n        let move; // 2 element array, element 0 is the direction, element 1 is the total value to move.\n        let moves = []; // a list of 2 element arrays\n        let xAbs = Math.abs(xOffset);\n        let yAbs = Math.abs(yOffset);\n        let percent = RNG.getUniform(); // used to split the move at different places along the long axis\n        let firstHalf = percent;\n        let secondHalf = 1 - percent;\n        xDir = xOffset > 0 ? 2 : 6;\n        yDir = yOffset > 0 ? 4 : 0;\n        if (xAbs < yAbs) {\n            // move firstHalf of the y offset\n            tempDist = Math.ceil(yAbs * firstHalf);\n            moves.push([yDir, tempDist]);\n            // move all the x offset\n            moves.push([xDir, xAbs]);\n            // move sendHalf of the  y offset\n            tempDist = Math.floor(yAbs * secondHalf);\n            moves.push([yDir, tempDist]);\n        }\n        else {\n            //  move firstHalf of the x offset\n            tempDist = Math.ceil(xAbs * firstHalf);\n            moves.push([xDir, tempDist]);\n            // move all the y offset\n            moves.push([yDir, yAbs]);\n            // move secondHalf of the x offset.\n            tempDist = Math.floor(xAbs * secondHalf);\n            moves.push([xDir, tempDist]);\n        }\n        this.map[xpos][ypos] = 0;\n        while (moves.length > 0) {\n            move = moves.pop();\n            while (move[1] > 0) {\n                xpos += DIRS[8][move[0]][0];\n                ypos += DIRS[8][move[0]][1];\n                this.map[xpos][ypos] = 0;\n                move[1] = move[1] - 1;\n            }\n        }\n    }\n    _createCorridors() {\n        // Draw Corridors between connected rooms\n        let cw = this._options.cellWidth;\n        let ch = this._options.cellHeight;\n        let room;\n        let connection;\n        let otherRoom;\n        let wall;\n        let otherWall;\n        for (let i = 0; i < cw; i++) {\n            for (let j = 0; j < ch; j++) {\n                room = this.rooms[i][j];\n                for (let k = 0; k < room[\"connections\"].length; k++) {\n                    connection = room[\"connections\"][k];\n                    otherRoom = this.rooms[connection[0]][connection[1]];\n                    // figure out what wall our corridor will start one.\n                    // figure out what wall our corridor will end on.\n                    if (otherRoom[\"cellx\"] > room[\"cellx\"]) {\n                        wall = 2;\n                        otherWall = 4;\n                    }\n                    else if (otherRoom[\"cellx\"] < room[\"cellx\"]) {\n                        wall = 4;\n                        otherWall = 2;\n                    }\n                    else if (otherRoom[\"celly\"] > room[\"celly\"]) {\n                        wall = 3;\n                        otherWall = 1;\n                    }\n                    else {\n                        wall = 1;\n                        otherWall = 3;\n                    }\n                    this._drawCorridor(this._getWallPosition(room, wall), this._getWallPosition(otherRoom, otherWall));\n                }\n            }\n        }\n    }\n}\n","import Simplex from \"./simplex.js\";\nexport default { Simplex };\n","import Noise from \"./noise.js\";\nimport RNG from \"../rng.js\";\nimport { mod } from \"../util.js\";\nconst F2 = 0.5 * (Math.sqrt(3) - 1);\nconst G2 = (3 - Math.sqrt(3)) / 6;\n/**\n * A simple 2d implementation of simplex noise by Ondrej Zara\n *\n * Based on a speed-improved simplex noise algorithm for 2D, 3D and 4D in Java.\n * Which is based on example code by Stefan Gustavson (stegu@itn.liu.se).\n * With Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\n * Better rank ordering method by Stefan Gustavson in 2012.\n */\nexport default class Simplex extends Noise {\n    /**\n     * @param gradients Random gradients\n     */\n    constructor(gradients = 256) {\n        super();\n        this._gradients = [\n            [0, -1],\n            [1, -1],\n            [1, 0],\n            [1, 1],\n            [0, 1],\n            [-1, 1],\n            [-1, 0],\n            [-1, -1]\n        ];\n        let permutations = [];\n        for (let i = 0; i < gradients; i++) {\n            permutations.push(i);\n        }\n        permutations = RNG.shuffle(permutations);\n        this._perms = [];\n        this._indexes = [];\n        for (let i = 0; i < 2 * gradients; i++) {\n            this._perms.push(permutations[i % gradients]);\n            this._indexes.push(this._perms[i] % this._gradients.length);\n        }\n    }\n    get(xin, yin) {\n        let perms = this._perms;\n        let indexes = this._indexes;\n        let count = perms.length / 2;\n        let n0 = 0, n1 = 0, n2 = 0, gi; // Noise contributions from the three corners\n        // Skew the input space to determine which simplex cell we're in\n        let s = (xin + yin) * F2; // Hairy factor for 2D\n        let i = Math.floor(xin + s);\n        let j = Math.floor(yin + s);\n        let t = (i + j) * G2;\n        let X0 = i - t; // Unskew the cell origin back to (x,y) space\n        let Y0 = j - t;\n        let x0 = xin - X0; // The x,y distances from the cell origin\n        let y0 = yin - Y0;\n        // For the 2D case, the simplex shape is an equilateral triangle.\n        // Determine which simplex we are in.\n        let i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n        if (x0 > y0) {\n            i1 = 1;\n            j1 = 0;\n        }\n        else { // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n            i1 = 0;\n            j1 = 1;\n        } // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n        // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n        // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n        // c = (3-sqrt(3))/6\n        let x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n        let y1 = y0 - j1 + G2;\n        let x2 = x0 - 1 + 2 * G2; // Offsets for last corner in (x,y) unskewed coords\n        let y2 = y0 - 1 + 2 * G2;\n        // Work out the hashed gradient indices of the three simplex corners\n        let ii = mod(i, count);\n        let jj = mod(j, count);\n        // Calculate the contribution from the three corners\n        let t0 = 0.5 - x0 * x0 - y0 * y0;\n        if (t0 >= 0) {\n            t0 *= t0;\n            gi = indexes[ii + perms[jj]];\n            let grad = this._gradients[gi];\n            n0 = t0 * t0 * (grad[0] * x0 + grad[1] * y0);\n        }\n        let t1 = 0.5 - x1 * x1 - y1 * y1;\n        if (t1 >= 0) {\n            t1 *= t1;\n            gi = indexes[ii + i1 + perms[jj + j1]];\n            let grad = this._gradients[gi];\n            n1 = t1 * t1 * (grad[0] * x1 + grad[1] * y1);\n        }\n        let t2 = 0.5 - x2 * x2 - y2 * y2;\n        if (t2 >= 0) {\n            t2 *= t2;\n            gi = indexes[ii + 1 + perms[jj + 1]];\n            let grad = this._gradients[gi];\n            n2 = t2 * t2 * (grad[0] * x2 + grad[1] * y2);\n        }\n        // Add contributions from each corner to get the final noise value.\n        // The result is scaled to return values in the interval [-1,1].\n        return 70 * (n0 + n1 + n2);\n    }\n}\n","/**\n * Base noise generator\n */\nexport default class Noise {\n}\n","import Dijkstra from \"./dijkstra.js\";\nimport AStar from \"./astar.js\";\nexport default { Dijkstra, AStar };\n","import Path from \"./path.js\";\n/**\n * @class Simplified Dijkstra's algorithm: all edges have a value of 1\n * @augments ROT.Path\n * @see ROT.Path\n */\nexport default class Dijkstra extends Path {\n    constructor(toX, toY, passableCallback, options) {\n        super(toX, toY, passableCallback, options);\n        this._computed = {};\n        this._todo = [];\n        this._add(toX, toY, null);\n    }\n    /**\n     * Compute a path from a given point\n     * @see ROT.Path#compute\n     */\n    compute(fromX, fromY, callback) {\n        let key = fromX + \",\" + fromY;\n        if (!(key in this._computed)) {\n            this._compute(fromX, fromY);\n        }\n        if (!(key in this._computed)) {\n            return;\n        }\n        let item = this._computed[key];\n        while (item) {\n            callback(item.x, item.y);\n            item = item.prev;\n        }\n    }\n    /**\n     * Compute a non-cached value\n     */\n    _compute(fromX, fromY) {\n        while (this._todo.length) {\n            let item = this._todo.shift();\n            if (item.x == fromX && item.y == fromY) {\n                return;\n            }\n            let neighbors = this._getNeighbors(item.x, item.y);\n            for (let i = 0; i < neighbors.length; i++) {\n                let neighbor = neighbors[i];\n                let x = neighbor[0];\n                let y = neighbor[1];\n                let id = x + \",\" + y;\n                if (id in this._computed) {\n                    continue;\n                } /* already done */\n                this._add(x, y, item);\n            }\n        }\n    }\n    _add(x, y, prev) {\n        let obj = {\n            x: x,\n            y: y,\n            prev: prev\n        };\n        this._computed[x + \",\" + y] = obj;\n        this._todo.push(obj);\n    }\n}\n","import { DIRS } from \"../constants.js\";\n/**\n * @class Abstract pathfinder\n * @param {int} toX Target X coord\n * @param {int} toY Target Y coord\n * @param {function} passableCallback Callback to determine map passability\n * @param {object} [options]\n * @param {int} [options.topology=8]\n */\nexport default class Path {\n    constructor(toX, toY, passableCallback, options = {}) {\n        this._toX = toX;\n        this._toY = toY;\n        this._passableCallback = passableCallback;\n        this._options = Object.assign({\n            topology: 8\n        }, options);\n        this._dirs = DIRS[this._options.topology];\n        if (this._options.topology == 8) { /* reorder dirs for more aesthetic result (vertical/horizontal first) */\n            this._dirs = [\n                this._dirs[0],\n                this._dirs[2],\n                this._dirs[4],\n                this._dirs[6],\n                this._dirs[1],\n                this._dirs[3],\n                this._dirs[5],\n                this._dirs[7]\n            ];\n        }\n    }\n    _getNeighbors(cx, cy) {\n        let result = [];\n        for (let i = 0; i < this._dirs.length; i++) {\n            let dir = this._dirs[i];\n            let x = cx + dir[0];\n            let y = cy + dir[1];\n            if (!this._passableCallback(x, y)) {\n                continue;\n            }\n            result.push([x, y]);\n        }\n        return result;\n    }\n}\n","import Path from \"./path.js\";\n/**\n * @class Simplified A* algorithm: all edges have a value of 1\n * @augments ROT.Path\n * @see ROT.Path\n */\nexport default class AStar extends Path {\n    constructor(toX, toY, passableCallback, options = {}) {\n        super(toX, toY, passableCallback, options);\n        this._todo = [];\n        this._done = {};\n    }\n    /**\n     * Compute a path from a given point\n     * @see ROT.Path#compute\n     */\n    compute(fromX, fromY, callback) {\n        this._todo = [];\n        this._done = {};\n        this._fromX = fromX;\n        this._fromY = fromY;\n        this._add(this._toX, this._toY, null);\n        while (this._todo.length) {\n            let item = this._todo.shift();\n            let id = item.x + \",\" + item.y;\n            if (id in this._done) {\n                continue;\n            }\n            this._done[id] = item;\n            if (item.x == fromX && item.y == fromY) {\n                break;\n            }\n            let neighbors = this._getNeighbors(item.x, item.y);\n            for (let i = 0; i < neighbors.length; i++) {\n                let neighbor = neighbors[i];\n                let x = neighbor[0];\n                let y = neighbor[1];\n                let id = x + \",\" + y;\n                if (id in this._done) {\n                    continue;\n                }\n                this._add(x, y, item);\n            }\n        }\n        let item = this._done[fromX + \",\" + fromY];\n        if (!item) {\n            return;\n        }\n        while (item) {\n            callback(item.x, item.y);\n            item = item.prev;\n        }\n    }\n    _add(x, y, prev) {\n        let h = this._distance(x, y);\n        let obj = {\n            x: x,\n            y: y,\n            prev: prev,\n            g: (prev ? prev.g + 1 : 0),\n            h: h\n        };\n        /* insert into priority queue */\n        let f = obj.g + obj.h;\n        for (let i = 0; i < this._todo.length; i++) {\n            let item = this._todo[i];\n            let itemF = item.g + item.h;\n            if (f < itemF || (f == itemF && h < item.h)) {\n                this._todo.splice(i, 0, obj);\n                return;\n            }\n        }\n        this._todo.push(obj);\n    }\n    _distance(x, y) {\n        switch (this._options.topology) {\n            case 4:\n                return (Math.abs(x - this._fromX) + Math.abs(y - this._fromY));\n                break;\n            case 6:\n                let dx = Math.abs(x - this._fromX);\n                let dy = Math.abs(y - this._fromY);\n                return dy + Math.max(0, (dx - dy) / 2);\n                break;\n            case 8:\n                return Math.max(Math.abs(x - this._fromX), Math.abs(y - this._fromY));\n                break;\n        }\n    }\n}\n","/**\n * @class Asynchronous main loop\n * @param {ROT.Scheduler} scheduler\n */\nexport default class Engine {\n    constructor(scheduler) {\n        this._scheduler = scheduler;\n        this._lock = 1;\n    }\n    /**\n     * Start the main loop. When this call returns, the loop is locked.\n     */\n    start() { return this.unlock(); }\n    /**\n     * Interrupt the engine by an asynchronous action\n     */\n    lock() {\n        this._lock++;\n        return this;\n    }\n    /**\n     * Resume execution (paused by a previous lock)\n     */\n    unlock() {\n        if (!this._lock) {\n            throw new Error(\"Cannot unlock unlocked engine\");\n        }\n        this._lock--;\n        while (!this._lock) {\n            let actor = this._scheduler.next();\n            if (!actor) {\n                return this.lock();\n            } /* no actors */\n            let result = actor.act();\n            if (result && result.then) { /* actor returned a \"thenable\", looks like a Promise */\n                this.lock();\n                result.then(this.unlock.bind(this));\n            }\n        }\n        return this;\n    }\n}\n","import * as Color from \"./color.js\";\n;\n;\n;\n;\n/**\n * Lighting computation, based on a traditional FOV for multiple light sources and multiple passes.\n */\nexport default class Lighting {\n    constructor(reflectivityCallback, options = {}) {\n        this._reflectivityCallback = reflectivityCallback;\n        this._options = {};\n        options = Object.assign({\n            passes: 1,\n            emissionThreshold: 100,\n            range: 10\n        }, options);\n        this._lights = {};\n        this._reflectivityCache = {};\n        this._fovCache = {};\n        this.setOptions(options);\n    }\n    /**\n     * Adjust options at runtime\n     */\n    setOptions(options) {\n        Object.assign(this._options, options);\n        if (options && options.range) {\n            this.reset();\n        }\n        return this;\n    }\n    /**\n     * Set the used Field-Of-View algo\n     */\n    setFOV(fov) {\n        this._fov = fov;\n        this._fovCache = {};\n        return this;\n    }\n    /**\n     * Set (or remove) a light source\n     */\n    setLight(x, y, color) {\n        let key = x + \",\" + y;\n        if (color) {\n            this._lights[key] = (typeof (color) == \"string\" ? Color.fromString(color) : color);\n        }\n        else {\n            delete this._lights[key];\n        }\n        return this;\n    }\n    /**\n     * Remove all light sources\n     */\n    clearLights() { this._lights = {}; }\n    /**\n     * Reset the pre-computed topology values. Call whenever the underlying map changes its light-passability.\n     */\n    reset() {\n        this._reflectivityCache = {};\n        this._fovCache = {};\n        return this;\n    }\n    /**\n     * Compute the lighting\n     */\n    compute(lightingCallback) {\n        let doneCells = {};\n        let emittingCells = {};\n        let litCells = {};\n        for (let key in this._lights) { /* prepare emitters for first pass */\n            let light = this._lights[key];\n            emittingCells[key] = [0, 0, 0];\n            Color.add_(emittingCells[key], light);\n        }\n        for (let i = 0; i < this._options.passes; i++) { /* main loop */\n            this._emitLight(emittingCells, litCells, doneCells);\n            if (i + 1 == this._options.passes) {\n                continue;\n            } /* not for the last pass */\n            emittingCells = this._computeEmitters(litCells, doneCells);\n        }\n        for (let litKey in litCells) { /* let the user know what and how is lit */\n            let parts = litKey.split(\",\");\n            let x = parseInt(parts[0]);\n            let y = parseInt(parts[1]);\n            lightingCallback(x, y, litCells[litKey]);\n        }\n        return this;\n    }\n    /**\n     * Compute one iteration from all emitting cells\n     * @param emittingCells These emit light\n     * @param litCells Add projected light to these\n     * @param doneCells These already emitted, forbid them from further calculations\n     */\n    _emitLight(emittingCells, litCells, doneCells) {\n        for (let key in emittingCells) {\n            let parts = key.split(\",\");\n            let x = parseInt(parts[0]);\n            let y = parseInt(parts[1]);\n            this._emitLightFromCell(x, y, emittingCells[key], litCells);\n            doneCells[key] = 1;\n        }\n        return this;\n    }\n    /**\n     * Prepare a list of emitters for next pass\n     */\n    _computeEmitters(litCells, doneCells) {\n        let result = {};\n        for (let key in litCells) {\n            if (key in doneCells) {\n                continue;\n            } /* already emitted */\n            let color = litCells[key];\n            let reflectivity;\n            if (key in this._reflectivityCache) {\n                reflectivity = this._reflectivityCache[key];\n            }\n            else {\n                let parts = key.split(\",\");\n                let x = parseInt(parts[0]);\n                let y = parseInt(parts[1]);\n                reflectivity = this._reflectivityCallback(x, y);\n                this._reflectivityCache[key] = reflectivity;\n            }\n            if (reflectivity == 0) {\n                continue;\n            } /* will not reflect at all */\n            /* compute emission color */\n            let emission = [0, 0, 0];\n            let intensity = 0;\n            for (let i = 0; i < 3; i++) {\n                let part = Math.round(color[i] * reflectivity);\n                emission[i] = part;\n                intensity += part;\n            }\n            if (intensity > this._options.emissionThreshold) {\n                result[key] = emission;\n            }\n        }\n        return result;\n    }\n    /**\n     * Compute one iteration from one cell\n     */\n    _emitLightFromCell(x, y, color, litCells) {\n        let key = x + \",\" + y;\n        let fov;\n        if (key in this._fovCache) {\n            fov = this._fovCache[key];\n        }\n        else {\n            fov = this._updateFOV(x, y);\n        }\n        for (let fovKey in fov) {\n            let formFactor = fov[fovKey];\n            let result;\n            if (fovKey in litCells) { /* already lit */\n                result = litCells[fovKey];\n            }\n            else { /* newly lit */\n                result = [0, 0, 0];\n                litCells[fovKey] = result;\n            }\n            for (let i = 0; i < 3; i++) {\n                result[i] += Math.round(color[i] * formFactor);\n            } /* add light color */\n        }\n        return this;\n    }\n    /**\n     * Compute FOV (\"form factor\") for a potential light source at [x,y]\n     */\n    _updateFOV(x, y) {\n        let key1 = x + \",\" + y;\n        let cache = {};\n        this._fovCache[key1] = cache;\n        let range = this._options.range;\n        function cb(x, y, r, vis) {\n            let key2 = x + \",\" + y;\n            let formFactor = vis * (1 - r / range);\n            if (formFactor == 0) {\n                return;\n            }\n            cache[key2] = formFactor;\n        }\n        ;\n        this._fov.compute(x, y, range, cb.bind(this));\n        return cache;\n    }\n}\n","import { SCREEN_DEATH } from '../core/screens/ScreenType';\r\nimport { IsDead, IsDestroying, IsPlayer } from '../ecs/components';\r\nimport System from './System';\r\n\r\nexport default class DeathSystem extends System {\r\n    #query = null;\r\n\r\n    constructor(game) {\r\n        super(game);\r\n        this.#query = game.ecs.createQuery({\r\n            all: [IsDead],\r\n            none: [IsDestroying],\r\n        });\r\n    }\r\n\r\n    update(dt) {\r\n        this.#query.get().forEach((entity) => {\r\n            entity.fireEvent('death');\r\n\r\n            if (entity.isPlayer) {\r\n                this.game.screens.setScreen(SCREEN_DEATH);\r\n            } else {\r\n                entity.add(IsDestroying);\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { game } from '../core/Game';\r\nimport { Particle, ParticleEmitter } from '../ecs/components';\r\nimport System from './System';\r\n\r\nexport default class ParticleSystem extends System {\r\n    #particleQuery = null;\r\n    #emitterQuery = null;\r\n\r\n    constructor(game) {\r\n        super(game);\r\n        this.#emitterQuery = game.ecs.createQuery({\r\n            all: [ParticleEmitter],\r\n        });\r\n        this.#particleQuery = game.ecs.createQuery({\r\n            all: [Particle],\r\n        });\r\n    }\r\n\r\n    createParticle(x, y, properties = {}) {\r\n        const e = this.game.ecs.createEntity();\r\n\r\n        e.add(Particle, {\r\n            ...properties,\r\n            x,\r\n            y,\r\n        });\r\n    }\r\n\r\n    createEmitter(x, y, emitterData = {}, particleData = {}) {\r\n        const e = this.game.ecs.createEntity();\r\n\r\n        e.add(ParticleEmitter, {\r\n            x,\r\n            y,\r\n            ...emitterData,\r\n            particleData: {\r\n                direction: {\r\n                    x: 0,\r\n                    y: 0,\r\n                },\r\n                glyphs: ['', '', '', ''],\r\n                fg1s: ['cyan', 'blue'],\r\n                speed: 0.04,\r\n                lifetime: 600,\r\n                ...particleData,\r\n            },\r\n        });\r\n    }\r\n\r\n    update(dt) {\r\n        this.#emitterQuery.get().forEach((entity) => {\r\n            const emitter = entity.particleEmitter;\r\n\r\n            emitter.age += dt;\r\n\r\n            if (emitter.isExpired) {\r\n                entity.destroy();\r\n            } else {\r\n                const total = (emitter.rate / 1000) * emitter.duration;\r\n                const targetCount = Math.trunc(emitter.percent * total);\r\n\r\n                for (let i = emitter.count; i < targetCount; i++) {\r\n                    emitter.createParticle();\r\n                }\r\n            }\r\n        });\r\n\r\n        this.#particleQuery.get().forEach((entity) => {\r\n            const particle = entity.particle;\r\n\r\n            particle.age += dt;\r\n\r\n            if (particle.isExpired) {\r\n                entity.destroy();\r\n                return;\r\n            }\r\n\r\n            particle.x += particle.direction.x * particle.speed;\r\n            particle.y += particle.direction.y * particle.speed;\r\n\r\n            if (!this.game.camera.isInView(particle.x, particle.y)) {\r\n                return;\r\n            }\r\n\r\n            const screen = this.game.camera.worldToScreen(\r\n                particle.x,\r\n                particle.y\r\n            );\r\n\r\n            this.game.renderer.draw(\r\n                Math.round(screen.x),\r\n                Math.round(screen.y),\r\n                particle.glyph,\r\n                particle.fg1,\r\n                particle.fg2,\r\n                particle.bg\r\n            );\r\n        });\r\n    }\r\n}\r\n","import { FactionMember } from '../ecs/components';\r\nimport {\r\n    factions,\r\n    FACTION_BEAR,\r\n    FACTION_GOBLIN,\r\n    FACTION_PLAYER,\r\n    FACTION_SERPENT,\r\n    FACTION_VILLAGER,\r\n    getFactionByName,\r\n} from '../enums/Factions';\r\nimport Manager from './Manager';\r\n\r\nexport default class FactionManager extends Manager {\r\n    relations = {};\r\n\r\n    get factions() {\r\n        return Object.values(factions);\r\n    }\r\n\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        this.setRelation(FACTION_PLAYER, FACTION_GOBLIN, -400);\r\n        this.setRelation(FACTION_PLAYER, FACTION_VILLAGER, 300);\r\n        this.setRelation(FACTION_PLAYER, FACTION_SERPENT, -250);\r\n        this.setRelation(FACTION_PLAYER, FACTION_BEAR, -250);\r\n        this.setRelation(FACTION_SERPENT, FACTION_VILLAGER, -300);\r\n        this.setRelation(FACTION_SERPENT, FACTION_GOBLIN, 300);\r\n        this.setRelation(FACTION_SERPENT, FACTION_BEAR, 300);\r\n        this.setRelation(FACTION_GOBLIN, FACTION_VILLAGER, -400);\r\n        this.setRelation(FACTION_BEAR, FACTION_VILLAGER, -400);\r\n    }\r\n\r\n    getFactionById(id) {\r\n        return this.factions.find((f) => f.id === id);\r\n    }\r\n\r\n    getFactionByName(name) {\r\n        return getFactionByName(name);\r\n    }\r\n\r\n    isHostile(factionA, factionB) {\r\n        return factionA !== factionB;\r\n    }\r\n\r\n    _relationKey(idA, idB) {\r\n        return [idA, idB].sort().join('-');\r\n    }\r\n\r\n    setRelation(idA, idB, value) {\r\n        const key = this._relationKey(idA, idB);\r\n\r\n        this.relations[key] = value;\r\n    }\r\n\r\n    getRelation(idA, idB) {\r\n        const key = this._relationKey(idA, idB);\r\n\r\n        if (!this.relations.hasOwnProperty(key)) {\r\n            this.relations[key] = 0;\r\n        }\r\n\r\n        return this.relations[key];\r\n    }\r\n\r\n    getEntityRelation(entityA, entityB) {\r\n        const memberA = entityA.get(FactionMember);\r\n        const memberB = entityB.get(FactionMember);\r\n\r\n        if (memberA && memberB) {\r\n            const factionA = memberA.faction;\r\n            const factionB = memberB.faction;\r\n\r\n            return this.getRelation(factionA.id, factionB.id);\r\n        }\r\n\r\n        return 0;\r\n    }\r\n\r\n    areEntitiesHostile(entityA, entityB) {\r\n        const relation = this.getEntityRelation(entityA, entityB);\r\n\r\n        return relation < -200;\r\n    }\r\n\r\n    getDisplay(value) {\r\n        if (value <= -300) {\r\n            return 'Aggressive';\r\n        }\r\n\r\n        if (value <= -200) {\r\n            return 'Unfriendly';\r\n        }\r\n\r\n        if (value >= 300) {\r\n            return 'Loyal';\r\n        }\r\n\r\n        if (value >= 200) {\r\n            return 'Friendly';\r\n        }\r\n\r\n        if (value >= 100) {\r\n            return 'Amicable';\r\n        }\r\n\r\n        return 'Neutral';\r\n    }\r\n\r\n    getAttitudeGlyph(value) {\r\n        if (value <= -200) {\r\n            return {\r\n                char: '',\r\n                fg1: '#ca4444',\r\n                fg2: '#411010',\r\n            };\r\n        }\r\n\r\n        if (value >= 200) {\r\n            return {\r\n                char: '',\r\n                fg1: '#78b478',\r\n                fg2: '#1a251a',\r\n            };\r\n        }\r\n\r\n        return {\r\n            char: '',\r\n            fg1: '#b9bcc2',\r\n            fg2: '#222832',\r\n        };\r\n    }\r\n}\r\n","import Manager from './Manager';\r\n\r\nexport default class CameraManager extends Manager {\r\n    width = 32;\r\n    height = 24;\r\n    zoom = 2;\r\n    padding = 5;\r\n    clampX = 16;\r\n    clampY = 12;\r\n\r\n    _focusX = 0;\r\n    _focusY = 0;\r\n\r\n    constructor(game) {\r\n        super(game);\r\n        window.addEventListener('resize', this.onWindowResize.bind(this));\r\n        this.onWindowResize();\r\n    }\r\n\r\n    get renderedTileWidth() {\r\n        return this.zoom * this.game.renderer.tileWidth;\r\n    }\r\n\r\n    get renderedTileHeight() {\r\n        return this.zoom * this.game.renderer.tileHeight;\r\n    }\r\n\r\n    get left() {\r\n        return this.topLeftWorldX;\r\n    }\r\n\r\n    get right() {\r\n        return this.topLeftWorldX + this.width;\r\n    }\r\n\r\n    get top() {\r\n        return this.topLeftWorldY;\r\n    }\r\n\r\n    get bottom() {\r\n        return this.topLeftWorldY + this.height;\r\n    }\r\n\r\n    computeSize() {\r\n        this.width = Math.max(\r\n            this.clampX,\r\n            Math.floor(window.innerWidth / this.renderedTileWidth)\r\n        );\r\n        this.height = Math.max(\r\n            this.clampY,\r\n            Math.floor(window.innerHeight / this.renderedTileHeight)\r\n        );\r\n        this.topLeftWorldX = Math.floor(\r\n            Math.min(\r\n                Math.max(-this.padding, this._focusX - this.width / 2),\r\n                Math.max(\r\n                    (this.width - this.game.map.width) / -2,\r\n                    this.padding + this.game.map.width - this.width\r\n                )\r\n            )\r\n        );\r\n        this.topLeftWorldY = Math.floor(\r\n            Math.min(\r\n                Math.max(-this.padding, this._focusY - this.height / 2),\r\n                Math.max(\r\n                    (this.height - this.game.map.height) / -2,\r\n                    this.padding + this.game.map.height - this.height\r\n                )\r\n            )\r\n        );\r\n    }\r\n\r\n    onWindowResize() {\r\n        this.computeSize();\r\n        this.game.renderer.resizeDisplay(this.width, this.height, this.zoom);\r\n    }\r\n\r\n    setZoom(zoom) {\r\n        this.zoom = zoom;\r\n        this.computeSize();\r\n        this.onWindowResize();\r\n    }\r\n\r\n    setFocus(x, y) {\r\n        this._focusX = x;\r\n        this._focusY = y;\r\n        this.computeSize();\r\n    }\r\n\r\n    setPadding(value) {\r\n        this.padding = value;\r\n        this.computeSize();\r\n    }\r\n\r\n    worldToScreen(x, y) {\r\n        return {\r\n            x: x - this.topLeftWorldX,\r\n            y: y - this.topLeftWorldY,\r\n        };\r\n    }\r\n\r\n    screenToWorld(x, y) {\r\n        return {\r\n            x: x + this.topLeftWorldX,\r\n            y: y + this.topLeftWorldY,\r\n        };\r\n    }\r\n\r\n    getScreenRect() {\r\n        return {\r\n            x: this.topLeftWorldX,\r\n            y: this.topLeftWorldY,\r\n            width: this.width,\r\n            height: this.height,\r\n        };\r\n    }\r\n\r\n    isInView(worldX, worldY) {\r\n        const screen = this.worldToScreen(worldX, worldY);\r\n\r\n        return (\r\n            screen.x < this.width &&\r\n            screen.y < this.height &&\r\n            screen.x >= 0 &&\r\n            screen.y >= 0\r\n        );\r\n    }\r\n}\r\n","import System from './System';\r\n\r\nconst fpsElement = document.getElementsByClassName('fps')[0];\r\n\r\nexport default class FPSMonitoringSystem extends System {\r\n    frames = [];\r\n    frameCount = 60;\r\n\r\n    constructor(game) {\r\n        super(game);\r\n        this.frames = [];\r\n\r\n        for (let i = 0; i < this.frameCount; i++) {\r\n            this.frames[i] = 0;\r\n        }\r\n    }\r\n\r\n    update(dt) {\r\n        this.frames.push(1000 / dt);\r\n        this.frames.shift();\r\n\r\n        const sum = this.frames.reduce((s, v) => s + v, 0);\r\n        const fps = Math.trunc(sum / this.frameCount);\r\n\r\n        fpsElement.innerText = fps;\r\n    }\r\n}\r\n","import WorldData from '../data/WorldData';\r\nimport { IsPlayer } from '../ecs/components';\r\nimport Manager from './Manager';\r\nimport { SCREEN_LOAD_AREA } from './screens/ScreenType';\r\n\r\nexport class WorldManager extends Manager {\r\n    #data;\r\n    #areaId;\r\n    #entry;\r\n\r\n    get areaId() {\r\n        return this.#areaId;\r\n    }\r\n\r\n    get area() {\r\n        return this.#data.getArea(this.#areaId);\r\n    }\r\n\r\n    get entry() {\r\n        return this.#entry;\r\n    }\r\n\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        this.#data = new WorldData();\r\n    }\r\n\r\n    getSetupData() {\r\n        return {\r\n            areaId: this.#data.getStartingArea().id,\r\n            exploredAreaIds: [],\r\n        };\r\n    }\r\n\r\n    getSaveGameData() {\r\n        // TODO only save area data??\r\n        const data = Array.from(this.game.ecs.entities.all).filter(\r\n            (e) => !e.has(IsPlayer)\r\n        );\r\n        const serialized = this.game.ecs.serialize(data);\r\n\r\n        console.log('serialized map data', serialized);\r\n\r\n        this.game.state.saveAreaEntityData(this.area.id, serialized);\r\n\r\n        return {\r\n            areaId: this.area.id,\r\n            exploredAreaIds: [],\r\n        };\r\n    }\r\n\r\n    setup(data) {\r\n        // const area = this.#data.getArea(data.areaId);\r\n\r\n        // this.game.screens.setScreen(SCREEN_LOAD_AREA, {\r\n        //     nextArea: area,\r\n        //     entry: data.position,\r\n        // });\r\n    }\r\n\r\n    teardown() {\r\n        // TODO: destroy all area entities?\r\n        this.#areaId = null;\r\n    }\r\n\r\n    onAreaLoaded(area, entry) {\r\n        this.#areaId = area.id;\r\n\r\n        const data = this.game.state.loadAreaEntityData(area.id);\r\n\r\n        if (data) {\r\n            this.game.ecs.deserialize(data);\r\n        } else {\r\n            area.generate(this.game);\r\n        }\r\n    }\r\n\r\n    enterArea(area, entry) {\r\n        this.game.screens.setScreen(SCREEN_LOAD_AREA, {\r\n            prevousArea: this.area,\r\n            nextArea: area,\r\n            entry,\r\n        });\r\n    }\r\n}\r\n","import { Area } from './Area';\r\nimport data from './world.json';\r\n\r\nexport default class WorldData {\r\n    #areas = [];\r\n\r\n    get width() {\r\n        return data.width;\r\n    }\r\n\r\n    get height() {\r\n        return data.height;\r\n    }\r\n\r\n    idx(x, y) {\r\n        return y * this.width + x;\r\n    }\r\n\r\n    coord(idx) {\r\n        return {\r\n            x: Math.trunc(idx % this.width),\r\n            y: Math.trunc(idx / this.width),\r\n        };\r\n    }\r\n\r\n    constructor() {\r\n        this.#areas = [];\r\n\r\n        for (let x = 0; x < data.width; x++) {\r\n            for (let y = 0; y < data.height; y++) {\r\n                const area = Area.parseData(this, data.areas[y][x], x, y);\r\n\r\n                this.#areas[area.id] = area;\r\n            }\r\n        }\r\n    }\r\n\r\n    isOutOfBounds(x, y) {\r\n        return x < 0 || y < 0 || x >= this.width || y >= this.height;\r\n    }\r\n\r\n    getStartingArea() {\r\n        return this.getArea(15);\r\n    }\r\n\r\n    getAreaByCoord(x, y) {\r\n        return this.getArea(this.idx(x, y));\r\n    }\r\n\r\n    getArea(idx) {\r\n        const { x, y } = this.coord(idx);\r\n\r\n        if (this.isOutOfBounds(x, y)) {\r\n            return new Area(this, x, y);\r\n        }\r\n\r\n        return this.#areas[idx];\r\n    }\r\n}\r\n","import { game } from '../core/Game';\r\nimport { getGenerator } from '../level/generators/generators';\r\n\r\nexport class Area {\r\n    #x = 0;\r\n    #y = 0;\r\n    connectionsNorth = [];\r\n    connectionsWest = [];\r\n    generator = {};\r\n    music = null;\r\n\r\n    get x() {\r\n        return this.#x;\r\n    }\r\n\r\n    get y() {\r\n        return this.#y;\r\n    }\r\n\r\n    get id() {\r\n        return this.world.idx(this.x, this.y);\r\n    }\r\n\r\n    get northArea() {\r\n        return this.world.getAreaByCoord(this.#x, this.#y - 1);\r\n    }\r\n\r\n    get southArea() {\r\n        return this.world.getAreaByCoord(this.#x, this.#y + 1);\r\n    }\r\n\r\n    get eastArea() {\r\n        return this.world.getAreaByCoord(this.#x + 1, this.#y);\r\n    }\r\n\r\n    get westArea() {\r\n        return this.world.getAreaByCoord(this.#x - 1, this.#y);\r\n    }\r\n\r\n    constructor(world, x, y) {\r\n        this.world = world;\r\n        this.#x = x;\r\n        this.#y = y;\r\n    }\r\n\r\n    getExits() {\r\n        const exits = [];\r\n\r\n        // north\r\n        exits.push(\r\n            ...this.connectionsNorth.map((c) => ({\r\n                x: 12,\r\n                y: 0,\r\n            }))\r\n        );\r\n\r\n        // west\r\n        exits.push(\r\n            ...this.connectionsWest.map((c) => ({\r\n                x: 0,\r\n                y: 12,\r\n            }))\r\n        );\r\n\r\n        // east\r\n        exits.push(\r\n            ...this.eastArea.connectionsWest.map((c) => ({\r\n                x: game.map.width - 1,\r\n                y: 12,\r\n            }))\r\n        );\r\n\r\n        // south\r\n        exits.push(\r\n            ...this.southArea.connectionsNorth.map((c) => ({\r\n                x: 12,\r\n                y: game.map.height - 1,\r\n            }))\r\n        );\r\n\r\n        return exits;\r\n    }\r\n\r\n    generate(game) {\r\n        const exits = this.getExits();\r\n        const generator = getGenerator(this.generator.type);\r\n\r\n        const settings = {\r\n            width: game.map.width,\r\n            height: game.map.height,\r\n            exits,\r\n        };\r\n\r\n        const tiles = generator.generate(settings);\r\n\r\n        generator.populate(settings, tiles);\r\n\r\n        this.tiles = tiles;\r\n    }\r\n\r\n    static parseData(world, data, x, y) {\r\n        const area = new Area(world, x, y);\r\n\r\n        area.connectionsNorth = data.connectionsNorth;\r\n        area.connectionsWest = data.connectionsWest;\r\n        area.generator = data.generator;\r\n        area.music = data.music;\r\n        area.temperature = data.temperature;\r\n\r\n        return area;\r\n    }\r\n}\r\n","import { ForestCabinsGenerator } from './ForestCabinsGenerator';\r\nimport { ForestGenerator } from './ForestGenerator';\r\nimport { ForestStrongholdGenerator } from './ForestStrongholdGenerator';\r\nimport { ForestTownGenerator } from './ForestTownGenerator';\r\nimport { CanyonGenerator } from './CanyonGenerator';\r\nimport { DesertGenerator } from './DesertGenerator';\r\n\r\nconst mapping = {\r\n    FOREST: ForestGenerator,\r\n    FOREST_STRONGHOLD: ForestStrongholdGenerator,\r\n    FOREST_CABINS: ForestCabinsGenerator,\r\n    FOREST_TOWN: ForestTownGenerator,\r\n    CANYON: CanyonGenerator,\r\n    DESERT: DesertGenerator,\r\n};\r\n\r\nexport const getGenerator = (name) => {\r\n    return DesertGenerator;\r\n    // return mapping[name];\r\n};\r\n","import { pickRandom } from '../../utils/rand';\r\nimport { digExits } from '../LevelConnections';\r\nimport { UniformScheme } from '../schemes/UniformScheme';\r\nimport { TILE_THEME_CABIN, TILE_THEME_FOREST } from '../themes/TileTheme';\r\nimport AreaGenerator from './AreaGenerator';\r\n\r\nexport class ForestCabinsGenerator extends AreaGenerator {\r\n    static generate(settings) {\r\n        const tiles = UniformScheme.generate({\r\n            width: settings.width,\r\n            height: settings.height,\r\n        });\r\n\r\n        tiles.rooms.forEach((room) => (room.theme = TILE_THEME_FOREST));\r\n\r\n        const mediumRooms = tiles.rooms.filter(\r\n            (r) => r.width >= 3 && r.height >= 3\r\n        );\r\n        const room = pickRandom(mediumRooms);\r\n\r\n        if (room) {\r\n            room.theme = TILE_THEME_CABIN;\r\n            room.includeWalls = true;\r\n        }\r\n\r\n        const distancedRooms = mediumRooms.filter((r) => r !== room);\r\n        const room2 = pickRandom(distancedRooms);\r\n\r\n        if (room2) {\r\n            room2.theme = TILE_THEME_CABIN;\r\n            room2.includeWalls = true;\r\n        }\r\n\r\n        const leftovers = tiles.getUnassignedTiles();\r\n\r\n        leftovers.forEach((tile) => {\r\n            tile.theme = TILE_THEME_FOREST;\r\n        });\r\n\r\n        digExits(tiles, settings.exits);\r\n\r\n        return tiles;\r\n    }\r\n}\r\n","import { computeAStar } from '../utils/AStar';\r\nimport { manhattanDistance } from '../utils/ManhattanDistance';\r\nimport { TILE_TYPE_FLOOR, TILE_TYPE_WALL } from './TileData';\r\n\r\nconst getClosestTile = (tiles, target) => {\r\n    let closest = null;\r\n    let closestDistance = null;\r\n\r\n    tiles.data.forEach((tile) => {\r\n        if (!tile.isType(TILE_TYPE_FLOOR)) {\r\n            return;\r\n        }\r\n\r\n        const distance = manhattanDistance(tile, target);\r\n\r\n        if (distance < closestDistance || closest === null) {\r\n            closest = tile;\r\n            closestDistance = distance;\r\n            return;\r\n        }\r\n    });\r\n\r\n    return closest;\r\n};\r\n\r\nexport const digExit = (tiles, exit) => {\r\n    const source = getClosestTile(tiles, exit);\r\n\r\n    if (source.x === exit.x && source.y === exit.y) {\r\n        tiles.setTileType(exit.x, exit.y, TILE_TYPE_FLOOR);\r\n        return;\r\n    }\r\n\r\n    tiles.setTileType(source.x, source.y, TILE_TYPE_WALL);\r\n    tiles.setTileType(exit.x, exit.y, TILE_TYPE_WALL);\r\n\r\n    const result = computeAStar({\r\n        goal: {\r\n            x: source.x,\r\n            y: source.y,\r\n        },\r\n        start: {\r\n            x: exit.x,\r\n            y: exit.y,\r\n        },\r\n        allowDiagonals: false,\r\n        cost: (a, b) => {\r\n            if (tiles.isOnEdge(b.x, b.y)) {\r\n                return Infinity;\r\n            }\r\n\r\n            if (tiles.tileTypeMatches(b.x, b.y, TILE_TYPE_WALL)) {\r\n                return manhattanDistance(a, b);\r\n            }\r\n\r\n            return Infinity;\r\n        },\r\n    });\r\n\r\n    result.path.forEach((segment) => {\r\n        tiles.setTileType(segment.x, segment.y, TILE_TYPE_FLOOR);\r\n    });\r\n\r\n    if (result.success) {\r\n        const door = result.path[result.path.length - 2];\r\n        const room = tiles.getRoomForTile(door.x, door.y);\r\n\r\n        if (room) {\r\n            room.addExit(door.x, door.y);\r\n        }\r\n    }\r\n};\r\n\r\nexport const digExits = (tiles, exits) => {\r\n    exits.forEach((exit) => digExit(tiles, exit));\r\n};\r\n","import { TILE_THEME_CASTLE } from './themes/TileTheme';\n\nexport const TILE_TYPE_FLOOR = 0;\nexport const TILE_TYPE_WALL = 1;\nexport const TILE_TYPE_OUT_OF_BOUNDS = 1;\n\nexport class TileData {\n    x = -1;\n    y = -1;\n    type = TILE_TYPE_OUT_OF_BOUNDS;\n    theme = TILE_THEME_CASTLE;\n\n    constructor(x, y) {\n        this.x = x;\n        this.y = y;\n    }\n\n    isType(type) {\n        return this.type === type;\n    }\n}\n\nexport const createTileData = (x, y) => new TileData(x, y);\n","import CastleTheme from './CastleTheme';\r\nimport ForestTheme from './ForestTheme';\r\nimport CanyonTheme from './CanyonTheme';\r\nimport CabinTheme from './CabinTheme';\r\nimport DesertTheme from './DesertTheme';\r\n\r\nexport const TILE_THEME_FOREST = 0;\r\nexport const TILE_THEME_CASTLE = 1;\r\nexport const TILE_THEME_CABIN = 2;\r\nexport const TILE_THEME_CANYON = 3;\r\nexport const TILE_THEME_DESERT = 4;\r\n\r\nconst mapping = {\r\n    [TILE_THEME_FOREST]: ForestTheme,\r\n    [TILE_THEME_CASTLE]: CastleTheme,\r\n    [TILE_THEME_CABIN]: CabinTheme,\r\n    [TILE_THEME_CANYON]: CanyonTheme,\r\n    [TILE_THEME_DESERT]: DesertTheme,\r\n};\r\n\r\nexport const getThemePopulator = (theme) => {\r\n    return mapping[theme];\r\n};\r\n","import {\r\n    SPWN_GROUND_STONE,\r\n    SPWN_STONE,\r\n    SPWN_STONE_WALL,\r\n    SPWN_WOOD_DOOR,\r\n} from '../../data/Spawnables';\r\nimport { spawn } from '../../data/Spawner';\r\nimport { randomInt } from '../../utils/rand';\r\nimport { TILE_TYPE_WALL } from '../TileData';\r\nimport TileThemePopulator from './TileThemePopulator';\r\n\r\nexport default class CastleTheme extends TileThemePopulator {\r\n    static populateTile(tile) {\r\n        spawn(SPWN_GROUND_STONE, tile.x, tile.y);\r\n\r\n        if (this.getEntities(tile).length === 0) {\r\n            if (tile.isType(TILE_TYPE_WALL)) {\r\n                spawn(SPWN_STONE_WALL, tile.x, tile.y);\r\n            }\r\n        }\r\n    }\r\n\r\n    static populateRoom(room) {\r\n        room.exits.forEach((exit) => {\r\n            if (this.getEntities(exit).length === 0) {\r\n                spawn(SPWN_WOOD_DOOR, exit.x, exit.y);\r\n            }\r\n        });\r\n\r\n        room.tiles.forEach((tile) => this.populateTile(tile));\r\n\r\n        for (let i = 0; i < randomInt(0, 3); i++) {\r\n            this.trySpawn(room, (tile) => {\r\n                spawn(SPWN_STONE, tile.x, tile.y);\r\n            });\r\n        }\r\n    }\r\n}\r\n","import { game } from '../../core/Game';\r\nimport { pickRandom } from '../../utils/rand';\r\n\r\nexport default class TileThemePopulator {\r\n    static populateTile(tile) {}\r\n\r\n    static populateRoom(room) {\r\n        room.tiles.forEach((tile) => {\r\n            this.populateTile(tile);\r\n        });\r\n    }\r\n\r\n    static populate(tiles) {\r\n        tiles.data.forEach((tile) => {\r\n            this.populateTile(tile);\r\n        });\r\n    }\r\n\r\n    static getEntities(tile) {\r\n        return game.map.getEntitiesAt(tile.x, tile.y).filter((e) => !e.ground);\r\n    }\r\n\r\n    static clearTile(tile) {\r\n        getEntities(tile).forEach((e) => {\r\n            e.destroy();\r\n        });\r\n    }\r\n\r\n    static getRandomEmptyTile(tileArr, attempts = 100) {\r\n        for (let i = 0; i < attempts; i++) {\r\n            const tile = pickRandom(tileArr);\r\n\r\n            if (this.getEntities(tile) <= 0) {\r\n                return tile;\r\n            }\r\n        }\r\n\r\n        console.warn(\r\n            `ran out of attempts (${attempts}) to place item`,\r\n            tileArr\r\n        );\r\n    }\r\n\r\n    static trySpawn(room, cb) {\r\n        const tile = this.getRandomEmptyTile(room.interiorTiles);\r\n\r\n        if (tile) {\r\n            cb(tile);\r\n        }\r\n    }\r\n}\r\n","import {\r\n    SPWN_GOBLIN_GRUNT,\r\n    SPWN_PINE_TREE,\r\n    SPWN_STONE,\r\n    SPWN_BEAR,\r\n    SPWN_VIAL_BLOOD,\r\n    SPWN_VIAL_HONEY,\r\n    SPWN_VIAL_WATER,\r\n    SPWN_GROUND_GRASS,\r\n    SPWN_TWIG,\r\n    SPWN_GOBLIN_BRUISER,\r\n    SPWN_GOBLIN_STARGAZER,\r\n} from '../../data/Spawnables';\r\nimport { spawn } from '../../data/Spawner';\r\nimport { randomInt } from '../../utils/rand';\r\nimport { TILE_TYPE_FLOOR, TILE_TYPE_WALL } from '../TileData';\r\nimport TileThemePopulator from './TileThemePopulator';\r\n\r\nexport default class ForestTheme extends TileThemePopulator {\r\n    static populateTile(tile) {\r\n        spawn(SPWN_GROUND_GRASS, tile.x, tile.y);\r\n\r\n        if (tile.isType(TILE_TYPE_WALL)) {\r\n            spawn(SPWN_PINE_TREE, tile.x, tile.y);\r\n        }\r\n    }\r\n\r\n    static populateRoom(room) {\r\n        room.tiles.forEach((tile) => {\r\n            this.populateTile(tile);\r\n\r\n            if (Math.random() > 0.1) {\r\n                return;\r\n            }\r\n\r\n            if (tile.isType(TILE_TYPE_FLOOR) && Math.random() < 0.5) {\r\n                spawn(SPWN_TWIG, tile.x, tile.y);\r\n            } else {\r\n                spawn(SPWN_STONE, tile.x, tile.y);\r\n            }\r\n        });\r\n\r\n        for (let i = 0; i < randomInt(0, 1); i++) {\r\n            this.trySpawn(room, (tile) => {\r\n                spawn(SPWN_GOBLIN_GRUNT, tile.x, tile.y);\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < randomInt(0, 1); i++) {\r\n            this.trySpawn(room, (tile) => {\r\n                spawn(SPWN_GOBLIN_BRUISER, tile.x, tile.y);\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < randomInt(0, 1); i++) {\r\n            this.trySpawn(room, (tile) => {\r\n                spawn(SPWN_GOBLIN_STARGAZER, tile.x, tile.y);\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < randomInt(0, 1); i++) {\r\n            this.trySpawn(room, (tile) => {\r\n                spawn(SPWN_BEAR, tile.x, tile.y);\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < randomInt(0, 1); i++) {\r\n            if (Math.random() > 0.05) {\r\n                return;\r\n            }\r\n\r\n            this.trySpawn(room, (tile) => {\r\n                spawn(SPWN_VIAL_BLOOD, tile.x, tile.y);\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < randomInt(0, 1); i++) {\r\n            if (Math.random() > 0.05) {\r\n                return;\r\n            }\r\n\r\n            this.trySpawn(room, (tile) => {\r\n                spawn(SPWN_VIAL_WATER, tile.x, tile.y);\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < randomInt(0, 1); i++) {\r\n            if (Math.random() > 0.05) {\r\n                return;\r\n            }\r\n\r\n            this.trySpawn(room, (tile) => {\r\n                spawn(SPWN_VIAL_HONEY, tile.x, tile.y);\r\n            });\r\n        }\r\n    }\r\n}\r\n","import {\r\n    SPWN_GOBLIN_GRUNT,\r\n    SPWN_STONE,\r\n    SPWN_VIAL_BLOOD,\r\n    SPWN_CLIFF,\r\n    SPWN_GROUND_GRASS_DEAD,\r\n    SPWN_SNAKE\r\n} from '../../data/Spawnables';\r\nimport { spawn } from '../../data/Spawner';\r\nimport { randomInt } from '../../utils/rand';\r\nimport { TILE_TYPE_FLOOR, TILE_TYPE_WALL } from '../TileData';\r\nimport TileThemePopulator from './TileThemePopulator';\r\n\r\nexport default class CanyonTheme extends TileThemePopulator {\r\n    static populateTile(tile) {\r\n        spawn(SPWN_GROUND_GRASS_DEAD, tile.x, tile.y);\r\n\r\n        if (tile.isType(TILE_TYPE_WALL)) {\r\n            spawn(SPWN_CLIFF, tile.x, tile.y);\r\n        }\r\n    }\r\n\r\n    static populateRoom(room) {\r\n        room.tiles.forEach((tile) => {\r\n            this.populateTile(tile);\r\n\r\n            if (Math.random() > 0.05) {\r\n                return;\r\n            }\r\n\r\n            if (tile.isType(TILE_TYPE_FLOOR)) {\r\n                spawn(SPWN_STONE, tile.x, tile.y);\r\n            }\r\n        });\r\n\r\n        for (let i = 0; i < randomInt(0, 2); i++) {\r\n            this.trySpawn(room, (tile) => {\r\n                spawn(SPWN_SNAKE, tile.x, tile.y);\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < randomInt(0, 1); i++) {\r\n            this.trySpawn(room, (tile) => {\r\n                spawn(SPWN_GOBLIN_GRUNT, tile.x, tile.y);\r\n            });\r\n        }\r\n\r\n        for (let i = 0; i < randomInt(0, 1); i++) {\r\n            if (Math.random() > 0.05) {\r\n                return;\r\n            }\r\n\r\n            this.trySpawn(room, (tile) => {\r\n                spawn(SPWN_VIAL_BLOOD, tile.x, tile.y);\r\n            });\r\n        }\r\n    }\r\n}\r\n","import {\r\n    SPWN_HUMAN_WANDERER,\r\n    SPWN_WOOD_DOOR,\r\n    SPWN_WOOD_WALL,\r\n    SPWN_WOOD_CHEST,\r\n    SPWN_STONE,\r\n    SPWN_VIAL_HONEY,\r\n    SPWN_AMULET,\r\n    SPWN_CLOTH_ARMOR,\r\n    SPWN_LEATHER_BOOTS,\r\n    SPWN_SHORTSWORD,\r\n    SPWN_GREATSWORD,\r\n    SPWN_BATTLE_AXE,\r\n    SPWN_HATCHET,\r\n    SPWN_GROUND_STONE,\r\n    SPWN_MACE,\r\n    SPWN_HEAVY_PLATE_ARMOR,\r\n    SPWN_LEATHER_ARMOR,\r\n    SPWN_CLOTH_HOOD,\r\n    SPWN_WIZARD_CAP,\r\n    SPWN_HELM,\r\n    SPWN_TWIG,\r\n} from '../../data/Spawnables';\r\nimport { spawn } from '../../data/Spawner';\r\nimport { randomInt } from '../../utils/rand';\r\nimport { TILE_TYPE_WALL } from '../TileData';\r\nimport TileThemePopulator from './TileThemePopulator';\r\n\r\nexport default class CabinTheme extends TileThemePopulator {\r\n    static populateTile(tile) {\r\n        spawn(SPWN_GROUND_STONE, tile.x, tile.y);\r\n\r\n        if (this.getEntities(tile).length === 0) {\r\n            if (tile.isType(TILE_TYPE_WALL)) {\r\n                spawn(SPWN_WOOD_WALL, tile.x, tile.y);\r\n            }\r\n        }\r\n    }\r\n\r\n    static populateRoom(room) {\r\n        room.tiles.forEach((tile) => this.populateTile(tile));\r\n\r\n        room.exits.forEach((exit) => {\r\n            if (this.getEntities(exit).length === 0) {\r\n                spawn(SPWN_WOOD_DOOR, exit.x, exit.y);\r\n            }\r\n        });\r\n\r\n        this.trySpawn(room, (tile) => {\r\n            const chest = spawn(SPWN_WOOD_CHEST, tile.x, tile.y);\r\n\r\n            chest.inventory.addLoot(spawn(SPWN_TWIG));\r\n            chest.inventory.addLoot(spawn(SPWN_VIAL_HONEY));\r\n            chest.inventory.addLoot(spawn(SPWN_STONE));\r\n            chest.inventory.addLoot(spawn(SPWN_AMULET));\r\n            chest.inventory.addLoot(spawn(SPWN_CLOTH_ARMOR));\r\n            chest.inventory.addLoot(spawn(SPWN_LEATHER_BOOTS));\r\n            chest.inventory.addLoot(spawn(SPWN_SHORTSWORD));\r\n            chest.inventory.addLoot(spawn(SPWN_GREATSWORD));\r\n            chest.inventory.addLoot(spawn(SPWN_BATTLE_AXE));\r\n            chest.inventory.addLoot(spawn(SPWN_HATCHET));\r\n            chest.inventory.addLoot(spawn(SPWN_MACE));\r\n            chest.inventory.addLoot(spawn(SPWN_HEAVY_PLATE_ARMOR));\r\n            chest.inventory.addLoot(spawn(SPWN_LEATHER_ARMOR));\r\n            chest.inventory.addLoot(spawn(SPWN_CLOTH_HOOD));\r\n            chest.inventory.addLoot(spawn(SPWN_WIZARD_CAP));\r\n            chest.inventory.addLoot(spawn(SPWN_HELM));\r\n        });\r\n\r\n        for (let i = 0; i < randomInt(1, 3); i++) {\r\n            this.trySpawn(room, (tile) => {\r\n                spawn(SPWN_HUMAN_WANDERER, tile.x, tile.y);\r\n            });\r\n        }\r\n    }\r\n}\r\n","import {\r\n    SPWN_GOBLIN_GRUNT,\r\n    SPWN_PINE_TREE,\r\n    SPWN_STONE,\r\n    SPWN_BEAR,\r\n    SPWN_VIAL_BLOOD,\r\n    SPWN_VIAL_HONEY,\r\n    SPWN_VIAL_WATER,\r\n    SPWN_GROUND_GRASS,\r\n    SPWN_TWIG,\r\n    SPWN_GOBLIN_BRUISER,\r\n    SPWN_GOBLIN_STARGAZER,\r\n    SPWN_GROUND_SAND,\r\n    SPWN_CLIFF,\r\n    SPWN_SNAKE,\r\n    SPWN_DESERT_REED,\r\n} from '../../data/Spawnables';\r\nimport { spawn } from '../../data/Spawner';\r\nimport { randomInt, randomWeightedBool } from '../../utils/rand';\r\nimport { TILE_TYPE_FLOOR, TILE_TYPE_WALL } from '../TileData';\r\nimport TileThemePopulator from './TileThemePopulator';\r\n\r\nexport default class DesertTheme extends TileThemePopulator {\r\n    static populateTile(tile) {\r\n        spawn(SPWN_GROUND_SAND, tile.x, tile.y);\r\n\r\n        if (tile.isType(TILE_TYPE_WALL)) {\r\n            spawn(SPWN_CLIFF, tile.x, tile.y);\r\n        }\r\n    }\r\n\r\n    static populateRoom(room) {\r\n        room.tiles.forEach((tile) => {\r\n            this.populateTile(tile);\r\n\r\n            if (tile.isType(TILE_TYPE_FLOOR)) {\r\n                if (randomWeightedBool(.05)) {\r\n                    spawn(SPWN_DESERT_REED, tile.x, tile.y);\r\n                }\r\n\r\n                if (randomWeightedBool(.01)) {\r\n                    spawn(SPWN_SNAKE, tile.x, tile.y);\r\n                }\r\n            }\r\n        });\r\n\r\n        for (let i = 0; i < randomInt(0, 1); i++) {\r\n            if (Math.random() > 0.05) {\r\n                return;\r\n            }\r\n\r\n            this.trySpawn(room, (tile) => {\r\n                spawn(SPWN_VIAL_BLOOD, tile.x, tile.y);\r\n            });\r\n        }\r\n    }\r\n}\r\n","import { Map as MapGenerator } from 'rot-js';\r\nimport { digExits } from '../LevelConnections';\r\nimport TileContainer from '../TileContainer';\r\nimport { TILE_TYPE_FLOOR, TILE_TYPE_WALL } from '../TileData';\r\nimport TileScheme from '../TileScheme';\r\n\r\nexport class UniformScheme extends TileScheme {\r\n    static generate(settings) {\r\n        const width = settings.width;\r\n        const height = settings.height;\r\n        const exits = settings.exits || [];\r\n        const tiles = new TileContainer(width, height);\r\n\r\n        const generator = new MapGenerator.Uniform(width, height, {\r\n            timeLimit: 8000,\r\n            roomWidth: settings.roomWidth || [2, 8],\r\n            roomHeight: settings.roomHeight || [2, 8],\r\n            roomDugPercentage: settings.digPercentage || 0.8,\r\n        });\r\n\r\n        generator.create((x, y, v) => {\r\n            if (v === 0) {\r\n                tiles.setTileType(x, y, TILE_TYPE_FLOOR);\r\n            }\r\n\r\n            if (v === 1) {\r\n                tiles.setTileType(x, y, TILE_TYPE_WALL);\r\n            }\r\n        });\r\n\r\n        generator.getRooms().forEach((r) => {\r\n            const room = tiles.createRoom(\r\n                r.getLeft(),\r\n                r.getTop(),\r\n                r.getRight() - r.getLeft() + 1,\r\n                r.getBottom() - r.getTop() + 1\r\n            );\r\n            r.getDoors((x, y) => {\r\n                room.addExit(x, y);\r\n            });\r\n        });\r\n\r\n        digExits(tiles, exits);\r\n\r\n        return tiles;\r\n    }\r\n}\r\n","import Grid from '../utils/Grid';\r\nimport RoomData from './RoomData';\r\nimport { createTileData, TILE_TYPE_FLOOR } from './TileData';\r\n\r\nexport default class TileContainer {\r\n    #defaultType = TILE_TYPE_FLOOR;\r\n    #grid = [];\r\n    #rooms = {};\r\n\r\n    get width() {\r\n        return this.#grid.width;\r\n    }\r\n\r\n    get height() {\r\n        return this.#grid.height;\r\n    }\r\n\r\n    get size() {\r\n        return this.width * this.height;\r\n    }\r\n\r\n    get data() {\r\n        return this.#grid.data;\r\n    }\r\n\r\n    get rooms() {\r\n        return Object.values(this.#rooms);\r\n    }\r\n\r\n    constructor(width, height, defaultType = TILE_TYPE_FLOOR) {\r\n        this.#grid = new Grid(width, height, createTileData);\r\n        this.#defaultType = defaultType;\r\n        this.clear();\r\n    }\r\n\r\n    getTile(x, y) {\r\n        return this.#grid.get(x, y);\r\n    }\r\n\r\n    setTileType(x, y, type) {\r\n        this.#grid.get(x, y).type = type;\r\n    }\r\n\r\n    setTileTheme(x, y, theme) {\r\n        this.#grid.get(x, y).theme = theme;\r\n    }\r\n\r\n    getTileType(x, y) {\r\n        return this.getTile(x, y).type;\r\n    }\r\n\r\n    addRoom(room) {\r\n        this.#rooms[room.id] = room;\r\n    }\r\n\r\n    createRoom(x, y, width, height) {\r\n        const room = new RoomData(x, y, width, height, this);\r\n\r\n        this.addRoom(room);\r\n\r\n        return room;\r\n    }\r\n\r\n    clear() {\r\n        this.fill(0, 0, this.width, this.height, this.#defaultType);\r\n    }\r\n\r\n    fill(x, y, width, height, type) {\r\n        for (let i = x; i < x + width; i++) {\r\n            for (let j = y; j < y + height; j++) {\r\n                this.setTileType(i, j, type);\r\n            }\r\n        }\r\n    }\r\n\r\n    tileTypeMatches(x, y, type) {\r\n        return this.getTile(x, y).isType(type);\r\n    }\r\n\r\n    combineOther(offsetX, offsetY, tiles) {\r\n        tiles.rooms.forEach((room) => {\r\n            room.cloneTo(room.x + offsetX, room.y + offsetY, this);\r\n        });\r\n        tiles.data.forEach((tile) => {\r\n            this.setTileType(tile.x + offsetX, tile.y + offsetY, tile.type);\r\n            this.setTileTheme(tile.x + offsetX, tile.y + offsetY, tile.theme);\r\n        });\r\n    }\r\n\r\n    isOnEdge(x, y) {\r\n        return (\r\n            x === 0 || y === 0 || x === this.width - 1 || y === this.height - 1\r\n        );\r\n    }\r\n\r\n    setTheme(theme) {\r\n        this.data.forEach((tile) => this.setTileTheme(tile.x, tile.y, theme));\r\n        this.rooms.forEach((room) => (room.theme = theme));\r\n    }\r\n\r\n    getRoomForTile(x, y) {\r\n        const tile = this.getTile(x, y);\r\n\r\n        return this.rooms.find((room) => {\r\n            return room.tiles.includes(tile);\r\n        });\r\n    }\r\n\r\n    getUnassignedTiles() {\r\n        return this.data.filter((tile) => {\r\n            return !this.getRoomForTile(tile.x, tile.y);\r\n        });\r\n    }\r\n\r\n    getNeighbors(x, y) {\r\n        return this.#grid.getNeighbors(x, y);\r\n    }\r\n}\r\n","import { nanoid } from 'nanoid';\r\nimport { TILE_THEME_FOREST } from './themes/TileTheme';\r\nimport { TILE_TYPE_FLOOR } from './TileData';\r\n\r\nexport default class RoomData {\r\n    id = 0;\r\n    x = 0;\r\n    y = 0;\r\n    width = 0;\r\n    height = 0;\r\n    theme = TILE_THEME_FOREST;\r\n    includeWalls = false;\r\n    #container = null;\r\n    #exitCoords = [];\r\n\r\n    get relativeExits() {\r\n        return this.#exitCoords;\r\n    }\r\n\r\n    get exits() {\r\n        return this.relativeExits.map((exit) => ({\r\n            x: exit.x + this.x,\r\n            y: exit.y + this.y,\r\n        }));\r\n    }\r\n\r\n    get left() {\r\n        return this.includeWalls ? this.x - 1 : this.x;\r\n    }\r\n\r\n    get right() {\r\n        return this.includeWalls\r\n            ? this.x + this.width + 1\r\n            : this.x + this.width;\r\n    }\r\n\r\n    get top() {\r\n        return this.includeWalls ? this.y - 1 : this.y;\r\n    }\r\n\r\n    get bottom() {\r\n        return this.includeWalls\r\n            ? this.y + this.height + 1\r\n            : this.y + this.height;\r\n    }\r\n\r\n    get borderTiles() {\r\n        const start = this.includeWalls ? -1 : 0;\r\n        const endWidth = this.includeWalls ? this.width + 1 : this.width;\r\n        const endHeight = this.includeWalls ? this.height + 1 : this.height;\r\n        const borders = [];\r\n\r\n        // TODO this loop can be a lot simpler...\r\n        for (let i = start; i < endWidth; i++) {\r\n            for (let j = start; j < endHeight; j++) {\r\n                if (\r\n                    i === start ||\r\n                    i === endWidth - 1 ||\r\n                    j === start ||\r\n                    j === endHeight - 1\r\n                ) {\r\n                    borders.push(\r\n                        this.#container.getTile(i + this.x, j + this.y)\r\n                    );\r\n                }\r\n            }\r\n        }\r\n\r\n        return borders;\r\n    }\r\n\r\n    get interiorTiles() {\r\n        const interior = [];\r\n\r\n        for (let i = 0; i < this.width; i++) {\r\n            for (let j = 0; j < this.height; j++) {\r\n                interior.push(this.#container.getTile(i + this.x, j + this.y));\r\n            }\r\n        }\r\n\r\n        return interior;\r\n    }\r\n\r\n    get tiles() {\r\n        const start = this.includeWalls ? -1 : 0;\r\n        const endWidth = this.includeWalls ? this.width + 1 : this.width;\r\n        const endHeight = this.includeWalls ? this.height + 1 : this.height;\r\n        const tiles = [];\r\n\r\n        for (let i = start; i < endWidth; i++) {\r\n            for (let j = start; j < endHeight; j++) {\r\n                tiles.push(this.#container.getTile(i + this.x, j + this.y));\r\n            }\r\n        }\r\n\r\n        return tiles;\r\n    }\r\n\r\n    constructor(x, y, width, height, container) {\r\n        this.id = nanoid();\r\n        this.x = x;\r\n        this.y = y;\r\n        this.width = width;\r\n        this.height = height;\r\n        this.#container = container;\r\n    }\r\n\r\n    addRelativeExit(x, y) {\r\n        this.#container.setTileType(this.x + x, this.y + y, TILE_TYPE_FLOOR);\r\n        this.#exitCoords.push({ x, y });\r\n    }\r\n\r\n    addExit(x, y) {\r\n        this.addRelativeExit(x - this.x, y - this.y);\r\n    }\r\n\r\n    cloneTo(x, y, container) {\r\n        const room = new RoomData(x, y, this.width, this.height, container);\r\n\r\n        room.theme = this.theme;\r\n        room.includeWalls = this.includeWalls;\r\n\r\n        this.relativeExits.forEach((exit) => {\r\n            room.addRelativeExit(exit.x, exit.y);\r\n        });\r\n\r\n        container.addRoom(room);\r\n\r\n        return room;\r\n    }\r\n\r\n    containsPoint(x, y) {\r\n        return (\r\n            x <= this.right &&\r\n            x >= this.left &&\r\n            y <= this.bottom &&\r\n            y >= this.top\r\n        );\r\n    }\r\n\r\n    intersects(left, top, right, bottom) {\r\n        const c1 = left < this.right;\r\n        const c2 = right > this.left;\r\n        const c3 = top < this.bottom;\r\n        const c4 = bottom > this.top;\r\n\r\n        return c1 && c2 && c3 && c4;\r\n    }\r\n}\r\n","// This file replaces `index.js` in bundlers like webpack or Rollup,\n// according to `browser` config in `package.json`.\n\nimport { urlAlphabet } from './url-alphabet/index.js'\n\nif (false) {\n  // All bundlers will remove this block in the production bundle.\n  if (\n    typeof navigator !== 'undefined' &&\n    navigator.product === 'ReactNative' &&\n    typeof crypto === 'undefined'\n  ) {\n    throw new Error(\n      'React Native does not have a built-in secure random generator. ' +\n        'If you dont need unpredictable IDs use `nanoid/non-secure`. ' +\n        'For secure IDs, import `react-native-get-random-values` ' +\n        'before Nano ID. If you use Expo, install `expo-random` ' +\n        'and use `nanoid/async`.'\n    )\n  }\n  if (typeof msCrypto !== 'undefined' && typeof crypto === 'undefined') {\n    throw new Error(\n      'Import file with `if (!window.crypto) window.crypto = window.msCrypto`' +\n        ' before importing Nano ID to fix IE 11 support'\n    )\n  }\n  if (typeof crypto === 'undefined') {\n    throw new Error(\n      'Your browser does not have secure random generator. ' +\n        'If you dont need unpredictable IDs, you can use nanoid/non-secure.'\n    )\n  }\n}\n\nlet random = bytes => crypto.getRandomValues(new Uint8Array(bytes))\n\nlet customRandom = (alphabet, size, getRandom) => {\n  // First, a bitmask is necessary to generate the ID. The bitmask makes bytes\n  // values closer to the alphabet size. The bitmask calculates the closest\n  // `2^31 - 1` number, which exceeds the alphabet size.\n  // For example, the bitmask for the alphabet size 30 is 31 (00011111).\n  // `Math.clz32` is not used, because it is not available in browsers.\n  let mask = (2 << (Math.log(alphabet.length - 1) / Math.LN2)) - 1\n  // Though, the bitmask solution is not perfect since the bytes exceeding\n  // the alphabet size are refused. Therefore, to reliably generate the ID,\n  // the random bytes redundancy has to be satisfied.\n\n  // Note: every hardware random generator call is performance expensive,\n  // because the system call for entropy collection takes a lot of time.\n  // So, to avoid additional system calls, extra bytes are requested in advance.\n\n  // Next, a step determines how many random bytes to generate.\n  // The number of random bytes gets decided upon the ID size, mask,\n  // alphabet size, and magic number 1.6 (using 1.6 peaks at performance\n  // according to benchmarks).\n\n  // `-~f => Math.ceil(f)` if f is a float\n  // `-~i => i + 1` if i is an integer\n  let step = -~((1.6 * mask * size) / alphabet.length)\n\n  return () => {\n    let id = ''\n    while (true) {\n      let bytes = getRandom(step)\n      // A compact alternative for `for (var i = 0; i < step; i++)`.\n      let j = step\n      while (j--) {\n        // Adding `|| ''` refuses a random byte that exceeds the alphabet size.\n        id += alphabet[bytes[j] & mask] || ''\n        // `id.length + 1 === size` is a more compact option.\n        if (id.length === +size) return id\n      }\n    }\n  }\n}\n\nlet customAlphabet = (alphabet, size) => customRandom(alphabet, size, random)\n\nlet nanoid = (size = 21) => {\n  let id = ''\n  let bytes = crypto.getRandomValues(new Uint8Array(size))\n\n  // A compact alternative for `for (var i = 0; i < step; i++)`.\n  while (size--) {\n    // It is incorrect to use bytes exceeding the alphabet size.\n    // The following mask reduces the random byte in the 0-255 value\n    // range to the 0-63 value range. Therefore, adding hacks, such\n    // as empty string fallback or magic numbers, is unneccessary because\n    // the bitmask trims bytes down to the alphabet size.\n    let byte = bytes[size] & 63\n    if (byte < 36) {\n      // `0-9a-z`\n      id += byte.toString(36)\n    } else if (byte < 62) {\n      // `A-Z`\n      id += (byte - 26).toString(36).toUpperCase()\n    } else if (byte < 63) {\n      id += '_'\n    } else {\n      id += '-'\n    }\n  }\n  return id\n}\n\nexport { nanoid, customAlphabet, customRandom, urlAlphabet, random }\n","// This alphabet uses `A-Za-z0-9_-` symbols. The genetic algorithm helped\n// optimize the gzip compression for this alphabet.\nlet urlAlphabet =\n  'ModuleSymbhasOwnPr-0123456789ABCDEFGHNRVfgctiUvz_KqYTJkLxpZXIjQW'\n\nexport { urlAlphabet }\n","export default class TileScheme {\n    static generate() {}\n\n    static populate() {}\n}\n","import { getThemePopulator } from '../themes/TileTheme';\r\nimport TileContainer from '../TileContainer';\r\n\r\nexport default class AreaGenerator {\r\n    static generate(settings) {\r\n        return new TileContainer(settings.width, settings.height);\r\n    }\r\n\r\n    static populate(settings, tiles) {\r\n        // tiles.rooms.forEach((room) => {\r\n        //     const theme = getThemePopulator(room.theme);\r\n\r\n        //     theme.populateRoom(room);\r\n        // });\r\n\r\n        // tiles.getUnassignedTiles().forEach((tile) => {\r\n        //     const theme = getThemePopulator(tile.theme);\r\n\r\n        //     theme.populateTile(tile);\r\n        // });\r\n    }\r\n}\r\n","import { digExits } from '../LevelConnections';\r\nimport { UniformScheme } from '../schemes/UniformScheme';\r\nimport { TILE_THEME_FOREST } from '../themes/TileTheme';\r\nimport AreaGenerator from './AreaGenerator';\r\n\r\nexport class ForestGenerator extends AreaGenerator {\r\n    static generate(settings) {\r\n        const tiles = UniformScheme.generate({\r\n            width: settings.width,\r\n            height: settings.height,\r\n            exits: settings.exits,\r\n        });\r\n\r\n        tiles.setTheme(TILE_THEME_FOREST);\r\n\r\n        digExits(tiles, settings.exits);\r\n\r\n        return tiles;\r\n    }\r\n}\r\n","import { digExits } from '../LevelConnections';\r\nimport { DenseCastleScheme } from '../schemes/DenseCastleScheme';\r\nimport { UniformScheme } from '../schemes/UniformScheme';\r\nimport { TILE_THEME_CASTLE, TILE_THEME_FOREST } from '../themes/TileTheme';\r\nimport TileContainer from '../TileContainer';\r\nimport AreaGenerator from './AreaGenerator';\r\n\r\nexport class ForestStrongholdGenerator extends AreaGenerator {\r\n    static generate(settings) {\r\n        const tiles = new TileContainer(settings.width, settings.height);\r\n        const padding = 5;\r\n        const exitOffset = Math.ceil(padding / 2) - 1;\r\n\r\n        const top = UniformScheme.generate({\r\n            width: settings.width - padding,\r\n            height: padding,\r\n            exits: [\r\n                { x: exitOffset, y: padding - 1 },\r\n                { x: settings.width - padding - 1, y: exitOffset - 1 },\r\n                { x: padding + 11, y: padding - 1 },\r\n            ],\r\n        });\r\n\r\n        const left = UniformScheme.generate({\r\n            width: padding,\r\n            height: settings.height - padding,\r\n            exits: [\r\n                { x: exitOffset, y: 0 },\r\n                {\r\n                    x: padding - 1,\r\n                    y: settings.height - padding - exitOffset - 1,\r\n                },\r\n            ],\r\n        });\r\n\r\n        const bottom = UniformScheme.generate({\r\n            width: settings.width - padding,\r\n            height: padding,\r\n            exits: [\r\n                { x: 0, y: exitOffset },\r\n                { x: settings.width - padding - exitOffset - 1, y: 0 },\r\n            ],\r\n        });\r\n\r\n        const right = UniformScheme.generate({\r\n            width: padding,\r\n            height: settings.height - padding,\r\n            exits: [\r\n                { x: 0, y: exitOffset - 1 },\r\n                { x: exitOffset, y: settings.height - padding - 1 },\r\n            ],\r\n        });\r\n\r\n        const castle = DenseCastleScheme.generate({\r\n            width: settings.width - padding * 2 + 2,\r\n            height: settings.height - padding * 2 + 2,\r\n            exits: [{ x: 12, y: 0 }],\r\n        });\r\n\r\n        top.setTheme(TILE_THEME_FOREST);\r\n        left.setTheme(TILE_THEME_FOREST);\r\n        bottom.setTheme(TILE_THEME_FOREST);\r\n        right.setTheme(TILE_THEME_FOREST);\r\n        castle.setTheme(TILE_THEME_CASTLE);\r\n\r\n        tiles.combineOther(0, 0, top);\r\n        tiles.combineOther(0, padding, left);\r\n        tiles.combineOther(padding, settings.height - padding, bottom);\r\n        tiles.combineOther(settings.width - padding, 0, right);\r\n        tiles.combineOther(padding - 1, padding - 1, castle);\r\n\r\n        digExits(tiles, settings.exits);\r\n\r\n        return tiles;\r\n    }\r\n}\r\n","import { digExits } from '../LevelConnections';\r\nimport TileContainer from '../TileContainer';\r\nimport { TILE_TYPE_FLOOR, TILE_TYPE_WALL } from '../TileData';\r\nimport { pickRandom, randomInt } from '../../utils/rand';\r\nimport { computeAStar } from '../../utils/AStar';\r\nimport { diagonalDistance } from '../../utils/diagonalDistance';\r\nimport TileScheme from '../TileScheme';\r\n\r\nconst VERTICAL = 0;\r\nconst HORIZONTAL = 1;\r\n\r\nlet curId = 1;\r\nconst createNodeId = () => curId++;\r\n\r\nconst splitNodeVertical = (node, cut) => {\r\n    const leftId = createNodeId();\r\n    const rightId = createNodeId();\r\n    const left = {\r\n        id: leftId,\r\n        isLeaf: true,\r\n        parentId: node.id,\r\n        siblingId: rightId,\r\n        offsetX: node.offsetX,\r\n        offsetY: node.offsetY,\r\n        width: cut,\r\n        height: node.height,\r\n    };\r\n    const right = {\r\n        id: rightId,\r\n        isLeaf: true,\r\n        parentId: node.id,\r\n        siblingId: leftId,\r\n        offsetX: node.offsetX + cut,\r\n        offsetY: node.offsetY,\r\n        width: node.width - cut,\r\n        height: node.height,\r\n    };\r\n    return [left, right];\r\n};\r\n\r\nconst splitNodeHorizontal = (node, cut) => {\r\n    const topId = createNodeId();\r\n    const bottomId = createNodeId();\r\n    const top = {\r\n        id: topId,\r\n        isLeaf: true,\r\n        parentId: node.id,\r\n        siblingId: bottomId,\r\n        offsetX: node.offsetX,\r\n        offsetY: node.offsetY,\r\n        width: node.width,\r\n        height: cut,\r\n    };\r\n    const bottom = {\r\n        id: bottomId,\r\n        isLeaf: true,\r\n        parentId: node.id,\r\n        siblingId: topId,\r\n        offsetX: node.offsetX,\r\n        offsetY: node.offsetY + cut,\r\n        width: node.width,\r\n        height: node.height - cut,\r\n    };\r\n\r\n    return [top, bottom];\r\n};\r\n\r\nexport class DenseCastleScheme extends TileScheme {\r\n    static generate(settings) {\r\n        const width = settings.width;\r\n        const height = settings.height;\r\n        const exits = settings.exits || [];\r\n\r\n        const minRoomWidth = settings.minRoomWidth || 4;\r\n        const minRoomHeight = settings.minRoomHeight || 4;\r\n\r\n        const maxRoomWidth = settings.maxRoomWidth || 12;\r\n        const maxRoomHeight = settings.maxRoomHeight || 12;\r\n\r\n        const splitIgnoreChance = settings.splitIgnoreChance || 0.8;\r\n\r\n        const loopiness = settings.loopiness || 35;\r\n\r\n        const tiles = new TileContainer(width, height);\r\n\r\n        for (let i = 0; i < width; i++) {\r\n            for (let j = 0; j < height; j++) {\r\n                if (i === 0 || i === width - 1 || j === 0 || j === height - 1) {\r\n                    tiles.setTileType(i, j, TILE_TYPE_WALL);\r\n                } else {\r\n                    tiles.setTileType(i, j, TILE_TYPE_FLOOR);\r\n                }\r\n            }\r\n        }\r\n\r\n        const nodes = [\r\n            {\r\n                isLeaf: true,\r\n                parentId: null,\r\n                siblingId: null,\r\n                id: createNodeId(),\r\n                offsetX: 0,\r\n                offsetY: 0,\r\n                height: height - 1,\r\n                width: width - 1,\r\n            },\r\n        ];\r\n\r\n        const graph = [];\r\n\r\n        while (nodes.length > 0) {\r\n            const node = nodes.pop();\r\n            graph.push(node);\r\n\r\n            if (node.width < maxRoomWidth && node.height < maxRoomHeight) {\r\n                const ignoreSplit = Math.random() < splitIgnoreChance;\r\n\r\n                if (ignoreSplit) {\r\n                    continue;\r\n                }\r\n            }\r\n\r\n            const directions = [];\r\n\r\n            if (node.width - minRoomWidth - 1 > minRoomWidth) {\r\n                directions.push(VERTICAL);\r\n            }\r\n\r\n            if (node.height - minRoomHeight - 1 > minRoomHeight) {\r\n                directions.push(HORIZONTAL);\r\n            }\r\n\r\n            if (directions.length <= 0) {\r\n                continue;\r\n            }\r\n\r\n            const direction = pickRandom(directions);\r\n\r\n            if (direction === VERTICAL) {\r\n                const cut = randomInt(\r\n                    minRoomWidth + 1,\r\n                    node.width - minRoomWidth - 1\r\n                );\r\n\r\n                nodes.push(...splitNodeVertical(node, cut));\r\n            } else {\r\n                const cut = randomInt(\r\n                    minRoomHeight + 1,\r\n                    node.height - minRoomHeight - 1\r\n                );\r\n\r\n                nodes.push(...splitNodeHorizontal(node, cut));\r\n            }\r\n\r\n            node.isLeaf = false;\r\n        }\r\n\r\n        graph.forEach((node) => {\r\n            if (node.parentId === null) {\r\n                return;\r\n            }\r\n\r\n            if (node.isLeaf) {\r\n                const room = tiles.createRoom(\r\n                    node.offsetX + 1,\r\n                    node.offsetY + 1,\r\n                    node.width - 1,\r\n                    node.height - 1\r\n                );\r\n\r\n                room.includeWalls = true;\r\n\r\n                for (let i = 0; i < node.width; i++) {\r\n                    tiles.setTileType(\r\n                        node.offsetX + i,\r\n                        node.offsetY,\r\n                        TILE_TYPE_WALL\r\n                    );\r\n                }\r\n\r\n                for (let j = 0; j < node.height; j++) {\r\n                    tiles.setTileType(\r\n                        node.offsetX,\r\n                        node.offsetY + j,\r\n                        TILE_TYPE_WALL\r\n                    );\r\n                }\r\n                return;\r\n            }\r\n        });\r\n\r\n        graph.forEach((node) => {\r\n            if (node.parentId === null) {\r\n                return;\r\n            }\r\n\r\n            const sibling = graph.find((n) => n.id === node.siblingId);\r\n\r\n            let doorCandidates = [];\r\n            let hasSib = false;\r\n\r\n            if (sibling.offsetX < node.offsetX) {\r\n                hasSib = true;\r\n                for (let i = 1; i < node.height; i++) {\r\n                    const x = node.offsetX;\r\n                    const y = node.offsetY + i;\r\n                    const tile = tiles.getTile(x, y);\r\n\r\n                    if (\r\n                        tiles.tileTypeMatches(x - 1, y, TILE_TYPE_FLOOR) &&\r\n                        tiles.tileTypeMatches(x + 1, y, TILE_TYPE_FLOOR)\r\n                    ) {\r\n                        doorCandidates.push(tile);\r\n                    }\r\n                }\r\n            } else if (sibling.offsetY < node.offsetY) {\r\n                hasSib = true;\r\n                for (let i = 1; i < node.width; i++) {\r\n                    const x = node.offsetX + i;\r\n                    const y = node.offsetY;\r\n                    const tile = tiles.getTile(x, y);\r\n\r\n                    if (\r\n                        tiles.tileTypeMatches(x, y - 1, TILE_TYPE_FLOOR) &&\r\n                        tiles.tileTypeMatches(x, y + 1, TILE_TYPE_FLOOR)\r\n                    ) {\r\n                        doorCandidates.push(tile);\r\n                    }\r\n                }\r\n            }\r\n\r\n            const door = pickRandom(doorCandidates);\r\n\r\n            if (hasSib && !door) {\r\n                console.warn(\r\n                    'cannot make door!?',\r\n                    node,\r\n                    node.width,\r\n                    node.height\r\n                );\r\n            }\r\n\r\n            if (door) {\r\n                const room = tiles.getRoomForTile(door.x, door.y);\r\n\r\n                if (room) {\r\n                    room.addExit(door.x, door.y);\r\n                }\r\n\r\n                tiles.setTileType(door.x, door.y, TILE_TYPE_FLOOR);\r\n            }\r\n        });\r\n\r\n        const cost = (a, b) => {\r\n            if (tiles.tileTypeMatches(b.x, b.y, TILE_TYPE_FLOOR)) {\r\n                return diagonalDistance(a, b);\r\n            }\r\n\r\n            return Infinity;\r\n        };\r\n\r\n        const tryAddLoop = (a, b) => {\r\n            if (a.isType(TILE_TYPE_FLOOR) && b.isType(TILE_TYPE_FLOOR)) {\r\n                const start = {\r\n                    x: b.x,\r\n                    y: b.y,\r\n                };\r\n                const goal = {\r\n                    x: a.x,\r\n                    y: a.y,\r\n                };\r\n                const path = computeAStar({\r\n                    start,\r\n                    goal,\r\n                    cost,\r\n                });\r\n\r\n                if (path.success && path.cost >= loopiness) {\r\n                    return true;\r\n                }\r\n            }\r\n\r\n            return false;\r\n        };\r\n\r\n        tiles.data\r\n            .filter((tile) => tile.isType(TILE_TYPE_WALL))\r\n            .forEach((tile) => {\r\n                const north = tiles.getTile(tile.x, tile.y - 1);\r\n                const south = tiles.getTile(tile.x, tile.y + 1);\r\n\r\n                if (tryAddLoop(north, south)) {\r\n                    tiles.setTileType(tile.x, tile.y, TILE_TYPE_FLOOR);\r\n\r\n                    const room = tiles.getRoomForTile(tile.x, tile.y);\r\n\r\n                    if (room) {\r\n                        room.addExit(tile.x, tile.y);\r\n                    }\r\n\r\n                    return;\r\n                }\r\n\r\n                const east = tiles.getTile(tile.x - 1, tile.y);\r\n                const west = tiles.getTile(tile.x + 1, tile.y);\r\n\r\n                if (tryAddLoop(east, west)) {\r\n                    tiles.setTileType(tile.x, tile.y, TILE_TYPE_FLOOR);\r\n\r\n                    const room = tiles.getRoomForTile(tile.x, tile.y);\r\n\r\n                    if (room) {\r\n                        room.addExit(tile.x, tile.y);\r\n                    }\r\n\r\n                    return;\r\n                }\r\n            });\r\n\r\n        digExits(tiles, exits);\r\n\r\n        return tiles;\r\n    }\r\n}\r\n","import { game } from '../../core/Game';\r\nimport { SPWN_DIRT_PATH } from '../../data/Spawnables';\r\nimport { spawn } from '../../data/Spawner';\r\nimport { computeAStar } from '../../utils/AStar';\r\nimport { diagonalDistance } from '../../utils/diagonalDistance';\r\nimport { manhattanDistance } from '../../utils/ManhattanDistance';\r\nimport { pickRandom } from '../../utils/rand';\r\nimport { digExits } from '../LevelConnections';\r\nimport { ScatteredScheme } from '../schemes/ScatteredScheme';\r\nimport {\r\n    getThemePopulator,\r\n    TILE_THEME_CABIN,\r\n    TILE_THEME_FOREST,\r\n} from '../themes/TileTheme';\r\nimport { TILE_TYPE_WALL } from '../TileData';\r\nimport { addBorder } from './GeneratorUtils';\r\nimport AreaGenerator from './AreaGenerator';\r\n\r\nconst isTopLeftCorner = (t, room) => t.x === room.left && t.y === room.top;\r\nconst isBottomLeftCorner = (t, room) =>\r\n    t.x === room.left && t.y === room.bottom - 1;\r\nconst isBottomRightCorner = (t, room) =>\r\n    t.x === room.right - 1 && t.y === room.bottom - 1;\r\nconst isTopRightCorner = (t, room) =>\r\n    t.x === room.right - 1 && t.y === room.top;\r\n\r\nexport class ForestTownGenerator extends AreaGenerator {\r\n    static generate(settings) {\r\n        const tiles = ScatteredScheme.generate({\r\n            width: settings.width,\r\n            height: settings.height,\r\n            exits: settings.exits,\r\n            minCount: 4,\r\n        });\r\n\r\n        tiles.setTheme(TILE_THEME_CABIN);\r\n\r\n        const addDoor = (room) => {\r\n            const edges = room.borderTiles.filter(\r\n                (t) =>\r\n                    !(\r\n                        isTopLeftCorner(t, room) ||\r\n                        isBottomLeftCorner(t, room) ||\r\n                        isBottomRightCorner(t, room) ||\r\n                        isTopRightCorner(t, room)\r\n                    )\r\n            );\r\n\r\n            const door = pickRandom(edges);\r\n\r\n            if (door) {\r\n                room.addExit(door.x, door.y);\r\n            }\r\n        };\r\n\r\n        tiles.rooms.forEach(addDoor);\r\n\r\n        tiles.getUnassignedTiles().forEach((tile) => {\r\n            tile.theme = TILE_THEME_FOREST;\r\n        });\r\n\r\n        addBorder(tiles);\r\n\r\n        digExits(tiles, settings.exits);\r\n\r\n        return tiles;\r\n    }\r\n\r\n    static populate(settings, tiles) {\r\n        tiles.rooms.forEach((room) => {\r\n            const theme = getThemePopulator(room.theme);\r\n\r\n            theme.populateRoom(room);\r\n        });\r\n\r\n        const doors = tiles.rooms.map((room) => room.exits).flat();\r\n        const walkways = new Set();\r\n\r\n        const populatePath = (result) => {\r\n            if (!result.success) {\r\n                return;\r\n            }\r\n\r\n            result.path.forEach((segment) => {\r\n                const entities = game.map.getEntitiesAt(segment.x, segment.y);\r\n\r\n                if (entities.length > 0) {\r\n                    return;\r\n                }\r\n\r\n                spawn(SPWN_DIRT_PATH, segment.x, segment.y);\r\n\r\n                walkways.add(`${segment.x},${segment.y}`);\r\n            });\r\n        };\r\n\r\n        const generatePath = (start, end) => {\r\n            const path = computeAStar({\r\n                allowDiagonals: false,\r\n                start: {\r\n                    x: start.x,\r\n                    y: start.y,\r\n                },\r\n                goal: {\r\n                    x: end.x,\r\n                    y: end.y,\r\n                },\r\n                cost: (a, b) => {\r\n                    if (tiles.tileTypeMatches(b.x, b.y, TILE_TYPE_WALL)) {\r\n                        return Infinity;\r\n                    }\r\n\r\n                    const neighbors = tiles.getNeighbors(b.x, b.y);\r\n                    const walls = neighbors.filter((n) =>\r\n                        n.isType(TILE_TYPE_WALL)\r\n                    );\r\n\r\n                    if (walls.length > 0) {\r\n                        return walls.length * 2;\r\n                    }\r\n\r\n                    if (walkways.has(`${b.x},${b.y}`)) {\r\n                        return 0.1;\r\n                    }\r\n\r\n                    return manhattanDistance(a, b) * 2;\r\n                },\r\n            });\r\n\r\n            populatePath(path);\r\n        };\r\n\r\n        doors.forEach((doorA) => {\r\n            settings.exits.forEach((exit) => {\r\n                generatePath(doorA, exit);\r\n            });\r\n            doors.forEach((doorB) => {\r\n                if (doorA === doorB) {\r\n                    return;\r\n                }\r\n\r\n                generatePath(doorA, doorB);\r\n            });\r\n        });\r\n\r\n        tiles.getUnassignedTiles().forEach((tile) => {\r\n            const theme = getThemePopulator(tile.theme);\r\n\r\n            theme.populateTile(tile);\r\n        });\r\n    }\r\n}\r\n","import { randomInt } from '../../utils/rand';\r\nimport { digExits } from '../LevelConnections';\r\nimport TileContainer from '../TileContainer';\r\nimport { TILE_TYPE_FLOOR, TILE_TYPE_WALL } from '../TileData';\r\nimport TileScheme from '../TileScheme';\r\n\r\nexport class ScatteredScheme extends TileScheme {\r\n    static generate(settings) {\r\n        const attempt = settings.attempt || 1;\r\n        const maxAttempts = settings.maxAttempts || 100;\r\n        const width = settings.width;\r\n        const height = settings.height;\r\n        const padding = settings.padding || 3;\r\n        const roomPadding = settings.roomPadding || 3;\r\n        const minCount = settings.minCount || 5;\r\n        const maxCount = settings.maxCount || 8;\r\n        const minWidth = settings.minWidth || 5;\r\n        const maxWidth = settings.maxWidth || 9;\r\n        const minHeight = settings.minHeight || 5;\r\n        const maxHeight = settings.maxHeight || 9;\r\n        const exits = settings.exits || [];\r\n        const tiles = new TileContainer(width, height);\r\n\r\n        if (attempt > maxAttempts) {\r\n            console.warn(\r\n                `Failed to generate ScatteredScheme in ${maxAttempts} attempts`\r\n            );\r\n\r\n            return tiles;\r\n        }\r\n\r\n        const createBox = () => {\r\n            const width = randomInt(minWidth, maxWidth);\r\n            const height = randomInt(minHeight, maxHeight);\r\n\r\n            return {\r\n                x: randomInt(padding, settings.width - padding - width),\r\n                y: randomInt(padding, settings.height - padding - height),\r\n                width,\r\n                height,\r\n                get top() {\r\n                    return this.y - roomPadding;\r\n                },\r\n                get bottom() {\r\n                    return this.y + this.height + roomPadding;\r\n                },\r\n                get left() {\r\n                    return this.x - roomPadding;\r\n                },\r\n                get right() {\r\n                    return this.x + this.width + roomPadding;\r\n                },\r\n            };\r\n        };\r\n\r\n        const overlaps = (box) => {\r\n            return tiles.rooms.some((room) => {\r\n                return room.intersects(\r\n                    box.left,\r\n                    box.top,\r\n                    box.right,\r\n                    box.bottom\r\n                );\r\n            });\r\n        };\r\n\r\n        for (let i = 0; i < 100; i++) {\r\n            const box = createBox();\r\n\r\n            if (overlaps(box)) {\r\n                continue;\r\n            }\r\n\r\n            for (let i = 0; i < box.width; i++) {\r\n                for (let j = 0; j < box.height; j++) {\r\n                    const point = {\r\n                        x: box.x + i,\r\n                        y: box.y + j,\r\n                    };\r\n\r\n                    if (\r\n                        i === 0 ||\r\n                        i === box.width - 1 ||\r\n                        j === 0 ||\r\n                        j === box.height - 1\r\n                    ) {\r\n                        tiles.setTileType(point.x, point.y, TILE_TYPE_WALL);\r\n                    } else {\r\n                        tiles.setTileType(point.x, point.y, TILE_TYPE_FLOOR);\r\n                    }\r\n                }\r\n            }\r\n\r\n            tiles.createRoom(box.x, box.y, box.width, box.height);\r\n\r\n            if (tiles.rooms.length >= maxCount) {\r\n                break;\r\n            }\r\n        }\r\n\r\n        if (tiles.rooms.length < minCount) {\r\n            return this.generate({\r\n                ...settings,\r\n                attempt: attempt + 1,\r\n            });\r\n        }\r\n\r\n        digExits(tiles, exits);\r\n\r\n        return tiles;\r\n    }\r\n}\r\n","import { TILE_TYPE_WALL } from '../TileData';\n\nexport const addBorder = (tiles) => {\n    for (let i = 0; i < tiles.width; i++) {\n        tiles.setTileType(i, 0, TILE_TYPE_WALL);\n        tiles.setTileType(i, tiles.height - 1, TILE_TYPE_WALL);\n    }\n\n    for (let j = 1; j < tiles.height - 1; j++) {\n        tiles.setTileType(0, j, TILE_TYPE_WALL);\n        tiles.setTileType(tiles.width - 1, j, TILE_TYPE_WALL);\n    }\n};\n","import { digExits } from '../LevelConnections';\r\nimport { UniformScheme } from '../schemes/UniformScheme';\r\nimport { TILE_THEME_CANYON } from '../themes/TileTheme';\r\nimport AreaGenerator from './AreaGenerator';\r\n\r\nexport class CanyonGenerator extends AreaGenerator {\r\n    static generate(settings) {\r\n        const tiles = UniformScheme.generate({\r\n            width: settings.width,\r\n            height: settings.height,\r\n            exits: settings.exits,\r\n        });\r\n\r\n        tiles.setTheme(TILE_THEME_CANYON);\r\n\r\n        digExits(tiles, settings.exits);\r\n\r\n        return tiles;\r\n    }\r\n}\r\n","import { digExits } from '../LevelConnections';\r\nimport { SquareScheme } from '../schemes/SquareScheme';\r\nimport { TILE_THEME_DESERT } from '../themes/TileTheme';\r\nimport TileContainer from '../TileContainer';\r\nimport AreaGenerator from './AreaGenerator';\r\n\r\nexport class DesertGenerator extends AreaGenerator {\r\n    static generate(settings) {\r\n        // const tiles = SquareScheme.generate({\r\n        //     width: settings.width,\r\n        //     height: settings.height,\r\n        //     exits: settings.exits,\r\n        // });\r\n\r\n        const tiles = new TileContainer(settings.width, settings.height);\r\n\r\n        // tiles.setTheme(TILE_THEME_DESERT);\r\n\r\n        // digExits(tiles, settings.exits);\r\n\r\n        return tiles;\r\n    }\r\n}\r\n","import { addBorder } from '../generators/GeneratorUtils';\r\nimport { digExits } from '../LevelConnections';\r\nimport TileContainer from '../TileContainer';\r\nimport TileScheme from '../TileScheme';\r\n\r\nexport class SquareScheme extends TileScheme {\r\n    static generate(settings) {\r\n        const width = settings.width;\r\n        const height = settings.height;\r\n        const exits = settings.exits || [];\r\n\r\n        const tiles = new TileContainer(width, height);\r\n\r\n        addBorder(tiles);\r\n\r\n        const room = tiles.createRoom(0, 0, settings.width, settings.height);\r\n\r\n        room.includeWalls = true;\r\n\r\n        digExits(tiles, exits);\r\n\r\n        return tiles;\r\n    }\r\n}\r\n","import { getMessage, shouldAppear } from '../enums/ConsoleEvents';\r\nimport Manager from './Manager';\r\n\r\nexport default class ConsoleManager extends Manager {\r\n    messages = [];\r\n    events = [];\r\n    consoleHeight = 4;\r\n\r\n    teardown() {\r\n        this.messages = [];\r\n        this.events = [];\r\n    }\r\n\r\n    event(type, data) {\r\n        this.events.push({ type, data });\r\n    }\r\n\r\n    log(text) {\r\n        this.messages.push({ text });\r\n    }\r\n\r\n    render(dt) {\r\n        this.events.forEach(({ type, data }) => {\r\n            if (shouldAppear(type, data)) {\r\n                this.messages.push({\r\n                    text: getMessage(type, data),\r\n                });\r\n            }\r\n        });\r\n        this.events = [];\r\n\r\n        const msgs = this.messages.slice(\r\n            Math.max(this.messages.length - this.consoleHeight, 0)\r\n        );\r\n        const height = Math.min(msgs.length, this.consoleHeight);\r\n\r\n        msgs.forEach((message, i) => {\r\n            this.game.renderer.drawText(\r\n                0,\r\n                this.game.camera.height - (height - i),\r\n                message.text\r\n            );\r\n        });\r\n    }\r\n}\r\n","import { IsDestroying } from '../ecs/components';\r\nimport System from './System';\r\n\r\nexport default class DestroySystem extends System {\r\n    #query;\r\n\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        this.#query = game.ecs.createQuery({\r\n            all: [IsDestroying],\r\n        });\r\n    }\r\n\r\n    update(dt) {\r\n        this.#query.get().forEach((entity) => {\r\n            if (entity.isDestroying.pass > 0) {\r\n\r\n                if (entity.position) {\r\n                    const chunkId = entity.position.chunkId;\r\n\r\n                    this.game.chunks.removeEntity(entity.id, chunkId);\r\n                }\r\n\r\n                entity.destroy();\r\n            } else {\r\n                entity.isDestroying.pass++;\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { Howl } from 'howler';\r\nimport Manager from './Manager';\r\nimport music from './../data/music.json';\r\n\r\nclass Track {\r\n    isPlaying = false;\r\n    isIntro = false;\r\n    howl = null;\r\n\r\n    constructor(path, data) {\r\n        this.name = data.name;\r\n        this.loop = new Howl({\r\n            loop: true,\r\n            src: [`${path}${data.loop}`],\r\n        });\r\n\r\n        if (data.intro) {\r\n            this.intro = new Howl({\r\n                loop: false,\r\n                src: [`${path}${data.intro}`],\r\n            });\r\n\r\n            this.intro.on('end', () => {\r\n                if (this.isPlaying) {\r\n                    this.howl = this.loop;\r\n                    this.loop.seek(0);\r\n                    this.loop.volume(1);\r\n                    this.loop.play();\r\n                } else {\r\n                    this.intro.stop();\r\n                    this.loop.stop();\r\n                }\r\n            });\r\n        }\r\n    }\r\n\r\n    play() {\r\n        if (this.isPlaying) {\r\n            return;\r\n        }\r\n\r\n        if (this.intro) {\r\n            this.howl = this.intro;\r\n            this.intro.seek(0);\r\n            this.intro.play();\r\n            this.intro.fade(0, 1, 5000);\r\n            this.loop.stop();\r\n            // this.intro.volume(1);\r\n        } else {\r\n            this.howl = this.loop;\r\n            this.loop.seek(0);\r\n            this.loop.play();\r\n            this.loop.fade(0, 1, 5000);\r\n            // this.loop.volume(1);\r\n        }\r\n\r\n        this.isPlaying = true;\r\n    }\r\n\r\n    stop() {\r\n        if (this.howl) {\r\n            this.howl.fade(1, 0, 500);\r\n        }\r\n        this.isPlaying = false;\r\n    }\r\n}\r\n\r\nexport default class MusicManager extends Manager {\r\n    tracks = {};\r\n    currentTrack = null;\r\n\r\n    constructor(game) {\r\n        super(game);\r\n        const path = `${window.location.protocol}//${window.location.host}${window.location.pathname}${music.path}`;\r\n\r\n        music.tracks.forEach((data) => {\r\n            const track = new Track(path, data);\r\n\r\n            this.tracks[data.key] = track;\r\n        });\r\n    }\r\n\r\n    play(key) {\r\n        if (key === this.currentTrack) {\r\n            return;\r\n        }\r\n\r\n        if (this.currentTrack) {\r\n            this.tracks[this.currentTrack].stop();\r\n        }\r\n\r\n        this.tracks[key].play();\r\n        this.currentTrack = key;\r\n    }\r\n\r\n    stop() {\r\n        if (this.currentTrack) {\r\n            this.tracks[this.currentTrack].stop();\r\n        }\r\n    }\r\n\r\n    onAreaLoaded(area) {\r\n        this.play(area.music);\r\n    }\r\n}\r\n","import { getStatus } from '../data/Statuses';\r\nimport { Status } from '../ecs/components';\r\nimport System from './System';\r\n\r\nexport default class StatusSystem extends System {\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        this.query = this.game.ecs.createQuery({\r\n            all: [Status],\r\n        });\r\n    }\r\n\r\n    update(dt) {\r\n        if (!this.game.clock.tickDelta) {\r\n            return;\r\n        }\r\n\r\n        const delta = this.game.clock.tickDelta;\r\n\r\n        this.query.get().forEach((entity) => {\r\n            entity.status.forEach((status) => {\r\n                const statusType = getStatus(status.key);\r\n\r\n                statusType.update(delta, entity, status);\r\n\r\n                if (status.isCompleted()) {\r\n                    status.destroy();\r\n                }\r\n            });\r\n        });\r\n    }\r\n}\r\n","import {\r\n    IsDestroying,\r\n    IsInventoried,\r\n    LiquidContainer,\r\n    Position,\r\n} from '../ecs/components';\r\nimport System from './System';\r\n\r\nexport default class LiquidSystem extends System {\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        this.query = this.game.ecs.createQuery({\r\n            all: [LiquidContainer, Position],\r\n            none: [IsInventoried, IsDestroying],\r\n        });\r\n    }\r\n\r\n    update(dt) {\r\n        if (!this.game.clock.tickDelta) {\r\n            return;\r\n        }\r\n\r\n        const pools = Array.from(this.query.get());\r\n\r\n        pools.reduce((rv, pool) => {\r\n            const container = pool.liquidContainer;\r\n\r\n            if (!container.isFreeFlowing) {\r\n                return rv;\r\n            }\r\n\r\n            const pos = pool.position.getPos();\r\n            const liquid = container.content;\r\n            const key = `${pos.x},${pos.y},${liquid}`;\r\n\r\n            if (rv[key]) {\r\n                rv[key].combineFrom(container);\r\n            } else {\r\n                rv[key] = container;\r\n            }\r\n\r\n            return rv;\r\n        }, {});\r\n    }\r\n}\r\n","import { addStatus, STATUS_BLEEDING } from '../data/Statuses';\r\nimport {\r\n    IsDestroying,\r\n    IsInventoried,\r\n    Position,\r\n    SharpTrap,\r\n} from '../ecs/components';\r\nimport { CONSOLE_EVENT_TRAP_SHARP } from '../enums/ConsoleEvents';\r\nimport System from './System';\r\n\r\nexport default class TrapSystem extends System {\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        this.sharpTrapQuery = this.game.ecs.createQuery({\r\n            all: [SharpTrap, Position],\r\n            none: [IsInventoried, IsDestroying],\r\n        });\r\n    }\r\n\r\n    update(dt) {\r\n        if (!this.game.clock.turnDelta) {\r\n            return;\r\n        }\r\n\r\n        this.sharpTrapQuery.get().forEach((trapEntity) => {\r\n            const pos = trapEntity.position.getPos();\r\n            const entities = this.game.map.getEntitiesAt(pos.x, pos.y);\r\n\r\n            entities.forEach((entity) => {\r\n                if (entity.id === trapEntity.id) {\r\n                    return;\r\n                }\r\n                if (entity.stats) {\r\n                    const saved = trapEntity.sharpTrap.test(entity);\r\n\r\n                    if (!saved) {\r\n                        addStatus(STATUS_BLEEDING, entity);\r\n                        this.game.console.event(CONSOLE_EVENT_TRAP_SHARP, {\r\n                            trap: trapEntity,\r\n                            entity,\r\n                        });\r\n                    }\r\n                }\r\n            });\r\n        });\r\n    }\r\n}\r\n","import { spawn } from '../data/Spawner';\r\nimport {\r\n    Combustible,\r\n    Fire,\r\n    IsDestroying,\r\n    IsInventoried,\r\n    Position,\r\n} from '../ecs/components';\r\nimport { randomWeightedBool } from '../utils/rand';\r\nimport System from './System';\r\n\r\nexport default class FireSystem extends System {\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        this.query = this.game.ecs.createQuery({\r\n            all: [Fire, Combustible, Position],\r\n            none: [IsInventoried, IsDestroying],\r\n        });\r\n    }\r\n\r\n    update(dt) {\r\n        if (!this.game.clock.turnDelta) {\r\n            return;\r\n        }\r\n\r\n        this.query.get().forEach((entity) => {\r\n            const pos = entity.position.getPos();\r\n            const combustible = entity.combustible;\r\n            let temperature = this.game.temperature.getTemperature(\r\n                pos.x,\r\n                pos.y\r\n            );\r\n\r\n            combustible.fuel -= combustible.burnRate;\r\n            temperature += combustible.burnRate;\r\n\r\n            this.game.temperature.setTemperature(pos.x, pos.y, temperature);\r\n\r\n            const sparkChance = combustible.getSparkChance();\r\n            const dieChance = combustible.getDieOutChance();\r\n\r\n            this.game.map\r\n                .getNeighborEntities(pos.x, pos.y)\r\n                .flat()\r\n                .filter((e) => e.combustible)\r\n                .forEach((neighbor) => {\r\n                    const spark = randomWeightedBool(sparkChance);\r\n\r\n                    if (spark) {\r\n                        neighbor.fireEvent('spark', {\r\n                            intensity: entity.fire.intensity - 1,\r\n                        });\r\n                    }\r\n                });\r\n\r\n            if (combustible.isOutOfFuel) {\r\n                entity.add(IsDestroying);\r\n\r\n                if (combustible.spawnableRemains) {\r\n                    spawn(combustible.spawnableRemains, pos.x, pos.y);\r\n                }\r\n            } else if (randomWeightedBool(dieChance)) {\r\n                entity.fire.extinguish();\r\n\r\n                this.game.particles.createParticle(pos.x, pos.y, {\r\n                    lifetime: 1000,\r\n                    fg1s: ['yellow', 'red'],\r\n                    glyphs: ['.', '', '^'],\r\n                });\r\n            } else {\r\n                this.game.particles.createParticle(pos.x, pos.y, {\r\n                    lifetime: 1000,\r\n                    fg1s: ['yellow', 'red'],\r\n                    glyphs: ['.', '', '^'],\r\n                });\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { avgArray } from '../utils/ArrayUtil';\r\nimport { lerp } from '../utils/LerpUtil';\r\nimport MemoryGrid from '../utils/MemoryGrid';\r\nimport System from './System';\r\n\r\nexport default class TemperatureSystem extends System {\r\n    data;\r\n\r\n    get width() {\r\n        return this.game.map.width;\r\n    }\r\n\r\n    get height() {\r\n        return this.game.map.height;\r\n    }\r\n\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        this.grid = new MemoryGrid(this.width, this.height);\r\n    }\r\n\r\n    teardown() {\r\n        this.grid.clear();\r\n    }\r\n\r\n    getAmbientTemperature() {\r\n        return this.game.world.area.temperature.ambient;\r\n    }\r\n\r\n    getAmbientCapacity() {\r\n        return this.game.world.area.temperature.capacity;\r\n    }\r\n\r\n    getSaveGameData() {\r\n        const data = this.grid.serialize();\r\n\r\n        this.game.state.saveAreaTemperatureData(\r\n            this.game.world.areaId,\r\n            data\r\n        );\r\n    }\r\n\r\n    onAreaLoaded(area) {\r\n        const data = this.game.state.loadAreaTemperatureData(area.id);\r\n\r\n        if (data) {\r\n            this.grid.deserialize(data);\r\n        } else {\r\n            this.grid.defaultValueGenerator = () => area.temperature.ambient;\r\n            this.grid.previous.defaultValueGenerator = () =>\r\n                area.temperature.ambient;\r\n            this.grid.setAll(area.temperature.ambient);\r\n        }\r\n    }\r\n\r\n    setTemperature(x, y, value) {\r\n        this.grid.set(x, y, value);\r\n    }\r\n\r\n    getTemperature(x, y) {\r\n        return this.grid.get(x, y);\r\n    }\r\n\r\n    getCapacity(x, y) {\r\n        let hasCap = false;\r\n        let hasFire = false;\r\n\r\n        const capacity = this.game.map.getEntitiesAt(x, y).reduce((cap, e) => {\r\n            if (e.fire) {\r\n                hasFire = true;\r\n                return 0;\r\n            }\r\n            if (e.thermalCapacity) {\r\n                hasCap = true;\r\n\r\n                return cap + e.thermalCapacity.value;\r\n            }\r\n\r\n            return cap;\r\n        }, 0);\r\n\r\n        if (hasFire) {\r\n            return 0;\r\n        }\r\n\r\n        if (hasCap) {\r\n            return capacity;\r\n        }\r\n\r\n        return this.getAmbientCapacity();\r\n    }\r\n\r\n    update(dt) {\r\n        return;\r\n\r\n        if (!this.game.clock.tickDelta) {\r\n            return;\r\n        }\r\n\r\n        this.grid.copyToPrevious();\r\n\r\n        const ambient = this.getAmbientTemperature();\r\n\r\n        for (let x = 0; x < this.width; x++) {\r\n            for (let y = 0; y < this.height; y++) {\r\n                const previous = this.grid.previous.get(x, y);\r\n                const cells = this.grid.previous.getNeighbors(x, y);\r\n\r\n                cells.push(ambient);\r\n                cells.push(previous);\r\n\r\n                const avg = avgArray(cells);\r\n\r\n                if (Math.abs(previous - avg) < 0.01) {\r\n                    continue;\r\n                }\r\n\r\n                const capacity = this.getCapacity(x, y);\r\n                const t = lerp(previous, avg, capacity);\r\n\r\n                this.grid.set(x, y, t);\r\n            }\r\n        }\r\n    }\r\n}\r\n","export const sumArray = (arr = []) => arr.reduce((sum, val) => sum + val, 0);\r\nexport const avgArray = (arr = []) => sumArray(arr) / arr.length;\r\n","export const lerp = (f0, f1, t) => (1 - t) * f0 + t * f1;\r\nexport const lerp2 = (v1, v2, t) => {\r\n    return {\r\n        x: lerp(v1.x, v2.x, t),\r\n        y: lerp(v2.y, v2.x, t),\r\n    };\r\n};\r\n\r\nwindow.lerp = lerp;\r\n","import Grid from './Grid';\r\n\r\nexport default class MemoryGrid extends Grid {\r\n    get width() {\r\n        return this._width;\r\n    }\r\n\r\n    get height() {\r\n        return this._height;\r\n    }\r\n\r\n    constructor(width, height, defaultValueGenerator = () => null) {\r\n        super(width, height, defaultValueGenerator);\r\n        this.previous = new Grid(width, height, defaultValueGenerator);\r\n    }\r\n\r\n    copyToPrevious() {\r\n        this.previous._width = this._width;\r\n        this.previous._height = this._height;\r\n        this.previous.data = [...this.data];\r\n    }\r\n}\r\n","import { IsDestroying } from '../ecs/components';\r\nimport { AbilityStatus } from '../ecs/components/AbilityStatus';\r\nimport System from './System';\r\n\r\nexport default class AbilitySystem extends System {\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        this.query = this.game.ecs.createQuery({\r\n            all: [AbilityStatus],\r\n            none: [IsDestroying],\r\n        });\r\n    }\r\n\r\n    update(dt) {\r\n        const delta = this.game.clock.tickDelta;\r\n\r\n        if (!delta) {\r\n            return;\r\n        }\r\n\r\n        this.query.get().forEach((entity) => {\r\n            Object.values(entity.abilityStatus).forEach((status) => {\r\n                status.ability.update(delta, status);\r\n            });\r\n        });\r\n    }\r\n}\r\n","import {\r\n    HealthShard,\r\n    IsDestroying,\r\n    IsInventoried,\r\n    Position,\r\n} from '../ecs/components';\r\nimport System from './System';\r\n\r\nexport default class HealthShardSystem extends System {\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        this.shards = this.game.ecs.createQuery({\r\n            all: [HealthShard, Position],\r\n            none: [IsInventoried, IsDestroying],\r\n        });\r\n    }\r\n\r\n    update(dt) {\r\n        if (!this.game.clock.tickDelta) {\r\n            return;\r\n        }\r\n\r\n        this.shards.get().forEach((shardEntity) => {\r\n            const shard = shardEntity.healthShard;\r\n            const pos = shardEntity.position.getPos();\r\n            const entities = this.game.map.getEntitiesAt(pos.x, pos.y);\r\n\r\n            entities.forEach((entity) => {\r\n                if (!entity.healthShardConsumer) {\r\n                    return;\r\n                }\r\n\r\n                entity.fireEvent('heal', {\r\n                    value: shard.healValue,\r\n                });\r\n\r\n                this.game.particles.createEmitter(\r\n                    pos.x,\r\n                    pos.y,\r\n                    {\r\n                        rate: 2,\r\n                        duration: 600,\r\n                    },\r\n                    {\r\n                        glyphs: ['', ''],\r\n                        fg1s: ['red'],\r\n                        speed: .05,\r\n                        lifetime: 250,\r\n                    }\r\n                );\r\n\r\n                shardEntity.add(IsDestroying);\r\n\r\n                return;\r\n            });\r\n        });\r\n    }\r\n}\r\n","import {\r\n    Compressable,\r\n    IsDestroying,\r\n    IsInventoried,\r\n    Position,\r\n} from '../ecs/components';\r\nimport System from './System';\r\n\r\nexport default class CompressionSystem extends System {\r\n    constructor(game) {\r\n        super(game);\r\n\r\n        this.compressables = this.game.ecs.createQuery({\r\n            all: [Compressable, Position],\r\n            none: [IsInventoried, IsDestroying],\r\n        });\r\n    }\r\n\r\n    update(dt) {\r\n        if (!this.game.clock.tickDelta) {\r\n            return;\r\n        }\r\n\r\n        this.compressables.get().forEach((compressableEntity) => {\r\n            const compressable = compressableEntity.compressable;\r\n            const pos = compressableEntity.position.getPos();\r\n            const entities = this.game.map.getEntitiesAt(pos.x, pos.y);\r\n\r\n            entities.forEach((entity) => {\r\n                if (entity.id === compressableEntity.id) {\r\n                    return;\r\n                }\r\n                if (!entity.mass) {\r\n                    return;\r\n                }\r\n                if (entity.mass.value < compressable.massRequirement) {\r\n                    return;\r\n                }\r\n\r\n                compressableEntity.glyph.ch = compressable.compressedCh;\r\n                compressable.isCompressed = true;\r\n\r\n                compressableEntity.fireEvent('compressed', {\r\n                    interactor: entity,\r\n                });\r\n            });\r\n        });\r\n    }\r\n}\r\n","import { getMaskGlyph } from '../data/bitmasks';\r\nimport {\r\n    BitmaskGlyph,\r\n    Explored,\r\n    IsDestroying,\r\n    IsInventoried,\r\n    Position,\r\n} from '../ecs/components';\r\nimport Manager from './Manager';\r\n\r\nexport default class BitmaskManager extends Manager {\r\n    constructor(game) {\r\n        super(game);\r\n        this.query = game.ecs.createQuery({\r\n            all: [BitmaskGlyph, Position, Explored],\r\n            none: [IsInventoried, IsDestroying],\r\n        });\r\n\r\n        this.query.onEntityRemoved((entity) => {\r\n            if (entity.isDestroying || entity.IsInventoried) {\r\n                this.refreshMaskAndNeighbors(entity);\r\n            }\r\n        });\r\n    }\r\n\r\n    getMaskNeighbors(x, y, key) {\r\n        const neighbors = this.game.map.getNeighborEntities(x, y);\r\n\r\n        return neighbors.map((list) => {\r\n            return list.filter(\r\n                (e) =>\r\n                    e.explored &&\r\n                    e.bitmaskGlyph &&\r\n                    e.bitmaskGlyph.key === key &&\r\n                    !e.isDestroying\r\n            );\r\n        });\r\n    }\r\n\r\n    refreshMaskAndNeighbors(entity) {\r\n        const key = entity.bitmaskGlyph.key;\r\n        const pos = entity.position.getPos();\r\n\r\n        this.refreshMask(entity);\r\n\r\n        const neighbors = this.getMaskNeighbors(pos.x, pos.y, key);\r\n\r\n        neighbors.flat().forEach((neighbor) => {\r\n            this.refreshMask(neighbor);\r\n        });\r\n    }\r\n\r\n    refreshMask(entity) {\r\n        const key = entity.bitmaskGlyph.key;\r\n        const pos = entity.position.getPos();\r\n        const neighbors = this.getMaskNeighbors(pos.x, pos.y, key);\r\n        const mask = this.sumMask(neighbors);\r\n\r\n        if (entity.bitmaskGlyph.updateGlyph) {\r\n            entity.glyph.ch = getMaskGlyph(key, mask);\r\n        }\r\n    }\r\n\r\n    sumMask(neighbors) {\r\n        return neighbors.reduce((sum, cell, idx) => {\r\n            return cell.length ? sum + 2 ** idx : sum;\r\n        }, 0);\r\n    }\r\n\r\n    refreshAll() {\r\n        this.query.get().forEach((entity) => {\r\n            this.refreshMask(entity);\r\n        });\r\n    }\r\n}\r\n","import Chunk from '../data/Chunk';\r\nimport Grid from '../utils/Grid';\r\nimport Manager from './Manager';\r\n\r\nexport default class ChunkManager extends Manager {\r\n    chunkWidth = 16;\r\n    chunkHeight = 16;\r\n\r\n    chunkCountX = 16;\r\n    chunkCountY = 16;\r\n\r\n    constructor(game) {\r\n        super(game);\r\n        this.chunks = new Grid(this.chunkCountX, this.chunkCountY);\r\n\r\n        for (let x = 0; x < this.chunkCountX; x++) {\r\n            for (let y = 0; y < this.chunkCountY; y++) {\r\n                const id = this.chunks.idx(x, y);\r\n                const chunk = new Chunk(id, x, y, this.chunkWidth, this.chunkHeight);\r\n\r\n                this.chunks.set(x, y, chunk);\r\n            }\r\n        }\r\n    }\r\n\r\n    chunkCoordinate(worldX, worldY) {\r\n        return {\r\n            x: Math.floor(worldX / this.chunkWidth),\r\n            y: Math.floor(worldY / this.chunkHeight),\r\n        };\r\n    }\r\n\r\n    localCoordinate(worldX, worldY) {\r\n        return {\r\n            x: worldX % this.chunkWidth,\r\n            y: worldY % this.chunkHeight,\r\n        };\r\n    }\r\n\r\n    getPosition(entityId, chunkId) {\r\n        const chunk = this.getChunkById(chunkId);\r\n        const local = chunk.getPosition(entityId);\r\n\r\n        return {\r\n            x: local.x + chunk.x * this.chunkWidth,\r\n            y: local.y + chunk.y * this.chunkHeight,\r\n        };\r\n    }\r\n\r\n    setPosition(x, y, entityId, chunkId) {\r\n        const chunkPos = this.chunkCoordinate(x, y);\r\n        const local = this.localCoordinate(x, y);\r\n        const chunk = this.getChunk(chunkPos.x, chunkPos.y);\r\n\r\n        if (!chunk) {\r\n            return;\r\n        }\r\n\r\n        if (chunkId !== chunk.id) {\r\n            const old = this.getChunkById(chunkId);\r\n\r\n            old.removeEntity(entityId);\r\n        }\r\n\r\n        // TODO: should not have to lookup entity here\r\n        const entity = this.game.ecs.getEntity(entityId);\r\n        entity.position.chunkId = chunk.id;\r\n\r\n        chunk.setPosition(local.x, local.y, entityId);\r\n    }\r\n\r\n    removeEntity(entityId, chunkId) {\r\n        console.log('remove entity', entityId, chunkId);\r\n        const chunk = this.getChunkById(chunkId);\r\n\r\n        chunk.removeEntity(entityId);\r\n    }\r\n\r\n    getEntitiesAt(x, y, includeGround = false) {\r\n        if (x < 0 || y < 0) {\r\n            return [];\r\n        }\r\n\r\n        const chunkPos = this.chunkCoordinate(x, y);\r\n        const local = this.localCoordinate(x, y);\r\n        const chunk = this.getChunk(chunkPos.x, chunkPos.y);\r\n\r\n        if (!chunk) {\r\n            return [];\r\n        }\r\n\r\n        return chunk.getEntitiesAt(local.x, local.y, includeGround);\r\n    }\r\n\r\n    getSetupData() {\r\n        return {};\r\n    }\r\n\r\n    getChunkById(chunkId) {\r\n        const coord = this.chunks.coord(chunkId);\r\n\r\n        return this.getChunk(coord.x, coord.y);\r\n    }\r\n\r\n    getChunk(chunkX, chunkY) {\r\n        const chunk = this.chunks.get(chunkX, chunkY);\r\n\r\n        if (chunk && !chunk.isLoaded) {\r\n            chunk.load();\r\n        }\r\n\r\n        return chunk;\r\n    }\r\n\r\n    update(dt) {\r\n        this.chunks.data.forEach((chunk) => {\r\n            if (!chunk.isLoaded) {\r\n                return;\r\n            }\r\n\r\n            const c1 = game.camera.left < chunk.right;\r\n            const c2 = game.camera.right > chunk.left;\r\n            const c3 = game.camera.top < chunk.bottom;\r\n            const c4 = game.camera.bottom > chunk.top;\r\n\r\n            const intersects = c1 && c2 && c3 && c4;\r\n\r\n            if (!intersects) {\r\n                chunk.unload();\r\n            }\r\n        });\r\n    }\r\n}\r\n","import { game } from '../core/Game';\r\nimport { generateChunk } from '../level/ChunkGenerator';\r\nimport FastMap from '../utils/FastMap';\r\n\r\nexport default class Chunk {\r\n    get worldX() {\r\n        return this.width * this.x;\r\n    }\r\n\r\n    get worldY() {\r\n        return this.height * this.y;\r\n    }\r\n\r\n    get left() {\r\n        return this.width * this.x;\r\n    }\r\n\r\n    get right() {\r\n        return this.width * this.x + this.width;\r\n    }\r\n\r\n    get top() {\r\n        return this.height * this.y;\r\n    }\r\n\r\n    get bottom() {\r\n        return this.height * this.y + this.height;\r\n    }\r\n\r\n    constructor(id, x, y, width, height) {\r\n        this.id = id;\r\n        this.x = x;\r\n        this.y = y;\r\n        this.width = width;\r\n        this.height = height;\r\n        this.data = new FastMap(width, height);\r\n        this.isLoaded = false;\r\n    }\r\n\r\n    load() {\r\n        if (this.isLoaded) {\r\n            console.log('chunk is already loaded.');\r\n            return;\r\n        }\r\n\r\n        console.log(`load chunk ${this.id} (${this.x}, ${this.y})`);\r\n\r\n        const saved = game.state.loadChunkPositionData(this.id);\r\n\r\n        if (!saved) {\r\n            generateChunk(this);\r\n        } else {\r\n            this.data.deserialize(saved);\r\n\r\n            const entityData = game.state.loadChunkEntityData(this.id);\r\n\r\n            game.ecs.deserialize(entityData);\r\n        }\r\n\r\n        this.isLoaded = true;\r\n    }\r\n\r\n    unload() {\r\n        if (!this.isLoaded) {\r\n            console.log('chunk is already un-loaded.');\r\n            return;\r\n        }\r\n\r\n        console.log(`unload chunk ${this.id} (${this.x}, ${this.y})`);\r\n\r\n        const entityIds = this.data.getValues();\r\n\r\n        const entities = entityIds.map((id) => {\r\n            return game.ecs.getEntity(id);\r\n        });\r\n\r\n        const serialized = game.ecs.serialize(entities);\r\n\r\n        game.state.saveChunkPositionData(this.id, this.data.serialize());\r\n        game.state.saveChunkEntityData(this.id, serialized);\r\n\r\n        entities.forEach((e) => e.destroy());\r\n\r\n        this.isLoaded = false;\r\n    }\r\n\r\n    removeEntity(entityId) {\r\n        this.data.remove(entityId);\r\n    }\r\n\r\n    getPosition(entityId) {\r\n        if (!this.isLoaded) {\r\n            this.load();\r\n        }\r\n\r\n        return this.data.getPosition(entityId);\r\n    }\r\n\r\n    setPosition(x, y, entityId) {\r\n        this.data.set(x, y, entityId);\r\n    }\r\n\r\n    getEntitiesAt(x, y, includeGround = false) {\r\n        return this.data.get(x, y).reduce((entities, id) => {\r\n            const e = game.ecs.getEntity(id);\r\n\r\n            if (!e.isInventoried && (includeGround ? true : !e.ground)) {\r\n                entities.push(e);\r\n            }\r\n\r\n            return entities;\r\n        }, []);\r\n    }\r\n}\r\n","import SimplexNoise from 'simplex-noise';\r\nimport { SPWN_DESERT_REED, SPWN_GROUND_GRASS_DEAD, SPWN_GROUND_SAND } from '../data/Spawnables';\r\nimport { spawnForChunk } from '../data/Spawner';\r\n\r\nconst simplex = new SimplexNoise('seed');\r\n\r\nexport const generateChunk = (chunk) => {\r\n    console.log(`generate chunk ${chunk.id}`);\r\n\r\n\r\n    for (let x = 0; x < chunk.width; x++) {\r\n        for (let y = 0; y < chunk.width; y++) {\r\n            const v = simplex.noise2D((chunk.x + x) / 10, (chunk.y + y) / 10);\r\n\r\n            if (v <= -1) {\r\n                console.log('low value!!', v);\r\n            } else if (v >= 1) {\r\n                console.log('high value!!', v);\r\n            }\r\n\r\n            if (v < .3) {\r\n                spawnForChunk(SPWN_GROUND_GRASS_DEAD, x, y, {}, chunk);\r\n                if (v < -.4) {\r\n                    spawnForChunk(SPWN_DESERT_REED, x, y, {}, chunk);\r\n                }\r\n            } else {\r\n                spawnForChunk(SPWN_GROUND_SAND, x, y, {}, chunk);\r\n            }\r\n        }\r\n    }\r\n};\r\n","/*\n * A fast javascript implementation of simplex noise by Jonas Wagner\n\nBased on a speed-improved simplex noise algorithm for 2D, 3D and 4D in Java.\nWhich is based on example code by Stefan Gustavson (stegu@itn.liu.se).\nWith Optimisations by Peter Eastman (peastman@drizzle.stanford.edu).\nBetter rank ordering method by Stefan Gustavson in 2012.\n\n\n Copyright (c) 2018 Jonas Wagner\n\n Permission is hereby granted, free of charge, to any person obtaining a copy\n of this software and associated documentation files (the \"Software\"), to deal\n in the Software without restriction, including without limitation the rights\n to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n copies of the Software, and to permit persons to whom the Software is\n furnished to do so, subject to the following conditions:\n\n The above copyright notice and this permission notice shall be included in all\n copies or substantial portions of the Software.\n\n THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE\n AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE\n SOFTWARE.\n */\n(function() {\n  'use strict';\n\n  var F2 = 0.5 * (Math.sqrt(3.0) - 1.0);\n  var G2 = (3.0 - Math.sqrt(3.0)) / 6.0;\n  var F3 = 1.0 / 3.0;\n  var G3 = 1.0 / 6.0;\n  var F4 = (Math.sqrt(5.0) - 1.0) / 4.0;\n  var G4 = (5.0 - Math.sqrt(5.0)) / 20.0;\n\n  function SimplexNoise(randomOrSeed) {\n    var random;\n    if (typeof randomOrSeed == 'function') {\n      random = randomOrSeed;\n    }\n    else if (randomOrSeed) {\n      random = alea(randomOrSeed);\n    } else {\n      random = Math.random;\n    }\n    this.p = buildPermutationTable(random);\n    this.perm = new Uint8Array(512);\n    this.permMod12 = new Uint8Array(512);\n    for (var i = 0; i < 512; i++) {\n      this.perm[i] = this.p[i & 255];\n      this.permMod12[i] = this.perm[i] % 12;\n    }\n\n  }\n  SimplexNoise.prototype = {\n    grad3: new Float32Array([1, 1, 0,\n      -1, 1, 0,\n      1, -1, 0,\n\n      -1, -1, 0,\n      1, 0, 1,\n      -1, 0, 1,\n\n      1, 0, -1,\n      -1, 0, -1,\n      0, 1, 1,\n\n      0, -1, 1,\n      0, 1, -1,\n      0, -1, -1]),\n    grad4: new Float32Array([0, 1, 1, 1, 0, 1, 1, -1, 0, 1, -1, 1, 0, 1, -1, -1,\n      0, -1, 1, 1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, -1,\n      1, 0, 1, 1, 1, 0, 1, -1, 1, 0, -1, 1, 1, 0, -1, -1,\n      -1, 0, 1, 1, -1, 0, 1, -1, -1, 0, -1, 1, -1, 0, -1, -1,\n      1, 1, 0, 1, 1, 1, 0, -1, 1, -1, 0, 1, 1, -1, 0, -1,\n      -1, 1, 0, 1, -1, 1, 0, -1, -1, -1, 0, 1, -1, -1, 0, -1,\n      1, 1, 1, 0, 1, 1, -1, 0, 1, -1, 1, 0, 1, -1, -1, 0,\n      -1, 1, 1, 0, -1, 1, -1, 0, -1, -1, 1, 0, -1, -1, -1, 0]),\n    noise2D: function(xin, yin) {\n      var permMod12 = this.permMod12;\n      var perm = this.perm;\n      var grad3 = this.grad3;\n      var n0 = 0; // Noise contributions from the three corners\n      var n1 = 0;\n      var n2 = 0;\n      // Skew the input space to determine which simplex cell we're in\n      var s = (xin + yin) * F2; // Hairy factor for 2D\n      var i = Math.floor(xin + s);\n      var j = Math.floor(yin + s);\n      var t = (i + j) * G2;\n      var X0 = i - t; // Unskew the cell origin back to (x,y) space\n      var Y0 = j - t;\n      var x0 = xin - X0; // The x,y distances from the cell origin\n      var y0 = yin - Y0;\n      // For the 2D case, the simplex shape is an equilateral triangle.\n      // Determine which simplex we are in.\n      var i1, j1; // Offsets for second (middle) corner of simplex in (i,j) coords\n      if (x0 > y0) {\n        i1 = 1;\n        j1 = 0;\n      } // lower triangle, XY order: (0,0)->(1,0)->(1,1)\n      else {\n        i1 = 0;\n        j1 = 1;\n      } // upper triangle, YX order: (0,0)->(0,1)->(1,1)\n      // A step of (1,0) in (i,j) means a step of (1-c,-c) in (x,y), and\n      // a step of (0,1) in (i,j) means a step of (-c,1-c) in (x,y), where\n      // c = (3-sqrt(3))/6\n      var x1 = x0 - i1 + G2; // Offsets for middle corner in (x,y) unskewed coords\n      var y1 = y0 - j1 + G2;\n      var x2 = x0 - 1.0 + 2.0 * G2; // Offsets for last corner in (x,y) unskewed coords\n      var y2 = y0 - 1.0 + 2.0 * G2;\n      // Work out the hashed gradient indices of the three simplex corners\n      var ii = i & 255;\n      var jj = j & 255;\n      // Calculate the contribution from the three corners\n      var t0 = 0.5 - x0 * x0 - y0 * y0;\n      if (t0 >= 0) {\n        var gi0 = permMod12[ii + perm[jj]] * 3;\n        t0 *= t0;\n        n0 = t0 * t0 * (grad3[gi0] * x0 + grad3[gi0 + 1] * y0); // (x,y) of grad3 used for 2D gradient\n      }\n      var t1 = 0.5 - x1 * x1 - y1 * y1;\n      if (t1 >= 0) {\n        var gi1 = permMod12[ii + i1 + perm[jj + j1]] * 3;\n        t1 *= t1;\n        n1 = t1 * t1 * (grad3[gi1] * x1 + grad3[gi1 + 1] * y1);\n      }\n      var t2 = 0.5 - x2 * x2 - y2 * y2;\n      if (t2 >= 0) {\n        var gi2 = permMod12[ii + 1 + perm[jj + 1]] * 3;\n        t2 *= t2;\n        n2 = t2 * t2 * (grad3[gi2] * x2 + grad3[gi2 + 1] * y2);\n      }\n      // Add contributions from each corner to get the final noise value.\n      // The result is scaled to return values in the interval [-1,1].\n      return 70.0 * (n0 + n1 + n2);\n    },\n    // 3D simplex noise\n    noise3D: function(xin, yin, zin) {\n      var permMod12 = this.permMod12;\n      var perm = this.perm;\n      var grad3 = this.grad3;\n      var n0, n1, n2, n3; // Noise contributions from the four corners\n      // Skew the input space to determine which simplex cell we're in\n      var s = (xin + yin + zin) * F3; // Very nice and simple skew factor for 3D\n      var i = Math.floor(xin + s);\n      var j = Math.floor(yin + s);\n      var k = Math.floor(zin + s);\n      var t = (i + j + k) * G3;\n      var X0 = i - t; // Unskew the cell origin back to (x,y,z) space\n      var Y0 = j - t;\n      var Z0 = k - t;\n      var x0 = xin - X0; // The x,y,z distances from the cell origin\n      var y0 = yin - Y0;\n      var z0 = zin - Z0;\n      // For the 3D case, the simplex shape is a slightly irregular tetrahedron.\n      // Determine which simplex we are in.\n      var i1, j1, k1; // Offsets for second corner of simplex in (i,j,k) coords\n      var i2, j2, k2; // Offsets for third corner of simplex in (i,j,k) coords\n      if (x0 >= y0) {\n        if (y0 >= z0) {\n          i1 = 1;\n          j1 = 0;\n          k1 = 0;\n          i2 = 1;\n          j2 = 1;\n          k2 = 0;\n        } // X Y Z order\n        else if (x0 >= z0) {\n          i1 = 1;\n          j1 = 0;\n          k1 = 0;\n          i2 = 1;\n          j2 = 0;\n          k2 = 1;\n        } // X Z Y order\n        else {\n          i1 = 0;\n          j1 = 0;\n          k1 = 1;\n          i2 = 1;\n          j2 = 0;\n          k2 = 1;\n        } // Z X Y order\n      }\n      else { // x0<y0\n        if (y0 < z0) {\n          i1 = 0;\n          j1 = 0;\n          k1 = 1;\n          i2 = 0;\n          j2 = 1;\n          k2 = 1;\n        } // Z Y X order\n        else if (x0 < z0) {\n          i1 = 0;\n          j1 = 1;\n          k1 = 0;\n          i2 = 0;\n          j2 = 1;\n          k2 = 1;\n        } // Y Z X order\n        else {\n          i1 = 0;\n          j1 = 1;\n          k1 = 0;\n          i2 = 1;\n          j2 = 1;\n          k2 = 0;\n        } // Y X Z order\n      }\n      // A step of (1,0,0) in (i,j,k) means a step of (1-c,-c,-c) in (x,y,z),\n      // a step of (0,1,0) in (i,j,k) means a step of (-c,1-c,-c) in (x,y,z), and\n      // a step of (0,0,1) in (i,j,k) means a step of (-c,-c,1-c) in (x,y,z), where\n      // c = 1/6.\n      var x1 = x0 - i1 + G3; // Offsets for second corner in (x,y,z) coords\n      var y1 = y0 - j1 + G3;\n      var z1 = z0 - k1 + G3;\n      var x2 = x0 - i2 + 2.0 * G3; // Offsets for third corner in (x,y,z) coords\n      var y2 = y0 - j2 + 2.0 * G3;\n      var z2 = z0 - k2 + 2.0 * G3;\n      var x3 = x0 - 1.0 + 3.0 * G3; // Offsets for last corner in (x,y,z) coords\n      var y3 = y0 - 1.0 + 3.0 * G3;\n      var z3 = z0 - 1.0 + 3.0 * G3;\n      // Work out the hashed gradient indices of the four simplex corners\n      var ii = i & 255;\n      var jj = j & 255;\n      var kk = k & 255;\n      // Calculate the contribution from the four corners\n      var t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0;\n      if (t0 < 0) n0 = 0.0;\n      else {\n        var gi0 = permMod12[ii + perm[jj + perm[kk]]] * 3;\n        t0 *= t0;\n        n0 = t0 * t0 * (grad3[gi0] * x0 + grad3[gi0 + 1] * y0 + grad3[gi0 + 2] * z0);\n      }\n      var t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1;\n      if (t1 < 0) n1 = 0.0;\n      else {\n        var gi1 = permMod12[ii + i1 + perm[jj + j1 + perm[kk + k1]]] * 3;\n        t1 *= t1;\n        n1 = t1 * t1 * (grad3[gi1] * x1 + grad3[gi1 + 1] * y1 + grad3[gi1 + 2] * z1);\n      }\n      var t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2;\n      if (t2 < 0) n2 = 0.0;\n      else {\n        var gi2 = permMod12[ii + i2 + perm[jj + j2 + perm[kk + k2]]] * 3;\n        t2 *= t2;\n        n2 = t2 * t2 * (grad3[gi2] * x2 + grad3[gi2 + 1] * y2 + grad3[gi2 + 2] * z2);\n      }\n      var t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3;\n      if (t3 < 0) n3 = 0.0;\n      else {\n        var gi3 = permMod12[ii + 1 + perm[jj + 1 + perm[kk + 1]]] * 3;\n        t3 *= t3;\n        n3 = t3 * t3 * (grad3[gi3] * x3 + grad3[gi3 + 1] * y3 + grad3[gi3 + 2] * z3);\n      }\n      // Add contributions from each corner to get the final noise value.\n      // The result is scaled to stay just inside [-1,1]\n      return 32.0 * (n0 + n1 + n2 + n3);\n    },\n    // 4D simplex noise, better simplex rank ordering method 2012-03-09\n    noise4D: function(x, y, z, w) {\n      var perm = this.perm;\n      var grad4 = this.grad4;\n\n      var n0, n1, n2, n3, n4; // Noise contributions from the five corners\n      // Skew the (x,y,z,w) space to determine which cell of 24 simplices we're in\n      var s = (x + y + z + w) * F4; // Factor for 4D skewing\n      var i = Math.floor(x + s);\n      var j = Math.floor(y + s);\n      var k = Math.floor(z + s);\n      var l = Math.floor(w + s);\n      var t = (i + j + k + l) * G4; // Factor for 4D unskewing\n      var X0 = i - t; // Unskew the cell origin back to (x,y,z,w) space\n      var Y0 = j - t;\n      var Z0 = k - t;\n      var W0 = l - t;\n      var x0 = x - X0; // The x,y,z,w distances from the cell origin\n      var y0 = y - Y0;\n      var z0 = z - Z0;\n      var w0 = w - W0;\n      // For the 4D case, the simplex is a 4D shape I won't even try to describe.\n      // To find out which of the 24 possible simplices we're in, we need to\n      // determine the magnitude ordering of x0, y0, z0 and w0.\n      // Six pair-wise comparisons are performed between each possible pair\n      // of the four coordinates, and the results are used to rank the numbers.\n      var rankx = 0;\n      var ranky = 0;\n      var rankz = 0;\n      var rankw = 0;\n      if (x0 > y0) rankx++;\n      else ranky++;\n      if (x0 > z0) rankx++;\n      else rankz++;\n      if (x0 > w0) rankx++;\n      else rankw++;\n      if (y0 > z0) ranky++;\n      else rankz++;\n      if (y0 > w0) ranky++;\n      else rankw++;\n      if (z0 > w0) rankz++;\n      else rankw++;\n      var i1, j1, k1, l1; // The integer offsets for the second simplex corner\n      var i2, j2, k2, l2; // The integer offsets for the third simplex corner\n      var i3, j3, k3, l3; // The integer offsets for the fourth simplex corner\n      // simplex[c] is a 4-vector with the numbers 0, 1, 2 and 3 in some order.\n      // Many values of c will never occur, since e.g. x>y>z>w makes x<z, y<w and x<w\n      // impossible. Only the 24 indices which have non-zero entries make any sense.\n      // We use a thresholding to set the coordinates in turn from the largest magnitude.\n      // Rank 3 denotes the largest coordinate.\n      i1 = rankx >= 3 ? 1 : 0;\n      j1 = ranky >= 3 ? 1 : 0;\n      k1 = rankz >= 3 ? 1 : 0;\n      l1 = rankw >= 3 ? 1 : 0;\n      // Rank 2 denotes the second largest coordinate.\n      i2 = rankx >= 2 ? 1 : 0;\n      j2 = ranky >= 2 ? 1 : 0;\n      k2 = rankz >= 2 ? 1 : 0;\n      l2 = rankw >= 2 ? 1 : 0;\n      // Rank 1 denotes the second smallest coordinate.\n      i3 = rankx >= 1 ? 1 : 0;\n      j3 = ranky >= 1 ? 1 : 0;\n      k3 = rankz >= 1 ? 1 : 0;\n      l3 = rankw >= 1 ? 1 : 0;\n      // The fifth corner has all coordinate offsets = 1, so no need to compute that.\n      var x1 = x0 - i1 + G4; // Offsets for second corner in (x,y,z,w) coords\n      var y1 = y0 - j1 + G4;\n      var z1 = z0 - k1 + G4;\n      var w1 = w0 - l1 + G4;\n      var x2 = x0 - i2 + 2.0 * G4; // Offsets for third corner in (x,y,z,w) coords\n      var y2 = y0 - j2 + 2.0 * G4;\n      var z2 = z0 - k2 + 2.0 * G4;\n      var w2 = w0 - l2 + 2.0 * G4;\n      var x3 = x0 - i3 + 3.0 * G4; // Offsets for fourth corner in (x,y,z,w) coords\n      var y3 = y0 - j3 + 3.0 * G4;\n      var z3 = z0 - k3 + 3.0 * G4;\n      var w3 = w0 - l3 + 3.0 * G4;\n      var x4 = x0 - 1.0 + 4.0 * G4; // Offsets for last corner in (x,y,z,w) coords\n      var y4 = y0 - 1.0 + 4.0 * G4;\n      var z4 = z0 - 1.0 + 4.0 * G4;\n      var w4 = w0 - 1.0 + 4.0 * G4;\n      // Work out the hashed gradient indices of the five simplex corners\n      var ii = i & 255;\n      var jj = j & 255;\n      var kk = k & 255;\n      var ll = l & 255;\n      // Calculate the contribution from the five corners\n      var t0 = 0.6 - x0 * x0 - y0 * y0 - z0 * z0 - w0 * w0;\n      if (t0 < 0) n0 = 0.0;\n      else {\n        var gi0 = (perm[ii + perm[jj + perm[kk + perm[ll]]]] % 32) * 4;\n        t0 *= t0;\n        n0 = t0 * t0 * (grad4[gi0] * x0 + grad4[gi0 + 1] * y0 + grad4[gi0 + 2] * z0 + grad4[gi0 + 3] * w0);\n      }\n      var t1 = 0.6 - x1 * x1 - y1 * y1 - z1 * z1 - w1 * w1;\n      if (t1 < 0) n1 = 0.0;\n      else {\n        var gi1 = (perm[ii + i1 + perm[jj + j1 + perm[kk + k1 + perm[ll + l1]]]] % 32) * 4;\n        t1 *= t1;\n        n1 = t1 * t1 * (grad4[gi1] * x1 + grad4[gi1 + 1] * y1 + grad4[gi1 + 2] * z1 + grad4[gi1 + 3] * w1);\n      }\n      var t2 = 0.6 - x2 * x2 - y2 * y2 - z2 * z2 - w2 * w2;\n      if (t2 < 0) n2 = 0.0;\n      else {\n        var gi2 = (perm[ii + i2 + perm[jj + j2 + perm[kk + k2 + perm[ll + l2]]]] % 32) * 4;\n        t2 *= t2;\n        n2 = t2 * t2 * (grad4[gi2] * x2 + grad4[gi2 + 1] * y2 + grad4[gi2 + 2] * z2 + grad4[gi2 + 3] * w2);\n      }\n      var t3 = 0.6 - x3 * x3 - y3 * y3 - z3 * z3 - w3 * w3;\n      if (t3 < 0) n3 = 0.0;\n      else {\n        var gi3 = (perm[ii + i3 + perm[jj + j3 + perm[kk + k3 + perm[ll + l3]]]] % 32) * 4;\n        t3 *= t3;\n        n3 = t3 * t3 * (grad4[gi3] * x3 + grad4[gi3 + 1] * y3 + grad4[gi3 + 2] * z3 + grad4[gi3 + 3] * w3);\n      }\n      var t4 = 0.6 - x4 * x4 - y4 * y4 - z4 * z4 - w4 * w4;\n      if (t4 < 0) n4 = 0.0;\n      else {\n        var gi4 = (perm[ii + 1 + perm[jj + 1 + perm[kk + 1 + perm[ll + 1]]]] % 32) * 4;\n        t4 *= t4;\n        n4 = t4 * t4 * (grad4[gi4] * x4 + grad4[gi4 + 1] * y4 + grad4[gi4 + 2] * z4 + grad4[gi4 + 3] * w4);\n      }\n      // Sum up and scale the result to cover the range [-1,1]\n      return 27.0 * (n0 + n1 + n2 + n3 + n4);\n    }\n  };\n\n  function buildPermutationTable(random) {\n    var i;\n    var p = new Uint8Array(256);\n    for (i = 0; i < 256; i++) {\n      p[i] = i;\n    }\n    for (i = 0; i < 255; i++) {\n      var r = i + ~~(random() * (256 - i));\n      var aux = p[i];\n      p[i] = p[r];\n      p[r] = aux;\n    }\n    return p;\n  }\n  SimplexNoise._buildPermutationTable = buildPermutationTable;\n\n  function alea() {\n    // Johannes Baage <baagoe@baagoe.com>, 2010\n    var s0 = 0;\n    var s1 = 0;\n    var s2 = 0;\n    var c = 1;\n\n    var mash = masher();\n    s0 = mash(' ');\n    s1 = mash(' ');\n    s2 = mash(' ');\n\n    for (var i = 0; i < arguments.length; i++) {\n      s0 -= mash(arguments[i]);\n      if (s0 < 0) {\n        s0 += 1;\n      }\n      s1 -= mash(arguments[i]);\n      if (s1 < 0) {\n        s1 += 1;\n      }\n      s2 -= mash(arguments[i]);\n      if (s2 < 0) {\n        s2 += 1;\n      }\n    }\n    mash = null;\n    return function() {\n      var t = 2091639 * s0 + c * 2.3283064365386963e-10; // 2^-32\n      s0 = s1;\n      s1 = s2;\n      return s2 = t - (c = t | 0);\n    };\n  }\n  function masher() {\n    var n = 0xefc8249d;\n    return function(data) {\n      data = data.toString();\n      for (var i = 0; i < data.length; i++) {\n        n += data.charCodeAt(i);\n        var h = 0.02519603282416938 * n;\n        n = h >>> 0;\n        h -= n;\n        h *= n;\n        n = h >>> 0;\n        h -= n;\n        n += h * 0x100000000; // 2^32\n      }\n      return (n >>> 0) * 2.3283064365386963e-10; // 2^-32\n    };\n  }\n\n  // amd\n  if (typeof define !== 'undefined' && define.amd) define(function() {return SimplexNoise;});\n  // common js\n  if (typeof exports !== 'undefined') exports.SimplexNoise = SimplexNoise;\n  // browser\n  else if (typeof window !== 'undefined') window.SimplexNoise = SimplexNoise;\n  // nodejs\n  if (typeof module !== 'undefined') {\n    module.exports = SimplexNoise;\n  }\n\n})();\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tif(__webpack_module_cache__[moduleId]) {\n\t\treturn __webpack_module_cache__[moduleId].exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// getDefaultExport function for compatibility with non-harmony modules\n__webpack_require__.n = (module) => {\n\tvar getter = module && module.__esModule ?\n\t\t() => module['default'] :\n\t\t() => module;\n\t__webpack_require__.d(getter, { a: getter });\n\treturn getter;\n};","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.g = (function() {\n\tif (typeof globalThis === 'object') return globalThis;\n\ttry {\n\t\treturn this || new Function('return this')();\n\t} catch (e) {\n\t\tif (typeof window === 'object') return window;\n\t}\n})();","__webpack_require__.o = (obj, prop) => Object.prototype.hasOwnProperty.call(obj, prop)","// define __esModule on exports\n__webpack_require__.r = (exports) => {\n\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n\t}\n\tObject.defineProperty(exports, '__esModule', { value: true });\n};","// startup\n// Load entry module\n__webpack_require__(0);\n// This entry module used 'exports' so it can't be inlined\n"],"sourceRoot":""}